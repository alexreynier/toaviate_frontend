<div class="centre_align_boxes2 settings_page">

  <div class="home_upper">
    <div class="back-box" ui-sref="dashboard.manage_club">
              <i class="fa fa-arrow-circle-left"></i> BACK
            </div>
        <div class="welcome_title">
          <h2>Company Details</h2> 
          <h4 class="capitalise">
            Manage your company details
          </h4>
          <!-- {{ vm.welcome_message }} -->
      </div>
    </div>
        <form>

    <div class="club_docs_all">

      <h2>Company Details</h2>
      <div class="center_if_large">

            <div class="fu-card"
                 flow-init="{target: '/upload.php'}"
                 flow-files-submitted="$flow.upload()"
                 flow-file-success="$file.file_return = $message"
                 flow-complete="processFiles($flow.files, 'logo')"
                 flow-file-added="!!{png:1,gif:1,jpg:1,jpeg:1}[$file.getExtension()]">
                <div class="fu-card-inner" flow-btn flow-drop ng-class="dropClass">
                    <!-- Has logo -->
                    <div class="fu-preview" ng-if="vm.club.settings.logo">
                        <img ng-src="{{ vm.club.settings.logo }}" class="fu-preview-img" />
                        <div class="fu-hover-overlay">
                            <i class="fa fa-camera"></i>
                            <span>Change Logo</span>
                        </div>
                    </div>
                    <!-- No logo yet -->
                    <div class="fu-empty" ng-if="!vm.club.settings.logo">
                        <div class="fu-empty-icon">
                            <i class="fa fa-image"></i>
                        </div>
                        <span class="fu-empty-label">Company Logo</span>
                        <span class="fu-empty-hint">Click or drag to upload</span>
                    </div>
                </div>
            </div>
            

             <div class="form-group fgtwo extra_space_top" uib-tooltip="If you need to change this - please contact us">
                <label for="company_name">Company Name</label>
                <input type="text" class="form-control" name="company_name" id="company_name" ng-model="vm.club.settings.company_name" disabled="true" />
            </div>


            <div class="form-group fgtwo" uib-tooltip="If you need to change this - please contact us">    
                <label for="company_number">Company Number</label>
                <input type="text" class="form-control" name="company_number" id="company_number" ng-model="vm.club.settings.company_number" disabled="true" />
            </div>

            <div class="form-group fgtwo">
                <label for="title">Trading As</label>
                <input type="text" class="form-control" name="title" id="title" ng-model="vm.club.settings.title" required ng-focus="vm.clearFieldError($event)" />
            </div>
            

            <div class="form-group fgtwo">
                <label for="website">Website URL</label>
                <input type="text" class="form-control" name="website" id="website" ng-model="vm.club.settings.website" />
            </div>


            <div class="form-group fgtwo">
                <label for="email">Email</label>
                <input type="email" class="form-control" name="email" id="email" ng-model="vm.club.settings.email" required ng-focus="vm.clearFieldError($event)" />
            </div>

            <div class="form-group fgtwo">
                <label for="vat_registered">Is The Company VAT Registered?</label>
                <input type="checkbox" class="form-control" name="vat_registered" id="vat_registered" ng-model="vm.club.settings.vat_registered" />
             </div>


            <div class="form-group fgtwo"  ng-if="vm.club.settings.vat_registered">
                <label for="vat_number">VAT Number</label>
                <input type="text" class="form-control" name="vat_number" id="vat_number" ng-model="vm.club.settings.vat_number" ng-required="vm.club.settings.vat_registered" ng-focus="vm.clearFieldError($event)" />
            </div>


            <div class="form-group fgtwo" ng-if="vm.club.settings.vat_registered">
                <label for="vat_rate">Standard VAT Rate %</label>
                <input type="number" class="form-control" name="vat_rate" id="vat_rate" ng-model="vm.club.settings.vat_rate" ng-required="vm.club.settings.vat_registered" ng-focus="vm.clearFieldError($event)" />
            </div>

            <div class="form-group fgtwo">
                <label for="address">Registered Address</label>
                <textarea id="address" class="form-control inputtext" ng-model="vm.club.settings.address" required ng-focus="vm.clearFieldError($event)"></textarea>
            </div>


          </div>
        </div>
        <div class="club_docs_all">

        <h2>Company Invoice Details</h2>
        <div class="center_if_large">

            <div class="form-group">
                <label for="billing_cycle">Billing Cycle</label>
                <select class="form-control inputtext" ng-model="vm.club.settings.billing_cycle">
                  <option disabled="disabled">Please Choose</option>
                  <option value="daily" ng-selected="vm.club.settings.billing_cycle == 'daily'">Daily</option>
                  <option value="weekly" ng-selected="vm.club.settings.billing_cycle == 'weekly'">Weekly</option>
                  <option value="monthly" ng-selected="vm.club.settings.billing_cycle == 'monthly'">Monthly</option>
                </select>
            </div>

            <div class="form-group fgtwo">
                <label for="invoice_start" uib-tooltip="This is the prefix for the invoice sequential numbering">Invoice Begins With</label>
                <input type="text" class="form-control" name="invoice_start" id="invoice_start" ng-model="vm.club.settings.invoice_start" />
            </div>

         
            <div class="fu-card"
                 flow-init="{target: '/upload.php'}"
                 flow-files-submitted="$flow.upload()"
                 flow-file-success="$file.file_return = $message"
                 flow-complete="processFiles($flow.files, 'invoice_logo')"
                 flow-file-added="!!{png:1,gif:1,jpg:1,jpeg:1}[$file.getExtension()]">
                <h5 class="fu-section-label">Invoice Logo</h5>
                <div class="fu-card-inner" flow-btn flow-drop ng-class="dropClass">
                    <!-- Has invoice logo -->
                    <div class="fu-preview" ng-if="vm.club.settings.invoice_logo">
                        <img ng-src="{{ vm.club.settings.invoice_logo }}" class="fu-preview-img" />
                        <div class="fu-hover-overlay">
                            <i class="fa fa-camera"></i>
                            <span>Change Logo</span>
                        </div>
                    </div>
                    <!-- No invoice logo yet -->
                    <div class="fu-empty" ng-if="!vm.club.settings.invoice_logo">
                        <div class="fu-empty-icon">
                            <i class="fa fa-image"></i>
                        </div>
                        <span class="fu-empty-label">Invoice Logo</span>
                        <span class="fu-empty-hint">Click or drag to upload</span>
                    </div>
                </div>
            </div>

            <div class="form-group fgtwo">
                <label for="vat_registered" uib-tooltip="This ensures that the user is presented with a clean explanation of the charges for the flight without showing a separate surcharge line, but with a -5mins and +5mins on the charged line for aircaft line, and a logbook time shown below">Clean "TPC style" Flat Taxi Surcharge on Invoices?</label>
                <input type="checkbox" class="form-control" name="tpc_aircraft_surchages" id="tpc_aircraft_surchages" ng-model="vm.club.settings.tpc_aircraft_surchages" />
            </div>

          </div>
        </div>

        <div class="club_docs_all">
          <h2>Membership Terms & Conditions</h2>

            <div class="fu-doc-section"
                 flow-init="{target: '/upload_documents.php', singleFile: true}"
                 flow-files-submitted="$flow.upload()"
                 flow-file-success="$file.file_return = $message"
                 flow-complete="processFiles2($flow.files, 'membership')"
                 flow-file-limit="1"
                 flow-file-added="!!{pdf:1}[$file.getExtension()]">

                <!-- Existing document -->
                <div class="fu-doc-card" ng-if="vm.club.settings.membership_terms">
                    <div class="fu-doc-icon" ng-click="downloadClubDocument(vm.club.settings.membership_terms)">
                        <img src="{{get_icon(vm.club.settings.membership_terms)}}" />
                    </div>
                    <div class="fu-doc-info">
                        <span class="fu-doc-name">Membership T&Cs</span>
                        <span class="fu-doc-meta">Updated: {{vm.club.settings.membership_updated | asDate | date:"dd MMM yyyy HH:mm"}}</span>
                    </div>
                    <div class="fu-doc-actions">
                        <a class="fu-doc-action fu-doc-download" ng-click="downloadClubDocument(vm.club.settings.membership_terms)" title="Download"><i class="fa fa-download"></i></a>
                        <a class="fu-doc-action fu-doc-replace" flow-btn title="Replace"><i class="fa fa-refresh"></i></a>
                        <a class="fu-doc-action fu-doc-delete" ng-click="delete_file('membership')" title="Delete"><i class="fa fa-trash"></i></a>
                    </div>
                </div>

                <!-- Uploading state -->
                <div ng-repeat="file in $flow.files" ng-if="!vm.club.settings.membership_terms">
                    <div class="fu-doc-card fu-doc-uploading">
                        <div class="fu-doc-icon"><img src="{{get_icon(file.file)}}" /></div>
                        <div class="fu-doc-info">
                            <span class="fu-doc-name">{{file.name}}</span>
                            <div class="fu-progress" ng-if="(file.progress() * 100) < 100">
                                <div class="fu-progress-bar" ng-style="{width: (file.progress() * 100) + '%'}"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Empty state — drop zone -->
                <div class="fu-doc-empty" flow-btn flow-drop ng-class="dropClass" ng-if="!vm.club.settings.membership_terms && $flow.files.length < 1">
                    <div class="fu-doc-empty-icon"><i class="fa fa-file-pdf-o"></i></div>
                    <span class="fu-doc-empty-label">Upload Membership Terms</span>
                    <span class="fu-doc-empty-hint">PDF format &middot; Click or drag to upload</span>
                </div>
            </div>

          </div>


        <div class="club_docs_all">
          <h2>Passenger Terms & Conditions</h2>

            <div class="fu-doc-section"
                 flow-init="{target: '/upload_documents.php', singleFile: true}"
                 flow-files-submitted="$flow.upload()"
                 flow-file-success="$file.file_return = $message"
                 flow-complete="processFiles2($flow.files, 'passenger')"
                 flow-file-limit="1"
                 flow-file-added="!!{pdf:1}[$file.getExtension()]">

                <!-- Existing document -->
                <div class="fu-doc-card" ng-if="vm.club.settings.passenger_terms">
                    <div class="fu-doc-icon" ng-click="downloadClubDocument(vm.club.settings.passenger_terms)">
                        <img src="{{get_icon(vm.club.settings.passenger_terms)}}" />
                    </div>
                    <div class="fu-doc-info">
                        <span class="fu-doc-name">Passenger T&Cs</span>
                        <span class="fu-doc-meta">Updated: {{vm.club.settings.passenger_updated | asDate | date:"dd MMM yyyy HH:mm"}}</span>
                    </div>
                    <div class="fu-doc-actions">
                        <a class="fu-doc-action fu-doc-download" ng-click="downloadClubDocument(vm.club.settings.passenger_terms)" title="Download"><i class="fa fa-download"></i></a>
                        <a class="fu-doc-action fu-doc-replace" flow-btn title="Replace"><i class="fa fa-refresh"></i></a>
                        <a class="fu-doc-action fu-doc-delete" ng-click="delete_file('passenger')" title="Delete"><i class="fa fa-trash"></i></a>
                    </div>
                </div>

                <!-- Uploading state -->
                <div ng-repeat="file in $flow.files" ng-if="!vm.club.settings.passenger_terms">
                    <div class="fu-doc-card fu-doc-uploading">
                        <div class="fu-doc-icon"><img src="{{get_icon(file.file)}}" /></div>
                        <div class="fu-doc-info">
                            <span class="fu-doc-name">{{file.name}}</span>
                            <div class="fu-progress" ng-if="(file.progress() * 100) < 100">
                                <div class="fu-progress-bar" ng-style="{width: (file.progress() * 100) + '%'}"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Empty state — drop zone -->
                <div class="fu-doc-empty" flow-btn flow-drop ng-class="dropClass" ng-if="!vm.club.settings.passenger_terms && $flow.files.length < 1">
                    <div class="fu-doc-empty-icon"><i class="fa fa-file-pdf-o"></i></div>
                    <span class="fu-doc-empty-label">Upload Passenger Terms</span>
                    <span class="fu-doc-empty-hint">PDF format &middot; Click or drag to upload</span>
                </div>
            </div>

          </div>


        <div class="club_docs_all">
          <h2>Privacy Policy</h2>

            <div class="fu-doc-section"
                 flow-init="{target: '/upload_documents.php', singleFile: true}"
                 flow-files-submitted="$flow.upload()"
                 flow-file-success="$file.file_return = $message"
                 flow-complete="processFiles2($flow.files, 'privacy')"
                 flow-file-limit="1"
                 flow-file-added="!!{pdf:1}[$file.getExtension()]">

                <!-- Existing document -->
                <div class="fu-doc-card" ng-if="vm.club.settings.privacy_terms">
                    <div class="fu-doc-icon" ng-click="downloadClubDocument(vm.club.settings.privacy_terms)">
                        <img src="{{get_icon(vm.club.settings.privacy_terms)}}" />
                    </div>
                    <div class="fu-doc-info">
                        <span class="fu-doc-name">Privacy Policy</span>
                        <span class="fu-doc-meta">Updated: {{vm.club.settings.privacy_updated | asDate | date:"dd MMM yyyy HH:mm"}}</span>
                    </div>
                    <div class="fu-doc-actions">
                        <a class="fu-doc-action fu-doc-download" ng-click="downloadClubDocument(vm.club.settings.privacy_terms)" title="Download"><i class="fa fa-download"></i></a>
                        <a class="fu-doc-action fu-doc-replace" flow-btn title="Replace"><i class="fa fa-refresh"></i></a>
                        <a class="fu-doc-action fu-doc-delete" ng-click="delete_file('privacy')" title="Delete"><i class="fa fa-trash"></i></a>
                    </div>
                </div>

                <!-- Uploading state -->
                <div ng-repeat="file in $flow.files" ng-if="!vm.club.settings.privacy_terms">
                    <div class="fu-doc-card fu-doc-uploading">
                        <div class="fu-doc-icon"><img src="{{get_icon(file.file)}}" /></div>
                        <div class="fu-doc-info">
                            <span class="fu-doc-name">{{file.name}}</span>
                            <div class="fu-progress" ng-if="(file.progress() * 100) < 100">
                                <div class="fu-progress-bar" ng-style="{width: (file.progress() * 100) + '%'}"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Empty state — drop zone -->
                <div class="fu-doc-empty" flow-btn flow-drop ng-class="dropClass" ng-if="!vm.club.settings.privacy_terms && $flow.files.length < 1">
                    <div class="fu-doc-empty-icon"><i class="fa fa-file-pdf-o"></i></div>
                    <span class="fu-doc-empty-label">Upload Privacy Policy</span>
                    <span class="fu-doc-empty-hint">PDF format &middot; Click or drag to upload</span>
                </div>
            </div>

          </div>


        <div class="club_docs_all">
              <h2>Accounting</h2>

              <div class="form-group">
                <label for="plane_class">VAT Accounting Ref</label>
                <input type="text" class="form-control inputtext" name="vat_accounting_ref" id="vat_accounting_ref" ng-model="vm.club.settings.vat_accounting_ref" />
              </div>

              <div class="form-group">
                <label for="plane_class">STRIPE Accounting Ref</label>
                <input type="text" class="form-control inputtext" name="stripe_accounting_ref" id="stripe_accounting_ref" ng-model="vm.club.settings.stripe_accounting_ref" />
              </div>

              <div class="form-group">
                <label for="plane_class">GOCARDLESS Accounting Ref</label>
                <input type="text" class="form-control inputtext" name="gcl_accounting_ref" id="gcl_accounting_ref" ng-model="vm.club.settings.gcl_accounting_ref" />
              </div>

              <div class="form-group">
                <label for="plane_class">Instructor Accounting Ref</label>
                <input type="text" class="form-control inputtext" name="instructor_accounting_ref" id="instructor_accounting_ref" ng-model="vm.club.settings.instructor_accounting_ref" />
              </div>

              <!-- <div class="form-group" ng-if="vm.club.member.instructor">
                <label for="plane_class">Instructor Accounting Ref</label>
                <input type="text" class="form-control inputtext" name="accounting_ref" id="accounting_ref" ng-model="vm.club.member.instructor_accounting_ref" />
              </div> -->

            </div>



        <!-- ── Aircraft Check Types ── -->
        <div class="club_docs_all">
          <h2>Aircraft Check Types</h2>
          <p class="help-block">Manage the types of pre-flight checks required for your aircraft (e.g. Check A, Transit Check). Aircraft must have "Requires Pre-Flight Check A" enabled on their profile for these to apply.</p>

          <div class="center_if_large">

            <!-- Loading -->
            <div ng-if="vm.check_types_loading" class="text-center">
              <i class="fa fa-spinner fa-spin"></i> Loading check types...
            </div>

            <!-- List of existing check types -->
            <div ng-if="!vm.check_types_loading && vm.check_types && vm.check_types.length > 0">
              <div class="card">
                <table class="table responsive_table">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th class="hide_on_mobile">Code</th>
                      <th class="hide_on_mobile">Description</th>
                      <th>Active</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr ng-repeat="ct in vm.check_types | orderBy:'display_order'">
                      <td data-label="Name">{{ ct.name }}</td>
                      <td data-label="Code" class="hide_on_mobile"><code>{{ ct.code }}</code></td>
                      <td data-label="Description" class="hide_on_mobile">{{ ct.description | limitTo:60 }}{{ ct.description.length > 60 ? '...' : '' }}</td>
                      <td data-label="Active">
                        <span class="badge" ng-class="{'badge-success': ct.is_active == 1, 'badge-default': ct.is_active != 1}">
                          {{ ct.is_active == 1 ? 'Active' : 'Inactive' }}
                        </span>
                      </td>
                      <td data-label="Actions">
                        <button class="btn btn-xs btn-info" ng-click="vm.editCheckType(ct)"><i class="fa fa-edit"></i> Edit</button>
                        <button class="btn btn-xs btn-danger" ng-click="vm.deleteCheckType(ct)"><i class="fa fa-trash"></i></button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div ng-if="!vm.check_types_loading && (!vm.check_types || vm.check_types.length == 0)" class="no_defects">
              No check types have been created yet. Add your first check type below.
            </div>

            <button class="btn btn-info ct-add-btn" ng-click="vm.openCheckTypeModal()">
              <i class="fa fa-plus"></i> Add Check Type
            </button>

          </div>
        </div>

        <!-- Check Type Modal Overlay -->
        <div class="ct-modal-backdrop" ng-if="vm.show_check_type_modal" ng-click="vm.closeCheckTypeModal()"></div>
        <div class="ct-modal" ng-if="vm.show_check_type_modal">
          <div class="ct-modal-header">
            <h3 ng-if="!vm.editing_check_type">Add New Check Type</h3>
            <h3 ng-if="vm.editing_check_type">Edit Check Type</h3>
            <button class="ct-modal-close" ng-click="vm.closeCheckTypeModal()"><i class="fa fa-times"></i></button>
          </div>
          <div class="ct-modal-body">
            <div class="form-group">
              <label for="ct_name">Name</label>
              <input type="text" class="form-control inputtext" id="ct_name" ng-model="vm.check_type_form.name" placeholder="e.g. Check A" />
            </div>

            <div class="form-group">
              <label for="ct_code">Code</label>
              <select class="form-control inputtext" id="ct_code" ng-model="vm.check_type_form.code"
                      ng-options="opt.value as opt.label for opt in vm.availableCodeOptions()"
                      ng-disabled="vm.editing_check_type && vm.isSystemCode(vm.check_type_form.code)">
                <option value="">-- Select a code --</option>
              </select>
              <p class="help-block" ng-if="vm.editing_check_type && vm.isSystemCode(vm.check_type_form.code)">
                <i class="fa fa-lock"></i> System code — cannot be changed.
              </p>
            </div>

            <div class="form-group">
              <label for="ct_description">Description</label>
              <textarea class="form-control inputtext" id="ct_description" ng-model="vm.check_type_form.description" placeholder="Explanation shown to pilots" rows="2"></textarea>
            </div>

            <div class="form-group">
              <label for="ct_active">Active</label>
              <input type="checkbox" class="form-control inputtext no_top_shadow" id="ct_active" ng-model="vm.check_type_form.is_active" />
            </div>

            <div class="form-group">
              <label for="ct_order">Display Order</label>
              <input type="number" class="form-control inputtext" id="ct_order" ng-model="vm.check_type_form.display_order" placeholder="1" />
            </div>
          </div>
          <div class="ct-modal-footer">
            <button class="btn btn-outline ct-modal-cancel" ng-click="vm.closeCheckTypeModal()">Cancel</button>
            <button class="btn btn-primary ct-modal-save" ng-click="vm.saveCheckType()">
              {{ vm.editing_check_type ? 'Update' : 'Add' }} Check Type
            </button>
          </div>
        </div>
        <!-- End Check Type Modal Overlay -->


             <div class="club_docs_all">
              <h2>Payment Integrations</h2>

                    <div class="form-group" ng-if="!vm.club.settings.stripe_id || vm.club.settings.stripe_id == ''">

                        <button class="btn btn-primary btn_bigger" ng-click="vm.generate_stripe_link()" ng-disabled="vm.called_stripe_setup">Setup Stripe Integration</button>

                    </div>
                    <div class="form-group" ng-if="vm.club.settings.stripe_id && vm.club.settings.stripe_id !== ''">
                        
                        
                        Stripe is already integrated - want to change it?
                        <br />
                        <button class="btn btn-danger btn_bigger" ng-click="vm.generate_stripe_link()" ng-disabled="vm.called_stripe_setup">Change Stripe Integration</button>
                    </div>

            </div>


<!--                 <button class="btn btn-danger btn_bigger bottom_btns" ng-click="save()">Save</button>
 -->                
                <div class="card center_if_large">
                    <div class="btns_bottom">
                        <button class="btn btn-info btn_bigger" ng-click="back()">Back</button>
                        <button class="btn btn-danger btn_bigger" ng-click="save()">Save</button>
                    </div>
                </div>
           
        </form>
    </div>
</div>