{"version":3,"sources":["controllers.js"],"names":["app","controller","AccountController","$inject","UserService","$rootScope","$location","vm","user","globals","currentUser","AddLicenceController","MemberService","InstructorService","MembershipService","HolidayService","$scope","$state","$stateParams","$uibModal","$log","$window","$compile","$timeout","uiCalendarConfig","BookingService","LicenceService","ToastService","licence_images","licence","images","ratings","GetLicenceTypes","then","data","licence_types","GetRatings","i","length","id","selected_rating","add_rating","GetAuthority","authority","$","grep","e","push","remove_rating","index","splice","popup","open","$event","opened","preventDefault","stopPropagation","formats","format","datePickerOptions","showWeeks","remove_file","file","current_files","j","JSON","parse","file_return","DeleteTmp","saved_url","success","processFiles","files","temp_path","save_licence","isValid","focus","warning","licence_type","state_of_issue","licence_id","authority_id","user_id","Create","error","message","AircraftJourneyLogsController","ClubDocumentService","PlaneDocumentService","$http","PlaneService","$sce","clubs","looking_for","registration","my_search2","defect_severity","defect_severities","title","GetAircraftJourneyLogs","plane_id","logs","aircraft","current_offset","loaded_per_batch","all_loaded","load_more","forEach","log","get_initial","text","charAt","clean_times","time","substring","round_brake_times","first","second","start_end","round_brake_times_end","input","earlier_input","indexOf","split","x","min_nearest_five","parseInt","esplit","ehour","emin","etot","hr","mn","tot","round_brake_times_start","filter_detail","show_all","status","get_icon","ft","name","pop","icon_name","get_icon2","search","row","angular","lowercase","my_search","convert_string_to_date","date","d","rtn","test_date","parsed_date","b","moment","search_type","c","c2","test_name","fname","lname","search2","toLowerCase","fullname","test_aircraft","replace","test_airfield","code","name2","code2","flight_date","first_name","last_name","departure_airport","departure_airport_code","destination_airport","destination_airport_code","getMySearchCount","str","docs","documents","total","getMySearchCount2","charges","get_hours_from_decimal","sign","hour","Math","floor","abs","min","round","downloadDocument","doc","type","param","ddd","get","responseType","headers","zipName","processArrayBufferToBlob","downloadClubDocument","list_pilots","p1","put","get_pic","get_put","getTrustedHtml","pic_first_name","pic_last_name","instructor_first_name","instructor_last_name","instructor_id","put_first_name","put_last_name","octetStreamMime","filename","contentType","blob","Blob","navigator","msSaveBlob","saveBlob","webkitSaveBlob","mozSaveBlob","undefined","ex","info","urlCreator","window","URL","webkitURL","mozURL","msURL","link","document","createElement","url","createObjectURL","setAttribute","event","createEvent","initMouseEvent","dispatchEvent","location","httpPath","AircraftStatusController","GetByUserMaintenance","add_defect","club_id","obj","defect","severity","AddDefect","item","can_delete","find","club","planes","plane","defects","delete_defect","DeleteDefect","GetOpenIssues","bookout","reported_defects","count_defects","counter","show_receipt_image","receipt","show_receipt","receipt_image","image","get_icon3","titlepath","path","prntWin","write","close","fileURL","AllDocumentsController","GetByUserId","membership_terms","updated_at","membership_updated","privacy_terms","privacy_updated","passenger_terms","passenger_updated","search3","membership_name","AllInvoicesController","PaymentService","show_pay_now","show_loading","last_invoice_opened","iconBank","iconCard","iconNew","iconTerm","donConfirm","methodLabel","paymentIntent","complete_invoice","default_payment","methods","subtitle","iconSvg","trustAsHtml","visible","savedCards","method","invoice_id","ProcessPayment","GetInvoices","invoices","console","close_pay_now","get_package_html","pack_obj","used_on","plane_type","validity","created_at","add","intro","show_payment_option","invoice","show_payment","send","GetMandate","cards","machine","convert_decimal_to_hours","number","decpart","minute","GetUpcoming","upcoming","invoice_number","plane_registration","club_title","toString","parseFloat","toFixed","show_more","process_payment_bits","payments","get_human_status","returned","downloadInvoice","AllPaymentsController","GetPayments","amount","get_human_method","ArtpiecesController","CategoryService","ArtpiecesService","FlashService","$routeParams","artpiece","categories","GetAll","artpieceId","GetById","artpieces","tempAddCategory","category","tempDeleteCategory","cat","AddCategory","DeleteCategory","category_id","addArtpiece","trim","highlightField","editArtpiece","Update","deleteArtpiece","Delete","addCategory","add_one","new_category","cats","deleteCategory","BookinController","FoxService","$interval","BookoutService","$filter","InstructorCharges","InvoicesService","PackageService","CourseService","$anchorScroll","smoothScroll","EnvConfig","booking","wgs_n","wgs_e","split_flight","show_takeoff_landing_times","change_booking","show_change_plane","start","passengers","pic","this_pls_id_raw","instructors","pics","instructor_charges","club_courses","can_authorise","dateFormat","setting_new_member","flight_times_complete","calculated_invoice","scroll","previous_invoice","claim_a_flight","claimed_flight","auto_claim","ignore_next_tuition_change","get_currency","iso_code","currencies","get_airfields","GetAirfieldsByCode","airfields","GetAirfields","original_bookout","reset_claim_my_flight","different_date_warning","calculate_invoice_for_flight","has_used_claimed_flight","where_to","payer_id","pic_id","split_flight_confirmation","book_in_flight","claim_my_flight","force","this_claim_was_instructional","this_was_instructional_claim","Object","assign","from_airfield","from_airport","to_airfield","to_airport","touch_and_go","selected_detail_type","flight_types","flight_type","brakes_off_rounded","brakes_on_rounded","brakes_off","brakes_on","landings","full_stop_landings","stops","fox_log_id","fox_claimed","takeoff_time","landing_time","takeoff_rounded","landing_rounded","claimed_fox_plane_log_sheet_id","flight_units","brakes_to_brakes","brakes_time","airborne_times","airborne_time","flight_time","brakes_times_rounded","plane_charges","charge_type","booking_id","update_pic","selected_pic","GetPackagesByUserId","packages","items","GetUpdatedCharges","put_id","instructor","complete_flight","complete_this_flight","update_put","selected_put","update_instructor","selected_instructor","biggin_hill","routes","parking","flight_rules","split_this_flight","split_send","split_flight_time","this_pls_id","HypotheticalFlightSplit","split_one","first_flight","split_two","second_flight","cancel_split","process_bookout_to_bookin","update_split","pls_id","which","compared_to","compare_date","this_date","Date","split_time","setHours","setMinutes","setSeconds","isAfter","disabled","start_times","all_times","k","currency_days","dateTimeRangePickerOptions","hour_step","minute_step","min_date","business_hours","from","to","dateTimeRangePickerOptions2","options","lubricant_type","who_paid","quantity","price","reimbursement","update_course","course","GetByCourseId","tuition_required","update_tuition_charges","GetByClubId","tuition_charges","tuition_id","delete_receipt","DeleteReceipt","rcpt","GetAllSheetReceipts","lubricant_receipts","check_reimbursement","currency","CheckReimbursement","reimbursed_amount","reimburse","reimbursed_currency","reimbursed_rate","rate","reimbursed_datetime","datetime","add_receipt","plane_log_sheet_id","AddReceipt","check_business_hours","this_step_disabled","split2","end_times","takeoff_times","landing_times","figure_out_steps","duration","copy","init_times","get_duration_str","seconds","days","hours","minutes","string","calculate_my_brakes_duration","start_date","start_datetime","start_time","end_datetime","end_date","end_time","difference","startOf","diff","human_str","calculate_duration","calculate_airborne_duration","calculate_after_landing_duration","meter_units","end_tacho","start_tacho","confirm_split","try_split","before_split_bookout","tng","remote_landings","course_id","authorised_solo","brakes_times","calculate_my_airborne_duration","asHours","bstart_datetime","bstart_time","bend_datetime","bend_time","update_dateTime","check_relative_date","relative","isSame","check_times","a","getHours","getMinutes","future","start_after_end","some","booking_today","add_hour_to_end","which_update","setTimeout","pre_select_value_id","current","action","GetForBookIn","booked_in","go","reload","unclaimed","GetAllByPicsBookinout","GetAllByClubInstructor","GetPackagesForBookout","this_was_a_supervised_solo","this_was_supervised_solo","preselect_course_and_tuition","applyFilter","model","filter","pieces","filterName","params","slice","join","concat","apply","tacho_error_highlight","check_tacho_bigger","free_flight","charge_rate_unit","surcharge_fee","landing_fee","touch_and_go_fee","plane_units","tpc_aircraft_surchages","tpc_flight_time","package_removed","package_used","remaining_hours_dual","rem","solo_dual","member_packages_id","hours_dual_before","hours_dual_spent","hours_dual_remaining_after","hours_solo_remaining_after","remaining_hours_solo","package_id","hours_solo_before","hours_solo_spent","plane_total","surcharge_units","surcharge_type","surcharge_total","landing_units","landings_total","tg_units","tng_total","tuition_charge_type","tuition_price","tuition_total","tuition_units","total_to_remove","receipts","Number","invoice_totals","previous_total","plane_charge_type","plane_unit_price","surcharge_charge_type","surcharge_unit_price","landing_unit_price","landing_total","tng_units","tng_unit_price","tuition_unit_price","isNaN","club_id_confirmed","user_id_confirmed","membership_id","GetMemberCards","compile_invoice","uuint","hours_type","unit_price","organise","unit","org","payment","flag_flight","oil","fuel","total_landings","confirm","start_tacho_orig","is_dual_flight","authorised_by","bookout_user_id","bookout_instructor_id","to_airport_id","pay_with","method_name","plane_log_sheet","dual_flight","detail_type_id","from_airport_id","tacho_start","tacho_end","oil_uplift_litres","fuel_uplift_litres","original_id","booked_in_by","paying_now","new_to_airport","new_from_airport","airborne_rounded","pilot_in_command","home_airport_id","last_tacho","is_split_flight","is_split_complete","BookInFlight","after_where_to","after_data","paymentID","payment_id","show_cardmachine","poll_check_payment","result","stop_polling","after_success_bookin","check_payment","card_processor","stripe","Stripe","getStripeKey","confirmCardPayment","client_secret","payment_method","return_url","card_url","CheckPayment","close_machine_popup","ClearMachine","show_after_bookedin","cancel_machine","close_bookedin","reset_card_machine","RetryPaymentMachine","maxAttempts","finalCallback","attempts","attempt","get_update_on_cardmachine","retry","limit","callback2","callback","split_next_id","split_booking_id","selected_course","GetCurrencies","club_currency","access","manager","maintenance_flight","GetAllByBooking","keys","flights","key","flight","plane_details","location_default","has_requested_to_change_times","GetCoursesByClubId","toTop","Bookings2Controller","defaultStartTime","defaultEndTime","va1","allUsers","page_title","member","imported_new_headers","see_booking","is_current","currency_type","booking_self","times_clean_type","club_timezone","is_edit_show_all","return_to","bookingPanelOpen","toggleBookingPanel","bookWithInstructor","now","startDate","endDate","new_booking","show_self_option","start_iso","toISOString","end_iso","GetAllPlanes","allPlanes","planePromises","matchedPlanes","promise","GetPlaneInstructors","found","inst","completed","p","no_show_cols","newDate","h_start","i_start","h_end","i_end","defaultStart","getFullYear","getMonth","getDate","defaultEnd","default_date","datepickerOptions","customClass","getDayClass","startingDay","today","datepicker","minDate","whole_day_booking","cancellation","reasons","notes","end","datepicker_today","free_seats","toggle","whentimechangedata","overridePicker","update_bookings","GetEdit","edit_booking","toDate","after_booking_end","$parent","fullCalendar","w","css","width","offsetEvent","animate","scrollLeft","$apply","generate_datetimes","courses","prepare_add_edit","rental_items","free_places","show_no_membership_message","hide_dropdown","GetUserClubs","getAllPlaneUpdate","back","history","test","updateEvents","all_events","events","all_resources","resources","eventRender","element","view","attr","alertOnClicked","calEvent","jsEvent","toUTCString","close_details","changeLang","uiConfig","calendar","dayNames","dayNamesShort","changed","check_plane_availability","j_changed","getA","start_dt","end_dt","reset_chosen","check_rental_items","mode","dayToCheck","currentDay","addOne","resourceObj","add_booking_event","cancel_changes","GetRentalItems","clean_type","unix","getPlaneInstructors","instructor_first_booking","booking_start","s_date","s_time","n_start","e_date","e_time","n_end","new_event","already_added_temp","times","decline_new_booking_error","new_booking_errors","override_new_booking_errors","admin_override","make_booking","update_booking","valid","jQuery","extend","constructor","Array","isBefore","resourceId","changed_to_waiting_list","override","check_before_changing_event","update_club","change_club","alertOnEventClick","alertMessage","alertOnDrop","delta","revertFunc","ui","resourceIds","alertOnResize","override_booking_change","error_event","override_booking_change2","decline_booking_change","booking_errors","err","evnt","_start","_end","_id","source","_allDay","allDay","className","editable","update_rental_items","original_event","updateBooking","errors","api","can_override","button","check_user","wholeDay","myDatetimeRange","changeView","calendars","renderCalender","add_rental_item","rental_item","add_to_list","delete_this","rental_item_remove","booking_club_id","booking_admin","GetPlaneInstructorsEdit","GetIfCurrent","requirements","seats","clear_booking","submitted","seats_in_plane","no_seats","invite_new_passenger","new_pax","email","is_member","invited_by","AddPassenger","update_passenger_list","show_new_passenger_invitation","add_new_passenger","not_found","close_passenger_invitation","set_new_member","get_pax_class","new_passenger_invite_ready","email_regex","remove_passenger","cancel_booking","prompt","DeleteBooking","get_all_members","GetAllByClub","members","all_members","invite_passenger","passenger_membership_id","refresh_passenger","GetInvite","invitation_token","GetPassengers","resend_invitation","to_resend","ResendInvitation","refresh_all_passenger","next","get_passenger_status","cid","bed","bed2","GetAllActiveByClub","remove_invite","init_passengers","pax_invited","pax","get_passenger_status_edit","get_members","GetAllByClubAndName","filtered_array","ar","rm","splits","save","create","update","mytime","select_plane","val","onInstructorPlaneSelected","savedInstructor","start_split","end_split","get_times","tofrom","m","y","h","default_end","luxon","DateTime","fromISO","plus","toISO","String","isInstructorRow","instructorUserId","GetInstructorByUser","instructorData","GetInstructorPlanes","planesData","calendarOptions","initialView","calendarEvents","validateBookingFields","prev","querySelectorAll","classList","remove","checks","ok","label","getElementById","scrollIntoView","behavior","block","missingField","booked_by_admin_instructor","booked_by","more","addon","allow_override","reason","popup2","popup3","popup4","open2","open3","open4","member_id","modalInstance","animation","templateUrl","size","resolve","warning_msg","BookingsController","toIsoString","adding_a_member","no_of_seats","to_remove","DeleteInvitation","BookoutController","$cookieStore","AuthenticationService","current_tacho","estimated_fuel","consumption","last_position","amend_booking","accept_defects","reject_defects","user_obj","ChangeInvitation","InvitePassenger","invite","extra_information_required","filing_flightplan","GetForBookout","GetByIdMaintenance","process_booking_to_bookout","licence_issue_date","licence_expiry_date","rating_id","expiry_date","user_licences","licences","base64ToBlob","base64","binaryString","atob","len","bytes","Uint8Array","charCodeAt","show_file_now","show_file_url","show_file","close_file","insurance","certificate","radio_licence","maintenance","days_remaining","hours_remaining","days_to_expiry","GetChargesByCourseId","lesson_id","selected_location","selected_airfield_check","bookout_plane","bookout_obj","is_pilot_current","booked_out","endurance_time","endurance","estimated_enroute_time","en_route","flight_rule","flight_notes","additional_details","parking_note","estimated_departure","departure","routing_via_id","routing_via","SendBookout","remove_real_file","delete_licence","data_uri","logout","Logout","ClearCredentials","localStorage","removeItem","go_flying","CategoriesController","myModel","myUpdateHandler","ClaimAFlightController","activeView","setView","aircraftList","selectedAircraft","allFlights","onAircraftSelected","clearAircraftFilter","buildHelperLists","to_claim","entry","club_name","from_airfield_code","from_airfield_name","to_airfield_code","to_airfield_name","airborne_seconds","number_landings","takeoffs_landings","sort","dateA","dateB","match","aircraftFilter","initController","GetFoxEntries","difference_times","to_datetime","from_datetime","difference_times_decimal","airborne_decimal","airborne_to_hours","ClubDocumentsController","current_club_admin","uploaded_document","document_id","club_documents","save_name","extension","the_file","to_send","my_file","description","doc_id","ClubPaymentsController","PoidService","poid_images","poid","customer_token","get_addresses","GetAddresses","postcode","addresses","card_id","ClubSignupController","ClubService","GoCardService","$cookies","companies","selected_company","selected_phone","verified_mobile","text_verification","check_id","prefix","countries","loc","last","pre","Verify","response","mid","bid","SetupGoCard","go_to_login","verify_mobile","VerifyPhone","get_companies","GetCompany","prefix_length","set_prefix","set_company","GetCompanyDetail","company_number","company","sort_company_data","formData","is_company","phone","officers","officer","company_details","user_is_named_on_company_selected","matched","company_name","trading_as","date_of_creation","address_line_1","registered_office_address","address_line_2","city","locality","post_code","postal_code","dob_year","date_of_birth","year","dob_month","month","role","officer_role","setup_direct_debit","checkValid","password","password2","removeClass","addClass","strongPassword","RegExp","checkValidity","not","CountryCode","mobile","tnc","processForm","html","defaults","common","CreateGalleryController","ImagesService","KeywordsService","LocalDataService","GalleryService","gallery","is_protected","download_low","download_medium","download_high","gallery_link","fullscreen","all_galleries","selected_images","remove_image","SetSelectedImages","check_link_unique","generate_gallery","DashboardClubAirframeLogbookController","MedicalService","DifferencesService","LogbookLinkService","WorkpackService","GetByIdMaintenance2","this_plane_id","next_check","next_maintenance","check_date","extension_granted","prop_no","getAge","dateString","birthDate","age","GetAirframeLogs","update_logbooks","UpdateAircraftLogbooks","maintenanceTypeLabels","formatMaintenanceType","isMaintenanceEntry","entry_type","getEntryType","getEntryPosition","entry_position","getHoursRemainingClass","hoursRemaining","formatHoursRemaining","selected_check","show_check_detail","check_logbook_links","check_logbook_loading","check_logbook_error","check_workpack","check_workpack_loading","viewMaintenanceCheck","checkData","maintenance_check","checkId","maintenance_check_id","loadCheckLogbookLinks","loadCheckWorkpack","closeMaintenanceCheck","GetAvailableLogbooks","availData","available","available_logbooks","GetLinks","linkData","links","logbook_links","map","lb","isLinked","logbook_type","logbook_entity_id","position","wpId","linked_workpack_id","workpack_id","workpack","downloadWorkpackDocument","getLogbookIcon","getCheckTypeIcon","update_this_file","plane_documents","radio","cert","processFile","fft","set_title","delete_poid","save_plane_documents","change_file_name","club_plane_id","entry_date","DashboardClubCourseController","course_document","course_documents","course_certificate","course_noise","course_radio","course_maintenance","course_insurance","lessons","exams","tags","editing","edit_course","GetCourseById","GetLessonsByCourseId","refresh_exams","refresh_tags","refresh_charges","GetExamsByCourseId","GetTagsByCourseId","clearFieldError","field","validateForm","save_lesson_order","update_order","me","UpdateLessonOrder","delete_lesson","DeleteLesson","update_exam","exam","edit_me","UpdateExam","update_cancel","edit_exam","delete_exam","DeleteExam","add_exam","new_exam","CreateExam","update_tag","tag","UpdateTags","update_cancel_tag","edit_tag","delete_tag","DeleteTags","add_tag","new_tag","CreateTags","update_charge","charge","UpdateCharge","update_cancel_charge","edit_charge","delete_charge","DeleteCharge","add_charge","new_charge","CreateCharge","delete_course","DeleteCourse","CreateCourse","get_update_docs","UpdateCourse","containsObject","list","count_success","add_item","temporary","rating","add_licence","licence_title","abbreviation","rating_title","medical_authority","medical_component","add_medical","authority_title","medical_component_id","medical_component_title","medical","add_difference","difference_id","difference_title","differences","noise","DashboardClubEngineLogbookController","GetEngineLogs","engine_id","engine","DashboardClubExperienceDiscountsController","ExperiencesService","plane_document","experiences","GetDiscountsByClubId","check_code","experience","discount_type","discount_code","percentage","experience_id","CreateDiscount","DeleteDiscount","UpdateDiscount","check_all","remove_item","DashboardClubExperiencesController","valid_for","booking_duration","DashboardClubFlightsController","currency_types","gear_types","certificates","value","classes","to_date","from_date","setMonth","GetAllFlightsByClub","selected_aircraft","totals","airframe_hours","vp","rg","tb","plane_engine_1","engine_1","plane_engine_2","engine_2","plane_propeller_1","propeller_1","plane_propeller_2","propeller_2","my_return","set_aircraft_details","GetAddAircraft","plane_search","processNewAircraft","manufacturer","serial_no","serial_number","icao_type","type_name","year_built","aircraft_id","mtow","noise_level","regex","plane_noise","v","noise_cert_issue","aircraft_class","is_propeller","engine_name","plane_class","number_of_engines","gear_type","plane_maintenance","cofa_category","certificate_expiry","cofa_expiry","make","propeller_manufacturer","propeller_name","number_of_engine","update_ac","search_for_flights","add_documents","maintenance_type","plane_radio","plane_insurance","noise_cert","update_documents","save_new_aircraft_bit","num","comb","comb2","item_update","removed_date","old_item","new_item","no","UpdateAircraftBit","plane_to_add","get_aircraft","toUpperCase","DashboardClubFlyingController","payment_now","sortType","sortReverse","searchTool","memberships","GetIncompleteClub","bookouts","get_pax_html","flight_obj","nok","relationship","phone_number","email_address","telephone_number","nok2","instructor_nok","noks","nok1","user_nok","load_adsb","icao_hex","cancel_bookout","CancelBookout","DashboardClubInstructorBookings","edit_instructor","rgbaToHex","rgba","inParts","r","g","outParts","part","hexToRGBA","hex","opacity","save_instructor","new_colour","instructor_colour","new_booking_colour","booking_colour","edit","UpdateInstructor","save_instructor_order","display_order","UpdateOrder","colour","bg_colour","DashboardClubInstructorChargesController","DashboardClubInvoicesController","GetClubInvoices","quick_select","base_date","yesterday","sevendaysago","thirtydaysago","setDate","getMonday","day","getDay","getSunday","sunday","firstDay","lastDay","lm_firstDay","lm_lastDay","quick_selects","update_qs","update_date_range","DashboardClubItemsController","ItemService","item_id","cost","number_available","cost_schedule","DashboardClubLessonController","lesson","lesson_document","lesson_documents","lesson_certificate","lesson_noise","lesson_radio","lesson_maintenance","lesson_insurance","lessonContentTab","contentFiles","uploadQueue","uploadProgress","isUploading","dragOver","pdfSelector","active","fileName","pages","totalPages","selectedPages","loading","new_tem","threat","consequence","mitigation","preflight","bullet_format","airex","debrief","GetLessonById","refresh_tem","refresh_bullets","refresh_items","refresh_content_files","GetBulletsByLessonId","bullets","GetTemByLessonId","tem","add_tem","CreateTem","update_tem","UpdateTem","edit_tem","delete_tem","DeleteTem","add_bullet","send_me","bullet_type","CreateBullet","update_bullet","bullet","UpdateBullet","update_cancel_bullet","edit_bullet","delete_bullet","DeleteBullet","save_bullet_order","UpdateBulletOrder","save_items_order","UpdateItemsOrder","save_tem_order","UpdateTemOrder","GetItemsByLessonId","CreateItem","update_item","UpdateItem","update_cancel_item","edit_item","delete_item","DeleteItem","CreateLesson","UpdateLesson","GetLessonContentFiles","_loading","GetLessonContentFileData","res","file_base64","_loadError","switchContentTab","tab","triggerFileInput","click","onFileInputChange","handleSelectedFiles","fileList","allowedTypes","maxSize","openPdfSelector","addImageToQueue","$applyAsync","reader","FileReader","onload","preview","target","isPdf","pdfPages","readAsDataURL","removeFromQueue","typedArray","pdfjsLib","getDocument","pdf","numPages","renderPromises","renderPdfPage","Promise","all","readAsArrayBuffer","pageNum","getPage","page","scale","viewport","getViewport","canvas","context","getContext","height","render","canvasContext","thumbnail","toDataURL","selected","togglePdfPage","confirmPdfPages","selectedThumbnails","pdfThumbnails","closePdfSelector","uploadAllFiles","uploadPromises","uploadSingleFile","queueItem","FormData","append","stringify","UploadLessonContentFile","Error","save_content_files_order","UpdateLessonContentFilesOrder","order","deleteContentFile","DeleteLessonContentFile","replaceContentFile","existingFile","accept","onchange","replacingFileId","UpdateLessonContentFile","formatFileSize","sizes","pow","getFileTypeIcon","fileType","DashboardClubMaintenanceController","CrsService","show_overlay","show_cert","show_maintenance","show_radio","show_noise","show_insurance","show_offline","show_crs","crs_records","issues","issue_confirmation","maintenance_types","workpacks","open_workpacks","new_workpack","show_create_workpack","show_workpack_detail","workpack_files","workpack_doc","defect_workpack_files","defect_wp_doc","show_link_defect","show_link_maintenance","show_defect_workpack","selected_defect_for_wp","defect_wp","maintenance_events","selected_event","show_event_detail","event_filter","event_logbook_links","logbook_checkboxes","saving_logbook_links","logbook_load_error","create_logbook_checkboxes","create_logbook_loading","create_logbook_error","loadMaintenanceList","GetAllByClubMaintenance","loadMaintenanceDetail","GetByPlane","GetOpenByPlane","GetMaintenanceEvents","isArray","deregisterStateChange","$on","toState","deregisterListChange","reset_aeroplane","ResetOneClubPlane","selected_type","send_obj","loadCreateLogbooks","close_overlay","save_overlay","send_update","one_ticked","resolved","radio_expiry","expiry","date_issued","certificate_issue","insurance_expiry","noise_date","crs","crs_release_date","crs_release_time","crsPayload","release_date","release_time","check_time","checked_by","workpack_option","extension_hours","extension_days","offline_until","offline_notes","offline","saveDefectWorkpacks","workpackId","def","_link_to_workpack","LinkDefect","defect_workpack_number","defect_workpack_signatory","_uploaded_file","payload","workpack_number","signatory","document_temp_path","document_extension","document_original_name","UpdateDefectWorkpack","saveCrs","cb","AddMaintenance","saveCreateLogbookLinks","wp","authorised_signatory","created_by_user_id","f","wpData","check_ticked","count","close_cert","save_cert","close_insurance","save_insurance","close_radio","save_radio","close_noise","save_noise","close_maintenance","save_maintenance","getColours","loadWorkpacks","loadOpenWorkpacks","createWorkpack","viewWorkpack","closeWorkpackDetail","updateWorkpack","completeWorkpack","reopenWorkpack","deleteWorkpack","uploadWorkpackDocument","removeWorkpackDocument","remove_document","linkDefectToWorkpack","defect_id","unlinkDefect","UnlinkDefect","linkMaintenanceToWorkpack","LinkMaintenance","unlinkMaintenance","UnlinkMaintenance","openDefectWorkpack","closeDefectWorkpack","saveDefectWorkpack","planeData","loadCrs","plane_crs","deleteCrs","downloadCrs","DownloadFile","saveCrsStandalone","processWorkpackFile","processDefectFile","loadMaintenanceEvents","viewEvent","_check_date","_expiry_date","_check_time","loadLogbookLinks","closeEventDetail","saveEvent","checkDateTime","UpdateMaintenanceEvent","getEventTypeIcon","getEventTypeLabel","selectedLogbooks","BulkLink","toggleCreateLogbook","checked","l","loadAvailableLogbooks","saveLogbookLinks","countCheckedLogbooks","toggleLogbook","DashboardClubMemberRequestsController","NokService","requests","auto_renew","update_requests","GetRequestsByClub","show_memberships","accept_request","ClubAcceptRequest","decline_request","ClubDeclineRequest","this_req","delete_request","DeleteRequest","resend_request","ResendRequest","request_id","DashboardClubMembersController","GetInvoicesUserClub","current_invoice_offset","add_credit_amount","add_credit_note","show_add_credit","membership_start","is_manager","approved","GetByUserIdClub","poids","medicals","sign_off_date","night","vfr","ifr","differences_images","GetPackagesByUserIdAndClubId","change_package","calculate_change","new_percent","slider_val","slider_value","dual_percent","dual_hours","remaining_price","initial_dual_price","dual_price","remaining_solo_hours","initial_solo_price","solo_number","dual_number","solo_price","show_package_change","show_package_popup","slider","hours_dual","hours_solo","solo_hours","hours_dual_remaining","hours_solo_remaining","base","remaining_ratio","percent","hide_package_change","refund_package_to_credit","check","RefundPackageToAccount","save_package_change","SwapPackageHours","change_numbers","add_credit","close_credit","apply_credit","obj_to_send","vat","is_credit_from_admin","direct_debit","credit_only","CreateCustom","all_invoices_loaded","GetUserJourneyLogs","load_more_invoices","GetMemberPlanes","checkAll","selectedAll","csvToJSON","content","lines","csv","columnCount","separator","header","imported_headers","currentline","apply_default_memberships","imported_users","membership","default_membership","parseLooseDate","opts","prefer","useUTC","utc","prototype","call","getTime","isFinite","dNum","s","looksAmbiguousSlash","native","parts","datePart","timePart","every","n","normalizeYear","hh","mm","ss","mTime","dt","UTC","y2","getUTCFullYear","m2","getUTCMonth","d2","getUTCDate","change_header","parse_me","apply_default_start","stripDoubleQuotes","processData","tobesorter","import_users","test_mode","test_e","test_mail","matching","user_columns","dob","membership_number","matching_email","import_column","member_check","check_member_requirements","update_verification","verify","to_import_users","CreateMany","sa_dual","sa_solo","sa_instruct","select_all","select_all_what","book_dual","book_solo","instruct","deselect_all","parent","closest","highlightAndScrollTo","fieldId","highlighted","invite_member","selected_membership","send_invite_by_club","process_member_start_dt","SaveMemberPlanes","refresh_members","select_member_approval","selected_members","update_membership","actually_open","document_type","verified","action_name","show_temp_login","create_sample","characters","charactersLength","random","re_login","Login3","re_login_pass","openDocument","maybe","doc_type","fail","DashboardClubMembershipsController","account_currency","passenger_only","passenger_only_default","GetAllMembershipPlanes","club_planes","membership_planes","payment_term","plane_access","send_planes","tacho_hour_fee","membership_tacho_hour_fee","membership_landing_fee","membership_touch_and_go_fee","UpdateMembershipPlanes","previous_price","update_price","DashboardClubPackagesController","planes_original","GetPackageById","GetPackagePlanesByPackageId","clean_aircraft_selection","GetPackagesByClubId","refresh_aircraft","pkg","delete_aircraft","DeletePackagePlane","new_aircraft2","new_aircraft","add_aircraft","CreatePackagePlane","decimal_time","temp","DeletePackage","CreatePackage","UpdatePackage","DashboardClubPaymentsController","ClubPaymentService","GetPaymentsByClub","get_payment_description","refund","to_refund","amount_refunded","Refund","DashboardClubPlanesController","plane_certificate","plane_engine_1_replace","plane_engine_2_replace","plane_propeller_1_replace","plane_propeller_2_replace","show_replace_engine_1","show_replace_engine_2","show_replace_prop_1","show_replace_prop_2","medical_authorities","GetComponents","medical_components","GetDifferences","save_planes_order","total_hours_at_start","date_fitted","tbo_hours","disable_reset","disable_reset2","fix_uncombined","FixUncombinedLogs","reset_all_club_logs","ResetAllClubPlanes","DashboardClubPropellerLogbookController","GetPropLogs","prop_id","propeller","DashboardClubReceiptsApprovalController","GetReceiptsApproval","verify_reimbursement","modified_price","UpdateReceipt","modified_currency","modified_reimbursed_amount","modified_reimbursed_difference","requested_at","modified_reimbursed_rate","modified_reimbursement_tooltip","added_currency","reimbursing","update_currency","update_invoice_no","update_qty","modified_quantity","approve_receipt_final","ApproveReceipt","findIndex","show_popup","current_receipt","reject_receipt_final","RejectReceipt","approve_receipt","reject_receipt","close_popup","DashboardClubReceiptsController","GetReceiptsClub","loaded_per_batc","DashboardClubSettingsController","settings","vat_registered","vat_rate","stripe_id","SaveStripeLink","RefreshStripeLink","update_text","address","vat_number","update_logo","logo","update_invoice_logo","invoice_logo","privacy_file","membership_file","passenger_file","gcl","salt","pepper","called_stripe_setup","generate_stripe_link","GenerateStripeLink","onboarding_link","term_documents","processFiles2","delete_file","filetype","to_delete","DashboardClubShopItemsController","ShopItemService","DashboardClubShopSaleController","club_settings","new_client","selected_client","selected_card","selected_voucher","show_direct_debit_details","custom_item","complete_now","shop_items","vouchers","discounts","unshift","calculate_charges","card_selected","member_selected","account_ending","selected_item","item_selected","package_selected","selected_package","new_item_qty","add_selected_voucher","voucher_id","add_me","selected_discount","discount_id","GetDiscountsByClubIdAndExperienceId","add_selected_discount","new_price","discount","add_selected_item","add_selected_package","item_sent","the_vat","this_vat","the_total","CompleteCustom","cancel","DashboardClubVouchersAddController","VoucherService","show_paid","GetUniqueCode","getStripeKeyLegacy","elements","card_options","hidePostalCode","style","iconColor","color","lineHeight","fontWeight","fontFamily","fontSize","card","form","timeout","run","run2","setupStripe","clearTimeout","mount","addEventListener","createToken","stripeTokenHandler","token","hiddenInput","appendChild","already_paid","price_paid","experience_title","address_zip","errorElement","textContent","brand","last4","hash","exp_month","exp_year","funding","address_postcode","client_ip","update_experience","update_discount","DashboardClubVouchersController","DashboardClubVouchersEditController","CancelVoucher","DashboardController","CheckLoggedIn","bookings","to_pay","to_complete_split","force_show_admins","GetAdminClubs","savedClubId","stored","getItem","selectedClub","setItem","onClubSelected","load_bookings","GetTodayBookingsUser","GetBookoutsToComplete","DashboardCourseSyllabusController","load_course","load_lesson","GetCoursesByUserId","DashboardCourseSyllabusViewController","contentFilesLoading","activeContentFile","load_content_files","selectContentFile","hasContentFiles","hasSectionContent","section","DashboardInstructorBriefController","current_club_instructor","selected_lesson","GetBookingsToBrief","briefings","GetBookingsToDebrief","show_split","GetForForDebriefPls","competences","record_club_id","all_items","student","log_sheet","all_lessons","selected_debrief_lesson_obj","all_tags","selected_flight_tags","GetForForDebrief","show_whole_lesson","show_all_lessons","tag_full_flight","update_flight_tag","update_flight_full_flight","tag_flight_time","show_whole_course","set_updated_search","save_progress","compiled_items","remarks","general_remarks","next_lesson","lesson_completed","compiled_save","completed_by","next_lesson_id","flight_tags","CreateTrainingRecord","flight_tag","logging_time","tag_time_to_five","save_edit_record","selected_lesson_obj","pending_debrief_lesson_obj","show_lesson_switcher","change_lesson","confirm_debrief_lesson_change","change_debrief_lesson","cancel_debrief_lesson_change","newItem","exists","existing","go_book_out","set_briefed","briefed","SetBookingToBriefed","DashboardStudentRecordsController","instructor_clubs","selected_club","load_students_for_club","student_id","GetAllForUser","update_club_selector","show_record","show_add_exam","onInstructorClubSelected","GetAllByClubStudents","load_records","GetStudentTrainingRecords","training_records","exam_records","course_totals","course_hours","log_sheets","my_search3","load_records_user","load_selected_flight","flight_id","add_exam_record","CreateExamRecord","get_remarks","record","object","lesson_item_id","get_result","grade_name","get_result3","get_competence","icons","icons2","grade_colour","grade_icon","get_competence2","get_flight_date","user_can_edit","get_record_details","record_details","completed_by_first_name","completed_by_last_name","get_record_details2","get_exam","exam_id","open_training_detail","show_edit_training_record","show_popup_name","flight_detail_id","user_can_edit_record","selected_flight","selected_record","selected_record_remarks","GetStudentTrainingRecordsForFlight","this_entry","show_edit_record","flight_tag_id","tag_time","is_lesson_completed","update_record_id","edited_by","edit_reason","UpdateTrainingRecord","DashboardUserInstructorController","hstep","mstep","from_variable","to_variable","disabled_variable","timezone","from_default","to_default","GetAvailability","available_times","setZone","toHTTP","selected_now","available_time","ismeridian","toggleMode","update_time","changed_time","disable_time","save_club_times","SetAvailability","allText","DashboardUserInstructorHolidayController","step","minRange","hours24","myDatetimeLabels","toggleDirective","whenTimeChange","timeRangePicker","dateRangePicker","_today","_yesterday","datePickerWithRange","max","addRemoveEventSource","sources","canAdd","addEvent","myFrom","myTo","delete_id","schedulerLicenseKey","left","center","right","slotEventOverlap","eventClick","eventDrop","eventResize","eventSources","FinishAndPayController","getShort","complete","GetAllByPics","PayBooking","show_add_card","GalleriesController","galleries","SetAllGalleries","selecting_for","fadeIn","edit_gallery_images","SetSelectingFor","save_images","images_to_save","fadeOut","save_gallery","check_gallery_link","generate_gallery_link","link2","duplicate_gallery","new_gallery","downloaded","delete_gallery","HomeController","deleteUser","loadCurrentUser","loadAllUsers","users","ImagesController","filters","all_artpieces","imageId","GetOne","one_image","keywords","keyword","all_keywords","init","select","update_selected_state","update_image_list","get_tags","filtering","filter_array","multi_level_filter","loop_content","$emit","current_category","change_category","artpieces_array","artpiece_filter","update_list","state","add_image","save_btn_text","url_save","editImage","loadClasses","loadTags","query","ab","startsWith","text_to_lower","deleteImage","InvitationsSignupController","sendVerification","total_invite","first_payment","redirect_flow_id","mandate","session","member_accepted","SetupMandate","add_element","bit_type","license","add_to","remove_element","Boolean","check_user_is_valid","membership_request_id","invitation","InviteSignup","uisref","gonext","VerifyInvitedUser","VerifyPhoneInvite","KeywordController","JSTagsCollection","jsTagOptions","suggestions","Bloodhound","datumTokenizer","tokenizers","whitespace","identify","queryTokenizer","prefetch","initialize","exampleData","displayKey","ttAdapter","exampleOptions","hint","highlight","CheckContent","KeywordsController","addKeyword","new_keyword","deleteKeyword","LoginController","login","login_session","login_key","Login0","dataLoading","Login1","Login2","loginTimeoutFired","loginTimeout","warn","SetCredentials2","returnUrl","login0Response","ManageAccountController","avatar","address_line1","show_addresses","show_address","show_search","update_avatar","show_form","set_address","line1","address_line2","line2","address_line3","line3","address_line4","line4","address_locality","address_city","address_county","county","address_country","country","save_user","new_password","new_password2","show_error","ManageDifferencesController","all_differences","clean_differences_list","el","differences_id","add_differences","selected_differences","remove_differences","save_differences","ManageLicenceController","blurred","getDecrypted","ManageMedicalController","medical_images","components","GetMedicalTypes","medical_types","medical_id","examination_date","component_id","user_medicals","add_component","selected_component","remove_component","delete_medical","save_medical","medical_type","ManageMyMembershipsController","GetOneForUser","membership_now","default_card","GetRequestsById","request","GetUserMemberships","GetRequestsByUser","set_club","GetAllByClubAvailable","set_default_payment_method","default_payment_method","UpdateOneByUser","make_default_card","UpdateDefaultCard","delete_member_card","DeleteMemberCard","set_membership","show_confirmation","set_card","accept_it","club_tnc","AcceptRequest","update_it","edit_membership","create_direct_debit","update_request","change_direct_debit","update_mandate_details","GenerateUpdateLink","add_card","CreateNewCustomer","clientSecret","secret","appearance","paymentElementOptions","layout","paymentElement","confirmSetup","confirmParams","href","messageContainer","querySelector","try_charge_default_card","CreatePaymentIntent","save_added_card","card_tnc","requested_by","paid","SendRequest","ManageMyMembershipsDirectDebitController","ManageNokController","nok_id","delete_nok","save_nok","ManagePaymentsAddController","iframe_url","prefill_details","delete_card","get_paybase_token","GetUserForPayment","trustAsResourceUrl","ev","Create2","data2","ManagePaymentsController","change_address","billing_address","flatNumber","houseNameNumber","townCity","region","postalCode","countryISO","change_address_for","GetCardDetails","billingAddress","save_address","UpdateCard","decline_change","changePrimary","ChangePrimary","ManagePoidController","poid_id","user_poids","save_poid","ModalInstanceCtrl","$uibModalInstance","dismiss","MyAccountController","MyJourneyLogsController","GetMyJourneyLogs","user_totals","NewChargeModalInstanceCtrl","card_obj","create_invoice","PassengerSignupCompleteController","checked_identity","is_already_user","submit_button","gotologin","formcode","checkedcode","goToNextInput","no_len","keyCode","thecode","combine","GetPaxSecureInvite2","submit_user_for_signup","SignupUserFromPassenger","PassengerSignupController","calculate_age","birthday","ageDifMs","ageDate","guardian","validate_age","checking_validity","next_of_kin","check_nok","submit_passenger","guardianship","self_dob","ConfirmPaxInvite","GetPaxSecureInvite","PasswordResetController","show_error2","show_thankyou","password_reset","ResetPassword","go_login","password_reset2","ResetPassword2","thank_you","RefundModalInstanceCtrl","remaining","RegisterController","verify_status","register","userId","ReviewBookingsController","get_the_approval_list","GetBookingsToReview","approve_booking","AcceptBooking","decline_booking","DeclineBooking","view_booking","GetAllInstructor","can_be_edited","GetAllUserClub","ShowGalleryController","GetByUrl","is_disabled","password_protected","load_image","change_image","show_fullscreen","hide","hide_fullscreen","show","fullscreen_next","fullscreen_previous","download","DownloadZip","gallery_id","quality","zip_url","UpdateMyMembershipDirectDebitController","return_id","UpdateMandate","UploadController","ImageUploadService","CheckData","images_array","tmp_name","compiled_send","artpiece_id","artme","UsersController","this_user","default_pwd","Success","UserSignupController","licenses","person","selectedSingle","selectedSingleKey","people","$valid"],"mappings":"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IAAxB,CACH,CAEDjT,EAAE,CAACwU,OAAH,CAAa7S,IAAI,CAAC6S,OAAlB,CACA,GAAGxU,EAAE,CAACwU,OAAH,CAAWzQ,OAAd,CAAsB,CAClB/D,EAAE,CAAC6S,OAAH,CAAW,CAAX,EAAcI,OAAd,CAAwB,IAAxB,CACH,CAFD,IAEO,CACHjT,EAAE,CAAC6S,OAAH,CAAW,CAAX,EAAcI,OAAd,CAAwB,KAAxB,CACH,CAEDjT,EAAE,CAACiS,YAAH,CAAkB,IAAlB,CACAjS,EAAE,CAACkS,YAAH,CAAkB,KAAlB,CACH,CAEJ,CAhCL,EAwCF;AACH,CA3DD,IA2DO,CACH;AACA;AACAlS,EAAE,CAACkS,YAAH,CAAkB,KAAlB,CAEH,CAEJ,CApED,EA4EF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAIA;AAEA;AACA;AAEA;AAEA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAQA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAMA;AAMD,CAhTD,CAkTAzR,MAAM,CAAC0zE,MAAP,CAAgB,UAAY,CAEVzzE,MAAM,CAACymB,EAAP,CAAU,uBAAV,CAAmC,EAAnC,CAAuC,CAAEC,MAAM,CAAE,IAAV,CAAvC,EAEjB,CAJD,CAeA;AAGF;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAIA;AAEA;AACA;AACA;AAQH,CACJ3nB,GAAG,CAACC,UAAJ,CAAe,oCAAf,CAAqD00E,kCAArD,EAEGA,kCAAkC,CAACx0E,OAAnC,CAA6C,CAAC,aAAD,CAAgB,cAAhB,CAAgC,YAAhC,CAA8C,WAA9C,CAA2D,QAA3D,CAAqE,QAArE,CAA+E,cAA/E,CAA+F,WAA/F,CAA4G,MAA5G,CAAoH,SAApH,CAA+H,gBAA/H,CAAiJ,gBAAjJ,CAAmK,oBAAnK,CAAyL,oBAAzL,CAA+M,gBAA/M,CAAiO,WAAjO,CAA8O,cAA9O,CAA7C,CACA,QAASw0E,CAAAA,kCAAT,CAA4Cv0E,WAA5C,CAAyDsF,YAAzD,CAAuErF,UAAvE,CAAmFC,SAAnF,CAA8FU,MAA9F,CAAsGC,MAAtG,CAA8GC,YAA9G,CAA4HC,SAA5H,CAAuIC,IAAvI,CAA6IC,OAA7I,CAAsJK,cAAtJ,CAAsKkzC,cAAtK,CAAsLC,kBAAtL,CAA0MuK,kBAA1M,CAA8Nw1B,cAA9N,CAA8O77D,SAA9O,CAAyPpX,YAAzP,CAAuQ,CACnQ,GAAIpB,CAAAA,EAAE,CAAG,IAAT,CAEA;AAEAA,EAAE,CAACC,IAAH,CAAU,IAAV,CACAD,EAAE,CAACgyB,QAAH,CAAc,EAAd,CACAhyB,EAAE,CAAC6P,IAAH,CAAU,CACNH,IAAI,CAAE,EADA,CAAV,CAIA1P,EAAE,CAACiyB,UAAH,CAAgB,EAAhB,CAEAjyB,EAAE,CAAC8+C,cAAH,CAAoB,EAApB,CACA9+C,EAAE,CAACs4C,eAAH,CAAqB,EAArB,CAEA,GAAID,CAAAA,gBAAgB,CAAG,EAAvB,CAGAr4C,EAAE,CAACgnB,MAAH,CAAYtmB,MAAM,CAACqmB,OAAP,CAAeplB,IAAf,CAAoBqlB,MAAhC,CACAhnB,EAAE,CAACqP,OAAH,CAAavP,UAAU,CAACI,OAAX,CAAmBC,WAAnB,CAA+BgtC,kBAA/B,CAAkDnrC,EAA/D,CACAhC,EAAE,CAACC,IAAH,CAAUH,UAAU,CAACI,OAAX,CAAmBC,WAA7B,CACAH,EAAE,CAAC2E,OAAH,CAAa3E,EAAE,CAACC,IAAH,CAAQ+B,EAArB,CAEAhC,EAAE,CAACwd,WAAH,CAAiB,CAAC,QAAD,CAAW,SAAX,CAAsB,OAAtB,CAAjB,CAEAxd,EAAE,CAACwyE,SAAH,CAAe,EAAf,CAEAxyE,EAAE,CAAC8P,MAAH,CAAY,EAAZ,CACA9P,EAAE,CAACs0E,SAAH,CAAe,KAAf,CAEAz1B,kBAAkB,CAACl9B,WAAnB,CAA+B3hB,EAAE,CAACqP,OAAlC,EACa3N,IADb,CACkB,SAASC,IAAT,CAAc,CAChB;AACA3B,EAAE,CAAC++C,WAAH,CAAiBp9C,IAAI,CAACmc,KAAtB,CACH,CAJb,EAUQ;AACA9d,EAAE,CAACiyB,UAAH,CAAgB,eAAhB,CAEAoiD,cAAc,CAACE,aAAf,CAA6Bv0E,EAAE,CAACqP,OAAhC,EACK3N,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AACA3B,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaxF,IAAb,CAAoBvI,IAAI,CAACuI,IAAzB,CACH,CAJL,EAOA,GAAI+kB,CAAAA,MAAM,CAAGC,MAAM,CAAC1W,SAAS,CAACg8D,kBAAV,EAAD,CAAnB,CACA,GAAIC,CAAAA,QAAQ,CAAGxlD,MAAM,CAACwlD,QAAP,EAAf,CAEA,GAAIC,CAAAA,YAAY,CAAG,CACbC,cAAc,CAAE,IADH,CAEbC,KAAK,CAAE,CACLtT,IAAI,CAAE,CACJuT,SAAS,CAAE,SADP,CAEJC,KAAK,CAAE,SAFH,CAGJC,UAAU,CAAE,MAHR,CAIJC,UAAU,CAAE,GAJR,CAKJC,UAAU,CAAE,gBALR,CAMJC,QAAQ,CAAE,MANN,CAOJ,gBAAiB,CACfJ,KAAK,CAAE,SADQ,CAPb,CADD,CAFM,CAAnB,CAiBA,GAAIK,CAAAA,IAAI,CAAGV,QAAQ,CAACxyC,MAAT,CAAgB,MAAhB,CAAwByyC,YAAxB,CAAX,CACA,GAAIU,CAAAA,IAAJ,CAEA,GAAIC,CAAAA,OAAJ,CACA,GAAIC,CAAAA,GAAG,CAAG,KAAV,CACA,GAAIC,CAAAA,IAAI,CAAG,KAAX,CAEA12B,kBAAkB,CAACG,oBAAnB,CAAwCh/C,EAAE,CAACqP,OAA3C,EACC3N,IADD,CACM,SAASC,IAAT,CAAc,CAChB;AACA3B,EAAE,CAACwyE,SAAH,CAAe7wE,IAAI,CAACmc,KAApB,CACH,CAJD,EAMA,QAAS03D,CAAAA,WAAT,EAAsB,CAClBC,YAAY,CAACJ,OAAD,CAAZ,CACA,GAAGC,GAAG,EAAI,KAAV,CAAgB,CACZA,GAAG,CAAG,IAAN,CAEAH,IAAI,CAACO,KAAL,CAAW,eAAX,EAEAN,IAAI,CAAG7mE,QAAQ,CAACg2B,cAAT,CAAwB,eAAxB,CAAP,CACA6wC,IAAI,CAACO,gBAAL,CAAsB,QAAtB,CAAgC,SAASpzE,CAAT,CAAY,CAC1CA,CAAC,CAACS,cAAF,GACA4yE,WAAW,GACZ,CAHD,EAIH,CACJ,CACDn1E,MAAM,CAACw1D,GAAP,CAAW,oBAAX,CAAiC,UAAU,CACnCwf,YAAY,CAACJ,OAAD,CAAZ,CACA,GAAGE,IAAI,EAAI,KAAX,CAAiB,CACbA,IAAI,CAAG,IAAP,CACAF,OAAO,CAAGxuD,UAAU,CAAC,UAAU,CAAE2uD,WAAW,GAAK,CAA7B,CAA+B,IAA/B,CAApB,CACH,CACR,CAND,EAUA,QAASK,CAAAA,kBAAT,CAA4BC,KAA5B,CAAmC,CACjC;AACA,GAAIV,CAAAA,IAAI,CAAG7mE,QAAQ,CAACg2B,cAAT,CAAwB,cAAxB,CAAX,CACA,GAAIwxC,CAAAA,WAAW,CAAGxnE,QAAQ,CAACC,aAAT,CAAuB,OAAvB,CAAlB,CACAunE,WAAW,CAACpnE,YAAZ,CAAyB,MAAzB,CAAiC,QAAjC,EACAonE,WAAW,CAACpnE,YAAZ,CAAyB,MAAzB,CAAiC,aAAjC,EACAonE,WAAW,CAACpnE,YAAZ,CAAyB,OAAzB,CAAkCmnE,KAAK,CAAC9zE,EAAxC,EACAozE,IAAI,CAACY,WAAL,CAAiBD,WAAjB,EAEA;AACA;AACA;AACD,CAED,QAASH,CAAAA,WAAT,EAAuB,CAEtB,EAKT;AAGAn1E,MAAM,CAACw+C,UAAP,CAAoB,UAAU,CAC1B;AACH,CAFD,CAIAx+C,MAAM,CAAC42B,IAAP,CAAc,UAAU,CACpBv2B,OAAO,CAACw2B,OAAR,CAAgBD,IAAhB,GACH,CAFD,CAIAr3B,EAAE,CAACq6C,eAAH,CAAqB,SAASzrC,KAAT,CAAgB,CAAExN,YAAY,CAACi5C,eAAb,CAA6BzrC,KAA7B,EAAsC,CAA7E,CAEAnO,MAAM,CAACuhC,IAAP,CAAc,UAAU,CACpB,GAAIoC,CAAAA,MAAM,CAAG,CACT,CAAEC,EAAE,CAAErkC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,EAA2Bl/C,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwBl9C,EAAzD,CAA6Ds4C,KAAK,CAAE,oBAApE,CAA0FhW,KAAK,CAAE,YAAjG,CADS,CAET,CAAED,EAAE,CAAErkC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAapF,UAAnB,CAA+BgwC,KAAK,CAAE,YAAtC,CAAoDhW,KAAK,CAAE,YAA3D,CAFS,CAGT,CAAED,EAAE,CAAErkC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAanF,SAAnB,CAA+B+vC,KAAK,CAAE,WAAtC,CAAoDhW,KAAK,CAAE,WAA3D,CAHS,CAIT,CAAED,EAAE,CAAErkC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAasvB,KAAnB,CAA+Bsb,KAAK,CAAE,OAAtC,CAAoDhW,KAAK,CAAE,eAA3D,CAJS,CAKT,CAAED,EAAE,CAAErkC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaxF,IAAnB,CAA+BowC,KAAK,CAAE,MAAtC,CAAoDhW,KAAK,CAAE,cAA3D,CALS,CAMT,CAAED,EAAE,CAAErkC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAai4B,WAAnB,CAAgC2S,KAAK,CAAE,aAAvC,CAAsDhW,KAAK,CAAE,aAA7D,CANS,CAAb,CAQA,GAAItkC,EAAE,CAACi2E,YAAP,CAAqB,CACjB7xC,MAAM,CAAC5hC,IAAP,CAAY,CAAE6hC,EAAE,CAAErkC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawmE,UAAb,EAA2B,IAA3B,EAAmCl2E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawmE,UAAb,EAA2B,CAApE,CAAuE57B,KAAK,CAAE,YAA9E,CAA4FhW,KAAK,CAAE,YAAnG,CAAZ,EACAF,MAAM,CAAC5hC,IAAP,CAAY,CAAE6hC,EAAE,CAAErkC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa4f,cAAnB,CAAmCgrB,KAAK,CAAE,gBAA1C,CAA4DhW,KAAK,CAAE,gBAAnE,CAAZ,EACH,CACD,GAAI,CAACljC,YAAY,CAACm5C,YAAb,CAA0BnW,MAA1B,CAAL,CAAwC,OAExC,GAAGpkC,EAAE,CAACgnB,MAAH,EAAa,KAAhB,CAAsB,CAClBvmB,MAAM,CAACwhC,MAAP,GACH,CAFD,IAEO,CACHxhC,MAAM,CAACyhC,MAAP,GACH,CACJ,CApBD,CAsBAzhC,MAAM,CAACwhC,MAAP,CAAgB,UAAU,CACtB;AAGA;AACA,GAAG,CAACjiC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAd,EAA4B,CAACl/C,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwBl9C,EAAxD,CAA2D,CACvDZ,YAAY,CAACkD,OAAb,CAAqB,oBAArB,CAA2C,sDAA3C,EACA,MAAO,MAAP,CACH,CACD,GAAG,CAACtE,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAapF,UAAd,EAA4B,CAACtK,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAanF,SAA1C,EAAuD,CAACvK,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAasvB,KAAxE,CAA8E,CAC1E59B,YAAY,CAACkD,OAAb,CAAqB,iBAArB,CAAwC,yEAAxC,EACA,MAAO,MAAP,CACH,CAED,GAAGtE,EAAE,CAACi2E,YAAN,CAAmB,CACf,GAAGj2E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawmE,UAAb,CAA0B,CAA1B,EAA+B,CAACl2E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa4f,cAAhD,CAA+D,CAC3DluB,YAAY,CAACkD,OAAb,CAAqB,kBAArB,CAAyC,4FAAzC,EACA,MAAO,MAAP,CACH,CACJ,CAODtE,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaymE,gBAAb,CAAgCn2E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwBv5C,KAAxD,CACA3F,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa4vC,aAAb,CAA6Bt/C,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwBl9C,EAArD,CACA,GAAGhC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaikE,QAAb,EAAyB3zE,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaikE,QAAb,CAAsB3xE,EAAtB,CAA0B,CAAtD,CAAwD,CACpDhC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa6jE,WAAb,CAA2BvzE,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaikE,QAAb,CAAsB3xE,EAAjD,CACH,CAED;AACA;AAIAhC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaL,OAAb,CAAuBrP,EAAE,CAACqP,OAA1B,CAGA,GAAG,CAACrP,EAAE,CAACi2E,YAAP,CAAoB,CAEb,GAAIj1D,CAAAA,OAAO,CAAG,CACb3Y,IAAI,CAAEkG,QAAQ,CAACg2B,cAAT,CAAwB,MAAxB,EAAgC4b,KADzB,CAEbi2B,WAAW,CAAE7nE,QAAQ,CAACg2B,cAAT,CAAwB,kBAAxB,EAA4C4b,KAF5C,CAAd,CAKDlxB,MAAM,CAAC2mD,WAAP,CAAmBT,IAAnB,CAAyBn0D,OAAzB,EAAkCtf,IAAlC,CAAuC,SAASktB,MAAT,CAAiB,CACtD,GAAIA,MAAM,CAAC/pB,KAAX,CAAkB,CAChB;AACA,GAAIwxE,CAAAA,YAAY,CAAG9nE,QAAQ,CAACg2B,cAAT,CAAwB,aAAxB,CAAnB,CACA8xC,YAAY,CAACC,WAAb,CAA2B1nD,MAAM,CAAC/pB,KAAP,CAAaC,OAAxC,CACD,CAJD,IAIO,CACL;AACA;AACA;AAEA,GAAG8pB,MAAM,CAACknD,KAAP,CAAa9zE,EAAhB,CAAmB,CACnB;AAEE;AACA,GAAIsN,CAAAA,GAAG,CAAG,CACN3K,OAAO,CAAE3E,EAAE,CAACC,IAAH,CAAQ+B,EADX,CAENu0E,KAAK,CAAE3nD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkBoB,KAFnB,CAGNC,KAAK,CAAE5nD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkBqB,KAHnB,CAINC,IAAI,CAAE7nD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkBnzE,EAJlB,CAKN8zE,KAAK,CAAElnD,MAAM,CAACknD,KAAP,CAAa9zE,EALd,CAMN00E,SAAS,CAAE9nD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkBuB,SANvB,CAONC,QAAQ,CAAE/nD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkBwB,QAPtB,CAQNC,OAAO,CAAEhoD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkByB,OARrB,CASNvuE,IAAI,CAAEumB,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkB9sE,IATlB,CAUNwuE,gBAAgB,CAAEjoD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkBiB,WAV9B,CAWNU,SAAS,CAAEloD,MAAM,CAACknD,KAAP,CAAagB,SAXlB,CAAV,CAcA92E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa0c,OAAb,CAAuB9c,GAAvB,CAEA,MAAOtP,CAAAA,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAApB,CACA;AAEA;AACA;AAEAm1B,cAAc,CAACzvE,MAAf,CAAsB5E,EAAE,CAAC6P,IAAH,CAAQH,IAA9B,EACChO,IADD,CACM,SAASC,IAAT,CAAc,CAChB;AACA;AACAjB,MAAM,CAACymB,EAAP,CAAU,gCAAV,CAA4C,EAA5C,CAAgD,CAACC,MAAM,CAAE,IAAT,CAAhD,EAEH,CAND,EAUD,CAEF,CACF,CAjDD,EAmDH,CA1DH,IA0DS,CACL;AACA,GAAI9X,CAAAA,GAAG,CAAG,CACNggB,cAAc,CAAEtvB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa4f,cADvB,CAENzZ,MAAM,CAAE7V,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawmE,UAFf,CAAV,CAKAl2E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa0R,KAAb,CAAqBphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawmE,UAAlC,CAEAl2E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa0c,OAAb,CAAuB9c,GAAvB,CAEA,MAAOtP,CAAAA,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa4f,cAApB,CACA,MAAOtvB,CAAAA,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawmE,UAApB,CAEA;AAEQ;AAER7B,cAAc,CAACzvE,MAAf,CAAsB5E,EAAE,CAAC6P,IAAH,CAAQH,IAA9B,EACKhO,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AACA;AACAjB,MAAM,CAACymB,EAAP,CAAU,gCAAV,CAA4C,EAA5C,CAAgD,CAACC,MAAM,CAAE,IAAT,CAAhD,EAEH,CANL,EAQD,CAKN,CAjID,CAmIA3mB,MAAM,UAAN,CAAgB,UAAU,CACtB;AACAW,YAAY,CAACkD,OAAb,CAAqB,gBAArB,CAAuC,qDAAvC,EACA+vE,cAAc,CAAC98D,MAAf,CAAsBvX,EAAE,CAACC,IAAH,CAAQ+B,EAA9B,CAAkChC,EAAE,CAAC6P,IAAH,CAAQH,IAA1C,EACKhO,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AACH,CAHL,EAIH,CAPD,CASA,QAASq7C,CAAAA,eAAT,EAA0B,CACtB,GAAIjyC,CAAAA,SAAS,CAAG,EAAhB,CAEA,IAAI,GAAIjJ,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAACu2C,gBAAgB,CAACt2C,MAA/B,CAAsCD,CAAC,EAAvC,CAA0C,CACtC,GAAIE,CAAAA,EAAE,CAAGq2C,gBAAgB,CAACv2C,CAAD,CAAzB,CACA;AACA;AAEA,IAAI,GAAIwe,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAACtgB,EAAE,CAAC6P,IAAH,CAAQE,KAAR,CAAcuoC,eAAd,CAA8Bv2C,MAA5C,CAAmDue,CAAC,EAApD,CAAuD,CACnD;AACA,GAAGtgB,EAAE,CAAC6P,IAAH,CAAQE,KAAR,CAAcuoC,eAAd,CAA8Bh4B,CAA9B,EAAiCte,EAAjC,EAAuCA,EAA1C,CAA6C,CACzC+I,SAAS,CAACvI,IAAV,CAAexC,EAAE,CAAC6P,IAAH,CAAQE,KAAR,CAAcuoC,eAAd,CAA8Bh4B,CAA9B,CAAf,EACH,CACJ,CAEJ,CAED;AACA,MAAOvV,CAAAA,SAAP,CACH,CAEDtK,MAAM,CAACyhC,MAAP,CAAgB,UAAU,CACtB;AACAliC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaL,OAAb,CAAuBrP,EAAE,CAACqP,OAA1B,CACAglE,cAAc,CAACh9D,MAAf,CAAsBrX,EAAE,CAAC6P,IAAH,CAAQH,IAA9B,CAAoC1P,EAAE,CAACC,IAAH,CAAQ+B,EAA5C,EACKN,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AACA;AACA;AACAjB,MAAM,CAACymB,EAAP,CAAU,gCAAV,CAA4C,EAA5C,CAAgD,CAACC,MAAM,CAAE,IAAT,CAAhD,EACH,CANL,EAOH,CAVD,CAYA3mB,MAAM,CAACs2E,iBAAP,CAA2B,UAAU,CACjC;AACA,GAAInzD,CAAAA,IAAI,CAAG5jB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwBW,SAAnC,CACA,GAAGj8B,IAAI,CAAG,CAAV,CAAY,CACP,GAAI+jB,CAAAA,WAAW,CAAGt+B,MAAM,GAAGi/C,GAAT,CAAa,CAAC1kC,IAAd,CAAlB,CACD;AACA5jB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAai4B,WAAb,CAA2B,GAAI9nB,CAAAA,IAAJ,CAAS8nB,WAAT,CAA3B,CACH,CAJD,IAIO,CACH,GAAIA,CAAAA,WAAW,CAAGt+B,MAAM,GAAGuoC,IAAT,CAAc,CAAC,IAAf,CAAlB,CACA5xC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAai4B,WAAb,CAA2B,GAAI9nB,CAAAA,IAAJ,CAAS8nB,WAAT,CAA3B,CACH,CACD3nC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa0R,KAAb,CAAqBphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwB99B,KAA7C,CAEAy9B,kBAAkB,CAAC20B,mCAAnB,CAAuDxzE,EAAE,CAACqP,OAA1D,CAAmErP,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwBl9C,EAA3F,EACCN,IADD,CACM,SAASC,IAAT,CAAc,CAChB;AACA3B,EAAE,CAACwyE,SAAH,CAAe7wE,IAAI,CAACmc,KAApB,CACH,CAJD,EAMH,CAnBD,CAqBArd,MAAM,CAACu2E,eAAP,CAAyB,UAAU,CAE/B,GAAGh3E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaikE,QAAb,CAAsBx0B,aAAtB,EAAuC,CAA1C,CAA4C,CACxC;AACAn/C,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa0R,KAAb,CAAqBphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaikE,QAAb,CAAsBvyD,KAA3C,CACH,CAHD,IAGO,CACH;AACAphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa0R,KAAb,CAAqBphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwB99B,KAAxB,CAAiCphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwB99B,KAAxB,EAAiCphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaikE,QAAb,CAAsBt0B,UAAtB,CAAmC,GAApE,CAAtD,CAEH,CAEJ,CAXD,CAaA,QAASnC,CAAAA,cAAT,CAAwB5tC,GAAxB,CAA6B6tC,IAA7B,CAAmCl1B,MAAnC,CAA2C,CAEvC;AACA;AACA;AAEA,IAAI,GAAInmB,CAAAA,CAAC,CAAC,CAAV,CAAaA,CAAC,CAACq7C,IAAI,CAACp7C,MAApB,CAA4BD,CAAC,EAA7B,CAAiC,CAC7B;AACA;AAEA,GAAIs7C,CAAAA,aAAa,CAAG,CAApB,CACA,IAAI,GAAI35C,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAACwkB,MAAM,CAAClmB,MAArB,CAA4B0B,CAAC,EAA7B,CAAgC,CAC5B,GAAG05C,IAAI,CAACr7C,CAAD,CAAJ,CAAQmmB,MAAM,CAACxkB,CAAD,CAAd,GAAsB6L,GAAG,CAAC2Y,MAAM,CAACxkB,CAAD,CAAP,CAAzB,EAAwC05C,IAAI,CAACr7C,CAAD,CAAJ,CAAQmmB,MAAM,CAACxkB,CAAD,CAAd,GAAsB6L,GAAG,CAAC2Y,MAAM,CAACxkB,CAAD,CAAP,CAApE,CAAgF,CAC5E25C,aAAa,GAChB,CACJ,CAED,GAAGA,aAAa,GAAKn1B,MAAM,CAAClmB,MAA5B,CAAoC,CAChC,MAAO,KAAP,CACH,CACJ,CAED,MAAO,MAAP,CACH,CAKD,QAAS29C,CAAAA,SAAT,EAAoB,CAEhB;AAGA;AACA1/C,EAAE,CAAC6P,IAAH,CAAQE,KAAR,CAAcyuB,YAAd,CAA2Bl9B,OAA3B,CAAmC8E,OAAnC,CAA2C,SAASkJ,GAAT,CAAa,CAEvD,CAFD,EAIH,CAIDo9B,cAAc,GAEd,QAASA,CAAAA,cAAT,EAA0B,CAKzB,CAGD,GAAI5G,CAAAA,WAAW,CAAG,8FAAlB,CAEErlC,MAAM,CAACoC,IAAP,CAAc,SAAUgD,QAAV,CAAoB,CAChC,GAAI4/B,CAAAA,aAAa,CAAG7kC,SAAS,CAACiC,IAAV,CAAe,CACjC6iC,SAAS,CAAE,IADsB,CAEjCC,WAAW,CAAE,+BAFoB,CAGjCjmC,UAAU,CAAE,mBAHqB,CAIjCkmC,IAAI,CAAE,IAJ2B,CAKjCC,OAAO,CAAE,CACP7jC,EAAE,CAAE,aAAY,CACd,MAAO6D,CAAAA,QAAP,CACD,CAHM,CAIPoiB,MAAM,CAAE,iBAAW,CACjB,MAAO,CAACjmB,EAAE,CAAE6D,QAAL,CAAP,CACD,CANM,CAOPvB,OAAO,CAAE,kBAAU,CACf,MAAOwhC,CAAAA,WAAP,CACH,CATM,CALwB,CAAf,CAApB,CAiBAL,aAAa,CAAC7W,MAAd,CAAqBltB,IAArB,CAA0B,SAAUmE,QAAV,CAAoB,CAC5ChF,IAAI,CAACkN,IAAL,CAAU,eAAelI,QAAQ,CAAC7D,EAAlC,EACA68C,kBAAkB,CAACtnC,MAAnB,CAA0BvX,EAAE,CAACC,IAAH,CAAQ+B,EAAlC,CAAsC6D,QAAQ,CAAC7D,EAA/C,EACCN,IADD,CACM,UAAU,CACd;AACA;AACC1B,EAAE,CAAC6P,IAAH,CAAQiO,KAAR,CAAgBzb,CAAC,CAACC,IAAF,CAAOtC,EAAE,CAAC6P,IAAH,CAAQiO,KAAf,CAAsB,SAASvb,CAAT,CAAW,CAC9C,MAAOA,CAAAA,CAAC,CAACP,EAAF,EAAQ6D,QAAQ,CAAC7D,EAAxB,CACH,CAFgB,CAAhB,CAGF,CAPD,EAQD,CAVD,CAUG,UAAY,CACbnB,IAAI,CAACkN,IAAL,CAAU,uBAAyB,GAAI8R,CAAAA,IAAJ,EAAnC,EACD,CAZD,EAaD,CA/BD,CAoCL,CACJpgB,GAAG,CAACC,UAAJ,CAAe,iCAAf,CAAkDu3E,+BAAlD,EAEGA,+BAA+B,CAACr3E,OAAhC,CAA0C,CAAC,aAAD,CAAgB,cAAhB,CAAgC,YAAhC,CAA8C,WAA9C,CAA2D,QAA3D,CAAqE,QAArE,CAA+E,cAA/E,CAA+F,WAA/F,CAA4G,MAA5G,CAAoH,SAApH,CAA+H,gBAA/H,CAAiJ,gBAAjJ,CAAmK,oBAAnK,CAAyL,oBAAzL,CAA+M,gBAA/M,CAAiO,cAAjO,CAA1C,CACA,QAASq3E,CAAAA,+BAAT,CAAyCp3E,WAAzC,CAAsDsF,YAAtD,CAAoErF,UAApE,CAAgFC,SAAhF,CAA2FU,MAA3F,CAAmGC,MAAnG,CAA2GC,YAA3G,CAAyHC,SAAzH,CAAoIC,IAApI,CAA0IC,OAA1I,CAAmJK,cAAnJ,CAAmKkzC,cAAnK,CAAmLC,kBAAnL,CAAuMuK,kBAAvM,CAA2Nw1B,cAA3N,CAA2OjzE,YAA3O,CAAyP,CACrP,GAAIpB,CAAAA,EAAE,CAAG,IAAT,CAEA;AAEAA,EAAE,CAACC,IAAH,CAAU,IAAV,CACAD,EAAE,CAACgyB,QAAH,CAAc,EAAd,CACAhyB,EAAE,CAAC6P,IAAH,CAAU,CACNH,IAAI,CAAE,EADA,CAAV,CAIA1P,EAAE,CAACiyB,UAAH,CAAgB,EAAhB,CAEAjyB,EAAE,CAAC8+C,cAAH,CAAoB,EAApB,CACA9+C,EAAE,CAACs4C,eAAH,CAAqB,EAArB,CAEA,GAAID,CAAAA,gBAAgB,CAAG,EAAvB,CAGAr4C,EAAE,CAACgnB,MAAH,CAAYtmB,MAAM,CAACqmB,OAAP,CAAeplB,IAAf,CAAoBqlB,MAAhC,CACAhnB,EAAE,CAACqP,OAAH,CAAavP,UAAU,CAACI,OAAX,CAAmBC,WAAnB,CAA+BgtC,kBAA/B,CAAkDnrC,EAA/D,CACAhC,EAAE,CAACC,IAAH,CAAUH,UAAU,CAACI,OAAX,CAAmBC,WAA7B,CACAH,EAAE,CAAC2E,OAAH,CAAa3E,EAAE,CAACC,IAAH,CAAQ+B,EAArB,CAEAhC,EAAE,CAACwd,WAAH,CAAiB,CAAC,QAAD,CAAW,SAAX,CAAsB,OAAtB,CAAjB,CAEAxd,EAAE,CAACwyE,SAAH,CAAe,EAAf,CAEAxyE,EAAE,CAAC8P,MAAH,CAAY,EAAZ,CAGA+uC,kBAAkB,CAACl9B,WAAnB,CAA+B3hB,EAAE,CAACqP,OAAlC,EACa3N,IADb,CACkB,SAASC,IAAT,CAAc,CAChB;AACA3B,EAAE,CAAC++C,WAAH,CAAiBp9C,IAAI,CAACmc,KAAtB,CACH,CAJb,EASA;AAEA;AACC;AACD;AAEQ;AACA;AACAu2D,cAAc,CAAC1yD,WAAf,CAA2B3hB,EAAE,CAACqP,OAA9B,EACK3N,IADL,CACU,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAAC6P,IAAH,CAAQiO,KAAR,CAAgBnc,IAAI,CAACmc,KAArB,CACA;AACH,CAJL,EAOR;AAGArd,MAAM,CAACw+C,UAAP,CAAoB,UAAU,CAC1B;AACH,CAFD,CAIAx+C,MAAM,CAAC42B,IAAP,CAAc,UAAU,CACpBv2B,OAAO,CAACw2B,OAAR,CAAgBD,IAAhB,GACH,CAFD,CAIA52B,MAAM,CAACuhC,IAAP,CAAc,UAAU,CACpB,GAAGhiC,EAAE,CAACgnB,MAAH,EAAa,KAAhB,CAAsB,CAClB;AACAvmB,MAAM,CAACwhC,MAAP,GACH,CAHD,IAGO,CACH;AACA;AACAxhC,MAAM,CAACyhC,MAAP,GACH,CACJ,CATD,CAYAzhC,MAAM,CAACwhC,MAAP,CAAgB,UAAU,CACtB;AAGA;AACA,GAAG,CAACjiC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAd,EAA4B,CAACl/C,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwBl9C,EAAxD,CAA2D,CACvDZ,YAAY,CAACkD,OAAb,CAAqB,oBAArB,CAA2C,qDAA3C,EACA,MAAO,MAAP,CACH,CACD,GAAG,CAACtE,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAapF,UAAd,EAA4B,CAACtK,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAanF,SAA1C,EAAuD,CAACvK,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAasvB,KAAxE,CAA8E,CAC1E59B,YAAY,CAACkD,OAAb,CAAqB,iBAArB,CAAwC,yEAAxC,EACA,MAAO,MAAP,CACH,CAED,GAAGtE,EAAE,CAACi2E,YAAN,CAAmB,CACf,GAAG,CAACj2E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawmE,UAAd,EAA4B,CAACl2E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa4f,cAA7C,CAA4D,CACxDluB,YAAY,CAACkD,OAAb,CAAqB,iBAArB,CAAwC,2FAAxC,EACA,MAAO,MAAP,CACH,CACJ,CASDtE,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaymE,gBAAb,CAAgCn2E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwBv5C,KAAxD,CACA3F,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa4vC,aAAb,CAA6Bt/C,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwBl9C,EAArD,CACAhC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa6jE,WAAb,CAA2BvzE,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaikE,QAAb,CAAsB3xE,EAAjD,CAEA;AACA;AAIAhC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaL,OAAb,CAAuBrP,EAAE,CAACqP,OAA1B,CAGA,GAAG,CAACrP,EAAE,CAACi2E,YAAP,CAAoB,CAEb,GAAIj1D,CAAAA,OAAO,CAAG,CACb3Y,IAAI,CAAEkG,QAAQ,CAACg2B,cAAT,CAAwB,MAAxB,EAAgC4b,KADzB,CAEbi2B,WAAW,CAAE7nE,QAAQ,CAACg2B,cAAT,CAAwB,kBAAxB,EAA4C4b,KAF5C,CAAd,CAKDlxB,MAAM,CAAC2mD,WAAP,CAAmBT,IAAnB,CAAyBn0D,OAAzB,EAAkCtf,IAAlC,CAAuC,SAASktB,MAAT,CAAiB,CACtD,GAAIA,MAAM,CAAC/pB,KAAX,CAAkB,CAChB;AACA,GAAIwxE,CAAAA,YAAY,CAAG9nE,QAAQ,CAACg2B,cAAT,CAAwB,aAAxB,CAAnB,CACA8xC,YAAY,CAACC,WAAb,CAA2B1nD,MAAM,CAAC/pB,KAAP,CAAaC,OAAxC,CACD,CAJD,IAIO,CACL;AACA;AACA;AAEA,GAAG8pB,MAAM,CAACknD,KAAP,CAAa9zE,EAAhB,CAAmB,CACnB;AAEE;AACA,GAAIsN,CAAAA,GAAG,CAAG,CACN3K,OAAO,CAAE3E,EAAE,CAACC,IAAH,CAAQ+B,EADX,CAENu0E,KAAK,CAAE3nD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkBoB,KAFnB,CAGNC,KAAK,CAAE5nD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkBqB,KAHnB,CAINC,IAAI,CAAE7nD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkBnzE,EAJlB,CAKN8zE,KAAK,CAAElnD,MAAM,CAACknD,KAAP,CAAa9zE,EALd,CAMN00E,SAAS,CAAE9nD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkBuB,SANvB,CAONC,QAAQ,CAAE/nD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkBwB,QAPtB,CAQNC,OAAO,CAAEhoD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkByB,OARrB,CASNvuE,IAAI,CAAEumB,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkB9sE,IATlB,CAUNwuE,gBAAgB,CAAEjoD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkBiB,WAV9B,CAWNU,SAAS,CAAEloD,MAAM,CAACknD,KAAP,CAAagB,SAXlB,CAAV,CAcA92E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa0c,OAAb,CAAuB9c,GAAvB,CAEA,MAAOtP,CAAAA,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAApB,CACA;AAEA;AACA;AAEAm1B,cAAc,CAACzvE,MAAf,CAAsB5E,EAAE,CAAC6P,IAAH,CAAQH,IAA9B,EACChO,IADD,CACM,SAASC,IAAT,CAAc,CAChB;AACA;AACAjB,MAAM,CAACymB,EAAP,CAAU,gCAAV,CAA4C,EAA5C,CAAgD,CAACC,MAAM,CAAE,IAAT,CAAhD,EAEH,CAND,EAUD,CAEF,CACF,CAjDD,EAmDH,CA1DH,IA0DS,CACL;AACA,GAAI9X,CAAAA,GAAG,CAAG,CACNggB,cAAc,CAAEtvB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa4f,cADvB,CAENzZ,MAAM,CAAE7V,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawmE,UAFf,CAAV,CAOAl2E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa0c,OAAb,CAAuB9c,GAAvB,CAEA,MAAOtP,CAAAA,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa4f,cAApB,CACA,MAAOtvB,CAAAA,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawmE,UAApB,CAEA;AAEQ;AAER7B,cAAc,CAACzvE,MAAf,CAAsB5E,EAAE,CAAC6P,IAAH,CAAQH,IAA9B,EACKhO,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AACA;AACAjB,MAAM,CAACymB,EAAP,CAAU,gCAAV,CAA4C,EAA5C,CAAgD,CAACC,MAAM,CAAE,IAAT,CAAhD,EAEH,CANL,EAQD,CAKN,CAjID,CAmIA3mB,MAAM,UAAN,CAAgB,UAAU,CACtB;AACAW,YAAY,CAACkD,OAAb,CAAqB,gBAArB,CAAuC,mDAAvC,EACA+vE,cAAc,CAAC98D,MAAf,CAAsBvX,EAAE,CAACC,IAAH,CAAQ+B,EAA9B,CAAkChC,EAAE,CAAC6P,IAAH,CAAQH,IAA1C,EACKhO,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AACH,CAHL,EAIH,CAPD,CASA,QAASq7C,CAAAA,eAAT,EAA0B,CACtB,GAAIjyC,CAAAA,SAAS,CAAG,EAAhB,CAEA,IAAI,GAAIjJ,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAACu2C,gBAAgB,CAACt2C,MAA/B,CAAsCD,CAAC,EAAvC,CAA0C,CACtC,GAAIE,CAAAA,EAAE,CAAGq2C,gBAAgB,CAACv2C,CAAD,CAAzB,CACA;AACA;AAEA,IAAI,GAAIwe,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAACtgB,EAAE,CAAC6P,IAAH,CAAQE,KAAR,CAAcuoC,eAAd,CAA8Bv2C,MAA5C,CAAmDue,CAAC,EAApD,CAAuD,CACnD;AACA,GAAGtgB,EAAE,CAAC6P,IAAH,CAAQE,KAAR,CAAcuoC,eAAd,CAA8Bh4B,CAA9B,EAAiCte,EAAjC,EAAuCA,EAA1C,CAA6C,CACzC+I,SAAS,CAACvI,IAAV,CAAexC,EAAE,CAAC6P,IAAH,CAAQE,KAAR,CAAcuoC,eAAd,CAA8Bh4B,CAA9B,CAAf,EACH,CACJ,CAEJ,CAED;AACA,MAAOvV,CAAAA,SAAP,CACH,CAEDtK,MAAM,CAACyhC,MAAP,CAAgB,UAAU,CACtB;AACAliC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaL,OAAb,CAAuBrP,EAAE,CAACqP,OAA1B,CACAglE,cAAc,CAACh9D,MAAf,CAAsBrX,EAAE,CAAC6P,IAAH,CAAQH,IAA9B,CAAoC1P,EAAE,CAACC,IAAH,CAAQ+B,EAA5C,EACKN,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AACA;AACA;AACAjB,MAAM,CAACymB,EAAP,CAAU,gCAAV,CAA4C,EAA5C,CAAgD,CAACC,MAAM,CAAE,IAAT,CAAhD,EACH,CANL,EAOH,CAVD,CAYA3mB,MAAM,CAACs2E,iBAAP,CAA2B,UAAU,CACjC;AACA,GAAInzD,CAAAA,IAAI,CAAG5jB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwBW,SAAnC,CACA,GAAGj8B,IAAI,CAAG,CAAV,CAAY,CACP,GAAI+jB,CAAAA,WAAW,CAAGt+B,MAAM,GAAGi/C,GAAT,CAAa,CAAC1kC,IAAd,CAAlB,CACD;AACA5jB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAai4B,WAAb,CAA2B,GAAI9nB,CAAAA,IAAJ,CAAS8nB,WAAT,CAA3B,CACH,CAJD,IAIO,CACH,GAAIA,CAAAA,WAAW,CAAGt+B,MAAM,GAAGuoC,IAAT,CAAc,CAAC,IAAf,CAAlB,CACA5xC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAai4B,WAAb,CAA2B,GAAI9nB,CAAAA,IAAJ,CAAS8nB,WAAT,CAA3B,CACH,CACD3nC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa0R,KAAb,CAAqBphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwB99B,KAA7C,CAEAy9B,kBAAkB,CAAC20B,mCAAnB,CAAuDxzE,EAAE,CAACqP,OAA1D,CAAmErP,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwBl9C,EAA3F,EACCN,IADD,CACM,SAASC,IAAT,CAAc,CAChB;AACA3B,EAAE,CAACwyE,SAAH,CAAe7wE,IAAI,CAACmc,KAApB,CACH,CAJD,EAMH,CAnBD,CAqBArd,MAAM,CAACu2E,eAAP,CAAyB,UAAU,CAE/B,GAAGh3E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaikE,QAAb,CAAsBx0B,aAAtB,EAAuC,CAA1C,CAA4C,CACxC;AACAn/C,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa0R,KAAb,CAAqBphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaikE,QAAb,CAAsBvyD,KAA3C,CACH,CAHD,IAGO,CACH;AACAphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa0R,KAAb,CAAqBphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwB99B,KAAxB,CAAiCphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwB99B,KAAxB,EAAiCphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaikE,QAAb,CAAsBt0B,UAAtB,CAAmC,GAApE,CAAtD,CAEH,CAEJ,CAXD,CAaA,QAASnC,CAAAA,cAAT,CAAwB5tC,GAAxB,CAA6B6tC,IAA7B,CAAmCl1B,MAAnC,CAA2C,CAEvC;AACA;AACA;AAEA,IAAI,GAAInmB,CAAAA,CAAC,CAAC,CAAV,CAAaA,CAAC,CAACq7C,IAAI,CAACp7C,MAApB,CAA4BD,CAAC,EAA7B,CAAiC,CAC7B;AACA;AAEA,GAAIs7C,CAAAA,aAAa,CAAG,CAApB,CACA,IAAI,GAAI35C,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAACwkB,MAAM,CAAClmB,MAArB,CAA4B0B,CAAC,EAA7B,CAAgC,CAC5B,GAAG05C,IAAI,CAACr7C,CAAD,CAAJ,CAAQmmB,MAAM,CAACxkB,CAAD,CAAd,GAAsB6L,GAAG,CAAC2Y,MAAM,CAACxkB,CAAD,CAAP,CAAzB,EAAwC05C,IAAI,CAACr7C,CAAD,CAAJ,CAAQmmB,MAAM,CAACxkB,CAAD,CAAd,GAAsB6L,GAAG,CAAC2Y,MAAM,CAACxkB,CAAD,CAAP,CAApE,CAAgF,CAC5E25C,aAAa,GAChB,CACJ,CAED,GAAGA,aAAa,GAAKn1B,MAAM,CAAClmB,MAA5B,CAAoC,CAChC,MAAO,KAAP,CACH,CACJ,CAED,MAAO,MAAP,CACH,CAKD,QAAS29C,CAAAA,SAAT,EAAoB,CAEhB;AAGA;AACA1/C,EAAE,CAAC6P,IAAH,CAAQE,KAAR,CAAcyuB,YAAd,CAA2Bl9B,OAA3B,CAAmC8E,OAAnC,CAA2C,SAASkJ,GAAT,CAAa,CAEvD,CAFD,EAIH,CAMD7O,MAAM,CAAC48C,QAAP,CAAkB,SAASxxC,IAAT,CAAc,CAC5B;AACA,OAAOA,IAAP,EACI,IAAK,OAAL,CACI;AACA,GAAG7L,EAAE,CAACs9C,SAAH,CAAavtC,KAAb,EAAsB/P,EAAE,CAACs9C,SAAH,CAAavtC,KAAb,GAAuB,EAAhD,CAAmD,CAC/C;AACA;AACA;AACA;AACA;AAEA;AACA;AAGA,GAAG,CAAC/P,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaI,MAAjB,CAAwB,CACpB9P,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaI,MAAb,CAAsB,EAAtB,CACH,CAED,GAAGotC,cAAc,CAACl9C,EAAE,CAACs9C,SAAH,CAAavtC,KAAd,CAAqB/P,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaI,MAAlC,CAA0C,GAAIqrB,CAAAA,KAAJ,CAAU,UAAV,CAA1C,CAAd,EAAmF,KAAtF,CAA4F,CACxFn7B,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaI,MAAb,CAAoBtN,IAApB,CAAyBxC,EAAE,CAACs9C,SAAH,CAAavtC,KAAtC,EAEA;AACA;AACH,CAED,MAAO/P,CAAAA,EAAE,CAACs9C,SAAH,CAAavtC,KAApB,CAEH,CAxBD,IAwBO,CACH3O,YAAY,CAACkD,OAAb,CAAqB,eAArB,CAAsC,sDAAtC,EACH,CAEL,MA/BJ,CAqCH,CAvCD,CA0CA7D,MAAM,CAACk/C,WAAP,CAAqB,SAAS9zC,IAAT,CAAenJ,KAAf,CAAqB,CACtC;AAEA1C,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaI,MAAb,CAAoBnN,MAApB,CAA2BD,KAA3B,CAAkC,CAAlC,EAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAGA;AAIH,CA5ED,CA6FAjC,MAAM,CAAC43C,gBAAP,CAA0B,SAAS90C,IAAT,CAAc,CACpC;AACA,GAAG80C,gBAAgB,CAAClxC,OAAjB,CAAyB5D,IAAI,CAACvB,EAA9B,IAAsC,CAAC,CAA1C,CAA4C,CACxCq2C,gBAAgB,CAAC71C,IAAjB,CAAsBe,IAAI,CAACvB,EAA3B,EACH,CAFD,IAEO,CACJ;AACF,CACJ,CAPD,CAUCvB,MAAM,CAAC6pC,gBAAP,CAA0B,SAAS/mC,IAAT,CAAc,CAEjC;AAEAvD,EAAE,CAAC6P,IAAH,CAAQE,KAAR,CAAcuoC,eAAd,CAAgCj2C,CAAC,CAACC,IAAF,CAAOtC,EAAE,CAAC6P,IAAH,CAAQE,KAAR,CAAcuoC,eAArB,CAAsC,SAAS/1C,CAAT,CAAW,CACzE,MAAOA,CAAAA,CAAC,CAACP,EAAF,EAAQuB,IAAI,CAACvB,EAApB,CACH,CAF2B,CAAhC,CAIA;AACAiD,oBAAoB,CAACsS,MAArB,CAA4BvX,EAAE,CAACC,IAAH,CAAQ+B,EAApC,CAAwCuB,IAAI,CAACvB,EAA7C,EACCN,IADD,CACM,SAAUC,IAAV,CAAgB,CAClB;AACA,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CACZ;AACA;AACA;AACA/D,EAAE,CAACs4C,eAAH,CAAqB,EAArB,CACA;AACA73C,MAAM,CAACuD,YAAP,CAAoBR,aAApB,EAEH,CARD,IAQO,CACH;AACA;AACH,CAEJ,CAhBD,EAkBL,CA3BF,CA+BC/C,MAAM,CAAC6C,WAAP,CAAqB,SAASC,IAAT,CAAeC,aAAf,CAA6B,CAEhD;AACA,GAAIC,CAAAA,CAAC,CAAGC,IAAI,CAACC,KAAL,CAAWJ,IAAI,CAACK,WAAhB,CAAR,CACA;AACA;AAEA;AACA;AAEAmqC,WAAW,CAAClqC,SAAZ,CAAsBJ,CAAC,CAACK,SAAxB,EACKpC,IADL,CACU,SAAUC,IAAV,CAAgB,CAClB;AACA,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CACZ;AACA;AACA;AACA/D,EAAE,CAACs4C,eAAH,CAAqB,EAArB,CACA;AACA73C,MAAM,CAACuD,YAAP,CAAoBR,aAApB,EAEH,CARD,IAQO,CACH;AACA;AACH,CAEJ,CAhBL,EAkBD,CA5BD,CA+BA;AACA;AACA;AACA;AACA;AAEE/C,MAAM,CAACuD,YAAP,CAAsB,SAASC,KAAT,CAAe,CACjC;AAEA,IAAI,GAAInC,CAAAA,CAAC,CAAC,CAAV,CAAaA,CAAC,CAACmC,KAAK,CAAClC,MAArB,CAA6BD,CAAC,EAA9B,CAAiC,CAC7B;AACA,GAAI2B,CAAAA,CAAC,CAAGC,IAAI,CAACC,KAAL,CAAWM,KAAK,CAACnC,CAAD,CAAL,CAAS8B,WAApB,CAAR,CACA;AACA;AACA;AAEAK,KAAK,CAACnC,CAAD,CAAL,CAASyB,IAAT,CAAcW,SAAd,CAA0BT,CAAC,CAACK,SAA5B,CACAG,KAAK,CAACnC,CAAD,CAAL,CAASyB,IAAT,CAAcgqC,SAAd,CAA0B9pC,CAAC,CAACQ,KAAF,CAAQV,IAAR,CAAa8E,IAAvC,CACA,GAAID,CAAAA,EAAE,CAAG3E,CAAC,CAACQ,KAAF,CAAQV,IAAR,CAAa8E,IAAtB,CACAD,EAAE,CAAGA,EAAE,CAAChB,KAAH,CAAS,GAAT,EAAckB,GAAd,EAAL,CACArE,KAAK,CAACnC,CAAD,CAAL,CAASyB,IAAT,CAAciqC,SAAd,CAA0BplC,EAA1B,CAEA;AACApI,EAAE,CAACs4C,eAAH,CAAmB91C,IAAnB,CAAwByB,KAAK,CAACnC,CAAD,CAAL,CAASyB,IAAjC,EACH,CAGJ,CArBD,CAuBA9C,MAAM,CAACk4C,SAAP,CAAmB,SAASp1C,IAAT,CAAc,CAC7B;AACA,MAAOA,CAAAA,IAAI,CAACgqC,SAAZ,CACH,CAHD,CAKA9sC,MAAM,CAAC0H,QAAP,CAAkB,SAAS5E,IAAT,CAAc,CAE5B,GAAI6E,CAAAA,EAAE,CAAG7E,IAAI,CAAC8E,IAAd,CACAD,EAAE,CAAGA,EAAE,CAAChB,KAAH,CAAS,GAAT,EAAckB,GAAd,EAAL,CACA,GAAIC,CAAAA,SAAS,CAAG,EAAhB,CAEA;AACA;AACA,OAAO,IAAP,EACI,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,MAAX,EAAqB,CAAC,CAA5B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,MAAX,EAAqB,CAAC,CAA5B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,MAAX,EAAqB,CAAC,CAA5B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,MAAX,EAAqB,CAAC,CAA5B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,QACIA,SAAS,CAAG,UAAZ,CACJ,MA7CJ,CAgDA;AAEA,MAAO,qBAAqBA,SAA5B,CACH,CA3DD,CA8DA9H,MAAM,CAAC+H,SAAP,CAAmB,SAASjF,IAAT,CAAc,CAE7B,GAAI6E,CAAAA,EAAE,CAAG7E,IAAI,CAAC6D,KAAL,CAAW,GAAX,EAAgBkB,GAAhB,EAAT,CACA;AACA,GAAIC,CAAAA,SAAS,CAAG,EAAhB,CAEA;AACA;AACA,OAAO,IAAP,EACI,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,MAAX,EAAqB,CAAC,CAA5B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,MAAX,EAAqB,CAAC,CAA5B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,MAAX,EAAqB,CAAC,CAA5B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,MAAX,EAAqB,CAAC,CAA5B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,IAAMH,CAAAA,EAAE,CAACjB,OAAH,CAAW,KAAX,EAAoB,CAAC,CAA3B,CACIoB,SAAS,CAAG,SAAZ,CACJ,MACA,QACIA,SAAS,CAAG,UAAZ,CACJ,MA7CJ,CAgDA;AAEA,MAAO,qBAAqBA,SAA5B,CACH,CA3DD,CA+DA9H,MAAM,CAACm4C,WAAP,CAAqB,SAAS52C,EAAT,CAAY,CAG7B,GAAIokB,CAAAA,CAAC,CAAG2Z,MAAM,CAAC,2HAAD,CAAd,CACA,GAAG3Z,CAAC,EAAI,KAAR,CAAc,CAGV;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAEA;AAEA;AAIH,CA9BD,IA8BO,CACH;AACH,CAGJ,CAvCD,CA4CA3lB,MAAM,CAACo4C,oBAAP,CAA8B,UAAU,CAKpC;AAGA;AAEA;AAGC;AACA;AAEG;AACA;AACA;AAEA;AACA;AACA;AAKR;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAMA;AAEA;AAEA;AAEA;AAEA;AAMA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAGA;AAEA;AAEA;AAEA;AAGA;AAIE,CA3FF,CAgGCp4C,MAAM,CAACq4C,gBAAP,CAA0B,SAASv1C,IAAT,CAAc,CAErC;AACA;AAEA;AAEA;AAEAvD,EAAE,CAACs4C,eAAH,CAAqBj2C,CAAC,CAACC,IAAF,CAAOtC,EAAE,CAACs4C,eAAV,CAA2B,SAAS/1C,CAAT,CAAW,CACvD,MAAOA,CAAAA,CAAC,CAAC2B,SAAF,EAAeX,IAAI,CAACW,SAA3B,CACH,CAFoB,CAArB,CAIA;AAEAlE,EAAE,CAACs4C,eAAH,CAAmB91C,IAAnB,CAAwBe,IAAxB,EAEA;AAEF,CAnBD,CAkCLmpC,cAAc,GAEd,QAASA,CAAAA,cAAT,EAA0B,CACvB;AACF,CAGG,GAAI5G,CAAAA,WAAW,CAAG,8FAAlB,CAEFrlC,MAAM,CAACoC,IAAP,CAAc,SAAUgD,QAAV,CAAoB,CAChC,GAAI4/B,CAAAA,aAAa,CAAG7kC,SAAS,CAACiC,IAAV,CAAe,CACjC6iC,SAAS,CAAE,IADsB,CAEjCC,WAAW,CAAE,+BAFoB,CAGjCjmC,UAAU,CAAE,mBAHqB,CAIjCkmC,IAAI,CAAE,IAJ2B,CAKjCC,OAAO,CAAE,CACP7jC,EAAE,CAAE,aAAY,CACd,MAAO6D,CAAAA,QAAP,CACD,CAHM,CAIPoiB,MAAM,CAAE,iBAAW,CACjB,MAAO,CAACjmB,EAAE,CAAE6D,QAAL,CAAP,CACD,CANM,CAOPvB,OAAO,CAAE,kBAAU,CACf,MAAOwhC,CAAAA,WAAP,CACH,CATM,CALwB,CAAf,CAApB,CAiBAL,aAAa,CAAC7W,MAAd,CAAqBltB,IAArB,CAA0B,SAAUmE,QAAV,CAAoB,CAC5ChF,IAAI,CAACkN,IAAL,CAAU,eAAelI,QAAQ,CAAC7D,EAAlC,EACA68C,kBAAkB,CAACtnC,MAAnB,CAA0BvX,EAAE,CAACC,IAAH,CAAQ+B,EAAlC,CAAsC6D,QAAQ,CAAC7D,EAA/C,EACCN,IADD,CACM,UAAU,CACd;AACA;AACC1B,EAAE,CAAC6P,IAAH,CAAQiO,KAAR,CAAgBzb,CAAC,CAACC,IAAF,CAAOtC,EAAE,CAAC6P,IAAH,CAAQiO,KAAf,CAAsB,SAASvb,CAAT,CAAW,CAC9C,MAAOA,CAAAA,CAAC,CAACP,EAAF,EAAQ6D,QAAQ,CAAC7D,EAAxB,CACH,CAFgB,CAAhB,CAGF,CAPD,EAQD,CAVD,CAUG,UAAY,CACbnB,IAAI,CAACkN,IAAL,CAAU,uBAAyB,GAAI8R,CAAAA,IAAJ,EAAnC,EACD,CAZD,EAaD,CA/BD,CAoCL,CACJpgB,GAAG,CAACC,UAAJ,CAAe,qCAAf,CAAsDw3E,mCAAtD,EAEGA,mCAAmC,CAACt3E,OAApC,CAA8C,CAAC,aAAD,CAAgB,cAAhB,CAAgC,YAAhC,CAA8C,WAA9C,CAA2D,QAA3D,CAAqE,QAArE,CAA+E,cAA/E,CAA+F,WAA/F,CAA4G,MAA5G,CAAoH,SAApH,CAA+H,gBAA/H,CAAiJ,gBAAjJ,CAAmK,oBAAnK,CAAyL,oBAAzL,CAA+M,gBAA/M,CAAiO,cAAjO,CAA9C,CACA,QAASs3E,CAAAA,mCAAT,CAA6Cr3E,WAA7C,CAA0DsF,YAA1D,CAAwErF,UAAxE,CAAoFC,SAApF,CAA+FU,MAA/F,CAAuGC,MAAvG,CAA+GC,YAA/G,CAA6HC,SAA7H,CAAwIC,IAAxI,CAA8IC,OAA9I,CAAuJK,cAAvJ,CAAuKkzC,cAAvK,CAAuLC,kBAAvL,CAA2MuK,kBAA3M,CAA+Nw1B,cAA/N,CAA+OjzE,YAA/O,CAA6P,CACzP,GAAIpB,CAAAA,EAAE,CAAG,IAAT,CAEA;AAEAA,EAAE,CAACC,IAAH,CAAU,IAAV,CACAD,EAAE,CAACgyB,QAAH,CAAc,EAAd,CACAhyB,EAAE,CAAC6P,IAAH,CAAU,CACNH,IAAI,CAAE,EADA,CAAV,CAIA1P,EAAE,CAACiyB,UAAH,CAAgB,EAAhB,CAEAjyB,EAAE,CAAC8+C,cAAH,CAAoB,EAApB,CACA9+C,EAAE,CAACs4C,eAAH,CAAqB,EAArB,CAEA,GAAID,CAAAA,gBAAgB,CAAG,EAAvB,CAGAr4C,EAAE,CAACgnB,MAAH,CAAYtmB,MAAM,CAACqmB,OAAP,CAAeplB,IAAf,CAAoBqlB,MAAhC,CACAhnB,EAAE,CAACqP,OAAH,CAAavP,UAAU,CAACI,OAAX,CAAmBC,WAAnB,CAA+BgtC,kBAA/B,CAAkDnrC,EAA/D,CACAhC,EAAE,CAACC,IAAH,CAAUH,UAAU,CAACI,OAAX,CAAmBC,WAA7B,CACAH,EAAE,CAAC2E,OAAH,CAAa3E,EAAE,CAACC,IAAH,CAAQ+B,EAArB,CAEAhC,EAAE,CAACwd,WAAH,CAAiB,CAAC,QAAD,CAAW,SAAX,CAAsB,OAAtB,CAAjB,CAEAxd,EAAE,CAACwyE,SAAH,CAAe,EAAf,CAEAxyE,EAAE,CAAC8P,MAAH,CAAY,EAAZ,CAEA9P,EAAE,CAACs0E,SAAH,CAAe,IAAf,CAGAz1B,kBAAkB,CAACl9B,WAAnB,CAA+B3hB,EAAE,CAACqP,OAAlC,EACa3N,IADb,CACkB,SAASC,IAAT,CAAc,CAChB;AACA3B,EAAE,CAAC++C,WAAH,CAAiBp9C,IAAI,CAACmc,KAAtB,CACH,CAJb,EASQu2D,cAAc,CAAC79D,OAAf,CAAuB7V,YAAY,CAACqB,EAApC,EACKN,IADL,CACU,SAASC,IAAT,CAAc,CAIZA,IAAI,CAAC+N,IAAL,CAAUi4B,WAAV,CAAwB,GAAI9nB,CAAAA,IAAJ,CAASle,IAAI,CAAC+N,IAAL,CAAUi4B,WAAnB,CAAxB,CACA3nC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAe/N,IAAI,CAAC+N,IAApB,CAEA;AAGJ;AACH,CAZL,EAeRjP,MAAM,CAACs2E,iBAAP,CAA2B,UAAU,CACjC;AACA,GAAInzD,CAAAA,IAAI,CAAG5jB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwBW,SAAnC,CACA,GAAGj8B,IAAI,CAAG,CAAV,CAAY,CACP,GAAI+jB,CAAAA,WAAW,CAAGt+B,MAAM,GAAGi/C,GAAT,CAAa,CAAC1kC,IAAd,CAAlB,CACD;AACA5jB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAai4B,WAAb,CAA2B,GAAI9nB,CAAAA,IAAJ,CAAS8nB,WAAT,CAA3B,CACH,CAJD,IAIO,CACH,GAAIA,CAAAA,WAAW,CAAGt+B,MAAM,GAAGuoC,IAAT,CAAc,CAAC,IAAf,CAAlB,CACA5xC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAai4B,WAAb,CAA2B,GAAI9nB,CAAAA,IAAJ,CAAS8nB,WAAT,CAA3B,CACH,CACD3nC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa0R,KAAb,CAAqBphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwB99B,KAA7C,CAEAy9B,kBAAkB,CAAC20B,mCAAnB,CAAuDxzE,EAAE,CAACqP,OAA1D,CAAmErP,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwBl9C,EAA3F,EACCN,IADD,CACM,SAASC,IAAT,CAAc,CAChB;AACA3B,EAAE,CAACwyE,SAAH,CAAe7wE,IAAI,CAACmc,KAApB,CACH,CAJD,EAMH,CAnBD,CAqBArd,MAAM,CAACu2E,eAAP,CAAyB,UAAU,CAE/B,GAAGh3E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaikE,QAAb,CAAsBx0B,aAAtB,EAAuC,CAA1C,CAA4C,CACxC;AACAn/C,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa0R,KAAb,CAAqBphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaikE,QAAb,CAAsBvyD,KAA3C,CACH,CAHD,IAGO,CACH;AACAphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa0R,KAAb,CAAqBphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwB99B,KAAxB,CAAiCphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwB99B,KAAxB,EAAiCphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaikE,QAAb,CAAsBt0B,UAAtB,CAAmC,GAApE,CAAtD,CAEH,CAEJ,CAXD,CAaA;AAGA5+C,MAAM,CAACw+C,UAAP,CAAoB,UAAU,CAC1B;AACH,CAFD,CAIAx+C,MAAM,CAAC42B,IAAP,CAAc,UAAU,CACpBv2B,OAAO,CAACw2B,OAAR,CAAgBD,IAAhB,GACH,CAFD,CAIAr3B,EAAE,CAACq6C,eAAH,CAAqB,SAASzrC,KAAT,CAAgB,CAAExN,YAAY,CAACi5C,eAAb,CAA6BzrC,KAA7B,EAAsC,CAA7E,CAEAnO,MAAM,CAACuhC,IAAP,CAAc,UAAU,CACpB,GAAIoC,CAAAA,MAAM,CAAG,CACT,CAAEC,EAAE,CAAErkC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,EAA2Bl/C,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwBl9C,EAAzD,CAA6Ds4C,KAAK,CAAE,oBAApE,CAA0FhW,KAAK,CAAE,YAAjG,CADS,CAET,CAAED,EAAE,CAAErkC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAapF,UAAnB,CAA+BgwC,KAAK,CAAE,YAAtC,CAAoDhW,KAAK,CAAE,YAA3D,CAFS,CAGT,CAAED,EAAE,CAAErkC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAanF,SAAnB,CAA+B+vC,KAAK,CAAE,WAAtC,CAAoDhW,KAAK,CAAE,WAA3D,CAHS,CAIT,CAAED,EAAE,CAAErkC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAasvB,KAAnB,CAA+Bsb,KAAK,CAAE,OAAtC,CAAoDhW,KAAK,CAAE,eAA3D,CAJS,CAKT,CAAED,EAAE,CAAErkC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaxF,IAAnB,CAA+BowC,KAAK,CAAE,MAAtC,CAAoDhW,KAAK,CAAE,cAA3D,CALS,CAMT,CAAED,EAAE,CAAErkC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAai4B,WAAnB,CAAgC2S,KAAK,CAAE,aAAvC,CAAsDhW,KAAK,CAAE,aAA7D,CANS,CAAb,CAQA,GAAI,CAACljC,YAAY,CAACm5C,YAAb,CAA0BnW,MAA1B,CAAL,CAAwC,OAExC,GAAGpkC,EAAE,CAACgnB,MAAH,EAAa,KAAhB,CAAsB,CAClBvmB,MAAM,CAACwhC,MAAP,GACH,CAFD,IAEO,CACHxhC,MAAM,CAACyhC,MAAP,GACH,CACJ,CAhBD,CAmBAzhC,MAAM,CAACwhC,MAAP,CAAgB,UAAU,CACtB;AAGA;AACA,GAAG,CAACjiC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAd,EAA4B,CAACl/C,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwBl9C,EAAxD,CAA2D,CACvDZ,YAAY,CAACkD,OAAb,CAAqB,oBAArB,CAA2C,sDAA3C,EACA,MAAO,MAAP,CACH,CACD,GAAG,CAACtE,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAapF,UAAd,EAA4B,CAACtK,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAanF,SAA1C,EAAuD,CAACvK,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAasvB,KAAxE,CAA8E,CAC1E59B,YAAY,CAACkD,OAAb,CAAqB,iBAArB,CAAwC,yEAAxC,EACA,MAAO,MAAP,CACH,CAED,GAAGtE,EAAE,CAACi2E,YAAN,CAAmB,CACf,GAAG,CAACj2E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawmE,UAAd,EAA4B,CAACl2E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa4f,cAA7C,CAA4D,CACxDluB,YAAY,CAACkD,OAAb,CAAqB,kBAArB,CAAyC,4FAAzC,EACA,MAAO,MAAP,CACH,CACJ,CASDtE,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaymE,gBAAb,CAAgCn2E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwBv5C,KAAxD,CACA3F,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa4vC,aAAb,CAA6Bt/C,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwBl9C,EAArD,CACAhC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa6jE,WAAb,CAA2BvzE,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaikE,QAAb,CAAsB3xE,EAAjD,CAEA;AACA;AAIAhC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaL,OAAb,CAAuBrP,EAAE,CAACqP,OAA1B,CAGA,GAAG,CAACrP,EAAE,CAACi2E,YAAP,CAAoB,CAEb,GAAIj1D,CAAAA,OAAO,CAAG,CACb3Y,IAAI,CAAEkG,QAAQ,CAACg2B,cAAT,CAAwB,MAAxB,EAAgC4b,KADzB,CAEbi2B,WAAW,CAAE7nE,QAAQ,CAACg2B,cAAT,CAAwB,kBAAxB,EAA4C4b,KAF5C,CAAd,CAKDlxB,MAAM,CAAC2mD,WAAP,CAAmBT,IAAnB,CAAyBn0D,OAAzB,EAAkCtf,IAAlC,CAAuC,SAASktB,MAAT,CAAiB,CACtD,GAAIA,MAAM,CAAC/pB,KAAX,CAAkB,CAChB;AACA,GAAIwxE,CAAAA,YAAY,CAAG9nE,QAAQ,CAACg2B,cAAT,CAAwB,aAAxB,CAAnB,CACA8xC,YAAY,CAACC,WAAb,CAA2B1nD,MAAM,CAAC/pB,KAAP,CAAaC,OAAxC,CACD,CAJD,IAIO,CACL;AACA;AACA;AAEA,GAAG8pB,MAAM,CAACknD,KAAP,CAAa9zE,EAAhB,CAAmB,CACnB;AAEE;AACA,GAAIsN,CAAAA,GAAG,CAAG,CACN3K,OAAO,CAAE3E,EAAE,CAACC,IAAH,CAAQ+B,EADX,CAENu0E,KAAK,CAAE3nD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkBoB,KAFnB,CAGNC,KAAK,CAAE5nD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkBqB,KAHnB,CAINC,IAAI,CAAE7nD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkBnzE,EAJlB,CAKN8zE,KAAK,CAAElnD,MAAM,CAACknD,KAAP,CAAa9zE,EALd,CAMN00E,SAAS,CAAE9nD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkBuB,SANvB,CAONC,QAAQ,CAAE/nD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkBwB,QAPtB,CAQNC,OAAO,CAAEhoD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkByB,OARrB,CASNvuE,IAAI,CAAEumB,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkB9sE,IATlB,CAUNwuE,gBAAgB,CAAEjoD,MAAM,CAACknD,KAAP,CAAaX,IAAb,CAAkBiB,WAV9B,CAWNU,SAAS,CAAEloD,MAAM,CAACknD,KAAP,CAAagB,SAXlB,CAAV,CAcA92E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa0c,OAAb,CAAuB9c,GAAvB,CAEA,MAAOtP,CAAAA,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAApB,CACA;AAEA;AACA;AAEAm1B,cAAc,CAACzvE,MAAf,CAAsB5E,EAAE,CAAC6P,IAAH,CAAQH,IAA9B,EACChO,IADD,CACM,SAASC,IAAT,CAAc,CAChB;AACA;AACAjB,MAAM,CAACymB,EAAP,CAAU,gCAAV,CAA4C,EAA5C,CAAgD,CAACC,MAAM,CAAE,IAAT,CAAhD,EAEH,CAND,EAUD,CAEF,CACF,CAjDD,EAmDH,CA1DH,IA0DS,CACL;AACA,GAAI9X,CAAAA,GAAG,CAAG,CACNggB,cAAc,CAAEtvB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa4f,cADvB,CAENzZ,MAAM,CAAE7V,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawmE,UAFf,CAAV,CAOAl2E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa0c,OAAb,CAAuB9c,GAAvB,CAEA,MAAOtP,CAAAA,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa4f,cAApB,CACA,MAAOtvB,CAAAA,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawmE,UAApB,CAEA;AAEQ;AAER7B,cAAc,CAACzvE,MAAf,CAAsB5E,EAAE,CAAC6P,IAAH,CAAQH,IAA9B,EACKhO,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AACA;AACAjB,MAAM,CAACymB,EAAP,CAAU,gCAAV,CAA4C,EAA5C,CAAgD,CAACC,MAAM,CAAE,IAAT,CAAhD,EAEH,CANL,EAQD,CAKN,CAjID,CAoIA3mB,MAAM,CAAC0zE,MAAP,CAAgB,UAAU,CAEtBE,cAAc,CAAC8C,aAAf,CAA6Bn3E,EAAE,CAACC,IAAH,CAAQ+B,EAArC,CAAyChC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa1N,EAAtD,EACKN,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AACAjB,MAAM,CAACymB,EAAP,CAAU,gCAAV,CAA4C,EAA5C,CAAgD,CAACC,MAAM,CAAE,IAAT,CAAhD,EACH,CAJL,EAMH,CARD,CAUA3mB,MAAM,UAAN,CAAgB,UAAU,CACtB;AACAW,YAAY,CAACkD,OAAb,CAAqB,gBAArB,CAAuC,qDAAvC,EACA+vE,cAAc,CAAC8C,aAAf,CAA6Bn3E,EAAE,CAACC,IAAH,CAAQ+B,EAArC,CAAyChC,EAAE,CAAC6P,IAAH,CAAQH,IAAjD,EACKhO,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AACH,CAHL,EAIH,CAPD,CASA,QAASq7C,CAAAA,eAAT,EAA0B,CACtB,GAAIjyC,CAAAA,SAAS,CAAG,EAAhB,CAEA,IAAI,GAAIjJ,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAACu2C,gBAAgB,CAACt2C,MAA/B,CAAsCD,CAAC,EAAvC,CAA0C,CACtC,GAAIE,CAAAA,EAAE,CAAGq2C,gBAAgB,CAACv2C,CAAD,CAAzB,CACA;AACA;AAEA,IAAI,GAAIwe,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAACtgB,EAAE,CAAC6P,IAAH,CAAQE,KAAR,CAAcuoC,eAAd,CAA8Bv2C,MAA5C,CAAmDue,CAAC,EAApD,CAAuD,CACnD;AACA,GAAGtgB,EAAE,CAAC6P,IAAH,CAAQE,KAAR,CAAcuoC,eAAd,CAA8Bh4B,CAA9B,EAAiCte,EAAjC,EAAuCA,EAA1C,CAA6C,CACzC+I,SAAS,CAACvI,IAAV,CAAexC,EAAE,CAAC6P,IAAH,CAAQE,KAAR,CAAcuoC,eAAd,CAA8Bh4B,CAA9B,CAAf,EACH,CACJ,CAEJ,CAED;AACA,MAAOvV,CAAAA,SAAP,CACH,CAEDtK,MAAM,CAACyhC,MAAP,CAAgB,UAAU,CACtB;AACAliC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaL,OAAb,CAAuBrP,EAAE,CAACqP,OAA1B,CACAglE,cAAc,CAACh9D,MAAf,CAAsBrX,EAAE,CAAC6P,IAAH,CAAQH,IAA9B,CAAoC1P,EAAE,CAACC,IAAH,CAAQ+B,EAA5C,EACKN,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AACA;AACA;AACAjB,MAAM,CAACymB,EAAP,CAAU,gCAAV,CAA4C,EAA5C,CAAgD,CAACC,MAAM,CAAE,IAAT,CAAhD,EACH,CANL,EAOH,CAVD,CAYA3mB,MAAM,CAACs2E,iBAAP,CAA2B,UAAU,CACjC;AACA,GAAInzD,CAAAA,IAAI,CAAG5jB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwBW,SAAnC,CACA,GAAGj8B,IAAI,CAAG,CAAV,CAAY,CACP,GAAI+jB,CAAAA,WAAW,CAAGt+B,MAAM,GAAGi/C,GAAT,CAAa,CAAC1kC,IAAd,CAAlB,CACD;AACA5jB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAai4B,WAAb,CAA2B,GAAI9nB,CAAAA,IAAJ,CAAS8nB,WAAT,CAA3B,CACH,CAJD,IAIO,CACH,GAAIA,CAAAA,WAAW,CAAGt+B,MAAM,GAAGuoC,IAAT,CAAc,CAAC,IAAf,CAAlB,CACA5xC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAai4B,WAAb,CAA2B,GAAI9nB,CAAAA,IAAJ,CAAS8nB,WAAT,CAA3B,CACH,CACD3nC,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa0R,KAAb,CAAqBphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwB99B,KAA7C,CAEAy9B,kBAAkB,CAAC20B,mCAAnB,CAAuDxzE,EAAE,CAACqP,OAA1D,CAAmErP,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwBl9C,EAA3F,EACCN,IADD,CACM,SAASC,IAAT,CAAc,CAChB;AACA3B,EAAE,CAACwyE,SAAH,CAAe7wE,IAAI,CAACmc,KAApB,CACH,CAJD,EAMH,CAnBD,CAqBArd,MAAM,CAACu2E,eAAP,CAAyB,UAAU,CAE/B,GAAGh3E,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaikE,QAAb,CAAsBx0B,aAAtB,EAAuC,CAA1C,CAA4C,CACxC;AACAn/C,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa0R,KAAb,CAAqBphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaikE,QAAb,CAAsBvyD,KAA3C,CACH,CAHD,IAGO,CACH;AACAphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAa0R,KAAb,CAAqBphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwB99B,KAAxB,CAAiCphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAawvC,UAAb,CAAwB99B,KAAxB,EAAiCphB,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaikE,QAAb,CAAsBt0B,UAAtB,CAAmC,GAApE,CAAtD,CAEH,CAEJ,CAXD,CAaA,QAASnC,CAAAA,cAAT,CAAwB5tC,GAAxB,CAA6B6tC,IAA7B,CAAmCl1B,MAAnC,CAA2C,CAEvC;AACA;AACA;AAEA,IAAI,GAAInmB,CAAAA,CAAC,CAAC,CAAV,CAAaA,CAAC,CAACq7C,IAAI,CAACp7C,MAApB,CAA4BD,CAAC,EAA7B,CAAiC,CAC7B;AACA;AAEA,GAAIs7C,CAAAA,aAAa,CAAG,CAApB,CACA,IAAI,GAAI35C,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAACwkB,MAAM,CAAClmB,MAArB,CAA4B0B,CAAC,EAA7B,CAAgC,CAC5B,GAAG05C,IAAI,CAACr7C,CAAD,CAAJ,CAAQmmB,MAAM,CAACxkB,CAAD,CAAd,GAAsB6L,GAAG,CAAC2Y,MAAM,CAACxkB,CAAD,CAAP,CAAzB,EAAwC05C,IAAI,CAACr7C,CAAD,CAAJ,CAAQmmB,MAAM,CAACxkB,CAAD,CAAd,GAAsB6L,GAAG,CAAC2Y,MAAM,CAACxkB,CAAD,CAAP,CAApE,CAAgF,CAC5E25C,aAAa,GAChB,CACJ,CAED,GAAGA,aAAa,GAAKn1B,MAAM,CAAClmB,MAA5B,CAAoC,CAChC,MAAO,KAAP,CACH,CACJ,CAED,MAAO,MAAP,CACH,CAKD,QAAS29C,CAAAA,SAAT,EAAoB,CAEhB;AAGA;AACA1/C,EAAE,CAAC6P,IAAH,CAAQE,KAAR,CAAcyuB,YAAd,CAA2Bl9B,OAA3B,CAAmC8E,OAAnC,CAA2C,SAASkJ,GAAT,CAAa,CAEvD,CAFD,EAIH,CAMD7O,MAAM,CAAC48C,QAAP,CAAkB,SAASxxC,IAAT,CAAc,CAC5B;AACA,OAAOA,IAAP,EACI,IAAK,OAAL,CACI;AACA,GAAG7L,EAAE,CAACs9C,SAAH,CAAavtC,KAAb,EAAsB/P,EAAE,CAACs9C,SAAH,CAAavtC,KAAb,GAAuB,EAAhD,CAAmD,CAC/C;AACA;AACA;AACA;AACA;AAEA;AACA;AAGA,GAAG,CAAC/P,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaI,MAAjB,CAAwB,CACpB9P,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaI,MAAb,CAAsB,EAAtB,CACH,CAED,GAAGotC,cAAc,CAACl9C,EAAE,CAACs9C,SAAH,CAAavtC,KAAd,CAAqB/P,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaI,MAAlC,CAA0C,GAAIqrB,CAAAA,KAAJ,CAAU,UAAV,CAA1C,CAAd,EAAmF,KAAtF,CAA4F,CACxFn7B,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaI,MAAb,CAAoBtN,IAApB,CAAyBxC,EAAE,CAACs9C,SAAH,CAAavtC,KAAtC,EAEA;AACA;AACH,CAED,MAAO/P,CAAAA,EAAE,CAACs9C,SAAH,CAAavtC,KAApB,CAEH,CAxBD,IAwBO,CACH3O,YAAY,CAACkD,OAAb,CAAqB,oBAArB,CAA2C,sDAA3C,EACH,CAEL,MA/BJ,CAqCH,CAvCD,CA0CA7D,MAAM,CAACk/C,WAAP,CAAqB,SAAS9zC,IAAT,CAAenJ,KAAf,CAAqB,CACtC;AAEA1C,EAAE,CAAC6P,IAAH,CAAQH,IAAR,CAAaI,MAAb,CAAoBnN,MAApB,CAA2BD,KAA3B,CAAkC,CAAlC,EAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAGA;AAIH,CA5ED,CA6FAjC,MAAM,CAAC43C,gBAAP,CAA0B,SAAS90C,IAAT,CAAc,CACpC;AACA,GAAG80C,gBAAgB,CAAClxC,OAAjB,CAAyB5D,IAAI,CAACvB,EAA9B,IAAsC,CAAC,CAA1C,CAA4C,CACxCq2C,gBAAgB,CAAC71C,IAAjB,CAAsBe,IAAI,CAACvB,EAA3B,EACH,CAFD,IAEO,CACJ;AACF,CACJ,CAPD,CAUCvB,MAAM,CAAC6pC,gBAAP,CAA0B,SAAS/mC,IAAT,CAAc,CAEjC;AAEAvD,EAAE,CAAC6P,IAAH,CAAQE,KAAR,CAAcuoC,eAAd,CAAgCj2C,CAAC,CAACC,IAAF,CAAOtC,EAAE,CAAC6P,IAAH,CAAQE,KAAR,CAAcuoC,eAArB,CAAsC,SAAS/1C,CAAT,CAAW,CACzE,MAAOA,CAAAA,CAAC,CAACP,EAAF,EAAQuB,IAAI,CAACvB,EAApB,CACH,CAF2B,CAAhC,CAIA;AACAiD,oBAAoB,CAACsS,MAArB,CAA4BvX,EAAE,CAACC,IAAH,CAAQ+B,EAApC,CAAwCuB,IAAI,CAACvB,EAA7C,EACCN,IADD,CACM,SAAUC,IAAV,CAAgB,CAClB;AACA,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CACZ;AACA;AACA;AACA/D,EAAE,CAACs4C,eAAH,CAAqB,EAArB,CACA;AACA73C,MAAM,CAACuD,YAAP,CAAoBR,aAApB,EAEH,CARD,IAQO,CACH;AACA;AACH,CAEJ,CAhBD,EAkBL,CA3BF,CA+BC/C,MAAM,CAAC6C,WAAP,CAAqB,SAASC,IAAT,CAAeC,aAAf,CAA6B,CAEhD;AACA,GAAIC,CAAAA,CAAC,CAAGC,IAAI,CAACC,KAAL,CAAWJ,IAAI,CAACK,WAAhB,CAAR,CACA;AACA;AAEA;AACA;AAEAmqC,WAAW,CAAClqC,SAAZ,CAAsBJ,CAAC,CAACK,SAAxB,EACKpC,IADL,CACU,SAAUC,IAAV,CAAgB,CAClB;AACA,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CACZ;AACA;AACA;AACA/D,EAAE,CAACs4C,eAAH,CAAqB,EAArB,CACA;AACA73C,MAAM,CAACuD,YAAP,CAAoBR,aAApB,EAEH,CARD,IAQO,CACH;AACA;AACH,CAEJ,CAhBL,EAkBD,CA5BD,CAgCFkpC,cAAc,GAEd,QAASA,CAAAA,cAAT,EAA0B,CAGzB,CAGG,GAAI5G,CAAAA,WAAW,CAAG,8FAAlB,CAEFrlC,MAAM,CAACoC,IAAP,CAAc,SAAUgD,QAAV,CAAoB,CAChC,GAAI4/B,CAAAA,aAAa,CAAG7kC,SAAS,CAACiC,IAAV,CAAe,CACjC6iC,SAAS,CAAE,IADsB,CAEjCC,WAAW,CAAE,+BAFoB,CAGjCjmC,UAAU,CAAE,mBAHqB,CAIjCkmC,IAAI,CAAE,IAJ2B,CAKjCC,OAAO,CAAE,CACP7jC,EAAE,CAAE,aAAY,CACd,MAAO6D,CAAAA,QAAP,CACD,CAHM,CAIPoiB,MAAM,CAAE,iBAAW,CACjB,MAAO,CAACjmB,EAAE,CAAE6D,QAAL,CAAP,CACD,CANM,CAOPvB,OAAO,CAAE,kBAAU,CACf,MAAOwhC,CAAAA,WAAP,CACH,CATM,CALwB,CAAf,CAApB,CAiBAL,aAAa,CAAC7W,MAAd,CAAqBltB,IAArB,CAA0B,SAAUmE,QAAV,CAAoB,CAC5ChF,IAAI,CAACkN,IAAL,CAAU,eAAelI,QAAQ,CAAC7D,EAAlC,EACA68C,kBAAkB,CAACtnC,MAAnB,CAA0BvX,EAAE,CAACC,IAAH,CAAQ+B,EAAlC,CAAsC6D,QAAQ,CAAC7D,EAA/C,EACCN,IADD,CACM,UAAU,CACd;AACA;AACC1B,EAAE,CAAC6P,IAAH,CAAQiO,KAAR,CAAgBzb,CAAC,CAACC,IAAF,CAAOtC,EAAE,CAAC6P,IAAH,CAAQiO,KAAf,CAAsB,SAASvb,CAAT,CAAW,CAC9C,MAAOA,CAAAA,CAAC,CAACP,EAAF,EAAQ6D,QAAQ,CAAC7D,EAAxB,CACH,CAFgB,CAAhB,CAGF,CAPD,EAQD,CAVD,CAUG,UAAY,CACbnB,IAAI,CAACkN,IAAL,CAAU,uBAAyB,GAAI8R,CAAAA,IAAJ,EAAnC,EACD,CAZD,EAaD,CA/BD,CAoCL,CACJpgB,GAAG,CACHqoB,MADA,CACO,QADP,CACiB,UAAY,CAC1B,MAAO,UAAU7gB,KAAV,CAAiB,CACpB,GAAGA,KAAK,EAAIA,KAAK,GAAK,EAAtB,CAAyB,CACrB,MAAOoC,CAAAA,MAAM,CAACpC,KAAD,CAAN,CAAcgvB,MAAd,EAAP,CAA8B;AACjC,CAFD,IAEO,CACH,MAAO,EAAP,CACH,CACJ,CAND,CAOH,CATA,EAWAx2B,GAAG,CAACC,UAAJ,CAAe,qBAAf,CAAsC03E,mBAAtC,EAEGA,mBAAmB,CAACx3E,OAApB,CAA8B,CAAC,aAAD,CAAe,cAAf,CAA+B,gBAA/B,CAAiD,gBAAjD,CAAmE,YAAnE,CAAiF,WAAjF,CAA8F,uBAA9F,CAAuH,cAAvH,CAA9B,CACA,QAASw3E,CAAAA,mBAAT,CAA6Bv3E,WAA7B,CAA0CymC,YAA1C,CAAwDplC,cAAxD,CAAwE8W,cAAxE,CAAwFlY,UAAxF,CAAoGC,SAApG,CAA+GwmC,qBAA/G,CAAsInlC,YAAtI,CAAoJ,CAChJ,GAAIpB,CAAAA,EAAE,CAAG,IAAT,CAEA,GAAG,CAACF,UAAU,CAACI,OAAX,CAAmBC,WAAvB,CAAmC,CAC/B,GAAGomC,qBAAqB,CAAC8wC,aAAtB,IAAyC,KAA5C,CAAkD,CAC9C;AACAt3E,SAAS,CAACgR,IAAV,CAAe,QAAf,EACA,MAAO,MAAP,CACH,CACD;AACA;AACA;AACH,CAED/Q,EAAE,CAACC,IAAH,CAAUH,UAAU,CAACI,OAAX,CAAmBC,WAA7B,CACA;AAEC;AAEDH,EAAE,CAACs3E,QAAH,CAAc,EAAd,CACAt3E,EAAE,CAACmlD,QAAH,CAAc,EAAd,CACAnlD,EAAE,CAACu3E,MAAH,CAAY,EAAZ,CACAv3E,EAAE,CAACw3E,iBAAH,CAAuB,EAAvB,CAEA;AACAx3E,EAAE,CAACgyB,QAAH,CAAc,EAAd,CAEAhyB,EAAE,CAACqF,KAAH,CAAW,EAAX,CAEArF,EAAE,CAACy3E,iBAAH,CAAuB,KAAvB,CAEA,GAAGz3E,EAAE,CAACC,IAAH,EAAWD,EAAE,CAACC,IAAH,CAAQ8wB,MAAnB,EAA6B/wB,EAAE,CAACC,IAAH,CAAQ8wB,MAAR,CAAeC,OAA/C,CAAuD,CACpDhxB,EAAE,CAACy3E,iBAAH,CAAuB,IAAvB,CACF,CAFD,IAEO,IAAGz3E,EAAE,CAACC,IAAH,EAAWD,EAAE,CAACC,IAAH,CAAQ8wB,MAAnB,EAA6B/wB,EAAE,CAACC,IAAH,CAAQ8wB,MAAR,CAAe9S,UAA/C,CAA0D,CAC9Dje,EAAE,CAACy3E,iBAAH,CAAuB,IAAvB,CACF,CAGD53E,WAAW,CAAC63E,aAAZ,CAA0B13E,EAAE,CAACC,IAAH,CAAQ+B,EAAlC,EACCN,IADD,CACM,SAASC,IAAT,CAAc,CAChB,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CACX/D,EAAE,CAACqF,KAAH,CAAW1D,IAAI,CAAC0D,KAAhB,CAED;AACA,GAAIsyE,CAAAA,WAAW,CAAG,IAAlB,CACA,GAAI,CACA,GAAIC,CAAAA,MAAM,CAAGhtC,YAAY,CAACitC,OAAb,CAAqB,2BAArB,CAAb,CACA,GAAID,MAAM,GAAK,IAAf,CAAqB,CACjBD,WAAW,CAAGC,MAAd,CAAsB;AACzB,CACJ,CAAC,MAAMr1E,CAAN,CAAS,CAAE,CAEb,GAAIu1E,CAAAA,YAAY,CAAG,IAAnB,CACA,GAAIH,WAAW,GAAK,IAApB,CAA0B,CACtB,IAAK,GAAI71E,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAG9B,EAAE,CAACqF,KAAH,CAAStD,MAA7B,CAAqCD,CAAC,EAAtC,CAA0C,CACtC;AACA,GAAIuhC,MAAM,CAACrjC,EAAE,CAACqF,KAAH,CAASvD,CAAT,EAAYE,EAAb,CAAN,GAA2BqhC,MAAM,CAACs0C,WAAD,CAArC,CAAoD,CAChDG,YAAY,CAAG93E,EAAE,CAACqF,KAAH,CAASvD,CAAT,CAAf,CACA,MACH,CACJ,CACJ,CAED;AACA,GAAI,CAACg2E,YAAL,CAAmB,CACfA,YAAY,CAAG93E,EAAE,CAACqF,KAAH,CAAS,CAAT,CAAf,CACH,CAEDrF,EAAE,CAAC6P,IAAH,CAAUioE,YAAV,CACAh4E,UAAU,CAACI,OAAX,CAAmBC,WAAnB,CAA+BgtC,kBAA/B,CAAoD2qC,YAApD,CACAxxC,YAAY,CAAC95B,GAAb,CAAiB,SAAjB,CAA4B1M,UAAU,CAACI,OAAvC,EAEA;AACA,GAAI,CACA0qC,YAAY,CAACmtC,OAAb,CAAqB,2BAArB,CAAkD10C,MAAM,CAACy0C,YAAY,CAAC91E,EAAd,CAAxD,EACH,CAAC,MAAMO,CAAN,CAAS,CAAE,CAEhB,CArCD,IAqCO,CACH;AACAxC,SAAS,CAACgR,IAAV,CAAe,QAAf,EACH,CAGJ,CA7CD,EAgDA/Q,EAAE,CAACg4E,cAAH,CAAoB,SAASnoE,IAAT,CAAe,CAC/B7P,EAAE,CAAC6P,IAAH,CAAUA,IAAV,CACA/P,UAAU,CAACI,OAAX,CAAmBC,WAAnB,CAA+BgtC,kBAA/B,CAAoDt9B,IAApD,CACAy2B,YAAY,CAAC95B,GAAb,CAAiB,SAAjB,CAA4B1M,UAAU,CAACI,OAAvC,EAEA;AACA,GAAI,CACA0qC,YAAY,CAACmtC,OAAb,CAAqB,2BAArB,CAAkD10C,MAAM,CAACxzB,IAAI,CAAC7N,EAAN,CAAxD,EACH,CAAC,MAAMO,CAAN,CAAS,CAAE,CAEbiR,OAAO,CAACnN,GAAR,CAAY,mBAAZ,CAAiCwJ,IAAI,CAAClK,KAAtC,EACH,CAXD,CAcA+mC,cAAc,GAEd,QAASA,CAAAA,cAAT,EAA0B,CACvB;AACAurC,aAAa,GACf,CAED,QAASA,CAAAA,aAAT,EAAwB,CAEpB/2E,cAAc,CAACg3E,oBAAf,CAAoCl4E,EAAE,CAACC,IAAH,CAAQ+B,EAA5C,EACaN,IADb,CACkB,SAASC,IAAT,CAAc,CAEhB3B,EAAE,CAACs3E,QAAH,CAAc31E,IAAI,CAAC21E,QAAnB,CACAt3E,EAAE,CAACu3E,MAAH,CAAY51E,IAAI,CAAC41E,MAAjB,CACAv3E,EAAE,CAACw3E,iBAAH,CAAuB71E,IAAI,CAAC61E,iBAA5B,CACA;AACH,CAPb,EAYAx/D,cAAc,CAACmgE,qBAAf,CAAqCn4E,EAAE,CAACC,IAAH,CAAQ+B,EAA7C,EACaN,IADb,CACkB,SAASC,IAAT,CAAc,CAEhB3B,EAAE,CAACmlD,QAAH,CAAcxjD,IAAI,CAACwjD,QAAnB,CAEH,CALb,EAMH,CAEDnlD,EAAE,CAACyqC,MAAH,CAAY,UAAU,CAClB;AACAlE,qBAAqB,CAACmE,MAAtB,CAA6B,SAAS/oC,IAAT,CAAc,CAE5B4kC,qBAAqB,CAACoE,gBAAtB,GAECrE,YAAY,CAACnC,MAAb,CAAoB,SAApB,EACAmC,YAAY,CAACnC,MAAb,CAAoB,SAApB,EAEA;AACA,GAAI,CAAEyG,YAAY,CAACC,UAAb,CAAwB,qBAAxB,EAAiD,CAAC,MAAMtoC,CAAN,CAAS,CAAE,CAEnExC,SAAS,CAACgR,IAAV,CAAe,QAAf,EAKP,CAfT,EAgBH,CAlBD,CAqBA/Q,EAAE,CAACkmD,cAAH,CAAoB,SAASlkD,EAAT,CAAY,CAC5B;AACA,GAAIokB,CAAAA,CAAC,CAAGqG,OAAO,CAAC,8CAAD,CAAf,CACA,GAAGrG,CAAH,CAAK,CACDpO,cAAc,CAACmuC,aAAf,CAA6BnkD,EAA7B,EACEN,IADF,CACO,SAASC,IAAT,CAAc,CAEhB,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CAEdk0E,aAAa,GAGd,CALD,IAKO,CACH72E,YAAY,CAACyD,KAAb,CAAmB,OAAnB,CAA4BlD,IAAI,CAACmD,OAAjC,EACH,CAED,CAZL,EAeA;AAEH,CAlBD,IAkBO,CACH,MAAO,MAAP,CACH,CACJ,CAxBD,CA0BA9E,EAAE,CAAC8/B,cAAH,CAAoB,SAAS99B,EAAT,CAAY,CAC5B;AACA,GAAIokB,CAAAA,CAAC,CAAGqG,OAAO,CAAC,8CAAD,CAAf,CACA,GAAGrG,CAAH,CAAK,CACDpO,cAAc,CAACgoB,aAAf,CAA6BhgC,EAAE,CAACC,IAAH,CAAQ+B,EAArC,CAAyCA,EAAzC,EACEN,IADF,CACO,SAASC,IAAT,CAAc,CAEhB,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CAEdk0E,aAAa,GAGd,CALD,IAKO,CACH72E,YAAY,CAACyD,KAAb,CAAmB,OAAnB,CAA4BlD,IAAI,CAACmD,OAAjC,EACH,CAED,CAZL,EAeA;AAEH,CAlBD,IAkBO,CACH,MAAO,MAAP,CACH,CACJ,CAxBD,CA0BH,CACJrF,GAAG,CAACC,UAAJ,CAAe,mCAAf,CAAoD04E,iCAApD,EAEGA,iCAAiC,CAACx4E,OAAlC,CAA4C,CAAC,aAAD,CAAgB,YAAhB,CAA8B,WAA9B,CAA2C,QAA3C,CAAqD,QAArD,CAA+D,cAA/D,CAA+E,WAA/E,CAA4F,MAA5F,CAAoG,SAApG,CAA+G,eAA/G,CAA5C,CACA,QAASw4E,CAAAA,iCAAT,CAA2Cv4E,WAA3C,CAAwDC,UAAxD,CAAoEC,SAApE,CAA+EU,MAA/E,CAAuFC,MAAvF,CAA+FC,YAA/F,CAA6GC,SAA7G,CAAwHC,IAAxH,CAA8HC,OAA9H,CAAuIuX,aAAvI,CAAsJ,CAClJ,GAAIrY,CAAAA,EAAE,CAAG,IAAT,CAEG;AAEA;AACA;AACA;AACA;AACA;AAMHA,EAAE,CAACC,IAAH,CAAU,IAAV,CACAD,EAAE,CAACgyB,QAAH,CAAc,EAAd,CAGAhyB,EAAE,CAACgnB,MAAH,CAAYtmB,MAAM,CAACqmB,OAAP,CAAeplB,IAAf,CAAoBqlB,MAAhC,CACAhnB,EAAE,CAACC,IAAH,CAAUH,UAAU,CAACI,OAAX,CAAmBC,WAA7B,CACC;AAEDH,EAAE,CAACqP,OAAH,CAAcvP,UAAU,CAACI,OAAX,CAAmBC,WAAnB,EAAkCL,UAAU,CAACI,OAAX,CAAmBC,WAAnB,CAA+BgtC,kBAAjE,EAAuFrtC,UAAU,CAACI,OAAX,CAAmBC,WAAnB,CAA+BgtC,kBAA/B,CAAkDnrC,EAA3I,CAAiJlC,UAAU,CAACI,OAAX,CAAmBC,WAAnB,CAA+BgtC,kBAA/B,CAAkDnrC,EAAnM,CAAwM,CAApN,CACAhC,EAAE,CAAC2E,OAAH,CAAa3E,EAAE,CAACC,IAAH,CAAQ+B,EAArB,CAEAhC,EAAE,CAAC05C,KAAH,CAAW,EAAX,CAGA,OAAO15C,EAAE,CAACgnB,MAAV,EACI,IAAK,KAAL,CACI;AACAhnB,EAAE,CAACiyB,UAAH,CAAgB,kBAAhB,CACJ,MACA,IAAK,MAAL,CAEI;AACAomD,WAAW,GAGf,MACA,IAAK,aAAL,CAEI;AACAC,WAAW,GAGf,MACA,IAAK,MAAL,CACI;AACAjgE,aAAa,CAACqZ,kBAAd,CAAiC1xB,EAAE,CAACqP,OAApC,EACK3N,IADL,CACU,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAAC62B,OAAH,CAAal1B,IAAI,CAACmc,KAAlB,CACH,CAHL,EAIJ,MACA,IAAK,aAAL,CACI;AACAzF,aAAa,CAACkgE,kBAAd,CAAiCv4E,EAAE,CAACC,IAAH,CAAQ+B,EAAzC,EACKN,IADL,CACU,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACqF,KAAH,CAAW1D,IAAI,CAACmc,KAAhB,CACH,CAHL,EAIJ,MACA,QACI;AACJ,MAnCJ,CAuCA,QAASu6D,CAAAA,WAAT,EAAsB,CAGjB;AACDhgE,aAAa,CAACyhC,aAAd,CAA4Bn5C,YAAY,CAAC2kB,SAAzC,EACS5jB,IADT,CACc,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACuhB,MAAH,CAAY5f,IAAI,CAAC+N,IAAjB,CAEH,CAJT,EAMA2I,aAAa,CAAC8hC,kBAAd,CAAiCx5C,YAAY,CAAC2kB,SAA9C,EACS5jB,IADT,CACc,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACuhB,MAAH,CAAUm4B,KAAV,CAAkB/3C,IAAI,CAACmc,KAAvB,CAEH,CAJT,EAMAzF,aAAa,CAAC0hC,oBAAd,CAAmCp5C,YAAY,CAAC2kB,SAAhD,EACS5jB,IADT,CACc,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACuhB,MAAH,CAAUk4B,OAAV,CAAoB93C,IAAI,CAACmc,KAAzB,CACH,CAHT,EAOH,CAGD,QAASw6D,CAAAA,WAAT,EAAsB,CAElBjgE,aAAa,CAACgzC,aAAd,CAA4B1qD,YAAY,CAACuoC,SAAzC,EACSxnC,IADT,CACc,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACwpD,MAAH,CAAY7nD,IAAI,CAAC+N,IAAjB,CAEH,CAJT,EAOA2I,aAAa,CAACqzC,oBAAd,CAAmC/qD,YAAY,CAACuoC,SAAhD,EACSxnC,IADT,CACc,SAASC,IAAT,CAAc,CAEhB3B,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,CAAoBhqD,IAAI,CAACgqD,OAAzB,CAEH,CALT,EAOAtzC,aAAa,CAACuzC,gBAAd,CAA+BjrD,YAAY,CAACuoC,SAA5C,EACKxnC,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AAEA3B,EAAE,CAACwpD,MAAH,CAAUqC,GAAV,CAAgBlqD,IAAI,CAACmc,KAArB,CAEH,CANL,EAQAzF,aAAa,CAACi1C,kBAAd,CAAiC3sD,YAAY,CAACuoC,SAA9C,EACKxnC,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AAEA3B,EAAE,CAACwpD,MAAH,CAAU1rC,KAAV,CAAkBnc,IAAI,CAACmc,KAAvB,CAEH,CANL,EAQH,CAGDrd,MAAM,CAAC42B,IAAP,CAAc,UAAU,CACpBv2B,OAAO,CAACw2B,OAAR,CAAgBD,IAAhB,GACH,CAFD,CAMAqV,cAAc,GAEd,QAASA,CAAAA,cAAT,EAA0B,CACvB;AACF,CAMJ,CACJjtC,GAAG,CAACC,UAAJ,CAAe,uCAAf,CAAwD84E,qCAAxD,EAEGA,qCAAqC,CAAC54E,OAAtC,CAAgD,CAAC,aAAD,CAAgB,YAAhB,CAA8B,WAA9B,CAA2C,QAA3C,CAAqD,QAArD,CAA+D,cAA/D,CAA+E,WAA/E,CAA4F,MAA5F,CAAoG,SAApG,CAA+G,eAA/G,CAAhD,CACA,QAAS44E,CAAAA,qCAAT,CAA+C34E,WAA/C,CAA4DC,UAA5D,CAAwEC,SAAxE,CAAmFU,MAAnF,CAA2FC,MAA3F,CAAmGC,YAAnG,CAAiHC,SAAjH,CAA4HC,IAA5H,CAAkIC,OAAlI,CAA2IuX,aAA3I,CAA0J,CACtJ,GAAIrY,CAAAA,EAAE,CAAG,IAAT,CAEG;AAEA;AACA;AACA;AACA;AACA;AAMHA,EAAE,CAACC,IAAH,CAAU,IAAV,CACAD,EAAE,CAACgyB,QAAH,CAAc,EAAd,CAGAhyB,EAAE,CAACgnB,MAAH,CAAYtmB,MAAM,CAACqmB,OAAP,CAAeplB,IAAf,CAAoBqlB,MAAhC,CACAhnB,EAAE,CAACC,IAAH,CAAUH,UAAU,CAACI,OAAX,CAAmBC,WAA7B,CACA;AAEAH,EAAE,CAACqP,OAAH,CAAcvP,UAAU,CAACI,OAAX,CAAmBC,WAAnB,EAAkCL,UAAU,CAACI,OAAX,CAAmBC,WAAnB,CAA+BgtC,kBAAjE,EAAuFrtC,UAAU,CAACI,OAAX,CAAmBC,WAAnB,CAA+BgtC,kBAA/B,CAAkDnrC,EAA3I,CAAiJlC,UAAU,CAACI,OAAX,CAAmBC,WAAnB,CAA+BgtC,kBAA/B,CAAkDnrC,EAAnM,CAAwM,CAApN,CACAhC,EAAE,CAAC2E,OAAH,CAAa3E,EAAE,CAACC,IAAH,CAAQ+B,EAArB,CAEAhC,EAAE,CAAC05C,KAAH,CAAW,EAAX,CAEA15C,EAAE,CAACuhB,MAAH,CAAY,CACRm4B,KAAK,CAAE,EADC,CAERD,OAAO,CAAE,EAFD,CAAZ,CAKAz5C,EAAE,CAACwpD,MAAH,CAAY,CACRqC,GAAG,CAAE,EADG,CAERF,OAAO,CAAE,EAFD,CAGR7tC,KAAK,CAAE,EAHC,CAAZ,CAMA9d,EAAE,CAACiqD,YAAH,CAAkB,EAAlB,CACAjqD,EAAE,CAACy4E,mBAAH,CAAyB,IAAzB,CACAz4E,EAAE,CAAC04E,iBAAH,CAAuB,IAAvB,CAEA,OAAO14E,EAAE,CAACgnB,MAAV,EACI,IAAK,KAAL,CACI;AACAhnB,EAAE,CAACiyB,UAAH,CAAgB,kBAAhB,CACJ,MACA,IAAK,MAAL,CAEI;AACAomD,WAAW,GAGf,MACA,IAAK,aAAL,CAEI;AACAC,WAAW,GAGf,MACA,IAAK,MAAL,CACI;AACAjgE,aAAa,CAACqZ,kBAAd,CAAiC1xB,EAAE,CAACqP,OAApC,EACK3N,IADL,CACU,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAAC62B,OAAH,CAAal1B,IAAI,CAACmc,KAAlB,CACH,CAHL,EAIJ,MACA,QACI;AACJ,MA5BJ,CAgCA,QAASu6D,CAAAA,WAAT,EAAsB,CAGlBr4E,EAAE,CAACslB,SAAH,CAAe3kB,YAAY,CAAC2kB,SAA5B,CAEC;AACDjN,aAAa,CAACyhC,aAAd,CAA4Bn5C,YAAY,CAAC2kB,SAAzC,EACS5jB,IADT,CACc,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACuhB,MAAH,CAAY5f,IAAI,CAAC+N,IAAjB,CAGC2I,aAAa,CAAC8hC,kBAAd,CAAiCx5C,YAAY,CAAC2kB,SAA9C,EACQ5jB,IADR,CACa,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACuhB,MAAH,CAAUm4B,KAAV,CAAkB/3C,IAAI,CAACmc,KAAvB,CAEH,CAJR,EAMDzF,aAAa,CAAC0hC,oBAAd,CAAmCp5C,YAAY,CAAC2kB,SAAhD,EACS5jB,IADT,CACc,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACuhB,MAAH,CAAUk4B,OAAV,CAAoB93C,IAAI,CAACmc,KAAzB,CACH,CAHT,EAMH,CAjBT,EAsBH,CAGD,QAASw6D,CAAAA,WAAT,EAAsB,CAElBt4E,EAAE,CAACslB,SAAH,CAAe3kB,YAAY,CAAC2kB,SAA5B,CAEAjN,aAAa,CAACgzC,aAAd,CAA4B1qD,YAAY,CAACuoC,SAAzC,EACSxnC,IADT,CACc,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACwpD,MAAH,CAAY7nD,IAAI,CAAC+N,IAAjB,CAEA2I,aAAa,CAACqzC,oBAAd,CAAmC/qD,YAAY,CAACuoC,SAAhD,EACKxnC,IADL,CACU,SAASC,IAAT,CAAc,CAEZ3B,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,CAAoBhqD,IAAI,CAACgqD,OAAzB,CAEH,CALT,EAOAtzC,aAAa,CAACuzC,gBAAd,CAA+BjrD,YAAY,CAACuoC,SAA5C,EACKxnC,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AAEA3B,EAAE,CAACwpD,MAAH,CAAUqC,GAAV,CAAgBlqD,IAAI,CAACmc,KAArB,CAEH,CANL,EAQAzF,aAAa,CAACi1C,kBAAd,CAAiC3sD,YAAY,CAACuoC,SAA9C,EACKxnC,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AAEA3B,EAAE,CAACwpD,MAAH,CAAU1rC,KAAV,CAAkBnc,IAAI,CAACmc,KAAvB,CAEH,CANL,EAQA;AACA66D,kBAAkB,CAACh4E,YAAY,CAACuoC,SAAd,CAAlB,CAEH,CA9BT,EAmCH,CAED;AACA;AACA;AACA,QAASyvC,CAAAA,kBAAT,CAA4BzvC,SAA5B,CAAuC,CACnClpC,EAAE,CAACy4E,mBAAH,CAAyB,IAAzB,CACAz4E,EAAE,CAACiqD,YAAH,CAAkB,EAAlB,CACAjqD,EAAE,CAAC04E,iBAAH,CAAuB,IAAvB,CAEArgE,aAAa,CAAC21C,qBAAd,CAAoC9kB,SAApC,EACKxnC,IADL,CACU,SAASC,IAAT,CAAe,CACjB,GAAIA,IAAI,EAAIA,IAAI,CAACmc,KAAb,EAAsBnc,IAAI,CAACmc,KAAL,CAAW/b,MAAX,CAAoB,CAA9C,CAAiD,CAC7C/B,EAAE,CAACiqD,YAAH,CAAkBtoD,IAAI,CAACmc,KAAvB,CACA;AACAnV,OAAO,CAACvC,OAAR,CAAgBpG,EAAE,CAACiqD,YAAnB,CAAiC,SAAS1mD,IAAT,CAAe,CAC5CA,IAAI,CAAC0qD,QAAL,CAAgB,IAAhB,CACA1qD,IAAI,CAACinC,QAAL,CAAgB,IAAhB,CACAnyB,aAAa,CAAC61C,wBAAd,CAAuC3qD,IAAI,CAACvB,EAA5C,EACKN,IADL,CACU,SAASysD,GAAT,CAAc,CAChB,GAAIA,GAAG,EAAIA,GAAG,CAACpqD,OAAf,CAAwB,CACpBR,IAAI,CAACinC,QAAL,CAAgB2jB,GAAG,CAAC3jB,QAApB,CACAjnC,IAAI,CAAC6qD,WAAL,CAAmBD,GAAG,CAAC5qD,IAAvB,CACH,CACDA,IAAI,CAAC0qD,QAAL,CAAgB,KAAhB,CACA;AACA,GAAI,CAACjuD,EAAE,CAAC04E,iBAAJ,EAAyBn1E,IAAI,CAACinC,QAAlC,CAA4C,CACxCxqC,EAAE,CAAC04E,iBAAH,CAAuBn1E,IAAvB,CACH,CACJ,CAXL,WAYW,UAAW,CACdA,IAAI,CAAC0qD,QAAL,CAAgB,KAAhB,CACA1qD,IAAI,CAAC8qD,UAAL,CAAkB,IAAlB,CACH,CAfL,EAgBH,CAnBD,EAoBH,CAvBD,IAuBO,CACHruD,EAAE,CAACiqD,YAAH,CAAkB,EAAlB,CACH,CACDjqD,EAAE,CAACy4E,mBAAH,CAAyB,KAAzB,CACH,CA7BL,WA8BW,UAAW,CACdz4E,EAAE,CAACiqD,YAAH,CAAkB,EAAlB,CACAjqD,EAAE,CAACy4E,mBAAH,CAAyB,KAAzB,CACH,CAjCL,EAkCH,CAEDz4E,EAAE,CAAC44E,iBAAH,CAAuB,SAASr1E,IAAT,CAAe,CAClC,GAAIA,IAAI,EAAIA,IAAI,CAACinC,QAAjB,CAA2B,CACvBxqC,EAAE,CAAC04E,iBAAH,CAAuBn1E,IAAvB,CACH,CACJ,CAJD,CAMAvD,EAAE,CAAC64E,eAAH,CAAqB,UAAW,CAC5B,MAAO74E,CAAAA,EAAE,CAACiqD,YAAH,EAAmBjqD,EAAE,CAACiqD,YAAH,CAAgBloD,MAAhB,CAAyB,CAAnD,CACH,CAFD,CAIA/B,EAAE,CAAC84E,iBAAH,CAAuB,SAASC,OAAT,CAAkB,CACrC,GAAI,CAAC/4E,EAAE,CAACwpD,MAAR,CAAgB,MAAO,MAAP,CAChB,OAAOuvB,OAAP,EACI,IAAK,KAAL,CACI,MAAO/4E,CAAAA,EAAE,CAACwpD,MAAH,CAAUqC,GAAV,EAAiB7rD,EAAE,CAACwpD,MAAH,CAAUqC,GAAV,CAAc9pD,MAAd,CAAuB,CAA/C,CACJ,IAAK,WAAL,CACI,MAAO/B,CAAAA,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,EAAqB3rD,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,CAAkBV,SAAvC,EAAoDjrD,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,CAAkBV,SAAlB,CAA4BlpD,MAA5B,CAAqC,CAAhG,CACJ,IAAK,OAAL,CACI,MAAO/B,CAAAA,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,EAAqB3rD,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,CAAkBR,KAAvC,EAAgDnrD,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,CAAkBR,KAAlB,CAAwBppD,MAAxB,CAAiC,CAAxF,CACJ,IAAK,SAAL,CACI,MAAO/B,CAAAA,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,EAAqB3rD,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,CAAkBP,OAAvC,EAAkDprD,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,CAAkBP,OAAlB,CAA0BrpD,MAA1B,CAAmC,CAA5F,CACJ,IAAK,OAAL,CACI,MAAO/B,CAAAA,EAAE,CAACwpD,MAAH,CAAU1rC,KAAV,EAAmB9d,EAAE,CAACwpD,MAAH,CAAU1rC,KAAV,CAAgB/b,MAAhB,CAAyB,CAAnD,CACJ,QACI,MAAO,MAAP,CAZR,CAcH,CAhBD,CAmBAtB,MAAM,CAAC42B,IAAP,CAAc,UAAU,CACpBv2B,OAAO,CAACw2B,OAAR,CAAgBD,IAAhB,GACH,CAFD,CAMAqV,cAAc,GAEd,QAASA,CAAAA,cAAT,EAA0B,CACvB;AACF,CAMJ,CACJjtC,GAAG,CAACC,UAAJ,CAAe,oCAAf,CAAqDs5E,kCAArD,EAEGA,kCAAkC,CAACp5E,OAAnC,CAA6C,CAAC,aAAD,CAAgB,YAAhB,CAA8B,WAA9B,CAA2C,QAA3C,CAAqD,QAArD,CAA+D,cAA/D,CAA+E,WAA/E,CAA4F,MAA5F,CAAoG,SAApG,CAA+G,eAA/G,CAAgI,gBAAhI,CAAkJ,cAAlJ,CAA7C,CACA,QAASo5E,CAAAA,kCAAT,CAA4Cn5E,WAA5C,CAAyDC,UAAzD,CAAqEC,SAArE,CAAgFU,MAAhF,CAAwFC,MAAxF,CAAgGC,YAAhG,CAA8GC,SAA9G,CAAyHC,IAAzH,CAA+HC,OAA/H,CAAwIuX,aAAxI,CAAuJnX,cAAvJ,CAAuKE,YAAvK,CAAqL,CACjL,GAAIpB,CAAAA,EAAE,CAAG,IAAT,CAEG;AAEA;AACA;AACA;AACA;AACA;AAMHA,EAAE,CAACC,IAAH,CAAU,IAAV,CACAD,EAAE,CAACgyB,QAAH,CAAc,EAAd,CAGAhyB,EAAE,CAACgnB,MAAH,CAAYtmB,MAAM,CAACqmB,OAAP,CAAeplB,IAAf,CAAoBqlB,MAAhC,CACAhnB,EAAE,CAACC,IAAH,CAAUH,UAAU,CAACI,OAAX,CAAmBC,WAA7B,CACC;AAEDH,EAAE,CAACqP,OAAH,CAAavP,UAAU,CAACI,OAAX,CAAmBC,WAAnB,CAA+B84E,uBAA5C,CACAj5E,EAAE,CAAC2E,OAAH,CAAa3E,EAAE,CAACC,IAAH,CAAQ+B,EAArB,CAEAhC,EAAE,CAAC05C,KAAH,CAAW,EAAX,CAGA,OAAO15C,EAAE,CAACgnB,MAAV,EACI,IAAK,KAAL,CACI;AACAhnB,EAAE,CAACiyB,UAAH,CAAgB,kBAAhB,CACJ,MACA,IAAK,MAAL,CAEI;AACAomD,WAAW,GAGf,MACA,IAAK,aAAL,CACIr4E,EAAE,CAACk5E,eAAH,CAAqBv4E,YAAY,CAACuoC,SAAlC,CAEA;AACAovC,WAAW,GAGf,MACA,IAAK,MAAL,CACI;AAEAp3E,cAAc,CAACi4E,kBAAf,CAAkCn5E,EAAE,CAACC,IAAH,CAAQ+B,EAA1C,EACKN,IADL,CACU,SAASC,IAAT,CAAc,CAEhB3B,EAAE,CAACo5E,SAAH,CAAez3E,IAAI,CAACy3E,SAApB,CAEH,CALL,EAQJ,MACA,IAAK,cAAL,CACI;AAEAl4E,cAAc,CAACm4E,oBAAf,CAAoCr5E,EAAE,CAACC,IAAH,CAAQ+B,EAA5C,EACKN,IADL,CACU,SAASC,IAAT,CAAc,CAEhB3B,EAAE,CAACo5E,SAAH,CAAez3E,IAAI,CAACy3E,SAApB,CAEH,CALL,EAQJ,MACA,IAAK,SAAL,CACI;AACA;AACAp5E,EAAE,CAAC8iB,kBAAH,CAAwBniB,YAAY,CAACmiB,kBAArC,CACA9iB,EAAE,CAACyd,UAAH,CAAgB9c,YAAY,CAAC8c,UAA7B,CAEAjK,OAAO,CAACnN,GAAR,CAAY,eAAZ,CAA6B1F,YAA7B,EAEAX,EAAE,CAACs5E,UAAH,CAAgB,CAAhB,CACA,GAAG34E,YAAY,CAAC+vB,aAAb,EAA8B/vB,YAAY,CAAC+vB,aAAb,CAA6B,CAA9D,CAAgE,CAC5D1wB,EAAE,CAAC0wB,aAAH,CAAmB/vB,YAAY,CAAC+vB,aAAhC,CACA1wB,EAAE,CAACs5E,UAAH,CAAgB,CAAhB,CACA9lE,OAAO,CAACnN,GAAR,CAAY,iBAAZ,CAA+BrG,EAAE,CAAC0wB,aAAlC,EACH,CACD,GAAG/vB,YAAY,CAACgwB,gBAAb,EAAiChwB,YAAY,CAACgwB,gBAAb,CAAgC,CAApE,CAAsE,CAClE3wB,EAAE,CAAC2wB,gBAAH,CAAsBhwB,YAAY,CAACgwB,gBAAnC,CACA3wB,EAAE,CAACs5E,UAAH,CAAgB,CAAhB,CACH,CAED;AAEA,GAAGt5E,EAAE,CAAC8iB,kBAAH,CAAwB,CAA3B,CAA6B,CAEzB;AACA;AACA;AACA5hB,cAAc,CAACq4E,mBAAf,CAAmCv5E,EAAE,CAAC8iB,kBAAtC,EACKphB,IADL,CACU,SAASC,IAAT,CAAc,CAChB,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CACZ/D,EAAE,CAACw5E,WAAH,CAAiB73E,IAAI,CAAC63E,WAAtB,CACAx5E,EAAE,CAACslB,SAAH,CAAe3jB,IAAI,CAAC2jB,SAApB,CACAtlB,EAAE,CAACy5E,cAAH,CAAoB93E,IAAI,CAAC0N,OAAzB,CACArP,EAAE,CAACwpD,MAAH,CAAY7nD,IAAI,CAAC6nD,MAAjB,CACAxpD,EAAE,CAAC05E,SAAH,CAAe/3E,IAAI,CAAC+3E,SAApB,CACA15E,EAAE,CAAC6I,SAAH,CAAe7I,EAAE,CAACwpD,MAAH,CAAUxnD,EAAzB,CACAhC,EAAE,CAAC25E,OAAH,CAAah4E,IAAI,CAACg4E,OAAlB,CACA35E,EAAE,CAACie,UAAH,CAAgBtc,IAAI,CAACsc,UAArB,CACAje,EAAE,CAACktB,eAAH,CAAqBvrB,IAAI,CAACi4E,SAA1B,CAEA;AACA,GAAI55E,EAAE,CAACwpD,MAAH,EAAaxpD,EAAE,CAACwpD,MAAH,CAAUxnD,EAA3B,CAA+B,CAC3B22E,kBAAkB,CAAC34E,EAAE,CAACwpD,MAAH,CAAUxnD,EAAX,CAAlB,CACH,CAEDqW,aAAa,CAAC0hC,oBAAd,CAAmC/5C,EAAE,CAACslB,SAAtC,EACC5jB,IADD,CACM,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAAC65E,WAAH,CAAiBl4E,IAAI,CAACmc,KAAtB,CACA;AACA,IAAK,GAAIhc,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAG9B,EAAE,CAAC65E,WAAH,CAAe93E,MAAnC,CAA2CD,CAAC,EAA5C,CAAgD,CAC5C,GAAIuhC,MAAM,CAACrjC,EAAE,CAAC65E,WAAH,CAAe/3E,CAAf,EAAkBE,EAAnB,CAAN,GAAiCqhC,MAAM,CAACrjC,EAAE,CAACwpD,MAAH,CAAUxnD,EAAX,CAA3C,CAA2D,CACvDhC,EAAE,CAAC85E,2BAAH,CAAiC95E,EAAE,CAAC65E,WAAH,CAAe/3E,CAAf,CAAjC,CACA,MACH,CACJ,CACJ,CAVD,EAYAuW,aAAa,CAAC+hC,iBAAd,CAAgCp6C,EAAE,CAACslB,SAAnC,EACC5jB,IADD,CACM,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAAC+5E,QAAH,CAAcp4E,IAAI,CAACmc,KAAnB,CACA9d,EAAE,CAACg6E,oBAAH,CAA0B,EAA1B,CACH,CAJD,EAMH,CAlCD,IAkCO,CACH54E,YAAY,CAACyD,KAAb,CAAmB,aAAnB,CAAkC,2DAAlC,EACH,CAEJ,CAxCL,EA4CH,CAjDD,IAiDO,CACH;AACA3D,cAAc,CAAC+4E,gBAAf,CAAgCj6E,EAAE,CAACyd,UAAnC,EACK/b,IADL,CACU,SAASC,IAAT,CAAc,CAChB,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CACZ/D,EAAE,CAACw5E,WAAH,CAAiB73E,IAAI,CAAC63E,WAAtB,CACAx5E,EAAE,CAACslB,SAAH,CAAe3jB,IAAI,CAAC2jB,SAApB,CACAtlB,EAAE,CAACy5E,cAAH,CAAoB93E,IAAI,CAAC0N,OAAzB,CACArP,EAAE,CAACwpD,MAAH,CAAY7nD,IAAI,CAAC6nD,MAAjB,CACAxpD,EAAE,CAAC05E,SAAH,CAAe/3E,IAAI,CAAC+3E,SAApB,CACA15E,EAAE,CAAC6I,SAAH,CAAe7I,EAAE,CAACwpD,MAAH,CAAUxnD,EAAzB,CACAhC,EAAE,CAAC25E,OAAH,CAAah4E,IAAI,CAACg4E,OAAlB,CACA35E,EAAE,CAACie,UAAH,CAAgBtc,IAAI,CAACsc,UAArB,CACAje,EAAE,CAACktB,eAAH,CAAqBvrB,IAAI,CAACi4E,SAA1B,CAEA;AACA,GAAI55E,EAAE,CAACwpD,MAAH,EAAaxpD,EAAE,CAACwpD,MAAH,CAAUxnD,EAA3B,CAA+B,CAC3B22E,kBAAkB,CAAC34E,EAAE,CAACwpD,MAAH,CAAUxnD,EAAX,CAAlB,CACH,CAEDqW,aAAa,CAAC0hC,oBAAd,CAAmC/5C,EAAE,CAACslB,SAAtC,EACC5jB,IADD,CACM,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAAC65E,WAAH,CAAiBl4E,IAAI,CAACmc,KAAtB,CACA;AACA,IAAK,GAAIhc,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAG9B,EAAE,CAAC65E,WAAH,CAAe93E,MAAnC,CAA2CD,CAAC,EAA5C,CAAgD,CAC5C,GAAIuhC,MAAM,CAACrjC,EAAE,CAAC65E,WAAH,CAAe/3E,CAAf,EAAkBE,EAAnB,CAAN,GAAiCqhC,MAAM,CAACrjC,EAAE,CAACwpD,MAAH,CAAUxnD,EAAX,CAA3C,CAA2D,CACvDhC,EAAE,CAAC85E,2BAAH,CAAiC95E,EAAE,CAAC65E,WAAH,CAAe/3E,CAAf,CAAjC,CACA,MACH,CACJ,CACJ,CAVD,EAYAuW,aAAa,CAAC+hC,iBAAd,CAAgCp6C,EAAE,CAACslB,SAAnC,EACC5jB,IADD,CACM,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAAC+5E,QAAH,CAAcp4E,IAAI,CAACmc,KAAnB,CACA9d,EAAE,CAACg6E,oBAAH,CAA0B,EAA1B,CACH,CAJD,EAMH,CAlCD,IAkCO,CACH54E,YAAY,CAACyD,KAAb,CAAmB,aAAnB,CAAkC,2DAAlC,EACH,CAEJ,CAxCL,EAyCH,CAED7E,EAAE,CAACk6E,iBAAH,CAAuB,IAAvB,CAMJ,MACA,QACI;AACJ,MAxKJ,CA2KAl6E,EAAE,CAACm6E,gBAAH,CAAsB,KAAtB,CACAn6E,EAAE,CAACo6E,eAAH,CAAqB,IAArB,CAEAp6E,EAAE,CAACq6E,iBAAH,CAAuB,UAAU,CAC7B7mE,OAAO,CAACnN,GAAR,CAAYrG,EAAE,CAACktB,eAAf,EAEAltB,EAAE,CAACo6E,eAAH,CAAqB,IAArB,CACH,CAJD,CAMAp6E,EAAE,CAACs6E,yBAAH,CAA+B,UAAU,CAErC,GAAIhvE,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAAtC,CAA4Cv6E,EAAE,CAACktB,eAAH,CAAmB5P,oBAAnB,CAA0C,EAAzF,CAA6F,CACzFtd,EAAE,CAACu6E,eAAH,CAAsBv6E,EAAE,CAACktB,eAAH,CAAmB5P,oBAAnB,CAA0C,EAAhE,CACAtd,EAAE,CAACu6E,eAAH,CAAqBjvE,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAA1D,CACH,CAED,GAAIjvE,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAAtC,EAA4C,CAA/C,CAAiD,CAC7Cv6E,EAAE,CAACu6E,eAAH,CAAqB,CAArB,CACH,CAED,GAAGv6E,EAAE,CAACo6E,eAAN,CAAsB,CAClBp6E,EAAE,CAACu6E,eAAH,CAAsBv6E,EAAE,CAACktB,eAAH,CAAmB5P,oBAAnB,CAA0C,EAAhE,CACAtd,EAAE,CAACu6E,eAAH,CAAqBjvE,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAA1D,CACH,CAHD,IAGO,CACH/mE,OAAO,CAACnN,GAAR,CAAY,iBAAZ,EACAmN,OAAO,CAACnN,GAAR,CAAYrG,EAAE,CAACktB,eAAf,EACH,CAEJ,CAnBD,CAqBAltB,EAAE,CAACw6E,iBAAH,CAAuB,UAAU,CAC7Bx6E,EAAE,CAACm6E,gBAAH,CAAsB,CAACn6E,EAAE,CAACm6E,gBAA1B,CACA,GAAGn6E,EAAE,CAACm6E,gBAAN,CAAuB,CACnBn6E,EAAE,CAAC6I,SAAH,CAAe,EAAf,CACA7I,EAAE,CAACwF,UAAH,CAAgB,EAAhB,CACH,CAHD,IAGO,CACHxF,EAAE,CAAC6I,SAAH,CAAe7I,EAAE,CAACwpD,MAAH,CAAUxnD,EAAzB,CACAhC,EAAE,CAACwF,UAAH,CAAgB,EAAhB,CACH,CACJ,CATD,CAWAxF,EAAE,CAACy6E,kBAAH,CAAwB,UAAU,CAE9B,GAAGz6E,EAAE,CAACm6E,gBAAN,CAAuB,CACnBn6E,EAAE,CAAC6I,SAAH,CAAe7I,EAAE,CAACwF,UAAlB,CACH,CAFD,IAEO,CACC,GAAGxF,EAAE,CAACwF,UAAH,CAAczD,MAAd,CAAuB,CAA1B,CAA4B,CACxB/B,EAAE,CAAC6I,SAAH,CAAe7I,EAAE,CAACwF,UAAlB,CACH,CAFD,IAEO,CACHxF,EAAE,CAAC6I,SAAH,CAAe7I,EAAE,CAACwpD,MAAH,CAAUxnD,EAAzB,CACH,CACR,CAEJ,CAZD,CAcAhC,EAAE,CAAC06E,aAAH,CAAmB,UAAU,CAEzB,GAAIC,CAAAA,cAAc,CAAG,EAArB,CACA,IAAI,GAAI74E,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAAC9B,EAAE,CAAC05E,SAAH,CAAa33E,MAA3B,CAAkCD,CAAC,EAAnC,CAAsC,CAClC,GAAK9B,EAAE,CAAC05E,SAAH,CAAa53E,CAAb,EAAgB8sB,MAAhB,EAA0B5uB,EAAE,CAAC05E,SAAH,CAAa53E,CAAb,EAAgB8sB,MAAhB,CAAyB,CAApD,EAA2D5uB,EAAE,CAAC05E,SAAH,CAAa53E,CAAb,EAAgB84E,OAAhB,EAA2B56E,EAAE,CAAC05E,SAAH,CAAa53E,CAAb,EAAgB8sB,MAAhB,GAA2B,EAArH,CAA0H,CACtH+rD,cAAc,CAACn4E,IAAf,CAAoBxC,EAAE,CAAC05E,SAAH,CAAa53E,CAAb,CAApB,EACH,CACJ,CAID;AAEA;AACA;AAEA,GAAG64E,cAAc,CAAC54E,MAAf,CAAwB,CAAxB,GAA8B,CAAC/B,EAAE,CAAC66E,eAAJ,EAAuB76E,EAAE,CAAC66E,eAAH,EAAsB,EAA3E,CAAH,CAAkF,CAC9Ez5E,YAAY,CAACkD,OAAb,CAAqB,YAArB,CAAmC,6GAAnC,EACA,MAAO,MAAP,CACH,CAED,GAAIw2E,CAAAA,WAAW,CAAG96E,EAAE,CAACwpD,MAAH,CAAUxnD,EAA5B,CAEA,GAAGhC,EAAE,CAAC+6E,gBAAH,EAAuB,CAAvB,EAA4B/6E,EAAE,CAAC86E,WAA/B,EAA8C96E,EAAE,CAAC86E,WAAH,CAAe94E,EAAf,CAAoB,CAArE,CAAuE,CACnE84E,WAAW,CAAG96E,EAAE,CAAC86E,WAAH,CAAe94E,EAA7B,CACH,CAED;AAEAhC,EAAE,CAACg7E,aAAH,CAAmB,CACf3rE,OAAO,CAAErP,EAAE,CAACy5E,cADG,CAEf37D,KAAK,CAAE68D,cAFQ,CAGfE,eAAe,CAAE76E,EAAE,CAAC66E,eAHL,CAIf3xC,SAAS,CAAElpC,EAAE,CAACwpD,MAAH,CAAUxnD,EAJN,CAKfsjB,SAAS,CAAEtlB,EAAE,CAACslB,SALC,CAMf3gB,OAAO,CAAE3E,EAAE,CAAC25E,OAAH,CAAW33E,EANL,CAOfgL,aAAa,CAAEhN,EAAE,CAACie,UAAH,CAAcjc,EAPd,CAQfi5E,YAAY,CAAEj7E,EAAE,CAACC,IAAH,CAAQ+B,EARP,CASf8gB,kBAAkB,CAAE9iB,EAAE,CAACktB,eAAH,CAAmBlrB,EATxB,CAUfk5E,cAAc,CAAEJ,WAVD,CAWf/mD,SAAS,CAAG/zB,EAAE,CAAC+6E,gBAAJ,CAAwB,CAAxB,CAA4B,CAXxB,CAYft9D,UAAU,CAAEzd,EAAE,CAACyd,UAZA,CAaf09D,WAAW,CAAEn7E,EAAE,CAACg6E,oBAbD,CAAnB,CAgBA;AACA;AAEA;AAEA3hE,aAAa,CAAC+iE,oBAAd,CAAmCp7E,EAAE,CAACg7E,aAAtC,EACKt5E,IADL,CACU,SAASC,IAAT,CAAc,CAChB,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CAEZ3C,YAAY,CAAC2C,OAAb,CAAqB,eAArB,CAAsC,YAAtC,EACA,GAAG/D,EAAE,CAACs5E,UAAH,EAAiBt5E,EAAE,CAAC0wB,aAApB,EAAqC1wB,EAAE,CAAC0wB,aAAH,CAAmB,CAA3D,CAA6D,CACzDhwB,MAAM,CAACymB,EAAP,CAAU,8BAAV,CAA0C,CAACnlB,EAAE,CAAEhC,EAAE,CAAC0wB,aAAR,CAA1C,EACA;AACH,CAHD,IAGO,CACHhwB,MAAM,CAACymB,EAAP,CAAU,uBAAV,CAAmC,CAACC,MAAM,CAAE,IAAT,CAAnC,EACH,CAIJ,CAZD,IAYO,CACHhmB,YAAY,CAACyD,KAAb,CAAmB,aAAnB,CAAkC,4CAAlC,EACH,CAEJ,CAlBL,EAuBH,CAzED,CA2EA7E,EAAE,CAACu6E,eAAH,CAAqB,CAArB,CAEAv6E,EAAE,CAACg8C,OAAH,CAAa,UAAU,CACnB;AACA,GAAGh8C,EAAE,CAACg6E,oBAAH,CAAwBpqE,IAAxB,CAA6B,SAAA8rC,GAAG,QAAIA,CAAAA,GAAG,CAAC15C,EAAJ,GAAWhC,EAAE,CAACq7E,UAAH,CAAcr5E,EAA7B,EAAhC,CAAH,CAAoE,CAChEZ,YAAY,CAACkD,OAAb,CAAqB,eAArB,CAAsC,2CAAtC,EACA,MAAO,MAAP,CACH,CAED,GAAIgH,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAAtC,CAA4Cv6E,EAAE,CAACktB,eAAH,CAAmB5P,oBAAnB,CAA0C,EAAzF,CAA6F,CACzFtd,EAAE,CAACu6E,eAAH,CAAsBv6E,EAAE,CAACktB,eAAH,CAAmB5P,oBAAnB,CAA0C,EAAhE,CACAtd,EAAE,CAACu6E,eAAH,CAAqBjvE,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAA1D,CACH,CAED,GAAIjvE,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAAtC,EAA4C,CAA/C,CAAiD,CAC7Cv6E,EAAE,CAACu6E,eAAH,CAAqB,CAArB,CACH,CAED,GAAGv6E,EAAE,CAACo6E,eAAN,CAAsB,CAClBp6E,EAAE,CAACu6E,eAAH,CAAsBv6E,EAAE,CAACktB,eAAH,CAAmB5P,oBAAnB,CAA0C,EAAhE,CACAtd,EAAE,CAACu6E,eAAH,CAAqBjvE,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAA1D,CACH,CAEDv6E,EAAE,CAACq7E,UAAH,CAAcC,YAAd,CAA6Bt7E,EAAE,CAACu6E,eAAhC,CACA;AACA;AACA;AACA;AACA;AACA;AAEAv6E,EAAE,CAACg6E,oBAAH,CAAwBx3E,IAAxB,CAA6BxC,EAAE,CAACq7E,UAAhC,EACAr7E,EAAE,CAACq7E,UAAH,CAAgB,EAAhB,CACAr7E,EAAE,CAACu6E,eAAH,CAAsBv6E,EAAE,CAACktB,eAAH,CAAmB5P,oBAAnB,CAA0C,EAAhE,CACAtd,EAAE,CAACu6E,eAAH,CAAqBjvE,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAA1D,CACAv6E,EAAE,CAACo6E,eAAH,CAAqB,IAArB,CACH,CAlCD,CAoCAp6E,EAAE,CAAC87C,UAAH,CAAgB,SAASJ,GAAT,CAAch5C,KAAd,CAAoB,CAChC1C,EAAE,CAACg6E,oBAAH,CAAwBr3E,MAAxB,CAA+BD,KAA/B,CAAsC,CAAtC,EAEH,CAHD,CAKA1C,EAAE,CAACu7E,gBAAH,CAAsB,UAAU,CAC5B,GAAGv7E,EAAE,CAACu6E,eAAH,CAAqB,CAArB,GAA2B,CAA9B,CAAgC,CAC5Bv6E,EAAE,CAACu6E,eAAH,CAAqBjvE,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAA1D,CACH,CACJ,CAJD,CAMAv6E,EAAE,CAACw7E,gBAAH,CAAsB,UAAU,CAC5BhoE,OAAO,CAACnN,GAAR,CAAY,qCAAZ,EAEAmN,OAAO,CAACnN,GAAR,CAAY,gBAAZ,CAA8BrG,EAAE,CAACg6E,oBAAjC,EAEA,GAAIW,CAAAA,cAAc,CAAG,EAArB,CACA,IAAI,GAAI74E,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAAC9B,EAAE,CAAC05E,SAAH,CAAa33E,MAA3B,CAAkCD,CAAC,EAAnC,CAAsC,CAClC,GAAK9B,EAAE,CAAC05E,SAAH,CAAa53E,CAAb,EAAgB8sB,MAAhB,EAA0B5uB,EAAE,CAAC05E,SAAH,CAAa53E,CAAb,EAAgB8sB,MAAhB,CAAyB,CAApD,EAA2D5uB,EAAE,CAAC05E,SAAH,CAAa53E,CAAb,EAAgB84E,OAAhB,EAA2B56E,EAAE,CAAC05E,SAAH,CAAa53E,CAAb,EAAgB8sB,MAAhB,GAA2B,EAArH,CAA0H,CACtH+rD,cAAc,CAACn4E,IAAf,CAAoBxC,EAAE,CAAC05E,SAAH,CAAa53E,CAAb,CAApB,EACH,CACJ,CAED;AAEA;AACA;AAEA,GAAG64E,cAAc,CAAC54E,MAAf,CAAwB,CAAxB,GAA8B,CAAC/B,EAAE,CAAC66E,eAAJ,EAAuB76E,EAAE,CAAC66E,eAAH,EAAsB,EAA3E,CAAH,CAAkF,CAC9Ez5E,YAAY,CAACkD,OAAb,CAAqB,YAArB,CAAmC,6GAAnC,EACA,MAAO,MAAP,CACH,CAED,GAAIw2E,CAAAA,WAAW,CAAG96E,EAAE,CAACwpD,MAAH,CAAUxnD,EAA5B,CAEA,GAAGhC,EAAE,CAAC+6E,gBAAH,EAAuB,CAAvB,EAA4B/6E,EAAE,CAAC86E,WAA/B,EAA8C96E,EAAE,CAAC86E,WAAH,CAAe94E,EAAf,CAAoB,CAArE,CAAuE,CACnE84E,WAAW,CAAG96E,EAAE,CAAC86E,WAAH,CAAe94E,EAA7B,CACH,CAGDhC,EAAE,CAACg7E,aAAH,CAAmB,CACf3rE,OAAO,CAAErP,EAAE,CAACy5E,cADG,CAEf37D,KAAK,CAAE68D,cAFQ,CAGfE,eAAe,CAAE76E,EAAE,CAAC66E,eAHL,CAIf3xC,SAAS,CAAElpC,EAAE,CAACwpD,MAAH,CAAUxnD,EAJN,CAKfsjB,SAAS,CAAEtlB,EAAE,CAACslB,SALC,CAMf3gB,OAAO,CAAE3E,EAAE,CAAC25E,OAAH,CAAW33E,EANL,CAOfgL,aAAa,CAAEhN,EAAE,CAACie,UAAH,CAAcjc,EAPd,CAQfi5E,YAAY,CAAEj7E,EAAE,CAACC,IAAH,CAAQ+B,EARP,CASf8gB,kBAAkB,CAAE9iB,EAAE,CAACktB,eAAH,CAAmBlrB,EATxB,CAUfk5E,cAAc,CAAEJ,WAVD,CAWf/mD,SAAS,CAAG/zB,EAAE,CAAC+6E,gBAAJ,CAAwB,CAAxB,CAA4B,CAXxB,CAYft9D,UAAU,CAAEzd,EAAE,CAACyd,UAZA,CAaf09D,WAAW,CAAEn7E,EAAE,CAACg6E,oBAbD,CAAnB,CAeAxmE,OAAO,CAACnN,GAAR,CAAY,eAAZ,EACAmN,OAAO,CAACnN,GAAR,CAAYrG,EAAE,CAACg7E,aAAf,EACAxnE,OAAO,CAACnN,GAAR,CAAY,eAAZ,EAEH,CAhDD,CAkDA,QAASgyE,CAAAA,WAAT,EAAsB,CAGjB;AACDhgE,aAAa,CAACyhC,aAAd,CAA4Bn5C,YAAY,CAAC2kB,SAAzC,EACS5jB,IADT,CACc,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACuhB,MAAH,CAAY5f,IAAI,CAAC+N,IAAjB,CAEA2I,aAAa,CAAC8hC,kBAAd,CAAiCx5C,YAAY,CAAC2kB,SAA9C,EACS5jB,IADT,CACc,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACuhB,MAAH,CAAUm4B,KAAV,CAAkB/3C,IAAI,CAACmc,KAAvB,CAEH,CAJT,EAMAzF,aAAa,CAAC0hC,oBAAd,CAAmCp5C,YAAY,CAAC2kB,SAAhD,EACS5jB,IADT,CACc,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACuhB,MAAH,CAAUk4B,OAAV,CAAoB93C,IAAI,CAACmc,KAAzB,CACH,CAHT,EAKAzF,aAAa,CAAC+hC,iBAAd,CAAgCz5C,YAAY,CAAC2kB,SAA7C,EACC5jB,IADD,CACM,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAAC+5E,QAAH,CAAcp4E,IAAI,CAACmc,KAAnB,CAEH,CAJD,EAMH,CArBT,EA2BH,CAED9d,EAAE,CAACwpD,MAAH,CAAY,EAAZ,CACAxpD,EAAE,CAACy7E,mBAAH,CAAyB,IAAzB,CACAz7E,EAAE,CAAC85E,2BAAH,CAAiC,IAAjC,CACA95E,EAAE,CAAC07E,0BAAH,CAAgC,IAAhC,CACA17E,EAAE,CAAC27E,oBAAH,CAA0B,KAA1B,CACA37E,EAAE,CAACiqD,YAAH,CAAkB,EAAlB,CACAjqD,EAAE,CAACy4E,mBAAH,CAAyB,IAAzB,CACAz4E,EAAE,CAAC04E,iBAAH,CAAuB,IAAvB,CAEA14E,EAAE,CAAC47E,aAAH,CAAmB,UAAU,CACzB,GAAI57E,EAAE,CAACy7E,mBAAP,CAA4B,CACxBz7E,EAAE,CAACk5E,eAAH,CAAqBl5E,EAAE,CAACy7E,mBAAH,CAAuBz5E,EAA5C,CACAs2E,WAAW,GACd,CACJ,CALD,CAOAt4E,EAAE,CAAC67E,6BAAH,CAAmC,UAAU,CACzC,GAAI77E,EAAE,CAAC07E,0BAAP,CAAmC,CAC/B17E,EAAE,CAAC85E,2BAAH,CAAiC95E,EAAE,CAAC07E,0BAApC,CACA17E,EAAE,CAAC07E,0BAAH,CAAgC,IAAhC,CACA17E,EAAE,CAAC27E,oBAAH,CAA0B,KAA1B,CACA37E,EAAE,CAAC87E,qBAAH,GACH,CACJ,CAPD,CASA97E,EAAE,CAAC+7E,4BAAH,CAAkC,UAAU,CACxC/7E,EAAE,CAAC07E,0BAAH,CAAgC,IAAhC,CACA17E,EAAE,CAAC27E,oBAAH,CAA0B,KAA1B,CACH,CAHD,CAKA37E,EAAE,CAAC87E,qBAAH,CAA2B,UAAU,CACjC,GAAI97E,EAAE,CAAC85E,2BAAP,CAAoC,CAChC,GAAI5wC,CAAAA,SAAS,CAAGlpC,EAAE,CAAC85E,2BAAH,CAA+B93E,EAA/C,CAEAqW,aAAa,CAACgzC,aAAd,CAA4BniB,SAA5B,EACKxnC,IADL,CACU,SAASC,IAAT,CAAc,CAChB,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CACZ/D,EAAE,CAACwpD,MAAH,CAAY7nD,IAAI,CAAC+N,IAAjB,CACA1P,EAAE,CAAC6I,SAAH,CAAe7I,EAAE,CAACwpD,MAAH,CAAUxnD,EAAzB,CAEAqW,aAAa,CAACqzC,oBAAd,CAAmCxiB,SAAnC,EACKxnC,IADL,CACU,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,CAAoBhqD,IAAI,CAACgqD,OAAzB,CACH,CAHL,EAKAtzC,aAAa,CAACuzC,gBAAd,CAA+B1iB,SAA/B,EACKxnC,IADL,CACU,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACwpD,MAAH,CAAUqC,GAAV,CAAgBlqD,IAAI,CAACmc,KAArB,CACH,CAHL,EAKAzF,aAAa,CAACi1C,kBAAd,CAAiCpkB,SAAjC,EACKxnC,IADL,CACU,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACwpD,MAAH,CAAU1rC,KAAV,CAAkBnc,IAAI,CAACmc,KAAvB,CAEA;AACA,GAAInc,IAAI,CAACmc,KAAL,EAAcnc,IAAI,CAACmc,KAAL,CAAW/b,MAAX,CAAoB,CAAtC,CAAyC,CACrC;AACA4G,OAAO,CAACvC,OAAR,CAAgBzE,IAAI,CAACmc,KAArB,CAA4B,SAASk+D,OAAT,CAAkB,CAC1C,GAAIC,CAAAA,MAAM,CAAGj8E,EAAE,CAAC05E,SAAH,CAAajzD,IAAb,CAAkB,SAASy1D,QAAT,CAAmB,CAC9C,MAAO74C,CAAAA,MAAM,CAAC64C,QAAQ,CAACl6E,EAAV,CAAN,GAAwBqhC,MAAM,CAAC24C,OAAO,CAACh6E,EAAT,CAArC,CACH,CAFY,CAAb,CAGA,GAAI,CAACi6E,MAAL,CAAa,CACTj8E,EAAE,CAAC05E,SAAH,CAAal3E,IAAb,CAAkBw5E,OAAlB,EACH,CACJ,CAPD,EAQH,CACJ,CAhBL,EAkBArD,kBAAkB,CAACzvC,SAAD,CAAlB,CACH,CACJ,CApCL,EAqCH,CACJ,CA1CD,CA4CA,QAASovC,CAAAA,WAAT,EAAsB,CAElBt4E,EAAE,CAACyd,UAAH,CAAgB9c,YAAY,CAAC8c,UAA7B,CAEApF,aAAa,CAACgzC,aAAd,CAA4BrrD,EAAE,CAACk5E,eAA/B,EACSx3E,IADT,CACc,SAASC,IAAT,CAAc,CAEhB,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CAIX/D,EAAE,CAACwpD,MAAH,CAAY7nD,IAAI,CAAC+N,IAAjB,CAGA2I,aAAa,CAAC0hC,oBAAd,CAAmCp4C,IAAI,CAAC+N,IAAL,CAAU4V,SAA7C,EACE5jB,IADF,CACO,SAASC,IAAT,CAAc,CAEV3B,EAAE,CAAC65E,WAAH,CAAiBl4E,IAAI,CAACmc,KAAtB,CAEA;AACA,IAAK,GAAIhc,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAG9B,EAAE,CAAC65E,WAAH,CAAe93E,MAAnC,CAA2CD,CAAC,EAA5C,CAAgD,CAC5C,GAAIuhC,MAAM,CAACrjC,EAAE,CAAC65E,WAAH,CAAe/3E,CAAf,EAAkBE,EAAnB,CAAN,GAAiCqhC,MAAM,CAACrjC,EAAE,CAACk5E,eAAJ,CAA3C,CAAiE,CAC7Dl5E,EAAE,CAACy7E,mBAAH,CAAyBz7E,EAAE,CAAC65E,WAAH,CAAe/3E,CAAf,CAAzB,CACA,MACH,CACJ,CAEJ,CAbR,EAeAuW,aAAa,CAACqzC,oBAAd,CAAmC1rD,EAAE,CAACk5E,eAAtC,EACQx3E,IADR,CACa,SAASC,IAAT,CAAc,CAEhB3B,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,CAAoBhqD,IAAI,CAACgqD,OAAzB,CAEH,CALR,EAODtzC,aAAa,CAACuzC,gBAAd,CAA+B5rD,EAAE,CAACk5E,eAAlC,EACKx3E,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AAEA3B,EAAE,CAACwpD,MAAH,CAAUqC,GAAV,CAAgBlqD,IAAI,CAACmc,KAArB,CAEH,CANL,EAQAzF,aAAa,CAACi1C,kBAAd,CAAiCttD,EAAE,CAACk5E,eAApC,EACKx3E,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AAEA3B,EAAE,CAACwpD,MAAH,CAAU1rC,KAAV,CAAkBnc,IAAI,CAACmc,KAAvB,CAEH,CANL,EAQA;AACA66D,kBAAkB,CAAC34E,EAAE,CAACk5E,eAAJ,CAAlB,CACH,CAKJ,CAvDT,EA4DH,CAEDl5E,EAAE,CAACm8E,WAAH,CAAiB,UAAU,CAEvB,GAAIC,CAAAA,WAAW,CAAG,CAAC3+D,UAAU,CAAEzd,EAAE,CAACyd,UAAhB,CAA4B4+D,OAAO,CAAE,CAArC,CAAlB,CACAn7E,cAAc,CAACo7E,mBAAf,CAAmCt8E,EAAE,CAACyd,UAAtC,EACS/b,IADT,CACc,SAASC,IAAT,CAAc,CAEhB,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CAEZrD,MAAM,CAACymB,EAAP,CAAU,2CAAV,CAAuD,CAAC1J,UAAU,CAAEzd,EAAE,CAACyd,UAAhB,CAA4ByrB,SAAS,CAAElpC,EAAE,CAACk5E,eAA1C,CAAvD,EAEH,CAJD,IAIO,CAEH93E,YAAY,CAACyD,KAAb,CAAmB,gBAAnB,CAAqC,kCAArC,EAEH,CAEJ,CAbT,EAcH,CAjBD,CAoBApE,MAAM,CAAC42B,IAAP,CAAc,UAAU,CACpBv2B,OAAO,CAACw2B,OAAR,CAAgBD,IAAhB,GACH,CAFD,CAMAqV,cAAc,GAEd,QAASA,CAAAA,cAAT,EAA0B,CACvB;AACF,CAGD;AACA;AACA;AACA,QAASisC,CAAAA,kBAAT,CAA4BzvC,SAA5B,CAAuC,CACnClpC,EAAE,CAACy4E,mBAAH,CAAyB,IAAzB,CACAz4E,EAAE,CAACiqD,YAAH,CAAkB,EAAlB,CACAjqD,EAAE,CAAC04E,iBAAH,CAAuB,IAAvB,CAEArgE,aAAa,CAAC21C,qBAAd,CAAoC9kB,SAApC,EACKxnC,IADL,CACU,SAASC,IAAT,CAAe,CACjB,GAAIA,IAAI,EAAIA,IAAI,CAACmc,KAAb,EAAsBnc,IAAI,CAACmc,KAAL,CAAW/b,MAAX,CAAoB,CAA9C,CAAiD,CAC7C/B,EAAE,CAACiqD,YAAH,CAAkBtoD,IAAI,CAACmc,KAAvB,CACAnV,OAAO,CAACvC,OAAR,CAAgBpG,EAAE,CAACiqD,YAAnB,CAAiC,SAAS1mD,IAAT,CAAe,CAC5CA,IAAI,CAAC0qD,QAAL,CAAgB,IAAhB,CACA1qD,IAAI,CAACinC,QAAL,CAAgB,IAAhB,CACAnyB,aAAa,CAAC61C,wBAAd,CAAuC3qD,IAAI,CAACvB,EAA5C,EACKN,IADL,CACU,SAASysD,GAAT,CAAc,CAChB,GAAIA,GAAG,EAAIA,GAAG,CAACpqD,OAAf,CAAwB,CACpBR,IAAI,CAACinC,QAAL,CAAgB2jB,GAAG,CAAC3jB,QAApB,CACAjnC,IAAI,CAAC6qD,WAAL,CAAmBD,GAAG,CAAC5qD,IAAvB,CACH,CACDA,IAAI,CAAC0qD,QAAL,CAAgB,KAAhB,CACA,GAAI,CAACjuD,EAAE,CAAC04E,iBAAJ,EAAyBn1E,IAAI,CAACinC,QAAlC,CAA4C,CACxCxqC,EAAE,CAAC04E,iBAAH,CAAuBn1E,IAAvB,CACH,CACJ,CAVL,WAWW,UAAW,CACdA,IAAI,CAAC0qD,QAAL,CAAgB,KAAhB,CACA1qD,IAAI,CAAC8qD,UAAL,CAAkB,IAAlB,CACH,CAdL,EAeH,CAlBD,EAmBH,CArBD,IAqBO,CACHruD,EAAE,CAACiqD,YAAH,CAAkB,EAAlB,CACH,CACDjqD,EAAE,CAACy4E,mBAAH,CAAyB,KAAzB,CACH,CA3BL,WA4BW,UAAW,CACdz4E,EAAE,CAACiqD,YAAH,CAAkB,EAAlB,CACAjqD,EAAE,CAACy4E,mBAAH,CAAyB,KAAzB,CACH,CA/BL,EAgCH,CAEDz4E,EAAE,CAAC44E,iBAAH,CAAuB,SAASr1E,IAAT,CAAe,CAClC,GAAIA,IAAI,EAAIA,IAAI,CAACinC,QAAjB,CAA2B,CACvBxqC,EAAE,CAAC04E,iBAAH,CAAuBn1E,IAAvB,CACH,CACJ,CAJD,CAMAvD,EAAE,CAAC64E,eAAH,CAAqB,UAAW,CAC5B,MAAO74E,CAAAA,EAAE,CAACiqD,YAAH,EAAmBjqD,EAAE,CAACiqD,YAAH,CAAgBloD,MAAhB,CAAyB,CAAnD,CACH,CAFD,CAIA/B,EAAE,CAAC84E,iBAAH,CAAuB,SAASC,OAAT,CAAkB,CACrC,GAAI,CAAC/4E,EAAE,CAACwpD,MAAR,CAAgB,MAAO,MAAP,CAChB,OAAOuvB,OAAP,EACI,IAAK,KAAL,CACI,MAAO/4E,CAAAA,EAAE,CAACwpD,MAAH,CAAUqC,GAAV,EAAiB7rD,EAAE,CAACwpD,MAAH,CAAUqC,GAAV,CAAc9pD,MAAd,CAAuB,CAA/C,CACJ,IAAK,WAAL,CACI,MAAO/B,CAAAA,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,EAAqB3rD,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,CAAkBV,SAAvC,EAAoDjrD,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,CAAkBV,SAAlB,CAA4BlpD,MAA5B,CAAqC,CAAhG,CACJ,IAAK,OAAL,CACI,MAAO/B,CAAAA,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,EAAqB3rD,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,CAAkBR,KAAvC,EAAgDnrD,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,CAAkBR,KAAlB,CAAwBppD,MAAxB,CAAiC,CAAxF,CACJ,IAAK,SAAL,CACI,MAAO/B,CAAAA,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,EAAqB3rD,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,CAAkBP,OAAvC,EAAkDprD,EAAE,CAACwpD,MAAH,CAAUmC,OAAV,CAAkBP,OAAlB,CAA0BrpD,MAA1B,CAAmC,CAA5F,CACJ,IAAK,OAAL,CACI,MAAO/B,CAAAA,EAAE,CAACwpD,MAAH,CAAU1rC,KAAV,EAAmB9d,EAAE,CAACwpD,MAAH,CAAU1rC,KAAV,CAAgB/b,MAAhB,CAAyB,CAAnD,CACJ,QACI,MAAO,MAAP,CAZR,CAcH,CAhBD,CAsBH,CACJtC,GAAG,CAACC,UAAJ,CAAe,mCAAf,CAAoD68E,iCAApD,EAEGA,iCAAiC,CAAC38E,OAAlC,CAA4C,CAAC,aAAD,CAAgB,aAAhB,CAA+B,YAA/B,CAA6C,WAA7C,CAA0D,QAA1D,CAAoE,QAApE,CAA8E,cAA9E,CAA8F,WAA9F,CAA2G,MAA3G,CAAmH,SAAnH,CAA8H,eAA9H,CAA+I,gBAA/I,CAAiK,eAAjK,CAAkL,MAAlL,CAA0L,cAA1L,CAA5C,CACA,QAAS28E,CAAAA,iCAAT,CAA2C9tC,WAA3C,CAAwD5uC,WAAxD,CAAqEC,UAArE,CAAiFC,SAAjF,CAA4FU,MAA5F,CAAoGC,MAApG,CAA4GC,YAA5G,CAA0HC,SAA1H,CAAqIC,IAArI,CAA2IC,OAA3I,CAAoJuX,aAApJ,CAAmKnX,cAAnK,CAAmLb,aAAnL,CAAkM+E,IAAlM,CAAwMhE,YAAxM,CAAsN,CAClN,GAAIpB,CAAAA,EAAE,CAAG,IAAT,CAEG;AAEA;AACA;AACA;AACA;AACA;AAGHA,EAAE,CAACC,IAAH,CAAU,IAAV,CACAD,EAAE,CAACgyB,QAAH,CAAc,EAAd,CAGAhyB,EAAE,CAACgnB,MAAH,CAAYtmB,MAAM,CAACqmB,OAAP,CAAeplB,IAAf,CAAoBqlB,MAAhC,CACAhnB,EAAE,CAACC,IAAH,CAAUH,UAAU,CAACI,OAAX,CAAmBC,WAA7B,CACC;AAEDH,EAAE,CAAC2E,OAAH,CAAa3E,EAAE,CAACC,IAAH,CAAQ+B,EAArB,CACAhC,EAAE,CAACqP,OAAH,CAAa,IAAb,CACArP,EAAE,CAACw8E,gBAAH,CAAsB,EAAtB,CACAx8E,EAAE,CAACy8E,aAAH,CAAmB,IAAnB,CAEAz8E,EAAE,CAAC05C,KAAH,CAAW,EAAX,CAGA,OAAO15C,EAAE,CAACgnB,MAAV,EAEI,IAAK,iBAAL,CAEI;AACAnnB,WAAW,CAAC63E,aAAZ,CAA0B13E,EAAE,CAAC2E,OAA7B,EACKjD,IADL,CACU,SAASC,IAAT,CAAe,CACjB,GAAIA,IAAI,CAACoC,OAAL,EAAgBpC,IAAI,CAAC0D,KAArB,EAA8B1D,IAAI,CAAC0D,KAAL,CAAWtD,MAAX,CAAoB,CAAtD,CAAyD,CACrD/B,EAAE,CAACw8E,gBAAH,CAAsB76E,IAAI,CAAC0D,KAA3B,CAEA;AACA,GAAIsyE,CAAAA,WAAW,CAAG,IAAlB,CACA,GAAI,CACA,GAAIC,CAAAA,MAAM,CAAGhtC,YAAY,CAACitC,OAAb,CAAqB,sCAArB,CAAb,CACA,GAAID,MAAM,GAAK,IAAf,CAAqB,CACjBD,WAAW,CAAGC,MAAd,CACH,CACJ,CAAC,MAAMr1E,CAAN,CAAS,CAAE,CAEb,GAAIu1E,CAAAA,YAAY,CAAG,IAAnB,CACA,GAAIH,WAAW,GAAK,IAApB,CAA0B,CACtB,IAAK,GAAI71E,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAG9B,EAAE,CAACw8E,gBAAH,CAAoBz6E,MAAxC,CAAgDD,CAAC,EAAjD,CAAqD,CACjD,GAAIuhC,MAAM,CAACrjC,EAAE,CAACw8E,gBAAH,CAAoB16E,CAApB,EAAuBE,EAAxB,CAAN,GAAsCqhC,MAAM,CAACs0C,WAAD,CAAhD,CAA+D,CAC3DG,YAAY,CAAG93E,EAAE,CAACw8E,gBAAH,CAAoB16E,CAApB,CAAf,CACA,MACH,CACJ,CACJ,CAED,GAAI,CAACg2E,YAAL,CAAmB,CACfA,YAAY,CAAG93E,EAAE,CAACw8E,gBAAH,CAAoB,CAApB,CAAf,CACH,CAEDx8E,EAAE,CAACy8E,aAAH,CAAmB3E,YAAnB,CACA93E,EAAE,CAACqP,OAAH,CAAayoE,YAAY,CAAC91E,EAA1B,CACA06E,sBAAsB,CAAC18E,EAAE,CAACqP,OAAJ,CAAtB,CACH,CA7BD,IA6BO,CACHjO,YAAY,CAACyD,KAAb,CAAmB,cAAnB,CAAmC,oDAAnC,EACH,CACJ,CAlCL,EAuCJ,MACA,IAAK,gBAAL,CACI2O,OAAO,CAACnN,GAAR,CAAY,+BAAZ,CAA6CrG,EAAE,CAAC2E,OAAhD,EAEA3E,EAAE,CAAC28E,UAAH,CAAgB38E,EAAE,CAAC2E,OAAnB,CAKI;AACA8pC,WAAW,CAACmuC,aAAZ,CAA0B58E,EAAE,CAAC2E,OAA7B,EAAsCjD,IAAtC,CAA2C,SAASC,IAAT,CAAc,CAErD3B,EAAE,CAACqF,KAAH,CAAW1D,IAAI,CAAC0D,KAAhB,CACA,GAAGrF,EAAE,CAACqF,KAAH,CAAStD,MAAT,CAAkB,CAAlB,EAAuB/B,EAAE,CAACqF,KAAH,CAAStD,MAAT,CAAkB,CAA5C,CAA8C,CAC1C/B,EAAE,CAACqP,OAAH,CAAarP,EAAE,CAACqF,KAAH,CAAS,CAAT,EAAYrD,EAAzB,CACAhC,EAAE,CAAC68E,oBAAH,GACH,CACJ,CAPD,EASA;AACA;AAEA;AAEA;AAEA;AACA;AAEA;AAEA;AAQR,MACA,QACI;AACJ,MAtFJ,CAyFA78E,EAAE,CAAC88E,WAAH,CAAiB,KAAjB,CACA98E,EAAE,CAAC+8E,aAAH,CAAmB,KAAnB,CAEA;AACA/8E,EAAE,CAACg9E,wBAAH,CAA8B,SAASntE,IAAT,CAAe,CACzC7P,EAAE,CAACy8E,aAAH,CAAmB5sE,IAAnB,CACA7P,EAAE,CAACqP,OAAH,CAAaQ,IAAI,CAAC7N,EAAlB,CAEA;AACA,GAAI,CACA4oC,YAAY,CAACmtC,OAAb,CAAqB,sCAArB,CAA6D10C,MAAM,CAACxzB,IAAI,CAAC7N,EAAN,CAAnE,EACH,CAAC,MAAMO,CAAN,CAAS,CAAE,CAEb;AACAvC,EAAE,CAACkyB,MAAH,CAAY,IAAZ,CACAlyB,EAAE,CAACuhB,MAAH,CAAY,IAAZ,CACAvhB,EAAE,CAAC88E,WAAH,CAAiB,KAAjB,CAEAJ,sBAAsB,CAAC18E,EAAE,CAACqP,OAAJ,CAAtB,CACH,CAfD,CAiBA,QAASqtE,CAAAA,sBAAT,CAAgCrtE,OAAhC,CAAyC,CACrCrP,EAAE,CAACmgC,OAAH,CAAa,EAAb,CACAngC,EAAE,CAAC62B,OAAH,CAAa,EAAb,CAEAx2B,aAAa,CAAC48E,oBAAd,CAAmC5tE,OAAnC,EACK3N,IADL,CACU,SAASC,IAAT,CAAe,CACjB3B,EAAE,CAAC62B,OAAH,CAAal1B,IAAI,CAACk1B,OAAlB,CACA72B,EAAE,CAACmgC,OAAH,CAAax+B,IAAI,CAACw+B,OAAlB,CACH,CAJL,EAKH,CAEDngC,EAAE,CAAC68E,oBAAH,CAA0B,UAAU,CAEhC;AACA,GAAI78E,EAAE,CAACy8E,aAAH,EAAoBz8E,EAAE,CAACy8E,aAAH,CAAiBz6E,EAAzC,CAA6C,CACzChC,EAAE,CAACqP,OAAH,CAAarP,EAAE,CAACy8E,aAAH,CAAiBz6E,EAA9B,CACH,CAEDqW,aAAa,CAACqZ,kBAAd,CAAiC1xB,EAAE,CAACqP,OAApC,EACS3N,IADT,CACc,SAASC,IAAT,CAAc,CAEhB3B,EAAE,CAAC62B,OAAH,CAAal1B,IAAI,CAACmc,KAAlB,CAEH,CALT,EAMH,CAbD,CAeA9d,EAAE,CAACk9E,YAAH,CAAkB,UAAU,CACxB,GAAG,CAACl9E,EAAE,CAACkyB,MAAJ,EAAc,CAAClyB,EAAE,CAACuhB,MAArB,CAA4B,CACxBngB,YAAY,CAACkD,OAAb,CAAqB,oBAArB,CAA2C,wEAA3C,EACH,CAFD,IAEO,CACHtE,EAAE,CAAC28E,UAAH,CAAgB38E,EAAE,CAACkyB,MAAH,CAAUvtB,OAA1B,CACA3E,EAAE,CAACslB,SAAH,CAAetlB,EAAE,CAACuhB,MAAH,CAAUvf,EAAzB,CAECqW,aAAa,CAAC8kE,yBAAd,CAAwCn9E,EAAE,CAAC28E,UAA3C,CAAuD38E,EAAE,CAACslB,SAA1D,EACI5jB,IADJ,CACS,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAAC88E,WAAH,CAAiB,IAAjB,CACA98E,EAAE,CAAC05E,SAAH,CAAe/3E,IAAI,CAAC+3E,SAApB,CACA15E,EAAE,CAAC25E,OAAH,CAAah4E,IAAI,CAACg4E,OAAlB,CACA35E,EAAE,CAACo9E,gBAAH,CAAsBz7E,IAAI,CAACy7E,gBAA3B,CACAp9E,EAAE,CAAC05C,KAAH,CAAW/3C,IAAI,CAAC+3C,KAAhB,CACA15C,EAAE,CAACq9E,YAAH,CAAkB17E,IAAI,CAAC07E,YAAvB,CACAr9E,EAAE,CAACs9E,aAAH,CAAmB37E,IAAI,CAAC47E,YAAxB,CACAv9E,EAAE,CAACw9E,UAAH,CAAgB77E,IAAI,CAAC67E,UAArB,CACH,CAVJ,EAYJ,CACJ,CApBD,CAsBAx9E,EAAE,CAACsG,WAAH,CAAiB,SAASC,IAAT,CAAc,CACvB,MAAOA,CAAAA,IAAI,CAACC,MAAL,CAAY,CAAZ,CAAP,CACH,CAFL,CAIIxG,EAAE,CAACsM,WAAH,CAAiB,SAAS5D,GAAT,CAAa,CAE9B,GAAI6D,CAAAA,EAAE,CAAG,EAAT,CACA,GAAIC,CAAAA,GAAG,CAAG,EAAV,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEAD,EAAE,CAAG,QAASvM,EAAE,CAACyM,OAAH,CAAW/D,GAAX,CAAd,CACA8D,GAAG,CAAGxM,EAAE,CAAC0M,OAAH,CAAWhE,GAAX,CAAN,CACA,GAAG8D,GAAG,EAAIA,GAAG,GAAK,EAAlB,CAAqB,CACjBA,GAAG,CAAG,cAAgBA,GAAtB,CACH,CAED,GAAGD,EAAE,EAAIA,EAAE,EAAI,EAAf,CAAkB,CACdA,EAAE,CAAG,iBAAL,CACH,CAED,MAAOnH,CAAAA,IAAI,CAACuH,cAAL,CAAoB,QAAQJ,EAAR,CAAW,GAAX,CAAeC,GAAf,CAAmB,QAAvC,CAAP,CAEH,CA5BG,CA8BJxM,EAAE,CAACyM,OAAH,CAAa,SAASpG,GAAT,CAAa,CAEtB,GAAIkG,CAAAA,EAAE,CAAG,EAAT,CAEA,GAAGlG,GAAG,CAACuG,cAAJ,EAAsBvG,GAAG,CAACuG,cAAJ,GAAuB,IAAhD,CAAqD,CACjDL,EAAE,CAAGvM,EAAE,CAACsG,WAAH,CAAeD,GAAG,CAACuG,cAAnB,EAAqC,IAArC,CAA4CvG,GAAG,CAACwG,aAArD,CACH,CAFD,IAEO,IAAGxG,GAAG,CAACyG,qBAAJ,EAA6BzG,GAAG,CAACyG,qBAAJ,GAA8B,EAA9D,CAAiE,CACpEP,EAAE,CAAGvM,EAAE,CAACsG,WAAH,CAAeD,GAAG,CAACyG,qBAAnB,EAA4C,IAA5C,CAAmDzG,GAAG,CAAC0G,oBAA5D,CACH,CAFM,IAEA,IAAG1G,GAAG,CAAC2G,aAAJ,EAAqB,CAArB,EAA0B3G,GAAG,CAACiE,UAA9B,EAA4CjE,GAAG,CAACiE,UAAJ,GAAmB,EAAlE,CAAqE,CACxEiC,EAAE,CAAGvM,EAAE,CAACsG,WAAH,CAAeD,GAAG,CAACiE,UAAnB,EAAiC,IAAjC,CAAwCjE,GAAG,CAACkE,SAAjD,CACH,CAED,MAAOgC,CAAAA,EAAP,CAEH,CAdD,CAgBAvM,EAAE,CAAC0M,OAAH,CAAa,SAASrG,GAAT,CAAa,CAEtB,GAAImG,CAAAA,GAAG,CAAG,EAAV,CAEA,GAAGnG,GAAG,CAAC4G,cAAJ,EAAsB5G,GAAG,CAAC4G,cAAJ,GAAuB,IAAhD,CAAqD,CACjDT,GAAG,CAAGxM,EAAE,CAACsG,WAAH,CAAeD,GAAG,CAAC4G,cAAnB,EAAqC,IAArC,CAA4C5G,GAAG,CAAC6G,aAAtD,CACH,CAFD,IAEO,IAAG7G,GAAG,CAAC2G,aAAJ,CAAoB,CAApB,EAAyB3G,GAAG,CAACiE,UAA7B,EAA2CjE,GAAG,CAACiE,UAAJ,GAAmB,EAAjE,CAAoE,CACvEkC,GAAG,CAAGxM,EAAE,CAACsG,WAAH,CAAeD,GAAG,CAACiE,UAAnB,EAAiC,IAAjC,CAAwCjE,GAAG,CAACkE,SAAlD,CACH,CAED,MAAOiC,CAAAA,GAAP,CAEH,CAZD,CAcAxM,EAAE,CAACmL,sBAAH,CAA4B,SAASzE,IAAT,CAAc,CAEtC,GAAGA,IAAH,CAAQ,CACH,GAAI0E,CAAAA,IAAI,CAAG1E,IAAI,CAAG,CAAP,CAAW,GAAX,CAAiB,EAA5B,CACA,GAAI2E,CAAAA,IAAI,CAAGC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,GAAL,CAAS9E,IAAT,CAAX,CAAX,CACA,GAAI+E,CAAAA,GAAG,CAAGH,IAAI,CAACI,KAAL,CAAYJ,IAAI,CAACE,GAAL,CAAS9E,IAAT,EAAiB,EAAlB,CAAwB,EAAnC,CAAV,CACA,GAAG+E,GAAG,EAAI,EAAV,CAAa,CACTJ,IAAI,GACJI,GAAG,CAAG,CAAN,CACH,CACD,MAAOL,CAAAA,IAAI,EAAIC,IAAI,CAAG,EAAP,CAAY,GAAZ,CAAkB,EAAtB,CAAJ,CAAgCA,IAAhC,CAAuC,GAAvC,EAA8CI,GAAG,CAAG,EAAN,CAAW,GAAX,CAAiB,EAA/D,EAAqEA,GAA5E,CACH,CATF,IASQ,CACH,MAAO,KAAP,CACH,CACL,CAdD,CAgBAzL,EAAE,CAACyG,WAAH,CAAiB,SAASC,IAAT,CAAc,CACvB,MAAOA,CAAAA,IAAI,CAACC,SAAL,CAAe,CAAf,CAAiB,CAAjB,CAAP,CACH,CAFL,CAMA3G,EAAE,CAAC6R,OAAH,CAAa,SAASnJ,GAAT,CAAa,CACtB;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG,CAAC1I,EAAE,CAACy9E,UAAJ,EAAmBz9E,EAAE,CAACy9E,UAAH,EAAiB,EAAvC,CAA2C,CACvC,MAAO,KAAP,CACH,CAFD,IAEM,IAAGv0E,SAAS,CAAClJ,EAAE,CAACy9E,UAAJ,CAAgB/0E,GAAG,CAAC2B,WAApB,CAAZ,CAA6C,CAC/C,MAAO,KAAP,CACH,CAFK,IAEC,IAAGZ,SAAS,CAACf,GAAG,CAAC4B,UAAL,CAAiB5B,GAAG,CAAC6B,SAArB,CAAgCvK,EAAE,CAACy9E,UAAnC,CAAZ,CAA4D,CAC/D,MAAO,KAAP,CACH,CAFM,IAEA,IAAGh0E,SAAS,CAACf,GAAG,CAACkE,cAAL,CAAqBlE,GAAG,CAACmE,aAAzB,CAAwC7M,EAAE,CAACy9E,UAA3C,CAAZ,CAAoE,CACvE,MAAO,KAAP,CACH,CAFM,IAEA,IAAGh0E,SAAS,CAACf,GAAG,CAACoE,qBAAL,CAA4BpE,GAAG,CAACqE,oBAAhC,CAAsD/M,EAAE,CAACy9E,UAAzD,CAAZ,CAAkF,CACrF,MAAO,KAAP,CACH,CAFM,IAEA,IAAG1zE,aAAa,CAACrB,GAAG,CAACnD,YAAL,CAAmBvF,EAAE,CAACy9E,UAAtB,CAAhB,CAAmD,CACtD,MAAO,KAAP,CACH,CAFM,IAEA,IAAGxzE,aAAa,CAACjK,EAAE,CAACy9E,UAAJ,CAAgB/0E,GAAG,CAAC8B,iBAApB,CAAuC9B,GAAG,CAAC+B,sBAA3C,CAAhB,CAAmF,CACtF,MAAO,KAAP,CACH,CAFM,IAEA,IAAGR,aAAa,CAACjK,EAAE,CAACy9E,UAAJ,CAAgB/0E,GAAG,CAACgC,mBAApB,CAAyChC,GAAG,CAACiC,wBAA7C,CAAhB,CAAuF,CAC1F,MAAO,KAAP,CACH,CAFM,IAED,CACF,MAAO,MAAP,CACH,CAED;AAEA;AAEH,CApCD,CAsCA,QAASzB,CAAAA,SAAT,CAAmBT,MAAnB,CAA2BM,IAA3B,CAAgC,CAG5B,GAAGN,MAAM,CAAC1G,MAAP,CAAgB,CAAnB,CAAqB,CACjB,MAAO,MAAP,CACH,CAED,GAAG0G,MAAM,EAAIA,MAAM,CAAC1G,MAAP,EAAiB,CAA9B,CAAgC,CAC5B,GAAGgH,IAAI,CAAC5B,OAAL,CAAasB,MAAb,EAAuB,CAAC,CAA3B,CAA6B,CACzB,MAAO,KAAP,CACH,CACJ,CAJD,IAIO,CACH,GAAIU,CAAAA,WAAW,CAAG,EAAlB,CACA,GAAIC,CAAAA,CAAC,CAAGC,MAAM,CAACZ,MAAD,CAAd,CACA,GAAGW,CAAC,CAAChF,OAAF,IAAegF,CAAC,CAACjG,MAAF,CAAS,MAAT,GAAoB,MAAtC,CAA6C,CACzCgG,WAAW,CAAGC,CAAC,CAACjG,MAAF,CAAS,YAAT,CAAd,CACH,CAFD,IAEO,IAAGiG,CAAC,CAAChF,OAAF,EAAH,CAAe,CAClB+E,WAAW,CAAGC,CAAC,CAACjG,MAAF,CAAS,OAAT,CAAd,CACH,CAGD,GAAImG,CAAAA,WAAW,CAAG,CAAlB,CAEA,GAAGH,WAAW,GAAK,EAAhB,EAAsBJ,IAAI,CAAC5B,OAAL,CAAagC,WAAb,EAA4B,CAAC,CAAtD,CAAwD,CACpD;AACA,MAAO,KAAP,CACH,CAHD,IAGO,CAEH;AACA;AAEA,GAAGV,MAAM,CAAC1G,MAAP,EAAiB,CAAjB,EAAsB0G,MAAM,CAAC1G,MAAP,EAAiB,CAA1C,CAA4C,CAExC,GAAIwH,CAAAA,CAAC,CAAGF,MAAM,CAACZ,MAAD,CAAS,MAAT,CAAd,CACA;AACA,GAAGc,CAAC,CAACnF,OAAF,EAAH,CAAe,CACX,GAAIoF,CAAAA,EAAE,CAAGD,CAAC,CAACpG,MAAF,CAAS,OAAT,CAAT,CACA,GAAG4F,IAAI,CAAC5B,OAAL,CAAaqC,EAAb,EAAmB,CAAC,CAAvB,CAAyB,CACrB,MAAO,KAAP,CACH,CACJ,CAEJ,CAXD,IAWO,IAAGf,MAAM,CAAC1G,MAAP,EAAiB,CAAjB,EAAsB0G,MAAM,CAAC1G,MAAP,EAAiB,EAA1C,CAA6C,CAEhD,GAAIwH,CAAAA,CAAC,CAAGF,MAAM,CAACZ,MAAD,CAAS,UAAT,CAAd,CACA;AACA,GAAGc,CAAC,CAACnF,OAAF,EAAH,CAAe,CACX,GAAIoF,CAAAA,EAAE,CAAGD,CAAC,CAACpG,MAAF,CAAS,YAAT,CAAT,CACA,GAAG4F,IAAI,CAAC5B,OAAL,CAAaqC,EAAb,EAAmB,CAAC,CAAvB,CAAyB,CACrB,MAAO,KAAP,CACH,CACJ,CAEJ,CAED;AACA,MAAO,MAAP,CACH,CACJ,CAEJ,CAGD,QAASC,CAAAA,SAAT,CAAmBC,KAAnB,CAA0BC,KAA1B,CAAiClB,MAAjC,CAAwC,CAEpC,GAAImB,CAAAA,OAAO,CAAGnB,MAAM,CAACoB,WAAP,EAAd,CACA,GAAIC,CAAAA,QAAQ,CAAGJ,KAAK,CAAC,GAAN,CAAUC,KAAzB,CACAG,QAAQ,CAAGA,QAAQ,CAACD,WAAT,EAAX,CACA;AACA;AACA;AACA,GAAGpB,MAAM,CAAC1G,MAAP,CAAgB,CAAhB,EAAsB+H,QAAQ,CAAC3C,OAAT,CAAiByC,OAAjB,EAA4B,CAAC,CAAtD,CAA0D,CACtD,MAAO,KAAP,CACH,CAFD,IAEO,CACH,MAAO,MAAP,CACH,CAEJ,CAED,QAASG,CAAAA,aAAT,CAAuBxE,YAAvB,CAAqCkD,MAArC,CAA4C,CAExC,GAAImB,CAAAA,OAAO,CAAGnB,MAAM,CAACoB,WAAP,GAAqBG,OAArB,CAA6B,GAA7B,CAAkC,EAAlC,CAAd,CACA,GAAIF,CAAAA,QAAQ,CAAGvE,YAAY,CAACyE,OAAb,CAAqB,GAArB,CAA0B,EAA1B,CAAf,CACAF,QAAQ,CAAGA,QAAQ,CAACD,WAAT,EAAX,CACA;AACA;AACA;AACA,GAAGpB,MAAM,CAAC1G,MAAP,CAAgB,CAAhB,EAAsB+H,QAAQ,CAAC3C,OAAT,CAAiByC,OAAjB,EAA4B,CAAC,CAAtD,CAA0D,CACtD,MAAO,KAAP,CACH,CAFD,IAEO,CACH,MAAO,MAAP,CACH,CAEJ,CAED,QAASK,CAAAA,aAAT,CAAuBxB,MAAvB,CAA+BJ,IAA/B,CAAqC6B,IAArC,CAA0C,CACtC,GAAIC,CAAAA,KAAK,CAAG9B,IAAI,CAACwB,WAAL,EAAZ,CACA,GAAIO,CAAAA,KAAK,CAAGF,IAAI,CAACL,WAAL,EAAZ,CACA,GAAID,CAAAA,OAAO,CAAGnB,MAAM,CAACoB,WAAP,EAAd,CAEA,GAAGD,OAAO,CAAC7H,MAAR,CAAiB,CAAjB,EAAuBoI,KAAK,CAAChD,OAAN,CAAcyC,OAAd,EAAyB,CAAC,CAApD,CAAuD,CACnD,MAAO,KAAP,CACH,CAFD,IAEO,IAAGA,OAAO,CAAC7H,MAAR,CAAiB,CAAjB,EAAuBqI,KAAK,CAACjD,OAAN,CAAcyC,OAAd,EAAyB,CAAC,CAApD,CAAuD,CAC1D,MAAO,KAAP,CACH,CAFM,IAEA,CACH,MAAO,MAAP,CACH,CAIJ,CAED5J,EAAE,CAAC09E,iBAAH,CAAuB,UAAU,CAC7B,GAAI,CAAC19E,EAAE,CAACuhB,MAAR,CAAe,CACXngB,YAAY,CAACkD,OAAb,CAAqB,oBAArB,CAA2C,0DAA3C,EACH,CAFD,IAEO,CAEHtE,EAAE,CAACslB,SAAH,CAAetlB,EAAE,CAACuhB,MAAH,CAAUvf,EAAzB,CAECqW,aAAa,CAAC8kE,yBAAd,CAAwCn9E,EAAE,CAAC28E,UAA3C,CAAuD38E,EAAE,CAACslB,SAA1D,EACI5jB,IADJ,CACS,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAAC88E,WAAH,CAAiB,IAAjB,CACA98E,EAAE,CAAC05E,SAAH,CAAe/3E,IAAI,CAAC+3E,SAApB,CACA15E,EAAE,CAAC25E,OAAH,CAAah4E,IAAI,CAACg4E,OAAlB,CACA35E,EAAE,CAACo9E,gBAAH,CAAsBz7E,IAAI,CAACy7E,gBAA3B,CACAp9E,EAAE,CAAC05C,KAAH,CAAW/3C,IAAI,CAAC+3C,KAAhB,CACA15C,EAAE,CAACq9E,YAAH,CAAkB17E,IAAI,CAAC07E,YAAvB,CACAr9E,EAAE,CAACs9E,aAAH,CAAmB37E,IAAI,CAAC47E,YAAxB,CACAv9E,EAAE,CAACw9E,UAAH,CAAgB77E,IAAI,CAAC67E,UAArB,CACH,CAVJ,EAYJ,CACJ,CApBD,CAsBAx9E,EAAE,CAAC29E,oBAAH,CAA0B,SAASC,SAAT,CAAmB,CAG5C,CAHD,CAKA59E,EAAE,CAAC69E,eAAH,CAAqB,UAAU,CAC3B;AACA79E,EAAE,CAACu7C,QAAH,CAAY52C,OAAZ,CAAsB3E,EAAE,CAAC28E,UAAzB,CACA38E,EAAE,CAACu7C,QAAH,CAAYj2B,SAAZ,CAAwBtlB,EAAE,CAACslB,SAA3B,CACAjN,aAAa,CAACylE,gBAAd,CAA+B99E,EAAE,CAACu7C,QAAlC,EACqB75C,IADrB,CAC0B,SAASC,IAAT,CAAc,CAChB,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CACZ/D,EAAE,CAACk9E,YAAH,GACAl9E,EAAE,CAAC+8E,aAAH,CAAmB,KAAnB,CAEA;AAEH,CAND,IAMO,CACH37E,YAAY,CAACyD,KAAb,CAAmB,YAAnB,CAAiC,6BAAjC,EACH,CACJ,CAXrB,EAYH,CAhBD,CAkBA7E,EAAE,CAAC+9E,WAAH,CAAiB,SAAS50B,OAAT,CAAkB60B,MAAlB,CAAyB,CAErC,GAAIC,CAAAA,MAAM,CAAGD,MAAM,CAAClgE,KAAP,CAAalO,IAAb,CAAkB,SAASF,IAAT,CAAc,CAAE,MAAOA,CAAAA,IAAI,CAACwuE,cAAL,GAAwB/0B,OAA/B,CAAyC,CAA3E,CAAb,CAGD,MAAQ80B,CAAAA,MAAD,CAAWA,MAAM,CAACrD,OAAlB,CAA4B,EAAnC,CAEH,CAPD,CASA56E,EAAE,CAACm+E,UAAH,CAAgB,SAASh1B,OAAT,CAAkB60B,MAAlB,CAAyB,CAErC,GAAIC,CAAAA,MAAM,CAAGD,MAAM,CAAClgE,KAAP,CAAalO,IAAb,CAAkB,SAASF,IAAT,CAAc,CAAE,MAAOA,CAAAA,IAAI,CAACwuE,cAAL,GAAwB/0B,OAA/B,CAAyC,CAA3E,CAAb,CAEA,MAAQ80B,CAAAA,MAAD,CAAWA,MAAM,CAACG,UAAlB,CAA+B,EAAtC,CAEH,CAND,CAQAp+E,EAAE,CAACq+E,WAAH,CAAiB,SAASl1B,OAAT,CAAiB,CAE9B,GAAI80B,CAAAA,MAAM,CAAGD,MAAM,CAAClgE,KAAP,CAAalO,IAAb,CAAkB,SAASF,IAAT,CAAc,CAAE,MAAOA,CAAAA,IAAI,CAACwuE,cAAL,GAAwB/0B,OAA/B,CAAyC,CAA3E,CAAb,CAEA,MAAQ80B,CAAAA,MAAD,CAAWA,MAAM,CAACG,UAAlB,CAA+B,EAAtC,CAEH,CAND,CAQAp+E,EAAE,CAACs+E,cAAH,CAAoB,SAASn1B,OAAT,CAAkB60B,MAAlB,CAAyB,CAEzC,GAAIC,CAAAA,MAAM,CAAGD,MAAM,CAAClgE,KAAP,CAAalO,IAAb,CAAkB,SAASF,IAAT,CAAc,CAAE,MAAOA,CAAAA,IAAI,CAACwuE,cAAL,GAAwB/0B,OAA/B,CAAyC,CAA3E,CAAb,CACA,GAAIo1B,CAAAA,KAAK,CAAG,EAAZ,CACA,GAAIC,CAAAA,MAAM,CAAG,EAAb,CACA,GAAGP,MAAM,EAAIA,MAAM,CAACQ,YAAjB,EAAiCR,MAAM,CAACG,UAA3C,CAAsD,CAClDG,KAAK,CAAGn5E,IAAI,CAACuH,cAAL,CAAoB,uBAAuBsxE,MAAM,CAACQ,YAA9B,CAA2C,qBAA3C,CAAiER,MAAM,CAACS,UAAxE,CAAmF,kBAAnF,CAAsGT,MAAM,CAACQ,YAA7G,CAA0H,eAA9I,CAAR,CAEAD,MAAM,CAAGp5E,IAAI,CAAC4N,WAAL,CAAiB,uBAAuBirE,MAAM,CAACQ,YAA9B,CAA2C,qBAA3C,CAAiER,MAAM,CAACS,UAAxE,CAAmF,kBAAnF,CAAsGT,MAAM,CAACQ,YAA7G,CAA0H,eAA3I,CAAT,CACA;AACH,CAID,MAAQR,CAAAA,MAAD,CAAWO,MAAX,CAAoB,EAA3B,CAEH,CAhBD,CAkBAx+E,EAAE,CAAC2+E,eAAH,CAAqB,SAASV,MAAT,CAAgB,CAEjC;AACA,GAAIM,CAAAA,KAAK,CAAG,EAAZ,CACA,GAAIC,CAAAA,MAAM,CAAG,EAAb,CACA,GAAGP,MAAM,EAAIA,MAAM,CAACQ,YAAjB,EAAiCR,MAAM,CAACG,UAA3C,CAAsD,CAClDG,KAAK,CAAGn5E,IAAI,CAACuH,cAAL,CAAoB,uBAAuBsxE,MAAM,CAACQ,YAA9B,CAA2C,qBAA3C,CAAiER,MAAM,CAACS,UAAxE,CAAmF,kBAAnF,CAAsGT,MAAM,CAACQ,YAA7G,CAA0H,eAA9I,CAAR,CAEAD,MAAM,CAAGp5E,IAAI,CAAC4N,WAAL,CAAiB,uBAAuBirE,MAAM,CAACQ,YAA9B,CAA2C,qBAA3C,CAAiER,MAAM,CAACS,UAAxE,CAAmF,kBAAnF,CAAsGT,MAAM,CAACQ,YAA7G,CAA0H,eAA3I,CAAT,CACA;AACH,CAID,MAAQR,CAAAA,MAAD,CAAWO,MAAX,CAAoB,EAA3B,CAEH,CAhBD,CAkBAx+E,EAAE,CAAC4+E,eAAH,CAAqB,SAASz1B,OAAT,CAAkB60B,MAAlB,CAAyB,CAC1C,GAAItuE,CAAAA,IAAI,CAAGsuE,MAAM,CAAClgE,KAAP,CAAalO,IAAb,CAAkB,SAASF,IAAT,CAAc,CAAE,MAAOA,CAAAA,IAAI,CAACwuE,cAAL,GAAwB/0B,OAA/B,CAAyC,CAA3E,CAAX,CACA,MAAQz5C,CAAAA,IAAD,CAASA,IAAI,CAACrF,WAAd,CAA4B,EAAnC,CACH,CAHD,CAKArK,EAAE,CAAC6+E,aAAH,CAAmB,KAAnB,CAEA7+E,EAAE,CAAC8+E,kBAAH,CAAwB,SAAS31B,OAAT,CAAkB60B,MAAlB,CAAyB,CAE7C,GAAItuE,CAAAA,IAAI,CAAGsuE,MAAM,CAAClgE,KAAP,CAAalO,IAAb,CAAkB,SAASF,IAAT,CAAc,CAAE,MAAOA,CAAAA,IAAI,CAACwuE,cAAL,GAAwB/0B,OAA/B,CAAyC,CAA3E,CAAX,CAEA,GAAGz5C,IAAH,CAAQ,CAGJ,GAAIqvE,CAAAA,cAAc,CAAG,oEAArB,CAEA,GAAGrvE,IAAI,CAACrF,WAAL,EAAoBqF,IAAI,CAACrF,WAAL,GAAqB,EAA5C,CAA+C,CAC3C00E,cAAc,EAAI,gCAAgCrvE,IAAI,CAACrF,WAArC,CAAiD,YAAnE,CACH,CAED,GAAGqF,IAAI,CAAC1C,aAAL,CAAqB,CAArB,EAA0B0C,IAAI,CAAC5C,qBAAL,GAA+B,EAA5D,CAA+D,CAC3DiyE,cAAc,EAAI,+DAA+D/+E,EAAE,CAACsG,WAAH,CAAeoJ,IAAI,CAAC5C,qBAApB,CAA/D,CAA0G,GAA1G,CAA8G4C,IAAI,CAAC3C,oBAAnH,CAAwI,YAA1J,CACH,CAED,GAAG2C,IAAI,CAACurE,YAAL,CAAoB,CAApB,EAAyBvrE,IAAI,CAACsvE,uBAAL,GAAiC,EAA1D,EAAgEtvE,IAAI,CAACurE,YAAL,GAAsBvrE,IAAI,CAAC1C,aAA9F,CAA4G,CACxG+xE,cAAc,EAAI,8DAA8D/+E,EAAE,CAACsG,WAAH,CAAeoJ,IAAI,CAACsvE,uBAApB,CAA9D,CAA2G,GAA3G,CAA+GtvE,IAAI,CAACuvE,sBAApH,CAA2I,YAA7J,CACH,CAED,GAAGvvE,IAAI,CAACkrE,OAAL,EAAgBlrE,IAAI,CAACkrE,OAAL,GAAiB,EAApC,CAAuC,CACnCmE,cAAc,EAAI,mFAAmFrvE,IAAI,CAACkrE,OAAxF,CAAgG,aAAlH,CACH,CAED,GAAGmE,cAAc,EAAIA,cAAc,GAAK,EAAxC,CAA2C,CACvCA,cAAc,EAAI,UAAlB,CACH,CAID,MAAO35E,CAAAA,IAAI,CAACuH,cAAL,CAAoBoyE,cAApB,CAAP,CACH,CA5BD,IA4BM,CACF,MAAO,GAAP,CACH,CACJ,CAnCD,CAqCA/+E,EAAE,CAACk/E,mBAAH,CAAyB,SAASxvE,IAAT,CAAc,CAEnC;AAEA,GAAGA,IAAH,CAAQ,CAGJ,GAAIqvE,CAAAA,cAAc,CAAG,oEAArB,CAEA,GAAGrvE,IAAI,CAACrF,WAAL,EAAoBqF,IAAI,CAACrF,WAAL,GAAqB,EAA5C,CAA+C,CAC3C00E,cAAc,EAAI,gCAAgCrvE,IAAI,CAACrF,WAArC,CAAiD,YAAnE,CACH,CAED,GAAGqF,IAAI,CAACnK,YAAL,EAAqBmK,IAAI,CAACnK,YAAL,GAAsB,EAA9C,CAAiD,CAC7Cw5E,cAAc,EAAI,6BAA6BrvE,IAAI,CAACnK,YAAlC,CAA+C,YAAjE,CACAw5E,cAAc,EAAI,yBAAyBrvE,IAAI,CAACmE,UAA9B,CAAyC,YAA3D,CACH,CAID,GAAGnE,IAAI,CAAC1C,aAAL,CAAqB,CAArB,EAA0B0C,IAAI,CAAC5C,qBAAL,GAA+B,EAA5D,CAA+D,CAC3DiyE,cAAc,EAAI,+DAA+D/+E,EAAE,CAACsG,WAAH,CAAeoJ,IAAI,CAAC5C,qBAApB,CAA/D,CAA0G,GAA1G,CAA8G4C,IAAI,CAAC3C,oBAAnH,CAAwI,YAA1J,CACH,CAED,GAAG2C,IAAI,CAACurE,YAAL,CAAoB,CAApB,EAAyBvrE,IAAI,CAACsvE,uBAAL,GAAiC,EAA1D,EAAgEtvE,IAAI,CAACurE,YAAL,GAAsBvrE,IAAI,CAAC1C,aAA9F,CAA4G,CACxG+xE,cAAc,EAAI,8DAA8D/+E,EAAE,CAACsG,WAAH,CAAeoJ,IAAI,CAACsvE,uBAApB,CAA9D,CAA2G,GAA3G,CAA+GtvE,IAAI,CAACuvE,sBAApH,CAA2I,YAA7J,CACH,CAED,GAAGvvE,IAAI,CAACkrE,OAAL,EAAgBlrE,IAAI,CAACkrE,OAAL,GAAiB,EAApC,CAAuC,CACnCmE,cAAc,EAAI,mFAAmFrvE,IAAI,CAACkrE,OAAxF,CAAgG,aAAlH,CACH,CAED,GAAGmE,cAAc,EAAIA,cAAc,GAAK,EAAxC,CAA2C,CACvCA,cAAc,EAAI,UAAlB,CACH,CAID,MAAO35E,CAAAA,IAAI,CAACuH,cAAL,CAAoBoyE,cAApB,CAAP,CACH,CAnCD,IAmCM,CACF,MAAO,uEAAP,CACH,CACJ,CA1CD,CA4CA/+E,EAAE,CAACm/E,QAAH,CAAc,SAASC,OAAT,CAAiB,CAE3B,GAAInB,CAAAA,MAAM,CAAGj+E,EAAE,CAACq9E,YAAH,CAAgBztE,IAAhB,CAAqB,SAASF,IAAT,CAAc,CAAE,MAAOA,CAAAA,IAAI,CAAC0vE,OAAL,GAAiBA,OAAxB,CAAkC,CAAvE,CAAb,CACA,MAAQnB,CAAAA,MAAD,CAAWA,MAAX,CAAoB,EAA3B,CACH,CAJD,CAMAj+E,EAAE,CAACq/E,oBAAH,CAA0B,SAAS7/D,MAAT,CAAiB0N,eAAjB,CAAiC,CACvDltB,EAAE,CAACovE,UAAH,CAAgB,IAAhB,CACAkQ,yBAAyB,CAAG,KAA5B,CACAt/E,EAAE,CAACu/E,eAAH,CAAqB,aAArB,CACAv/E,EAAE,CAACw/E,gBAAH,CAAsBhgE,MAAtB,CACAxf,EAAE,CAAC6+E,aAAH,CAAmB7+E,EAAE,CAACy/E,oBAAH,EAAnB,CAEAz/E,EAAE,CAAC0/E,eAAH,CAAqBxyD,eAArB,CAEA;AACAltB,EAAE,CAAC2/E,eAAH,CAAqB,EAArB,CACA3/E,EAAE,CAAC4/E,uBAAH,CAA6B,EAA7B,CAEAvnE,aAAa,CAACwnE,kCAAd,CAAiD7/E,EAAE,CAAC28E,UAApD,CAAgE38E,EAAE,CAACslB,SAAnE,CAA8EtlB,EAAE,CAACw/E,gBAAjF,EACS99E,IADT,CACc,SAASC,IAAT,CAAc,CAEhB3B,EAAE,CAACw5E,WAAH,CAAiB73E,IAAI,CAAC63E,WAAtB,CACAx5E,EAAE,CAAC2/E,eAAH,CAAqBh+E,IAAI,CAAC+3E,SAA1B,CACA15E,EAAE,CAAC4/E,uBAAH,CAA6Bj+E,IAAI,CAACk5E,eAAlC,CACA76E,EAAE,CAAC8/E,UAAH,CAAgBn+E,IAAI,CAACm+E,UAArB,CAEH,CART,EASH,CAtBD,CAwBA9/E,EAAE,CAAC0vE,WAAH,CAAiB,UAAU,CACvB1vE,EAAE,CAACovE,UAAH,CAAgB,KAAhB,CAEApvE,EAAE,CAACs/E,yBAAH,CAA+B,KAA/B,CAEAt/E,EAAE,CAAC2/E,eAAH,CAAqB,EAArB,CACA3/E,EAAE,CAAC4/E,uBAAH,CAA6B,EAA7B,CACA5/E,EAAE,CAAC8/E,UAAH,CAAgB,EAAhB,CAEH,CATD,CAYA,QAASzH,CAAAA,WAAT,EAAsB,CAGjB;AACDhgE,aAAa,CAACyhC,aAAd,CAA4Bn5C,YAAY,CAAC2kB,SAAzC,EACS5jB,IADT,CACc,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACuhB,MAAH,CAAY5f,IAAI,CAAC+N,IAAjB,CAEH,CAJT,EAMA2I,aAAa,CAAC8hC,kBAAd,CAAiCx5C,YAAY,CAAC2kB,SAA9C,EACS5jB,IADT,CACc,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACuhB,MAAH,CAAUm4B,KAAV,CAAkB/3C,IAAI,CAACmc,KAAvB,CAEH,CAJT,EAMAzF,aAAa,CAAC0hC,oBAAd,CAAmCp5C,YAAY,CAAC2kB,SAAhD,EACS5jB,IADT,CACc,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACuhB,MAAH,CAAUk4B,OAAV,CAAoB93C,IAAI,CAACmc,KAAzB,CACH,CAHT,EAOH,CAMDrd,MAAM,CAAC42B,IAAP,CAAc,UAAU,CACpBv2B,OAAO,CAACw2B,OAAR,CAAgBD,IAAhB,GACH,CAFD,CAMAqV,cAAc,GAEd,QAASA,CAAAA,cAAT,EAA0B,CACvB;AACF,CAED1sC,EAAE,CAACy6E,kBAAH,CAAwB,UAAU,CAE9B,GAAGz6E,EAAE,CAACm6E,gBAAN,CAAuB,CACnBn6E,EAAE,CAAC6I,SAAH,CAAe7I,EAAE,CAACwF,UAAlB,CACH,CAFD,IAEO,CACC,GAAGxF,EAAE,CAACwF,UAAH,CAAczD,MAAd,CAAuB,CAA1B,CAA4B,CACxB/B,EAAE,CAAC6I,SAAH,CAAe7I,EAAE,CAACwF,UAAlB,CACH,CAFD,IAEO,CACHxF,EAAE,CAAC6I,SAAH,CAAe7I,EAAE,CAACwpD,MAAH,CAAUxnD,EAAzB,CACH,CACR,CAEJ,CAZD,CAaAhC,EAAE,CAAC+5E,QAAH,CAAc,EAAd,CACA/5E,EAAE,CAACs/E,yBAAH,CAA+B,KAA/B,CACAt/E,EAAE,CAAC+/E,gBAAH,CAAsB,UAAU,CAE5B;AACA//E,EAAE,CAACs/E,yBAAH,CAA+B,IAA/B,CACAt/E,EAAE,CAACwpD,MAAH,CAAYxpD,EAAE,CAAC2/E,eAAf,CACA3/E,EAAE,CAACktB,eAAH,CAAqBltB,EAAE,CAAC0/E,eAAxB,CAAwC;AAExClsE,OAAO,CAACnN,GAAR,CAAY,QAAZ,CAAsBrG,EAAE,CAACktB,eAAzB,EACA1Z,OAAO,CAACnN,GAAR,CAAY,SAAZ,CAAuBrG,EAAE,CAACktB,eAAH,CAAmBiuD,WAA1C,EAEA9iE,aAAa,CAAC+hC,iBAAd,CAAgCp6C,EAAE,CAACslB,SAAnC,EACC5jB,IADD,CACM,SAASC,IAAT,CAAc,CAChB,IAAI,GAAIG,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAACH,IAAI,CAACmc,KAAL,CAAW/b,MAAzB,CAAgCD,CAAC,EAAjC,CAAoC,CAChCH,IAAI,CAACmc,KAAL,CAAWkiE,aAAX,CAA2Br+E,IAAI,CAACmc,KAAL,CAAW9b,EAAtC,CACH,CACDhC,EAAE,CAAC+5E,QAAH,CAAcp4E,IAAI,CAACmc,KAAnB,CACH,CAND,EAQA;AACA9d,EAAE,CAACg6E,oBAAH,CAA0Bh6E,EAAE,CAACktB,eAAH,CAAmBiuD,WAA7C,CACA,IAAI,GAAIr5E,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAAC9B,EAAE,CAACg6E,oBAAH,CAAwBj4E,MAAtC,CAA6CD,CAAC,EAA9C,CAAiD,CAC7C9B,EAAE,CAACg6E,oBAAH,CAAwBl4E,CAAxB,EAA2B,cAA3B,EAA6CwJ,IAAI,CAACI,KAAL,CAAY1L,EAAE,CAACg6E,oBAAH,CAAwBl4E,CAAxB,EAA2Bm+E,QAA3B,CAAsC,EAAvC,CAA6C,CAAxD,EAA6D,CAA1G,CACH,CAGD5nE,aAAa,CAAC8hC,kBAAd,CAAiCn6C,EAAE,CAACslB,SAApC,EACqB5jB,IADrB,CAC0B,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACuhB,MAAH,CAAUm4B,KAAV,CAAkB/3C,IAAI,CAACmc,KAAvB,CAEH,CAJrB,EAMAzF,aAAa,CAAC0hC,oBAAd,CAAmC/5C,EAAE,CAACslB,SAAtC,EACS5jB,IADT,CACc,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAACuhB,MAAH,CAAUk4B,OAAV,CAAoB93C,IAAI,CAACmc,KAAzB,CACH,CAHT,EAKA9d,EAAE,CAACkgF,mBAAH,CAA0BlgF,EAAE,CAAC8/E,UAAH,CAAc/rD,SAAd,EAA2B,CAA5B,CAAgC,IAAhC,CAAuC,KAAhE,CAEH,CAtCD,CAwCA/zB,EAAE,CAACu6E,eAAH,CAAqB,CAArB,CAEAv6E,EAAE,CAACg8C,OAAH,CAAa,UAAU,CACnB;AACA,GAAGh8C,EAAE,CAACg6E,oBAAH,CAAwBpqE,IAAxB,CAA6B,SAAA8rC,GAAG,QAAIA,CAAAA,GAAG,CAACskC,aAAJ,GAAsBhgF,EAAE,CAACq7E,UAAH,CAAcr5E,EAAxC,EAAhC,CAAH,CAA+E,CAC3EZ,YAAY,CAACkD,OAAb,CAAqB,eAArB,CAAsC,2CAAtC,EACA,MAAO,MAAP,CACH,CAED;AACAtE,EAAE,CAACq7E,UAAH,CAAc2E,aAAd,CAA8BhgF,EAAE,CAACq7E,UAAH,CAAcr5E,EAA5C,CAEA,GAAIsJ,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAAtC,CAA4Cv6E,EAAE,CAACktB,eAAH,CAAmB5P,oBAAnB,CAA0C,EAAzF,CAA6F,CACzFtd,EAAE,CAACu6E,eAAH,CAAsBv6E,EAAE,CAACktB,eAAH,CAAmB5P,oBAAnB,CAA0C,EAAhE,CACAtd,EAAE,CAACu6E,eAAH,CAAqBjvE,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAA1D,CACH,CAED,GAAIjvE,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAAtC,EAA4C,CAA/C,CAAiD,CAC7Cv6E,EAAE,CAACu6E,eAAH,CAAqB,CAArB,CACH,CAED,GAAGv6E,EAAE,CAACo6E,eAAN,CAAsB,CAClBp6E,EAAE,CAACu6E,eAAH,CAAsBv6E,EAAE,CAACktB,eAAH,CAAmB5P,oBAAnB,CAA0C,EAAhE,CACAtd,EAAE,CAACu6E,eAAH,CAAqBjvE,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAA1D,CACH,CAEDv6E,EAAE,CAACq7E,UAAH,CAAcC,YAAd,CAA6Bt7E,EAAE,CAACu6E,eAAhC,CACA;AACA;AACA;AACA;AACA;AACA;AAEAv6E,EAAE,CAACg6E,oBAAH,CAAwBx3E,IAAxB,CAA6BxC,EAAE,CAACq7E,UAAhC,EACAr7E,EAAE,CAACq7E,UAAH,CAAgB,EAAhB,CACAr7E,EAAE,CAACu6E,eAAH,CAAsBv6E,EAAE,CAACktB,eAAH,CAAmB5P,oBAAnB,CAA0C,EAAhE,CACAtd,EAAE,CAACu6E,eAAH,CAAqBjvE,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAA1D,CACAv6E,EAAE,CAACo6E,eAAH,CAAqB,IAArB,CACH,CArCD,CAuCAp6E,EAAE,CAAC87C,UAAH,CAAgB,SAASJ,GAAT,CAAch5C,KAAd,CAAoB,CAChC1C,EAAE,CAACg6E,oBAAH,CAAwBr3E,MAAxB,CAA+BD,KAA/B,CAAsC,CAAtC,EAEH,CAHD,CAKA1C,EAAE,CAACu7E,gBAAH,CAAsB,UAAU,CAC5B,GAAGv7E,EAAE,CAACu6E,eAAH,CAAqB,CAArB,GAA2B,CAA9B,CAAgC,CAC5Bv6E,EAAE,CAACu6E,eAAH,CAAqBjvE,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAA1D,CACH,CACJ,CAJD,CAOA;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAEQv6E,EAAE,CAACw7E,gBAAH,CAAsB,UAAU,CAE5BhoE,OAAO,CAACnN,GAAR,CAAY,qCAAZ,EAEAmN,OAAO,CAACnN,GAAR,CAAY,eAAZ,CAA6BrG,EAAE,CAAC8/E,UAAhC,EACAtsE,OAAO,CAACnN,GAAR,CAAY,gBAAZ,CAA8BrG,EAAE,CAACg6E,oBAAjC,EACAxmE,OAAO,CAACnN,GAAR,CAAY,sBAAZ,CAAoCrG,EAAE,CAAC2/E,eAAvC,EAEA,GAAIhF,CAAAA,cAAc,CAAG,EAArB,CACA,IAAI,GAAI74E,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAAC9B,EAAE,CAAC2/E,eAAH,CAAmB59E,MAAjC,CAAwCD,CAAC,EAAzC,CAA4C,CACxC,GAAK9B,EAAE,CAAC2/E,eAAH,CAAmB79E,CAAnB,EAAsBg+E,UAAtB,GAAqC9/E,EAAE,CAAC2/E,eAAH,CAAmB79E,CAAnB,EAAsBg+E,UAAtB,CAAiClxD,MAAjC,EAA2C5uB,EAAE,CAAC2/E,eAAH,CAAmB79E,CAAnB,EAAsBg+E,UAAtB,CAAiClF,OAAjH,IAA8H56E,EAAE,CAAC2/E,eAAH,CAAmB79E,CAAnB,EAAsBg+E,UAAtB,CAAiClxD,MAAjC,CAA0C,CAAC,CAA3C,EAAgD5uB,EAAE,CAAC2/E,eAAH,CAAmB79E,CAAnB,EAAsBg+E,UAAtB,CAAiClF,OAAjC,GAA6C,EAA3N,CAAL,CAAsO,CAClO,GAAIhvC,CAAAA,KAAK,CAAG,CAAC,UAAW5rC,EAAE,CAAC2/E,eAAH,CAAmB79E,CAAnB,EAAsBg+E,UAAtB,CAAiClF,OAA7C,CAAsD,SAAU56E,EAAE,CAAC2/E,eAAH,CAAmB79E,CAAnB,EAAsBg+E,UAAtB,CAAiClxD,MAAjG,CAAyG,iBAAkB5uB,EAAE,CAAC2/E,eAAH,CAAmB79E,CAAnB,EAAsBE,EAAjJ,CAAZ,CACA24E,cAAc,CAACn4E,IAAf,CAAoBopC,KAApB,EACH,CACJ,CACb;AACY;AAEAp4B,OAAO,CAACnN,GAAR,CAAY,kBAAZ,CAAgCs0E,cAAhC,EACA;AAEA,GAAGA,cAAc,CAAC54E,MAAf,CAAwB,CAAxB,GAA8B,CAAC/B,EAAE,CAAC66E,eAAJ,EAAuB76E,EAAE,CAAC66E,eAAH,EAAsB,EAA3E,CAAH,CAAkF,CAC9Ez5E,YAAY,CAACkD,OAAb,CAAqB,YAArB,CAAmC,6GAAnC,EACA,MAAO,MAAP,CACH,CAED,GAAIw2E,CAAAA,WAAW,CAAG96E,EAAE,CAAC8/E,UAAH,CAAc5E,cAAhC,CAEA1nE,OAAO,CAACnN,GAAR,CAAY,eAAZ,CAA6By0E,WAA7B,EAEA,GAAG96E,EAAE,CAAC+6E,gBAAH,EAAuB,CAAvB,EAA4B/6E,EAAE,CAAC86E,WAA/B,EAA8C96E,EAAE,CAAC86E,WAAH,CAAe94E,EAAf,CAAoB,CAArE,CAAuE,CACnE84E,WAAW,CAAG96E,EAAE,CAAC86E,WAAH,CAAe94E,EAA7B,CACH,CAEDwR,OAAO,CAACnN,GAAR,CAAY,eAAZ,CAA6By0E,WAA7B,EACAtnE,OAAO,CAACnN,GAAR,CAAY,kBAAZ,CAAgCrG,EAAE,CAACyd,UAAnC,EAEAzd,EAAE,CAACg7E,aAAH,CAAmB,CACfmF,gBAAgB,CAAEngF,EAAE,CAAC8/E,UAAH,CAAc99E,EADjB,CAEfqN,OAAO,CAAErP,EAAE,CAAC8/E,UAAH,CAAczwE,OAFR,CAGfyO,KAAK,CAAE68D,cAHQ,CAIfE,eAAe,CAAE76E,EAAE,CAAC8/E,UAAH,CAAcjF,eAJhB,CAIgC;AAC/C3xC,SAAS,CAAElpC,EAAE,CAAC8/E,UAAH,CAAc52C,SALV,CAMf5jB,SAAS,CAAEtlB,EAAE,CAAC8/E,UAAH,CAAcx6D,SANV,CAOf3gB,OAAO,CAAE3E,EAAE,CAAC8/E,UAAH,CAAcn7E,OAPR,CAOiB;AAChCqI,aAAa,CAAEhN,EAAE,CAAC8/E,UAAH,CAAc9yE,aARd,CASfiuE,YAAY,CAAEj7E,EAAE,CAAC8/E,UAAH,CAAc7E,YATb,CAUfn4D,kBAAkB,CAAE9iB,EAAE,CAAC0/E,eAAH,CAAmB19E,EAVxB,CAWfk5E,cAAc,CAAEJ,WAXD,CAYfsF,SAAS,CAAEpgF,EAAE,CAACC,IAAH,CAAQ+B,EAZJ,CAaf+xB,SAAS,CAAG/zB,EAAE,CAAC+6E,gBAAJ,CAAwB,CAAxB,CAA4B,CAbxB,CAcf;AACAI,WAAW,CAAEn7E,EAAE,CAACg6E,oBAfD,CAgBfqG,WAAW,CAAErgF,EAAE,CAACqgF,WAhBD,CAAnB,CAmBA7sE,OAAO,CAACnN,GAAR,CAAY,eAAZ,EACAmN,OAAO,CAACnN,GAAR,CAAYrG,EAAE,CAACg7E,aAAf,EACAxnE,OAAO,CAACnN,GAAR,CAAY,eAAZ,EAGA;AAGAgS,aAAa,CAACioE,oBAAd,CAAmCtgF,EAAE,CAACg7E,aAAtC,CAAqDh7E,EAAE,CAAC8/E,UAAH,CAAc99E,EAAnE,EACKN,IADL,CACU,SAASC,IAAT,CAAc,CAChB,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CAEZ3C,YAAY,CAAC2C,OAAb,CAAqB,eAArB,CAAsC,YAAtC,EACA;AACA;AACA;AAGAsU,aAAa,CAAC8kE,yBAAd,CAAwCn9E,EAAE,CAAC28E,UAA3C,CAAuD38E,EAAE,CAACslB,SAA1D,EACC5jB,IADD,CACM,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAAC88E,WAAH,CAAiB,IAAjB,CACA98E,EAAE,CAAC05E,SAAH,CAAe/3E,IAAI,CAAC+3E,SAApB,CACA15E,EAAE,CAAC25E,OAAH,CAAah4E,IAAI,CAACg4E,OAAlB,CACA35E,EAAE,CAACo9E,gBAAH,CAAsBz7E,IAAI,CAACy7E,gBAA3B,CACAp9E,EAAE,CAAC05C,KAAH,CAAW/3C,IAAI,CAAC+3C,KAAhB,CACA15C,EAAE,CAACq9E,YAAH,CAAkB17E,IAAI,CAAC07E,YAAvB,CACAr9E,EAAE,CAACs9E,aAAH,CAAmB37E,IAAI,CAAC47E,YAAxB,CACAv9E,EAAE,CAACw9E,UAAH,CAAgB77E,IAAI,CAAC67E,UAArB,CACH,CAVD,EAYAx9E,EAAE,CAACs/E,yBAAH,CAA+B,KAA/B,CACAt/E,EAAE,CAAC0vE,WAAH,GAEA;AACA1vE,EAAE,CAACwpD,MAAH,CAAY,EAAZ,CACAxpD,EAAE,CAACktB,eAAH,CAAqB,EAArB,CACAltB,EAAE,CAACg7E,aAAH,CAAmB,EAAnB,CACAh7E,EAAE,CAAC8/E,UAAH,CAAgB,EAAhB,CAEH,CA7BD,IA6BO,CACH1+E,YAAY,CAACyD,KAAb,CAAmB,aAAnB,CAAkC,4CAAlC,EACH,CAEJ,CAnCL,EAsCA;AAEA;AAMH,CA9GD,CAiHA7E,EAAE,CAACo6E,eAAH,CAAqB,IAArB,CAEAp6E,EAAE,CAACq6E,iBAAH,CAAuB,UAAU,CAC7B7mE,OAAO,CAACnN,GAAR,CAAYrG,EAAE,CAACktB,eAAf,EAEAltB,EAAE,CAACo6E,eAAH,CAAqB,IAArB,CACH,CAJD,CAMAp6E,EAAE,CAACs6E,yBAAH,CAA+B,UAAU,CAErC,GAAIhvE,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAAtC,CAA4Cv6E,EAAE,CAACktB,eAAH,CAAmB5P,oBAAnB,CAA0C,EAAzF,CAA6F,CACzFtd,EAAE,CAACu6E,eAAH,CAAsBv6E,EAAE,CAACktB,eAAH,CAAmB5P,oBAAnB,CAA0C,EAAhE,CACAtd,EAAE,CAACu6E,eAAH,CAAqBjvE,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAA1D,CACH,CAED,GAAIjvE,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAAtC,EAA4C,CAA/C,CAAiD,CAC7Cv6E,EAAE,CAACu6E,eAAH,CAAqB,CAArB,CACH,CAED,GAAGv6E,EAAE,CAACo6E,eAAN,CAAsB,CAClBp6E,EAAE,CAACu6E,eAAH,CAAsBv6E,EAAE,CAACktB,eAAH,CAAmB5P,oBAAnB,CAA0C,EAAhE,CACAtd,EAAE,CAACu6E,eAAH,CAAqBjvE,IAAI,CAACI,KAAL,CAAW1L,EAAE,CAACu6E,eAAH,CAAqB,CAAhC,EAAqC,CAA1D,CACH,CAHD,IAGO,CACH/mE,OAAO,CAACnN,GAAR,CAAY,iBAAZ,EACAmN,OAAO,CAACnN,GAAR,CAAYrG,EAAE,CAACktB,eAAf,EACH,CAEJ,CAnBD,CAqBAltB,EAAE,CAACy/E,oBAAH,CAA0B,UAAU,CAChC;AACA;AACA,GAAIrgB,CAAAA,UAAU,CAAIp/D,EAAE,CAACC,IAAH,CAAQ8wB,MAAR,CAAeC,OAAf,CAAuBphB,IAAvB,CAA4B,SAASF,IAAT,CAAc,CAAE,MAAOA,CAAAA,IAAI,GAAK1P,EAAE,CAACo9E,gBAAH,CAAoB/tE,OAApC,CAA8C,CAA1F,CAAD,CAA+F,IAA/F,CAAsG,KAAvH,CAEA,GAAGrP,EAAE,CAACo9E,gBAAH,CAAoBpwE,aAApB,EAAqChN,EAAE,CAAC2E,OAAxC,EAAmD3E,EAAE,CAAC2E,OAAH,EAAc3E,EAAE,CAACo9E,gBAAH,CAAoBnC,YAArF,EAAqG7b,UAAxG,CAAmH,CAC/G5rD,OAAO,CAACnN,GAAR,CAAY,wCAAZ,EACA,MAAO,KAAP,CACH,CAEDmN,OAAO,CAACnN,GAAR,CAAY,uEAAZ,EACA;AACA,MAAO,KAAP,CACH,CAbD,CAiBH,CACJ5G,GAAG,CAACC,UAAJ,CAAe,mCAAf,CAAoD6gF,iCAApD,EAEGA,iCAAiC,CAAC3gF,OAAlC,CAA4C,CAAC,aAAD,CAAgB,eAAhB,CAAiC,mBAAjC,CAAsD,mBAAtD,CAA2E,cAA3E,CAA2F,YAA3F,CAAyG,WAAzG,CAAsH,QAAtH,CAAgI,QAAhI,CAA0I,cAA1I,CAA0J,WAA1J,CAAuK,MAAvK,CAA+K,SAA/K,CAA0L,cAA1L,CAA5C,CACA,QAAS2gF,CAAAA,iCAAT,CAA2C1gF,WAA3C,CAAwDQ,aAAxD,CAAuEC,iBAAvE,CAA0FC,iBAA1F,CAA6G4E,YAA7G,CAA2HrF,UAA3H,CAAuIC,SAAvI,CAAkJU,MAAlJ,CAA0JC,MAA1J,CAAkKC,YAAlK,CAAgLC,SAAhL,CAA2LC,IAA3L,CAAiMC,OAAjM,CAA0MM,YAA1M,CAAwN,CACpN,GAAIpB,CAAAA,EAAE,CAAG,IAAT,CAEAA,EAAE,CAACC,IAAH,CAAU,IAAV,CACAD,EAAE,CAACgyB,QAAH,CAAc,EAAd,CACAhyB,EAAE,CAAC6P,IAAH,CAAU,EAAV,CACA7P,EAAE,CAACiyB,UAAH,CAAgB,EAAhB,CACAjyB,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAiB,EAAjB,CAEAlyB,EAAE,CAACmyB,oBAAH,CAA0B,EAA1B,CAEA;AAEAnyB,EAAE,CAACgnB,MAAH,CAAYtmB,MAAM,CAACqmB,OAAP,CAAeplB,IAAf,CAAoBqlB,MAAhC,CAGAhnB,EAAE,CAACC,IAAH,CAAUH,UAAU,CAACI,OAAX,CAAmBC,WAA7B,CACA;AACA;AACAH,EAAE,CAAC2E,OAAH,CAAa3E,EAAE,CAACC,IAAH,CAAQ+B,EAArB,CAIAhC,EAAE,CAACi0B,YAAH,CAAkB,CAAC,kBAAD,CAAqB,eAArB,CAAsC,UAAtC,CAAlB,CAGAxzB,MAAM,CAACqkD,QAAP,CAAsB,OAAtB,CAA+B;AAC/BrkD,MAAM,CAACskD,WAAP,CAAsB,KAAtB,CAA8B;AAC9BtkD,MAAM,CAACukD,UAAP,CAAsB,EAAtB,CAA8B;AAK5BvkD,MAAM,CAAC0hC,MAAP,CAAgB,GAAItiB,CAAAA,IAAJ,EAAhB,CAEApf,MAAM,CAAC+/E,KAAP,CAAe,CAAf,CACA//E,MAAM,CAACggF,KAAP,CAAe,EAAf,CAEDzgF,EAAE,CAAC4jB,IAAH,CAAU,CACP,CACI0kC,GAAG,CAAE,QADT,CAEIo4B,aAAa,CAAE,kBAFnB,CAGIC,WAAW,CAAE,gBAHjB,CAIIC,iBAAiB,CAAE,iBAJvB,CADO,CAOP,CACIt4B,GAAG,CAAE,SADT,CAEIo4B,aAAa,CAAE,mBAFnB,CAGIC,WAAW,CAAE,iBAHjB,CAIIC,iBAAiB,CAAE,kBAJvB,CAPO,CAaP,CACIt4B,GAAG,CAAE,WADT,CAEIo4B,aAAa,CAAE,qBAFnB,CAGIC,WAAW,CAAE,mBAHjB,CAIIC,iBAAiB,CAAE,oBAJvB,CAbO,CAmBP,CACIt4B,GAAG,CAAE,UADT,CAEIo4B,aAAa,CAAE,oBAFnB,CAGIC,WAAW,CAAE,kBAHjB,CAIIC,iBAAiB,CAAE,mBAJvB,CAnBO,CAyBP,CACIt4B,GAAG,CAAE,QADT,CAEIo4B,aAAa,CAAE,kBAFnB,CAGIC,WAAW,CAAE,gBAHjB,CAIIC,iBAAiB,CAAE,iBAJvB,CAzBO,CA+BP,CACIt4B,GAAG,CAAE,UADT,CAEIo4B,aAAa,CAAE,oBAFnB,CAGIC,WAAW,CAAE,kBAHjB,CAIIC,iBAAiB,CAAE,mBAJvB,CA/BO,CAqCP,CACIt4B,GAAG,CAAE,QADT,CAEIo4B,aAAa,CAAE,kBAFnB,CAGIC,WAAW,CAAE,gBAHjB,CAIIC,iBAAiB,CAAE,iBAJvB,CArCO,CAAV,CA8CA,GAAIC,CAAAA,QAAQ,CAAG,eAAf,CAED;AACA,GAAIC,CAAAA,YAAY,CAAG,GAAIjhE,CAAAA,IAAJ,EAAnB,CACAihE,YAAY,CAAC/gE,QAAb,CAAuB,CAAvB,EACA+gE,YAAY,CAAC9gE,UAAb,CAAyB,CAAzB,EAEA;AACA,GAAI+gE,CAAAA,UAAU,CAAG13E,MAAM,CAAC26D,GAAP,CAAW,sBAAX,EAAmC3wC,WAAnC,EAAjB,CAAmE;AACnE;AACA;AAMA/yB,iBAAiB,CAAC0gF,eAAlB,CAAkChhF,EAAE,CAACC,IAAH,CAAQ+B,EAA1C,EACaN,IADb,CACkB,SAASC,IAAT,CAAc,CAIhB3B,EAAE,CAACihF,eAAH,CAAqBt/E,IAArB,CACA,IAAI,GAAIG,CAAAA,CAAC,CAAE,CAAX,CAAaA,CAAC,CAAC9B,EAAE,CAACihF,eAAH,CAAmBl/E,MAAlC,CAAyCD,CAAC,EAA1C,CAA6C,CACzC;AACA,GAAG9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,GAA6C9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,gBAAtB,CAAhD,CAAwF,CACpF;AACD9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,EAA4Cg/E,YAA5C,CACA9gF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,gBAAtB,EAA0Ci/E,UAA1C,CACF,CACD,GAAG/gF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,mBAAtB,GAA8C9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,iBAAtB,CAAjD,CAA0F,CACvF9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,mBAAtB,EAA6Cg/E,YAA7C,CACA9gF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,iBAAtB,EAA2Ci/E,UAA3C,CACF,CACD,GAAG/gF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,qBAAtB,GAAgD9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,mBAAtB,CAAnD,CAA8F,CAC3F9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,qBAAtB,EAA+Cg/E,YAA/C,CACA9gF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,mBAAtB,EAA6Ci/E,UAA7C,CACF,CACD,GAAG/gF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,oBAAtB,GAA+C9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,CAAlD,CAA4F,CACzF9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,oBAAtB,EAA8Cg/E,YAA9C,CACA9gF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,EAA4Ci/E,UAA5C,CACF,CACD,GAAG/gF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,GAA6C9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,gBAAtB,CAAhD,CAAwF,CACrF9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,EAA4Cg/E,YAA5C,CACA9gF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,gBAAtB,EAA0Ci/E,UAA1C,CACF,CACD,GAAG/gF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,oBAAtB,GAA+C9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,CAAlD,CAA4F,CACzF9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,oBAAtB,EAA8Cg/E,YAA9C,CACA9gF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,EAA4Ci/E,UAA5C,CACF,CACD,GAAG/gF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,GAA6C9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,gBAAtB,CAAhD,CAAwF,CACrF9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,EAA4Cg/E,YAA5C,CACA9gF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,gBAAtB,EAA0Ci/E,UAA1C,CACF,CAGD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA/gF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,EAA4C,GAAI+d,CAAAA,IAAJ,CAASmjB,KAAK,CAACC,QAAN,CAAeC,OAAf,CAAuB,cAAcljC,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,CAAd,CAAwD,GAA/E,EAAoFo/E,OAApF,CAA4F,KAA5F,EAAmGC,MAAnG,EAAT,CAA5C,CAAoK;AACpKnhF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,gBAAtB,EAA0C,GAAI+d,CAAAA,IAAJ,CAASmjB,KAAK,CAACC,QAAN,CAAeC,OAAf,CAAuB,cAAcljC,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,gBAAtB,CAAd,CAAsD,GAA7E,EAAkFo/E,OAAlF,CAA0F,KAA1F,EAAiGC,MAAjG,EAAT,CAA1C,CAA8J;AAC9JnhF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,iBAAtB,EAA2CyF,QAAQ,CAACvH,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,iBAAtB,CAAD,CAAnD,CAEA9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,mBAAtB,EAA6C,GAAI+d,CAAAA,IAAJ,CAASmjB,KAAK,CAACC,QAAN,CAAeC,OAAf,CAAuB,cAAcljC,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,mBAAtB,CAAd,CAAyD,GAAhF,EAAqFo/E,OAArF,CAA6F,KAA7F,EAAoGC,MAApG,EAAT,CAA7C,CAAsK;AACtKnhF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,iBAAtB,EAA2C,GAAI+d,CAAAA,IAAJ,CAASmjB,KAAK,CAACC,QAAN,CAAeC,OAAf,CAAuB,cAAcljC,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,iBAAtB,CAAd,CAAuD,GAA9E,EAAmFo/E,OAAnF,CAA2F,KAA3F,EAAkGC,MAAlG,EAAT,CAA3C,CAAkK;AAClKnhF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,EAA4CyF,QAAQ,CAACvH,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,CAAD,CAApD,CAEA9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,qBAAtB,EAA+C,GAAI+d,CAAAA,IAAJ,CAASmjB,KAAK,CAACC,QAAN,CAAeC,OAAf,CAAuB,cAAcljC,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,qBAAtB,CAAd,CAA2D,GAAlF,EAAuFo/E,OAAvF,CAA+F,KAA/F,EAAsGC,MAAtG,EAAT,CAA/C,CAAyK;AACzKnhF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,mBAAtB,EAA6C,GAAI+d,CAAAA,IAAJ,CAASmjB,KAAK,CAACC,QAAN,CAAeC,OAAf,CAAuB,cAAcljC,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,mBAAtB,CAAd,CAAyD,GAAhF,EAAqFo/E,OAArF,CAA6F,KAA7F,EAAoGC,MAApG,EAAT,CAA7C,CAAqK;AACrKnhF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,oBAAtB,EAA8CyF,QAAQ,CAACvH,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,oBAAtB,CAAD,CAAtD,CAEA9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,oBAAtB,EAA8C,GAAI+d,CAAAA,IAAJ,CAASmjB,KAAK,CAACC,QAAN,CAAeC,OAAf,CAAuB,cAAcljC,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,oBAAtB,CAAd,CAA0D,GAAjF,EAAsFo/E,OAAtF,CAA8F,KAA9F,EAAqGC,MAArG,EAAT,CAA9C,CAAuK;AACvKnhF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,EAA4C,GAAI+d,CAAAA,IAAJ,CAASmjB,KAAK,CAACC,QAAN,CAAeC,OAAf,CAAuB,cAAcljC,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,CAAd,CAAwD,GAA/E,EAAoFo/E,OAApF,CAA4F,KAA5F,EAAmGC,MAAnG,EAAT,CAA5C,CAAmK;AACnKnhF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,mBAAtB,EAA6CyF,QAAQ,CAACvH,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,mBAAtB,CAAD,CAArD,CAEA9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,EAA4C,GAAI+d,CAAAA,IAAJ,CAASmjB,KAAK,CAACC,QAAN,CAAeC,OAAf,CAAuB,cAAcljC,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,CAAd,CAAwD,GAA/E,EAAoFo/E,OAApF,CAA4F,KAA5F,EAAmGC,MAAnG,EAAT,CAA5C,CAAoK;AACpKnhF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,gBAAtB,EAA0C,GAAI+d,CAAAA,IAAJ,CAASmjB,KAAK,CAACC,QAAN,CAAeC,OAAf,CAAuB,cAAcljC,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,gBAAtB,CAAd,CAAsD,GAA7E,EAAkFo/E,OAAlF,CAA0F,KAA1F,EAAiGC,MAAjG,EAAT,CAA1C,CAAgK;AAChKnhF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,iBAAtB,EAA2CyF,QAAQ,CAACvH,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,iBAAtB,CAAD,CAAnD,CAEA9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,oBAAtB,EAA8C,GAAI+d,CAAAA,IAAJ,CAASmjB,KAAK,CAACC,QAAN,CAAeC,OAAf,CAAuB,cAAcljC,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,oBAAtB,CAAd,CAA0D,GAAjF,EAAsFo/E,OAAtF,CAA8F,KAA9F,EAAqGC,MAArG,EAAT,CAA9C,CAAuK;AACvKnhF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,EAA4C,GAAI+d,CAAAA,IAAJ,CAASmjB,KAAK,CAACC,QAAN,CAAeC,OAAf,CAAuB,cAAcljC,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,CAAd,CAAwD,GAA/E,EAAoFo/E,OAApF,CAA4F,KAA5F,EAAmGC,MAAnG,EAAT,CAA5C,CAAmK;AACnKnhF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,mBAAtB,EAA6CyF,QAAQ,CAACvH,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,mBAAtB,CAAD,CAArD,CAEA9B,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,EAA4C,GAAI+d,CAAAA,IAAJ,CAASmjB,KAAK,CAACC,QAAN,CAAeC,OAAf,CAAuB,cAAcljC,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,kBAAtB,CAAd,CAAwD,GAA/E,EAAoFo/E,OAApF,CAA4F,KAA5F,EAAmGC,MAAnG,EAAT,CAA5C,CAAmK;AACnKnhF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,gBAAtB,EAA0C,GAAI+d,CAAAA,IAAJ,CAASmjB,KAAK,CAACC,QAAN,CAAeC,OAAf,CAAuB,cAAcljC,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,gBAAtB,CAAd,CAAsD,GAA7E,EAAkFo/E,OAAlF,CAA0F,KAA1F,EAAiGC,MAAjG,EAAT,CAA1C,CAA+J;AAC/JnhF,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,iBAAtB,EAA2CyF,QAAQ,CAACvH,EAAE,CAACihF,eAAH,CAAmBn/E,CAAnB,EAAsB,iBAAtB,CAAD,CAAnD,CAKH,CAED,GAAG9B,EAAE,CAACihF,eAAH,CAAmBl/E,MAAnB,EAA6B,CAAhC,CAAkC,CAK9B,GAAG/B,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,kBAAtB,GAA6CjhF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,gBAAtB,CAAhD,CAAwF,CACpF;AACDjhF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,kBAAtB,EAA4CH,YAA5C,CACA9gF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,gBAAtB,EAA0CF,UAA1C,CACF,CACD,GAAG/gF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,mBAAtB,GAA8CjhF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,iBAAtB,CAAjD,CAA0F,CACvFjhF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,mBAAtB,EAA6CH,YAA7C,CACA9gF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,iBAAtB,EAA2CF,UAA3C,CACF,CACD,GAAG/gF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,qBAAtB,GAAgDjhF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,mBAAtB,CAAnD,CAA8F,CAC3FjhF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,qBAAtB,EAA+CH,YAA/C,CACA9gF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,mBAAtB,EAA6CF,UAA7C,CACF,CACD,GAAG/gF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,oBAAtB,GAA+CjhF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,kBAAtB,CAAlD,CAA4F,CACzFjhF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,oBAAtB,EAA8CH,YAA9C,CACA9gF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,kBAAtB,EAA4CF,UAA5C,CACF,CACD,GAAG/gF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,kBAAtB,GAA6CjhF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,gBAAtB,CAAhD,CAAwF,CACrFjhF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,kBAAtB,EAA4CH,YAA5C,CACA9gF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,gBAAtB,EAA0CF,UAA1C,CACF,CACD,GAAG/gF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,oBAAtB,GAA+CjhF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,kBAAtB,CAAlD,CAA4F,CACzFjhF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,oBAAtB,EAA8CH,YAA9C,CACA9gF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,kBAAtB,EAA4CF,UAA5C,CACF,CACD,GAAG/gF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,kBAAtB,GAA6CjhF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,gBAAtB,CAAhD,CAAwF,CACrFjhF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,kBAAtB,EAA4CH,YAA5C,CACA9gF,EAAE,CAACihF,eAAH,CAAmB,CAAnB,EAAsB,gBAAtB,EAA0CF,UAA1C,CACF,CAGD;AACA;AAEA/gF,EAAE,CAACy8E,aAAH,CAAmBz8E,EAAE,CAACihF,eAAH,CAAmB,CAAnB,CAAnB,CAGA;AACA;AACA;AAEAjhF,EAAE,CAACohF,YAAH,CAAkB/+E,CAAC,CAACC,IAAF,CAAOtC,EAAE,CAACihF,eAAV,CAA2B,SAAS1+E,CAAT,CAAW,CAChD,MAAOA,CAAAA,CAAC,CAAC8M,OAAF,EAAarP,EAAE,CAACy8E,aAAH,CAAiBptE,OAArC,CACP,CAFiB,CAAlB,CAGA;AACArP,EAAE,CAACqhF,cAAH,CAAoBrhF,EAAE,CAACohF,YAAH,CAAgB,CAAhB,CAApB,CAGH,CAMJ,CAhJb,EAmJR;AAEQ;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA3gF,MAAM,CAAC6gF,UAAP,CAAoB,KAApB,CACA7gF,MAAM,CAAC8gF,UAAP,CAAoB,UAAW,CAC3B9gF,MAAM,CAAC6gF,UAAP,CAAoB,CAAE7gF,MAAM,CAAC6gF,UAA7B,CACH,CAFD,CAIA7gF,MAAM,CAAC+gF,WAAP,CAAqB,SAASn5E,IAAT,CAAe,CAChC,GAAIW,CAAAA,CAAC,CAAG,GAAI6W,CAAAA,IAAJ,EAAR,CACA7W,CAAC,CAAC+W,QAAF,CAAY,EAAZ,EACA/W,CAAC,CAACgX,UAAF,CAAc,CAAd,EACAhgB,EAAE,CAACqhF,cAAH,CAAkBh5E,IAAlB,EAA0BW,CAA1B,CACH,CALD,CAOEvI,MAAM,CAACghF,YAAP,CAAsB,SAASp5E,IAAT,CAAe,CACnCmL,OAAO,CAACnN,GAAR,CAAY,oBAAsBrG,EAAE,CAACqhF,cAAH,CAAkBh5E,IAAlB,CAAlC,EACD,CAFD,CAIA5H,MAAM,CAACihF,YAAP,CAAsB,SAASp5B,GAAT,CAAa,CACjCtoD,EAAE,CAACqhF,cAAH,CAAkB/4B,GAAlB,EAA0BtoD,EAAE,CAACqhF,cAAH,CAAkB/4B,GAAlB,CAAD,CAA2B,KAA3B,CAAmC,IAA5D,CACD,CAFD,CAIA7nD,MAAM,CAACi7B,WAAP,CAAqB,UAAU,CAC7B;AACA;AACA;AAEA17B,EAAE,CAACohF,YAAH,CAAkB/+E,CAAC,CAACC,IAAF,CAAOtC,EAAE,CAACihF,eAAV,CAA2B,SAAS1+E,CAAT,CAAW,CAChD,MAAOA,CAAAA,CAAC,CAAC8M,OAAF,EAAarP,EAAE,CAACy8E,aAAH,CAAiBptE,OAArC,CACP,CAFiB,CAAlB,CAGA;AACArP,EAAE,CAACqhF,cAAH,CAAoBrhF,EAAE,CAACohF,YAAH,CAAgB,CAAhB,CAApB,CAEA;AACD,CAZD,CAcA3gF,MAAM,CAACkhF,eAAP,CAAyB,UAAU,CAEjC;AACA;AACA;AACA;AACA;AAKArhF,iBAAiB,CAACshF,eAAlB,CAAkC5hF,EAAE,CAACqhF,cAArC,EACS3/E,IADT,CACc,SAASC,IAAT,CAAc,CAChB;AACA;AAIH,CAPT,EASQ;AAEA3B,EAAE,CAACihF,eAAH,CAAqB5+E,CAAC,CAACC,IAAF,CAAOtC,EAAE,CAACihF,eAAV,CAA2B,SAAS1+E,CAAT,CAAW,CAC/C,MAAOA,CAAAA,CAAC,CAAC8M,OAAF,EAAarP,EAAE,CAACqhF,cAAH,CAAkBhyE,OAAtC,CACP,CAFgB,CAArB,CAGA;AAEA;AACA;AAEArP,EAAE,CAACihF,eAAH,CAAmBz+E,IAAnB,CAAwBxC,EAAE,CAACqhF,cAA3B,EAEA3gF,MAAM,CAACymB,EAAP,CAAU,+CAAV,EAIT,CApCD,CAsCA;AACA;AACA;AAGV,6EArZ4N,CA0Z5N,8EA1Z4N,CAqapN;AAEA;AACA;AACA;AAEA,OAAOnnB,EAAE,CAACgnB,MAAV,EACI,IAAK,KAAL,CACI;AACAhnB,EAAE,CAACiyB,UAAH,CAAgB,kBAAhB,CAIJ,MACA,IAAK,MAAL,CACI;AAEA5xB,aAAa,CAACuiE,eAAd,CAA8BjiE,YAAY,CAAC6kC,SAA3C,CAAsDxlC,EAAE,CAACqP,OAAzD,EACK3N,IADL,CACU,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAAC6P,IAAH,CAAQC,MAAR,CAAiBnO,IAAjB,CACA;AACH,CAJL,EAMCtB,aAAa,CAACmW,OAAd,CAAsB7V,YAAY,CAAC6kC,SAAnC,CAA8CxlC,EAAE,CAACqP,OAAjD,EACI3N,IADJ,CACS,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAiBvwB,IAAjB,CACA;AACA3B,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAektC,UAAf,CAA6Bp/D,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAektC,UAAf,EAA6B,CAA9B,CAAmC,IAAnC,CAA0C,KAAtE,CACAp/D,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAemtC,QAAf,CAA2Br/D,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAemtC,QAAf,EAA2B,CAA5B,CAAiC,IAAjC,CAAwC,KAAlE,CACAr/D,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAejU,UAAf,CAA6Bje,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAejU,UAAf,EAA6B,CAA9B,CAAmC,IAAnC,CAA0C,KAAtE,CACAje,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAeitC,gBAAf,CAAkCt/C,IAAI,CAAClc,KAAL,CAAW3D,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAeitC,gBAA1B,CAAlC,CACAn/D,EAAE,CAACiyB,UAAH,CAAgB,mBAAmBjyB,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAe5nB,UAAlC,CAA6C,GAA7C,CAAiDtK,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAe3nB,SAAhF,CAEAvK,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAeitC,gBAAf,CAAkC,GAAIt/C,CAAAA,IAAJ,CAAS7f,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAeitC,gBAAxB,CAAlC,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEH,CApBJ,EAsBA5+D,iBAAiB,CAAC2/B,YAAlB,CAA+BlgC,EAAE,CAACqP,OAAlC,EACI3N,IADJ,CACS,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAAC6P,IAAH,CAAQo1C,WAAR,CAAsBtjD,IAAtB,CACA;AACA;AACA;AACA;AACH,CAPJ,EAQL,MACA,IAAK,MAAL,CACI;AACA;AACAtB,aAAa,CAAC6/B,YAAd,CAA2BlgC,EAAE,CAACqP,OAA9B,EACK3N,IADL,CACU,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAAC6P,IAAH,CAAQswB,OAAR,CAAkBx+B,IAAlB,CACA;AACH,CAJL,EAMCpB,iBAAiB,CAAC2/B,YAAlB,CAA+BlgC,EAAE,CAACqP,OAAlC,EACI3N,IADJ,CACS,SAASC,IAAT,CAAc,CAChB3B,EAAE,CAAC6P,IAAH,CAAQo1C,WAAR,CAAsBtjD,IAAtB,CACA;AACA;AACA;AACA;AACH,CAPJ,EAQDlB,MAAM,CAACoiE,QAAP,CAAkB,UAAY,CAC1B;AACA,GAAIpiE,MAAM,CAACqiE,WAAX,CAAwB,CACpBriE,MAAM,CAACqiE,WAAP,CAAqB,IAArB,CACH,CAFD,IAEO,CACHriE,MAAM,CAACqiE,WAAP,CAAqB,KAArB,CACH,CACDn6D,OAAO,CAACvC,OAAR,CAAgBpG,EAAE,CAAC6P,IAAH,CAAQswB,OAAxB,CAAiC,SAASjO,MAAT,CAAiB,CAC9CA,MAAM,CAACi/B,QAAP,CAAkB1wD,MAAM,CAACqiE,WAAzB,CACH,CAFD,EAGH,CAVD,CAaJ,MACA,QACI;AACJ,MAjFJ,CAoFA;AAEAriE,MAAM,CAAC42B,IAAP,CAAc,UAAU,CACpBv2B,OAAO,CAACw2B,OAAR,CAAgBD,IAAhB,GACH,CAFD,CAIA52B,MAAM,CAACuhC,IAAP,CAAc,UAAU,CACpB,GAAGhiC,EAAE,CAACgnB,MAAH,EAAa,KAAhB,CAAsB,CAClB;AACAvmB,MAAM,CAACwhC,MAAP,GACH,CAHD,IAGO,CACH;AACA;AACAxhC,MAAM,CAACyhC,MAAP,GACH,CACJ,CATD,CAcA;AACA;AACA;AACA;AAGAzhC,MAAM,CAACsiE,SAAP,CAAmB,SAASC,OAAT,CAAkB,CAC7B,GAAIC,CAAAA,KAAK,CAACD,OAAO,CAACE,GAAR,CAAY97D,KAAZ,CAAkB,SAAlB,CAAV,CACA,GAAIwnB,CAAAA,MAAM,CAAG,EAAb,CACA,GAAI5V,CAAAA,KAAK,CAAG,CAAZ,CACAiqD,KAAK,CAAC,CAAD,CAAL,EAAY,0CAAZ,CACA,IAAK,GAAIx/D,CAAAA,CAAC,CAAC,CAAX,CAAcA,CAAC,CAACw/D,KAAK,CAAClhE,MAAtB,CAA8B0B,CAAC,EAA/B,CAAmC,CAC/Bw/D,KAAK,CAACx/D,CAAD,CAAL,EAAY,sCAAZ,CACH,CACD,GAAI0/D,CAAAA,WAAW,CAAGF,KAAK,CAAC,CAAD,CAAL,CAAS77D,KAAT,CAAe47D,OAAO,CAACI,SAAvB,EAAkCrhE,MAApD,CAEA,GAAImK,CAAAA,OAAO,CAAG,EAAd,CACA,GAAI82D,OAAO,CAACK,MAAZ,CAAoB,CAChBn3D,OAAO,CAAC+2D,KAAK,CAAC,CAAD,CAAL,CAAS77D,KAAT,CAAe47D,OAAO,CAACI,SAAvB,CAAR,CACApjE,EAAE,CAACsjE,gBAAH,CAAsBp3D,OAAtB,CACA8M,KAAK,CAAG,CAAR,CACH,CAED,IAAK,GAAIlX,CAAAA,CAAC,CAACkX,KAAX,CAAkBlX,CAAC,CAACmhE,KAAK,CAAClhE,MAA1B,CAAkCD,CAAC,EAAnC,CAAuC,CACnC,GAAIwN,CAAAA,GAAG,CAAG,EAAV,CACI,GAAIi0D,CAAAA,WAAW,CAACN,KAAK,CAACnhE,CAAD,CAAL,CAASsF,KAAT,CAAe,GAAIorC,CAAAA,MAAJ,CAAWwwB,OAAO,CAACI,SAAR,CAAkB,oCAA7B,CAAf,CAAhB,CACA,GAAKG,WAAW,CAACxhE,MAAZ,GAAuBohE,WAA5B,CAA0C,CACtC,GAAIH,OAAO,CAACK,MAAZ,CAAoB,CAChB,IAAK,GAAI5/D,CAAAA,CAAC,CAAC,CAAX,CAAcA,CAAC,CAACyI,OAAO,CAACnK,MAAxB,CAAgC0B,CAAC,EAAjC,CAAqC,CACjC6L,GAAG,CAACpD,OAAO,CAACzI,CAAD,CAAR,CAAH,CAAkB8/D,WAAW,CAAC9/D,CAAD,CAA7B,CACH,CACJ,CAJD,IAIO,CACH,IAAK,GAAI6c,CAAAA,CAAC,CAAC,CAAX,CAAcA,CAAC,CAACijD,WAAW,CAACxhE,MAA5B,CAAoCue,CAAC,EAArC,CAAyC,CACrChR,GAAG,CAACgR,CAAD,CAAH,CAASijD,WAAW,CAACjjD,CAAD,CAApB,CACH,CACJ,CACDsO,MAAM,CAACpsB,IAAP,CAAY8M,GAAZ,EACH,CAER,CAED;AACA;AAEA,MAAOsf,CAAAA,MAAP,CACH,CAvCL,CA4CAnuB,MAAM,CAACslE,WAAP,CAAqB,UAAW,CAC5B;AACA8b,OAAO,CAAG7hF,EAAE,CAACimE,YAAb,CACA,GAAID,CAAAA,UAAU,CAAG,CACb9C,GAAG,CAAEljE,EAAE,CAACimE,YADK,CAEb7C,SAAS,CAAE,GAFE,CAGbC,MAAM,CAAE,IAHK,CAAjB,CAKArjE,EAAE,CAACyjE,cAAH,CAAoBhjE,MAAM,CAACsiE,SAAP,CAAiBiD,UAAjB,CAApB,CAEC,IAAI,GAAI58D,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAACpJ,EAAE,CAACyjE,cAAH,CAAkB1hE,MAAhC,CAAuCqH,CAAC,EAAxC,CAA2C,CACxC,GAAGpJ,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqB+1D,gBAAxB,CAAyC,CACrCn/D,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqB+1D,gBAArB,CAAwC,GAAIt/C,CAAAA,IAAJ,CAAS7f,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqB+1D,gBAA9B,CAAxC,CACH,CAFD,IAEO,CACHn/D,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqB+1D,gBAArB,CAAwC,GAAIt/C,CAAAA,IAAJ,EAAxC,CACH,CACD;AACA7f,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqBuiB,aAArB,CAAqC,CAArC,CACA3rB,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqBs6D,UAArB,CAAkC,CAAE/3C,aAAa,CAAE,CAAjB,CAAoB7Z,eAAe,CAAE,mBAArC,CAAlC,CACH,CAED;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,CAtCD,CAyCA9R,EAAE,CAACsmE,YAAH,CAAkB,CACdh8D,UAAU,CAAE,YADE,CAEdC,SAAS,CAAE,WAFG,CAGdy0B,KAAK,CAAE,eAHO,CAIdunC,GAAG,CAAE,eAJS,CAKdC,iBAAiB,CAAE,mBALL,CAMdrH,gBAAgB,CAAE,uBANJ,CAOdxzC,aAAa,CAAE,iBAPD,CAAlB,CAWAlrB,MAAM,CAACimE,aAAP,CAAuB,SAASr+D,IAAT,CAAc,CACjC;AACA;AACA;AACA;AACA;AACA;AACA;AAEH,CATD,CAYA5H,MAAM,CAACwlE,YAAP,CAAsB,UAAU,CAC5B;AAGA;AACAjmE,EAAE,CAACyjE,cAAH,CAAoBphE,CAAC,CAACC,IAAF,CAAOtC,EAAE,CAACyjE,cAAV,CAA0B,SAASlhE,CAAT,CAAW,CACjD,MAAOA,CAAAA,CAAC,CAAC4uD,QAAF,EAAc,OAArB,CACP,CAFmB,CAApB,CAKA;AACA;AACA;AAEA;AACA,GAAGnxD,EAAE,CAACmyB,oBAAH,CAAwBhrB,OAAxB,CAAgC,YAAhC,EAAgD,CAAC,CAAjD,EAAsDnH,EAAE,CAACmyB,oBAAH,CAAwBhrB,OAAxB,CAAgC,WAAhC,EAA+C,CAAC,CAAtG,EAA2GnH,EAAE,CAACmyB,oBAAH,CAAwBhrB,OAAxB,CAAgC,OAAhC,EAA2C,CAAC,CAA1J,CAA4J,CACxJ;AAEA,IAAI,GAAIiC,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAACpJ,EAAE,CAACyjE,cAAH,CAAkB1hE,MAAhC,CAAuCqH,CAAC,EAAxC,CAA2C,CACvC,GAAGpJ,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqBs6D,UAAxB,CAAmC,CAC/B,GAAG1jE,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqBs6D,UAArB,CAAgC/3C,aAAnC,CAAiD,CAC7C3rB,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqB,eAArB,EAAwCpJ,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqBs6D,UAArB,CAAgC/3C,aAAxE,CACA,MAAO3rB,CAAAA,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqBs6D,UAA5B,CACH,CACJ,CACJ,CAED;AACA;AACA;AAEA1jE,EAAE,CAACmyB,oBAAH,CAAwB3vB,IAAxB,CAA6B,eAA7B,EACAxC,EAAE,CAACmyB,oBAAH,CAAwB3vB,IAAxB,CAA6B,kBAA7B,EAEA;AACA,GAAIukE,CAAAA,eAAe,CAAG,EAAtB,CACA,IAAI,GAAI/9D,CAAAA,CAAC,CAAC,CAAV,CAAaA,CAAC,CAAChJ,EAAE,CAACyjE,cAAH,CAAkB1hE,MAAjC,CAAwCiH,CAAC,EAAzC,CAA4C,CACxC,GAAIsG,CAAAA,GAAG,CAAG,CACNrP,IAAI,CAAE,EADA,CAENoP,OAAO,CAAErP,EAAE,CAACqP,OAFN,CAAV,CAIA,IAAI,GAAI9F,CAAAA,CAAC,CAAC,CAAV,CAAaA,CAAC,CAACvJ,EAAE,CAACmyB,oBAAH,CAAwBpwB,MAAvC,CAA8CwH,CAAC,EAA/C,CAAkD,CAC9C,GAAGvJ,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,CAAH,CAA8B,CAC1B;AACA,GAAGvJ,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,GAA8B,YAA9B,EAA8CvJ,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,GAA8B,WAA5E,EAA2FvJ,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,GAA8B,KAAzH,EAAkIvJ,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,GAA8B,OAAnK,CAA2K,CACvK+F,GAAG,CAAC,MAAD,CAAH,CAAYtP,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,CAAZ,EAA0CvJ,EAAE,CAACyjE,cAAH,CAAkBz6D,CAAlB,EAAqBwS,MAAM,CAAC2V,IAAP,CAAYnxB,EAAE,CAACyjE,cAAH,CAAkBz6D,CAAlB,CAAZ,EAAkCO,CAAlC,CAArB,CAA1C,CACH,CAFD,IAEO,CACH,GAAGvJ,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,GAA8B,kBAA9B,EAAoDvJ,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,GAA8B,eAArF,CAAqG,CACjG+F,GAAG,CAACtP,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,CAAD,CAAH,CAAkCvJ,EAAE,CAACyjE,cAAH,CAAkBz6D,CAAlB,EAAqBhJ,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,CAArB,CAAlC,CACH,CAFD,IAEO,CACH+F,GAAG,CAACtP,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,CAAD,CAAH,CAAkCvJ,EAAE,CAACyjE,cAAH,CAAkBz6D,CAAlB,EAAqBwS,MAAM,CAAC2V,IAAP,CAAYnxB,EAAE,CAACyjE,cAAH,CAAkBz6D,CAAlB,CAAZ,EAAkCO,CAAlC,CAArB,CAAlC,CACH,CACJ,CACD;AACH,CAZD,IAYO,CACH;AACA;AACH,CACJ,CACDw9D,eAAe,CAACvkE,IAAhB,CAAqB8M,GAArB,EACH,CACD;AACA;AACA;AAEA;AACAjP,aAAa,CAAC2mE,UAAd,CAAyBD,eAAzB,EACCrlE,IADD,CACM,SAASC,IAAT,CAAc,CAChB;AACAjB,MAAM,CAACymB,EAAP,CAAU,+BAAV,EACH,CAJD,EAMH,CAzDD,IAyDO,CACH;AACA/lB,YAAY,CAACkD,OAAb,CAAqB,gBAArB,CAAuC,uGAAvC,EACH,CAIJ,CA/ED,CAkFA7D,MAAM,CAACwhC,MAAP,CAAgB,UAAU,CACtB;AACAjiC,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAe7iB,OAAf,CAAyBrP,EAAE,CAACqP,OAA5B,CACAhP,aAAa,CAACuE,MAAd,CAAqB5E,EAAE,CAAC6P,IAAH,CAAQqiB,MAA7B,EACKxwB,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AACAjB,MAAM,CAACymB,EAAP,CAAU,+BAAV,EACH,CAJL,EAKH,CARD,CAUA1mB,MAAM,UAAN,CAAgB,UAAU,CACtB;AACAW,YAAY,CAACkD,OAAb,CAAqB,gBAArB,CAAuC,wDAAvC,EACAjE,aAAa,CAACgX,MAAd,CAAqBrX,EAAE,CAAC6P,IAAH,CAAQ6zD,UAA7B,EACKhiE,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AACH,CAHL,EAIH,CAPD,CASAlB,MAAM,CAACyhC,MAAP,CAAgB,UAAU,CACtB;AACAliC,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAe7iB,OAAf,CAAyBrP,EAAE,CAACqP,OAA5B,CAEAhP,aAAa,CAACgX,MAAd,CAAqBrX,EAAE,CAAC6P,IAAH,CAAQqiB,MAA7B,EACaxwB,IADb,CACkB,SAASC,IAAT,CAAc,CAChB;AACA;AACAjB,MAAM,CAACymB,EAAP,CAAU,+BAAV,EACH,CALb,EAOA9mB,aAAa,CAAC8nE,gBAAd,CAA+BnoE,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAelwB,EAA9C,CAAkDhC,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAe7iB,OAAjE,CAA0ErP,EAAE,CAAC6P,IAAH,CAAQC,MAAlF,EACKpO,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AACA;AAEH,CALL,EAOI;AAEP,CApBD,CAsBAlB,MAAM,CAAC6nE,gBAAP,CAA0B,SAASz8D,IAAT,CAAc,CACpC;AACA;AACA7L,EAAE,CAACsoE,gBAAH,CAAsBjmE,CAAC,CAACC,IAAF,CAAOtC,EAAE,CAAC6P,IAAH,CAAQswB,OAAf,CAAwB,SAAS59B,CAAT,CAAW,CACrD,MAAOA,CAAAA,CAAC,CAAC4uD,QAAF,EAAc,IAArB,CACH,CAFqB,CAAtB,CAGA;AAEA;AAGA,IAAI,GAAI1tD,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAAGzD,EAAE,CAACsoE,gBAAH,CAAoBvmE,MAApC,CAA4C0B,CAAC,EAA7C,CAAgD,CAE5C,GAAGoI,IAAI,EAAI,SAAX,CAAqB,CACjB7L,EAAE,CAACsoE,gBAAH,CAAoB7kE,CAApB,EAAuB47D,QAAvB,CAAkC,CAAlC,CACH,CAFD,IAEO,CACHr/D,EAAE,CAACsoE,gBAAH,CAAoB7kE,CAApB,EAAuB47D,QAAvB,CAAkC,CAAlC,CACH,CACD;AACAh/D,aAAa,CAACgX,MAAd,CAAqBrX,EAAE,CAACsoE,gBAAH,CAAoB7kE,CAApB,CAArB,EACK/B,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AACA;AACH,CAJL,EAKH,CAEDjB,MAAM,CAACymB,EAAP,CAAU,+BAAV,EAEH,CA5BD,CA8BA1mB,MAAM,CAAC8nE,iBAAP,CAA2B,SAAS74D,IAAT,CAAemY,KAAf,CAAqB,CAC5C7nB,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAevG,aAAf,CAA+Bjc,IAAI,CAACic,aAApC,CACA3rB,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAepgB,eAAf,CAAiCpC,IAAI,CAACoC,eAAtC,CACH,CAHD,CAKA46B,cAAc,GAEd,QAASA,CAAAA,cAAT,EAA0B,CACvB;AACF,CAGD,GAAI5G,CAAAA,WAAW,CAAG,wGAAlB,CAEArlC,MAAM,CAACoC,IAAP,CAAc,SAAU2iC,SAAV,CAAqB,CAC/B,GAAIC,CAAAA,aAAa,CAAG7kC,SAAS,CAACiC,IAAV,CAAe,CACjC6iC,SAAS,CAAE,IADsB,CAEjCC,WAAW,CAAE,+BAFoB,CAGjCjmC,UAAU,CAAE,mBAHqB,CAIjCkmC,IAAI,CAAE,IAJ2B,CAKjCC,OAAO,CAAE,CACP7jC,EAAE,CAAE,aAAY,CACd,MAAOwjC,CAAAA,SAAP,CACD,CAHM,CAIPlhC,OAAO,CAAE,kBAAU,CACf,MAAOwhC,CAAAA,WAAP,CACH,CANM,CALwB,CAAf,CAApB,CAcAL,aAAa,CAAC7W,MAAd,CAAqBltB,IAArB,CAA0B,SAAU8jC,SAAV,CAAqB,CAC7C3kC,IAAI,CAACkN,IAAL,CAAU,eAAey3B,SAAzB,EACAnlC,aAAa,CAACkX,MAAd,CAAqBiuB,SAArB,EACC9jC,IADD,CACM,UAAU,CACd;AACA;AACC1B,EAAE,CAAC6P,IAAH,CAAQswB,OAAR,CAAkB99B,CAAC,CAACC,IAAF,CAAOtC,EAAE,CAAC6P,IAAH,CAAQswB,OAAf,CAAwB,SAAS59B,CAAT,CAAW,CAClD,MAAOA,CAAAA,CAAC,CAACP,EAAF,EAAQwjC,SAAf,CACH,CAFkB,CAAlB,CAGF,CAPD,EAQD,CAVD,CAUG,UAAY,CACb3kC,IAAI,CAACkN,IAAL,CAAU,uBAAyB,GAAI8R,CAAAA,IAAJ,EAAnC,EACD,CAZD,EAaD,CA5BH,CAiCH,CACJpgB,GAAG,CAACC,UAAJ,CAAe,0CAAf,CAA2DoiF,wCAA3D,EAEGA,wCAAwC,CAACliF,OAAzC,CAAmD,CAAC,aAAD,CAAgB,eAAhB,CAAiC,mBAAjC,CAAsD,mBAAtD,CAA2E,gBAA3E,CAA6F,YAA7F,CAA2G,WAA3G,CAAwH,QAAxH,CAAkI,QAAlI,CAA4I,cAA5I,CAA4J,WAA5J,CAAyK,MAAzK,CAAiL,SAAjL,CAA4L,UAA5L,CAAwM,UAAxM,CAAoN,kBAApN,CAAwO,cAAxO,CAAnD,CACA,QAASkiF,CAAAA,wCAAT,CAAkDjiF,WAAlD,CAA+DQ,aAA/D,CAA8EC,iBAA9E,CAAiGC,iBAAjG,CAAoHC,cAApH,CAAoIV,UAApI,CAAgJC,SAAhJ,CAA2JU,MAA3J,CAAmKC,MAAnK,CAA2KC,YAA3K,CAAyLC,SAAzL,CAAoMC,IAApM,CAA0MC,OAA1M,CAAmNC,QAAnN,CAA6NC,QAA7N,CAAuOC,gBAAvO,CAAyPG,YAAzP,CAAuQ,CACnQ,GAAIpB,CAAAA,EAAE,CAAG,IAAT,CAEA,GAAI6xB,CAAAA,gBAAgB,CAAG,GAAvB,CACA,GAAIC,CAAAA,cAAc,CAAG,IAArB,CAEArxB,MAAM,CAACsxB,GAAP,CAAa,KAAb,CAEA/xB,EAAE,CAACC,IAAH,CAAU,IAAV,CACAD,EAAE,CAACgyB,QAAH,CAAc,EAAd,CACAhyB,EAAE,CAAC6P,IAAH,CAAU,EAAV,CACA7P,EAAE,CAACiyB,UAAH,CAAgB,EAAhB,CACAjyB,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAiB,EAAjB,CAEAlyB,EAAE,CAACmyB,oBAAH,CAA0B,EAA1B,CAEA;AAEAnyB,EAAE,CAACgnB,MAAH,CAAYtmB,MAAM,CAACqmB,OAAP,CAAeplB,IAAf,CAAoBqlB,MAAhC,CAIA;AACA;AAEAhnB,EAAE,CAACC,IAAH,CAAUH,UAAU,CAACI,OAAX,CAAmBC,WAA7B,CACAH,EAAE,CAAC2E,OAAH,CAAa3E,EAAE,CAACC,IAAH,CAAQ+B,EAArB,CAGAhC,EAAE,CAACi0B,YAAH,CAAkB,CAAC,kBAAD,CAAqB,eAArB,CAAsC,UAAtC,CAAlB,CAEA,GAAIC,CAAAA,OAAO,CAAG,GAAIrU,CAAAA,IAAJ,EAAd,CAEA,GAAIsU,CAAAA,OAAO,CAAG7oB,IAAI,CAACC,KAAL,CAAYsmB,gBAAgB,CAAG,EAA/B,CAAd,CACA,GAAIuC,CAAAA,OAAO,CAAGvC,gBAAgB,CAAG,EAAjC,CACA,GAAIwC,CAAAA,KAAK,CAAG/oB,IAAI,CAACC,KAAL,CAAYumB,cAAc,CAAG,EAA7B,CAAZ,CACA,GAAIwC,CAAAA,KAAK,CAAGxC,cAAc,CAAG,EAA7B,CAEA,GAAIyC,CAAAA,YAAY,CAAG,GAAI1U,CAAAA,IAAJ,CAASqU,OAAO,CAACM,WAAR,EAAT,CAAgCN,OAAO,CAACO,QAAR,EAAhC,CAAoDP,OAAO,CAACQ,OAAR,EAApD,CAAuEP,OAAvE,CAAgFC,OAAhF,CAAyF,CAAzF,CAAnB,CACA,GAAIO,CAAAA,UAAU,CAAG,GAAI9U,CAAAA,IAAJ,CAASqU,OAAO,CAACM,WAAR,EAAT,CAAgCN,OAAO,CAACO,QAAR,EAAhC,CAAoDP,OAAO,CAACQ,OAAR,EAApD,CAAuEL,KAAvE,CAA8EC,KAA9E,CAAqF,CAArF,CAAjB,CAGA7zB,MAAM,CAACk9B,eAAP,CAAyB,CACrB50B,IAAI,CAAE,CACF8X,IAAI,CAAE0T,YADJ,CAEFzT,EAAE,CAAE6T,UAFF,CADe,CAKrBjuB,IAAI,CAAE,CACFma,IAAI,CAAEgR,gBADJ,CACsB;AACxB/Q,EAAE,CAAEgR,cAFF,CAEkB;AACpBiwD,IAAI,CAAE,EAHJ,CAGQ;AACVC,QAAQ,CAAE,EAJR,CAIY;AACdC,OAAO,CAAE,IAAK;AALZ,CALe,CAAzB,CAcAxhF,MAAM,CAACyhF,gBAAP,CAA0B,CACtBn5E,IAAI,CAAE,CACF8X,IAAI,CAAE,YADJ,CAEFC,EAAE,CAAE,UAFF,CADgB,CAA1B,CAOJrgB,MAAM,CAACk1B,MAAP,CAAgB,IAAhB,CACAl1B,MAAM,CAAC0hF,eAAP,CAAyB,UAAW,CAChC1hF,MAAM,CAACk1B,MAAP,CAAgB,CAACl1B,MAAM,CAACk1B,MAAxB,CACH,CAFD,CAIAl1B,MAAM,CAACm1B,kBAAP,CAA4B,EAA5B,CACAn1B,MAAM,CAACo1B,cAAP,CAAwB,IAAxB,CAKA,QAAS6M,CAAAA,SAAT,CAAmB/gC,IAAnB,CAAyBghC,MAAzB,CAAgC,CAC5B,GAAI55B,CAAAA,IAAI,CAAGtI,MAAM,CAACk9B,eAAP,CAAuB50B,IAAvB,CAA4B45B,MAA5B,CAAX,CACA,GAAI35B,CAAAA,CAAC,CAAGD,IAAI,CAAC2rB,OAAL,EAAR,CACA,GAAIkO,CAAAA,CAAC,CAAG75B,IAAI,CAAC0rB,QAAL,EAAR,CACA,GAAIoO,CAAAA,CAAC,CAAG95B,IAAI,CAACyrB,WAAL,EAAR,CAEA;AACA,GAAIpO,CAAAA,CAAC,CAAGzkB,IAAI,CAACghC,MAAD,CAAZ,CACA,GAAIG,CAAAA,CAAC,CAAG1c,CAAC,CAAC8B,KAAF,CAAQ,CAAR,CAAU,CAAV,CAAR,CACA,GAAIpmB,CAAAA,CAAC,CAAGskB,CAAC,CAAC8B,KAAF,CAAQ,CAAR,CAAU,CAAV,CAAR,CACA;AAEApmB,CAAC,CAAIA,CAAC,CAACoT,QAAF,IAAgB,IAAjB,CAAwB,CAAxB,CAA4BpT,CAAhC,CAEA;AACA;AACA,GAAIiH,CAAAA,IAAI,CAAG,GAAI8W,CAAAA,IAAJ,CAASgjB,CAAT,CAAYD,CAAZ,CAAe55B,CAAf,CAAkB85B,CAAlB,CAAqBhhC,CAArB,CAAwB,CAAxB,CAAX,CACA,MAAOiH,CAAAA,IAAP,CACH,CAEDtI,MAAM,CAAC2hF,cAAP,CAAwB,SAAUzgF,IAAV,CAAgB,CACpC;AAEA,GAAIkf,CAAAA,IAAI,CAAG6hB,SAAS,CAAC/gC,IAAD,CAAO,MAAP,CAApB,CACA,GAAImf,CAAAA,EAAE,CAAG4hB,SAAS,CAAC/gC,IAAD,CAAO,IAAP,CAAlB,CAEAlB,MAAM,CAACk9B,eAAP,CAAuB50B,IAAvB,CAA4B8X,IAA5B,CAAmCA,IAAnC,CACApgB,MAAM,CAACk9B,eAAP,CAAuB50B,IAAvB,CAA4B+X,EAA5B,CAAiCA,EAAjC,CACA;AAGArgB,MAAM,CAACm1B,kBAAP,CAA4Bj0B,IAA5B,CACH,CAZD,CAcA;AACAlB,MAAM,CAAC4hF,eAAP,CAAyB,CACrB37E,IAAI,CAAE,CACFma,IAAI,CAAE,GADJ,CACS;AACXC,EAAE,CAAE,IAFF,CAEQ;AACVihE,IAAI,CAAE,EAHJ,CAGQ;AACVC,QAAQ,CAAE,EAJR,CAIY;AACdC,OAAO,CAAE,IAAK;AALZ,CADe,CAAzB,CAUA;AACAxhF,MAAM,CAAC6hF,eAAP,CAAyB,CACrBv5E,IAAI,CAAE,CACF8X,IAAI,CAAE,GAAIhB,CAAAA,IAAJ,EADJ,CAEFiB,EAAE,CAAE,GAAIjB,CAAAA,IAAJ,EAFF,CADe,CAAzB,CASA;AACA,GACI0iE,CAAAA,MAAM,CAAQ,GAAI1iE,CAAAA,IAAJ,EADlB,CAEI2iE,UAAU,CAAI,GAAI3iE,CAAAA,IAAJ,CAAU0iE,MAAM,CAACpe,OAAP,GAAoB,SAAW,EAAzC,CAFlB,CAIA1jE,MAAM,CAACgiF,mBAAP,CAA6B,CACzB15E,IAAI,CAAE,CACF8X,IAAI,CAAE,GAAIhB,CAAAA,IAAJ,EADJ,CAEFiB,EAAE,CAAE,GAAIjB,CAAAA,IAAJ,EAFF,CAGF6iE,GAAG,CAAEH,MAHH,CAIF92E,GAAG,CAAE+2E,UAJH,CADmB,CAOzB97E,IAAI,CAAE,CACFma,IAAI,CAAE,GADJ,CACS;AACXC,EAAE,CAAE,IAFF,CAEQ;AACVihE,IAAI,CAAE,EAHJ,CAGQ;AACVC,QAAQ,CAAE,EAJR,CAIY;AACdC,OAAO,CAAE,IAAK;AALZ,CAPmB,CAA7B,CAiBA;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EA5O2Q,CAoP3Q,6EAGI,GAAIl5E,CAAAA,IAAI,CAAG,GAAI8W,CAAAA,IAAJ,EAAX,CACA,GAAI7W,CAAAA,CAAC,CAAGD,IAAI,CAAC2rB,OAAL,EAAR,CACA,GAAIkO,CAAAA,CAAC,CAAG75B,IAAI,CAAC0rB,QAAL,EAAR,CACA,GAAIoO,CAAAA,CAAC,CAAG95B,IAAI,CAACyrB,WAAL,EAAR,CAEA,6CA5PuQ,CA6PvQ;AACA;AACA;AACA;AACA;AAEA,2DACC/zB,MAAM,CAACi3B,MAAP,CAAgB,EAAhB,CACD;AACA;AACA;AACA;AACA;AACA;AACA;AAECl3B,cAAc,CAAC8V,MAAf,CAAsBtW,EAAE,CAACC,IAAH,CAAQ+B,EAA9B,EACIN,IADJ,CACS,SAASC,IAAT,CAAc,CACf,IAAI,GAAIG,CAAAA,CAAC,CAAC,CAAV,CAAaA,CAAC,CAACH,IAAI,CAACI,MAApB,CAA2BD,CAAC,EAA5B,CAA+B,CAC3BrB,MAAM,CAACi3B,MAAP,CAAcl1B,IAAd,CAAmB,CACfR,EAAE,CAAEL,IAAI,CAACG,CAAD,CAAJ,CAAQE,EADG,CAEf2D,KAAK,CAAEhE,IAAI,CAACG,CAAD,CAAJ,CAAQ6D,KAFA,CAGfqT,KAAK,CAAE,GAAI6G,CAAAA,IAAJ,CAASle,IAAI,CAACG,CAAD,CAAJ,CAAQw+C,SAAjB,CAHQ,CAIf9qB,GAAG,CAAE,GAAI3V,CAAAA,IAAJ,CAASle,IAAI,CAACG,CAAD,CAAJ,CAAQu+C,OAAjB,CAJU,CAKftjB,MAAM,CAAEp7B,IAAI,CAACG,CAAD,CAAJ,CAAQi7B,MALD,CAMfC,SAAS,CAAE,CAAC,YAAD,CANI,CAAnB,EAQH,CAED;AAEJ,CAfJ,EAkBD,6DA/RuQ,CAgSvQ;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA,yBACAv8B,MAAM,CAACk7B,iBAAP,CAA2B,SAAU5yB,IAAV,CAAgBovB,OAAhB,CAAyBJ,IAAzB,CAA8B,CACrDt3B,MAAM,CAACm7B,YAAP,CAAuB7yB,IAAI,CAACpD,KAAL,CAAa,eAApC,CAEA;AAEH,CALD,CAOA,mBACClF,MAAM,CAACo7B,WAAP,CAAqB,SAASjtB,KAAT,CAAgBktB,KAAhB,CAAuBC,UAAvB,CAAmC5D,OAAnC,CAA4C6D,EAA5C,CAAgDjE,IAAhD,CAAqD,CAEvE;AACA;AACA;AACA;AACA;AACA;AAGA;AAEA;AACAv3B,cAAc,CAAC6W,MAAf,CAAsBrX,EAAE,CAACC,IAAH,CAAQ+B,EAA9B,CAAkC4M,KAAlC,EACClN,IADD,CACM,SAASC,IAAT,CAAc,CAChB;AACH,CAHD,EAKDlB,MAAM,CAACm7B,YAAP,CAAuB,eAAvB,CACF,CAnBA,CAqBD,qBACAn7B,MAAM,CAACy7B,aAAP,CAAuB,SAASttB,KAAT,CAAgBktB,KAAhB,CAAuBC,UAAvB,CAAmC5D,OAAnC,CAA4C6D,EAA5C,CAAgDjE,IAAhD,CAAsD,CAEzE;AACAv3B,cAAc,CAAC6W,MAAf,CAAsBrX,EAAE,CAACC,IAAH,CAAQ+B,EAA9B,CAAkC4M,KAAlC,EACClN,IADD,CACM,SAASC,IAAT,CAAc,CAChB;AACH,CAHD,EAKDlB,MAAM,CAACm7B,YAAP,CAAuB,eAAvB,CACF,CATD,CAaA,+CACAn7B,MAAM,CAACkiF,oBAAP,CAA8B,SAASC,OAAT,CAAiB/lD,MAAjB,CAAyB,CACrD,GAAIgmD,CAAAA,MAAM,CAAG,CAAb,CACAl6E,OAAO,CAACvC,OAAR,CAAgBw8E,OAAhB,CAAwB,SAASziC,KAAT,CAAgB9uB,GAAhB,CAAoB,CAC1C,GAAGuxD,OAAO,CAACvxD,GAAD,CAAP,GAAiBwL,MAApB,CAA2B,CACzB+lD,OAAO,CAACjgF,MAAR,CAAe0uB,GAAf,CAAmB,CAAnB,EACAwxD,MAAM,CAAG,CAAT,CACD,CACF,CALD,EAMA,GAAGA,MAAM,GAAK,CAAd,CAAgB,CACdD,OAAO,CAACpgF,IAAR,CAAaq6B,MAAb,EACD,CACF,CAXD,CAgBAp8B,MAAM,CAAC20B,iBAAP,CAA2B,KAA3B,CACA30B,MAAM,CAACi9B,QAAP,CAAkB,UAAU,CAEzB,GAAGj9B,MAAM,CAAC20B,iBAAP,EAA4B,IAA/B,CAAoC,CAC/B30B,MAAM,CAAC20B,iBAAP,CAA2B,KAA3B,CACA30B,MAAM,CAACk9B,eAAP,CAAuBj3B,IAAvB,CAA4Bma,IAA5B,CAAmCgR,gBAAnC,CACApxB,MAAM,CAACk9B,eAAP,CAAuBj3B,IAAvB,CAA4Boa,EAA5B,CAAiCgR,cAAjC,CACJ,CAJD,IAIO,CACFrxB,MAAM,CAAC20B,iBAAP,CAA2B,IAA3B,CACA30B,MAAM,CAACk9B,eAAP,CAAuBj3B,IAAvB,CAA4Bma,IAA5B,CAAmC,CAAnC,CACApgB,MAAM,CAACk9B,eAAP,CAAuBj3B,IAAvB,CAA4Boa,EAA5B,CAAiC,IAAjC,CACJ,CAGH,CAbD,CAiBA,qBACArgB,MAAM,CAACqiF,QAAP,CAAkB,UAAW,CAE3B,GAAIC,CAAAA,MAAM,CAAGtiF,MAAM,CAACk9B,eAAP,CAAuB50B,IAAvB,CAA4B8X,IAAzC,CACA,GAAImiE,CAAAA,IAAI,CAAGviF,MAAM,CAACk9B,eAAP,CAAuB50B,IAAvB,CAA4B+X,EAAvC,CAEA;AACA;AAEA,GAAIwZ,CAAAA,SAAS,CAAG,CACd30B,KAAK,CAAE,SADO,CAEdqT,KAAK,CAAE+pE,MAFO,CAGdvtD,GAAG,CAAEwtD,IAHS,CAIdhmD,SAAS,CAAE,CAAC,YAAD,CAJG,CAKdD,MAAM,CAAEt8B,MAAM,CAAC20B,iBALD,CAAhB,CAQA30B,MAAM,CAACi3B,MAAP,CAAcl1B,IAAd,CAAmB83B,SAAnB,EAEA;AACA;AAEA95B,cAAc,CAACoE,MAAf,CAAsB5E,EAAE,CAACC,IAAH,CAAQ+B,EAA9B,CAAkCs4B,SAAlC,EACG54B,IADH,CACQ,SAASC,IAAT,CAAc,CAChB;AAEAjB,MAAM,CAACymB,EAAP,CAAU,2CAAV,EAGH,CAPH,EASD,CA9BD,CAgCA,kBACA1mB,MAAM,CAAC0jC,MAAP,CAAgB,SAASzhC,KAAT,CAAgB,CAE5B,GAAIugF,CAAAA,SAAS,CAAGxiF,MAAM,CAACi3B,MAAP,CAAch1B,KAAd,EAAqBV,EAArC,CACA;AACA;AAEFxB,cAAc,CAAC+W,MAAf,CAAsBvX,EAAE,CAACC,IAAH,CAAQ+B,EAA9B,CAAkCihF,SAAlC,EACGvhF,IADH,CACQ,SAASC,IAAT,CAAc,CAEhBlB,MAAM,CAACi3B,MAAP,CAAc/0B,MAAd,CAAqBD,KAArB,CAA2B,CAA3B,EAEH,CALH,EAQD,CAdD,CAgBA,iBACAjC,MAAM,CAACm9B,UAAP,CAAoB,SAAS7F,IAAT,CAAcS,QAAd,CAAwB,CAC1Cv3B,gBAAgB,CAAC48B,SAAjB,CAA2BrF,QAA3B,EAAqCpC,YAArC,CAAkD,YAAlD,CAA+D2B,IAA/D,EACD,CAFD,CAIA,iBACAt3B,MAAM,CAACq9B,cAAP,CAAwB,SAAStF,QAAT,CAAmB,CACzCx3B,QAAQ,CAAC,UAAW,CAClB,GAAGC,gBAAgB,CAAC48B,SAAjB,CAA2BrF,QAA3B,CAAH,CAAwC,CACtCv3B,gBAAgB,CAAC48B,SAAjB,CAA2BrF,QAA3B,EAAqCpC,YAArC,CAAkD,QAAlD,EACD,CACF,CAJO,CAAR,CAKD,CAND,CAUA,oBACA31B,MAAM,CAACo3B,WAAP,CAAqB,SAAUjpB,KAAV,CAAiBkpB,OAAjB,CAA0BC,IAA1B,CAAiC,CAClDD,OAAO,CAACE,IAAR,CAAa,CAAC,UAAWppB,KAAK,CAACjJ,KAAlB,CACC,yBAA0B,IAD3B,CAAb,EAEA5E,QAAQ,CAAC+2B,OAAD,CAAR,CAAkBr3B,MAAlB,EACH,CAJD,CAMA,mBACAA,MAAM,CAAC83B,QAAP,CAAkB,CAChB2qD,mBAAmB,CAAE,4CADL,CAEhB1qD,QAAQ,CAAC,CACPs4B,MAAM,CAAE,GADD,CAEP7zB,QAAQ,CAAE,IAFH,CAGPomC,MAAM,CAAC,CACL8f,IAAI,CAAE,OADD,CAELC,MAAM,CAAE,EAFH,CAGLC,KAAK,CAAE,iBAHF,CAHA,CAQP36B,QAAQ,CAAE,CARH,CASP46B,gBAAgB,CAAE,KATX,CAUPC,UAAU,CAAE9iF,MAAM,CAACk7B,iBAVZ,CAWP6nD,SAAS,CAAE/iF,MAAM,CAACo7B,WAXX,CAYP4nD,WAAW,CAAEhjF,MAAM,CAACy7B,aAZb,CAaPrE,WAAW,CAAEp3B,MAAM,CAACo3B,WAbb,CAFO,CAAlB,CAmBAp3B,MAAM,CAAC63B,UAAP,CAAoB,UAAW,CAE3B73B,MAAM,CAAC83B,QAAP,CAAgBC,QAAhB,CAAyBC,QAAzB,CAAoC,CAAC,QAAD,CAAW,QAAX,CAAqB,SAArB,CAAgC,WAAhC,CAA6C,UAA7C,CAAyD,QAAzD,CAAmE,UAAnE,CAApC,CACAh4B,MAAM,CAAC83B,QAAP,CAAgBC,QAAhB,CAAyBE,aAAzB,CAAyC,CAAC,KAAD,CAAQ,KAAR,CAAe,KAAf,CAAsB,KAAtB,CAA6B,KAA7B,CAAoC,KAApC,CAA2C,KAA3C,CAAzC,CAEH,CALD,CAOA,wBACAj4B,MAAM,CAACijF,YAAP,CAAsB,CAACjjF,MAAM,CAACi3B,MAAR,CAAtB,CACA;AAIJ,8EA7e2Q,CAwfnQ;AAEA;AACA;AACA;AAEA,OAAO13B,EAAE,CAACgnB,MAAV,EACI,IAAK,KAAL,CACI;AACAhnB,EAAE,CAACiyB,UAAH,CAAgB,kBAAhB,CAIJ,MACA,IAAK,MAAL,CACI;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACJ,MACA,IAAK,MAAL,CACI;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGJ,MACA,QACI;AACJ,MAjFJ,CAoFA;AAEAxxB,MAAM,CAAC42B,IAAP,CAAc,UAAU,CACpBv2B,OAAO,CAACw2B,OAAR,CAAgBD,IAAhB,GACH,CAFD,CAIA52B,MAAM,CAACuhC,IAAP,CAAc,UAAU,CACpB,GAAGhiC,EAAE,CAACgnB,MAAH,EAAa,KAAhB,CAAsB,CAClB;AACAvmB,MAAM,CAACwhC,MAAP,GACH,CAHD,IAGO,CACH;AACA;AACAxhC,MAAM,CAACyhC,MAAP,GACH,CACJ,CATD,CAcA;AACA;AACA;AACA;AAGAzhC,MAAM,CAACsiE,SAAP,CAAmB,SAASC,OAAT,CAAkB,CAC7B,GAAIC,CAAAA,KAAK,CAACD,OAAO,CAACE,GAAR,CAAY97D,KAAZ,CAAkB,SAAlB,CAAV,CACA,GAAIwnB,CAAAA,MAAM,CAAG,EAAb,CACA,GAAI5V,CAAAA,KAAK,CAAG,CAAZ,CACAiqD,KAAK,CAAC,CAAD,CAAL,EAAY,0CAAZ,CACA,IAAK,GAAIx/D,CAAAA,CAAC,CAAC,CAAX,CAAcA,CAAC,CAACw/D,KAAK,CAAClhE,MAAtB,CAA8B0B,CAAC,EAA/B,CAAmC,CAC/Bw/D,KAAK,CAACx/D,CAAD,CAAL,EAAY,sCAAZ,CACH,CACD,GAAI0/D,CAAAA,WAAW,CAAGF,KAAK,CAAC,CAAD,CAAL,CAAS77D,KAAT,CAAe47D,OAAO,CAACI,SAAvB,EAAkCrhE,MAApD,CAEA,GAAImK,CAAAA,OAAO,CAAG,EAAd,CACA,GAAI82D,OAAO,CAACK,MAAZ,CAAoB,CAChBn3D,OAAO,CAAC+2D,KAAK,CAAC,CAAD,CAAL,CAAS77D,KAAT,CAAe47D,OAAO,CAACI,SAAvB,CAAR,CACApjE,EAAE,CAACsjE,gBAAH,CAAsBp3D,OAAtB,CACA8M,KAAK,CAAG,CAAR,CACH,CAED,IAAK,GAAIlX,CAAAA,CAAC,CAACkX,KAAX,CAAkBlX,CAAC,CAACmhE,KAAK,CAAClhE,MAA1B,CAAkCD,CAAC,EAAnC,CAAuC,CACnC,GAAIwN,CAAAA,GAAG,CAAG,EAAV,CACI,GAAIi0D,CAAAA,WAAW,CAACN,KAAK,CAACnhE,CAAD,CAAL,CAASsF,KAAT,CAAe,GAAIorC,CAAAA,MAAJ,CAAWwwB,OAAO,CAACI,SAAR,CAAkB,oCAA7B,CAAf,CAAhB,CACA,GAAKG,WAAW,CAACxhE,MAAZ,GAAuBohE,WAA5B,CAA0C,CACtC,GAAIH,OAAO,CAACK,MAAZ,CAAoB,CAChB,IAAK,GAAI5/D,CAAAA,CAAC,CAAC,CAAX,CAAcA,CAAC,CAACyI,OAAO,CAACnK,MAAxB,CAAgC0B,CAAC,EAAjC,CAAqC,CACjC6L,GAAG,CAACpD,OAAO,CAACzI,CAAD,CAAR,CAAH,CAAkB8/D,WAAW,CAAC9/D,CAAD,CAA7B,CACH,CACJ,CAJD,IAIO,CACH,IAAK,GAAI6c,CAAAA,CAAC,CAAC,CAAX,CAAcA,CAAC,CAACijD,WAAW,CAACxhE,MAA5B,CAAoCue,CAAC,EAArC,CAAyC,CACrChR,GAAG,CAACgR,CAAD,CAAH,CAASijD,WAAW,CAACjjD,CAAD,CAApB,CACH,CACJ,CACDsO,MAAM,CAACpsB,IAAP,CAAY8M,GAAZ,EACH,CAER,CAED;AACA;AAEA,MAAOsf,CAAAA,MAAP,CACH,CAvCL,CA4CAnuB,MAAM,CAACslE,WAAP,CAAqB,UAAW,CAC5B;AACA8b,OAAO,CAAG7hF,EAAE,CAACimE,YAAb,CACA,GAAID,CAAAA,UAAU,CAAG,CACb9C,GAAG,CAAEljE,EAAE,CAACimE,YADK,CAEb7C,SAAS,CAAE,GAFE,CAGbC,MAAM,CAAE,IAHK,CAAjB,CAKArjE,EAAE,CAACyjE,cAAH,CAAoBhjE,MAAM,CAACsiE,SAAP,CAAiBiD,UAAjB,CAApB,CAEC,IAAI,GAAI58D,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAACpJ,EAAE,CAACyjE,cAAH,CAAkB1hE,MAAhC,CAAuCqH,CAAC,EAAxC,CAA2C,CACxC,GAAGpJ,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqB+1D,gBAAxB,CAAyC,CACrCn/D,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqB+1D,gBAArB,CAAwC,GAAIt/C,CAAAA,IAAJ,CAAS7f,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqB+1D,gBAA9B,CAAxC,CACH,CAFD,IAEO,CACHn/D,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqB+1D,gBAArB,CAAwC,GAAIt/C,CAAAA,IAAJ,EAAxC,CACH,CACD;AACA7f,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqBuiB,aAArB,CAAqC,CAArC,CACA3rB,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqBs6D,UAArB,CAAkC,CAAE/3C,aAAa,CAAE,CAAjB,CAAoB7Z,eAAe,CAAE,mBAArC,CAAlC,CACH,CAED;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,CAtCD,CAyCA9R,EAAE,CAACsmE,YAAH,CAAkB,CACdh8D,UAAU,CAAE,YADE,CAEdC,SAAS,CAAE,WAFG,CAGdy0B,KAAK,CAAE,eAHO,CAIdunC,GAAG,CAAE,eAJS,CAKdC,iBAAiB,CAAE,mBALL,CAMdrH,gBAAgB,CAAE,uBANJ,CAOdxzC,aAAa,CAAE,iBAPD,CAAlB,CAWAlrB,MAAM,CAACimE,aAAP,CAAuB,SAASr+D,IAAT,CAAc,CACjC;AACA;AACA;AACA;AACA;AACA;AACA;AAEH,CATD,CAYA5H,MAAM,CAACwlE,YAAP,CAAsB,UAAU,CAC5B;AAGA;AACAjmE,EAAE,CAACyjE,cAAH,CAAoBphE,CAAC,CAACC,IAAF,CAAOtC,EAAE,CAACyjE,cAAV,CAA0B,SAASlhE,CAAT,CAAW,CACjD,MAAOA,CAAAA,CAAC,CAAC4uD,QAAF,EAAc,OAArB,CACP,CAFmB,CAApB,CAKA;AACA;AACA;AAEA;AACA,GAAGnxD,EAAE,CAACmyB,oBAAH,CAAwBhrB,OAAxB,CAAgC,YAAhC,EAAgD,CAAC,CAAjD,EAAsDnH,EAAE,CAACmyB,oBAAH,CAAwBhrB,OAAxB,CAAgC,WAAhC,EAA+C,CAAC,CAAtG,EAA2GnH,EAAE,CAACmyB,oBAAH,CAAwBhrB,OAAxB,CAAgC,OAAhC,EAA2C,CAAC,CAA1J,CAA4J,CACxJ;AAEA,IAAI,GAAIiC,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAACpJ,EAAE,CAACyjE,cAAH,CAAkB1hE,MAAhC,CAAuCqH,CAAC,EAAxC,CAA2C,CACvC,GAAGpJ,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqBs6D,UAAxB,CAAmC,CAC/B,GAAG1jE,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqBs6D,UAArB,CAAgC/3C,aAAnC,CAAiD,CAC7C3rB,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqB,eAArB,EAAwCpJ,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqBs6D,UAArB,CAAgC/3C,aAAxE,CACA,MAAO3rB,CAAAA,EAAE,CAACyjE,cAAH,CAAkBr6D,CAAlB,EAAqBs6D,UAA5B,CACH,CACJ,CACJ,CAED;AACA;AACA;AAEA1jE,EAAE,CAACmyB,oBAAH,CAAwB3vB,IAAxB,CAA6B,eAA7B,EACAxC,EAAE,CAACmyB,oBAAH,CAAwB3vB,IAAxB,CAA6B,kBAA7B,EAEA;AACA,GAAIukE,CAAAA,eAAe,CAAG,EAAtB,CACA,IAAI,GAAI/9D,CAAAA,CAAC,CAAC,CAAV,CAAaA,CAAC,CAAChJ,EAAE,CAACyjE,cAAH,CAAkB1hE,MAAjC,CAAwCiH,CAAC,EAAzC,CAA4C,CACxC,GAAIsG,CAAAA,GAAG,CAAG,CACNrP,IAAI,CAAE,EADA,CAENoP,OAAO,CAAE,CAFH,CAAV,CAIA,IAAI,GAAI9F,CAAAA,CAAC,CAAC,CAAV,CAAaA,CAAC,CAACvJ,EAAE,CAACmyB,oBAAH,CAAwBpwB,MAAvC,CAA8CwH,CAAC,EAA/C,CAAkD,CAC9C,GAAGvJ,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,CAAH,CAA8B,CAC1B;AACA,GAAGvJ,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,GAA8B,YAA9B,EAA8CvJ,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,GAA8B,WAA5E,EAA2FvJ,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,GAA8B,KAAzH,EAAkIvJ,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,GAA8B,OAAnK,CAA2K,CACvK+F,GAAG,CAAC,MAAD,CAAH,CAAYtP,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,CAAZ,EAA0CvJ,EAAE,CAACyjE,cAAH,CAAkBz6D,CAAlB,EAAqBwS,MAAM,CAAC2V,IAAP,CAAYnxB,EAAE,CAACyjE,cAAH,CAAkBz6D,CAAlB,CAAZ,EAAkCO,CAAlC,CAArB,CAA1C,CACH,CAFD,IAEO,CACH,GAAGvJ,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,GAA8B,kBAA9B,EAAoDvJ,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,GAA8B,eAArF,CAAqG,CACjG+F,GAAG,CAACtP,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,CAAD,CAAH,CAAkCvJ,EAAE,CAACyjE,cAAH,CAAkBz6D,CAAlB,EAAqBhJ,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,CAArB,CAAlC,CACH,CAFD,IAEO,CACH+F,GAAG,CAACtP,EAAE,CAACmyB,oBAAH,CAAwB5oB,CAAxB,CAAD,CAAH,CAAkCvJ,EAAE,CAACyjE,cAAH,CAAkBz6D,CAAlB,EAAqBwS,MAAM,CAAC2V,IAAP,CAAYnxB,EAAE,CAACyjE,cAAH,CAAkBz6D,CAAlB,CAAZ,EAAkCO,CAAlC,CAArB,CAAlC,CACH,CACJ,CACD;AACH,CAZD,IAYO,CACH;AACA;AACH,CACJ,CACDw9D,eAAe,CAACvkE,IAAhB,CAAqB8M,GAArB,EACH,CACD;AACA;AACA;AAEA;AACAjP,aAAa,CAAC2mE,UAAd,CAAyBD,eAAzB,EACCrlE,IADD,CACM,SAASC,IAAT,CAAc,CAChB;AACAjB,MAAM,CAACymB,EAAP,CAAU,+BAAV,EACH,CAJD,EAMH,CAzDD,IAyDO,CACH;AACA/lB,YAAY,CAACkD,OAAb,CAAqB,gBAArB,CAAuC,uGAAvC,EACH,CAIJ,CA/ED,CAkFA7D,MAAM,CAACwhC,MAAP,CAAgB,UAAU,CACtB;AACAjiC,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAe7iB,OAAf,CAAyB,CAAzB,CACAhP,aAAa,CAACuE,MAAd,CAAqB5E,EAAE,CAAC6P,IAAH,CAAQqiB,MAA7B,EACKxwB,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AACAjB,MAAM,CAACymB,EAAP,CAAU,+BAAV,EACH,CAJL,EAKH,CARD,CAUA1mB,MAAM,UAAN,CAAgB,UAAU,CACtB;AACAW,YAAY,CAACkD,OAAb,CAAqB,gBAArB,CAAuC,wDAAvC,EACAjE,aAAa,CAACgX,MAAd,CAAqBrX,EAAE,CAAC6P,IAAH,CAAQ6zD,UAA7B,EACKhiE,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AACH,CAHL,EAIH,CAPD,CASAlB,MAAM,CAACyhC,MAAP,CAAgB,UAAU,CACtB;AACAliC,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAe7iB,OAAf,CAAyB,CAAzB,CAEAhP,aAAa,CAACgX,MAAd,CAAqBrX,EAAE,CAAC6P,IAAH,CAAQqiB,MAA7B,EACaxwB,IADb,CACkB,SAASC,IAAT,CAAc,CAChB;AACA;AACAjB,MAAM,CAACymB,EAAP,CAAU,+BAAV,EACH,CALb,EAOA9mB,aAAa,CAAC8nE,gBAAd,CAA+BnoE,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAelwB,EAA9C,CAAkDhC,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAe7iB,OAAjE,CAA0ErP,EAAE,CAAC6P,IAAH,CAAQC,MAAlF,EACKpO,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AACA;AAEH,CALL,EAOI;AAEP,CApBD,CAsBAlB,MAAM,CAAC6nE,gBAAP,CAA0B,SAASz8D,IAAT,CAAc,CACpC;AACA;AACA7L,EAAE,CAACsoE,gBAAH,CAAsBjmE,CAAC,CAACC,IAAF,CAAOtC,EAAE,CAAC6P,IAAH,CAAQswB,OAAf,CAAwB,SAAS59B,CAAT,CAAW,CACrD,MAAOA,CAAAA,CAAC,CAAC4uD,QAAF,EAAc,IAArB,CACH,CAFqB,CAAtB,CAGA;AAEA;AAGA,IAAI,GAAI1tD,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAAGzD,EAAE,CAACsoE,gBAAH,CAAoBvmE,MAApC,CAA4C0B,CAAC,EAA7C,CAAgD,CAE5C,GAAGoI,IAAI,EAAI,SAAX,CAAqB,CACjB7L,EAAE,CAACsoE,gBAAH,CAAoB7kE,CAApB,EAAuB47D,QAAvB,CAAkC,CAAlC,CACH,CAFD,IAEO,CACHr/D,EAAE,CAACsoE,gBAAH,CAAoB7kE,CAApB,EAAuB47D,QAAvB,CAAkC,CAAlC,CACH,CACD;AACAh/D,aAAa,CAACgX,MAAd,CAAqBrX,EAAE,CAACsoE,gBAAH,CAAoB7kE,CAApB,CAArB,EACK/B,IADL,CACU,SAASC,IAAT,CAAc,CAChB;AACA;AACH,CAJL,EAKH,CAEDjB,MAAM,CAACymB,EAAP,CAAU,+BAAV,EAEH,CA5BD,CA8BA1mB,MAAM,CAAC8nE,iBAAP,CAA2B,SAAS74D,IAAT,CAAemY,KAAf,CAAqB,CAC5C7nB,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAevG,aAAf,CAA+Bjc,IAAI,CAACic,aAApC,CACA3rB,EAAE,CAAC6P,IAAH,CAAQqiB,MAAR,CAAepgB,eAAf,CAAiCpC,IAAI,CAACoC,eAAtC,CACH,CAHD,CAKA46B,cAAc,GAEd,QAASA,CAAAA,cAAT,EAA0B,CACvB;AACF,CAGD,GAAI5G,CAAAA,WAAW,CAAG,wGAAlB,CAEArlC,MAAM,CAACoC,IAAP,CAAc,SAAU2iC,SAAV,CAAqB,CAC/B,GAAIC,CAAAA,aAAa,CAAG7kC,SAAS,CAACiC,IAAV,CAAe,CACjC6iC,SAAS,CAAE,IADsB,CAEjCC,WAAW,CAAE,+BAFoB,CAGjCjmC,UAAU,CAAE,mBAHqB,CAIjCkmC,IAAI,CAAE,IAJ2B,CAKjCC,OAAO,CAAE,CACP7jC,EAAE,CAAE,aAAY,CACd,MAAOwjC,CAAAA,SAAP,CACD,CAHM,CAIPlhC,OAAO,CAAE,kBAAU,CACf,MAAOwhC,CAAAA,WAAP,CACH,CANM,CALwB,CAAf,CAApB,CAcAL,aAAa,CAAC7W,MAAd,CAAqBltB,IAArB,CAA0B,SAAU8jC,SAAV,CAAqB,CAC7C3kC,IAAI,CAACkN,IAAL,CAAU,eAAey3B,SAAzB,EACAnlC,aAAa,CAACkX,MAAd,CAAqBiuB,SAArB,EACC9jC,IADD,CACM,UAAU,CACd;AACA;AACC1B,EAAE,CAAC6P,IAAH,CAAQswB,OAAR,CAAkB99B,CAAC,CAACC,IAAF,CAAOtC,EAAE,CAAC6P,IAAH,CAAQswB,OAAf,CAAwB,SAAS59B,CAAT,CAAW,CAClD,MAAOA,CAAAA,CAAC,CAACP,EAAF,EAAQwjC,SAAf,CACH,CAFkB,CAAlB,CAGF,CAPD,EAQD,CAVD,CAUG,UAAY,CACb3kC,IAAI,CAACkN,IAAL,CAAU,uBAAyB,GAAI8R,CAAAA,IAAJ,EAAnC,EACD,CAZD,EAaD,CA5BH,CAiCH,CACJpgB,GAAG,CAACC,UAAJ,CAAe,wBAAf,CAAyCikF,sBAAzC,EAEGA,sBAAsB,CAAC/jF,OAAvB,CAAiC,CAAC,MAAD,CAAS,aAAT,CAAwB,eAAxB,CAAyC,mBAAzC,CAA8D,mBAA9D,CAAmF,gBAAnF,CAAqG,YAArG,CAAmH,WAAnH,CAAgI,QAAhI,CAA0I,QAA1I,CAAoJ,cAApJ,CAAoK,WAApK,CAAiL,MAAjL,CAAyL,SAAzL,CAAoM,UAApM,CAAgN,WAAhN,CAA6N,UAA7N,CAAyO,kBAAzO,CAA6P,gBAA7P,CAA+Q,gBAA/Q,CAAiS,gBAAjS,CAAmT,SAAnT,CAA8T,cAA9T,CAA8U,mBAA9U,CAAmW,gBAAnW,CAAqX,iBAArX,CAAwY,WAAxY,CAAqZ,cAArZ,CAAjC,CACA,QAAS+jF,CAAAA,sBAAT,CAAgCv+E,IAAhC,CAAsCvF,WAAtC,CAAmDQ,aAAnD,CAAkEC,iBAAlE,CAAqFC,iBAArF,CAAwGC,cAAxG,CAAwHV,UAAxH,CAAoIC,SAApI,CAA+IU,MAA/I,CAAuJC,MAAvJ,CAA+JC,YAA/J,CAA6KC,SAA7K,CAAwLC,IAAxL,CAA8LC,OAA9L,CAAuMC,QAAvM,CAAiNgX,SAAjN,CAA4N/W,QAA5N,CAAsOC,gBAAtO,CAAwPC,cAAxP,CAAwQC,cAAxQ,CAAwR6W,cAAxR,CAAwSC,OAAxS,CAAiT9S,YAAjT,CAA+T+S,iBAA/T,CAAkVlG,cAAlV,CAAkWmG,eAAlW,CAAmXK,SAAnX,CAA8XpX,YAA9X,CAA4Y,CAExY,GAAIpB,CAAAA,EAAE,CAAG,IAAT,CAEAA,EAAE,CAACC,IAAH,CAAUH,UAAU,CAACI,OAAX,CAAmBC,WAA7B,CACAH,EAAE,CAAC2E,OAAH,CAAa3E,EAAE,CAACC,IAAH,CAAQ+B,EAArB,CAEAhC,EAAE,CAACkS,YAAH,CAAkB,KAAlB,CAGA;AACAlS,EAAE,CAACqP,OAAH,CAAa,CAAb,CACArP,EAAE,CAACyY,OAAH,CAAa,EAAb,CAEA;AACAzY,EAAE,CAAC0Y,KAAH,CAAW,OAAX,CACA1Y,EAAE,CAAC2Y,KAAH,CAAW,MAAX,CAEA3Y,EAAE,CAAC8Y,cAAH,CAAoB,EAApB,CACA9Y,EAAE,CAAC+Y,iBAAH,CAAuB,KAAvB,CACA;AAEA/Y,EAAE,CAACoQ,OAAH,CAAa,CACT4I,KAAK,CAAE,IADE,CAETC,UAAU,CAAE,EAFH,CAGTC,GAAG,CAAE,CACDlX,EAAE,CAAEhC,EAAE,CAAC2E,OADN,CAHI,CAMToL,KAAK,CAAE,EANE,CAAb,CASA/P,EAAE,CAACyZ,UAAH,CAAgB,8BAAhB,CACA,GAAIC,CAAAA,kBAAJ,CAGA1Z,EAAE,CAACqQ,gBAAH,CAAsB,EAAtB,CAEArQ,EAAE,CAACke,eAAH,CAAqB,IAArB,CAEAle,EAAE,CAAC8Z,gBAAH,CAEA9Z,EAAE,CAACyF,eAAH,CACAzF,EAAE,CAAC0F,iBAAH,CAAuB,CACnB,CAAEC,KAAK,CAAE,gCAAT,CADmB,CAEnB,CAAEA,KAAK,CAAE,mDAAT,CAFmB,CAGnB,CAAEA,KAAK,CAAE,+BAAT,CAHmB,CAInB,CAAEA,KAAK,CAAE,oBAAT,CAJmB,CAAvB,CASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA,GAAIyM,CAAAA,QAAQ,CAAG,oKAAf,CACA,GAAIC,CAAAA,QAAQ,CAAG,uMAAf,CACA,GAAIC,CAAAA,OAAO,CAAI,8KAAf,CACA,GAAIC,CAAAA,QAAQ,CAAG,mTAAf,CAEEvS,EAAE,CAACwS,UAAH,CAAgB,SAASC,WAAT,CAAsBC,aAAtB,CAAoC,CAClDc,OAAO,CAACnN,GAAR,CAAY,wBAAZ,CAAsCoM,WAAtC,EACAe,OAAO,CAACnN,GAAR,CAAY,eAAZ,CAA6BqM,aAA7B,EACF;AACE1S,EAAE,CAACmb,cAAH,CAAkB1I,WAAlB,CAA+BC,aAA/B,EACD,CALD,CAOA1S,EAAE,CAAC4S,eAAH,CAAqB,cAArB,CAEA5S,EAAE,CAAC6S,OAAH,CAAa,CACX,CAAE7Q,EAAE,CAAE,cAAN,CAAsB2D,KAAK,CAAE,cAA7B,CAA6CmN,QAAQ,CAAE,uBAAvD,CAAgFjH,IAAI,CAAE,cAAtF,CAAsGkH,OAAO,CAAE3N,IAAI,CAAC4N,WAAL,CAAiBZ,QAAjB,CAA/G,CAA2Ia,OAAO,CAAE,IAApJ,CADW,CAEX,CAAEjR,EAAE,CAAE,YAAN,CAAsB2D,KAAK,CAAE,YAA7B,CAA6CmN,QAAQ,CAAE,oBAAvD,CAAgFjH,IAAI,CAAE,YAAtF,CAAqGkH,OAAO,CAAE3N,IAAI,CAAC4N,WAAL,CAAiBX,QAAjB,CAA9G,CAA0IY,OAAO,CAAE,IAAnJ,CAFW,CAGX,CAAEjR,EAAE,CAAE,UAAN,CAAsB2D,KAAK,CAAE,UAA7B,CAA6CmN,QAAQ,CAAE,6BAAvD,CAAsFjH,IAAI,CAAE,UAA5F,CAAwGkH,OAAO,CAAE3N,IAAI,CAAC4N,WAAL,CAAiBV,OAAjB,CAAjH,CAA4IW,OAAO,CAAE,IAArJ,CAHW,CAIX,CAAEjR,EAAE,CAAE,cAAN,CAAsB2D,KAAK,CAAE,cAA7B,CAA6CmN,QAAQ,CAAE,eAAvD,CAAiFjH,IAAI,CAAE,cAAvF,CAAuGkH,OAAO,CAAE3N,IAAI,CAAC4N,WAAL,CAAiBT,QAAjB,CAAhH,CAA4IU,OAAO,CAAE,IAArJ,CAJW,CAAb,CAOCjT,EAAE,CAACkT,UAAH,CAAgB,EAAhB,CAGD;AACA;AAGA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEE;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAUA;AACA;AACA;AACA;AACA;AACA;AAGA;AAOJlT,EAAE,CAACke,eAAH,CAAqB,KAArB,CACAle,EAAE,CAACme,oBAAH,CAA0B,UAAU,CAEhC,GAAGne,EAAE,CAACsoB,qBAAN,CAA4B,CACxBlnB,YAAY,CAACyD,KAAb,CAAmB,aAAnB,CAAkC,oGAAlC,EACA,MAAO,MAAP,CACH,CAED,GAAI++E,CAAAA,QAAQ,CAAG,CAACv0E,OAAO,CAAErP,EAAE,CAACoQ,OAAH,CAAWf,OAArB,CACX1K,OAAO,CAAE3E,EAAE,CAACoQ,OAAH,CAAWzL,OADT,CAAf,CAGI;AACJ;AACAtE,aAAa,CAACiU,UAAd,CAAyBtU,EAAE,CAACoQ,OAAH,CAAWzL,OAApC,CAA6C3E,EAAE,CAACoQ,OAAH,CAAWf,OAAxD,EACS3N,IADT,CACc,SAAUC,IAAV,CAAgB,CACd;AAEA,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CACZ/D,EAAE,CAAC+N,IAAH,CAAUpM,IAAI,CAACoM,IAAf,CAGA/N,EAAE,CAACkT,UAAH,CAAgBvR,IAAI,CAAC4S,KAArB,CAEA,GAAGvU,EAAE,CAACkT,UAAH,CAAcnR,MAAd,CAAuB,CAA1B,CAA4B,CACxB/B,EAAE,CAAC6S,OAAH,CAAW,CAAX,EAAcI,OAAd,CAAwB,IAAxB,CACH,CAFD,IAEO,CACHjT,EAAE,CAAC6S,OAAH,CAAW,CAAX,EAAcI,OAAd,CAAwB,KAAxB,CACH,CAEDjT,EAAE,CAACwU,OAAH,CAAa7S,IAAI,CAAC6S,OAAlB,CACA,GAAGxU,EAAE,CAACwU,OAAH,CAAWzQ,OAAd,CAAsB,CAClB/D,EAAE,CAAC6S,OAAH,CAAW,CAAX,EAAcI,OAAd,CAAwB,IAAxB,CACH,CAFD,IAEO,CACHjT,EAAE,CAAC6S,OAAH,CAAW,CAAX,EAAcI,OAAd,CAAwB,KAAxB,CACH,CACJ,CAEJ,CAxBb,EA6BAjT,EAAE,CAACke,eAAH,CAAqB,IAArB,CACH,CA1CD,CA6CAzd,MAAM,CAAC6Z,aAAP,CAAuB,SAASjS,IAAT,CAAc,CAEjC,GAAGA,IAAI,CAACtG,MAAL,CAAc,CAAd,EAAmBsG,IAAI,CAACtG,MAAL,CAAc,CAApC,CAAsC,CAEjCiW,cAAc,CAACuC,kBAAf,CAAkClS,IAAlC,EACA3G,IADA,CACK,SAAUC,IAAV,CAAgB,CAClB;AACA,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CACZ;AACA/D,EAAE,CAACwa,SAAH,CAAe7Y,IAAI,CAAC6Y,SAApB,CAEC,GAAGxa,EAAE,CAACwa,SAAH,CAAazY,MAAb,EAAuB,CAA1B,CAA4B,CACzB;AACG/B,EAAE,CAACwa,SAAH,CAAe,CACV,CACIxY,EAAE,CAAC,CADP,CAEI2D,KAAK,CAAE,gBAAiB0C,IAF5B,CAGI6B,IAAI,CAAE,MAHV,CAIIwO,KAAK,CAAE,GAJX,CAKIC,KAAK,CAAE,GALX,CADU,CAAf,CAQN,CAEJ,CAhBD,IAgBO,CAGH;AACA;AACH,CAEJ,CA1BA,EA6BJ,CAED,GAAGtQ,IAAI,CAACtG,MAAL,CAAc,CAAjB,CAAmB,CACf,GAAImI,CAAAA,IAAI,CAAG7B,IAAI,CAAC2B,OAAL,CAAa,KAAb,CAAoB,GAApB,CAAX,CACAgO,cAAc,CAACyC,YAAf,CAA4BvQ,IAA5B,EACCxI,IADD,CACM,SAAUC,IAAV,CAAgB,CAClB;AACA,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CACZ;AACA/D,EAAE,CAACwa,SAAH,CAAe7Y,IAAI,CAAC6Y,SAApB,CAGA,GAAGxa,EAAE,CAACwa,SAAH,CAAazY,MAAb,EAAuB,CAA1B,CAA4B,CACxB;AACG/B,EAAE,CAACwa,SAAH,CAAe,CACV,CACIxY,EAAE,CAAC,CADP,CAEI2D,KAAK,CAAE,gBAAiB0C,IAF5B,CAGI6B,IAAI,CAAE,MAHV,CAIIwO,KAAK,CAAE,GAJX,CAKIC,KAAK,CAAE,GALX,CADU,CAAf,CAQN,CAEJ,CAjBD,IAiBO,CACH;AACA;AACH,CAEJ,CAzBD,EA2BH,CACJ,CAjED,CAoEAlY,MAAM,CAACid,UAAP,CAAoB,UAAU,CAC1B;AACA;AACA;AAEA,GAAG1d,EAAE,CAACoQ,OAAH,CAAW8I,GAAX,CAAevU,OAAf,EAA0B3E,EAAE,CAACC,IAAH,CAAQ+B,EAAlC,EAAwChC,EAAE,CAACoQ,OAAH,CAAWpD,aAAX,CAA2B,CAAtE,CAAwE,CACpE;AACA;AAEH,CAJD,IAIO,IAAGhN,EAAE,CAACoQ,OAAH,CAAWpD,aAAX,CAA2B,CAA3B,EAAgChN,EAAE,CAACoQ,OAAH,CAAW8I,GAAX,CAAevU,OAAf,EAA0B3E,EAAE,CAACoQ,OAAH,CAAWpD,aAAxE,CAAuF,CAC1F;AACA;AAEH,CAJM,IAIA,CACH;AACA;AAEH,CACJ,CAlBD,CAqBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAIA,OAAOtM,MAAM,CAACqmB,OAAP,CAAeplB,IAAf,CAAoBqlB,MAA3B,EACI,IAAK,KAAL,CAEI;AACA;AACA;AACA;AAEA9lB,cAAc,CAACmmC,aAAf,CAA6BrnC,EAAE,CAACC,IAAH,CAAQ+B,EAArC,CAAyCrB,YAAY,CAACqB,EAAtD,EACEN,IADF,CACO,SAAUC,IAAV,CAAgB,CACnB;AACA,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CACZ;AAGA,GAAGpC,IAAI,CAAC8W,OAAL,CAAaorE,QAAb,EAAyB,CAA5B,CAA8B,CAC1BziF,YAAY,CAACkD,OAAb,CAAqB,kBAArB,CAAyC,4DAAzC,EACA5D,MAAM,CAACymB,EAAP,CAAU,sBAAV,CAAkC,EAAlC,CAAsC,CAAEC,MAAM,CAAE,IAAV,CAAtC,EACH,CAEDpnB,EAAE,CAACoQ,OAAH,CAAazO,IAAI,CAAC8W,OAAlB,CAEA;AACAzY,EAAE,CAACoQ,OAAH,CAAW6T,UAAX,CAAwB,GAAIpE,CAAAA,IAAJ,CAAS,YAAT,CAAxB,CACA7f,EAAE,CAACoQ,OAAH,CAAWiU,QAAX,CAAsB,GAAIxE,CAAAA,IAAJ,CAAS,YAAT,CAAtB,CAEAxf,aAAa,CAACyjF,YAAd,CAA2BniF,IAAI,CAAC8W,OAAL,CAAapJ,OAAxC,CAAiDrP,EAAE,CAACC,IAAH,CAAQ+B,EAAzD,EACKN,IADL,CACU,SAAU2X,IAAV,CAAgB,CACdrZ,EAAE,CAACqZ,IAAH,CAAUA,IAAV,CACAiG,yBAAyB,CAAC3d,IAAI,CAAC8W,OAAN,CAAzB,CACP,CAJL,EAQH,CACJ,CA3BD,EA8BJ,MACA,IAAK,MAAL,CAMA,MACA,IAAK,MAAL,CAKA,MACA,QACI;AACJ,MAtDJ,CA0DAzY,EAAE,CAAC6a,4BAAH,CAAkC,UAAU,CAExC;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AAGA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AAOA;AAEA7a,EAAE,CAAC6qB,cAAH,CAAoB7qB,EAAE,CAAC8qB,cAAvB,CAEA9qB,EAAE,CAACud,aAAH,CAAmB,CACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAvS,KAAK,CAAE,CApBQ,CAAnB,CAuBA;AAEH,CAnHD,CAqHAhL,EAAE,CAACsZ,kBAAH,CAAwB,EAAxB,CAGA;AACA;AACA;AACAtZ,EAAE,CAACke,eAAH,CAAqB,IAArB,CAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAOA;AACAle,EAAE,CAACmb,cAAH,CAAoB,UAAuC,IAA9BhI,CAAAA,MAA8B,2DAAvB,EAAuB,IAAnBT,CAAAA,aAAmB,2DAAL,IAAK,CAEvD,GAAIpD,CAAAA,GAAG,CAAG,CACN;AACA3K,OAAO,CAAE3E,EAAE,CAACoQ,OAAH,CAAWzL,OAFd,CAGN0K,OAAO,CAAErP,EAAE,CAACoQ,OAAH,CAAWf,OAHd,CAINxJ,QAAQ,CAAE7F,EAAE,CAACoQ,OAAH,CAAWvK,QAJf,CAKN4X,UAAU,CAAEzd,EAAE,CAACoQ,OAAH,CAAWqN,UALjB,CAMNmQ,UAAU,CAAE5tB,EAAE,CAACke,eANT,CAONsK,WAAW,CAAGxoB,EAAE,CAAC6qB,cAAH,EAAqB,CAAtB,CAA2B,IAA3B,CAAkC,KAPzC,CAAV,CAUA;AACA;AACA,GAAG1X,MAAM,EAAI,UAAb,CAAwB,CACpB7D,GAAG,CAACoD,aAAJ,CAAoBA,aAApB,CACApD,GAAG,CAAC6D,MAAJ,CAAaA,MAAb,CACH,CAHD,IAGO,IAAGA,MAAM,EAAI,YAAb,CAA0B,CAC7B7D,GAAG,CAACoD,aAAJ,CAAoBA,aAApB,CACApD,GAAG,CAAC6D,MAAJ,CAAaA,MAAb,CACH,CAHM,IAGA,IAAGA,MAAM,EAAI,cAAb,CAA4B,CAC/B;AACA7D,GAAG,CAAC6D,MAAJ,CAAaA,MAAb,CACH,CAHM,IAGA,IAAGA,MAAM,EAAI,cAAb,CAA4B,CAC/B;AACA7D,GAAG,CAACoD,aAAJ,CAAoBA,aAApB,CACApD,GAAG,CAAC6D,MAAJ,CAAaA,MAAb,CACH,CAED;AACA;AACA6E,cAAc,CAAC+rE,UAAf,CAA0B/jF,EAAE,CAACoQ,OAAH,CAAWpO,EAArC,CAAyCsN,GAAzC,EACC5N,IADD,CACM,SAASC,IAAT,CAAc,CAChB;AACA,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CACR/D,EAAE,CAACkS,YAAH,CAAkB,KAAlB,CACAxR,MAAM,CAACymB,EAAP,CAAU,sBAAV,CAAkC,EAAlC,CAAsC,CAAEC,MAAM,CAAE,IAAV,CAAtC,EACP,CAHD,IAGO,CACHhmB,YAAY,CAACyD,KAAb,CAAmB,OAAnB,CAA4B,sBAAwBlD,IAAI,CAACmD,OAAzD,EACA9E,EAAE,CAACkS,YAAH,CAAkB,KAAlB,CACA;AACH,CACJ,CAXD,EAaH,CA5CD,CAiDAlS,EAAE,CAAC0sB,gBAAH,CAMA,QAASpN,CAAAA,yBAAT,CAAmC7G,OAAnC,CAA2C,CAGvC;AACAzY,EAAE,CAACoQ,OAAH,CAAWqN,UAAX,CAAwBhF,OAAO,CAACzW,EAAhC,CACAhC,EAAE,CAACoQ,OAAH,CAAWf,OAAX,CAAqBoJ,OAAO,CAACpJ,OAA7B,CACArP,EAAE,CAACoQ,OAAH,CAAWzL,OAAX,CAAqB8T,OAAO,CAAC9T,OAA7B,CACA3E,EAAE,CAACoQ,OAAH,CAAWL,KAAX,CAAmB0I,OAAO,CAAC1I,KAA3B,CACA/P,EAAE,CAACqP,OAAH,CAAaoJ,OAAO,CAACpJ,OAArB,CACA;AACA;AAGE,GAAG,CAAErP,EAAE,CAACC,IAAH,CAAQ8wB,MAAR,CAAe9S,UAAf,CAA0B9W,OAA1B,CAAkCnH,EAAE,CAACqP,OAArC,EAAgD,CAAC,CAAlD,EAAyDrP,EAAE,CAACC,IAAH,CAAQ8wB,MAAR,CAAeC,OAAf,CAAuB7pB,OAAvB,CAA+BnH,EAAE,CAACqP,OAAlC,EAA6C,CAAC,CAAxG,GAAgHrP,EAAE,CAACoQ,OAAH,CAAWzL,OAAX,GAAuB3E,EAAE,CAACC,IAAH,CAAQ+B,EAAlJ,CAAqJ,CACnJ;AACAhC,EAAE,CAACwZ,aAAH,CAAmB,IAAnB,CAEH,CAGDxZ,EAAE,CAACuT,QAAH,CAAc,EAAd,CACAvT,EAAE,CAAC8qB,cAAH,CAAoB,CAApB,CACA3S,eAAe,CAAC+Y,eAAhB,CAAgCzY,OAAO,CAACzW,EAAxC,EACCN,IADD,CACM,SAAUC,IAAV,CAAgB,CACd;AAEA,GAAGA,IAAI,CAACoC,OAAR,CAAgB,CACZ;AACA/D,EAAE,CAAC8Z,gBAAH,CAAsBnY,IAAI,CAACwS,OAA3B,CAEA,IAAI,GAAIumC,CAAAA,EAAR,GAAc/4C,CAAAA,IAAI,CAAC4R,QAAnB,CAA4B,CAExB,IAAK,GAAI8d,CAAAA,GAAT,GAAgB1vB,CAAAA,IAAI,CAAC4R,QAAL,CAAcmnC,EAAd,EAAkBtpB,OAAlC,CAA2C,CACvC;AAEA,GAAGzvB,IAAI,CAAC4R,QAAL,CAAcmnC,EAAd,GAAqB/4C,IAAI,CAAC4R,QAAL,CAAcmnC,EAAd,EAAkBxyC,MAAvC,EAAiDvG,IAAI,CAAC4R,QAAL,CAAcmnC,EAAd,EAAkBxyC,MAAlB,CAAyB2B,WAAzB,KAA2C,MAA/F,CAAsG,CACnG7J,EAAE,CAACuT,QAAH,CAAY/Q,IAAZ,CAAiBb,IAAI,CAAC4R,QAAL,CAAcmnC,EAAd,EAAkBtpB,OAAlB,CAA0BC,GAA1B,CAAjB,EACCrxB,EAAE,CAAC8qB,cAAH,CAAqBF,MAAM,CAACzV,UAAP,CAAkBnV,EAAE,CAAC8qB,cAArB,EAAuCF,MAAM,CAACzV,UAAP,CAAkBxT,IAAI,CAAC4R,QAAL,CAAcmnC,EAAd,EAAkBtpB,OAAlB,CAA0BC,GAA1B,EAA+B,OAA/B,CAAlB,CAA5D,CACH,CAGD;AACA;AACA;AACH,CAEJ,CAID;AACA;AAEA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAEArxB,EAAE,CAACme,oBAAH,GACAne,EAAE,CAAC6qB,cAAH,CAAoB7qB,EAAE,CAAC8qB,cAAvB,CAEA;AACA9qB,EAAE,CAACqU,IAAH,CAAU,CACNhF,OAAO,CAAErP,EAAE,CAACoQ,OAAH,CAAWf,OADd,CAEN1K,OAAO,CAAE3E,EAAE,CAACC,IAAH,CAAQ+B,EAFX,CAGNyb,UAAU,CAAEhF,OAAO,CAACzW,EAHd,CAAV,CAMA;AACxB;AACA;AACA;AACA;AACA;AACA,0BAEwBhC,EAAE,CAACgkF,aAAH,CAAmB,IAAnB,CAEA;AACA;AAEA,GAAGhkF,EAAE,CAAC8qB,cAAH,EAAqB,CAArB,EAA0B9qB,EAAE,CAACuT,QAAH,CAAYxR,MAAZ,EAAsB,CAAnD,CAAqD,CAEjDX,YAAY,CAACkD,OAAb,CAAqB,kBAArB,CAAyC,yDAAzC,EACA5D,MAAM,CAACymB,EAAP,CAAU,sBAAV,CAAkC,EAAlC,CAAsC,CAAEC,MAAM,CAAE,IAAV,CAAtC,EAEH,CAMD;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GArJoC,CA6JpB;AAEQ;AACA;AACA;AACH,CAlKD,IAkKO,CACH;AACH,CAGJ,CA3KL,EA+KA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAIA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAIA;AACA;AAEA;AAEA;AAKC;AAID;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAIA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AAGH,CAGG;AAGA3mB,MAAM,CAACmC,KAAP,CAAe,EAAf,CAEAnC,MAAM,CAACoC,IAAP,CAAc,SAASb,EAAT,CAAac,MAAb,CAAqB,CAC/B;AACA;AACA,GAAGrC,MAAM,CAACmC,KAAP,CAAaZ,EAAb,GAAoBvB,MAAM,CAACmC,KAAP,CAAaZ,EAAb,EAAiBe,MAAjB,EAA2B,IAAlD,CAAuD,CACnDD,MAAM,CAACE,cAAP,GACAF,MAAM,CAACG,eAAP,GACH,CAHD,IAGO,CACHxC,MAAM,CAACmC,KAAP,CAAaZ,EAAb,EAAmB,CAACe,MAAM,CAAE,IAAT,CAAnB,CACH,CACJ,CATD,CAWAtC,MAAM,CAACyC,OAAP,CAAiB,CAAC,YAAD,CAAe,YAAf,CAA6B,YAA7B,CAA2C,WAA3C,CAAjB,CACAzC,MAAM,CAAC0C,MAAP,CAAgB1C,MAAM,CAACyC,OAAP,CAAe,CAAf,CAAhB,CAEAzC,MAAM,CAAC2C,iBAAP,CAA2B,CACCD,MAAM,CAAE,YADT,CAECE,SAAS,C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BC,UAAU,CAAE,EALK,CAMjBC,UAAU,CAAE,EANK,CAArB,CAaA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAGA;AACA;AACA;AAGA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAIA;AAEA;AACA;AACA;AAEAtzF,EAAE,CAACuzF,kBAAH,CAAwB,EAAxB,CAGA9yF,MAAM,CAACsyF,cAAP,CAAwB,SAASxkD,OAAT,CAAiB,CAErCvuC,EAAE,CAACuzF,kBAAH,CAAwBhlD,OAAxB,CAEAv8B,cAAc,CAACwhF,cAAf,CAA8BjlD,OAA9B,EACK7sC,IADL,CACU,SAAUC,IAAV,CAAgB,CAClB,GAAGA,IAAH,CAAQ,CAEJ;AACA3B,EAAE,CAACgzF,eAAH,CAAqBrxF,IAAI,CAAC8xF,cAA1B,CACA;AACAzzF,EAAE,CAAC+yF,cAAH,CAAoB,IAApB,CAEH,CAPD,IAOO,CACH;AACA;AAEH,CACJ,CAdL,EAgBA;AAIH,CAxBD,CA2BAtyF,MAAM,CAACizF,YAAP,CAAsB,UAAU,CAC5B;AAEA;AAGA;AACC1hF,cAAc,CAAC2hF,UAAf,CAA0B3zF,EAAE,CAACuzF,kBAA7B,CAAiDvzF,EAAE,CAACgzF,eAApD,EACItxF,IADJ,CACS,SAAUC,IAAV,CAAgB,CAClB,GAAGA,IAAH,CAAQ,CAEJ;AACA3B,EAAE,CAACgzF,eAAH,CAAqB,CACjBC,UAAU,CAA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AQ,CAACg2B,cAAT,CAAwB,SAAS7vB,MAAM,CAAG,CAAlB,CAAxB,EAA+CyrC,KAA3D,CACA,GAAGvU,KAAK,CAAG,CAAC,CAAT,EAAcA,KAAK,CAAG,EAAtB,EAA4BA,KAAK,GAAK,EAAzC,CAA4C,CAC3Cr9B,QAAQ,CAACg2B,cAAT,CAAwB,QAAQ7vB,MAAhC,EAAwCrQ,KAAxC,GACA,CAFD,IAEO,CACNkK,QAAQ,CAACg2B,cAAT,CAAwB,SAAS7vB,MAAM,CAAG,CAAlB,CAAxB,EAA+CyrC,KAA/C,CAAuD,EAAvD,CACA5xC,QAAQ,CAACg2B,cAAT,CAAwB,SAAS7vB,MAAM,CAAG,CAAlB,CAAxB,EAA8CrQ,KAA9C,GACA,MAAO,MAAP,CACA,CAEF,CAlIA,CA0IC;AACA;AAEA;AAEA;AACA;AACA;AACA;AAYH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAMA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAGA;AAGA;AACA;AAGA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEE,CAQJ5E,GAAG,CAACC,UAAJ,CAAe,yBAAf,CAA0Ci3F,uBAA1C,EAEGA,uBAAuB,CAAC/2F,OAAxB,CAAkC,CAAC,aAAD,CAAgB,YAAhB,CAA8B,WAA9B,CAA2C,QAA3C,CAAqD,QAArD,CAA+D,cAA/D,CAA+E,WAA/E,CAA4F,MAA5F,CAAoG,SAApG,CAA+G,aAA/G,CAA+H,gBAA/H,CAAiJ,gBAAjJ,CAAmK,oBAAnK,CAAyL,uBAAzL,CAAkN,cAAlN,CAAlC,CACA,QAAS+2F,CAAAA,uBAAT,CAAiC92F,WAAjC,CAA8CC,UAA9C,CAA0DC,SAA1D,CAAqEU,MAArE,CAA6EC,MAA7E,CAAqFC,YAArF,CAAmGC,SAAnG,CAA8GC,IAA9G,CAAoHC,OAApH,CAA6HitC,WAA7H,CAA2I5sC,cAA3I,CAA2JkzC,cAA3J,CAA2KC,kBAA3K,CAA+L/N,qBAA/L,CAAsNnlC,YAAtN,CAAoO,CAChO,GAAIpB,CAAAA,EAAE,CAAG,IAAT,CAGAA,EAAE,CAACitF,UAAH,CAAgB,KAAhB,CACAjtF,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","sourcesContent":["/*! ToAviate - v4.0.1 - 2026-02-13 */ app.controller('AccountController', AccountController);\n\n    AccountController.$inject = ['UserService', '$rootScope', '$location'];\n    function AccountController(UserService, $rootScope, $location) {\n        var vm = this;\n        //not much happening here...\n        vm.user = $rootScope.globals.currentUser;\n\n        // UserService.GetById($rootScope.globals.currentUser.id)\n        //         .then(function (data) {\n        //             vm.user = data.user;\n        //         });\n\n    }\n app.controller('AddLicenceController', AddLicenceController);\n\n    AddLicenceController.$inject = ['UserService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'BookingService', 'LicenceService', 'ToastService'];\n    function AddLicenceController(UserService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, BookingService, LicenceService, ToastService) {\n        \n        var vm = this;\n        vm.licence_images = [];\n        vm.licence = {\n                images: [],\n                ratings: []\n        };\n        //vm.user_id = 59;\n\n        // //console.log(\"THIS GETS CALLED ALEX\");\n\n        LicenceService.GetLicenceTypes()\n                .then(function (data) {\n                    vm.licence_types = data;\n                    // //console.log(\"licence_types: \", vm.licence_types);\n                });\n\n        LicenceService.GetRatings()\n            .then(function (data) {\n                vm.ratings = data;\n                // //console.log(\"ratings: \", vm.ratings);\n                    // //console.log(\"THIS GETS EXECUTED\");\n                    //got to set this as we're only adding here\n                    for(var i=0;i<vm.ratings.length; i++){\n                        // //console.log(\"LOOP\", vm.ratings[i]);\n                        if(vm.ratings[i].id == 7){\n                            vm.selected_rating = vm.ratings[i];\n                            // //console.log(\"FOUND\", vm.selected_rating);\n                            $scope.add_rating();\n                            break;\n                        }\n                    }\n            });\n\n        LicenceService.GetAuthority()\n            .then(function (data) {\n                vm.authority = data;\n                // //console.log(\"authority: \", vm.authority);\n            });\n\n\n\n\n            $scope.add_rating = function(){\n\n                //remove from first array\n                vm.ratings = $.grep(vm.ratings, function(e){ \n                    return e.id != vm.selected_rating.id; \n                });\n\n                vm.licence.ratings.push(vm.selected_rating);\n\n                //clear selected\n                delete vm.selected_rating;\n                \n                //clean the array to show what we want to show :)\n                //delete $scope.formData.license.add_to[bit_type];\n\n            }\n\n            $scope.remove_rating = function(index){\n\n                //add to dropdown\n                vm.ratings.push(vm.licence.ratings[index]);\n                vm.licence.ratings.splice(index,1)\n\n            }\n\n\n            $scope.popup = [];\n\n            $scope.open = function(id, $event) {\n                // //console.log(\"THIS\", id);\n                //this comment would allow the event not to be affect by clicking it again... not sure this is a good idea\n                if($scope.popup[id] && $scope.popup[id].opened == true){\n                    $event.preventDefault();\n                    $event.stopPropagation();\n                } else {\n                    $scope.popup[id] = {opened: true};\n                }\n            };\n\n            $scope.formats = ['dd/MM/yyyy', 'yyyy/MM/dd', 'dd.MM.yyyy', 'shortDate'];\n            $scope.format = $scope.formats[0];\n\n            $scope.datePickerOptions = {\n                                        format: 'dd/MM/yyyy',\n                                        showWeeks: false\n                                    };\n\n           \n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            // //console.log(\"REMOVE: \", j);\n            // //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            LicenceService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    // //console.log(data);\n                    if(data.success){\n                        // //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.licence_images = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        // //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n            $scope.processFiles = function(files){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    files[i].file.temp_path = j.saved_url;\n                    // //console.log(\"file\", files[i].file);\n                    vm.licence_images.push(files[i].file);\n                }\n               \n            }\n\n\n\n\n\n\n\n\n            $scope.save_licence = function(isValid){\n\n                if(vm.licence_images.length < 1 && vm.licence.images.length < 1){\n\n                    $(\".drop\").focus();\n                    ToastService.warning('Image Required', 'You must at least have 1 image of your licence!');\n\n                    return false;   \n                }\n\n\n                if(!vm.licence.licence_type){\n                    $(\"#licence_type\").focus();\n                    ToastService.warning('Licence Type Required', 'You must select a licence type');\n\n                    return false;\n                }\n\n\n                if(!vm.licence.state_of_issue){\n                    $(\"#state_of_issue\").focus();\n                    ToastService.warning('State Required', 'You must select a licence state of issue');\n\n                    return false;\n                }\n\n\n                if(vm.licence.ratings.length < 1){\n\n                    $(\"#ratings\").focus();\n                    ToastService.warning('Rating Required', 'You must at least have 1 rating!');\n                    \n                    return false;   \n                }\n\n                // //console.log(\"FLOW: \", vm.licence_images);\n\n\n\n                //compile the required elements YAY\n\n                // //console.log(\"LICENCE GOOD TO GO \", vm.licence);\n\n                if(vm.licence.id){\n                    //then its an udpate\n\n                    //merge the images left?\n\n\n                } else {\n\n\n                    //clean shizzle before sending\n                    vm.licence.images = vm.licence_images;\n                    vm.licence.licence_id = vm.licence.licence_type.id;\n                    vm.licence.authority_id = vm.licence.state_of_issue.id;\n                    vm.licence.user_id = vm.user_id;\n\n                    delete vm.licence.licence_type;\n                    delete vm.licence.state_of_issue;\n\n\n                    //then its a create\n                    // //console.log(vm.licence);\n\n                    LicenceService.Create(vm.licence)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                // //console.log(\"HUZZAH\", vm.licence);\n                                // //console.log(\"HUZZAH\", data);\n                                //then we need to remove this from the list of files...\n                                \n                                \n                                //move somewhere?\n\n\n\n\n\n                            } else {\n\n                                ToastService.error('Create Failed', 'Something went terribly wrong: ' + data.message);\n\n                            }\n\n                        });\n\n\n                }\n\n\n\n            };\n\n\n        \n        \n\n\n    }\n app.controller('AircraftJourneyLogsController', AircraftJourneyLogsController);\n\n    AircraftJourneyLogsController.$inject = ['UserService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'BookingService', 'LicenceService', 'ClubDocumentService', 'PlaneDocumentService', '$http', 'PlaneService', '$sce', 'ToastService'];\n    function AircraftJourneyLogsController(UserService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, BookingService, LicenceService, ClubDocumentService, PlaneDocumentService, $http, PlaneService, $sce, ToastService) {\n        \n        var vm = this;\n\n        vm.clubs = [];\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n\n        vm.looking_for = $stateParams.registration;\n        if(vm.looking_for){\n            $scope.my_search2 = vm.looking_for;\n        }\n\n\n        vm.defect_severity;\n        vm.defect_severities = [\n            { title: \"No Fly Item - Ground the plane\"},\n            { title: \"Flyable - needs to be checked at next maintenance\"},\n            { title: \"Not urgent - but needs noting\"},\n            { title: \"Unsure of severity\"}\n        ]; \n\n\n        // //console.log(\"MAIN PLANE id: \", $stateParams.plane_id);\n\n\n        ////console.log(\"REG: \"+$stateParams.registration);\n\n\n         PlaneService.GetAircraftJourneyLogs($stateParams.plane_id, 0, 25)\n            .then(function (data) {\n                    // //console.log(\"ALL is : \", data);\n                   vm.logs = data.logs;\n                   vm.aircraft = data.aircraft;\n\n\n                });\n\n            vm.current_offset = 0;\n            vm.loaded_per_batch = 25;\n            vm.all_loaded = false;\n\n            vm.load_more = function(){\n                vm.current_offset = vm.current_offset + vm.loaded_per_batch;\n                PlaneService.GetAircraftJourneyLogs($stateParams.plane_id, vm.current_offset, vm.loaded_per_batch)\n                .then(function (data) {\n                        // //console.log(\"ALL is : \", data);\n                        if(data.logs.length > 0){\n                            data.logs.forEach(log => vm.logs.push(log));\n                        } else {\n                            vm.all_loaded = true;\n                        }\n                       //vm.logs = data.logs;\n\n\n                    });\n\n            }\n\n\n\n            vm.get_initial = function(text){\n                return (!!text) ? text.charAt(0) : '';\n            }\n\n\n            vm.clean_times = function(time){\n                if(time == \"00:00:00\"){\n                    return \" - \";\n                }\n                return time.substring(0,5);\n            }\n\n            vm.round_brake_times = function(first, second, start_end){\n                if(start_end == 0){\n                    //first = brakes_off\n                    //second = takeoff\n                    if(second < first){\n                        \n                    }\n\n                } else {\n                    //first = landing\n                    //second = takeoff\n\n                }\n            }\n\n\n            vm.round_brake_times_end = function(input, earlier_input=null){\n            \n                if(input){\n                  if(input.indexOf(\":\") > -1){\n                    var split = input.split(\":\");\n                    var x = split[1];\n\n\n\n                    var min_nearest_five = ((x % 5) >= 2.5 ? parseInt(x / 5) * 5 + 5 : parseInt(x / 5) * 5);\n                    \n\n\n                    if(min_nearest_five < 10){\n                      min_nearest_five = \"0\"+min_nearest_five;\n                    } else if(min_nearest_five == 60){\n                      split[0]++;\n                      min_nearest_five = \"00\";\n                    } else if(min_nearest_five > 60){\n                      split[0]++;\n                      min_nearest_five = (min_nearest_five - 60);\n                    }\n\n\n                    if(earlier_input && earlier_input.indexOf(\":\") > -1){\n                            // console.log(\"total calculated?\");\n                            // console.log(\"earlier_input: \", earlier_input);\n                            // console.log(\"input: \", input);\n                            var esplit = earlier_input.split(\":\");\n                            var ehour = esplit[0];\n                            var emin = esplit[1];\n                            var etot = (parseInt(ehour)*60) + parseInt(emin); \n                            // console.log(\"etot: \", etot);\n                            var hr = split[0];\n                            var mn = min_nearest_five;\n                            var tot = (parseInt(hr)*60) + parseInt(mn);\n                            // console.log(\"tot: \", tot);\n\n                            if(etot > tot){\n                                //the earlier time is after the end time\n                                // console.log(\"etot > tot\");\n                                min_nearest_five = parseInt(min_nearest_five) + 5;\n                                if(min_nearest_five == 60){\n                                    split[0]++; \n                                    min_nearest_five = \"00\";\n                                } else if(min_nearest_five > 60){\n                                    split[0]++;\n                                    min_nearest_five = (min_nearest_five - 60);\n                                    if(min_nearest_five < 10 ){\n                                      min_nearest_five = \"0\"+min_nearest_five;\n                                    }\n                                }\n                                // console.log(\"split: \", split[0]);\n                                // console.log(\"min_nearest_five: \", min_nearest_five);\n                            }\n\n                    }\n                    //essentially we add 5 in case something happens over the limit\n\n                    return split[0] + \":\" + min_nearest_five;\n                  } else {\n                    return input;\n                  }\n                } else {\n                  return '';\n                }\n          \n\n          }\n\n\n\n\n          vm.round_brake_times_start = function(input, earlier_input=null){\n            \n                if(input){\n                  if(input.indexOf(\":\") > -1){\n                    var split = input.split(\":\");\n                    var x = split[1];\n\n\n\n                    var min_nearest_five = ((x % 5) >= 2.5 ? parseInt(x / 5) * 5 + 5 : parseInt(x / 5) * 5);\n                    \n\n\n                    if(min_nearest_five < 10){\n                      min_nearest_five = \"0\"+min_nearest_five;\n                    } else if(min_nearest_five == 60){\n                      split[0]++;\n                      min_nearest_five = \"00\";\n                    } else if(min_nearest_five > 60){\n                      split[0]++;\n                      min_nearest_five = (min_nearest_five - 60);\n                    }\n\n\n                    if(earlier_input && earlier_input.indexOf(\":\") > -1){\n                            // console.log(\"total calculated?\");\n                            // console.log(\"earlier_input: \", earlier_input);\n                            // console.log(\"input: \", input);\n                            var esplit = earlier_input.split(\":\");\n                            var ehour = esplit[0];\n                            var emin = esplit[1];\n                            var etot = (parseInt(ehour)*60) + parseInt(emin); \n                            // console.log(\"etot: \", etot);\n                            var hr = split[0];\n                            var mn = min_nearest_five;\n                            var tot = (parseInt(hr)*60) + parseInt(mn);\n                            // console.log(\"tot: \", tot);\n\n                            if(etot < tot){\n                                //the earlier time is after the end time\n                                // console.log(\"etot < tot\");\n                                min_nearest_five = parseInt(min_nearest_five) - 5;\n                                if(min_nearest_five == 60){\n                                    split[0]++; \n                                    min_nearest_five = \"00\";\n                                } else if(min_nearest_five > 60){\n                                    split[0]++;\n                                    min_nearest_five = (min_nearest_five - 60);\n                                    if(min_nearest_five < 10 ){\n                                      min_nearest_five = \"0\"+min_nearest_five;\n                                    }\n                                } else if(min_nearest_five < 0){\n                                    split[0]--;\n                                    min_nearest_five = (60 + parseInt(min_nearest_five));\n                                }\n                                // console.log(\"split: \", split[0]);\n                                // console.log(\"min_nearest_five: \", min_nearest_five);\n                            }\n\n                    }\n                    //essentially we add 5 in case something happens over the limit\n\n                    return split[0] + \":\" + min_nearest_five;\n                  } else {\n                    return input;\n                  }\n                } else {\n                  return '';\n                }\n          \n\n          }\n\n\n\n            $scope.filter_detail = function(show_all = 0){\n                return (show_all == 0) ? {status: \"open\"} : {};\n            }\n\n           \n          \n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            vm.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n        \n        $scope.search = function(row){\n            ////console.log(\"hi\", (angular.lowercase(row.title).indexOf(angular.lowercase($scope.my_search) || '') !== -1));\n            return (angular.lowercase(row.title).indexOf(angular.lowercase($scope.my_search) || '') !== -1);\n        };\n\n        function convert_string_to_date(date){\n            if(date && date.indexOf(\"/\") > -1){\n                //then we prob have a date:::\n                    var d = date.split(\"/\");\n                    var rtn = d[2]+\"-\"+d[1]+\"-\"+d[0];\n                    //console.log(\"D\", rtn);\n                    return rtn;\n            }\n        }\n\n        // function check_if_month(input) {\n        //     var months = [\"jan\", \"feb\", \"mar\", \"apr\", \"may\", \"jun\", \"jul\", \"aug\", \"sep\", \"oct\", \"nov\", \"dec\"];\n\n        //     var monthPartOfInput = input.substring(0, 3).toLowerCase();                         \n\n        //     // if (months.indexOf(monthPartOfInput) == -1){\n        //     //     // TODO: Show validation error\n        //     // }\n        // }\n\n        function test_date(search, date){\n\n\n            if(search.length < 2){\n                return false;\n            }\n\n            if(search && search.length <= 3){\n                if(date.indexOf(search) > -1){\n                    return true;\n                }\n            } else {\n                var parsed_date = \"\";\n                var b = moment(search);\n                if(b.isValid() && b.format(\"YYYY\") != \"2001\"){\n                    parsed_date = b.format(\"YYYY-MM-DD\");\n                } else if(b.isValid()){\n                    parsed_date = b.format(\"MM-DD\");\n                }\n\n\n                var search_type = 0;\n\n                if(parsed_date !== \"\" && date.indexOf(parsed_date) > -1){\n                    // //console.log(\"found\");\n                    return true;\n                } else {\n\n                    //backup in case of wrong parsing data::;\n                    //european method\n\n                    if(search.length <= 5 && search.length >= 4){\n\n                        var c = moment(search, \"DDMM\");\n                        // //console.log(\"C is : \", c);\n                        if(c.isValid()){\n                            var c2 = c.format(\"MM-DD\");\n                            if(date.indexOf(c2) > -1){\n                                return true;\n                            }\n                        }\n\n                    } else if(search.length == 8 || search.length == 10){\n                        \n                        var c = moment(search, \"DDMMYYYY\");\n                        // //console.log(\"C is : \", c);\n                        if(c.isValid()){\n                            var c2 = c.format(\"YYYY-MM-DD\");\n                            if(date.indexOf(c2) > -1){\n                                return true;\n                            }\n                        }\n\n                    }\n\n                    // //console.log(\"not found\");\n                    return false;\n                }\n            }\n\n        }\n\n\n        function test_name(fname, lname, search){\n\n            var search2 = search.toLowerCase();\n            var fullname = fname+\" \"+lname;\n            fullname = fullname.toLowerCase();    \n            // //console.log(\"fullname: \", fullname);\n            // //console.log(\"search: \", search2);\n            // //console.log(\"match: \", (fullname.indexOf(search2) > -1));\n            if(search.length > 2 && (fullname.indexOf(search2) > -1) ){\n                return true;\n            } else {\n                return false;\n            }\n\n        }\n\n        function test_aircraft(registration, search){\n\n            var search2 = search.toLowerCase();\n            var fullname = registration.replace(\"-\", \"\");\n            fullname = fullname.toLowerCase();    \n             ////console.log(\"fullname: \", fullname);\n            // //console.log(\"search: \", search2);\n            // //console.log(\"match: \", (fullname.indexOf(search2) > -1));\n            if(search.length > 2 && (fullname.indexOf(search2) > -1) ){\n                return true;\n            } else {\n                return false;\n            }\n\n        }\n\n        function test_airfield(search, name, code){\n            var name2 = name.toLowerCase();\n            var code2 = code.toLowerCase();\n            var search2 = search.toLowerCase();\n\n            if(search2.length > 2 && (name2.indexOf(search2) > -1)){\n                return true;\n            } else if(search2.length > 2 && (code2.indexOf(search2) > -1)){\n                return true;\n            } else {\n                return false;\n            }\n\n\n\n        }\n\n        $scope.search2 = function(row){\n            //(angular.lowercase(row.first_name).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)  || (angular.lowercase(row.last_name).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)\n            ////console.log(\"answer\", (angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1));\n            // return ((angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || (angular.lowercase(row.flight_time).indexOf(angular.lowercase($scope.my_search2)) || '') !== -1)));\n            //(angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)\n           \n            // if( (test_date($scope.my_search2, row.flight_date)) || (angular.lowercase(row.destination_airport).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) || (angular.lowercase(row.departure_airport).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) || (angular.lowercase(row.destination_airport_code).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) || (angular.lowercase(row.departure_airport_code).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)){\n            //     return true;\n            // } else {\n            //     return false;\n            // }test_aircraft\n            ////console.log($scope.my_search2);\n            if(!$scope.my_search2 || ($scope.my_search2 == \"\")){\n                return true;\n            }else if(test_date($scope.my_search2, row.flight_date)){\n                return true;\n            } else if(test_name(row.first_name, row.last_name, $scope.my_search2 )){\n                return true;\n            } else if(test_airfield($scope.my_search2, row.departure_airport, row.departure_airport_code)){\n                return true;\n            } else if(test_airfield($scope.my_search2, row.destination_airport, row.destination_airport_code)){\n                return true;\n            }else {\n                return false;\n            }\n\n            // we are testing for the date, the pilot, the departure and destination.\n\n            // return (angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1); // ? (angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) : (angular.lowercase(row.flight_time).indexOf(angular.lowercase($scope.my_search2) || '') !== -1);\n\n        };\n\n        $scope.getMySearchCount = function(str){\n            var docs = str.documents;\n            var total = 0;\n            for(var i=0;i<docs.length;i++){\n                if($scope.search(docs[i])){\n                    total++;\n                }\n            }\n            return total;\n        }\n\n        $scope.getMySearchCount2 = function(str){\n            var charges = str.charges;\n            var total = 0;\n            for(var i=0;i<charges.length;i++){\n                if($scope.search(charges[i])){\n                    total++;\n                }\n            }\n            return total;\n        }\n\n        //  $scope.get_hours_from_decimal = function(time){\n\n        //     if(time){\n        //         var n = new Date(0,0);\n        //         n.setMinutes(+time * 60);\n        //         return n.toTimeString().slice(0,5);\n        //     } else {\n        //         return \"N/A\";\n        //     }\n\n        // }\n\n        $scope.get_hours_from_decimal = function(time){\n\n            if(time){\n                 var sign = time < 0 ? \"-\" : \"\";\n                 var hour = Math.floor(Math.abs(time));\n                 var min = Math.round((Math.abs(time) * 60) % 60);\n                 if(min == 60){\n                     hour++;\n                     min = 0;\n                 }\n                 return sign + (hour < 10 ? \"0\" : \"\") + hour + \":\" + (min < 10 ? \"0\" : \"\") + min;\n             } else {\n                 return \"N/A\";\n             }\n        }\n\n\n\n\n\n        $scope.downloadDocument = function(doc, type) {\n            var data = $.param({\n                id: doc\n            });\n\n            //alert(\"type\", type);\n\n            var controller = \"plane_documents\";\n\n            switch(type){\n                 case \"radio\": \n                    controller = \"plane_radio_licence\";\n                break;\n                 case \"insurance\": \n                    controller = \"plane_insurance\";\n                break;\n                 case \"certificate\": \n                    controller = \"plane_certificate\";\n                break;\n                case \"noise\": \n                    controller = \"plane_documents\";\n                break;\n                case \"docs\": \n                    controller = \"plane_documents\";\n                break;\n                default:\n                    controller = \"plane_documents\";\n                break;\n            }\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/'+controller+'/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        $scope.downloadClubDocument = function(doc) {\n            var data = $.param({\n                id: doc\n            });\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/club_documents/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        // vm.list_pilots = function(row){\n\n        //     var p1 = \"\";\n        //     var put = \"\";\n\n        //     if(row.instructor_first_name && row.instructor_first_name !== null){\n        //         p1 = \"PIC: \"+row.instructor_first_name+\" \"+row.instructor_last_name;\n        //         put = \"<br />PUT: \"+row.first_name+\" \"+row.last_name;\n        //     } else {\n        //         if(row.first_name && row.first_name !== null){\n        //             p1 = \"PIC: \"+row.first_name+\" \"+row.last_name;\n        //         } else {\n        //             p1 = \"PIC not yet set!\";\n        //         }\n        //     }\n\n        //     return $sce.getTrustedHtml('<div>'+p1+' '+put+'</div>');\n\n        // }\n\n        vm.list_pilots = function(row){\n\n            var p1 = \"\";\n            var put = \"\";\n\n            // if(row.instructor_first_name && row.instructor_first_name !== null){\n            //     p1 = \"PIC: \"+row.instructor_first_name+\" \"+row.instructor_last_name;\n            //     put = \"<br />PUT: \"+row.first_name+\" \"+row.last_name;\n            // } else {\n            //     if(row.first_name && row.first_name !== null){\n            //         p1 = \"PIC: \"+row.first_name+\" \"+row.last_name;\n            //     } else {\n            //         p1 = \"PIC not yet set!\";\n            //     }\n            // }\n\n            p1 = \"PIC: \"+ vm.get_pic(row);\n            put = vm.get_put(row);\n            if(put && put !== \"\"){\n                put = \"<br />PUT: \" + put;\n            }\n\n            if(p1 && p1 == \"\"){\n                p1 = \"No PIC set yet!\";\n            }\n\n            return $sce.getTrustedHtml('<div>'+p1+' '+put+'</div>');\n\n        }\n\n        vm.get_pic = function(log){\n\n            var p1 = \"\";\n\n            if(log.pic_first_name && log.pic_first_name !== null){\n                p1 = vm.get_initial(log.pic_first_name) + \". \" + log.pic_last_name;\n            } else if(log.instructor_first_name && log.instructor_first_name !== \"\"){\n                p1 = vm.get_initial(log.instructor_first_name) + \". \" + log.instructor_last_name;\n            } else if(log.instructor_id == 0 && log.first_name && log.first_name !== \"\"){\n                p1 = vm.get_initial(log.first_name) + \". \" + log.last_name;\n            }\n\n            return p1;\n\n        }\n\n        vm.get_put = function(log){\n\n            var put = \"\";\n\n            if(log.put_first_name && log.put_first_name !== null){\n                put = vm.get_initial(log.put_first_name) + \". \" + log.put_last_name;\n            } else if(log.instructor_id > 0 && log.first_name && log.first_name !== \"\"){\n                put = vm.get_initial(log.first_name) + \". \" + log.last_name;\n            } \n\n            return put;\n\n        }\n\n        function processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], {\n                    type: contentType\n                });\n                if (navigator.msSaveBlob)\n                    navigator.msSaveBlob(blob, filename);\n                else {\n                    // Try using other saveBlob implementations, if available\n                    var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                    if (saveBlob === undefined) throw \"Not supported\";\n                    saveBlob(blob, filename);\n                }\n                success = true;\n            } catch (ex) {\n                $log.info(\"saveBlob method failed with the following exception:\");\n                $log.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            $log.info(\"Download link method with simulated click failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n\n\n        $scope.get_icon2 = function(file){\n                // //console.log(\"FILE\", file);\n                if(!file || file == \"\"){\n                    return \"\";\n                }\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n      \n\n\n\n    }\n app.controller('AircraftStatusController', AircraftStatusController);\n\n    AircraftStatusController.$inject = ['UserService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'BookingService', 'LicenceService', 'ClubDocumentService', 'PlaneDocumentService', '$http', 'PlaneService', 'ToastService'];\n    function AircraftStatusController(UserService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, BookingService, LicenceService, ClubDocumentService, PlaneDocumentService, $http, PlaneService, ToastService) {\n        \n        var vm = this;\n\n        vm.clubs = [];\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n\n        vm.looking_for = $stateParams.registration;\n        if(vm.looking_for){\n            $scope.my_search2 = vm.looking_for;\n        }\n\n\n        vm.defect_severity;\n        vm.defect_severities = [\n            { title: \"No Fly Item - Ground the plane\"},\n            { title: \"Flyable - needs to be checked at next maintenance\"},\n            { title: \"Not urgent - but needs noting\"},\n            { title: \"Unsure of severity\"}\n        ]; \n\n\n        ////console.log(\"REG: \"+$stateParams.registration);\n\n\n         PlaneService.GetByUserMaintenance(vm.user.id)\n            .then(function (data) {\n                    ////console.log(\"data is : \", data);\n                   vm.clubs = data.clubs;\n\n\n\n\n                });\n\n\n            vm.get_initial = function(text){\n                return text.charAt(0);\n            }\n\n            vm.list_pilots = function(row){\n\n            var p1 = \"\";\n            var put = \"\";\n\n            // if(row.instructor_first_name && row.instructor_first_name !== null){\n            //     p1 = \"PIC: \"+row.instructor_first_name+\" \"+row.instructor_last_name;\n            //     put = \"<br />PUT: \"+row.first_name+\" \"+row.last_name;\n            // } else {\n            //     if(row.first_name && row.first_name !== null){\n            //         p1 = \"PIC: \"+row.first_name+\" \"+row.last_name;\n            //     } else {\n            //         p1 = \"PIC not yet set!\";\n            //     }\n            // }\n\n            p1 = \"PIC: \"+ vm.get_pic(row);\n            put = vm.get_put(row);\n            if(put && put !== \"\"){\n                put = \"<br />PUT: \" + put;\n            }\n\n            if(p1 && p1 == \"\"){\n                p1 = \"No PIC set yet!\";\n            }\n\n            return $sce.getTrustedHtml('<div>'+p1+' '+put+'</div>');\n\n        }\n\n        vm.get_pic = function(log){\n\n            var p1 = \"\";\n\n            if(log.pic_first_name && log.pic_first_name !== null){\n                p1 = vm.get_initial(log.pic_first_name) + \". \" + log.pic_last_name;\n            } else if(log.instructor_first_name && log.instructor_first_name !== \"\"){\n                p1 = vm.get_initial(log.instructor_first_name) + \". \" + log.instructor_last_name;\n            } else if(log.instructor_id == 0 && log.first_name && log.first_name !== \"\"){\n                p1 = vm.get_initial(log.first_name) + \". \" + log.last_name;\n            }\n\n            return p1;\n\n        }\n\n        vm.get_put = function(log){\n\n            var put = \"\";\n\n            if(log.put_first_name && log.put_first_name !== null){\n                put = vm.get_initial(log.put_first_name) + \". \" + log.put_last_name;\n            } else if(log.instructor_id > 0 && log.first_name && log.first_name !== \"\"){\n                put = vm.get_initial(log.first_name) + \". \" + log.last_name;\n            } \n\n            return put;\n\n        }\n\n            \n            vm.clean_times = function(time){\n                return time.substring(0,5);\n            }\n\n            vm.add_defect = function(plane_id, club_id){\n\n\n                var obj = {\n                    club_id: club_id,\n                    user_id: vm.user_id,\n                    plane_id: plane_id,\n                    defect: vm.defect,\n                    severity: vm.defect_severity.title,\n                    status: \"open\"\n                }\n\n\n\n                PlaneService.AddDefect(obj)\n                 .then(function (data) {\n                        ////console.log(\"data is : \", data);\n                        data.item.can_delete = true;\n\n                        //HELLO\n                        vm.clubs.find(club => club.id === club_id).planes.find(plane => plane.plane_id === plane_id).defects.push(data.item);\n                        //vm.reported_defects.push(data.item);\n\n                        vm.defect = \"\";\n                        vm.defect_severity = \"\";\n\n\n\n                    });\n\n            }\n\n            vm.delete_defect = function(id){\n                // //console.log(\"UNDO DEFECT ID \", id);\n\n                PlaneService.DeleteDefect(id)\n                .then(function (data) {\n                        ////console.log(\"data is : \", data);\n                       \n                        PlaneService.GetOpenIssues(vm.bookout.plane_id)\n                        .then(function (data) {\n                                ////console.log(\"data is : \", data);\n                               vm.reported_defects = data;\n                            });\n\n\n                    });\n\n            }\n\n\n            $scope.filter_detail = function(show_all = 0){\n                return (show_all == 0) ? {status: \"open\"} : {};\n            }\n\n            $scope.count_defects = function(defects, show_all = 0){\n\n               var counter = 0;\n\n               for(var i=0;i<defects.length;i++){\n                   if(show_all == 1){\n                       counter++;\n                   } else {\n                       if(defects[i].status == \"open\"){\n                           counter++;\n                       }\n                   }\n               }\n\n               return counter;\n\n           }\n          \n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            vm.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n        vm.show_receipt_image = function(receipt){\n\n            vm.show_receipt = true;\n            vm.receipt_image = receipt.image;\n\n        }\n\n        vm.get_icon3 = function(file){\n\n                var ft = file.split(';')[0];\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n        \n        $scope.search = function(row){\n            ////console.log(\"hi\", (angular.lowercase(row.title).indexOf(angular.lowercase($scope.my_search) || '') !== -1));\n            return (angular.lowercase(row.title).indexOf(angular.lowercase($scope.my_search) || '') !== -1);\n        };\n\n        $scope.search2 = function(row){\n            return (angular.lowercase(row.registration).indexOf(angular.lowercase($scope.my_search2) || '') !== -1);\n        };\n\n        $scope.getMySearchCount = function(str){\n            var docs = str.documents;\n            var total = 0;\n            for(var i=0;i<docs.length;i++){\n                if($scope.search(docs[i])){\n                    total++;\n                }\n            }\n            return total;\n        }\n\n        $scope.getMySearchCount2 = function(str){\n            var charges = str.charges;\n            var total = 0;\n            for(var i=0;i<charges.length;i++){\n                if($scope.search(charges[i])){\n                    total++;\n                }\n            }\n            return total;\n        }\n\n        //  $scope.get_hours_from_decimal = function(time){\n\n        //     if(time){\n        //         var n = new Date(0,0);\n        //         n.setMinutes(+time * 60);\n        //         return n.toTimeString().slice(0,5);\n        //     } else {\n        //         return \"N/A\";\n        //     }\n\n        // }\n\n        $scope.get_hours_from_decimal = function(time){\n\n            if(time){\n                 var sign = time < 0 ? \"-\" : \"\";\n                 var hour = Math.floor(Math.abs(time));\n                 var min = Math.round((Math.abs(time) * 60) % 60);\n                 if(min == 60){\n                     hour++;\n                     min = 0;\n                 }\n                 return sign + (hour < 10 ? \"0\" : \"\") + hour + \":\" + (min < 10 ? \"0\" : \"\") + min;\n             } else {\n                 return \"N/A\";\n             }\n        }\n\n\n\n        $scope.downloadDocument = function(doc, type) {\n            var data = $.param({\n                id: doc\n            });\n\n            //alert(\"type\", type);\n\n            var controller = \"plane_documents\";\n\n            switch(type){\n                 case \"radio\": \n                    controller = \"plane_radio_licence\";\n                break;\n                 case \"insurance\": \n                    controller = \"plane_insurance\";\n                break;\n                 case \"certificate\": \n                    controller = \"plane_certificate\";\n                break;\n                case \"noise\": \n                    controller = \"plane_noise_certificate\";\n                break;\n                case \"docs\": \n                    controller = \"plane_documents\";\n                break;\n                default:\n                    controller = \"plane_documents\";\n                break;\n            }\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/'+controller+'/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        $scope.downloadClubDocument = function(doc) {\n            var data = $.param({\n                id: doc\n            });\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/club_documents/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n\n        function titlepath(path,name){\n\n        //In this path defined as your pdf url and name (your pdf name)\n            var prntWin = window.open();\n            prntWin.document.write(\"<html><head><title>\"+name+\"</title></head><body>\"\n                + '<embed width=\"100%\" height=\"100%\" name=\"plugin\" src=\"'+ path+ '\" '\n                + 'type=\"application/pdf\" internalinstanceid=\"21\"></body></html>');\n            prntWin.document.close();\n        }\n\n\n        vm.round_brake_times_start = function(input, earlier_input=null){\n            \n                if(input){\n                  if(input.indexOf(\":\") > -1){\n                    var split = input.split(\":\");\n                    var x = split[1];\n\n\n\n                    var min_nearest_five = ((x % 5) >= 2.5 ? parseInt(x / 5) * 5 + 5 : parseInt(x / 5) * 5);\n                    \n\n\n                    if(min_nearest_five < 10){\n                      min_nearest_five = \"0\"+min_nearest_five;\n                    } else if(min_nearest_five == 60){\n                      split[0]++;\n                      min_nearest_five = \"00\";\n                    } else if(min_nearest_five > 60){\n                      split[0]++;\n                      min_nearest_five = (min_nearest_five - 60);\n                    }\n\n\n                    if(earlier_input && earlier_input.indexOf(\":\") > -1){\n                            // console.log(\"total calculated?\");\n                            // console.log(\"earlier_input: \", earlier_input);\n                            // console.log(\"input: \", input);\n                            var esplit = earlier_input.split(\":\");\n                            var ehour = esplit[0];\n                            var emin = esplit[1];\n                            var etot = (parseInt(ehour)*60) + parseInt(emin); \n                            // console.log(\"etot: \", etot);\n                            var hr = split[0];\n                            var mn = min_nearest_five;\n                            var tot = (parseInt(hr)*60) + parseInt(mn);\n                            // console.log(\"tot: \", tot);\n\n                            if(etot < tot){\n                                //the earlier time is after the end time\n                                // console.log(\"etot < tot\");\n                                min_nearest_five = parseInt(min_nearest_five) - 5;\n                                if(min_nearest_five == 60){\n                                    split[0]++; \n                                    min_nearest_five = \"00\";\n                                } else if(min_nearest_five > 60){\n                                    split[0]++;\n                                    min_nearest_five = (min_nearest_five - 60);\n                                    if(min_nearest_five < 10 ){\n                                      min_nearest_five = \"0\"+min_nearest_five;\n                                    }\n                                } else if(min_nearest_five < 0){\n                                    split[0]--;\n                                    min_nearest_five = (60 + parseInt(min_nearest_five));\n                                }\n                                // console.log(\"split: \", split[0]);\n                                // console.log(\"min_nearest_five: \", min_nearest_five);\n                            }\n\n                    }\n                    //essentially we add 5 in case something happens over the limit\n\n                    return split[0] + \":\" + min_nearest_five;\n                  } else {\n                    return input;\n                  }\n                } else {\n                  return '';\n                }\n          \n\n          }\n\n          vm.round_brake_times_end = function(input, earlier_input=null){\n            \n                if(input){\n                  if(input.indexOf(\":\") > -1){\n                    var split = input.split(\":\");\n                    var x = split[1];\n\n\n\n                    var min_nearest_five = ((x % 5) >= 2.5 ? parseInt(x / 5) * 5 + 5 : parseInt(x / 5) * 5);\n                    \n\n\n                    if(min_nearest_five < 10){\n                      min_nearest_five = \"0\"+min_nearest_five;\n                    } else if(min_nearest_five == 60){\n                      split[0]++;\n                      min_nearest_five = \"00\";\n                    } else if(min_nearest_five > 60){\n                      split[0]++;\n                      min_nearest_five = (min_nearest_five - 60);\n                    }\n\n\n                    if(earlier_input && earlier_input.indexOf(\":\") > -1){\n                            // console.log(\"total calculated?\");\n                            // console.log(\"earlier_input: \", earlier_input);\n                            // console.log(\"input: \", input);\n                            var esplit = earlier_input.split(\":\");\n                            var ehour = esplit[0];\n                            var emin = esplit[1];\n                            var etot = (parseInt(ehour)*60) + parseInt(emin); \n                            // console.log(\"etot: \", etot);\n                            var hr = split[0];\n                            var mn = min_nearest_five;\n                            var tot = (parseInt(hr)*60) + parseInt(mn);\n                            // console.log(\"tot: \", tot);\n\n                            if(etot > tot){\n                                //the earlier time is after the end time\n                                // console.log(\"etot > tot\");\n                                min_nearest_five = parseInt(min_nearest_five) + 5;\n                                if(min_nearest_five == 60){\n                                    split[0]++; \n                                    min_nearest_five = \"00\";\n                                } else if(min_nearest_five > 60){\n                                    split[0]++;\n                                    min_nearest_five = (min_nearest_five - 60);\n                                    if(min_nearest_five < 10 ){\n                                      min_nearest_five = \"0\"+min_nearest_five;\n                                    }\n                                }\n                                // console.log(\"split: \", split[0]);\n                                // console.log(\"min_nearest_five: \", min_nearest_five);\n                            }\n\n                    }\n                    //essentially we add 5 in case something happens over the limit\n\n                    return split[0] + \":\" + min_nearest_five;\n                  } else {\n                    return input;\n                  }\n                } else {\n                  return '';\n                }\n          \n\n          }\n\n        function processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n\n                $log.info(\"first try\");\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], {\n                    //type: contentType\n                    type: 'application/pdf'\n                });\n\n                var fileURL = URL.createObjectURL(blob);\n                titlepath(fileURL, \"Secure Documents\");\n\n                // if (navigator.msSaveBlob)\n                //     navigator.msSaveBlob(blob, filename);\n                // else {\n                //     // Try using other saveBlob implementations, if available\n                //     var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                //     if (saveBlob === undefined) throw \"Not supported\";\n                //     saveBlob(blob, filename);\n                // }\n                success = true;\n            } catch (ex) {\n                $log.info(\"saveBlob method failed with the following exception:\");\n                $log.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            $log.info(\"second try\");\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            $log.info(\"Download link method with simulated click failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n\n                            $log.info(\"third try\");\n\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n\n\n        $scope.get_icon2 = function(file){\n                //console.log(\"FILE\", file);\n                if(!file || file == \"\"){\n                    return \"\";\n                }\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n      \n\n\n\n    }\n app.controller('AllDocumentsController', AllDocumentsController);\n\n    AllDocumentsController.$inject = ['UserService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'BookingService', 'LicenceService', 'ClubDocumentService', 'PlaneDocumentService', '$http', 'ToastService'];\n    function AllDocumentsController(UserService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, BookingService, LicenceService, ClubDocumentService, PlaneDocumentService, $http, ToastService) {\n        \n        var vm = this;\n\n        vm.clubs = [];\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n         ClubDocumentService.GetByUserId(vm.user.id)\n            .then(function (data) {\n                    ////console.log(\"data is : \", data);\n                   vm.clubs = data.clubs;\n\n                   for(var i=0; i<vm.clubs.length;i++){\n\n                       if(vm.clubs[i].membership_terms !== \"\"){\n                           vm.clubs[i].documents.push({title: \"Membership Terms & Conditions\", document: vm.clubs[i].membership_terms, updated_at: vm.clubs[i].membership_updated });\n                       }\n                       if(vm.clubs[i].privacy_terms !== \"\"){\n                           vm.clubs[i].documents.push({title: \"Privacy Terms\", document: vm.clubs[i].privacy_terms, updated_at: vm.clubs[i].privacy_updated });\n                       }\n                       if(vm.clubs[i].passenger_terms !== \"\"){\n                           vm.clubs[i].documents.push({title: \"Passenger Terms & Conditions\", document: vm.clubs[i].passenger_terms, updated_at: vm.clubs[i].passenger_updated });\n                       }\n                       \n                   }\n\n\n                });\n       \n          \n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            vm.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n        \n        $scope.search = function(row){\n            ////console.log(\"hi\", (angular.lowercase(row.title).indexOf(angular.lowercase($scope.my_search) || '') !== -1));\n            return (angular.lowercase(row.title).indexOf(angular.lowercase($scope.my_search) || '') !== -1);\n        };\n\n         $scope.search3 = function(row){\n            ////console.log(\"hi\", (angular.lowercase(row.title).indexOf(angular.lowercase($scope.my_search) || '') !== -1));\n            return (angular.lowercase(row.membership_name).indexOf(angular.lowercase($scope.my_search) || '') !== -1);\n        };\n\n        $scope.search2 = function(row){\n            return (angular.lowercase(row.registration).indexOf(angular.lowercase($scope.my_search2) || '') !== -1);\n        };\n\n        $scope.getMySearchCount = function(str){\n            var docs = str.documents;\n            var total = 0;\n            for(var i=0;i<docs.length;i++){\n                if($scope.search(docs[i])){\n                    total++;\n                }\n            }\n            return total;\n        }\n\n        $scope.getMySearchCount2 = function(str){\n            var charges = str.charges;\n            var total = 0;\n            for(var i=0;i<charges.length;i++){\n                if($scope.search(charges[i])){\n                    total++;\n                }\n            }\n            return total;\n        }\n\n        \n\n        $scope.downloadDocument = function(doc) {\n            var data = $.param({\n                id: doc\n            });\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/plane_documents/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n\n\n        $scope.downloadClubDocument = function(doc) {\n            var data = $.param({\n                id: doc\n            });\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/club_documents/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        function titlepath(path,name){\n\n        //In this path defined as your pdf url and name (your pdf name)\n            var prntWin = window.open();\n            prntWin.document.write(\"<html><head><title>\"+name+\"</title></head><body>\"\n                + '<embed width=\"100%\" height=\"100%\" name=\"plugin\" src=\"'+ path+ '\" '\n                + 'type=\"application/pdf\" internalinstanceid=\"21\"></body></html>');\n            prntWin.document.close();\n        }\n\n        function processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], {\n                    //type: contentType\n                    type: 'application/pdf'\n                });\n                var fileURL = URL.createObjectURL(blob);\n                //window.open(fileURL);\n                titlepath(fileURL, \"Secure Documents\");\n                // if (navigator.msSaveBlob)\n                //     navigator.msSaveBlob(blob, filename);\n                // else {\n                //     // Try using other saveBlob implementations, if available\n                //     var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                //     if (saveBlob === undefined) throw \"Not supported\";\n                //     saveBlob(blob, filename);\n                // }\n                success = true;\n            } catch (ex) {\n                $log.info(\"saveBlob method failed with the following exception:\");\n                $log.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            $log.info(\"Download link method with simulated click failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n\n      \n\n\n\n    }\n app.controller('AllInvoicesController', AllInvoicesController);\n\n    AllInvoicesController.$inject = ['$sce', 'PaymentService', 'UserService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'BookingService', 'LicenceService', 'ClubDocumentService', 'PlaneDocumentService', '$http', 'ToastService'];\n    function AllInvoicesController($sce, PaymentService, UserService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, BookingService, LicenceService, ClubDocumentService, PlaneDocumentService, $http, ToastService) {\n        \n        var vm = this;\n\n        vm.clubs = [];\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n        vm.show_pay_now = false;\n        vm.show_loading = false;\n\n        vm.last_invoice_opened = {};\n\n\n        var iconBank = '<svg viewBox=\"0 0 24 24\"><path d=\"M3 10h18M4 10V8l8-5 8 5v2M5 10v8M9 10v8M15 10v8M19 10v8M3 18h18M2 20h20\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        var iconCard = '<svg viewBox=\"0 0 24 24\"><rect x=\"2\" y=\"4\" width=\"20\" height=\"16\" rx=\"2\" ry=\"2\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><path d=\"M2 9h20M6 14h6\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        var iconNew  = '<svg viewBox=\"0 0 24 24\"><circle cx=\"12\" cy=\"12\" r=\"9\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><path d=\"M12 8v8M8 12h8\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        var iconTerm = '<svg viewBox=\"0 0 24 24\"><rect x=\"6\" y=\"2\" width=\"12\" height=\"14\" rx=\"2\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><rect x=\"8\" y=\"5\" width=\"8\" height=\"3\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><rect x=\"9\" y=\"10\" width=\"6\" height=\"3\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        \n          vm.donConfirm = function(methodLabel, paymentIntent){\n            // console.log(\"confirmation is called\", methodLabel);\n            // console.log(\"paymentIntent\", paymentIntent);\n          //alert('Parent received D confirmation: ' + methodLabel);\n            vm.complete_invoice(methodLabel, paymentIntent);\n          };\n\n          vm.default_payment = 'direct-debit';\n\n          vm.methods = [\n            { id: 'direct-debit', title: 'Direct Debit', subtitle: 'Use your BACS mandate', type: 'direct-debit', iconSvg: $sce.trustAsHtml(iconBank), visible: true },\n            { id: 'saved-card',   title: 'Saved card',   subtitle: 'Use a card on file',    type: 'saved-card',  iconSvg: $sce.trustAsHtml(iconCard), visible: true },\n            { id: 'new-card',     title: 'New card',     subtitle: 'Add a new debit/credit card', type: 'new-card', iconSvg: $sce.trustAsHtml(iconNew), visible: true },\n            { id: 'card-machine', title: 'Card Machine', subtitle: 'Pay in person',          type: 'card-machine', iconSvg: $sce.trustAsHtml(iconTerm), visible: true }\n          ];\n\n           vm.savedCards = [];\n\n           vm.complete_invoice = function(method, paymentIntent){\n\n               //we now have a payment to complete\n               //process_payment\n\n               var obj = {\n                   user_id: vm.user.id,\n                   club_id: vm.last_invoice_opened.club_id,\n                   paymentIntent: paymentIntent,\n                   invoice_id: vm.last_invoice_opened.id,\n                   method: method\n               }\n\n               PaymentService.ProcessPayment(obj)\n                   .then(function (data) {\n\n                       if(data.success){\n\n                           //finish with:\n                           //RELOAD THE INVOICES!!!\n                           UserService.GetInvoices(vm.user.id)\n                            .then(function (data) {\n\n                               vm.invoices = data.invoices;\n\n                               vm.show_pay_now = false;\n                               vm.show_loading = false;\n                               //alert(\"SUCCESS!\");\n                            });\n\n                       } else {\n                           //alert(\"Something happened which was not supposed to happen... Please try again\");\n                           console.log(\"===== ERROR =====\");\n                           console.log(data);\n                           console.log(\"===== ERROR =====\");\n                       }\n\n\n                   });\n\n           }\n\n           vm.close_pay_now = function(){\n               vm.show_pay_now = false;\n               vm.show_loading = false;\n           }\n\n        \n\n         vm.get_package_html = function(pack_obj){\n\n\n\n                            var used_on = \"\";\n                            for(var i=0;i<pack_obj.aircraft.length;i++){\n                                used_on = used_on + \" \" + pack_obj.aircraft[i].registration +\" (\"+ pack_obj.aircraft[i].plane_type +\") <br />\";\n                            }\n                            var text = \"\";\n                            if(pack_obj.validity == 0){\n                               text = \"Package purchased on: \"+moment(pack_obj.created_at).format(\"D MMM Y\")+\"<br /> Package does not expire <br /> To be used on:<br />\";\n                            } else {\n                               text = \"Package purchased on: \"+moment(pack_obj.created_at).format(\"D MMM Y\")+\"<br /> Package expires on: \"+ moment(pack_obj.created_at).add(pack_obj.validity, \"days\").format(\"D MMM Y\") +\" <br /> To be used on:<br />\";\n                            }\n                    \n                            var intro =  text+used_on;\n\n\n                            // bit = bit + '<h4 uib-tooltip=\"'+intro+'\"> '+package.title+' <i class=\"fa fa-question-circle\"></i></h4><div class=\"dual_solo\"><div class=\"dual\" uib-tooltip=\"Hours remaining on this package to fly dual (with an instructor)\"><span class=\"bigger_text\">'+vm.convert_decimal_to_hours( package.remaining_hours_dual )+'</span><span class=\"smaller_text\">DUAL</span></div><div class=\"solo\" uib-tooltip=\"Hours remaining on this package of solo rental\"><span class=\"bigger_text\">'+vm.convert_decimal_to_hours( package.remaining_hours_solo )+'</span><span class=\"smaller_text\">SOLO</span></div></div>';\n\n\n                            \n                            return intro;\n\n        }\n\n        vm.show_payment_option = function(invoice){\n            var status = invoice.status;\n            if(status == \"pending_submission\"){\n                return true;\n            } else if(status == \"issued\"){\n                return true;\n            } else {\n                return false;\n            }\n\n        }\n\n        vm.info;\n\n        vm.show_payment = function(invoice){\n            console.log(\"invoice details: \", invoice);\n            vm.last_invoice_opened = invoice;\n            vm.send = {\n                club_id: invoice.club_id,\n                user_id: invoice.user_id,\n                invoice_id: invoice.id\n            }\n\n            //get user cards\n            //get user info\n\n            MemberService.GetMandate(invoice.user_id, invoice.club_id)\n                    .then(function (data) {\n                            ////console.log(\"data is : \", data);\n                           \n                    if(data.success){\n                        vm.info = data.info;\n\n                        vm.savedCards = data.cards;\n\n                        if(vm.savedCards.length > 0){\n                            vm.methods[1].visible = true;\n                        } else {\n                            vm.methods[1].visible = false;\n                        }\n\n                        vm.machine = data.machine;\n                        if(vm.machine.success){\n                            vm.methods[3].visible = true;\n                        } else {\n                            vm.methods[3].visible = false;\n                        }\n\n                        vm.show_pay_now = true;\n                    }\n\n                });\n\n           \n\n        }\n\n        vm.convert_decimal_to_hours = function(number){\n            \n                            var sign = (number >= 0) ? 1 : -1;\n\n                            // Set positive value of number of sign negative\n                            number = number * sign;\n\n                            // Separate the int from the decimal part\n                            var hour = Math.floor(number);\n                            var decpart = number - hour;\n\n                            var min = 1 / 60;\n                            // Round to nearest minute\n                            decpart = min * Math.round(decpart / min);\n\n                            var minute = Math.floor(decpart * 60) + '';\n\n                            // Add padding if need\n                            if (minute.length < 2) {\n                            minute = '0' + minute; \n                            }\n\n                            if(minute == 60){\n                                hour = hour+1;\n                                minute = '00';\n                            }\n\n                            // Add Sign in final result\n                            sign = sign == 1 ? '' : '-';\n\n                            // Concate hours and minutes\n                            var time = sign + hour + ':' + minute;\n\n                            return time;\n\n                        }\n\n\n\n         UserService.GetInvoices(vm.user.id)\n            .then(function (data) {\n                    ////console.log(\"data is : \", data);\n                   vm.invoices = data.invoices;\n                });\n\n\n        UserService.GetUpcoming(vm.user.id)\n            .then(function (data) {\n                    ////console.log(\"data is : \", data);\n                   vm.upcoming = data.upcoming;\n                });\n       \n          \n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            vm.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n        \n        $scope.search = function(row){\n            ////console.log(\"hi\", (angular.lowercase(row.title).indexOf(angular.lowercase($scope.my_search) || '') !== -1));\n            return ( (angular.lowercase(row.invoice_number).indexOf(angular.lowercase($scope.my_search) || '') !== -1) || \n                    ((row.plane_registration)? (angular.lowercase(row.plane_registration).indexOf(angular.lowercase($scope.my_search) || '') !== -1) : false) ||\n                    (angular.lowercase(row.club_title).indexOf(angular.lowercase($scope.my_search) || '') !== -1) ||\n                    (angular.lowercase(row.created_at.toString()).indexOf(angular.lowercase($scope.my_search) || '') !== -1) ||\n                    (angular.lowercase((parseFloat(row.total).toFixed(2)).toString()).indexOf(angular.lowercase($scope.my_search) || '') !== -1) ||\n                    (angular.lowercase(row.status).indexOf(angular.lowercase($scope.my_search) || '') !== -1) );\n        };\n\n        $scope.show_more = function(index){\n\n\n            vm.invoices[index].show_more = (vm.invoices[index].show_more)? false : true;\n\n\n        }\n\n\n\n\n        function process_payment_bits(payments){\n\n\n\n\n\n\n\n\n\n        }\n\n\n        $scope.get_human_status = function(status){\n\n            var returned;\n            switch(status){\n                case 'issued':\n            \n                  returned = \"Created\";\n\n              break;\n\n              case 'pending_submission':\n                  \n                    returned = \"Requesting\";\n\n              break;\n\n              case 'submitted':\n                    \n                    returned = \"Requested\";\n\n              break;\n\n              case 'confirmed':\n                    \n                    returned = \"Paid\";\n\n              break;\n\n              case 'paid_out':\n                    returned = \"Paid\";\n\n              break;\n\n              case 'failed':\n                    returned = \"Failed\";\n\n              break;\n\n              case 'charged_back':\n                    returned = \"Charged Back\";\n\n              break;\n              default:\n                  returned = status;\n              break\n            }\n\n            return returned;\n\n        }\n\n     \n        $scope.downloadDocument = function(doc) {\n            var data = $.param({\n                id: doc\n            });\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('/api/v1/plane_documents/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        $scope.downloadInvoice = function(id) {\n            // var data = $.param({\n            //     id: doc\n            // });\n\n            //var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/invoice_pdf/get_ad_hoc_invoice/'+id, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        function processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], {\n                    type: contentType\n                });\n                if (navigator.msSaveBlob)\n                    navigator.msSaveBlob(blob, filename);\n                else {\n                    // Try using other saveBlob implementations, if available\n                    var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                    if (saveBlob === undefined) throw \"Not supported\";\n                    saveBlob(blob, filename);\n                }\n                success = true;\n            } catch (ex) {\n                $log.info(\"!!saveBlob method failed with the following exception:\");\n                $log.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            $log.info(\"Download link method with simulated click failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n\n      \n\n\n\n    }\n app.controller('AllPaymentsController', AllPaymentsController);\n\n    AllPaymentsController.$inject = ['UserService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'BookingService', 'LicenceService', 'ClubDocumentService', 'PlaneDocumentService', '$http', 'ToastService'];\n    function AllPaymentsController(UserService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, BookingService, LicenceService, ClubDocumentService, PlaneDocumentService, $http, ToastService) {\n        \n        var vm = this;\n\n        vm.clubs = [];\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n        vm.get_package_html = function(pack_obj){\n\n\n\n                            var used_on = \"\";\n                            for(var i=0;i<pack_obj.aircraft.length;i++){\n                                used_on = used_on + \" \" + pack_obj.aircraft[i].registration +\" (\"+ pack_obj.aircraft[i].plane_type +\") <br />\";\n                            }\n                            var text = \"\";\n                            if(pack_obj.validity == 0){\n                               text = \"Package purchased on: \"+moment(pack_obj.created_at).format(\"D MMM Y\")+\"<br /> Package does not expire <br /> To be used on:<br />\";\n                            } else {\n                               text = \"Package purchased on: \"+moment(pack_obj.created_at).format(\"D MMM Y\")+\"<br /> Package expires on: \"+ moment(pack_obj.created_at).add(pack_obj.validity, \"days\").format(\"D MMM Y\") +\" <br /> To be used on:<br />\";\n                            }\n                    \n                            var intro =  text+used_on;\n\n\n                            // bit = bit + '<h4 uib-tooltip=\"'+intro+'\"> '+package.title+' <i class=\"fa fa-question-circle\"></i></h4><div class=\"dual_solo\"><div class=\"dual\" uib-tooltip=\"Hours remaining on this package to fly dual (with an instructor)\"><span class=\"bigger_text\">'+vm.convert_decimal_to_hours( package.remaining_hours_dual )+'</span><span class=\"smaller_text\">DUAL</span></div><div class=\"solo\" uib-tooltip=\"Hours remaining on this package of solo rental\"><span class=\"bigger_text\">'+vm.convert_decimal_to_hours( package.remaining_hours_solo )+'</span><span class=\"smaller_text\">SOLO</span></div></div>';\n\n\n                            \n                            return intro;\n\n        }\n       \n\n        vm.convert_decimal_to_hours = function(number){\n            \n                            var sign = (number >= 0) ? 1 : -1;\n\n                            // Set positive value of number of sign negative\n                            number = number * sign;\n\n                            // Separate the int from the decimal part\n                            var hour = Math.floor(number);\n                            var decpart = number - hour;\n\n                            var min = 1 / 60;\n                            // Round to nearest minute\n                            decpart = min * Math.round(decpart / min);\n\n                            var minute = Math.floor(decpart * 60) + '';\n\n                            // Add padding if need\n                            if (minute.length < 2) {\n                            minute = '0' + minute; \n                            }\n\n                            // Add Sign in final result\n                            sign = sign == 1 ? '' : '-';\n\n                            if(minute == 60){\n                                hour = hour+1;\n                                minute = '00';\n                            }\n\n                            // Concate hours and minutes\n                            var time = sign + hour + ':' + minute;\n\n                            return time;\n\n                        }\n\n\n         UserService.GetPayments(vm.user.id)\n            .then(function (data) {\n                    // //console.log(\" PAY data is : \", data);\n                   vm.payments = data.payments;\n                });\n\n\n        UserService.GetUpcoming(vm.user.id)\n            .then(function (data) {\n                    ////console.log(\"data is : \", data);\n                   vm.upcoming = data.upcoming;\n                });\n       \n          \n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            vm.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n        \n        $scope.search = function(row){\n            ////console.log(\"hi\", (angular.lowercase(row.title).indexOf(angular.lowercase($scope.my_search) || '') !== -1));\n            return ( (angular.lowercase(row.id.toString()).indexOf(angular.lowercase($scope.my_search) || '') !== -1) || \n                    (angular.lowercase(row.club_title).indexOf(angular.lowercase($scope.my_search) || '') !== -1) ||\n                    (angular.lowercase(row.created_at.toString()).indexOf(angular.lowercase($scope.my_search) || '') !== -1) ||\n                    (angular.lowercase(row.amount.toString()).indexOf(angular.lowercase($scope.my_search) || '') !== -1) ||\n                    (angular.lowercase(row.status).indexOf(angular.lowercase($scope.my_search) || '') !== -1) );\n        };\n\n        $scope.show_more = function(index){\n\n\n            vm.invoices[index].show_more = (vm.invoices[index].show_more)? false : true;\n\n\n        }\n\n\n\n\n        function process_payment_bits(payments){\n\n\n\n\n\n\n\n\n\n        }\n\n\n        $scope.get_human_method = function(method){\n            \n            var returned;\n            switch(method){\n                case 'GoCardless':\n            \n                  returned = \"Direct Debit\";\n\n                break;\n\n                case 'Credit':\n                      \n                   returned = \"Credit\";\n\n                break;\n\n                case 'GoCardless + Credit':\n                        \n                   returned = \"Direct Debit + Credit\";\n\n                break;\n                case 'Equilibrium':\n                        \n                   returned = \"Not Required \";\n\n                break;\n            }\n\n          return returned;\n        }\n\n\n        $scope.get_human_status = function(status){\n\n            var returned;\n            switch(status){\n                case 'issued':\n            \n                  returned = \"Created\";\n\n              break;\n\n              case 'toaviate_ready':\n            \n                  returned = \"Requesting\";\n\n              break;\n\n              case 'pending_submission':\n                  \n                    returned = \"Requesting\";\n\n              break;\n\n              case 'submitted':\n                    \n                    returned = \"Requested\";\n\n              break;\n\n              case 'confirmed':\n                    \n                    returned = \"Paid\";\n\n              break;\n\n              case 'paid_out':\n                    returned = \"Paid\";\n\n              break;\n\n              case 'paid':\n                    returned = \"Paid\";\n\n              break;\n\n              case 'failed':\n                    returned = \"Failed\";\n\n              break;\n\n              case 'charged_back':\n                    returned = \"Charged Back\";\n\n              break;\n              default:\n                  returned = status;\n              break\n            }\n\n            return returned;\n\n        }\n\n     \n        $scope.downloadDocument = function(doc) {\n            var data = $.param({\n                id: doc\n            });\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('/api/v1/plane_documents/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        $scope.downloadInvoice = function(id) {\n            // var data = $.param({\n            //     id: doc\n            // });\n\n            //var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/invoice_pdf/get_ad_hoc_invoice/'+id, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        function processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], {\n                    type: contentType\n                });\n                if (navigator.msSaveBlob)\n                    navigator.msSaveBlob(blob, filename);\n                else {\n                    // Try using other saveBlob implementations, if available\n                    var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                    if (saveBlob === undefined) throw \"Not supported\";\n                    saveBlob(blob, filename);\n                }\n                success = true;\n            } catch (ex) {\n                $log.info(\"saveBlob method failed with the following exception:\");\n                $log.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            $log.info(\"Download link method with simulated click failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n\n      \n\n\n\n    }\napp.controller('ArtpiecesController', ArtpiecesController);\n \n    ArtpiecesController.$inject = ['UserService', 'CategoryService', 'ArtpiecesService', '$location', '$rootScope', 'FlashService', '$routeParams', '$scope', 'ToastService'];\n    function ArtpiecesController(UserService, CategoryService, ArtpiecesService, $location, $rootScope, FlashService, $routeParams, $scope, ToastService) {\n        var vm = this;\n        vm.artpiece = {};\n        vm.artpiece.categories = [];\n\n\n        //for the VIEW page\n\n        CategoryService.GetAll()\n                .then(function (data) {\n                    vm.categories = data;\n\n                    //If we are loading the edit page - let's get specific information that may be useful for the update! :-)\n                    if($routeParams.artpieceId !== \"\"){\n                    \t//for the edit page -- get the one\n\t\t\t\t\t\tArtpiecesService.GetById($routeParams.artpieceId)\n\t\t\t\t        \t\t.then(function (data){\n\t\t\t\t        \t\t\tvm.artpiece = data;\n\t\t\t\t        \t\t\tif(vm.artpiece.categories){\n\t\t\t\t\t        \t\t\t//console.log(vm.artpiece.categories);\n\t\t\t\t\t        \t\t\t// vm.artpiece.categories = JSON.parse(vm.artpiece.categories);\n\t\t\t\t\t        \t\t\t//console.log(\"FOR\");\n\t\t\t\t\t        \t\t\tfor(var i = 0; i < vm.artpiece.categories.length; i++){\n\t\t\t\t\t        \t\t\t\t//console.log(\"BOO\");\n\t\t\t\t\t        \t\t\t\t//console.log(vm.artpiece.categories[i]);\n\t\t\t\t\t        \t\t\t\t//remove from the dropdown the items already in the project\n\t\t\t\t\t        \t\t\t\tvm.categories = $.grep(vm.categories, function(e){ \n\t\t\t\t\t\t\t\t\t\t\t\treturn e.id != vm.artpiece.categories[i][\"category_id\"]; \n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t        \t\t\t\n\t\t\t\t\t        \t\t\t}\n\t\t\t\t\t        \t\t}\n\t\t\t\t        \t\t});\n                    }\n\n                });\n\n        ArtpiecesService.GetAll()\n        \t\t.then(function (data){\n        \t\t\tvm.artpieces = data;\n        \t\t});\n\n       \n\t\t$scope.tempAddCategory = function(data){\n\t\t\tvar category = JSON.parse(data);\n\t\t\t//console.log('add category_id : '+category.id);\n\t\t\tvm.artpiece.categories.push(category);\n\t\t\t//updating the select dropdown\n\t\t\tvm.categories = $.grep(vm.categories, function(e){ \n\t\t\t\treturn e.id != category.id; \n\t\t\t});\n\t\t}\n\n\t\t$scope.tempDeleteCategory = function(cat){\n\t\t\tvm.artpiece.categories = $.grep(vm.artpiece.categories, function(e){ \n\t\t\t\t\t     return e.id != cat.id; \n\t\t\t\t\t});\n\t\t\tvm.categories.push(cat);\n\t\t}\n\n\t\t$scope.AddCategory = function(data){\n\n\t\t\tvar category = JSON.parse(data);\n\t\t\t//console.log('add category_id : '+category.id);\n\n\t\t\tArtpiecesService.AddCategory( {\"category_id\": category.id, \"artpiece_id\": vm.artpiece.id} )\n        \t\t.then(function (data){\n        \t\t\n\t\t\t\t\tvm.artpiece.categories.push(category);\n\t\t\t\t\t//updating the select dropdown\n\t\t\t\t\tvm.categories = $.grep(vm.categories, function(e){ \n\t\t\t\t\t\treturn e.id != category.id; \n\t\t\t\t\t});\n\t\t\t});\n\n\t\t}\n\n\t\t$scope.DeleteCategory = function(category){\n\t\t\t//console.log(category);\n\t\t\tArtpiecesService.DeleteCategory({\"category_id\": category.category_id, \"artpiece_id\": vm.artpiece.id})\n        \t\t.then(function (data){\n\t\t\t\t\tvm.artpiece.categories = $.grep(vm.artpiece.categories, function(e){ \n\t\t\t\t\t     return e.id != category.id;\n\t\t\t\t\t});\n\t\t\t\t\tvm.categories.push(category);\n\t\t\t\t});\n\n\t\t}\n\n\t\t$scope.addArtpiece = function(){\n\t\t\t//  Pre-submit validation \n\t\t\tif (!vm.artpiece.title || vm.artpiece.title.trim() === '') {\n\t\t\t\tToastService.highlightField('artpiece_title');\n\t\t\t\tToastService.warning('Title Required', 'Please enter a title for the artpiece.');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tArtpiecesService.Create(vm.artpiece)\n                .then(function (data) {\n                    if (data.success !== false) {\n                        ToastService.success('Artpiece Created', 'Your artpiece has been added.');\n                        $location.path(\"/artpieces\");\n                        vm.artpiece = {};\n                    } else {\n                        ToastService.error('Create Failed', data.message || 'Something went wrong.');\n                    }\n                });\n\t\t}\n\n\t\t$scope.editArtpiece = function(){\n\t\t\tif (!vm.artpiece.title || vm.artpiece.title.trim() === '') {\n\t\t\t\tToastService.highlightField('artpiece_title');\n\t\t\t\tToastService.warning('Title Required', 'Please enter a title for the artpiece.');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tArtpiecesService.Update(vm.artpiece)\n                .then(function (data) {\n                    if (data.success !== false) {\n                        ToastService.success('Artpiece Updated', 'Your changes have been saved.');\n                        $location.path(\"/artpieces\");\n                        vm.artpiece = {};\n                    } else {\n                        ToastService.error('Update Failed', data.message || 'Something went wrong.');\n                    }\n                });\n\t\t}\n\n\t\t$scope.deleteArtpiece = function(id){\n\t\t\t//console.log(\"GET HERE \"+id);\n\t\t\tArtpiecesService.Delete(id)\n                .then(function (data) {\n                    vm.artpieces = $.grep(vm.artpieces, function(e){ \n\t\t\t\t\t     return e.id != id; \n\t\t\t\t\t});\n                });\n\t\t}\n\n\t\t$scope.addCategory = function(){\n\t\t\t//console.log(\"ADD ONE \"+vm.new_category);\n\n\t\t\t//need to call the outside world here and now :0\n\t\t\tvar add_one = {\"title\": vm.new_category};\n\t\t\tCategoryService.Create(add_one)\n                .then(function (data) {\n                    vm.cats.push(data);\n                    //reset\n\t\t\t\t\tvm.new_category = \"\";\n                });\n\t\t}\n\n\n\n\t\t$scope.deleteCategory = function(id){\n\t\t\tCategoryService.Delete(id)\n                .then(function (data) {\n\n                    vm.cats = $.grep(vm.cats, function(e){ \n\t\t\t\t\t     return e.id != id; \n\t\t\t\t\t});\n\n                });\n\t\t}\n\n\n\n\n\n        //update on edit?\n  //      \tvm.myModel = 'Click here and delete me';\n\t\t// $scope.myUpdateHandler = function(id, category){\n\t\t//   // check your console\n\t\t//   //console.log('value of '+id+' your model is now: ' + category);\n\t\t//   var update = {\"id\": id, \"title\": category};\n\t\t//   CategoryService.Update(update)\n  //               .then(function (data) {\n  //                   //console.log(\"SAVED :)\");\n  //               });\n\t\t// };\n\n    }\n app.controller('BookinController', BookinController);\n\n    BookinController.$inject = ['$sce', 'UserService', 'MemberService', 'FoxService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$interval', '$timeout', 'uiCalendarConfig', 'BookingService', 'LicenceService', 'BookoutService', '$filter', 'PlaneService', 'InstructorCharges', 'PaymentService', 'InvoicesService', 'PackageService', 'CourseService', '$anchorScroll', 'smoothScroll', 'EnvConfig', 'ToastService'];\n    function BookinController($sce, UserService, MemberService, FoxService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $interval, $timeout, uiCalendarConfig, BookingService, LicenceService, BookoutService, $filter, PlaneService, InstructorCharges, PaymentService, InvoicesService, PackageService, CourseService, $anchorScroll, smoothScroll, EnvConfig, ToastService) {\n        \n        var vm = this;\n\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n        //this club ID needs to reflect the club that has been selected....\n        vm.club_id = 0;\n        vm.booking = {};\n\n        //base location to sort the airfields below\n        vm.wgs_n = \"51.51\";\n        vm.wgs_e = \"0.12\";\n\n        vm.split_flight = 0;\n        vm.show_takeoff_landing_times = false;\n\n        vm.change_booking = {};\n        vm.show_change_plane = false;\n        //we need to get the booking ID to pull as much data as we can!\n\n        vm.bookout = {\n            start: true,\n            passengers: [],\n            pic: {\n                id: vm.user_id\n            },\n            plane: {}\n        };\n\n        vm.this_pls_id_raw = 0;\n\n        vm.instructors = [];\n        vm.pics = [];\n        vm.instructor_charges = []; \n        vm.club_courses = [];      \n\n        vm.can_authorise = false;\n\n        vm.dateFormat = 'date:HH:mm \\'on\\' dd/MM/yyyy';\n        var setting_new_member;\n\n        vm.flight_times_complete = false;\n        vm.calculated_invoice = false;\n\n        vm.show_loading = true;\n\n        vm.reported_defects = [];\n\n        vm.scroll = true;\n\n        vm.previous_invoice;\n\n        vm.defect_severity;\n        vm.defect_severities = [\n            { title: \"No Fly Item - Ground the plane\"},\n            { title: \"Flyable - needs to be checked at next maintenance\"},\n            { title: \"Not urgent - but needs noting\"},\n            { title: \"Unsure of severity\"}\n        ];  \n\n\n        vm.claim_a_flight = [];\n        vm.claimed_flight = {};\n        vm.auto_claim = 0;\n        vm.ignore_next_tuition_change = false;\n\n        vm.get_currency = function(iso_code){\n\n\n           return $.grep(vm.currencies, function(e){ \n                        return e.iso_code == iso_code; \n                    })[0];\n\n        }\n\n        $scope.get_airfields = function(name){\n\n            if(name.length > 2 && name.length < 5){\n\n                 BookoutService.GetAirfieldsByCode(name)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //use GB airfields first...\n                        vm.airfields = data.airfields;\n                       \n                         if(vm.airfields.length == 0){\n                            //console.log(\"SETTINGS HERE\");\n                               vm.airfields = [\n                                    {\n                                        id:0,\n                                        title: \"NOT LISTED : \"+ name,\n                                        code: \"ZZZZ\",\n                                        wgs_n: \"0\",\n                                        wgs_e: \"0\"\n                                    }];\n                        }\n\n                    } else {\n\n\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n            }\n\n            if(name.length > 4){\n                var code = name.replace(/\\s/g, \"_\");\n                BookoutService.GetAirfields(code)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //use GB airfields first...\n                        vm.airfields = data.airfields;\n\n\n                        if(vm.airfields.length == 0){\n                            //console.log(\"SETTINGS HERE\");\n                               vm.airfields = [\n                                    {\n                                        id:0,\n                                        title: \"NOT LISTED : \"+ name,\n                                        code: \"ZZZZ\",\n                                        wgs_n: \"0\",\n                                        wgs_e: \"0\"\n                                    }];\n                        }\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n            }\n        }\n        vm.original_bookout = {};\n        $scope.reset_claim_my_flight = function(){\n            //console.log(\"RESET CLAIM\");\n            vm.bookout = vm.original_bookout;\n            vm.different_date_warning = false; \n            vm.claimed_flight = {};\n            vm.calculate_invoice_for_flight();\n            vm.flight_times_complete = false;\n        }\n\n        vm.different_date_warning = false;\n        vm.has_used_claimed_flight = false;\n\n\n        var iconBank = '<svg viewBox=\"0 0 24 24\"><path d=\"M3 10h18M4 10V8l8-5 8 5v2M5 10v8M9 10v8M15 10v8M19 10v8M3 18h18M2 20h20\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        var iconCard = '<svg viewBox=\"0 0 24 24\"><rect x=\"2\" y=\"4\" width=\"20\" height=\"16\" rx=\"2\" ry=\"2\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><path d=\"M2 9h20M6 14h6\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        var iconNew  = '<svg viewBox=\"0 0 24 24\"><circle cx=\"12\" cy=\"12\" r=\"9\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><path d=\"M12 8v8M8 12h8\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        var iconTerm = '<svg viewBox=\"0 0 24 24\"><rect x=\"6\" y=\"2\" width=\"12\" height=\"14\" rx=\"2\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><rect x=\"8\" y=\"5\" width=\"8\" height=\"3\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><rect x=\"9\" y=\"10\" width=\"6\" height=\"3\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        \n        //direct-debit, saved-card, new-card, card-machine\n        vm.donConfirm = function(methodLabel, paymentIntent){\n            console.log(\"confirmation is called\", methodLabel);\n            console.log(\"paymentIntent\", paymentIntent);\n            //alert('Parent received D confirmation: ' + methodLabel);\n            //vm.book_in_flight(methodLabel, paymentIntent);\n\n            var where_to = \"home\";\n\n            if(vm.user.id !== vm.bookout.payer_id && (vm.user.id == vm.bookout.pic_id || vm.user.id == vm.bookout.instructor_id)){\n                //person booking in is the instructor - lets go to debrief:\n                where_to = \"debrief\";\n            } else if(vm.split_flight_confirmation == 1){\n               // where_to = \"split\"; - i dont think we get here\n            } \n\n            // else if(vm.can_authorise){\n            //    card-machine option?\n            //}\n\n\n            //where_to : home, next, split, debrief\n\n            vm.book_in_flight(where_to, methodLabel, paymentIntent);\n        };\n\n\n        vm.default_payment = 'direct-debit';\n\n        vm.methods = [\n            { id: 'direct-debit', title: 'Direct Debit', subtitle: 'Use your BACS mandate', type: 'direct-debit', iconSvg: $sce.trustAsHtml(iconBank), visible: true },\n            { id: 'saved-card',   title: 'Saved card',   subtitle: 'Use a card on file',    type: 'saved-card',  iconSvg: $sce.trustAsHtml(iconCard), visible: true },\n            { id: 'new-card',     title: 'New card',     subtitle: 'Add a new debit/credit card', type: 'new-card', iconSvg: $sce.trustAsHtml(iconNew), visible: true },\n            { id: 'card-machine', title: 'Card Machine', subtitle: 'Pay in person',          type: 'card-machine', iconSvg: $sce.trustAsHtml(iconTerm), visible: true }\n          ];\n\n          // vm.expandedId = 'direct-debit';\n          // vm.selectedId = 'direct-debit';\n          vm.savedCards = [\n         \n          ];\n\n        \n        $scope.claim_my_flight = function(force = false){\n            // console.log(\"CLAIM MY FLGIHT PLEASE!!\");\n            // console.log(\"CAIMING\", vm.claimed_flight);\n\n            if(vm.bookout.flight_date !== vm.claimed_flight.flight_date && force === false){\n                ToastService.warning('Date Mismatch', 'The bookout date and the flight you are claiming do not match - are you absolutely sure that this is your flight?');\n                vm.different_date_warning = true;\n                return false;\n            }\n\n            if(vm.this_claim_was_instructional == true){\n                vm.this_was_instructional_claim();\n            }\n\n            vm.this_pls_id_raw = Object.assign({}, vm.bookout);\n            console.log(\"vm.this_pls_id_raw\", vm.this_pls_id_raw);\n\n            vm.has_used_claimed_flight = true;\n\n            vm.bookout.from_airfield = vm.claimed_flight.from_airport;\n            vm.bookout.to_airfield = vm.claimed_flight.to_airport;\n\n            if(vm.claimed_flight.from_airport.id == vm.claimed_flight.to_airport.id){\n                if(vm.claimed_flight.touch_and_go > 2){\n                    // circuits 3?\n                    var selected_detail_type = vm.flight_types.find(item => item.id === 3);\n                    vm.bookout.flight_type = selected_detail_type;\n                } else {\n                    //local flight? 1 \n                    var selected_detail_type = vm.flight_types.find(item => item.id === 1);\n                    vm.bookout.flight_type = selected_detail_type;\n                }\n\n            } else {\n                var selected_detail_type = vm.flight_types.find(item => item.id === 2);\n                vm.bookout.flight_type = selected_detail_type;\n            }\n            \n            vm.bookout.flight_date = vm.claimed_flight.flight_date;\n\n            vm.bookout.brakes_off_rounded =  vm.claimed_flight.brakes_off_rounded;\n            vm.bookout.brakes_on_rounded = vm.claimed_flight.brakes_on_rounded;\n\n            vm.bookout.brakes_off = {time: vm.claimed_flight.brakes_off};\n            vm.bookout.brakes_on = {time: vm.claimed_flight.brakes_on};\n\n            vm.bookout.touch_and_go = vm.claimed_flight.touch_and_go;\n            vm.bookout.landings = vm.claimed_flight.full_stop_landings;\n            \n            vm.bookout.stops = vm.claimed_flight.stops;\n\n            vm.bookout.fox_log_id = vm.claimed_flight.fox_log_id;\n            vm.bookout.fox_claimed = 1;\n\n            vm.bookout.takeoff_time = vm.claimed_flight.takeoff_time;\n            vm.bookout.landing_time = vm.claimed_flight.landing_time;\n\n\n            vm.bookout.takeoff_rounded = vm.claimed_flight.takeoff_rounded;\n            vm.bookout.landing_rounded = vm.claimed_flight.landing_rounded;\n            //console.log(\"TAKEOFF TIME HERE : \", vm.bookout.takeoff_time);\n\n            //THIS IS THE KEY HERE delete this one once selected / complete\n            vm.bookout.claimed_fox_plane_log_sheet_id = vm.claimed_flight.id;\n\n\n            //set the important bits for the invoice now\n            vm.flight_units.brakes_to_brakes = vm.claimed_flight.brakes_time;\n            vm.flight_units.airborne_times = vm.claimed_flight.airborne_time;\n            vm.flight_units.flight_time = vm.claimed_flight.flight_time;\n            vm.flight_units.brakes_times_rounded = vm.bookout.brakes_times_rounded;\n            \n            //calculate the invoice yay\n            vm.calculate_invoice_for_flight();\n            vm.flight_times_complete = true;\n\n            if(vm.bookout.plane_charges.charge_type == \"tacho\" || vm.bookout.plane_charges.charge_type == \"hobbs\"){\n                //alert(\"Charges are based on tacho - please enter the final tacho number!\");\n                //scroll to the the correct bit?\n            }\n\n            console.log(\"BOOKING : \", vm.bookout.booking_id);\n            console.log(\"PLS ID : \", vm.bookout.id);\n        }\n\n\n        $scope.update_pic = function(){\n            // //console.log(\"--> \", vm.user.id);\n            // //console.log(\"--> \", vm.bookout.instructor_id);\n            // //console.log(\"--> \", vm.bookout.pic.user_id);\n\n            // if(vm.bookout.pic.user_id == vm.bookout.user_id){\n            //     //user is P1\n            //     var selected_pic = vm.pics.find(item => item.user_id === vm.bookout.pic.user_id);\n            //     vm.bookout.pic = selected_pic;\n            //     vm.bookout.pic_id = vm.bookout.pic.user_id;\n            // }\n\n            // if(vm.bookout.pic.user_id == vm.bookout.instructor_id){\n            //     //instructor is P1\n            //     var selected_put = vm.pics.find(item => item.user_id === vm.bookout.user_id);\n            //     vm.bookout.put = selected_put;\n            // }\n\n            var selected_pic = vm.pics.find(item => item.user_id === vm.bookout.pic.user_id);\n            vm.bookout.pic = selected_pic;\n            vm.bookout.pic_id = vm.bookout.pic.user_id;\n            // console.log(\"INSTRUCTION;:\", vm.this_claim_was_instructional);\n\n            if(!vm.this_claim_was_instructional || vm.this_claim_was_instructional == false){\n                // console.log(\"yagh\");\n                PackageService.GetPackagesByUserId(vm.bookout.pic_id)\n                .then(function (data) {\n                // IF IT HAS A PACKAGE ID --> THEN WE NEED TO CHECK IT PUT THE CORRECT PAYMENT INFORMATION THERE\n                    //console.log(\"BOOKOUT PACKAGE\", data);\n                    //console.log(\"BOOKOUT PACKAGE\", data.packages);\n                    vm.packages = data.items;\n\n                    PlaneService.GetUpdatedCharges(vm.bookout.club_id, vm.bookout.plane_id, vm.bookout.pic_id)\n                    .then(function (data) {\n                            ////console.log(\"data is : \", data);\n                            vm.bookout.plane_charges = data.plane_charges;\n\n\n                            vm.bookout.put_id = 0;\n                            vm.bookout.put = {};\n                            vm.bookout.instructor_id = 0;\n                            if(vm.bookout.pic_id > 0){\n                                vm.bookout.payer_id = vm.bookout.pic_id;\n                            } else if(vm.bookout.user_id > 0) {\n                                vm.bookout.payer_id = vm.bookout.pic_id;\n                            } else {\n                                //alert(\"It appears that no payer ID has been set yet.\");\n                            }\n\n\n                            vm.calculate_invoice_for_flight();\n                            // console.log(\"calc?\");\n                    });\n\n                });\n\n\n                \n\n            } else {\n                console.log(\"before change - this was instructional\");\n                if(vm.bookout.pic.instructor == 1){\n\n                } else {\n                    vm.this_claim_was_instructional = false;\n                    vm.bookout.put_id = 0;\n                    vm.bookout.put = {};\n                    vm.bookout.instructor_id = 0;\n                    if(vm.bookout.pic_id > 0){\n                        vm.bookout.payer_id = vm.bookout.pic_id;\n                    } else if(vm.bookout.user_id > 0) {\n                        vm.bookout.payer_id = vm.bookout.pic_id;\n                    } else {\n                        //alert(\"It appears that no payer ID has been set yet.\");\n                    }\n                    vm.calculate_invoice_for_flight();\n                }\n               \n            }\n            \n            vm.complete_flight = false;\n\n            if(vm.bookout.pic.user_id == vm.user.id){\n                vm.can_authorise = false;\n            }\n\n            if(!vm.bookout.booking || vm.bookout.booking.user_id == 0 || vm.bookout.user_id == 0){\n                vm.bookout.user_id = vm.bookout.pic.user_id;\n            }\n\n\n            if(vm.bookout.put_id == 0 && vm.bookout.instructor_id == 0){\n                // console.log(\"TRYING HERE ==> \", vm.bookout.pic_id);\n                // console.log(\"TRYING TWO ==> \", vm.bookout.payer_id);\n                vm.bookout.payer_id = vm.bookout.pic_id;\n                // console.log(\"TRYING THREE ==> \", vm.bookout.payer_id);\n            } else {\n                // console.log(\"TRYING PUT ID ==> \", vm.bookout.put_id);\n                // console.log(\"INSTRUCTOR ID ==> \", vm.bookout.instructor_id);\n\n            }\n\n             if(vm.bookout.payer_id == 0){\n                // console.log(\"PAYER ID = 0\");\n                //vm.bookout.payer_id = vm.bookout.pic_id;\n            }\n\n\n\n\n            if(vm.complete_flight){\n                vm.complete_this_flight();\n            }\n\n            // if(vm.bookout.pic.user_id == vm.user.id && vm.bookout.instructor_id > 0){\n            //     //console.log(\"okay... so you want the instructor to be put? interesting...\");\n            //     //adheres to booking\n\n            // } else if(vm.bookout.instructor_id > 0 && vm.bookout.pic.user_id == vm.bookout.instructor_id) {\n            //     //console.log(\"okay so you now have your booked instructor as the PIC again - nice\");\n            //     //adheres to booking\n\n            // } else {\n            //     //console.log(\"you've change instructor? what happened?\");\n            //     //availability has been checked hence we're OK\n\n            // }\n\n\n        }\n\n        $scope.update_put = function(){\n            // //console.log(\"--> \", vm.user.id);\n            // //console.log(\"--> \", vm.bookout.instructor_id);\n            // //console.log(\"--> \", vm.bookout.pic.user_id);\n            if(vm.bookout.put.user_id == vm.bookout.pic.user_id){\n                ToastService.warning('Selection Error', 'Please select a different PIC to the PUT');\n                vm.bookout.put = {};\n                return false;\n            }\n\n            vm.complete_flight = false;\n            \n            var selected_put = vm.pics.find(item => item.user_id === vm.bookout.put.user_id);\n            vm.bookout.put = selected_put;\n\n            vm.bookout.put_id = selected_put.user_id;\n\n\n            if(vm.bookout.put_id > 0){\n                vm.bookout.instructor_id = vm.bookout.pic_id;\n\n                vm.bookout.instructor = vm.bookout.pic;\n\n                console.log(\"FI: \", vm.bookout.instructor);\n                console.log(\"instructor_id: \", vm.bookout.instructor_id);\n\n                $scope.update_pic();\n\n            }\n\n\n\n            PackageService.GetPackagesByUserId(vm.bookout.put_id)\n            .then(function (data) {\n            // IF IT HAS A PACKAGE ID --> THEN WE NEED TO CHECK IT PUT THE CORRECT PAYMENT INFORMATION THERE\n                //console.log(\"BOOKOUT PACKAGE\", data);\n                //console.log(\"BOOKOUT PACKAGE\", data.packages);\n                vm.packages = data.items;\n                PlaneService.GetUpdatedCharges(vm.bookout.club_id, vm.bookout.plane_id, vm.bookout.put_id)\n                    .then(function (data) {\n                            ////console.log(\"data is : \", data);\n                            vm.bookout.plane_charges = data.plane_charges;\n                            vm.calculate_invoice_for_flight();\n                    });\n            });\n\n            // if(vm.bookout.put_id > 0){\n            //     vm.bookout.payer_id = vm.bookout.put_id;\n            // }\n\n\n            if(vm.bookout.pic_id !== 0 && vm.bookout.pic_id !== vm.bookout.instructor_id){\n                vm.bookout.payer_id = vm.bookout.pic_id; //PIC is student supervised or otherwise solo\n            } else if((vm.bookout.instructor_id > 0 && vm.bookout.put_id > 0) || vm.bookout.instructor_id > 0 && vm.bookout.user_id > 0){\n                vm.bookout.payer_id = (vm.bookout.put_id > 0)? vm.bookout.put_id : vm.bookout.user_id; //put always pays\n            } else if(vm.bookout.put_id > 0){\n                vm.bookout.payer_id = vm.bookout.put_id;\n            } else if(vm.bookout.put_id == 0 && vm.bookout.user_id == 0){\n                vm.bookout.payer_id = vm.bookout.pic_id;\n            } else {\n                if(vm.bookout.instructor_id == 0){\n                    vm.bookout.payer_id = vm.bookout.pic_id;\n                }\n                if(vm.bookout.payer_id == 0){\n                    ToastService.warning('Payer Required', 'Please select a student or person paying for this flight');\n                }\n            }\n\n\n            \n            if(vm.complete_flight){\n                vm.complete_this_flight();\n            }\n\n            // if(vm.bookout.put.user_id == vm.bookout.user_id){\n            //     //user is P1\n            //     var selected_put = vm.pics.find(item => item.user_id === vm.bookout.put.user_id);\n            //     vm.bookout.put = selected_put;\n            // }\n\n            // if(vm.bookout.put.user_id == vm.bookout.instructor_id){\n            //     //instructor is P1\n            //     var selected_put = vm.pics.find(item => item.user_id === vm.bookout.user_id);\n            //     vm.bookout.put = selected_put;\n            // }\n\n\n            // if(vm.bookout.pic.user_id == vm.user.id && vm.bookout.instructor_id > 0){\n            //     //console.log(\"okay... so you want the instructor to be put? interesting...\");\n            //     //adheres to booking\n\n            // } else if(vm.bookout.instructor_id > 0 && vm.bookout.pic.user_id == vm.bookout.instructor_id) {\n            //     //console.log(\"okay so you now have your booked instructor as the PIC again - nice\");\n            //     //adheres to booking\n\n            // } else {\n            //     //console.log(\"you've change instructor? what happened?\");\n            //     //availability has been checked hence we're OK\n\n            // }\n        }\n\n        $scope.update_instructor = function(){\n            // //console.log(\"--> \", vm.user.id);\n            // //console.log(\"--> \", vm.bookout.instructor_id);\n            // //console.log(\"--> \", vm.bookout.pic.user_id);\n            \n            var selected_instructor = vm.instructors.find(item => item.user_id === vm.bookout.instructor.user_id);\n            \n            //console.log(\"INSTRUCTOR UPDATE: \", selected_instructor);\n\n            if(selected_instructor && selected_instructor.user_id > 0){\n                vm.bookout.instructor = selected_instructor;\n                vm.bookout.instructor_id = selected_instructor.user_id;\n                if(vm.bookout.pic_id !== 0 && vm.bookout.pic_id !== vm.bookout.instructor_id){\n                    vm.bookout.payer_id = vm.bookout.pic_id; //PIC is student supervised or otherwise solo\n                } else if((vm.bookout.instructor_id > 0 && vm.bookout.put_id > 0) || vm.bookout.instructor_id > 0 && vm.bookout.user_id > 0){\n                    vm.bookout.payer_id = (vm.bookout.put_id > 0)? vm.bookout.put_id : vm.bookout.user_id; //put always pays\n                } else if(vm.bookout.put_id > 0){\n                    vm.bookout.payer_id = vm.bookout.put_id;\n                } else if(vm.bookout.put_id == 0 && vm.bookout.user_id == 0){\n                    vm.bookout.payer_id = vm.bookout.pic_id;\n                } else {\n                    if(vm.bookout.instructor_id == 0){\n                        vm.bookout.payer_id = vm.bookout.pic_id;\n                    }\n                    if(vm.bookout.payer_id == 0){\n                        ToastService.warning('Payer Required', 'Please select a student or person paying for this flight');\n                    }\n                }\n                // if(vm.bookout.pic_id > 0){\n                //     vm.bookout.payer_id = vm.bookout.pic_id;\n                // }\n            } else {\n                vm.bookout.instructor = {};\n                vm.bookout.instructor_id = 0;\n                vm.bookout.payer_id = vm.bookout.pic_id;\n            }\n\n            if(vm.complete_flight){\n                vm.complete_this_flight();\n            }\n            \n        }\n\n\n        \n\n\n        // the ARRIVAL option should be automatically filled in when there was a departure prior to the flight and home airfield was\n        //entered as the destination\n\n        vm.flight_types = [\n            {\n                id: 1,\n                title: \"Local\"\n            }, \n            {\n                id: 2,\n                title: \"Departure\"\n            },\n            {\n                id: 3,\n                title: \"Circuits\"\n            },\n            {\n                id: 4,\n                title: \"Other\"\n            }\n        ];\n\n\n        vm.biggin_hill = {\n\n            routes: [\n                {\n                    id: 1,\n                    title: \"Kenley\"\n                },\n                {\n                    id: 2,\n                    title: \"Sevenoaks\"\n                },\n                {\n                    id: 3,\n                    title: \"Swanley\"\n                },\n                {\n                    id: 4,\n                    title: \"Other\"\n                }\n            ],\n            parking: \"\"\n\n        }\n\n        vm.flight_rules = [\n            {\n                id: 1,\n                title: \"VFR\"\n            },\n            {\n                id: 2,\n                title: \"IFR\"\n            }\n        ];\n        vm.split_flight_confirmation = 0;\n\n        vm.split_this_flight = function(){\n            vm.split_flight = 1;\n            //add this pls_id to the split\n            var split_send = vm.split_flight_time;\n            split_send.booking_id = vm.bookout.booking_id;\n            split_send.this_pls_id = vm.bookout.id;\n            // console.log(\"split it\");\n            // console.log(\"vm.bookout.id : \", vm.bookout.id);\n            // console.log(\"split_send : \", split_send);\n            PlaneService.HypotheticalFlightSplit(vm.bookout.id, split_send)\n             .then(function (data) {\n                    // console.log(\"data is : \", data);\n                    vm.split_one = data.first_flight;\n                    \n                    vm.split_flight = 1;    \n                    // vm.split_one.brakes_off = {\"time\": vm.split_one.brakes_off};\n                    // vm.split_one.brakes_on = {\"time\": vm.split_one.brakes_on};\n                    vm.split_two = data.second_flight;\n                    vm.split_two.brakes_off = {\"time\": vm.split_two.brakes_off};\n                    vm.split_two.brakes_on = {\"time\": vm.split_two.brakes_on};\n                });\n\n        }\n\n        vm.cancel_split = function(){\n            vm.bookout = vm.original_bookout;\n            vm.split_one = {};\n            vm.split_two = {};\n            vm.split_flight = 0;\n            vm.split_flight_confirmation = 0;\n\n            process_bookout_to_bookin(vm.bookout);\n\n\n        }\n\n        vm.update_split = function(){\n            // console.log(\"we updated the split time hmmm...\");\n            // console.log(vm.split_flight_time);\n            \n            // console.log(\"flight 1\");\n            // console.log(vm.bookout.brakes_off_rounded);\n            // console.log(vm.split_flight_time.time);\n\n            // console.log(\"flight 2\");\n            // console.log(vm.split_flight_time.time);\n            // console.log(vm.bookout.brakes_on_rounded);\n\n            var pls_id = vm.bookout.id; \n            if(!pls_id || pls_id == null || pls_id == 0){\n                //console.log(\"RAW> \", vm.this_pls_id_raw);\n                pls_id = vm.this_pls_id_raw;\n            }\n               // console.log(\"RAWDAWG \", pls_id);\n\n            if(vm.has_used_claimed_flight && vm.claimed_flight.id > 0){\n                //console.log(\"SPLIT FLIGHT CLAIMED\");\n                pls_id = vm.claimed_flight.id;\n            }\n\n            var split_send = vm.split_flight_time;\n            split_send.booking_id = vm.bookout.booking_id;\n            split_send.this_pls_id = vm.bookout.id;\n\n            // console.log(\"split it\");\n            // console.log(\"pls_id : \", pls_id);\n            // console.log(\"split_send : \", split_send);\n\n            //hypothetical_flight_split\n            PlaneService.HypotheticalFlightSplit(pls_id, split_send)\n             .then(function (data) {\n                    console.log(\"data is : \", data);\n                    vm.split_one = data.first_flight;\n                    \n                    vm.split_flight = 1;    \n                    // vm.split_one.brakes_off = {\"time\": vm.split_one.brakes_off};\n                    // vm.split_one.brakes_on = {\"time\": vm.split_one.brakes_on};\n                    vm.split_two = data.second_flight;\n                    vm.split_two.brakes_off = {\"time\": vm.split_two.brakes_off};\n                    vm.split_two.brakes_on = {\"time\": vm.split_two.brakes_on};\n                });\n\n\n        }\n\n        function clean_times(which, start_end, compared_to = null){\n\n            var compare_date;\n\n            // //console.log(\"CLEAN TIMES \" ,which);\n\n\n            var this_date = new Date();\n\n\n            if(vm.bookout && vm.bookout.brakes_off){\n\n                compare_date = new Date(compared_to);\n                var split_time = vm.bookout.brakes_off.time.split(\":\");\n                compare_date.setHours(split_time[0]);\n                compare_date.setMinutes(split_time[1]);\n                compare_date.setSeconds(0);\n\n                this_date = new Date(compared_to);\n                this_date.setHours(0);\n                this_date.setMinutes(0);\n                this_date.setSeconds(0);\n\n            } else {\n                switch(which){\n                    case 'today':\n                        // compare_date = new Date();\n                        compare_date = new Date(\"1990-07-26\");\n\n                    break;\n                    case 'past':\n                        //we need to consider the back-dating as possible issue...\n                        compare_date = new Date(\"1990-07-26\");\n                    break;\n                    case 'future':\n                        compare_date = new Date(\"1990-07-26\");\n                    break;\n                    case 'after':\n                    //differentiate here\n                        compare_date = new Date(compared_to);\n                        this_date = new Date(compared_to);\n                    break;\n                    case 'before':\n                    //differentiate here\n                        compare_date = new Date(compared_to);\n                    break;\n                }\n            }\n\n          \n\n            //console.log(\"THIS DATE\", this_date);\n            //console.log(\"COMPARE DATE\", compare_date);\n\n\n\n            vm[start_end].forEach(function(time, i){\n\n                        //this may very well be the case function here to change when the re-do the times            \n                        var split_time = time.time.split(\":\");\n                        this_date.setHours(split_time[0]);\n                        this_date.setMinutes(split_time[1]);\n                        this_date.setSeconds(0);\n\n\n                        if( moment(this_date).isAfter(moment(compare_date)) ){\n                            vm[start_end][i].disabled = 0;\n                            //we should / could be checking airport opening hours...?\n                            //vm[start_end][i].disabled = check_business_hours(parseInt(split_time[0]), parseInt(split_time[1]), (start_end == \"start_times\")? 1 : 0);\n                        } else {\n                            vm[start_end][i].disabled = 1;\n                        }\n                    });\n\n                //by definition as we are changing something to cause this function from being called - we need to recalculate the times:\n                //calculate_duration();\n\n        }\n\n        vm.start_times = [];\n        vm.all_times = [];\n\n        for(var i=0;i<24;i++){\n\n                for(var j=0; j<(60/5); j++){\n                    var k = 5 * j;\n                    k = ((k < 10) ? '0' : '') + k;\n                    vm.start_times.push({time: i+\":\"+k, disabled: false});\n                }\n\n                for(var j=0; j<(60/10); j++){\n                    var k = 10 * j;\n                    k = ((k < 10) ? '0' : '') + k;\n                    vm.all_times.push({time: i+\":\"+k, disabled: false});\n                }\n           \n\n        }\n        //clean_times('today', 'start_times');\n        clean_times('future', 'all_times');\n\n        // vm.bookout.pic = vm.pics[0];\n        vm.currency_days = 28;\n\n\n        vm.dateTimeRangePickerOptions = {\n                hour_step: 1,\n                minute_step: 30,\n                min_date: new Date(),\n                business_hours: {\n                    from: \"09:00\",\n                    to: \"22:30\"\n                }\n            };\n\n\n         vm.dateTimeRangePickerOptions2 = {\n                hour_step: 1,\n                minute_step: 5,\n                min_date: new Date(),\n                business_hours: {\n                    from: \"00:00\",\n                    to: \"23:55\"\n                }\n            };\n\n            vm.options = {\n                hour_step: 1,\n                minute_step: 5,\n                min_date: new Date(),\n                business_hours: {\n                    from: \"00:00\",\n                    to: \"23:55\"\n                }\n            };\n\n\n\n\n            vm.lubricant_type = [{ title: \"Fuel\"}, {title: \"Oil\"}];\n            vm.who_paid = [{ title: \"Me\"}, {title: \"Club\"}];\n            vm.receipt = {\n                image: \"\",\n                quantity: 0,\n                price: 0,\n                reimbursement: false,\n                item: {title: \"Fuel\"}\n            };\n\n            $scope.processFiles = function(files){\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    files[i].file.temp_path = j.saved_url;\n                    // //console.log(\"file\", files[i].file);\n                    vm.receipt_image = files[i].file;\n                    vm.receipt.image = vm.receipt_image.temp_path;\n                    //console.log(\"IMAGE\", vm.receipt_image);\n                }\n               \n            }\n\n            vm.update_course = function(){\n\n                console.log(\"do we need to update tuition to be offered from this?\");\n                // IF nothing selected --> give ALL OPTIONS\n                if(vm.bookout.course && vm.bookout.course.id > 0){\n\n                    console.log(\"vm.bookout.course\", vm.bookout.course);\n\n                     InstructorCharges.GetByCourseId(vm.bookout.course.id)\n                    .then(function(data){\n                        vm.instructor_charges = data.items;  \n\n                        //check if updates selected tuition received list?\n                        if(vm.instructor_charges.length == 1){\n                            //set this automatically?\n                            vm.bookout.tuition_required = vm.instructor_charges[0];\n                        }\n                         //UPDATE TUITION CHARGES\n                        vm.ignore_next_tuition_change = true;\n                        vm.update_tuition_charges(); //>> is this right?\n                    });\n\n                } else {\n                     InstructorCharges.GetByClubId(vm.bookout.club_id)\n                    .then(function(data){\n                        vm.instructor_charges = data.items;  \n\n                        //check if updates selected tuition received list?\n                        if(vm.instructor_charges.length == 1){\n                            //set this automatically?\n                            vm.bookout.tuition_required = vm.instructor_charges[0];\n                        }\n                         //UPDATE TUITION CHARGES\n                        vm.ignore_next_tuition_change = true;\n                        vm.update_tuition_charges(); //>> is this right?\n\n                    });\n                }\n                // InstructorCharges.GetByClubId(booking.club_id)\n                // .then(function(data){\n                //     vm.instructor_charges = data.items;  \n                // });\n\n                // IF course is selected --> GIVE ONLY THAT COURSE OPTION\n\n\n               \n\n\n\n            }\n\n            vm.update_tuition_charges = function(){\n\n                if(vm.bookout.tuition_required && vm.bookout.tuition_required.id > 0){\n\n\n                    InstructorCharges.GetUpdatedCharges(vm.bookout.tuition_required.id)\n                    .then(function (data) {\n                        //console.log(\"data is : \", data);\n\n                        vm.bookout.tuition_charges = data.tuition_charges;\n                        vm.bookout.tuition_required = data.tuition_required;\n                        vm.bookout.tuition_id = data.tuition_required.id;\n                        console.log(\"tuition charges: \", vm.bookout);\n                        vm.calculate_invoice_for_flight();\n\n                        if(vm.complete_flight){\n                            vm.complete_this_flight();\n                        }\n                        vm.ignore_next_tuition_change = false;\n                    });\n\n                } else {\n                    if(!vm.ignore_next_tuition_change){\n                        if(vm.bookout.instructor_id > 0){\n                            ToastService.warning('Tuition Required', 'Please select a tuition type for this flight.');\n                        }\n                        vm.ignore_next_tuition_change = false;\n                    }\n                    \n                }\n\n\n            }\n\n            vm.delete_receipt = function(id){\n\n                 PlaneService.DeleteReceipt(id)\n                .then(function (rcpt) {\n\n                    PlaneService.GetAllSheetReceipts(vm.bookout.id)\n                    .then(function (data) {\n                        ////console.log(\"data is : \", data);\n                        vm.lubricant_receipts = data;\n                        vm.calculate_invoice_for_flight();\n\n                    });\n\n                });\n            }\n\n\n            vm.check_reimbursement = function(){\n\n                if(vm.receipt.price < 0.01 || vm.receipt.currency == \"\"){\n                    return false;\n                }\n\n                var obj = {\n                    price: vm.receipt.price,\n                    currency: vm.receipt.currency.iso_code,\n                    club_id: vm.bookout.club_id\n                }\n\n                PlaneService.CheckReimbursement(obj)\n                    .then(function (data) {\n                        //console.log(\"conversion\", data);\n\n                        vm.receipt.reimbursed_amount = data.reimburse.reimbursed_amount;\n                        vm.receipt.reimbursed_currency = data.reimburse.reimbursed_currency;\n                        vm.receipt.reimbursed_rate = data.reimburse.rate;\n                        vm.receipt.reimbursed_datetime = data.reimburse.datetime;\n\n\n                    });\n\n\n            }\n\n\n            vm.add_receipt = function(){\n\n                if(vm.receipt.reimbursement && !vm.receipt.image){\n                    ToastService.warning('Receipt Required', 'You must upload a copy of your receipt if you wish to be reimbursed.');\n                    return false;\n                }\n\n                var obj = {\n                    plane_id: vm.bookout.plane_id,\n                    club_id: vm.bookout.club_id,\n                    user_id: vm.user.id,\n                    plane_log_sheet_id: vm.bookout.id,\n                    reimbursement: vm.receipt.reimbursement,\n                    image: vm.receipt.image,\n                    currency: vm.receipt.currency.iso_code,\n                    item: vm.receipt.item.title,\n                    quantity: vm.receipt.quantity,\n                    price: vm.receipt.price\n                }\n\n                //console.log(\"OBJ TO SEND: \", obj);\n\n\n                PlaneService.AddReceipt(obj)\n                .then(function (rcpt) {\n                            //console.log(\"RECEIPTS\", rcpt);          \n                            vm.lubricant_receipts.push(rcpt.item);\n\n\n                            //clear the uploaded items...\n                            vm.receipt = {\n                                image: \"\",\n                                quantity: 0,\n                                price: 0,\n                                reimbursement: false,\n                                item: {title: \"Fuel\"}\n                            };\n\n                            vm.calculate_invoice_for_flight();\n\n                });\n\n\n            }\n\n            /* ADD OR EDIT THE BOOKING */\n\n            function check_business_hours(i, k = null, start = 0){\n            //i is hours\n            //k is minutes\n            k = parseInt(k);\n            i = parseInt(i);\n\n            var this_step_disabled = 0; \n            if(vm.options.business_hours){\n                var split = vm.options.business_hours.from.split(\":\");\n                var split2 = vm.options.business_hours.to.split(\":\");\n\n                if(start == 0){\n                    //adjust to match times / end min 1 hour slots\n                   // split2[0] = parseInt(split2[0]) + 1;\n                } else {\n                    split2[0] = parseInt(split2[0]) - 1;\n                }\n\n                if(k || k == 0){\n                    \n                    if(i < parseInt(split[0]) ){\n                        // //console.log(\"we disable because \"+i+\":\"+k+\" is before \"+split.join(\":\") );\n                        this_step_disabled = 1;\n                    } else if(i == parseInt(split[0]) && k < parseInt(split[1])){\n                         // //console.log(\"we disable because \"+i+\":\"+k+\" is before \"+split.join(\":\") );\n                        this_step_disabled = 1;\n                    }\n\n                    // if(i >= parseInt(split2[0]) && k >= parseInt(split2[1]) ){\n                    //     // //console.log(\"we disable because \"+i+\":\"+k+\" is after \"+split2.join(\":\") );\n                    //     this_step_disabled = 1;\n                    // } \n\n\n                    if(i > parseInt(split2[0])){\n                        this_step_disabled = 1; \n                    } else if( i == parseInt(split2[0]) && k > parseInt(split2[1])){\n                        this_step_disabled = 1;\n                    }\n\n\n                } else {\n                    if(parseInt(split[0]) < i){\n                        this_step_disabled = 1;\n                    } \n                    if(parseInt(split2[0]) > i){\n                        this_step_disabled = 1;\n                    } \n                }\n            }\n\n            return this_step_disabled;\n        }\n\n        vm.options = {};\n        vm.start_times = [];\n        vm.end_times = [];\n\n        vm.takeoff_times = [];\n        vm.landing_times = [];\n\n        \n\n\n            function figure_out_steps(){\n                //console.log(\"OPTIONS\", vm.dateTimeRangePickerOptions2);\n                vm.options = vm.dateTimeRangePickerOptions2;\n                 for(var i=0;i<24;i+=vm.options.hour_step){\n\n                    if(vm.options.minute_step && vm.options.minute_step > 0){\n                        for(var j=0; j<(60/vm.options.minute_step); j++){\n                            var k = vm.options.minute_step * j;\n                            k = ((k < 10) ? '0' : '') + k;\n                            vm.start_times.push({time: i+\":\"+k, disabled: check_business_hours(i, k)});\n                            vm.end_times.push({time: i+\":\"+k, disabled: check_business_hours(i, k), duration: \"\"});\n                        }\n                    } else {\n                        vm.start_times.push({time: i+\":00\", disabled: check_business_hours(i)});\n                        vm.end_times.push({time: i+\":00\", disabled: check_business_hours(i), duration: \"\"});\n                    }\n\n                }\n                // vm.takeoff_times = angular.copy(vm.start_times);\n                // vm.landing_times = angular.copy(vm.end_times);\n                angular.copy(vm.start_times, vm.takeoff_times);\n                angular.copy(vm.end_times, vm.landing_times);\n            }\n\n            function init_times(){\n               for(var i=0;i<24;i+=vm.options.hour_step){\n\n                    if(vm.options.minute_step && vm.options.minute_step > 0){\n                        for(var j=0; j<(60/vm.options.minute_step); j++){\n                            var k = vm.options.minute_step * j;\n                            k = ((k < 10) ? '0' : '') + k;\n                            vm.start_times.push({time: i+\":\"+k, disabled: check_business_hours(i, k)});\n                            vm.end_times.push({time: i+\":\"+k, disabled: check_business_hours(i, k), duration: \"\"});\n                        }\n                    } else {\n                        vm.start_times.push({time: i+\":00\", disabled: check_business_hours(i)});\n                        vm.end_times.push({time: i+\":00\", disabled: check_business_hours(i), duration: \"\"});\n                    }\n\n                } \n                // vm.takeoff_times = angular.copy(vm.start_times);\n                // vm.landing_times = angular.copy(vm.end_times);\n                angular.copy(vm.start_times, vm.takeoff_times);\n                angular.copy(vm.end_times, vm.landing_times);\n            }\n\n            function get_duration_str(seconds){\n                //var seconds = Math.floor(seconds);\n                // //console.log(seconds);\n                // //console.log(moment.duration(seconds));\n                // //console.log(\"days: \"+moment.duration(seconds).days());\n                // //console.log(\"hours: \"+moment.duration(seconds).hours());\n                // //console.log(\"minutes: \"+moment.duration(seconds).minutes());\n\n                var days = moment.duration(seconds).days();\n                var hours = moment.duration(seconds).hours();\n                var minutes = moment.duration(seconds).minutes();\n\n                //occasional issue showing 59 minutes - unsure where but this is a fix for it... think moment() has a bug\n                if(minutes == 59){\n                    hours++;\n                    minutes = 0;\n                }\n\n\n                var string = \"\";\n                if(days > 0){\n                    string = string+\" \"+days+\" day\";\n                    string = (days > 1)? string+\"s\" : string;\n                }\n                if(hours > 0){\n                    string = string+\" \"+hours+\" hour\";\n                    string = (hours > 1)? string+\"s\" : string;\n                }\n                if(minutes > 0){\n                    string = string+\" \"+minutes+\" minute\";\n                    string = (minutes > 1)? string+\"s\" : string;\n                }\n\n                 // //console.log(\"STR : \"+string);\n\n                return string;\n\n            }\n\n            vm.calculate_my_brakes_duration = function(){\n             //   calculate_duration(); //symlink\n                 if(vm.bookout.start_date && vm.bookout.brakes_off){\n                    var start_datetime = new Date(vm.bookout.start_date);\n                    var start_time = vm.bookout.brakes_off.time.split(\":\");\n                    start_datetime.setHours(start_time[0]);\n                    start_datetime.setMinutes(start_time[1]);\n                    start_datetime.setSeconds(0);\n                    // //console.log(\"START DATETIME\", start_datetime);  \n\n                    vm.end_times.forEach(function(time, i){ \n                        //no need to go through each element if its not required to be shown!\n                        if(time.disabled == 0){\n\n                            var end_datetime = new Date(vm.bookout.end_date);\n                            var end_time = time.time.split(\":\");\n                            end_datetime.setHours(end_time[0]);\n                            end_datetime.setMinutes(end_time[1]);  \n                            end_datetime.setSeconds(0);\n                            // //console.log(\"END DATETIME\", end_datetime);  \n\n                            var difference = moment(moment(end_datetime).startOf(\"minute\")).diff(moment(start_datetime).startOf(\"minute\"));\n\n                            //now we need to calculate the difference in datetime\n                            // //console.log(\"d: \"+moment.duration(difference).days()+\" h: \"+moment.duration(difference).hours()+\" m: \"+moment.duration(difference).minutes());\n                            var human_str = get_duration_str(difference);\n\n                           \n\n\n                            // //console.log(\"human string\", human_str);\n                            if(human_str == \"\"){\n                                vm.end_times[i].disabled = 1;\n                                //vm.takeoff_times[i].disabled = 1;\n                            } else {\n                                vm.end_times[i].duration = \"( \"+human_str+\" )\";\n                            }\n\n\n                        } else {\n                            vm.end_times[i].duration = \"\";\n                        }\n                      //if(time.time == moment(future).format(\"H:mm\")){ id = i; return true;}; \n                    });\n\n                    // console.log(\"SELECTED HERE: vm.show_takeoff_landing_times \", vm.show_takeoff_landing_times);\n\n                    if(vm.show_takeoff_landing_times){\n                        //also set the takeoff 5mins after taxi?\n                        //vm.takeoff_times = vm.end_times;\n                        angular.copy(vm.end_times, vm.takeoff_times);\n                        // console.log(\"SELECTED HERE????\", vm.takeoff_times);\n                    }\n\n                }\n            }    \n\n            function calculate_duration(){\n                if(vm.bookout.start_date && vm.bookout.start_time){\n                    var start_datetime = new Date(vm.bookout.start_date);\n                    var start_time = vm.bookout.start_time.time.split(\":\");\n                    start_datetime.setHours(start_time[0]);\n                    start_datetime.setMinutes(start_time[1]);\n                    start_datetime.setSeconds(0);\n                    // //console.log(\"START DATETIME\", start_datetime);  \n\n                    vm.end_times.forEach(function(time, i){ \n                        //no need to go through each element if its not required to be shown!\n                        if(time.disabled == 0){\n\n                            var end_datetime = new Date(vm.bookout.end_date);\n                            var end_time = time.time.split(\":\");\n                            end_datetime.setHours(end_time[0]);\n                            end_datetime.setMinutes(end_time[1]);  \n                            end_datetime.setSeconds(0);\n                            // //console.log(\"END DATETIME\", end_datetime);  \n\n                            var difference = moment(moment(end_datetime).startOf(\"minute\")).diff(moment(start_datetime).startOf(\"minute\"));\n\n                            //now we need to calculate the difference in datetime\n                            // //console.log(\"d: \"+moment.duration(difference).days()+\" h: \"+moment.duration(difference).hours()+\" m: \"+moment.duration(difference).minutes());\n                            var human_str = get_duration_str(difference);\n\n                           \n\n\n                            // //console.log(\"human string\", human_str);\n                            if(human_str == \"\"){\n                                vm.end_times[i].disabled = 1;\n                                //vm.takeoff_times[i].disabled = 1;\n                            } else {\n                                vm.end_times[i].duration = \"( \"+human_str+\" )\";\n                            }\n\n\n                        } else {\n                            vm.end_times[i].duration = \"\";\n                        }\n                      //if(time.time == moment(future).format(\"H:mm\")){ id = i; return true;}; \n                    });\n\n                    //console.log(\"SELECTED HERE: vm.show_takeoff_landing_times \", vm.show_takeoff_landing_times);\n\n                    if(vm.show_takeoff_landing_times){\n                        //also set the takeoff 5mins after taxi?\n                        //vm.takeoff_times = vm.end_times;\n                        angular.copy(vm.end_times, vm.takeoff_times);\n                        //console.log(\"SELECTED HERE????\", vm.takeoff_times);\n                    }\n\n                }\n            }\n\n\n            vm.calculate_airborne_duration = function(){\n                if(vm.bookout.takeoff_time){\n                    var start_datetime = new Date(vm.bookout.start_date);\n                    var start_time = vm.bookout.takeoff_time.time.split(\":\");\n                    start_datetime.setHours(start_time[0]);\n                    start_datetime.setMinutes(start_time[1]);\n                    start_datetime.setSeconds(0);\n                    // //console.log(\"START DATETIME\", start_datetime);  \n\n                    vm.landing_times.forEach(function(time, i){ \n                        //no need to go through each element if its not required to be shown!\n                        if(time.disabled == 0){\n\n                            var end_datetime = new Date(vm.bookout.end_date);\n                            var end_time = time.time.split(\":\");\n                            end_datetime.setHours(end_time[0]);\n                            end_datetime.setMinutes(end_time[1]);  \n                            end_datetime.setSeconds(0);\n                            // //console.log(\"END DATETIME\", end_datetime);  \n\n                            var difference = moment(moment(end_datetime).startOf(\"minute\")).diff(moment(start_datetime).startOf(\"minute\"));\n\n                            //now we need to calculate the difference in datetime\n                            // //console.log(\"d: \"+moment.duration(difference).days()+\" h: \"+moment.duration(difference).hours()+\" m: \"+moment.duration(difference).minutes());\n                            var human_str = get_duration_str(difference);\n\n                           \n\n\n                            // //console.log(\"human string\", human_str);\n                            if(human_str == \"\"){\n                                vm.landing_times[i].disabled = 1;\n                            } else {\n                                vm.landing_times[i].duration = \"( \"+human_str+\" )\";\n                            }\n\n\n                        } else {\n                            vm.landing_times[i].duration = \"\";\n                        }\n                      //if(time.time == moment(future).format(\"H:mm\")){ id = i; return true;}; \n                    });\n                }\n            }\n\n\n            vm.calculate_after_landing_duration = function(){\n\n                if(vm.show_takeoff_landing_times){\n                        //also set the takeoff 5mins after taxi?\n\n                        if(vm.bookout.start_date && vm.bookout.landing_time){\n                            var start_datetime = new Date(vm.bookout.start_date);\n                            var start_time = vm.bookout.landing_time.time.split(\":\");\n                            start_datetime.setHours(start_time[0]);\n                            start_datetime.setMinutes(start_time[1]);\n                            start_datetime.setSeconds(0);\n                            // //console.log(\"START DATETIME\", start_datetime);  \n\n                            vm.end_times.forEach(function(time, i){ \n                                //no need to go through each element if its not required to be shown!\n                                if(time.disabled == 0){\n\n                                    var end_datetime = new Date(vm.bookout.end_date);\n                                    var end_time = time.time.split(\":\");\n                                    end_datetime.setHours(end_time[0]);\n                                    end_datetime.setMinutes(end_time[1]);  \n                                    end_datetime.setSeconds(0);\n                                    // //console.log(\"END DATETIME\", end_datetime);  \n\n                                    var difference = moment(moment(end_datetime).startOf(\"minute\")).diff(moment(start_datetime).startOf(\"minute\"));\n\n                                    //now we need to calculate the difference in datetime\n                                    // //console.log(\"d: \"+moment.duration(difference).days()+\" h: \"+moment.duration(difference).hours()+\" m: \"+moment.duration(difference).minutes());\n                                    var human_str = get_duration_str(difference);\n\n                                   \n\n\n                                    // //console.log(\"human string\", human_str);\n                                    if(human_str == \"\"){\n                                        vm.end_times[i].disabled = 1;\n                                    } else {\n                                        vm.end_times[i].duration = \"( \"+human_str+\" )\";\n                                    }\n\n\n                                } else {\n                                    vm.end_times[i].duration = \"\";\n                                }\n                              //if(time.time == moment(future).format(\"H:mm\")){ id = i; return true;}; \n                            });\n\n                            \n                        }\n\n\n                }\n\n\n                \n            }\n\n\n            vm.flight_units = \n            {\n                brakes_to_brakes: 0,\n                airborne_times: 0,\n                flight_time: 0,\n                meter_units: (vm.bookout.end_tacho - vm.bookout.start_tacho)\n            };\n\n            vm.cancel_split = function(){\n                vm.bookout = vm.original_bookout;\n                vm.bookout.brakes_off = vm.bookout.brakes_off.time;\n                vm.bookout.brakes_on = vm.bookout.brakes_on.time;\n                console.log(vm.bookout);\n                console.log(vm.bookout.brakes_on);\n                vm.split_flight_confirmation = 0;\n                vm.split_flight = 0;\n                // vm.split_one = {};\n                // vm.split_two = {};\n                process_bookout_to_bookin(vm.bookout);\n                //vm.calculate_my_airborne_duration();\n            }\n\n            vm.confirm_split = function(){\n                console.log(\"CONFIRM SPLIT\");\n\n                vm.try_split = true;\n\n                vm.before_split_bookout = vm.bookout;\n                vm.split_flight_confirmation = 1;\n\n                vm.original_bookout = vm.bookout;\n                vm.split_one.touch_and_go = vm.bookout.touch_and_go;\n                vm.split_one.tng = vm.bookout.tng;\n                console.log(\"TNG : \", vm.split_one.touch_and_go);\n\n                vm.split_one.full_stop_landings = vm.bookout.full_stop_landings\n                vm.split_one.landings = vm.bookout.landings;\n                vm.split_one.remote_landings = vm.bookout.remote_landings;\n                vm.split_one.pic = vm.bookout.pic;\n                vm.split_one.pic_id = vm.bookout.pic_id;\n                vm.split_one.put = vm.bookout.put;\n                vm.split_one.put_id = vm.bookout.put_id;\n                vm.split_one.payer_id = vm.bookout.payer_id;\n                vm.split_one.instructor = vm.bookout.instructor;\n                vm.split_one.instructor_id = vm.bookout.instructor_id;\n                vm.split_one.booking = vm.bookout.booking;\n                vm.split_one.booking_id = vm.bookout.booking_id;\n                if(vm.bookout.course && vm.bookout.course.id){\n                    vm.split_one.course_id = vm.bookout.course.id;\n                }\n                vm.split_one.course = vm.bookout.course;\n                vm.split_one.tuition_required = vm.bookout.tuition_required;\n                //vm.split_one.tuition = vm.bookout.course;\n                // vm.split_one.plane = vm.bookout.plane;\n                //vm.bookout.course\n\n                vm.split_one.authorised_solo = vm.bookout.authorised_solo;\n                // vm.split_one.plane = vm.bookout.plane;\n                // vm.split_one.plane = vm.bookout.plane;\n                // vm.split_one.plane = vm.bookout.plane;\n\n\n                //UPDATE THE FLIGHT TIME UNITS NOW\n                vm.flight_units.brakes_to_brakes = vm.split_one.brakes_times;\n\n                vm.flight_units.airborne_times = vm.split_one.airborne_time;\n\n                vm.flight_units.flight_time = vm.split_one.flight_time;\n\n                vm.flight_units.brakes_times_rounded = vm.split_one.brakes_times_rounded;\n\n\n                console.log(\"OLD ONE - \", vm.split_one);\n\n                vm.bookout = vm.split_one;\n\n                console.log(\"SPLIT 1 - \", vm.split_one);\n                console.log(\"SPLIT 2 - \", vm.split_two);\n                \n                process_bookout_to_bookin(vm.bookout);\n\n                console.log(\"new bookout = \", vm.bookout);\n\n                //vm.calculate_invoice_for_flight();\n            }\n            \n            vm.calculate_my_airborne_duration = function(){\n\n                if(vm.has_used_claimed_flight) { //and not overridden??\n                    //this should never happen....\n\n                    vm.flight_units.brakes_to_brakes = vm.claimed_flight.brakes_time;\n                    vm.flight_units.airborne_times = vm.claimed_flight.airborne_time;\n                    vm.flight_units.flight_time = vm.claimed_flight.flight_time;\n                    vm.flight_units.brakes_times_rounded = vm.claimed_flight.brakes_times_rounded;\n\n                    vm.calculate_invoice_for_flight();\n                \n\n                } else {\n\n\n                    if((vm.bookout.takeoff_time && vm.bookout.takeoff_time.time) && (vm.bookout.landing_time && vm.bookout.landing_time.time)){\n\n                        //console.log(\"BOTH SET SO\", vm.bookout.brakes_off.time);\n                        //console.log(\"BOTH SET SO\", vm.bookout.brakes_on.time);\n                        var start_datetime = new Date();\n                        var start_time = vm.bookout.takeoff_time.time.split(\":\");\n                        start_datetime.setHours(start_time[0]);\n                        start_datetime.setMinutes(start_time[1]);\n                        start_datetime.setSeconds(0);\n\n\n                        var end_datetime = new Date();\n                        //var end_time = time.time.split(\":\");\n                        var end_time = vm.bookout.landing_time.time.split(\":\");\n                        end_datetime.setHours(end_time[0]);\n                        end_datetime.setMinutes(end_time[1]);  \n                        end_datetime.setSeconds(0);\n\n\n                        var difference = moment(moment(end_datetime).startOf(\"minute\")).diff(moment(start_datetime).startOf(\"minute\"));\n                        // var human_str = get_duration_str(difference);\n\n                        vm.flight_units.airborne_times = moment.duration(difference).asHours();\n                        //console.log(\"HELLO DURATION CALC\", vm.flight_units.brakes_to_brakes);\n\n\n                        vm.calculate_invoice_for_flight();\n                        //  //console.log(\"HELLO DURATION CALC2\", human_str);\n\n                    }\n\n                    if(vm.bookout.brakes_off && vm.bookout.brakes_off.time !== \"\" && vm.bookout.brakes_on && vm.bookout.brakes_on.time !== \"\"){\n\n\n                        var bstart_datetime = new Date();\n                        var bstart_time = vm.bookout.brakes_off.time.split(\":\");\n                        bstart_datetime.setHours(bstart_time[0]);\n                        bstart_datetime.setMinutes(bstart_time[1]);\n                        bstart_datetime.setSeconds(0);\n\n\n                        var bend_datetime = new Date();\n                        //var end_time = time.time.split(\":\");\n                        if(vm.bookout.brakes_on && vm.bookout.brakes_on.time){\n\n                            var bend_time = vm.bookout.brakes_on.time.split(\":\");\n                            bend_datetime.setHours(bend_time[0]);\n                            bend_datetime.setMinutes(bend_time[1]);  \n                            bend_datetime.setSeconds(0);\n\n\n                            var difference = moment(moment(bend_datetime).startOf(\"minute\")).diff(moment(bstart_datetime).startOf(\"minute\"));\n                            // var human_str = get_duration_str(difference);\n\n                            vm.flight_units.brakes_to_brakes = moment.duration(difference).asHours();\n                            //console.log(\"HELLO DURATION CALC\", vm.flight_units.brakes_to_brakes);\n\n                            //console.log(\"FLIGHT BRAKES UNITS : \", vm.flight_units.brakes_to_brakes);\n\n                            vm.calculate_invoice_for_flight();\n\n\n                        }\n                        \n\n                    }\n\n                    \n\n                    \n                }\n\n\n                vm.flight_times_complete = true;\n\n            }\n\n\n\n            vm.update_dateTime = function(){\n                //console.log(\"STARTED\", vm.bookout.brakes_off);\n                //console.log(\"STARTED\", vm.bookout.brakes_on);\n                if(vm.has_used_claimed_flight) { //and not overridden??\n\n\n                    vm.flight_units.brakes_to_brakes = vm.claimed_flight.brakes_time;\n                    vm.flight_units.airborne_times = vm.claimed_flight.airborne_time;\n                    vm.flight_units.flight_time = vm.claimed_flight.flight_time;\n\n                    vm.calculate_invoice_for_flight();\n                \n                } else {\n\n\n                    if((vm.bookout.brakes_off && vm.bookout.brakes_off.time) && (vm.bookout.brakes_on && vm.bookout.brakes_on.time)){\n\n                        //console.log(\"BOTH SET SO\", vm.bookout.brakes_off.time);\n                        //console.log(\"BOTH SET SO\", vm.bookout.brakes_on.time);\n                        var start_datetime = new Date();\n                        var start_time = vm.bookout.brakes_off.time.split(\":\");\n                        start_datetime.setHours(start_time[0]);\n                        start_datetime.setMinutes(start_time[1]);\n                        start_datetime.setSeconds(0);\n\n\n                        var end_datetime = new Date();\n                        //var end_time = time.time.split(\":\");\n                        var end_time = vm.bookout.brakes_on.time.split(\":\");\n                        end_datetime.setHours(end_time[0]);\n                        end_datetime.setMinutes(end_time[1]);  \n                        end_datetime.setSeconds(0);\n\n\n                        var difference = moment(moment(end_datetime).startOf(\"minute\")).diff(moment(start_datetime).startOf(\"minute\"));\n                        // var human_str = get_duration_str(difference);\n\n                        vm.flight_units.brakes_to_brakes = moment.duration(difference).asHours();\n                        //console.log(\"HELLO DURATION CALC\", vm.flight_units.brakes_to_brakes);\n\n\n                        vm.calculate_invoice_for_flight();\n                        //  //console.log(\"HELLO DURATION CALC2\", human_str);\n\n                    }\n                }\n\n\n                vm.flight_times_complete = true;\n\n            }\n\n\n            function check_relative_date(date, start_end = \"start\"){\n                var relative = \"today\";\n                //console.log(\"RELATIVE TIME CHECK\", date);\n                if(moment(moment(date).format(\"YYYY/MM/DD\")).isAfter(moment().format(\"YYYY/MM/DD\"))){\n                    relative = \"future\";\n\n                    //then is after today\n                    // the catch is that if date == start / end date --> THEN we need to present that it is today even though it isnt - this is premise\n                    // that is valid only for the \"END\" cases (so that we return AFTER rather than today) --> otherwise the end_times available won't reflect\n                    //the fact that the start_times have been selected allowing the user to select an end time before start time (which is silly really...)\n\n                    if(vm.bookout.start_date && vm.bookout.end_date && start_end == \"end\"){\n                        if(moment(vm.bookout.start_date).isSame(moment(vm.bookout.end_date))){\n                            relative = \"after\"; // because we need to act as though it is after in the clean_times (to not be able to select end < start times)\n                        }\n                    }\n                    \n                } else if(moment(date).format(\"YYYY/MM/DD\") == moment().format(\"YYYY/MM/DD\")){\n                    //then today\n                    relative = (start_end == \"start\") ? \"today\" : \"after\";\n                } else {\n                    //must be in the past...\n                    relative = \"past\";\n                }\n                \n                // //console.log(\"relative is \", relative);\n                return relative;\n            }\n\n            // function add_hour_to_end(){\n            //     var a = vm.bookout.start_time.time.split(\":\");\n            //     //var b = new Date();\n            //     var b = new Date(vm.bookout.start_date);\n            //     b.setHours(a[0]);\n            //     b.setMinutes(a[1]);\n            //     b.setSeconds(0);\n            //     var future = moment(b).add(1, \"hour\").format();\n            //    // clean_times('after', 'end_times', future);\n            //    //\n\n            //      //clean_times(check_relative_date(vm.bookout.end_date, \"end\"), 'end_times', future);\n\n\n\n            //     if(parseInt(a[0]) >= 23){\n            //         if(moment(vm.bookout.start_date).isSame(moment(vm.bookout.end_date))){\n            //              // //console.log(\"THIS ADD DAY\");\n            //             // //console.log(\"start\", vm.bookout.start_date);\n            //             // //console.log(\"end\", vm.bookout.end_date);\n            //              // //console.log(\"after or = 11pm - then we need to change the date that follows the same pattern\");\n            //             vm.bookout.end_date = new Date(moment(vm.bookout.end_date).add(1, \"day\").format());\n            //             clean_times('future', 'end_times');\n\n            //             //set it to 00:00 hours probably a wise thing...\n            //             vm.bookout.end_time = vm.end_times[0];\n\n\n            //         } \n            //     } else {\n            //         clean_times('after', 'end_times', b);\n            //     }\n\n            // }\n\n        function check_times(){\n\n                var c = new Date();\n                var a = (vm.bookout.start_time) ? vm.bookout.start_time.time.split(\":\") : [c.getHours(), c.getMinutes()];\n                var b = new Date(vm.bookout.start_date);\n                b.setHours(a[0]);\n                b.setMinutes(a[1]);\n                b.setSeconds(0);\n                var future = moment(b).add(1, \"hour\").format();\n\n                //check if the end_time is set && if the end time is > start time...\n                if(start_after_end() || !vm.bookout.end_time){\n                    \n                    clean_times(check_relative_date(vm.bookout.end_date, \"end\"), 'end_times', b);\n\n                    var id;\n                    // vm.end_times.forEach(function(time, i){ \n                    //   if(time.time == moment(future).format(\"H:mm\")){ id = i; return true;}; \n                    // });\n                    vm.end_times.some(function(time, i){ \n                      if(time.time == moment(future).format(\"H:mm\")){ id = i; return i;};  \n                    });\n\n                    vm.bookout.end_time = {};\n                    vm.bookout.end_time = vm.end_times[id];\n\n                } else {\n                    clean_times(check_relative_date(vm.bookout.end_date, \"end\"), 'end_times', b);\n                }\n\n\n                 //need to update the selection of the end time if this has been set\n                if(vm.bookout.end_time && vm.bookout.end_time.disabled == 1){\n\n                    var id;\n                    //used to use a forEach loop but decided to run a some loop instead due to the benefit of not going through all elements\n                    // vm.end_times.forEach(function(time, i){ \n                    //   if(time.time == moment(future).format(\"H:mm\")){ id = i; return true;}; \n                    // });\n                    vm.end_times.some(function(time, i){ \n                      if(time.time == moment(future).format(\"H:mm\")){ id = i; return i;};  \n                    });\n\n                    vm.bookout.end_time = {};\n                    vm.bookout.end_time = vm.end_times[id];\n\n                }\n\n                if(vm.bookout.start_time && vm.bookout.start_time.disabled == 1){\n\n                    var id;\n                    vm.start_times.some(function(time, i){ \n                      if(time.disabled == 0){ id = i; return i;}; \n                    });\n\n                    vm.bookout.start_time = {};\n                    vm.bookout.start_time = vm.start_times[id];\n\n                    calculate_duration();\n                }\n        }\n\n\n\n\n         function booking_today(){\n                if(moment(vm.bookout.start_date).format(\"DD/MM/YYYY\") == moment().format(\"DD/MM/YYYY\")){\n                    //console.log(\"WE ARE TODAY?\");\n                    clean_times('today', 'start_times');\n\n                } else {\n                    // //console.log(\"should get full day\");\n                    if(moment(vm.bookout.start_date).isAfter(moment()) ){\n                        clean_times('future', 'start_times');\n                    }\n                }\n\n                if(moment(vm.bookout.end_date).format(\"DD/MM/YYYY\") == moment().format(\"DD/MM/YYYY\")){\n                    if(vm.bookout.start_time){\n                       //console.log(\"START TIME\", vm.bookout.start_time);\n                        add_hour_to_end(); \n                    }\n                    clean_times(check_relative_date(vm.bookout.start_date), 'end_times');\n                }\n\n\n                if(vm.bookout.end_date == vm.bookout.start_date){\n                        // //console.log(\"booking today where end = start\");\n                        if(vm.bookout.start_time){\n                            var a = vm.bookout.start_time.time.split(\":\");\n                            var b = new Date(vm.bookout.start_date);\n                            b.setHours(a[0]);\n                            b.setMinutes(a[1]);\n                            b.setSeconds(0);\n\n                            //we need to check the times give\n                            if(start_after_end()){\n                                clean_times(check_relative_date(vm.bookout.start_date), 'start_times');\n                                // //console.log(\"UPDATE END BITS IF START > END required?\");\n                                clean_times(check_relative_date(vm.bookout.end_date, \"end\"), 'end_times', b);\n                                add_hour_to_end();\n                            } else {\n                                // //console.log(\"UPDATE END BITS IF START > END 2\", check_relative_date(vm.bookout.start_date, \"end\"));\n                                clean_times(check_relative_date(vm.bookout.end_date, \"end\"), 'end_times', b);\n                            }\n\n\n                        }\n                }\n\n            }\n\n            // clean_times('today', 'start_times');\n            booking_today();\n\n\n        $scope.update_dateTime = function(which_update){\n\n            //console.log(\"UPDATE TIME HERE\", which_update);\n\n            switch(which_update){\n\n               \n\n                case 'start_time':\n\n                    //do we need to clean the times? if so.. \n                    booking_today();\n\n                    check_times();\n\n                    //we need to calculate the time in between the start and the end!\n                    calculate_duration();\n                    \n\n                break;\n\n                case 'end_time':\n                    check_times();\n\n                break;\n\n                case 'edit':\n\n                    // //this is the edit function that needs to be setup.\n                    // booking_today();\n\n                    // //number 1 = we have set start and end of the current date....\n                    // // setTimeout(function(){\n                    // //     check_times();\n                    // //     // calculate_duration();\n                    // // }, 5000);\n                    // //console.log(\"ASD \",vm.bookout.start_date);\n                    // // clean_times(check_relative_date(vm.bookout.start_date), 'start_times');\n                    // check_times();\n                    // calculate_duration();\n\n                    booking_today();\n\n                    clean_times(check_relative_date(vm.bookout.start_date), 'start_times');\n\n                    check_times();\n\n                    calculate_duration();\n\n                    setTimeout(function(){\n                        //do we need to clean the times? if so.. \n                        // pre_select_value_id(\"start_times\", vm.bookout.start_time);\n                        pre_select_value_id();\n                        //we need to calculate the time in between the start and the end!\n                    }, 500);\n\n\n\n\n                    //we need to set the previously selected plane here...\n\n\n                break;\n\n            }\n\n\n            //an update on the form would require an update of the plane / waiting lists available\n          \n\n\n        }\n\n\n\n        function start_after_end(){\n                var start_after_end = false;\n                if(vm.bookout.end_time){\n                    // //console.log(\"START AFTER END LOOP\");\n                    var start_datetime = new Date(vm.bookout.start_date);\n                    var start_time = vm.bookout.start_time.time.split(\":\");\n                    start_datetime.setHours(start_time[0]);\n                    start_datetime.setMinutes(start_time[1]);\n                    start_datetime.setSeconds(0);\n\n                    var end_datetime = new Date(vm.bookout.end_date);\n                    var end_time = vm.bookout.end_time.time.split(\":\");\n                    end_datetime.setHours(end_time[0]);\n                    end_datetime.setMinutes(end_time[1]);\n                    end_datetime.setSeconds(0);\n\n                    if(moment(start_datetime).isAfter(moment(end_datetime)) || moment(start_datetime).isSame(end_datetime) || end_datetime == start_datetime){\n                        start_after_end = true;\n                    }\n\n\n                }\n                return start_after_end;\n        }\n\n        figure_out_steps();\n        init_times();\n\n        switch($state.current.data.action){\n            case \"add\":\n\n                //console.log(\"bookout\", $stateParams.id);\n                //so now we can load the BOOKING with this ID, and therefore can sort it all out :)\n                // let us preload the content required from the booking - fetch the booking\n                //console.log(\"FETCH THE BOOKING\");\n\n                BookingService.GetForBookIn($stateParams.id)\n                 .then(function (data) {\n                    console.log(\"data is : \", data);\n                    if(data.success){\n                        //console.log(\"success\");\n                        \n\n                        if(data.bookout.booked_in == 1){\n                            ToastService.warning('Already Booked', 'It appears that you have already booked this flight back in.');\n                            $state.go('dashboard.my_account', {}, { reload: true });\n                        }\n\n                        vm.original_bookout = data.bookout;\n                        vm.bookout = data.bookout;\n\n                        vm.claim_a_flight = data.unclaimed;\n                        // BookingService.GetUnclaimedFlights(vm.bookout.plane_id).then(function (data) {\n                        //         ////console.log(\"data is : \", data);\n                        //         if(data.success){\n                        //             console.log(data);\n                        //         }\n                        //     });\n\n\n                        // FoxService.GetFoxEntriesByPlane(vm.bookout.plane_id)\n                        // .then(function (data) {\n                        //     if(data.success){\n                        //         console.log(data);\n                        //         vm.claim_a_flight = data.to_claim;\n                        //     }\n\n                        // });\n\n                        //temporary bits to overcome the start and end times issues...\n                        vm.bookout.start_date = new Date(\"2100/07/26\");\n                        vm.bookout.end_date = new Date(\"2100/07/26\");\n                        //console.log(\"RAW DATA HERE : \", data);\n                        // MemberService.GetAllByPics(data.bookout.club_id, vm.user.id)\n\n                        MemberService.GetAllByPicsBookinout(vm.bookout.booking_id, vm.bookout.club_id, vm.user.id, 1)\n                            .then(function (pics) {\n                                    vm.pics = pics;\n                                    console.log(\"PICS: \", vm.pics);\n                                    process_bookout_to_bookin(data.bookout);\n                            });\n\n                       MemberService.GetAllByClubInstructor(vm.bookout.club_id, vm.user.id)\n                            .then(function (instructors) {\n                                    vm.instructors = instructors.instructors;\n                                    //process_bookout_to_bookin(data.bookout);\n                            });\n\n\n                        PackageService.GetPackagesForBookout(vm.bookout.id)\n                            .then(function (data) {\n                            // IF IT HAS A PACKAGE ID --> THEN WE NEED TO CHECK IT PUT THE CORRECT PAYMENT INFORMATION THERE\n                                //console.log(\"BOOKOUT PACKAGE\", data);\n                                //console.log(\"BOOKOUT PACKAGE\", data.packages);\n                                vm.packages = data.packages;\n                            });\n\n                            // if(vm.bookout.put_id > 0){\n                            //     vm.bookout.payer_id = vm.bookout.put_id;\n                            // } else {\n                            //     vm.bookout.payer_id = vm.bookout.pic_id;\n                            // }\n\n                            if(vm.bookout.payer_id == 0){\n                                if(vm.bookout.pic_id !== 0 && vm.bookout.pic_id !== vm.bookout.instructor_id){\n                                    vm.bookout.payer_id = vm.bookout.pic_id; //PIC is student supervised or otherwise solo\n                                } else if((vm.bookout.instructor_id > 0 && vm.bookout.put_id > 0) || vm.bookout.instructor_id > 0 && vm.bookout.user_id > 0){\n                                    vm.bookout.payer_id = (vm.bookout.put_id > 0)? vm.bookout.put_id : vm.bookout.user_id; //put always pays\n                                } else if(vm.bookout.put_id > 0){\n                                    vm.bookout.payer_id = vm.bookout.put_id;\n                                } else if(vm.bookout.put_id == 0 && vm.bookout.user_id == 0){\n                                    vm.bookout.payer_id = vm.bookout.pic_id;\n                                } else {\n                                    if(vm.bookout.instructor_id == 0){\n                                        vm.bookout.payer_id = vm.bookout.pic_id;\n                                    }\n                                    if(vm.bookout.payer_id == 0){\n                                        ToastService.warning('Payer Required', 'Please select a student or person paying for this flight');\n                                    }\n                                }\n                            }\n\n\n                        \n\n                    }\n                });\n\n                \n            break;\n            case \"edit\":\n\n            \n\n\n\n            break;\n            case \"list\":\n\n             \n\n\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n      \n\n        vm.get_package_html = function(pack_obj){\n            var used_on = \"\";\n            for(var i=0;i<pack_obj.aircraft.length;i++){\n                used_on = used_on + \" \" + pack_obj.aircraft[i].registration +\" (\"+ pack_obj.aircraft[i].plane_type +\") <br />\";\n            }\n            var text = \"\";\n            if(pack_obj.validity == 0){\n               text = \"Package purchased on: \"+moment(pack_obj.created_at).format(\"D MMM Y\")+\"<br /> Package does not expire <br /> To be used on:<br />\";\n            } else {\n               text = \"Package purchased on: \"+moment(pack_obj.created_at).format(\"D MMM Y\")+\"<br /> Package expires on: \"+ moment(pack_obj.created_at).add(pack_obj.validity, \"days\").format(\"D MMM Y\") +\" <br /> To be used on:<br />\";\n            }\n    \n            return text+used_on;\n\n        }\n\n        vm.this_was_a_supervised_solo = function(){\n            vm.this_was_supervised_solo = !vm.this_was_supervised_solo;\n            //pic probably is the payer\n            if(vm.this_was_supervised_solo){\n                vm.bookout.payer_id = vm.bookout.pic_id;\n            } else if(vm.bookout.put_id > 0) {\n                vm.bookout.payer_id = vm.bookout.put_id;\n            } else if(vm.bookout.user_id > 0){\n                vm.bookout.payer_id = vm.bookout.user_id;\n            }\n\n            // if(vm.complete_flight && vm.){\n            //     vm.complete_this_flight();\n            // }\n\n        }\n\n        vm.this_was_instructional_claim = function(){\n            //toggle as it worked\n            vm.this_claim_was_instructional = !vm.this_claim_was_instructional;\n            vm.complete_flight = false;\n            if(vm.this_claim_was_instructional){\n\n                vm.ignore_next_tuition_change = true;\n\n                //then PIC is the INSTRUCTOR\n                //vm.bookout.instructor_id = vm.bookout.pic.user_id;\n                vm.bookout.payer_id = vm.bookout.put_id;\n\n                if(vm.bookout.instructor_id == 0 && (vm.bookout.pic && vm.bookout.pic.user_id > 0)){\n                    vm.bookout.instructor_id = vm.bookout.pic.user_id;\n                }\n\n                preselect_course_and_tuition();\n\n            } else {\n                vm.bookout.put_id = 0;\n                vm.bookout.put = {};\n                vm.bookout.instructor_id = 0;\n                if(vm.bookout.pic_id > 0){\n                    vm.bookout.payer_id = vm.bookout.pic_id;\n                } else if(vm.bookout.user_id > 0) {\n                    vm.bookout.payer_id = vm.bookout.user_id;\n                } else {\n                    //alert(\"It appears that no payer ID has been set yet.\");\n                }\n            }\n\n            vm.calculate_invoice_for_flight();\n\n            // if(vm.complete_flight){\n            //     vm.complete_this_flight();\n            // }\n\n        }\n\n\n        // vm.convert_decimal_to_hours = function(decimal_time){\n        //     var temp = new Array();\n        //     temp = decimal_time.toString().split('.');\n            \n        //     var hours = temp[0];\n        //     if(hours < 10){\n        //         hours = \"0\"+hours;\n        //     }\n        //     if(temp[1]){\n        //        var minutes = 100 / temp[1];\n        //         minutes = Math.round(60 / minutes); \n\n        //         if(minutes < 10){\n        //             minutes = \"0\"+minutes;\n        //         }\n        //     } else {\n        //         minutes = \"00\"\n        //     }\n\n        //     return hours + ':' + minutes;\n        // }\n\n\n\n        $scope.applyFilter = function(model, filter) {\n            if(filter){\n\n                var pieces = filter.split(':');\n\n                var filterName = pieces[0];\n\n                var params = [model];\n\n                if(pieces.length>1){\n                    \n                    // //console.log(\"hello\", pieces.slice(1).join(\":\"));\n                    if(filterName.toLowerCase() == \"date\"){\n                       params.push( pieces.slice(1).join(\":\") );\n                    }\n                    //params = params.slice(1, -1);\n                    // //console.log(\"contact it\", params);\n\n                } else {\n                    params = params.concat(pieces.slice(1));\n                }\n\n                return $filter(filterName).apply(this,params);\n            }else{\n                return model;\n            }\n        }\n\n        vm.add_defect = function(){\n\n\n            var obj = {\n                club_id: vm.bookout.club_id,\n                user_id: vm.bookout.user_id,\n                plane_id: vm.bookout.plane_id,\n                defect: vm.defect,\n                severity: vm.defect_severity.title,\n                status: \"open\"\n            }\n\n            \n\n        \n            PlaneService.AddDefect(obj)\n             .then(function (data) {\n                    ////console.log(\"data is : \", data);\n                    data.item.can_delete = true;\n\n                   vm.reported_defects.push(data.item);\n\n                   vm.defect = \"\";\n                   vm.defect_severity = \"\";\n                });\n\n        }\n\n        vm.delete_defect = function(id){\n            //console.log(\"UNDO DEFECT ID \", id);\n\n            PlaneService.DeleteDefect(id)\n            .then(function (data) {\n                    ////console.log(\"data is : \", data);\n                   \n                    PlaneService.GetOpenIssues(vm.bookout.plane_id)\n                    .then(function (data) {\n                            ////console.log(\"data is : \", data);\n                           vm.reported_defects = data;\n                        });\n\n\n                });\n\n        }\n\n        vm.tacho_error_highlight = false;\n\n        vm.check_tacho_bigger = function(){\n\n         if(vm.bookout.start_tacho >= vm.bookout.end_tacho){\n                    ToastService.warning('Tacho Error', 'Please check start and end tacho. You cannot end on a smaller tacho.');\n                    vm.tacho_error_highlight = true;\n                } else {\n                    vm.tacho_error_highlight = false;\n                }\n\n         }\n\n\n        vm.calculate_invoice_for_flight = function(){\n             console.log(\"RUN CALCULATION\", vm.flight_units);\n            //vm.flight_units where the units are stored\n            if(vm.free_flight){\n                if(vm.bookout.plane_charges){\n                    vm.bookout.plane_charges.charge_rate_unit = 0;\n                    vm.bookout.plane_charges.surcharge_fee = 0;\n                    vm.bookout.plane_charges.landing_fee = 0;\n                    vm.bookout.plane_charges.touch_and_go_fee = 0;\n                }\n                \n                if(vm.bookout.tuition_charges){\n                    vm.bookout.tuition_charges.price = 0;\n                }\n                \n            }\n\n            //vm.bookout.plane_cha\n                // rges where th\n                // console.lkogog, tpc_flight_time()e fees are stored\n            var plane_units = 0;\n            \n\n            if(vm.claimed_flight && vm.claimed_flight !== null){\n                // console.log(\"NO SELECTED FLIGHT??\");\n\n                //plane units\n                if(vm.bookout.plane_charges.tpc_aircraft_surchages){\n                    console.log(\"TPC SURCHARGE UNITS\");\n                    plane_units = vm.bookout.tpc_flight_time;\n                } else if(vm.bookout.plane_charges.charge_type == \"flight\"){\n                    //then the units relate to the entered numbers:\n                    plane_units = vm.flight_units.airborne_times;\n\n                } else if(vm.bookout.plane_charges.charge_type == \"airborne\"){\n                    //then the units relate to the entered numbers:\n                    plane_units = vm.flight_units.airborne_times;\n\n                } else if(vm.bookout.plane_charges.charge_type == \"brakes\"){\n                    //then the units relate to the entered numbers:\n                    if((!vm.flight_units.brakes_to_brakes || vm.flight_units.brakes_to_brakes == 0) && vm.bookout.brakes_times && vm.bookout.brakes_times > 0){\n                                            plane_units = vm.bookout.brakes_times;\n                                            vm.flight_units.brakes_to_brakes = vm.bookout.brakes_times;\n\n                    } else {\n                                            plane_units = vm.flight_units.brakes_to_brakes;\n                    }\n\n                } else if(vm.bookout.plane_charges.charge_type == \"brakes_rounded\"){\n                    //then the units relate to the entered numbers:\n                    plane_units = vm.flight_units.brakes_to_brakes;\n                } else {\n                    //hobbs --> to use the tacho area as the item\n                    //then the units we need to calculate relate to the hours between brakes off and on.\n                    plane_units = (vm.bookout.end_tacho - vm.bookout.start_tacho);\n                }\n\n\n            } else {\n                // console.log(\"SELECT FLIGHT SO WE CAN USE THE FOLLOWING\");\n                //plane units\n                 if(vm.bookout.plane_charges.tpc_aircraft_surchages){\n                    console.log(\"TPC SURCHARGE UNITS 2\");\n                    plane_units = vm.bookout.tpc_flight_time;\n                } else if(vm.bookout.plane_charges.charge_type == \"flight\"){\n                    //then the units relate to the entered numbers:\n                    plane_units = vm.flight_units.flight_time;\n\n                } else if(vm.bookout.plane_charges.charge_type == \"airborne\"){\n                    //then the units relate to the entered numbers:\n                    plane_units = vm.flight_units.airborne_times;\n\n                } else if(vm.bookout.plane_charges.charge_type == \"brakes\"){\n                    //then the units relate to the entered numbers:\n                    //plane_units = vm.flight_units.brakes_to_brakes;\n\n                    if((!vm.flight_units.brakes_to_brakes || vm.flight_units.brakes_to_brakes == 0) && vm.bookout.brakes_times && vm.bookout.brakes_times > 0){\n                                            plane_units = vm.bookout.brakes_times;\n                                            vm.flight_units.brakes_to_brakes = vm.bookout.brakes_times;\n\n                    } else {\n                                            plane_units = vm.flight_units.brakes_to_brakes;\n                    }\n\n                } else if(vm.bookout.plane_charges.charge_type == \"brakes_rounded\"){\n                    //then the units relate to the entered numbers:\n                    plane_units = vm.flight_units.brakes_times_rounded;\n                } else {\n                    //hobbs --> to use the tacho area as the item\n                    //then the units we need to calculate relate to the hours between brakes off and on.\n                    plane_units = (vm.bookout.end_tacho - vm.bookout.start_tacho);\n                }\n\n            }\n\n            \n            if((!vm.flight_units.brakes_to_brakes || vm.flight_units.brakes_to_brakes == 0) && vm.bookout.brakes_times && vm.bookout.brakes_times > 0){\n                console.log(\"force it again\");\n                vm.flight_units.brakes_to_brakes = vm.bookout.brakes_times;\n            }\n\n\n            console.log(vm.bookout.plane_charges.tpc_aircraft_surchages);\n            console.log(\"plane units 2: \", plane_units);\n            vm.package_removed = [];\n            vm.package_used = false;\n\n            if(vm.packages && vm.packages.length > 0){\n\n                for(var i=0;i<vm.packages.length;i++){\n                                \n                    vm.package_used = true;\n\n                    if(vm.bookout.instructor_id && vm.bookout.instructor_id > 0){\n                        //then its dual\n                        if(vm.packages[i].remaining_hours_dual && vm.packages[i].remaining_hours_dual > 0){\n                            if(plane_units < vm.packages[i].remaining_hours_dual){\n\n                                var rem = vm.packages[i].remaining_hours_dual - plane_units;\n                                vm.package_removed.push({solo_dual: \"dual\", title: vm.packages[i].title, member_packages_id: vm.packages[i].id, hours_dual_before: vm.packages[i].remaining_hours_dual, hours_dual_spent: plane_units, hours_dual_remaining_after: rem, hours_solo_remaining_after: vm.packages[i].remaining_hours_solo, package_id: vm.packages[i].package_id});\n                                plane_units = 0;\n\n                                break;\n                            } else {\n\n                                vm.package_removed.push({solo_dual: \"dual\", title: vm.packages[i].title, member_packages_id: vm.packages[i].id, hours_dual_before: vm.packages[i].remaining_hours_dual, hours_dual_spent: vm.packages[i].remaining_hours_dual, hours_dual_remaining_after: 0, hours_solo_remaining_after: vm.packages[i].remaining_hours_solo, package_id: vm.packages[i].package_id});\n                                plane_units = plane_units - vm.packages[i].remaining_hours_dual;\n\n                            }\n\n                        }\n\n                    } else {\n                        //then its solo\n                        if(vm.packages[i].remaining_hours_solo && vm.packages[i].remaining_hours_solo > 0){\n                             if(plane_units < vm.packages[i].remaining_hours_solo){\n\n                                var rem = vm.packages[i].remaining_hours_solo - plane_units;\n                                vm.package_removed.push({solo_dual: \"solo\", title: vm.packages[i].title, member_packages_id: vm.packages[i].id, hours_solo_before: vm.packages[i].remaining_hours_solo, hours_solo_spent: plane_units, hours_solo_remaining_after: rem, hours_dual_remaining_after: vm.packages[i].remaining_hours_dual, package_id: vm.packages[i].package_id });\n                                plane_units = 0;\n\n                                break;\n                            } else {\n\n                                vm.package_removed.push({solo_dual: \"solo\", title: vm.packages[i].title, member_packages_id: vm.packages[i].id, hours_solo_before: vm.packages[i].remaining_hours_solo, hours_solo_spent: vm.packages[i].remaining_hours_solo, hours_solo_remaining_after: 0, hours_dual_remaining_after: vm.packages[i].remaining_hours_dual, package_id: vm.packages[i].package_id });\n                                plane_units = plane_units - vm.packages[i].remaining_hours_solo;\n                                \n                            }\n\n                        }\n\n                    }\n\n                }\n\n            }    \n\n            //console.log(\"charge rate: \", vm.bookout.plane_charges.charge_rate_unit);\n            //console.log(\"plane_units: \", plane_units);\n            var plane_total = (vm.bookout.plane_charges.charge_rate_unit * plane_units);\n            //console.log(\"plane_total\", plane_total);\n\n\n\n            //plane surchages::::\n            var surcharge_units = 0;\n            if(vm.bookout.plane_charges.surcharge_type == \"flight\" || vm.bookout.plane_charges.surcharge_type == \"taxi\"){\n                //then the units relate to the entered numbers:\n                surcharge_units = 1;\n            } else if(vm.bookout.plane_charges.surcharge_type !== \"none\") {\n                //then the units are based on the plane units\n                surcharge_units = plane_units;\n            }\n\n            var surcharge_total = (vm.bookout.plane_charges.surcharge_fee * surcharge_units);\n\n\n            //landings and touch and goes etc...\n            if(vm.bookout.landings < 0){\n                vm.bookout.landings = 1;\n            }\n            var landing_units = vm.bookout.landings | 0;\n            var landings_total = (landing_units * vm.bookout.plane_charges.landing_fee);\n\n            if(vm.bookout.tng < 0){\n                vm.bookout.tng = 1;\n            }\n            var tg_units = vm.bookout.tng | 0;\n            var tng_total = (tg_units * vm.bookout.plane_charges.touch_and_go_fee);\n\n            var tuition_charge_type = \"none\";\n            var tuition_price = 0;\n            var tuition_total = 0;\n            var tuition_units = 0;\n\n            if(!vm.packages || vm.packages.length == 0 || plane_units > 0){\n\n\n                //TUITION CHARGES\n                \n                if(vm.bookout.instructor_id > 0 && vm.bookout.tuition_id > 0 && vm.bookout.tuition_charges){\n\n                    tuition_charge_type = vm.bookout.tuition_charges.charge_type;\n                    tuition_price = vm.bookout.tuition_charges.price;\n\n                    if(tuition_charge_type == \"brakes\"){\n                        tuition_units = vm.flight_units.brakes_to_brakes;\n                        tuition_charge_type = \"brakes off to brakes on hours\";\n                    } else if(tuition_charge_type == \"brakes_rounded\"){\n                        tuition_units = vm.flight_units.brakes_times_rounded;\n                        tuition_charge_type = \"rounded brakes off to brakes on hours\";\n                    } else if(tuition_charge_type == \"plane\"){\n                        tuition_units = plane_units;//(vm.bookout.end_tacho - vm.bookout.start_tacho);\n                        tuition_charge_type = \"plane units\";\n                    } else if(tuition_charge_type == \"session\"){\n                        tuition_units = 1;\n                        tuition_charge_type = \"session\";\n                    }\n\n                    tuition_total = (tuition_units * tuition_price);\n\n                }\n\n\n            }\n\n            var total_to_remove = 0;\n            var receipts = [];\n            //need to process the reductions due to the receipts...\n            if(vm.lubricant_receipts && vm.lubricant_receipts.length > 0){\n                for(var i = 0;i<vm.lubricant_receipts.length;i++){\n\n                    if(vm.lubricant_receipts[i].reimbursement == 1){\n                        receipts.push(vm.lubricant_receipts[i]);\n                        total_to_remove = Number.parseFloat(Number.parseFloat(total_to_remove) + Number.parseFloat(vm.lubricant_receipts[i].reimbursed_amount));\n                    }\n\n                } \n            }\n            \n\n            // //console.log(\"CALC HERE\", total_to_remove);\n\n\n\n\n\n\n            var total = (plane_total + surcharge_total + landings_total + tng_total + tuition_total - total_to_remove);\n            // //console.log(\"plane_total plane_total\", plane_total);\n            // //console.log(\"plane_total surcharge_total\", surcharge_total);\n            // //console.log(\"plane_total landings_total\", landings_total);\n            // //console.log(\"plane_total tng_total\", tng_total);\n            // //console.log(\"plane_total tuition_total\", tuition_total);\n            // //console.log(\"plane_total total_to_remove\", total_to_remove);\n\n            vm.invoice_totals = vm.previous_total + total;\n\n            vm.send.amount = vm.invoice_totals * 100;\n\n            vm.plane_charges = {\n                plane_charge_type: vm.bookout.plane_charges.charge_type,\n                plane_unit_price: vm.bookout.plane_charges.charge_rate_unit,\n                plane_units: plane_units,\n                plane_total: plane_total,\n                surcharge_charge_type: vm.bookout.plane_charges.surcharge_type,\n                surcharge_unit_price: vm.bookout.plane_charges.surcharge_fee,\n                surcharge_units: surcharge_units,\n                surcharge_total: surcharge_total,\n                landing_units: landing_units,\n                landing_unit_price: vm.bookout.plane_charges.landing_fee,\n                landing_total: landings_total,\n                tng_units: tg_units,\n                tng_unit_price: vm.bookout.plane_charges.touch_and_go_fee,\n                tng_total: tng_total,\n                tuition_charge_type: tuition_charge_type,\n                tuition_unit_price: tuition_price,\n                tuition_units: tuition_units,\n                tuition_total: tuition_total,\n                receipts: receipts,\n                total: total\n            };\n\n            //vm.bookout.tuition_charges\n\n\n            vm.calculated_invoice = true;\n\n        }\n\n        vm.instructor_charges = []; \n\n\n        // vm.update_book_in_options = function(){\n        //     vm.complete_flight = ( (vm.bookout.flight_type.title !== \"Local\" && vm.bookout.to_airfield.id !== vm.bookout.home_airport_id) || vm.bookout.to_airfield.id !== vm.bookout.home_airport_id) ? false : true;\n        // }\n\n\n        vm.complete_flight = false;\n        vm.complete_this_flight = function(){\n\n\n\n            if(vm.tacho_error_highlight){\n                ToastService.highlightField('tacho_end');\n                ToastService.error('Meter Error', 'You cannot complete a flight where the last meter reading is greater than the start meter reading!');\n                return false;\n            }\n\n            if(vm.this_claim_was_instructional && (vm.bookout.instructor_id == 0 || vm.bookout.tuition_id == 0)){\n                ToastService.highlightField('instructor_id');\n                ToastService.warning('Missing Details', 'You need to add an instructor and tuition type if this flight was instructional.');\n                return false;\n            }\n\n            if(vm.bookout.instructor_id > 0 && vm.bookout.tuition_id == 0){\n                ToastService.highlightField('tuition_id');\n                ToastService.warning('Tuition Required', 'Please select a tuition type for this flight.');\n                return false;\n            }\n\n            if(isNaN(vm.invoice_totals)){\n                ToastService.warning('Form Incomplete', 'Please ensure you have filled in the form above - the current total for this invoice cannot be calculated without this.');\n                return false;\n            }\n\n\n            // var getShort = {club_id: vm.bookout.booking.club_id,\n            //     user_id: vm.bookout.booking.user_id};\n\n            // //console.log(\"PASSING\", getShort);\n            // let's fetch some information about the user\n\n            var club_id_confirmed = (vm.bookout.booking && vm.bookout.booking.club_id > 0)? vm.bookout.booking.club_id : vm.bookout.club_id;\n            var user_id_confirmed = (vm.bookout.booking && vm.bookout.booking.user_id > 0)? vm.bookout.booking.user_id : vm.bookout.user_id;\n\n            MemberService.GetMandate(vm.bookout.payer_id, club_id_confirmed)\n                    .then(function (data) {\n                            ////console.log(\"data is : \", data);\n                           \n                            if(data.success){\n                                vm.info = data.info;\n                            }\n\n                        });\n\n            vm.cards = [];\n\n            //NEED TO UPDATE THIS!!!!!\n           var send = {\n               user_id: vm.bookout.payer_id,\n               club_id: club_id_confirmed,\n               membership_id: 1\n           }\n            PaymentService.GetMemberCards(send)\n            .then(function (data) {\n\n                //console.log(data);\n                vm.cards = data.cards;\n                vm.savedCards = data.cards;\n                // vm.membership_now.cards = data.cards;\n                // vm.membership_now.default_card = data.default_card;\n\n            });\n\n\n\n            console.log(\"CONFIRM BOOKING IS : \", vm.bookout.booking_id);\n\n            vm.complete_flight = true;\n        }\n\n\n\n\n\n        var compile_invoice = function(){\n            var items = [];\n            // vm.plane_charges\n            //add plane costs\n\n            if(vm.package_used && vm.package_removed && vm.package_removed.length > 0){\n                for(var i=0;i<vm.package_removed.length;i++){\n                    var uuint = (vm.package_removed[i].hours_dual_spent > 0) ? vm.package_removed[i].hours_dual_spent : vm.package_removed[i].hours_solo_spent;\n                    items.push({package_id: vm.package_removed[i].package_id, title: \"Package: \"+vm.package_removed[i].title, hours: uuint, hours_type: vm.package_removed[i].solo_dual, member_packages_id: vm.packages[i].id, unit_price: 0, total: 0, organise: 0});\n                    \n                }\n            //items.push({title: \"Plane \"+vm.plane_charges.plane_charge_type+\" Charge\", unit: vm.plane_charges.plane_units, unit_price: vm.plane_charges.plane_unit_price, total: vm.plane_charges.plane_total, organise: 0});\n            }\n\n            items.push({title: \"Aircraft \"+vm.plane_charges.plane_charge_type+\" Charge\", unit: vm.plane_charges.plane_units, unit_price: vm.plane_charges.plane_unit_price, total: vm.plane_charges.plane_total, organise: 0});\n            if(vm.plane_charges.surcharge_total > 0){\n                items.push({title: \"Surcharge per \"+vm.plane_charges.surcharge_charge_type, unit: vm.plane_charges.surcharge_units, unit_price: vm.plane_charges.surcharge_unit_price, total: vm.plane_charges.surcharge_total, organise: 1});\n            }\n            if(vm.plane_charges.tuition_total > 0){\n                items.push({title: \"Tuition Charge - \"+vm.bookout.tuition_required.title, unit: vm.plane_charges.tuition_units, unit_price: vm.plane_charges.tuition_unit_price, total: vm.plane_charges.tuition_total, organise: 2});\n            }\n            if(vm.plane_charges.landing_total > 0){\n                items.push({title: \"Home Landing\", unit: vm.plane_charges.landing_units, unit_price: vm.plane_charges.landing_unit_price, total: vm.plane_charges.landing_total, organise: 4});\n            }\n            if(vm.plane_charges.tng_total > 0){\n                items.push({title: \"Home Touch and Go\", unit: vm.plane_charges.tng_units, unit_price: vm.plane_charges.tng_unit_price, total: vm.plane_charges.tng_total, organise: 3});\n            }\n           \n\n            //RENTAL ITEMS !? --> make it free for now...\n\n            for(var i=0;i<vm.plane_charges.receipts.length;i++){\n                var org = parseInt(5 + i)\n                items.push({title: \"Reimbursement - \"+vm.plane_charges.receipts[i].item, unit: vm.plane_charges.receipts[i].quantity, unit_price: (vm.plane_charges.receipts[i].price / vm.plane_charges.receipts[i].quantity), total: -vm.plane_charges.receipts[i].price, organise: org});\n            }\n\n            return items;\n        }\n\n\n\n        vm.get_package_html = function(pack_obj){\n            var used_on = \"\";\n            for(var i=0;i<pack_obj.aircraft.length;i++){\n                used_on = used_on + \" \" + pack_obj.aircraft[i].registration +\" (\"+ pack_obj.aircraft[i].plane_type +\") <br />\";\n            }\n            var text = \"\";\n            if(pack_obj.validity == 0){\n               text = \"Package purchased on: \"+moment(pack_obj.created_at).format(\"D MMM Y\")+\"<br /> Package does not expire <br /> To be used on:<br />\";\n            } else {\n               text = \"Package purchased on: \"+moment(pack_obj.created_at).format(\"D MMM Y\")+\"<br /> Package expires on: \"+ moment(pack_obj.created_at).add(pack_obj.validity, \"days\").format(\"D MMM Y\") +\" <br /> To be used on:<br />\";\n            }\n    \n            return text+used_on;\n\n        }\n\n\n        vm.convert_decimal_to_hours = function(number){\n            \n            var sign = (number >= 0) ? 1 : -1;\n\n            // Set positive value of number of sign negative\n            number = number * sign;\n\n            // Separate the int from the decimal part\n            var hour = Math.floor(number);\n            var decpart = number - hour;\n\n            var min = 1 / 60;\n            // Round to nearest minute\n            decpart = min * Math.round(decpart / min);\n\n            var minute = Math.floor(decpart * 60) + '';\n\n            // Add padding if need\n            if (minute.length < 2) {\n            minute = '0' + minute; \n            }\n\n            // Add Sign in final result\n            sign = sign == 1 ? '' : '-';\n\n            // Concate hours and minutes\n            var time = sign + hour + ':' + minute;\n\n            return time;\n\n        }\n\n\n\n\n        //complete the booking back in\n        vm.book_in_flight = function(where_to = \"home\", payment = \"none\", paymentIntent = \"\"){\n            vm.show_loading = true;\n\n            //need to make sure that this is not the instructor paying for the flight..... \n            //If the instructor / management fills in these details, we want to make sure that the actual user gets charged.\n            // console.log(\"vm.this_pls_id_raw\", vm.this_pls_id_raw);\n            // console.log(\"vm.bookout.booking_id 1 - \", vm.bookout.booking_id);\n\n\n\n            // //to generate the payment side::::\n            // vm.plane_charges\n            // vm.payment_card \n            // vm.user.id\n\n\n            // //defects already reported\n            // //receipts already reported\n\n            // //need to check / update::: \n            // detail_type_id\n            // from_airport_id\n            // to_airport_id\n            // //if from_airport_id == to_airport_id ==> detail_type_id = 1 (local)\n\n\n            // pic_id\n            // tacho_start\n            // tacho_end\n            // brakes_off\n            // brakes_on\n            // //need to total the added receipts's quantities\n            // oil_uplift_litres\n            // fuel_uplift_litres\n\n            // full_stop_landings\n            // touch_and_go \n\n            // booked_in = 1\n            // flight_date = today\n\n\n            // dual_flight - mention\n            // var dual_flight = (vm.bookout.pic_id !== vm.bookout.user_id)? 1 : 0;\n\n\n            // var from_airfield = (vm.bookout.)\n\n            \n\n            //\n            var flag_flight = false;\n\n            //need to check that the start tacho has not been altered ==> otherwise we need to flag this....\n            var oil = 0;\n            var fuel = 0;\n            for(var i=0;i<vm.lubricant_receipts.length;i++){\n                if(vm.lubricant_receipts[i].item == \"Fuel\"){\n                    fuel = Number.parseFloat(fuel) + Number.parseFloat(vm.lubricant_receipts[i].quantity);\n                } else {\n                    oil = Number.parseFloat(oil) + Number.parseFloat(vm.lubricant_receipts[i].quantity);\n                }\n            }\n\n\n            //landings\n            var total_landings = parseInt(parseInt(vm.bookout.landings) + parseInt(vm.bookout.tng) + parseInt(vm.bookout.remote_landings));\n            if(total_landings < 1){\n                if(confirm(\"It looks as though you didn't land, is that correct?\")){\n                    //console.log(\"how does a plane go for a flight but doesn't land anywhere?\");\n                    flag_flight = true;\n                    //repositioning on airfield, maybe?\n                } else {\n                    return false;\n                }\n            }\n\n            //only if we charge by tacho - surely?\n            //if start tacho was not start tacho....\n            if(vm.bookout.plane_charges.charge_type == \"tacho\" || vm.bookout.plane_charges.charge_type == \"hobbs\"){\n                if(Number.parseFloat(vm.start_tacho_orig) !== Number.parseFloat(vm.bookout.start_tacho)){\n                   if(confirm(\"It looks as though your start meter reading [\"+vm.bookout.start_tacho+\"] is not the same as the previous flight's last meter reading of \"+vm.start_tacho_orig+\" - is that correct?\")){\n                        //console.log(\"Someone seems to have a different tacho reading... need to flag this to management to check...\");\n                        flag_flight = true;\n                        //repositioning on airfield, maybe?\n                    } else {\n                        return false;\n                    } \n                }\n            }\n\n\n\n\n            // WHEN A USER ENTERS A NEW AIRFIELD / STRIP INTO THE SYSTEM ::: \n            // the vm.bookout.from_airfield.id = 0 \n            // OR\n            // vm.bookout.to_airfield.id = 0\n            // we need a switchcase to add the airport details in the send if a number is not already in there\n            // then if the ID = 0, and the new_from_airport is filled in, we add it to the DB before we add the logbook entry\n            // then we flag that entry as \"NEW AIRFIELD --> PLEASE VERIFY THE ENTRY for an admin to double check\"\n            // should be straight forward entry \n\n            // then once this is complete - we need to look at the problem with empty brakes time / estimated flight time\n            // then we need to look at the logbooks --> separate the Engine, Prop, Airframe logbooks, and keep a separate tab on there\n\n\n            var is_dual_flight = 0;\n            if(vm.bookout.instructor_id > 0 && vm.bookout.tuition_id > 0){\n                is_dual_flight = 1;\n            }\n\n            if(is_dual_flight == 0 && vm.put_id > 0 && vm.pic_id !== vm.put_id){\n                is_dual_flight = 1;\n            } else if(is_dual_flight == 0 && vm.put_id > 0){\n                is_dual_flight = 1;\n            }\n\n            var authorised_solo = 0;\n            var authorised_by = 0;\n            if(vm.this_was_supervised_solo){\n                authorised_solo = 1;\n                if(vm.bookout.instructor && vm.bookout.instructor.user_id){\n                    authorised_by = vm.bookout.instructor.user_id;\n                } else if(vm.bookout.instructor_id > 0){\n                    authorised_by = vm.bookout.instructor_id;\n                }\n            }\n\n            //must be a claimed flight\n            var bookout_user_id = vm.bookout.user_id;\n            if(!bookout_user_id || bookout_user_id == 0){\n                bookout_user_id = vm.bookout.payer_id;\n            }\n\n            var bookout_instructor_id = vm.bookout.instructor_id;\n            if(!bookout_instructor_id || bookout_instructor_id == 0 && is_dual_flight == 1 && vm.bookout.pic_id > 0){\n                bookout_instructor_id = vm.bookout.pic_id;\n            }\n\n\n\n            var put_id = vm.bookout.put_id;\n            if(put_id == 0 && is_dual_flight == 1){\n                put_id = vm.bookout.payer_id;\n            }\n\n            var pic_id = vm.bookout.pic_id;\n            if(pic_id == 0 && is_dual_flight == 0){\n                pic_id = vm.bookout.payer_id;\n            }\n            if(pic_id == 0 && vm.bookout.payer_id > 0 && bookout_instructor_id == 0){\n                pic_id = vm.bookout.payer_id;\n            }\n\n            var to_airport_id = (vm.bookout.flight_type.id == 1)? vm.bookout.from_airfield.id : vm.bookout.to_airfield.id;\n\n            if(is_dual_flight == 1 && bookout_instructor_id < 1){\n                //instructor wasn't set above...\n                console.log(\"did we forget to set the FI?\");\n            }\n\n            var pay_with = {method: {}, method_name: \"\"};\n\n            // if(payment == '' || payment == 'none'){\n            //     // alert('unset payment method');\n            // } else if(payment == 'cc'){\n            //     // alert('pay by card');\n            //     pay_with.method = vm.payment_card;\n            //     pay_with.method_name = \"stripe\";\n            // } else if (payment == 'dd'){\n            //     // alert('pay by direct debit');\n            //     pay_with.method = vm.info;\n            //     pay_with.method_name = \"gocardless\";\n            // } else if (payment == 'cm'){\n            //     // alert('pay by card machine');\n            //     pay_with.method_name = \"cardmachine\";\n            // } else {\n            //     alert('not sure on payment method');\n            // }\n\n\n           \n\n            // console.log(\"PAY WITH : \", pay_with);\n           // return false;\n\n\n            var obj = {\n                user_id: bookout_user_id,\n                club_id: vm.bookout.club_id,\n                plane_id: vm.bookout.plane_id,\n                instructor_id: bookout_instructor_id,\n                booking_id: vm.bookout.booking_id,\n                payer_id: vm.bookout.payer_id,\n                plane_log_sheet: {\n                    dual_flight: is_dual_flight,\n                    authorised_solo: authorised_solo,\n                    authorised_by: authorised_by,\n                    tuition_id: vm.bookout.tuition_id,\n                    course_id: vm.bookout.course_id,\n                    club_id: vm.bookout.club_id,\n                    plane_id: vm.bookout.plane_id,\n                    pic_id: pic_id,\n                    put_id: put_id,\n                    user_id: bookout_user_id,\n                    payer_id: vm.bookout.payer_id,\n                    detail_type_id: vm.bookout.flight_type.id,\n                    from_airport_id: vm.bookout.from_airfield.id,\n                    to_airport_id: to_airport_id,\n                    tacho_start: vm.bookout.start_tacho,\n                    tacho_end: vm.bookout.end_tacho,\n                    brakes_off: vm.bookout.brakes_off.time,\n                    brakes_on: vm.bookout.brakes_on.time,\n                    oil_uplift_litres: oil,\n                    fuel_uplift_litres: fuel,\n                    full_stop_landings: vm.bookout.landings,\n                    touch_and_go: vm.bookout.tng,\n                    remote_landings: vm.bookout.remote_landings,\n                    booked_in: 1,\n                    original_id: vm.this_pls_id_raw.id,\n                    booked_in_by: vm.user.id //,\n                    // authorised_solo: (vm.bookout.authorised_solo)? true : false\n                },\n                invoice: compile_invoice(),\n                paying_now: vm.complete_flight,\n                pay_with: pay_with,\n                free_flight: vm.free_flight,\n                paymentIntent: paymentIntent,\n                // card_id: (vm.complete_flight && !vm.free_flight && !vm.can_authorise && vm.payment_card.id > 0)? vm.payment_card.id : 0,\n                flag_flight: flag_flight\n            };\n\n\n\n            if(payment == \"new-card\"){\n                obj.paymentIntent = paymentIntent;\n                obj.method = payment;\n                obj.pay_with.method = payment;\n                obj.pay_with.method_name = payment;\n            } else if(payment == \"saved-card\"){\n                obj.paymentIntent = paymentIntent;\n                obj.method = payment;\n                obj.pay_with.method = payment;\n                obj.pay_with.method_name = payment;\n            } else if(payment == \"direct-debit\"){\n                //nothing to add - it should just work...\n                obj.method = payment;\n                obj.pay_with.method = payment;\n                obj.pay_with.method_name = payment;\n            } else if(payment == \"card-machine\"){\n                //nothing here at the moment?\n                obj.paymentIntent = paymentIntent;\n                obj.method = payment;\n                obj.pay_with.method = payment;\n                obj.pay_with.method_name = payment;\n            } else if(payment == \"free\"){\n                obj.method = payment;\n                obj.pay_with.method = payment;\n                obj.pay_with.method_name = payment;\n            }\n\n            //otherwise leave default\n\n\n\n\n            if(to_airport_id == 0){\n                obj.plane_log_sheet.new_to_airport = vm.bookout.to_airfield;\n                obj.plane_log_sheet.new_to_airport.title = obj.plane_log_sheet.new_to_airport.title.replace(\"NOT LISTED : \", \"\");\n            }\n\n            if(vm.bookout.from_airfield.id == 0){\n                obj.plane_log_sheet.new_from_airport = vm.bookout.from_airfield;\n                obj.plane_log_sheet.new_from_airport.title = obj.plane_log_sheet.new_from_airport.title.replace(\"NOT LISTED : \", \"\");\n            }    \n\n            \n\n\n            //we need to add some items if this links to a FOX AVIONIX FLIGHT LOG\n            obj.plane_log_sheet.fox_log_id = vm.bookout.fox_log_id;\n            obj.plane_log_sheet.fox_claimed = 1;\n\n            obj.plane_log_sheet.takeoff_time = vm.bookout.takeoff_time;\n            obj.plane_log_sheet.landing_time = vm.bookout.landing_time;\n\n            if(vm.has_used_claimed_flight && vm.claimed_flight && vm.claimed_flight.takeoff_time && vm.claimed_flight.takeoff_time !== \"\"){\n                obj.plane_log_sheet.takeoff_time = vm.claimed_flight.takeoff_time;\n                obj.plane_log_sheet.landing_time = vm.claimed_flight.landing_time;\n\n                obj.plane_log_sheet.landing_rounded = vm.claimed_flight.landing_rounded;\n                obj.plane_log_sheet.takeoff_rounded = vm.claimed_flight.takeoff_rounded;\n            }\n            // console.log(\"TAKEOFF TIME 1 : \", obj.plane_log_sheet.takeoff_time);\n            // console.log(\"TAKEOFF TIME 1 : \", vm.bookout.takeoff_time);\n            // console.log(\"CLAIMED: \", vm.claimed_flight);\n\n            \n            \n            // console.log(\"TAKEOFF TIME 2 : \", obj.plane_log_sheet.takeoff_time);\n\n            obj.plane_log_sheet.brakes_time = vm.flight_units.brakes_to_brakes;\n            obj.plane_log_sheet.airborne_time = vm.flight_units.airborne_times;\n\n\n            //THIS IS THE KEY HERE delete this one once selected / complete\n            obj.plane_log_sheet.claimed_fox_plane_log_sheet_id = vm.claimed_flight.id;\n\n            if(vm.split_flight && vm.split_one){\n                obj.plane_log_sheet.brakes_off_rounded = vm.split_one.brakes_off_rounded;\n                obj.plane_log_sheet.brakes_on_rounded = vm.split_one.brakes_on_rounded;\n                obj.plane_log_sheet.takeoff_time = vm.split_one.takeoff_time;\n                obj.plane_log_sheet.landing_time = vm.split_one.landing_time;\n                obj.plane_log_sheet.takeoff_rounded = vm.split_one.takeoff_rounded;\n                obj.plane_log_sheet.landing_rounded = vm.split_one.landing_rounded;\n                obj.plane_log_sheet.airborne_rounded = vm.split_one.airborne_rounded;\n                obj.plane_log_sheet.brakes_times_rounded = vm.split_one.brakes_times_rounded;\n                obj.plane_log_sheet.brakes_time = vm.split_one.brakes_time;\n                obj.plane_log_sheet.flight_time = vm.split_one.flight_time;\n                obj.plane_log_sheet.airborne_time = vm.split_one.airborne_time;\n                obj.plane_log_sheet.flight_time = vm.split_one.flight_time;\n            }\n\n            if(vm.split_flight == 1 && vm.split_two && vm.split_two !== \"\"){\n\n                //if there was a split - this is where we sort out the magic to go with it!\n                console.log(\"vm.bookout.booking_id \", vm.bookout.booking_id);\n                console.log(\"vm.split_two.booking \", vm.split_two.booking);\n                delete vm.split_two.booking;\n                delete vm.split_two.passengers;\n                delete vm.split_two.from_airport;\n                delete vm.split_two.to_airport;\n                delete vm.split_two.plane_charges;\n                delete vm.split_two.tuition_charges;\n                delete vm.split_two.tuition_required;\n                delete vm.split_two.pilot_in_command;\n                delete vm.split_two.home_airport_id;\n                delete vm.split_two.aircraft;\n                delete vm.split_two.stops;\n                delete vm.split_two.user;\n                delete vm.split_two.last_tacho;\n                delete vm.split_two.instructor;\n                delete vm.split_two.id;\n\n                // if there was an update of the destination on the book-in\n                // and the flight was split - then they must start from that point \n                //on the next flight (hopefully anyway!!)\n\n                if(to_airport_id > 0 && to_airport_id !== vm.split_two.from_airport_id){\n                    vm.split_two.from_airport_id = to_airport_id;\n                }\n                //we didn't de-construct this - hence why this is not needed.\n                // vm.split_two.brakes_on = vm.split_two.brakes_on.time;\n                // vm.split_two.brakes_off = vm.split_two.brakes_off.time;\n\n                if(vm.split_two && vm.split_two.brakes_on && vm.split_two.brakes_on.time){\n                    vm.split_two.brakes_on = vm.split_two.brakes_on.time;\n                }\n                if(vm.split_two && vm.split_two.brakes_off && vm.split_two.brakes_off.time){\n                    vm.split_two.brakes_off = vm.split_two.brakes_off.time;\n                }\n                if(vm.split_two){\n                    vm.split_two.is_split_flight = 1;\n                }\n\n                if(vm.split_two && obj.plane_log_sheet.booking_id && obj.plane_log_sheet.booking_id > 0){\n                    vm.split_two.booking_id = obj.plane_log_sheet.booking_id;\n                }\n               \n\n                obj.plane_log_sheet.split_two = vm.split_two;\n\n                obj.plane_log_sheet.is_split_flight = 1;\n\n            }\n            \n           \n\n            //IF THIS IS THE COMPLETION OF THE SPLIT FLIGHTS\n            if(vm.is_split_flight && vm.is_split_flight == 1 && vm.split_flight == 0){\n                //chances are this is when it is complete??\n                //vm.is_split_complete = 1;\n                obj.plane_log_sheet.is_split_complete = 1;\n\n            }\n\n            // console.log(\"is_split_flight : \", vm.is_split_flight);\n            // console.log(\"split_flight : \", vm.split_flight);\n            // console.log(\"obj pls \", obj.plane_log_sheet);\n            // return false;\n\n\n            if(obj && obj.plane_log_sheet && obj.plane_log_sheet.takeoff_time && obj.plane_log_sheet.takeoff_time.time && obj.plane_log_sheet.takeoff_time.time !== \"\"){\n                obj.plane_log_sheet.takeoff_time = obj.plane_log_sheet.takeoff_time.time;\n            }\n\n            if(obj && obj.plane_log_sheet && obj.plane_log_sheet.landing_time && obj.plane_log_sheet.landing_time.time && obj.plane_log_sheet.landing_time.time !== \"\"){\n                obj.plane_log_sheet.landing_time = obj.plane_log_sheet.landing_time.time;\n            }\n            \n\n             // console.log(\"TO BE SENDING : \", obj);\n             // console.log(\"where_to : \", where_to);\n             // console.log(\"TO BE SENDING : \", obj);\n\n            // console.log(obj);\n            // return false;\n\n            //return false;\n            //vm.bookout.id is actually a plane_log_sheet_id ??? \n\n            BookoutService.BookInFlight(vm.bookout.id, obj)\n            .then(function(data){\n                ////console.log(\"SENT - \", data);\n\n                vm.after_where_to = where_to;\n                vm.after_data = data;\n                \n\n                //STOPPPPP\n                            //return false;\n                //vm.show_loading = false;\n                \n                if(data.success){\n                    console.log(\"paymentID\", vm.paymentID);\n                    if(data.paymentID){\n                        vm.payment_id = data.paymentID;\n                        vm.paymentID = data.paymentID;\n                    }\n\n                    if(pay_with.method_name == \"cardmachine\"){\n                        console.log(\"paymentID 1\", vm.paymentID);\n                        console.log(\"paymentID 2\", data.paymentID);\n\n                        vm.show_cardmachine = true;\n                      \n                        poll_check_payment(data.paymentID, 30, function(result) {\n                            if (result) {\n                                //alert(\"Payment confirmed!\");\n                                vm.stop_polling = true;\n                                 vm.show_loading = false;\n                                after_success_bookin(where_to, data);\n                            } else {\n                                //alert(\"Payment not confirmed - please try again\");\n                                 vm.show_loading = false;\n                            }\n                        });\n                        console.log(\"check_payment \", check_payment);\n                       \n\n\n                    } else {\n                         vm.show_loading = false;\n                        vm.stop_polling = true;\n                        after_success_bookin(where_to, data);\n                    }\n\n                \n                } else {\n\n                    if(pay_with.method_name == \"stripe\" && data.card_processor){\n                        //we need to show the 3DS secondary auth\n                        // alert(\"Your card processor requires authentication\");\n                        console.log(\"BEFORE STRIPE = \", data);\n\n                        var stripe = Stripe(EnvConfig.getStripeKey());\n                        stripe.confirmCardPayment(\n                          data.client_secret,\n                          {\n                            payment_method: data.payment_method,\n                            return_url: data.card_url.return_url\n                          },\n                          // Disable the default next action handling.\n                          // {handleActions: false}\n                        ).then(function(result) {\n                          // Handle result.error or result.paymentIntent\n                          // More details in Step 2.\n                          console.log(result);\n                         \n                          if(result.error) {\n                            console.error(result.error);\n                            if(result.error.code == \"payment_intent_authentication_failure\"){\n                                //alert(\"You have failed to pass your card issuer's authentication - please try again or pay with another payment method.\");\n                                vm.show_loading = false;\n                                after_success_bookin(where_to, data);\n                            }\n                          } else if(result.paymentIntent.status === 'succeeded') {\n                            console.log('Payment successful!');\n                            //we need to let the server know the payment was successful so it can be entered into the transaction list\n                            BookoutService.CheckPayment(data.paymentID)\n                                .then(function(data){\n                                    if(data.success){\n                                       \n                                        vm.show_loading = false;\n                                        after_success_bookin(where_to, data);\n                                        \n                                    } else {\n                                       // alert(\"We encountered an error - this invoice will be visible in your invoices for completion\");\n                                        console.log(\"NOTHING SENT?\");\n                                        vm.show_loading = false;\n                                    }\n                                });\n\n                            \n\n                          } else {\n                            console.log(\"not sure what happened\");\n                             vm.show_loading = false;\n                          }\n\n\n                        });\n\n\n                    } else if(data.error){\n\n                        //there was an error with the link to the card machine...\n                        ToastService.error('Card Machine Error', 'There was an error connecting to the card machine - please ensure that the card machine is ON and connected to the internet.');\n                         vm.show_loading = false;\n                        vm.show_cardmachine = true;\n\n                    } else {\n                        ToastService.error('Error', 'An error occurred: ' + data.message);\n                         vm.show_loading = false;\n                    }\n\n                    // //console.log(data);\n                }\n            });\n\n        }\n\n        vm.close_machine_popup = function(){\n\n            //clear the card machine and close the popup??\n\n            //at this point the flight probably has already been booked back in... lets consider how to give options for payment\n             BookoutService.ClearMachine(vm.payment_id, vm.club_id)\n            .then(function(data){\n                if(data.success){\n                    console.log(\"machine should be clear now?\", data);\n                    vm.show_cardmachine = false;\n                    vm.show_after_bookedin = true;\n\n                } else {\n                    console.log(\"No success on card machine clear\");\n                    //at this point the flight probably has already been booked back in... lets consider how to give options for payment\n                    vm.show_cardmachine = false;\n                    vm.show_after_bookedin = true;\n                }\n            });\n\n\n\n            // vm.show_cardmachine = false;\n            // vm.show_after_bookedin = true;\n\n        }\n\n        vm.cancel_machine = function(){\n\n            //cancel the payment request?\n            BookoutService.ClearMachine(vm.payment_id, vm.club_id)\n            .then(function(data){\n                if(data.success){\n                    console.log(\"machine should be clear now?\", data);\n                    vm.show_cardmachine = false;\n                    //at this point the flight probably has already been booked back in... lets consider how to give options for payment\n                    vm.show_after_bookedin = true;\n                    vm.stop_polling = true;\n\n                } else {\n                    console.log(\"No success on card machine clear\");\n                    //at this point the flight probably has already been booked back in... lets consider how to give options for payment\n                    vm.show_after_bookedin = true;\n\n                }\n            });\n\n\n\n        }\n\n        vm.close_bookedin = function(){\n\n            BookoutService.ClearMachine(vm.payment_id, vm.club_id)\n            .then(function(data){\n                 //once cleared - we continue?\n                 console.log(\"regardless of clear - should now be cleared?\");\n                 vm.show_cardmachine = false;\n                 vm.show_after_bookedin = false;\n                 vm.stop_polling = true;\n                 after_success_bookin(vm.after_where_to, vm.after_data);\n            });\n\n        }\n\n\n        vm.reset_card_machine = function(){\n\n            console.log(\"retry\", vm.payment_id);\n            //try to send the request a second time to the machine?\n             BookoutService.RetryPaymentMachine(vm.payment_id, vm.club_id)\n            .then(function(data){\n                console.log(data);\n                if(data.success){\n                    ToastService.success('Payment Sent', 'The card machine should hopefully be displaying the payment now');\n                    //create new poll??\n                    vm.stop_polling = false;\n                    poll_check_payment(vm.payment_id, 30, function(result) {\n                        if (result) {\n                            ToastService.success('Payment Confirmed', 'Payment confirmed!');\n                            vm.stop_polling = true;\n                            after_success_bookin(vm.after_where_to, vm.after_data);\n                        } else {\n                            ToastService.error('Payment Failed', 'Payment not confirmed - please try again');\n                        }\n                    });\n                } else {\n                    if(data.success == false && data.message == \"The payment has already been successfully made.\"){\n                        vm.stop_polling = true;\n                        after_success_bookin(vm.after_where_to, vm.after_data);\n                    }\n                    ToastService.error('Payment Error', data.message);\n                }\n\n            });\n\n\n            vm.show_cardmachine = true;\n\n        }\n\n        function poll_check_payment(id, maxAttempts, finalCallback) {\n            var attempts = 0;\n\n                function attempt() {\n                    check_payment(id, function(success) {\n                        attempts++;\n                        if (success) {\n                            console.log(\"Payment confirmed!\");\n                            finalCallback(true);\n                        } else if (attempts >= maxAttempts) {\n                            console.log(\"Max attempts reached, giving up.\");\n                            finalCallback(false);\n                        } else if (vm.stop_polling) {\n                            console.log(\"called to stop polling\");\n                            finalCallback(false);\n                            return;\n                        } else {\n                            console.log(\"Retrying in 10000 ms...\");\n                            setTimeout(attempt, 10000);\n                        }\n                    });\n                }\n\n                attempt(); // Start polling\n        }\n\n        function get_update_on_cardmachine(payment_id, retry, limit, callback2){\n            if(retry <= limit){\n\n                check_payment(payment_id, function(result) {\n                    if (result) {\n                        // do something if true\n                        console.log(\"RESPONSE FROM CHECK PAYMENT IS TRUE\");\n                        callback2(true);//{success: true, message: \"payment checked & done\"};\n                    } else {\n                        // do something if false\n                         console.log(\"delay and try again?\");\n                    \n                        setTimeout(() => {\n                          console.log(\"Delayed for 5 second.\", payment_id);\n                          console.log(\"Delayed for 5 second.\", vm.payment_id);\n                          retry++;\n                          callback2(get_update_on_cardmachine(payment_id, retry, limit, callback));\n                        }, 10000);\n                    }\n                });\n\n                // var status_card = check_payment(payment_id);\n                // console.log(\"STATUS HERE:\", status_card);\n                // if(status_card){\n                //     console.log(\"RESPONSE FROM CHECK PAYMENT IS TRUE\");\n                //     return true;//{success: true, message: \"payment checked & done\"};\n                // } else {\n                //     console.log(\"delay and try again?\");\n                    \n                //     setTimeout(() => {\n                //       console.log(\"Delayed for 5 second.\", payment_id);\n                //       console.log(\"Delayed for 5 second.\", vm.payment_id);\n                //       retry++;\n                //       return get_update_on_cardmachine(payment_id, retry, limit);\n                //     }, 10000);\n                // }\n            } else {\n                console.log(\"over limit?\");\n                callback2(false);// false;//{success: false, message: \"too many attempts\"};\n            }\n        }\n\n        function check_payment(id, callback){\n\n            BookoutService.CheckPayment(id)\n            .then(function(data){\n                if(data.success){\n                    console.log(\"check payment\", data);\n                    if(data.status){\n                        console.log(\"status = true\");\n                         callback(true);\n                    } else {\n                        console.log(\"status = false\");\n                         callback(false);\n                    }\n                    \n                } else {\n                        console.log(\"NOTHING SENT?\");\n                         callback(false);\n                }\n            });\n\n           // return false;\n\n        }\n\n\n\n        function after_success_bookin(where_to, data){\n                if(where_to == \"home\"){\n                        $state.go('dashboard.my_account', {}, { reload: true });\n                    } else if(where_to == \"debrief\") {\n                        console.log(\"DEBRIEF!!\");\n                        //if((vm.user.id == vm.bookout.instructor_id) && (vm.bookout.booking_id > 0 || vm.bookout.course_id > 0)){\n                        if((vm.user.id == vm.bookout.instructor_id || (vm.user.id == vm.bookout.pic_id && vm.bookout.put_id > 0)) && (vm.bookout.booking_id > 0 || vm.bookout.course_id > 0) ){\n                          console.log(\"DEBRIEF 2!!\");\n\n                          // /debriefing/:booking_id/:plane_log_sheet_id\n                          //:split_next_id/:split_booking_id\n                          /*\n                            \"plane_log_sheet_id\" => $split_two_id, --> data.split.plane_log_sheet_id\n                            \"booking_id\" => $booking_id --> data.split.booking_id\n                          */\n                          //\n                              var booking_id = 0;\n                              if(vm.bookout.booking_id < 1){\n                                  booking_id = data.split.booking_id;\n                              } else {\n                                  booking_id = vm.bookout.booking_id;\n                              }\n\n                            if(data.split){\n                              console.log(\"DEBRIEF WITH DATA RESPONSE\");\n                              console.log(data);\n                              // return false;\n\n                                $state.go('dashboard.manage_user.debriefing', { booking_id: booking_id, plane_log_sheet_id: vm.bookout.id, split_next_id: data.split.plane_log_sheet_id, split_booking_id: data.split.booking_id }, { reload: true });\n                            } else {\n                              console.log(\"DEBRIEF without DATA RESPONSE\");\n                              // return false;\n                                $state.go('dashboard.manage_user.debriefing', { booking_id: booking_id, plane_log_sheet_id: vm.bookout.id, split_next_id: 0, split_booking_id: 0 }, { reload: true });\n                            }\n\n                        } else {\n                          console.log(\"DEBRIEF 3!!\");\n                          // return false;\n                            $state.go('dashboard.my_account', {}, { reload: true });\n                        }                        \n\n                    } else if(where_to == \"split\") {\n\n                        console.log(\"SPLIT HERE\");\n                        // //console.log(\"BOOKING _ID \"+vm.bookout.booking_id);\n                        //originally here --> but we don't want this...\n                       // $state.go('dashboard.my_account.bookout_with_booking', {booking_id: vm.bookout.booking_id, claim_id: vm.claim_id, split: vm.split_two}, {reload: true });\n\n                        var booking_id = 0;\n                        if(vm.bookout.booking_id < 1){\n                            booking_id = data.split.booking_id;\n                        } else {\n                            booking_id = vm.bookout.booking_id;\n                        }\n\n                       if((vm.user.id == vm.bookout.instructor_id || (vm.user.id == vm.bookout.pic_id && vm.bookout.put_id > 0)) && (vm.bookout.booking_id > 0 || vm.bookout.course_id > 0)){\n                              console.log(\"SPLIT AND DEBRIEF???\");\n                          // /debriefing/:booking_id/:plane_log_sheet_id\n                              // console.log(\"SPLIT and success in data obj\");\n                              // // split_flight_id: data.split.plane_log_sheet_id, \n                              // // split_flight_booking_id: data.split.booking_id, \n                              // // split: vm.split_two\n                              // console.log(\"data.split.plane_log_sheet_id : \", data.split.plane_log_sheet_id);\n                              // console.log(\"data.split.booking_id : \", data.split.booking_id);\n                              // console.log(\"split : \", vm.split_two);\n                              //  return false;\n                              $state.go('dashboard.manage_user.debriefing', { booking_id: data.split.booking_id, plane_log_sheet_id: vm.bookout.id, split_next_id: data.split.plane_log_sheet_id, split_booking_id: data.split.booking_id }, { reload: true });\n\n                            // $state.go('dashboard.manage_user.debriefing', {booking_id: vm.bookout.booking_id, plane_log_sheet_id: vm.bookout.id, split_flight_id: data.split.plane_log_sheet_id, split_flight_booking_id: data.split.booking_id, split: vm.split_two }, { reload: true });\n                        } else {\n                              // console.log(\"SPLIT back to account\");\n                              //  return false;\n                            //$state.go('dashboard.my_account', {}, { reload: true });\n\n                            //IF THIS PERSON IS BOOKING IT IN - I THINK THEY SHOULD CONTINUE THIS TO THE END....\n                            $state.go('dashboard.my_account.book_in', {id: data.split.plane_log_sheet_id}, {reload: true });\n\n                        }\n\n\n                    } else {\n                       $state.go('dashboard.my_account.bookout_with_booking', {booking_id: vm.bookout.booking_id}, {reload: true });\n                    }\n        }\n\n        function preselect_course_and_tuition(){\n\n            console.log(\"PRESELECT TUITION NOW\");\n\n\n            if(vm.club_courses.length == 1){\n                //preset it??\n                //console.log(\"length is 1\", vm.bookout.course_id);\n                if(!vm.bookout.course_id || vm.bookout.course_id == 0){\n                   vm.bookout.course_id = vm.club_courses[0].id;\n                   vm.bookout.course = vm.club_courses[0];\n                    //console.log(\"HERE?\", vm.bookout.course);\n                }\n            }\n            console.log(vm.bookout.course_id);\n            console.log(vm.club_courses);\n            if(vm.bookout.course_id > 0){\n                var selected_course = vm.club_courses.find(item => item.id === vm.bookout.course_id);\n                vm.bookout.course = selected_course;\n            }\n\n            if(vm.instructor_charges.length == 1){\n                //var selected_tuition = vm.instructor_charges.find(item => item.id === vm.bookout.instruction_required_id);\n                vm.bookout.tuition_required = vm.instructor_charges[0];\n            }\n\n            vm.update_tuition_charges();\n\n        }\n\n\n        vm.this_claim_was_instructional = false;\n        vm.this_was_supervised_solo = false;\n        vm.start_tacho_orig;\n        vm.send = {};\n\n        function process_bookout_to_bookin(booking){\n\n            // console.log(booking);\n            //vm.bookout is where we want to fill the content....\n            vm.bookout.booking_id = booking.booking_id;\n            vm.bookout.club_id = booking.club_id;\n            vm.bookout.user_id = booking.user_id;\n            vm.bookout.plane = booking.plane;\n            vm.club_id = booking.club_id;\n            vm.is_split_flight = booking.is_split_flight;\n            // vm.bookout.return = new Date(booking.end);\n            // vm.bookout.booking_start = new Date(booking.start);\n            \n            // vm.this_pls_id_raw = vm.bookout.id;\n            //vm.this_pls_id_raw = Object.assign({}, booking);\n\n            vm.send = {\n                club_id: vm.bookout.club_id,\n                user_id: vm.user.id\n                // ,\n                // plane_log_sheet_id: booking.id\n            }\n            // console.log(\"booking\", booking);\n            // console.log(\"booking_id\", booking.booking_id);\n\n            /*\n            VM.SEND --> TO THE PAYMENT MODAL\n                if invoice --> remove booking_id add invoice_id \n                if no invoice / booking --> remove both and add amount * 100\n                ie: amount: vm.invoice_totals * 100,\n                user must be the user for that invoice / PAYER ID --> careful on admin functions\n            */\n\n\n\n             PlaneService.GetCurrencies(vm.club_id)\n             .then(function(data){\n                        vm.currencies = data.currencies;   \n                        vm.club_currency = data.club_currency;\n\n                        vm.receipt.currency = $.grep(vm.currencies, function(e){ \n                            return e.iso_code == vm.club_currency; \n                        })[0];;\n\n                });\n\n\n            \n\n\n\n             //&& vm.bookout.user_id !== vm.user.id --> if no bookout was done, this wont work\n             if(((vm.user.access.instructor.indexOf(vm.club_id) > -1) || (vm.user.access.manager.indexOf(vm.club_id) > -1) ) ){\n                // //console.log(\"NOT BOOKING FOR SELF?\");\n                vm.can_authorise = true;\n\n            }\n\n\n\n            vm.invoices = [];\n            vm.previous_total = 0;\n\n            vm.free_flight = false;\n\n            // //console.log(\"actual stuff = \", booking);\n            //there should also be a PILOT / OWNER -> NO MONEY REQUIRED bit\n            if(booking.booking && booking.booking.maintenance_flight == 1){\n                // //console.log(\"FREE FLIGHT WOOO\");\n                vm.free_flight = true;\n                //vm.plane_charges.total = 0;\n            }\n\n\n\n                //IF THIS IS NOT SPLIT FLIGHT??? OTHERWISE... DISASTER?\n                //need to check functionality before release!!\n                if(vm.is_split_flight == 1){\n                    //console.log(\"IS SPLIT?\");\n\n                    \n                    InvoicesService.GetAllByBooking(booking.booking_id)\n                    .then(function (data) {\n                            //console.log(\"invoice data is : \", data);\n                            if(data.success){\n                                //console.log(\"data\", data.invoices);\n                                // vm.previous_invoice = data.invoice;\n                                vm.previous_invoice = data.invoices;\n\n                                // data.invoices.forEach((invoice) => function(){\n                                //     console.log(\"each invoice\", invoice);\n                                //     invoice.flights.forEach((flight) => function(){\n                                //         console.log(\"each flight\", flight);\n                                //         vm.invoices.push(flight);\n                                //         vm.previous_total = (Number.parseFloat(vm.previous_total) + Number.parseFloat(flight.total));\n                                //     });\n                                // });\n                                for(var i=0;i<data.invoices.length;i++){\n                                     Object.keys(data.invoices[i].flights).forEach(function(key) {\n                                        var flight = data.invoices[i].flights[key];\n                                        //console.log(key, flight);\n                                        vm.invoices.push(flight);\n                                        vm.previous_total = (Number.parseFloat(vm.previous_total) + Number.parseFloat(flight.total));\n                                    });\n\n\n\n                                }\n\n                               \n\n                                // for (var key in data.invoices.flights) {\n                                //     console.log(\"KEY \", key);\n                                //     vm.invoices.push(data.invoices.flights[key]);\n                                //     vm.previous_total = (Number.parseFloat(vm.previous_total) + Number.parseFloat(data.invoices.flights[key][\"total\"]));\n                                //     // for(var i=0;i<data.invoice.flights[key].length;i++){\n                                //     // }\n                                // }\n\n\n                                \n                                \n                                // console.log(\"invoices\", vm.invoices);\n                                // //console.log(\"FLIGHTS TOTAL\", vm.previous_total);\n                                // vm.invoices = data.invoice.flights;\n                            } else {\n                                // //console.log(\"no invoices have yet been issued for this flight\");\n                            }\n\n\n                        });\n\n                } else {\n                    console.log(\"NOT SPLIT?\");\n\n\n                }\n\n            \n\n\n            PlaneService.GetOpenIssues(booking.plane_id)\n            .then(function (data) {\n                    ////console.log(\"data is : \", data);\n                   vm.reported_defects = data;\n                });\n\n              PlaneService.GetAllSheetReceipts(vm.bookout.id)\n                .then(function (data) {\n                    ////console.log(\"data is : \", data);\n                    vm.lubricant_receipts = data;\n                });\n\n\n                InstructorCharges.GetByClubId(booking.club_id)\n                .then(function(data){\n                    vm.instructor_charges = data.items;  \n                });\n\n                \n\n\n                //vm.club_courses = data.items\n\n\n\n\n            //we need to update the PICS now...\n\n           \n            //we need to know where the plane was last booked-in at \n            //(ie: if last flight bookout was completed - where the plane landed at last)\n            //if the last booking was not yet completed, then we can assume that this last flight was returning to base.\n            if((booking && booking.id > 0) || (vm.try_split)){\n                console.log(\"PIC ID: \", booking.pic_id);\n                if(vm.pics && booking.pic_id){\n                    var selected_pic = vm.pics.find(item => item.user_id === booking.pic_id);\n                    console.log(\"selected_pic : \", selected_pic);\n                    vm.bookout.pic = selected_pic;\n                }\n                \n\n\n                // //console.log(\"booking.detail_type_id\", booking.detail_type_id);\n\n                var selected_detail_type = vm.flight_types.find(item => item.id === booking.detail_type_id);\n                vm.bookout.flight_type = selected_detail_type;\n\n                if(booking.instructor && booking.instructor !== \"\" && booking.instructor.user_id == booking.pic_id){\n                    vm.bookout.put = vm.bookout.user;\n                }\n\n\n                if(vm.pics && booking.put_id){\n                    var selected_put = vm.pics.find(item => item.user_id === booking.put_id);\n                    console.log(\"selected_put : \", selected_put);\n                    vm.bookout.put = selected_put;\n                }\n\n                // if(booking.instructor && booking.instructor.user_id > 0 && booking.pic_id == booking.user.id){\n\n                // }\n\n                vm.bookout.authorised_solo = (booking.authorised_solo == 1)? true : false;\n\n\n                vm.bookout.from_airfield = booking.from_airport;\n                vm.bookout.to_airfield = booking.to_airport;\n                \n                if(booking.course_id > 0){\n                    vm.bookout.course_id = booking.course_id;\n                } else if(booking.booking && booking.booking.course_id && booking.booking.course_id > 0){\n                    vm.bookout.course_id = booking.booking.course_id;\n                }\n\n                vm.bookout.start_tacho = Number.parseFloat(booking.last_tacho);\n                \n                vm.start_tacho_orig = booking.last_tacho;\n\n\n\n               \n                 //this is where we sort out some of the last bits....\n\n                //var instructor = vm.pics.find(item => item.user_id === booking.instructor.id);\n                vm.bookout.instructor = booking.instructor;\n                var selected_pic = vm.pics.find(item => item.user_id === booking.pic_id);\n                vm.bookout.pic = selected_pic;\n\n\n            }\n\n\n\n\n\n            // if(booking.instructor && booking.instructor !== \"\" && booking.instructor.id > 0){\n            //     // then we need to set the PIC as the instructor\n            //     //select from pics where user_id = booking.user_id;\n            //     var selected_pic = vm.pics.find(item => item.user_id === booking.instructor.id);\n            //     //set the PIC now...\n            //     vm.bookout.pic = selected_pic;\n            //     vm.bookout.instructor_id = booking.instructor.id;\n            //     vm.bookout.instructor = booking.instructor;\n\n\n            //     var selected_put = vm.pics.find(item => item.user_id === booking.user_id);\n            //     vm.bookout.put = selected_put;\n\n            // } else {\n            //     //then the user is the PIC\n            //     var selected_pic = vm.pics.find(item => item.user_id === booking.user_id);\n            //     vm.bookout.pic = selected_pic;\n\n            // }\n\n       \n\n            if(booking && booking.plane_details && booking.plane_details.location && booking.plane_details.location.wgs_n){\n                vm.wgs_n = booking.plane_details.location.wgs_n\n                vm.wgs_e = booking.plane_details.location.wgs_e;\n            }\n            var location_default = \"\";\n\n            if(booking && booking.plane_details && booking.plane_details.location && booking.plane_details.location.code){\n                location_default = booking.plane_details.location.code.slice(0, -1);\n            } else {\n                location_default = \"EG\";\n            }\n\n            //vm.update_book_in_options();\n\n            BookoutService.GetAirfieldsByCode(location_default)\n                .then(function (data) {\n                    if(data.success){\n                        //use GB airfields first...\n                        vm.airfields = data.airfields;\n                        // var selected_location = vm.airfields.find(item => item.id === booking.plane_details.location.id);\n                        // //console.log(\"selected_location\", selected_location);\n                        // vm.bookout.from_airfield = selected_location;\n                       }\n                    });\n\n\n            if(booking.fox_log_id && booking.fox_log_id > 0){\n                vm.auto_claim = 1;\n                //vm.has_used_claimed_flight = true;\n\n                if(vm.bookout.from_airport.id == vm.bookout.to_airport.id){\n                    if(vm.bookout.touch_and_go > 2){\n                        // circuits 3?\n                        var selected_detail_type = vm.flight_types.find(item => item.id === 3);\n                        vm.bookout.flight_type = selected_detail_type;\n                    } else {\n                        //local flight? 1 \n                        var selected_detail_type = vm.flight_types.find(item => item.id === 1);\n                        vm.bookout.flight_type = selected_detail_type;\n                    }\n\n                } else {\n                    var selected_detail_type = vm.flight_types.find(item => item.id === 2);\n                    vm.bookout.flight_type = selected_detail_type;\n                }\n\n                vm.bookout.brakes_off = {time: vm.bookout.brakes_off};\n                vm.bookout.brakes_on = {time: vm.bookout.brakes_on};\n\n                //vm.bookout.touch_and_go = vm.bookout.touch_and_go;\n                vm.bookout.tng = vm.bookout.touch_and_go;\n                vm.bookout.landings = vm.bookout.full_stop_landings;\n\n//                vm.bookout.fox_log_id = vm.claimed_flight.fox_log_id; already set\n                vm.bookout.fox_claimed = 1;\n\n                vm.has_used_claimed_flight = true;\n                vm.has_requested_to_change_times = false;\n                // vm.bookout.takeoff_time = vm.bookout.takeoff_time;\n                // vm.bookout.landing_time = vm.bookout.landing_time;\n\n                //THIS IS THE KEY HERE delete this one once selected / complete\n                \n\n                if(vm.claimed_flight && vm.claimed_flight.id > 0){\n                    vm.bookout.claimed_fox_plane_log_sheet_id = vm.claimed_flight.id;\n                }\n                if(vm.bookout.fox_log_id > 0){\n                    vm.bookout.claimed_fox_plane_log_sheet_id = vm.bookout.fox_log_id;\n                }\n\n\n\n\n                //WHAT DOES THIS DO!?\n\n                //set the important bits for the invoice now\n                vm.flight_units.brakes_to_brakes = vm.bookout.brakes_time;\n                vm.flight_units.airborne_times = vm.bookout.airborne_time;\n                vm.flight_units.flight_time = vm.bookout.flight_time;\n                vm.flight_units.brakes_times_rounded = vm.bookout.brakes_times_rounded;\n\n                //calculate the invoice yay\n                vm.calculate_invoice_for_flight();\n                vm.flight_times_complete = true;\n\n                // if(vm.bookout.instructor_id > 0 || vm.bookout.put_id > 0 || vm.this_was_instructional_claim || vm.this_claim_was_instructional || vm.bookout.course_id > 0){\n                //    // console.log(\"process bookout to book in\");\n\n                //     preselect_course_and_tuition();\n                // }\n\n                //IF THE PIC is authorised to SOLO\n                //OR IF THE USER IS OWNER-FLIER!!\n\n                // we need to set the PIC as themselves automatically\n                // it feels silly to have to fill it in otherwise. \n\n\n\n            } else { \n                if(vm.bookout.plane_charges.charge_type == \"airborne\" || vm.bookout.plane_charges.charge_type == \"flight\"){\n                    vm.show_takeoff_landing_times = true;\n                }\n                // console.log('else');\n                \n            }\n\n\n\n            CourseService.GetCoursesByClubId(booking.club_id)\n                .then(function(data){\n                    vm.club_courses = data.items;\n\n                    if(vm.bookout.instructor_id > 0 || vm.bookout.put_id > 0 || vm.this_was_instructional_claim || vm.this_claim_was_instructional || vm.bookout.course_id > 0){\n                        // console.log(\"process bookout to book in\");\n                        preselect_course_and_tuition();\n                        //try_split??\n                    }\n                });\n            //booking.plane_details.location.id\n            // vm.bookout.pic = selected_pic;\n\n            // $location.hash('top');\n            // $anchorScroll();\n            if(vm.scroll){\n                vm.scroll = false;\n                smoothScroll.toTop();\n                vm.show_loading = false;\n            }\n            \n\n        }\n\n\n            //nice looking date pickers\n\n\n            $scope.popup = [];\n\n            $scope.open = function(id, $event) {\n                // //console.log(\"THIS\", id);\n                //this comment would allow the event not to be affect by clicking it again... not sure this is a good idea\n                if($scope.popup[id] && $scope.popup[id].opened == true){\n                    $event.preventDefault();\n                    $event.stopPropagation();\n                } else {\n                    $scope.popup[id] = {opened: true};\n                }\n            };\n\n            $scope.formats = ['dd/MM/yyyy', 'yyyy/MM/dd', 'dd.MM.yyyy', 'shortDate'];\n            $scope.format = $scope.formats[0];\n\n            $scope.datePickerOptions = {\n                                        format: 'dd/MM/yyyy',\n                                        showWeeks: false\n                                    };\n\n           \n\n         \n        \n\n\n    }\n app.controller('Bookings2Controller', Bookings2Controller);\n\n    Bookings2Controller.$inject = ['UserService', 'BookoutService',  'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'BookingService', 'InstructorCharges', 'CourseService', 'ToastService'];\n    function Bookings2Controller(UserService, BookoutService,  MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, BookingService, InstructorCharges, CourseService, ToastService) {\n        \n        var vm = this;\n        var defaultStartTime = 480;\n        var defaultEndTime = 1080;\n\n        $scope.va1 = '123';\n        \n        //alert(\"boo\");\n        vm.user = $rootScope.globals.currentUser;\n\n        vm.allUsers = [];\n        vm.club = {};\n        vm.page_title = \"\";\n        vm.club.member = {};\n        \n        vm.imported_new_headers = [];\n        vm.see_booking = {};\n\n        vm.is_current = false;\n        vm.currency_type = \"\";\n        vm.currency_days = \"\";\n\n        vm.booking_self = true;\n\n        vm.times_clean_type = \"start_times\";\n\n        $scope.club_timezone = \"Europe/London\";\n        vm.club_timezone = \"Europe/London\";\n\n        vm.is_edit_show_all = false;\n        // vm.club.member.membership_id = {};\n        \n        vm.action = $state.current.data.action;\n        vm.return_to = $state.current.data.return_to;\n        //vm.club_id = 0;\n\n        // Sliding booking panel state\n        vm.bookingPanelOpen = false;\n        vm.toggleBookingPanel = function() {\n            vm.bookingPanelOpen = !vm.bookingPanelOpen;\n        };\n\n        // Book with a specific instructor from the event popup\n        vm.bookWithInstructor = function(booking) {\n            // Close the event detail popup\n            vm.see_booking.visible = 0;\n\n            // Pre-fill the booking form with the time from the clicked event\n            var now = new Date();\n            var startDate = new Date(now);\n            startDate.setMinutes(0);\n            startDate.setSeconds(0);\n            var endDate = new Date(startDate);\n            endDate.setHours(endDate.getHours() + 1);\n\n            vm.new_booking.start_date = startDate;\n            vm.new_booking.end_date = endDate;\n            vm.new_booking.start_time = {time: moment(startDate).format(\"HH:mm\")};\n            vm.new_booking.end_time = {time: moment(endDate).format(\"HH:mm\")};\n\n            // Pre-select the instructor\n            vm.new_booking.instructor = booking.instructor;\n\n            // Set booking permissions for instructor/admin view\n            vm.booking_self = false;\n            vm.show_self_option = true;\n\n            // Generate datetimes then fetch planes this instructor can teach on\n            $scope.update_dateTime(\"edit2\");\n\n            // Fetch all available planes, then filter to ones this instructor teaches on\n            var start_iso = startDate.toISOString();\n            var end_iso = endDate.toISOString();\n\n            BookingService.GetAllPlanes(vm.user.id, start_iso, end_iso, 0, 0)\n            .then(function(data){\n                var allPlanes = data;\n                var instructor_id = booking.instructor.id;\n\n                // Check each plane to see if this instructor is available for it\n                var planePromises = [];\n                var matchedPlanes = [];\n\n                allPlanes.forEach(function(plane) {\n                    var promise = BookingService.GetPlaneInstructors(vm.user.id, plane.id, start_iso, end_iso, 1)\n                    .then(function(instructors) {\n                        var found = instructors.find(function(inst) {\n                            return parseInt(inst.id) === parseInt(instructor_id);\n                        });\n                        if (found) {\n                            matchedPlanes.push(plane);\n                        }\n                    });\n                    planePromises.push(promise);\n                });\n\n                // Wait for all plane checks, then set filtered planes list\n                // Use a simple counter since we're in AngularJS 1.4 without Promise.all on $http\n                var completed = 0;\n                var total = planePromises.length;\n                planePromises.forEach(function(p) {\n                    p.finally(function() {\n                        completed++;\n                        if (completed === total) {\n                            vm.planes = matchedPlanes.length > 0 ? matchedPlanes : allPlanes;\n                            vm.instructors = [booking.instructor];\n                        }\n                    });\n                });\n            });\n\n            // Open the booking panel\n            vm.bookingPanelOpen = true;\n        };\n\n        //just in case i missed a changed value...\n        vm.user_id = vm.user.id;\n\n        vm.no_show_cols = [\"membership_start\", \"membership_id\", \"selected\"];\n\n        var newDate = new Date();\n        \n        var h_start = Math.floor( defaultStartTime / 60 );          \n        var i_start = defaultStartTime % 60;\n        var h_end = Math.floor( defaultEndTime / 60 );          \n        var i_end = defaultEndTime % 60;\n\n        var defaultStart = new Date(newDate.getFullYear(), newDate.getMonth(), newDate.getDate(), h_start, i_start, 0);\n        var defaultEnd = new Date(newDate.getFullYear(), newDate.getMonth(), newDate.getDate(), h_end, i_end, 0);\n        vm.default_date =  new Date();\n\n        vm.datepickerOptions = {\n            customClass: getDayClass,\n            format: 'dd/MM/yyyy',\n            showWeeks: false,\n            startingDay: 1\n        }\n\n        vm.dateTimeRangePickerOptions = {\n            hour_step: 1,\n            minute_step: 30,\n            min_date: today,\n            datepicker:{\n                customClass: getDayClass,\n                format: 'dd/MM/yyyy',\n                showWeeks: false,\n                minDate: today\n            }\n            ,\n            business_hours: {\n                from: \"09:00\",\n                to: \"22:30\"\n            }\n        };\n\n        $scope.whole_day_booking = false;\n\n\n        // BookingService.GetAll(vm.user.id, moment().format(\"Y-M-D\"), \"\")\n        //     .then(function(data){\n        //         $scope.all_events = data.events;\n        //         $scope.all_resources = data.resources;\n        //     });\n\n\n        vm.instructor_charges = [];\n\n\n\n\n        vm.cancellation = { \n                            reasons: [\n                                \"Pilot Unwell\",\n                                \"Pilot Unavailable\",\n                                \"Weather at home base\",\n                                \"Weather at destination\",\n                                \"Plane Unavailable\",\n                                \"Plane Unserviceable\",\n                                \"Plane Returned Too Late by previous booking\",\n                                \"Instructor Not Available\",\n                                \"Airfield Closed\",\n                                \"Airspace Closed\",\n                                \"Other - please specify\"\n                            ],\n                            notes: \"\"\n                        };\n\n\n\n        var today = new Date();\n        today.setMinutes(0);\n        today.setSeconds(0);\n        // var end = moment(today);\n        // end.add(2, \"hours\");\n        // end = new Date(end);\n        // end.setSeconds(0);\n\n        var end = new Date();\n        end.setHours(end.getHours() + 2);\n        end.setSeconds(0);\n\n\n        var datepicker_today = new Date().format(\"d/M/yyyy\");\n\n\n        vm.start_times = [];\n        vm.end_times = [];\n\n        vm.new_booking = {\n            start_date: today,\n            end_date: today,\n            free_seats: [],\n            passengers: [],\n            options: vm.dateTimeRangePickerOptions\n        };\n\n        $scope.toggle = true;\n        $scope.whentimechangedata = {};\n        $scope.overridePicker = true;\n\n        var date = Date();\n        vm.planes = [];\n        init_times();\n\n      $scope.formats = ['dd/MM/yyyy', 'yyyy/MM/dd', 'dd.MM.yyyy', 'shortDate'];\n      $scope.format = $scope.formats[0];\n        //prepare_add_edit();\n\n\n       \n\n\n        switch(vm.action){\n            case \"add\":\n                // //console.log(\"adding a new member please\");\n                vm.page_title = \"Add a Booking\";\n\n                //update_bookings();\n\n                vm.new_booking = {\n                                    start_date: today,\n                                    end_date: today,\n                                    free_seats: [],\n                                    passengers: [],\n                                    options: vm.dateTimeRangePickerOptions\n                };\n                figure_out_steps();\n\n\n\n\n\n            break;\n            case \"edit\":\n                vm.page_title = \"Edit a Booking\";\n\n                vm.see_booking.visible = 0;\n                vm.bookingPanelOpen = true;\n\n                // vm.default_date = new Date(\"2016-10-11\");\n                vm.new_booking = {\n                                    start_date: today,\n                                    end_date: today,\n                                    free_seats: [],\n                                    passengers: [],\n                                    options: vm.dateTimeRangePickerOptions\n                };\n                figure_out_steps();\n                //vm.new_booking.\n                //get a single events\n                \n                update_bookings();\n\n                    //SSCROLL TOOOOO scroll to --> fc-now-indicator fc-now-indicator-line\n\n\n\n                if($stateParams.booking_id){\n\n\n                     \n\n\n\n\n                     BookingService.GetEdit(vm.user.id, $stateParams.booking_id)\n                        .then(function(data){\n                            // //console.log(\"GETTING CONTENT FROM EDIT : \", data);\n\n                            if(data.success){\n\n\n\n                                // //console.log(\"EDIT THIS CONTENT HERE\", data);\n                                // //console.log(\"CHECK CONTENT FROM RETURN\", data.booking.instructor);\n\n                                vm.new_booking = data.booking;\n\n\n\n\n\n                                if(vm.user.access.instructor.indexOf(data.booking.club_id) > -1 || vm.user.access.manager.indexOf(data.booking.club_id) > -1){\n                                    // //console.log(\"THIS IS AN INSTRUCTOR IN THIS CLUB...\");\n                                    \n                                    vm.show_self_option = true;\n                                }\n\n                                if(data.booking.user_id == vm.user.id){\n                                    vm.booking_self = true;\n                                } else {\n                                    vm.booking_self = false;\n                                }\n\n                                if(data.booking.maintenance_flight == 1){\n                                    vm.new_booking.maintenance_flight = true;\n                                }\n\n                                // //console.log(\"MY INSTRUCTOR HERE: \", vm.new_booking.instructor);\n                                vm.new_booking.options = vm.dateTimeRangePickerOptions;\n                                vm.new_booking.edit_booking = 1;\n\n\n\n                                // console.log(\"GET EDIT - \", vm.new_booking.start);\n                                vm.new_booking.start_date = moment(vm.new_booking.start).toDate(); //new Date(vm.new_booking.start);\n                                // console.log(\"GET EDIT - \", vm.new_booking.start_date);\n\n\n\n\n                                // vm.new_booking.start_time = {time: moment(vm.new_booking.start).format(\"HH:mm\"), disabled: 1};\n                                vm.new_booking.start_time = {time: moment(vm.new_booking.start).format(\"HH:mm\")};\n                                // vm.new_booking.end_date = moment(luxon.DateTime.fromISO(vm.new_booking.end).toISO()).toDate();// new Date(vm.new_booking.end);\n                                vm.new_booking.end_date = moment(vm.new_booking.end).toDate();// new Date(vm.new_booking.end);\n\n                                vm.new_booking.end_time = {time: moment(vm.new_booking.end).format(\"HH:mm\")};\n\n\n                                vm.new_booking.after_booking_end = moment().isAfter(moment(vm.new_booking.end));\n\n                                \n                                //vm.default_date = new Date(vm.new_booking.start);\n\n                                \n                                if(vm.new_booking.instructor && vm.new_booking.instructor.id == vm.user_id){\n                                    vm.booking_self = false;\n                                }\n\n\n                                 //this will require breaking up quite a bit... but to access the parent one...\n                                $scope.$parent.vm.default_date =  vm.new_booking.start_date;\n                                setTimeout(function(){\n\n                                    if($scope.$parent.vm.see_booking){\n                                        $scope.$parent.vm.see_booking.visible = 1;\n                                    }\n                                    \n\n\n\n                                    //removed the go to date which was causing errors....\n                                   $(\"#calendar\").fullCalendar(\"gotoDate\", vm.new_booking.start_date );\n                                //console.log(\"HERE WE GO\", vm.new_booking.start_date);\n\n                                    //VERY hacky... not good - but it scrolls to the right place... maybe add a \n                                    setTimeout(function(){\n                                        console.log(\"ID IS : \", $stateParams.booking_id);\n                                            var w = parseInt($('a.fc-timeline-event.booking'+$stateParams.booking_id).css(\"left\"));\n                                        var b = parseInt($('a.fc-timeline-event.booking'+$stateParams.booking_id).width());\n                                         let offsetEvent = w + (b/2) - ($('tbody .fc-time-area .fc-scroller').width()  / 2);\n\n                                        $('tbody .fc-time-area .fc-scroller').animate({\n                                            scrollLeft:  offsetEvent\n                                        }, 1800);\n                                    }, 1000);\n\n\n                                    $scope.$apply();\n\n                                                                //console.log(\"ERR BEFORE HERE?\");\n\n\n                                }, 800);\n\n                                // //console.log(\"DEFAULT\", vm.default_date);                               \n\n                                generate_datetimes();\n\n                                $scope.update_dateTime(\"edit\");\n                                \n                                // //console.log(\"EDIT\", vm.new_booking);\n                                // //console.log(\"=== CHECK AT EDIT\", vm.new_booking.instructor);\n                                \n\n                                // InstructorCharges.GetByClubId(vm.new_booking.club_id)\n                                //     .then(function(data){\n\n                                //         vm.instructor_charges = data.items;  \n                                //         // //console.log(\"====> \", data); \n                                //     });\n\n                                //vm.courses\n                                // console.log(\"GET COURSES\");\n                                CourseService.GetCoursesByClubId(vm.new_booking.club_id)\n                                .then(function(data){\n                                    vm.courses = data.items;   \n                                    // console.log(\"COURSES\", vm.courses);\n\n                                    //set new_booking.tuition-required \n                                    vm.new_booking.tuition_required = vm.courses.find(function(course, index) {\n                                                                    if(course.id == vm.new_booking.course_id)\n                                                                        return true;\n                                                                });\n\n\n                                });\n\n\n\n                                //get all the club members by first and last name and email --> nothing else\n                                //this would only include the members that are for the plane that was selected....\n\n\n                                ////console.log(\"BEFORE GET\", vm.new_booking.end_time);\n                                prepare_add_edit(vm.new_booking.club_id, vm.new_booking.end);\n\n\n\n                                if(vm.new_booking.rental_items){\n                                    //then we may have shizzle to check / update\n                                    for(var i=0;i<vm.new_booking.rental_items.length;i++){\n                                        //first and foremost we need to check the available bits....\n                                        // //console.log(\"NO TO BOOK: \"+vm.new_booking.rental_items[i][\"number_to_book\"]);\n                                        vm.new_booking.rental_items[i][\"number_to_book\"] = parseInt(vm.new_booking.rental_items[i][\"number_to_book\"]);\n                                    }\n                                }\n\n                                if(vm.new_booking.free_seats){\n                                    // //console.log(\"FREE\", vm.new_booking.free_seats);\n                                    vm.new_booking.free_seats = parseInt(vm.new_booking.free_seats);\n                                }\n                                console.log(\"here\");\n                                if(vm.new_booking.instructor){\n                                   console.log(\"MY INSTRUCTOR HERE22: \", vm.new_booking.instructor);\n\n                                }\n\n                                // console.log(\"course: \", vm.new_booking.course_id);\n\n\n                                if((vm.club_id == 0 || !vm.club_id) && vm.new_booking.plane && vm.new_booking.plane.id){\n                                    vm.club_id = vm.new_booking.plane.club_id;\n                                }\n                                //vm.init_passengers();\n                                free_places();\n                                // console.log(\"HEY PAX\");\n                                // vm.init_passengers();\n                                // //console.log(\"MY INSTRUCTOR HERE2244: \", vm.new_booking.instructor);\n\n                            } else {\n                                ToastService.error(\"Booking Error\", data.message);\n                                $state.go('dashboard.add_booking');\n                            }\n\n                        });\n\n\n                }\n               \n\n\n               \n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                // //console.log(\"VM\", vm);\n                // //console.log(\"VM\", $stateParams);\n\n                //alert(\"LIST\");\n                //alert(moment($stateParams.start).add(1, \"hour\").format(\"HH:mm\"));\n\n             \n\n\n                vm.show_no_membership_message = false;\n                vm.hide_dropdown = false; \n                vm.clubs = [];\n\n                //we need to get the memberships that the user is a member of....\n                MemberService.GetUserClubs(vm.user.id)\n                 .then(function(data){\n                        vm.clubs = data.clubs;\n\n                        // //console.log(\"CLUBS HERE : \", data);\n\n                        if(vm.clubs && vm.clubs.length > 1){\n                            vm.hide_dropdown = true;\n                        } else if(vm.clubs.length == 1) {\n                            vm.club_id = vm.clubs[0].id;\n                            //console.log(\"SETTING THE CLUB ID HERE:: \", vm.club_id);\n                        }\n                    \n                        update_bookings();\n\n                    });\n                 \n                 //generate_datetimes();\n\n                //  BookingService.GetAllPlanes(vm.user.id, moment(vm.new_booking.start_datetime).format(\"Y-M-D HH:mm\"), moment(vm.new_booking.end_datetime).format(\"Y-M-D HH:mm\"), 0, 0)\n                // .then(function(data){\n                   \n                //     vm.planes = data;\n                //     // //console.log(\"PLANES NOW SET\", vm.planes);\n                //     if($stateParams.plane_id){\n                //         // //console.log(\"plane_id\", $stateParams.plane_id);\n                //         for(var i=0;i<vm.planes.length;i++){\n                //             // //console.log(\"I\", i);\n                //             // //console.log(\"id 1\", vm.planes[i].id);\n                //             // //console.log(\"I\", i);\n                //             if(parseInt(vm.planes[i].id) == $stateParams.plane_id){\n                //                 vm.new_booking.plane = vm.planes[i];\n                //                 // //console.log(\"found\", vm.planes[i]);\n                //             }\n                //         }\n\n                //     }\n\n                // });\n\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n\n\n        function getAllPlaneUpdate(){\n            check_times();\n            //$scope.update_dateTime('edit');\n             // BookingService.GetAllPlanes(vm.user.id, vm.new_booking.start_datetime, vm.new_booking.end_datetime, 0, 0)\n             //    .then(function(data){\n                   \n             //        //this gets the events and bookings for the period checked here...\n             //        // var events = data.events;\n             //        vm.planes = data;\n                \n\n             //    });\n        }\n\n        \n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        /* THIS SECTION IS ABOUT THE CALENDAR SHOWN ON ALL PAGES */\n\n\n        /* FUNCTIONS REQUIRED FOR ALL PAGES SHOWING THE BOOKINGS ON CALENDAR */\n\n\n        $scope.test = function(){\n            //console.log(\"UPDATE\");\n            vm.new_booking.instructor = {\n                id: 90,\n                first_name: \"A\",\n                last_name: \"REYNIER\"\n            };\n        }\n    \n\n    $scope.updateEvents = function(start, end){\n        ////console.log(\"start\", start, \"end\", end);\n\n        BookingService.GetAll(vm.user.id, start, end)\n        .then(function(data){\n            // //console.log(data);\n\n            $scope.all_events = data.events;\n            $scope.all_resources = data.resources;\n\n            // //console.log(\"hello\", $scope.all_events);\n            // //console.log(\"hello\", $scope.all_resources);\n\n            return data;\n\n        });\n    }\n\n\n\n    /* Render Tooltip */\n    $scope.eventRender = function( event, element, view ) {\n        element.attr({'tooltip': event.title,\n                      'tooltip-append-to-body': true});\n        $compile(element)($scope);\n    };\n\n    \n    $scope.alertOnClicked = function(calEvent, jsEvent, view){\n\n            // Auto-open the booking panel when an event is clicked\n            vm.bookingPanelOpen = true;\n\n            vm.see_booking = calEvent;    \n\n            vm.see_booking.start_date = moment(vm.see_booking.start).format(\"DD/MM/YYYY\");\n            vm.see_booking.end_date = moment(vm.see_booking.end).format(\"DD/MM/YYYY\");\n            vm.see_booking.start_time = moment(vm.see_booking.start).format(\"HH:mm\");\n            vm.see_booking.end_time = moment(vm.see_booking.end).format(\"HH:mm\");\n\n            vm.see_booking.start_datetime = new Date(new Date(vm.see_booking.start).toUTCString());\n            vm.see_booking.end_datetime = new Date(vm.see_booking.end);\n            vm.see_booking.visible = 1;\n\n            vm.see_booking.after_booking_end = moment().isAfter(moment(vm.see_booking.end));\n\n            $scope.$apply();\n    };\n\n\n    $scope.close_details = function(){\n            vm.see_booking.visible = 0;\n    }\n\n\n    $scope.changeLang = function() {\n    \n        $scope.uiConfig.calendar.dayNames = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\n        $scope.uiConfig.calendar.dayNamesShort = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n      \n    };\n\n    $scope.changed = function () {\n        // $log.log('Time changed to: ' + $scope.mytime);\n        $scope.check_plane_availability();\n    };\n\n    function j_changed() {\n        // $log.log('Time changed to: ' + $scope.mytime);\n        $scope.check_plane_availability();\n    };\n\n    $scope.check_plane_availability = function(){\n       \n        generate_datetimes();\n\n        //getALL?\n        var getA = (vm.new_booking.edit_booking == 1)? 1 : 0;\n        var plane_id = (vm.new_booking.plane_id > 0)? vm.new_booking.plane_id : 0;\n        if(vm.new_booking.plane && vm.new_booking.plane.id){\n            plane_id = vm.new_booking.plane.id;\n        }\n\n        console.log(\"START BOOKINGS 2\", vm.new_booking.start_datetime);\n        // //console.log(\"START\", moment(vm.new_booking.start_datetime).format(\"Y-M-D HH:mm\"));\n        // //console.log(\"END\", vm.new_booking.end_datetime);\n        console.log(vm.new_booking.start_datetime);\n        console.log(vm.new_booking.end_datetime);\n\n        console.log(\"START BOOKINGS 2\", new Date(vm.new_booking.start_datetime).toISOString());\n\n        var start_dt = new Date(vm.new_booking.start_datetime).toISOString();\n        var end_dt = new Date(vm.new_booking.end_datetime).toISOString();\n        var show_all = (vm.is_edit_show_all) ? 1 : 0;\n        BookingService.GetAllPlanes(vm.user.id, start_dt, end_dt, show_all, plane_id)\n        .then(function(data){\n           \n            //this gets the events and bookings for the period checked here...\n            // var events = data.events;\n            vm.planes = data;\n            \n\n            if(getA == 1){\n                //then I just want to iterate through these and return the plane already selected as \"available...\"\n\n                ////console.log(\"PLANE\", vm.new_booking.plane);\n\n                for(var i = 0; i<vm.planes.length; i++){\n                    if(vm.planes[i].id == vm.new_booking.plane.id){\n                        reset_chosen = 0;\n                        vm.new_booking.plane = vm.planes[i];\n                        //chosen is still available WOOOO\n                        $scope.check_rental_items();\n                    }\n                }\n\n\n\n            } else {\n\n                 //check if anything was already selected...\n                var reset_chosen = 1;\n                if(vm.new_booking.plane){\n                    for(var i = 0; i<vm.planes.length; i++){\n                        if(vm.planes[i].id == vm.new_booking.plane.id){\n                            reset_chosen = 0;\n                            //chosen is still available WOOOO\n                            $scope.check_rental_items();\n                        }\n                    }\n                    if(reset_chosen == 1){\n                        //then we just need to clear currently selected plane\n                        vm.new_booking.plane = {};\n                        delete(vm.new_booking.plane);\n                    }\n                    //otherwise we can leave that we've already done! :)\n                }\n\n\n            }\n\n        });\n\n    }\n\n    $scope.events = [];\n\n    function getDayClass(data) {\n        var date = data.date,\n          mode = data.mode;\n        if (mode === 'day') {\n          var dayToCheck = new Date(date).setHours(0,0,0,0);\n\n          for (var i = 0; i < $scope.events.length; i++) {\n            var currentDay = new Date($scope.events[i].date).setHours(0,0,0,0);\n\n            if (dayToCheck === currentDay) {\n              return $scope.events[i].status;\n            }\n          }\n        }\n\n        return '';\n      }\n\n\n    $scope.addOne = function(start=null, plane_id=null, end=null, resourceObj=null){\n        // //console.log(\"ADDING HERE --> with \", start);\n\n        if(start && !end){    \n            // var end = new Date(start);\n            // end.setHours(end.getHours() + 1); \n            // console.log(\"END::: \", end);            \n            end = moment(start).add(1, \"hour\").format();\n        }\n\n        // console.log(\"ADD ONE : \", plane_id);\n        // console.log(\"ADD ONE : \", start);\n        // console.log(\"ADD ONE : \", end);\n\n        \n\n        if(vm.action == \"list\" || vm.action == \"add\"){\n            console.log(\"add it yeah\");\n            vm.add_booking_event({\"start\": start, \"plane_id\": plane_id, \"end\": end, \"resourceObj\": resourceObj});\n        } else if (vm.action == \"edit\") {\n            $state.go('dashboard.add_booking', {\"start\": start, \"plane_id\": plane_id, \"end\": end});\n        } else {\n\n        }\n        //IF ALREADY ON HERE --> \n\n        //OTHERWISE BELOW\n            //alert(end);\n        // $state.go('dashboard.add_booking', {\"start\": start, \"plane_id\": plane_id, \"end\": end});\n\n\n\n    }\n\n    $scope.cancel_changes = function(){\n        $state.go('dashboard.add_booking');\n    }\n\n    $scope.check_rental_items = function(){\n        generate_datetimes();\n\n        vm.rental_items = [];\n\n        if(vm.new_booking.plane){\n\n            var club_id = (vm.new_booking.edit_booking == 1) ? vm.new_booking.club_id : vm.new_booking.plane.club_id;\n            // var start_datetime = luxon.DateTime.fromISO( new Date(vm.new_booking.start_datetime) ).toISO();\n            // var end_datetime = luxon.DateTime.fromISO( new Date(vm.new_booking.end_datetime) ).toISO();\n\n            var start_datetime = new Date(vm.new_booking.start_datetime).toISOString();\n            var end_datetime = new Date(vm.new_booking.end_datetime).toISOString();\n\n            BookingService.GetRentalItems(club_id, start_datetime, end_datetime, 0)\n            .then(function(data){\n           \n                vm.rental_items = data;\n\n                if(vm.new_booking.rental_items){\n                    //then we may have shizzle to check / update\n                    for(var i=0;i<vm.new_booking.rental_items.length;i++){\n                        //first and foremost we need to check the available bits....\n                        var found = 0;\n                        for(var j=0;j<vm.rental_items.length;j++){\n                            if(vm.rental_items[j][\"id\"] == vm.new_booking.rental_items[i][\"id\"]){\n                                //then we need to check that the current numbers available are still the same as before...\n                                if(parseInt(vm.new_booking.rental_items[i][\"number_to_book\"]) > parseInt(vm.rental_items[j][\"number_available\"])){\n                                    vm.new_booking.rental_items[i][\"number_to_book\"] = parseInt(vm.rental_items[j][\"number_available\"]);\n                                }\n                                vm.new_booking.rental_items[i][\"number_available\"] = parseInt(vm.rental_items[j][\"number_available\"]);\n                                found = 1;\n                                break;\n                            }\n                        }\n                        if(found == 0){\n                            //then we need to remove it...\n                            delete vm.new_booking.rental_items[i];\n                        }\n\n                    }\n\n                }\n\n\n                for(var k=0; k<vm.rental_items.length;k++){\n                    vm.rental_items[k].number = 0;\n                }\n\n                //if there is one already selected?\n                //check if anything was already selected...\n                if(vm.new_booking.rental_items){\n                    for(var j=0; j<vm.new_booking.rental_items.length; j++){\n                        var reset_chosen = 1;\n                        for(var i = 0; i<vm.rental_items.length; i++){\n                            if(vm.rental_items[i].id == vm.new_booking.rental_items[j].id){\n                                reset_chosen = 0;\n                                //chosen is still available WOOOO\n                            }\n                        }\n                        if(reset_chosen == 1){\n                            //then we just need to clear currently selected plane\n                            delete vm.new_booking.rental_items[j];\n                        }\n                    }\n                    //otherwise we can leave that we've already done! :)\n                }\n\n\n\n\n            });\n\n        }\n    }\n\n    function check_times(clean_type = null){\n\n            var c = new Date();\n            var a = (vm.new_booking.start_time) ? vm.new_booking.start_time.time.split(\":\") : [c.getHours(), c.getMinutes()];\n            var b = new Date(vm.new_booking.start_date);\n            b.setHours(a[0]);\n            b.setMinutes(a[1]);\n            b.setSeconds(0);\n            var future = moment(b).add(1, \"hour\").format();\n\n            //check if the end_time is set && if the end time is > start time...\n            if(start_after_end() || !vm.new_booking.end_time){\n\n                clean_times(check_relative_date(vm.new_booking.end_date, \"end\"), 'end_times', b);\n\n                var id;\n                // vm.end_times.forEach(function(time, i){ \n                //   if(time.time == moment(future).format(\"H:mm\")){ id = i; return true;}; \n                // });\n                vm.end_times.some(function(time, i){ \n                  if(time.time == moment(future).format(\"H:mm\")){ id = i; return true;};  \n                });\n\n                vm.new_booking.end_time = {};\n                vm.new_booking.end_time = vm.end_times[id];\n\n            } else {\n                if(!clean_type){\n                    clean_times(check_relative_date(vm.new_booking.end_date, \"end\"), 'end_times', b);\n                } \n            }\n\n\n             //need to update the selection of the end time if this has been set\n            if(vm.new_booking.end_time && vm.new_booking.end_time.disabled == 1){\n\n                var id;\n                //used to use a forEach loop but decided to run a some loop instead due to the benefit of not going through all elements\n                // vm.end_times.forEach(function(time, i){ \n                //   if(time.time == moment(future).format(\"H:mm\")){ id = i; return true;}; \n                // });\n                vm.end_times.some(function(time, i){ \n                  if(time.time == moment(future).format(\"H:mm\")){ id = i; return true;};  \n                });\n\n                vm.new_booking.end_time = {};\n                vm.new_booking.end_time = vm.end_times[id];\n\n            }\n\n            if(vm.new_booking.start_time && vm.new_booking.start_time.disabled == 1){\n                if(!clean_type){\n               \n                var id;\n                vm.start_times.some(function(time, i){ \n                  if(time.disabled == 0){ id = i; return i;}; \n                });\n\n                vm.new_booking.start_time = {};\n                vm.new_booking.start_time = vm.start_times[id];\n                 } \n\n                calculate_duration();\n            }\n    }\n\n    $scope.update_dateTime = function(which_update, params=null){\n\n        ////console.log(\"UPDATE TIME HERE\", which_update);\n\n        switch(which_update){\n\n            case 'start_date':\n\n                booking_today();\n\n                if(vm.new_booking.start_date > vm.new_booking.end_date){\n                    vm.new_booking.end_date = vm.new_booking.start_date;\n                }\n\n                clean_times(check_relative_date(vm.new_booking.start_date), 'start_times');\n\n                check_times();\n\n                if(start_after_end()){\n                    add_hour_to_end();\n                }\n\n            break;\n\n            case 'end_date':\n\n                 booking_today();\n                \n                check_times();\n\n                if(vm.new_booking.end_date < vm.new_booking.start_date){\n                    vm.new_booking.start_date = vm.new_booking.end_date;\n                    clean_times(check_relative_date(vm.new_booking.start_date), 'start_times');\n                } else {\n                    clean_times(check_relative_date(vm.new_booking.start_date), 'start_times');\n                    clean_times(check_relative_date(vm.new_booking.end_date, \"end\"), 'end_times');\n                }\n\n                if(start_after_end()){\n                    add_hour_to_end();\n                }\n\n\n            break;\n\n            case 'start_time':\n\n                // alert(\"start_time\");\n                //do we need to clean the times? if so.. \n                booking_today();\n\n                check_times();\n\n                //we need to calculate the time in between the start and the end!\n                calculate_duration();\n                \n\n            break;\n\n            case 'end_time':\n                // vm.times_clean_type = \"start_times\";\n                // if(moment(vm.new_booking.start).unix() < moment().unix()){\n                //     vm.times_clean_type = \"past\";\n                // }\n                if(vm.times_clean_type == \"past\"){\n                    //alert(\"end_time\");\n                    check_times(\"edit\");\n                } else {\n                    check_times();\n                }\n\n\n            break;\n\n            case 'edit':\n                //alert(\"edit - 1\");\n\n                // //this is the edit function that needs to be setup.\n                // booking_today();\n\n                // //number 1 = we have set start and end of the current date....\n                // // setTimeout(function(){\n                // //     check_times();\n                // //     // calculate_duration();\n                // // }, 5000);\n                // //console.log(\"ASD \",vm.new_booking.start_date);\n                // // clean_times(check_relative_date(vm.new_booking.start_date), 'start_times');\n                // check_times();\n                // calculate_duration();\n                //alert(\"EDIT 1\");\n\n                vm.is_edit_show_all = true;\n //start_times\n                vm.times_clean_type = \"start_times\";\n                if(moment(vm.new_booking.start).unix() < moment().unix()){\n                    vm.times_clean_type = \"past\";\n                    //clean_times(check_relative_date(vm.new_booking.start_date), \"end_times\");\n                                \n\n\n                } else {\n                                check_times();\n                    booking_today();\n                }\n                calculate_duration();\n\n                setTimeout(function(){\n                    //do we need to clean the times? if so.. \n                    // pre_select_value_id(\"start_times\", vm.new_booking.start_time);\n                    pre_select_value_id();\n                    //we need to calculate the time in between the start and the end!\n                }, 500);\n\n\n\n\n                //we need to set the previously selected plane here...\n\n\n            break;\n\n            case 'edit2':\n                //alert(\"edit2\");\n                // //this is the edit function that needs to be setup.\n                // booking_today();\n\n                // //number 1 = we have set start and end of the current date....\n                // // setTimeout(function(){\n                // //     check_times();\n                // //     // calculate_duration();\n                // // }, 5000);\n                // //console.log(\"ASD \",vm.new_booking.start_date);\n                // // clean_times(check_relative_date(vm.new_booking.start_date), 'start_times');\n                // check_times();\n                // calculate_duration();\n\n                booking_today();\n\n                clean_times(check_relative_date(vm.new_booking.start_date), 'start_times');\n\n                check_times();\n\n                calculate_duration();\n\n                setTimeout(function(){\n                    //do we need to clean the times? if so.. \n                    // pre_select_value_id(\"start_times\", vm.new_booking.start_time);\n                    pre_select_value_id();\n                    //we need to calculate the time in between the start and the end!\n\n                     if(params){\n                        // alert(\"plane\");\n                        // alert(params);\n                        // //console.log(\"SELECT ME \", vm.planes);\n                                for(var i=0;i<vm.planes.length;i++){\n                                    // //console.log(\"I\", i);\n                                    // //console.log(\"id 1\", vm.planes[i].id);\n                                    // //console.log(\"I\", i);\n                                    if(parseInt(vm.planes[i].id) == params){\n                                        vm.new_booking.plane = vm.planes[i];\n                                        $scope.getPlaneInstructors(vm.new_booking.plane.id);\n                                         ////console.log(\"found\", vm.new_booking);\n                                         $scope.$apply();\n                                    }\n                                }\n                    }\n                    \n                }, 500);\n\n\n\n\n                //we need to set the previously selected plane here...\n\n\n            break;\n\n\n        }\n\n\n        //an update on the form would require an update of the plane / waiting lists available\n        // Skip plane availability check in instructor-first flow  planes are already filtered by instructor\n        if(!vm.instructor_first_booking){\n            $scope.check_plane_availability();\n        }\n\n        if(vm.new_booking.plane){\n            //then we check what is available for these guys!\n            $scope.check_rental_items();\n        }\n\n        //if the plane was already selected - then we can also update the instructors so as to not require\n        //the user to have to re-select the plane\n        if(vm.new_booking.plane && !vm.instructor_first_booking){\n            $scope.getPlaneInstructors();\n        }\n\n\n\n\n        if(vm.new_booking.plane){\n            //let's update the visual representation of the booking on the right hand side\n            var booking_start = vm.new_booking.start_date;\n            var s_date = moment(vm.new_booking.start_date).format(\"Y-MM-DD\");\n            var s_time = vm.new_booking.start_time.time;\n            // //console.log(\"HERE : \", s_date);\n            // //console.log(\"HERE : \", s_time);\n            var n_start = moment(s_date + \" \" + s_time);\n\n            var e_date = moment(vm.new_booking.end_date).format(\"Y-MM-DD\");\n            var e_time = vm.new_booking.end_time.time;\n            var n_end = moment(e_date + \" \" + e_time);\n\n            // //console.log(\"HERE : \", n_start);\n            // //console.log(\"START HERE + \", vm.new_booking.start_date);\n            // //console.log(\"END HERE + \", vm.new_booking.end_date);\n            var new_event = {\n                                 \"id\":\"TEMP\",\n                                 \"title\":\"TEMPORARY\",\n                                 \"resourceId\": parseInt(vm.new_booking.plane.id),\n                                 \"start\":n_start,\n                                 \"end\":n_end,\n                                 \"editable\":false,\n                                 \"color\":\"rgb(255, 110, 110)\",\n                                 \"opacity\":\"1\"\n                              };\n                       \n\n            if(vm.already_added_temp){\n\n                    $('#calendar').fullCalendar(\"removeEvents\", \"TEMP\")\n                    setTimeout(function(){\n                        $('#calendar').fullCalendar('renderEvent', new_event);\n                    }, 150);\n\n\n            } else {\n\n\n               \n                $('#calendar').fullCalendar('renderEvent', new_event);\n                vm.already_added_temp = true;\n                                            \n\n\n            }\n        }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    }\n\n\n\n\n    function pre_select_value_id(){\n\n        vm.start_times.forEach(function(times, i){\n            // //console.log(times.time+\" == \"+vm.new_booking.start_time.time);\n            if(times.time == vm.new_booking.start_time.time){\n                // //console.log(\"THIS I \", i);\n                vm.new_booking.start_time = vm.start_times[i];\n            }\n\n        });\n        // //console.log(\"END\", vm.end_times);\n\n         vm.end_times.forEach(function(times, i){\n\n            if(times.time == vm.new_booking.end_time.time){\n                // //console.log(\"THIS I \", i);\n                vm.new_booking.end_time = vm.end_times[i];\n            }\n\n        });\n\n        $scope.$apply();\n\n    }\n\n    vm.decline_new_booking_error = function(){\n        vm.new_booking_errors = {};\n        $('#calendar').fullCalendar('removeEvents');\n        $('#calendar').fullCalendar('addEventSource', all_events);\n    }\n\n    vm.override_new_booking_errors = function(){\n        vm.new_booking.admin_override = true;\n        vm.new_booking_errors = {};\n        $scope.make_booking(true);\n    }\n\n\n\n\n\n    $scope.update_booking = function(valid){\n\n\n        //alert(\"UPDATE\");\n\n        generate_datetimes();\n\n        if(valid){\n\n                // //console.log(\"VALID SUBMISSION\");\n                // //console.log(\"START\", vm.new_booking.start_datetime);\n                // //console.log(\"END\", vm.new_booking.end_datetime);\n\n                var booking = {};\n                var booking = jQuery.extend(true, {}, vm.new_booking); \n                // //console.log(booking);\n                delete booking.options;\n                delete booking.instructor;\n                delete booking.plane;\n                delete booking.start_date;\n                delete booking.start_time;\n                delete booking.end_date;\n                delete booking.end_time;\n                delete booking.start_datetime;\n                delete booking.end_datetime;\n                delete booking.tuition_required;\n                delete booking.after_booking_end;\n                // //console.log(booking);\n                // //console.log(vm.new_booking);\n                booking.free_seats = (vm.new_booking.free_seats.constructor === Array) ? 0 : vm.new_booking.free_seats;\n                booking.start = vm.new_booking.start_datetime;\n                booking.end = vm.new_booking.end_datetime;\n\n                if(vm.new_booking.tuition_required && vm.new_booking.tuition_required.id > 0){\n                    booking.course_id = vm.new_booking.tuition_required.id;\n                }\n\n                booking.maintenance_flight = vm.new_booking.maintenance_flight;\n\n\n// Date.parse(vm.new_booking.start_datetime)\n\n                if(moment(Date.parse(vm.new_booking.end_datetime)).add(1, \"hour\").isBefore()){\n                    ToastService.error(\"Cannot Amend\", \"This booking ends in the past by more than an hour  you cannot amend a booking that finished in the past.\");\n                    return false;\n                }\n                //30 mintues leeway in case of booking starting within the 15 minute period or similar\n                // if(moment(vm.new_booking.start_datetime).add(30, \"minutes\") < moment()){\n                //     alert(\"This booking starts in the past - you cannot create a booking in the past.\");\n                //     return false;\n                // }\n\n\n                // //console.log(\"START\", booking.start);\n                // //console.log(\"END\", booking.end);\n\n                ////console.log(\"PLANE\", vm.new_booking.plane);\n                booking.resourceId = vm.new_booking.plane.id;\n\n                if(vm.new_booking.plane.id.toString().indexOf(\"w\") > -1){\n                    booking.changed_to_waiting_list = true;\n                    booking.resourceId = vm.new_booking.plane.id.slice(0, -1);\n                }\n\n                if(!vm.booking_self){\n                    booking.user_id = vm.new_booking.user.user_id;\n                    booking.instructor_id = (vm.new_booking.instructor) ? vm.new_booking.instructor.id : 0;\n                } else {\n                    booking.user_id = vm.user.id;\n                    booking.instructor_id = (vm.new_booking.instructor) ? vm.new_booking.instructor.id : 0;\n                }\n                \n                console.log(\"vm.new_booking.plane\", vm.new_booking);\n\n                booking.plane_id = vm.new_booking.plane.id;\n                booking.override = (vm.new_booking.override) ? vm.new_booking.override : 0;\n                booking.club_id = vm.new_booking.club_id;\n\n                // //console.log(\"====> booking to be sent = \", booking);\n\n                check_before_changing_event(booking);\n\n        }\n\n    }\n\n    $scope.update_club = function(){\n            console.log(\"we changed club here\");\n            vm.club_id = vm.change_club.id;\n                // //console.log(\"CLUB ID IS :\", vm.club_id);\n                if(vm.user.access.instructor.indexOf(vm.club_id) > -1 || vm.user.access.manager.indexOf(vm.club_id) > -1){\n                    // //console.log(\"THIS IS AN INSTRUCTOR/MANAGER IN THIS CLUB...\");\n                    vm.booking_self = false;\n                } else {\n                    vm.booking_self = true;\n                }\n            //now we need to update the planes the user can see on the calendar! \n            update_bookings();\n\n    }\n\n    function update_bookings(){\n\n\n         // BookingService.GetAllUserClub(vm.user.id,vm.club_id, moment().format(\"Y-M-D\"), \"\")\n         //        .then(function(data){\n                   \n         //            $scope.all_events = data.events;\n         //            $scope.all_resources = data.resources;\n\n         //        });\n\n         // //console.log(\"UPDATE BOOKINGS \");\n         BookingService.GetAll(vm.user.id, moment().format(\"Y-MM-DD\"), \"\")\n        .then(function(data){\n            // //console.log(data);\n\n            $scope.all_events = data.events;\n            $scope.all_resources = data.resources;\n\n            // //console.log(\"hello\", $scope.all_events);\n            // //console.log(\"hello\", $scope.all_resources);\n\n            return data;\n\n        });\n\n    }\n\n    /* alert on eventClick */\n    $scope.alertOnEventClick = function( date, jsEvent, view){\n        //alert(\"cliekd \");\n        $scope.alertMessage = (date.title + ' was clicked ');\n        // //console.log(\"HELLO BOOBIES\");\n        // //console.log(event);\n        //show event details\n\n    };\n\n    /* alert on Drop */\n     $scope.alertOnDrop = function(event, delta, revertFunc, jsEvent, ui, view){\n  \n\n        if(event.resourceId){\n            if(event.resourceId.toString().indexOf(\"w\") > -1){\n                event.changed_to_waiting_list = true;\n                event.resourceId = event.resourceId.slice(0, -1);\n            }\n        } else if(event.resourceIds){\n            for(var i=0;i<event.resourceIds.length;i++){\n                if(event.resourceIds[i].toString().indexOf(\"w\") > -1){\n                    event.changed_to_waiting_list = true;\n                    event.resourceIds[i] = event.resourceIds[i].slice(0, -1); //remove the w and set as w?\n                }\n            }\n\n        }\n        \n\n        // //console.log(\"HELLO BOOBIES\", event);\n\n\n        check_before_changing_event(event);\n       \n    };\n\n\n    /* alert on Resize */\n    $scope.alertOnResize = function(event, delta, revertFunc, jsEvent, ui, view ){\n        \n        check_before_changing_event(event);\n\n    };\n\n\n\n    $scope.override_booking_change = function(override){\n\n        vm.error_event[override] = true;\n        vm.error_event.override = 1;\n\n        check_before_changing_event(vm.error_event, true);\n\n\n    }\n\n    $scope.override_booking_change2 = function(override){\n\n        vm.error_event.admin_override = true;\n        vm.error_event.override = 1;\n        if(override){\n            vm.error_event[override] = true;\n        }\n\n        check_before_changing_event(vm.error_event, true);\n\n\n    }\n\n    $scope.decline_booking_change = function(){\n\n        vm.booking_errors = {};\n        vm.error_event = {};\n        $('#calendar').fullCalendar('removeEvents');\n        $('#calendar').fullCalendar('addEventSource', all_events);\n\n    }\n\n\n    function check_before_changing_event(event, err=null){\n        //the important bit is the eventID \n\n       if(err){\n         vm.booking_errors = {};\n            vm.error_event = {};\n       }\n\n        var evnt = jQuery.extend({}, event);\n\n        // evnt.start = moment(evnt.start).format(\"YYYY-MM-DD HH:mm\");\n        // evnt.end = moment(evnt.end).format(\"YYYY-MM-DD HH:mm\");\n        \n        // console.log(\"here\");\n\n        //this covers the change of plane for the booking...\n        if(event.resourceId && event.resourceId !== \"\"){\n            evnt.plane_id = event.resourceId;\n        } else if(event.resourceIds && event.resourceIds.length > 0){\n            for(var i=0;i<event.resourceIds.length;i++){\n                if(event.resourceIds[i].indexOf(\"fi\") == -1){\n                    evnt.plane_id = event.resourceIds[i];\n                }\n            }\n        } else {\n            console.log(\"EVENT HAS AN ISSUE WITH RESORUCE ID...\");\n        }\n        \n        if(event.instructor_id !== \"\"){\n            evnt.instructor_id = event.instructor_id;\n        } else {\n            evnt.instructor_id = \"0\";\n        }\n        //updatable bits:\n\n        delete evnt._start;\n        delete evnt._end;\n        delete evnt._id;\n        delete evnt.source;\n        delete evnt._allDay;\n        delete evnt.allDay;\n        delete evnt.className;\n        delete evnt.plane;\n        delete evnt.title;\n        delete evnt.editable;\n        delete evnt.resourceId;\n        delete evnt.resourceIds;\n        evnt.update_rental_items = true;\n\n        // //console.log(\"EVENT CHANGE\", evnt);\n\n        var original_event;\n        for(var i=0; i<$scope.all_events.length;i++){\n            if($scope.all_events[i].id == evnt.id){\n                original_event = $scope.all_events[i];\n                // //console.log(\"original EVENT\", original_event);\n            }\n        }\n\n\n        // //console.log(\"original end: \", moment(original_event.end).unix());\n        // //console.log(\"new end is : \", evnt.end.unix());\n\n        // //console.log(\"1original start: \", original_event.start);\n        // //console.log(\"1new start is : \", evnt.start);\n\n        // //console.log(\"2original start: \", moment(original_event.start).unix());\n        // //console.log(\"2new start is : \", evnt.start.unix());\n\n        // //console.log(\"1original start again: \", original_event.start);\n\n\n        //event in the past cannot be amended AFTER the booking - but the booking can be exte\n\n        // //console.log(\"all_events\", $scope.all_events);\n\n        if(moment(Date.parse(evnt.end)) < moment()){\n            ToastService.error(\"Cannot Amend\", \"This booking ends in the past  you cannot amend a booking in the past.\");\n            return false;\n        }\n        // 30 mintues leeway in case of booking starting within the 15 minute period or similar\n        if(moment(evnt.start).add(30, \"minutes\") < moment()){\n                // //console.log(\"start is older than 30 minutes ago\");\n                // //console.log(\"1original start again: \", original_event.start);\n\n            if(moment(original_event.end) !== evnt.end){\n                // //console.log(\"end is not the same end\");\n                // //console.log(\"original end: \", moment(original_event.end).unix());\n                // //console.log(\"new end is : \", evnt.end.unix());\n\n                var p = confirm(\"This booking starts in the past - you cannot amend the start date or time of a booking in the past, would you like to amend the end time along with any other changes you have made?\");\n                if(p){  \n                    // //console.log(\"START UPDATE = \",evnt.start );\n                    evnt.start = original_event.start;\n                    // //console.log(\"START UPDATE = \",evnt.start );\n                } else {\n                    return false;\n                }\n\n            }\n\n\n\n\n            //let's reset the booking'start time\n\n           \n\n\n\n\n           // return false;\n        }\n\n        // //console.log(\"UPDATE CONTENT BEFORE\", evnt);\n\n        BookingService.updateBooking(evnt, vm.user.id)\n        .then(function(data){\n            // //console.log(data);\n\n            if(data.success == true){\n                // //console.log(\"the booking did not need to be altered and has been updated successfully.\", evnt);\n\n                //only if the edition is being made from the \"edit\" otherwise the changes are already reflected appropriately.\n                if(evnt.edit_booking == 1){\n                    //$scope.$parent.updateEvents(evnt.start, evnt.end);\n                }\n                \n                ToastService.success(\"Changes Saved\", \"Your changes were saved successfully.\");\n                \n                if(vm.return_to == \"bookout\") {\n                    // //console.log(\"WE ARE AT THE BOOKOUT BIT - SO RETURN THERE!!!\");\n                    $state.go('dashboard.my_account.bookout_with_booking', { \"booking_id\": event.id });\n                } else {\n                    // //console.log(\"NORMAL booking\");\n                    $state.go('dashboard.add_booking');\n                }\n\n\n\n            } else {\n                //display the error\n                //console.log(\"The booking cannot remain the same due to : \"+data.message);\n\n                //hollow :::     $(\"#calendar\").fullCalendar('refetchEvents');\n\n\n                //I have decided to do this as a sequential check / accept / decline as opposed to combined\n                //this can be altered at a later date to be combined, with accept / decline on each error\n                //but this is more work than i can do right now!\n\n                var errors = [];\n                if(data.instructor !== true){\n                    errors.push({\n                        type: \"instructor\",\n                        message: \"It looks like your instructor is not available on the updated date and time\",\n                        api: data.instructor,\n                        override: \"instructor_override\",\n                        can_override: data.can_override,\n                        button: \"OVERRIDE INSTRUCTOR AVAILABILITY\" \n                    });\n                } else if(data.check_user !== true){\n\n                    if(data.check_user.indexOf(\"self-certify\") > -1){\n\n                        errors.push({\n                            type: \"check_user\",\n                            message: \"It would appear that you are not within the currency requirements to book this aircraft for this flight.\",\n                            api: data.check_user,\n                            override: \"currency_override\",\n                            button: \"I am Current\" \n                        });\n\n\n                    } else {\n                        errors.push({\n                            type: \"check_user\",\n                            message: \"It looks like your user account does not allow this booking to happen\",\n                            api: data.check_user,\n                            override: \"currency_override\",\n                            can_override: data.can_override,\n                            button: \"\" \n                        });\n                    }\n\n                   \n                } else if(data.rental_items !== true){\n                    errors.push({\n                        type: \"rental_items\",\n                        message: \"It looks like some of the rental items are not available\",\n                        api: data.rental_items,\n                        override: \"update_rental_items\",\n                        button: \"Confirm Changes\" \n                    });\n                }\n\n\n                //show the errors:::\n\n                // alert(\"ERROR FOUND IN ALTERING THE BOOKING\");\n\n                vm.booking_errors = errors;\n                //console.log(\"ERRORS ARE : \", vm.booking_errors);\n                vm.error_event = evnt;\n\n                //on GO--> check_before_changing_event(evnt)    \n\n\n                //if CANCEL?\n                //this would reset the change... do we want this?\n                //$(\"#calendar\").fullCalendar('refetchEvents');\n\n\n\n            }\n\n            return data;\n\n        });\n\n    }\n\n    $scope.wholeDay = function(){\n\n       if($scope.whole_day_booking == true){\n            $scope.whole_day_booking = false;\n            $scope.myDatetimeRange.time.from = defaultStartTime;\n            $scope.myDatetimeRange.time.to = defaultEndTime;\n       } else {\n            $scope.whole_day_booking = true;\n            $scope.myDatetimeRange.time.from = 0;\n            $scope.myDatetimeRange.time.to = 1440;\n       }\n       \n\n    }\n\n    //Changing the view of the calendar\n    $scope.changeView = function(view,calendar) {\n      uiCalendarConfig.calendars[calendar].fullCalendar('changeView',view);\n    };\n\n    /* Change View */\n    $scope.renderCalender = function(calendar) {\n      $timeout(function() {\n        if(uiCalendarConfig.calendars[calendar]){\n          uiCalendarConfig.calendars[calendar].fullCalendar('render');\n        }\n      });\n    };\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    /* THIS SECTION IS ABOUT THE ADD / EDIT OF THE CALENDAR EVENTS VIA THE EDIT / ADD NEW BOOKING */\n\n    /* ADD OR EDIT THE BOOKING */\n\n    function figure_out_steps(){\n        // //console.log(\"OPTIONS\", vm.dateTimeRangePickerOptions);\n        vm.new_booking.options = vm.dateTimeRangePickerOptions;\n         for(var i=0;i<24;i+=vm.new_booking.options.hour_step){\n\n            if(vm.new_booking.options.minute_step && vm.new_booking.options.minute_step > 0){\n                for(var j=0; j<(60/vm.new_booking.options.minute_step); j++){\n                    var k = vm.new_booking.options.minute_step * j;\n                    k = ((k < 10) ? '0' : '') + k;\n                    vm.start_times.push({time: i+\":\"+k, disabled: check_business_hours(i, k)});\n                    vm.end_times.push({time: i+\":\"+k, disabled: check_business_hours(i, k), duration: \"\"});\n                }\n            } else {\n                vm.start_times.push({time: i+\":00\", disabled: check_business_hours(i)});\n                vm.end_times.push({time: i+\":00\", disabled: check_business_hours(i), duration: \"\"});\n            }\n\n        }\n    }\n\n    function init_times(){\n       for(var i=0;i<24;i+=vm.new_booking.options.hour_step){\n\n            if(vm.new_booking.options.minute_step && vm.new_booking.options.minute_step > 0){\n                for(var j=0; j<(60/vm.new_booking.options.minute_step); j++){\n                    var k = vm.new_booking.options.minute_step * j;\n                    k = ((k < 10) ? '0' : '') + k;\n                    vm.start_times.push({time: i+\":\"+k, disabled: check_business_hours(i, k)});\n                    vm.end_times.push({time: i+\":\"+k, disabled: check_business_hours(i, k), duration: \"\"});\n                }\n            } else {\n                vm.start_times.push({time: i+\":00\", disabled: check_business_hours(i)});\n                vm.end_times.push({time: i+\":00\", disabled: check_business_hours(i), duration: \"\"});\n            }\n\n        } \n    }\n    \n\n    $scope.add_rental_item = function(){\n        if(vm.rental_item && vm.new_booking.rental_items && vm.rental_item.id){\n            var add_to_list = 1;\n            var delete_this = 0;\n            for(var j=0; j<vm.new_booking.rental_items.length; j++){\n                if(vm.new_booking.rental_items[j].id == vm.rental_item.id){\n                    add_to_list = 0;\n                    delete_this = vm.new_booking.rental_items[j];\n                    // //console.log(\"item was already found there...\");\n                }\n            }\n            if(add_to_list == 1){\n                //then its not already in teh list!\n                vm.new_booking.rental_items.push(vm.rental_item);\n                delete vm.rental_item;\n\n            }\n\n        } else {\n            if(vm.rental_item){\n                // //console.log(\"rental_item is: \", vm.rental_item);\n                if(!vm.new_booking.rental_items){\n                    //init here if its the first item...\n                    vm.new_booking.rental_items = [];\n                }\n                vm.new_booking.rental_items.push(vm.rental_item);\n                delete vm.rental_item;\n            }\n               \n        }\n\n    }\n\n\n    $scope.rental_item_remove = function(id){\n        //as this is before we actually do the shizzle!\n        vm.new_booking.rental_items = $.grep(vm.new_booking.rental_items, function(e){ \n                return e.id != id; \n        });\n    }\n\n\n\n    $scope.getPlaneInstructors = function(){\n\n\n        // //console.log(\"CHANGE OF PLANE HERE\");\n\n        // Determine the club from the selected plane (most reliable source)\n        var booking_club_id = parseInt(vm.new_booking.plane.club_id) || vm.club_id;\n        vm.club_id = booking_club_id;\n\n        if((vm.user.access.instructor.indexOf(booking_club_id) > -1) || (vm.user.access.manager.indexOf(booking_club_id) > -1) ){\n            // //console.log(\"NOT BOOKING FOR SELF?\");\n            vm.booking_self = false;\n            prepare_add_edit();\n        } else {\n            vm.booking_self = true;\n        }\n\n        if( vm.user.access.manager.indexOf(booking_club_id) > -1 ){\n            vm.booking_admin = true;\n        } else {\n            vm.booking_admin = false;\n        }\n\n        // vm.init_passengers();\n        $scope.check_rental_items();\n\n         //FROM TO\n        // var from = moment.utc( vm.new_booking.start_datetime ).toISOString();//luxon.DateTime.fromISO(moment(vm.new_booking.start_datetime).toISOString()).setZone(\"Europe/London\").toFormat(\"YYYY-MM-DDThh:mm:ssZ\");\n        // var to = moment.utc( vm.new_booking.end_datetime ).toISOString();//luxon.DateTime.fromISO(moment(vm.new_booking.start_datetime).toISOString()).setZone(\"Europe/London\").toFormat(\"YYYY-MM-DDThh:mm:ssZ\");\n        //var to = luxon.DateTime.fromISO(vm.new_booking.end_datetime).setZone(\"Europe/London\").toFormat(\"YYYY-MM-DDThh:mm:ssZ\");\n        // console.log(\"FROM : \", from);\n        // console.log(\"TO : \", to);\n\n        var from = new Date(vm.new_booking.start_datetime).toISOString();//moment.utc( vm.new_booking.start_datetime ).toISOString();//luxon.DateTime.fromISO(moment(vm.new_booking.start_datetime).toISOString()).setZone(\"Europe/London\").toFormat(\"YYYY-MM-DDThh:mm:ssZ\");\n        var to = new Date(vm.new_booking.end_datetime).toISOString();// moment.utc( vm.new_booking.end_datetime ).toISOString();//luxon.DateTime.fromISO(moment(vm.new_booking.start_datetime).toISOString()).setZone(\"Europe/London\").toFormat(\"YYYY-MM-DDThh:mm:ssZ\");\n        \n\n        if(vm.action == \"add\" || vm.action == \"list\"){\n\n          \n           \n            var show_all = (vm.is_edit_show_all) ? 1 : ( (vm.booking_self)? 0 : 1 );\n\n            BookingService.GetPlaneInstructors(vm.user.id, vm.new_booking.plane.id, from, to, show_all)\n            .then(function(data){\n                // //console.log(data);\n                // //console.log(\"NEW INSTRUCTORS ARE : \", data);\n                vm.instructors = data;\n\n                var reset_chosen = 1;\n                if(vm.new_booking.instructor){\n                    for(var i = 0; i<vm.instructors.length; i++){\n                        // Match on id or user_id to handle instructor-first bookings\n                        if(vm.instructors[i].id == vm.new_booking.instructor.id || vm.instructors[i].user_id == vm.new_booking.instructor.user_id){\n                            reset_chosen = 0;\n                            // Update the instructor reference to the full API object\n                            vm.new_booking.instructor = vm.instructors[i];\n                        }\n                    }\n                    if(reset_chosen == 1){\n                        //then we just need to clear currently selected plane\n                        vm.new_booking.instructor = {};\n                        delete(vm.new_booking.instructor);\n                    }\n                    //otherwise we can leave that we've already done! :)\n                }\n\n                free_places();\n            });\n\n\n        } else {\n            //must be edit... sooooooo\n            var show_all = (vm.is_edit_show_all) ? 1 : ( (vm.booking_self)? 0 : 1 );\n            //(vm.booking_self)? 0 : 1\n            BookingService.GetPlaneInstructorsEdit(vm.user.id, vm.new_booking.plane.id, from,  to, show_all, vm.new_booking.id)\n            .then(function(data){\n                // //console.log(data);\n                // //console.log(\"NEW INSTRUCTORS ARE : \", data);\n\n\n                vm.instructors = data;\n\n                var reset_chosen = 1;\n                if(vm.new_booking.instructor){\n                    for(var i = 0; i<vm.instructors.length; i++){\n                        if(vm.instructors[i].id == vm.new_booking.instructor.id){\n                            reset_chosen = 0;\n                        }\n                    }\n                    if(reset_chosen == 1){\n                        //then we just need to clear currently selected plane\n                        vm.new_booking.instructor = {};\n                        delete(vm.new_booking.instructor);\n                    }\n                    //otherwise we can leave that we've already done! :)\n                }\n                free_places();\n            });\n\n        }\n\n\n        // InstructorCharges.GetByClubId(vm.new_booking.plane.club_id)\n        //         .then(function(data){\n        //             vm.instructor_charges = data.items;  \n        //             ////console.log(\"====> \", data); \n        //         });\n\n         CourseService.GetCoursesByClubId(vm.new_booking.plane.club_id)\n                    .then(function(data){\n                        vm.courses = data.items;   \n                    });\n\n\n        // //console.log(\"vm.new_booking.plane.club_id\", vm.new_booking.plane.club_id);\n        // //console.log(\"vm.new_booking.plane.club_id\", vm.user.access.instructor);\n        // //console.log(\"INDEX :: \", vm.user.access.instructor.indexOf(parseInt(vm.new_booking.plane.club_id)));\n        \n        // if(vm.user.access.instructor.indexOf(parseInt(vm.new_booking.plane.club_id)) > -1){\n        //     //console.log(\"THIS IS AN INSTRUCTOR IN THIS CLUB...\");\n        //     vm.booking_self = false;\n        // }\n\n\n\n        var end_dt = new Date(vm.new_booking.end_datetime);\n        \n\n        //if is_current getPlaneInstructors\n        BookingService.GetIfCurrent(vm.user_id, vm.new_booking.plane.id, end_dt.toISOString())\n        .then(function (data) {\n            ////console.log(data);\n            if(data.success){\n                //use GB airfields first...\n                vm.is_current = data.is_current;\n                // //console.log(\"CURRENCY \", vm.is_current);\n\n                vm.currency_type = data.requirements.currency_type;\n                vm.currency_days = data.requirements.currency_days;\n            } else {\n            }\n        });\n        \n\n        \n\n    }\n\n\n    function free_places(){\n        // //console.log(\"UPDATE FREE PLACES...\", vm.new_booking.passengers.length);\n        // //console.log(\"UPDATE FREE PLACES...\", vm.new_booking.instructor);\n\n        vm.free_seats = [];\n        console.log(\"NEW_BOOKING - PLANE: \", vm.new_booking.plane);\n        var seats = parseInt(vm.new_booking.plane.seats) - 1;\n\n        if(vm.new_booking.instructor){\n            if(vm.new_booking.instructor.id > 0){\n                // //console.log(\"the instructor was selected for this flight...\");\n                seats--;\n            }\n        }\n\n        if(vm.new_booking.passengers.length > 0){\n            for(var i=0;i<vm.new_booking.passengers.length;i++){\n                if(vm.new_booking.passengers[i] && vm.new_booking.passengers[i][\"email\"] !== \"\"){\n                    seats--;\n                }\n            }\n        }\n\n        vm.free_seats = [];\n        for(var i=0; i<seats;i++){\n            vm.free_seats.push(i);\n        }\n\n        // //console.log(\"free seats now...\", vm.free_seats);\n\n        // $scope.$apply();\n\n    }\n\n\n    $scope.clear_booking = function(){\n        vm.new_booking = {\n            start_date: today,\n            end_date: today,\n            free_seats: [],\n            passengers: [],\n            instructor: undefined,\n            options: vm.dateTimeRangePickerOptions\n        };\n        vm.instructor_first_booking = false;\n        $scope.submitted = false;\n    }\n\n    function calculate_duration(){\n        if(vm.new_booking.start_date && vm.new_booking.start_time){\n            var start_datetime = new Date(vm.new_booking.start_date);\n            var start_time = vm.new_booking.start_time.time.split(\":\");\n            start_datetime.setHours(start_time[0]);\n            start_datetime.setMinutes(start_time[1]);\n            start_datetime.setSeconds(0);\n            // //console.log(\"START DATETIME\", start_datetime);  \n\n            vm.end_times.forEach(function(time, i){ \n                //no need to go through each element if its not required to be shown!\n                if(time.disabled == 0){\n\n                    var end_datetime = new Date(vm.new_booking.end_date);\n                    var end_time = time.time.split(\":\");\n                    end_datetime.setHours(end_time[0]);\n                    end_datetime.setMinutes(end_time[1]);  \n                    end_datetime.setSeconds(0);\n                    // //console.log(\"END DATETIME\", end_datetime);  \n\n                    var difference = moment(moment(end_datetime).startOf(\"minute\")).diff(moment(start_datetime).startOf(\"minute\"));\n\n                    //now we need to calculate the difference in datetime\n                    // //console.log(\"d: \"+moment.duration(difference).days()+\" h: \"+moment.duration(difference).hours()+\" m: \"+moment.duration(difference).minutes());\n                    var human_str = get_duration_str(difference);\n                    // //console.log(\"human string\", human_str);\n                    if(human_str == \"\"){\n                        vm.end_times[i].disabled = 1;\n                    } else {\n                        vm.end_times[i].duration = \"( \"+human_str+\" )\";\n                    }\n\n\n                } else {\n                    vm.end_times[i].duration = \"\";\n                }\n              //if(time.time == moment(future).format(\"H:mm\")){ id = i; return true;}; \n            });\n        }\n    }\n\n    vm.seats_in_plane = function(){\n            free_places();\n\n            //base\n            var no_seats = vm.new_booking.plane.seats;\n\n            //check if instructor aboard?\n            if(vm.new_booking.instructor){   \n                no_seats--;\n            }\n\n            //include self\n            no_seats--;\n\n            // //console.log(\"seats left\", no_seats);\n\n\n            //return final number\n            return no_seats;\n        }\n\n        // vm.adding_a_member = function(){\n        //     // //console.log(\"ADDING ONE?\");\n        //     //vm.init_passengers();\n        //     vm.new_booking.passengers.push({\n        //             first_name: \"\",\n        //             last_name: \"\",\n        //             email: \"\",\n        //             status: \"\"\n        //         });\n        // }\n\n        // vm.init_passengers = function(){\n        //     var no_of_seats = vm.seats_in_plane();\n        //     // var already_filled = 0;\n        //     // for(var i=0;i<vm.new_booking.passengers.length;i++){\n        //     //         if(vm.new_booking.passengers[i] && vm.new_booking.passengers[i][\"email\"] !== \"\"){\n        //     //             already_filled++;\n        //     //         }          \n        //     // };\n        //     // var cc = no_of_seats - already_filled;\n        //     // // //console.log(\"CCCC seats -> \",no_of_seats);\n        //     // // //console.log(\"CCCC already_filled -> \",already_filled);\n        //     // // //console.log(\"CCCC -> \",cc);\n        //     // if(cc > 0){\n        //     if(vm.new_booking.passengers.length == 0){\n        //         // console.log(\"original push\");\n        //         vm.new_booking.passengers.push({\n        //             first_name: \"\",\n        //             last_name: \"\",\n        //             email: \"\",\n        //             status: \"\"\n        //         });\n        //     } else {\n        //         // console.log(\"new push\");\n        //         for(var i=0;i<=vm.new_booking.passengers.length;i++){\n        //             // console.log(\"pax forloop\");\n        //             if(vm.new_booking.passengers[i] && vm.new_booking.passengers[i].email == '' && vm.new_booking.passengers[i].status == ''){\n        //                 //all good\n        //                 // console.log('we have an empty one');\n\n        //             } else {\n        //                 if(vm.new_booking.passengers.length == i){\n        //                     // console.log('add new blank');\n        //                     vm.new_booking.passengers.push({\n        //                         first_name: \"\",\n        //                         last_name: \"\",\n        //                         email: \"\",\n        //                         status: \"\"\n        //                     });\n        //                     break;\n        //                 } else {\n        //                     // console.log(\"no need?\");\n        //                 }\n        //             }\n        //         }\n        //     }\n            \n        // }\n\n        var setting_new_member;\n\n\n        vm.invite_new_passenger = function(index){\n\n            // //console.log(\"HERE\");\n            // //console.log(vm.new_pax);\n\n             if(vm.new_pax && vm.new_pax.email !== \"\" && vm.new_pax.is_member == false){\n\n\n                 //send a single invitation to join the gang....\n                 vm.new_pax.invited_by = vm.user.id;\n\n\n                 BookoutService.AddPassenger(vm.new_pax, $stateParams.booking_id)\n                .then(function (data) {\n                    // //console.log(data);\n                    if(data.success){\n                       ToastService.success(\"Invitation Sent\", \"The passenger invitation has been sent.\");\n                        vm.update_passenger_list();\n                        vm.show_new_passenger_invitation = false;\n                    }\n                });\n\n\n\n\n\n\n             } else {\n                 ToastService.error(\"Invalid Email\", \"Please enter a valid email address to send the invitation to.\");\n             }\n           \n\n\n        }\n\n\n\n\n\n        vm.add_new_passenger = function(index){\n\n            console.log(\"ADD NEW PAX\");\n            console.log(vm.new_pax);\n\n            if(vm.new_pax.is_member){\n\n\n                //then we already have everything we need and we just invite them separately\n                // var to_send = {\n                //     booking_id: $stateParams.booking_id,\n                //     club_id: vm.club_id\n                // }\n                vm.new_pax.club_id = vm.club_id;\n                vm.new_pax.invited_by = vm.user.id;\n\n\n                vm.new_booking.passengers.push(vm.new_pax);\n\n                // //add passenger to booking\n                // BookoutService.AddPassenger(vm.new_pax, $stateParams.booking_id)\n                // .then(function (data) {\n                //     // //console.log(data);\n                //     if(data.success){\n                       \n\n\n                //         //let's call the update on the passengers\n                //         vm.update_passenger_list();\n\n\n\n\n                //     }\n                // });\n\n\n\n\n            } else {\n                vm.show_new_passenger_invitation = true;\n            }\n\n           \n\n\n        }\n\n\n        vm.new_pax = {\n                        id: 0,\n                        email: \"\",\n                        first_name: \"\",\n                        last_name: \"\",\n                        is_member: false,\n                        status: \"\",\n                        not_found: true\n                    };\n\n        vm.close_passenger_invitation = function(){\n            vm.show_new_passenger_invitation = false;\n        }\n\n\n        var set_new_member = function(email, index){\n            // //console.log(\"SET MEMBER NOW 123\");\n            vm.new_booking.passengers[index] = {\n                                id: 0,\n                                email: email,\n                                first_name: \"\",\n                                last_name: \"\",\n                                is_member: false,\n                                status: \"to_invite\"\n                            };\n            // //console.log(\"HELLO\");\n            //vm.init_passengers();\n            free_places();\n        }\n\n        vm.get_pax_class = function(status, is_member){\n            console.log(\"STATUS:: \", status);\n            /*\n              <i class=\"fa fa-envelope fastatus\" ng-if=\"vm.new_booking.passengers[$index].status == 'to_invite'\"></i>\n              <i class=\"fa fa-envelope-open-text fastatus\" ng-if=\"vm.new_booking.passengers[$index].status == 'invited'\"></i>\n              <i class=\"fa fa-check-square fastatus ok\" ng-if=\"vm.new_booking.passengers[$index].status == 'member'\"></i>\n              <i class=\"fa fa-check-square fastatus ok\" ng-if=\"vm.new_booking.passengers[$index].status == 'accepted'\"></i>\n              <i class=\"fa fa-check-square fastatus ok\" ng-if=\"vm.new_booking.passengers[$index].is_member\"></i>\n              <i class=\"fa fa-times fastatus\" ng-if=\"vm.new_booking.passengers[$index].status == 'declined'\"></i>\n    .success_pax_invitation{\n    background: rgba(80, 175, 70, 0.7);\n    border-radius: 10px;\n    padding: 10px;\n    margin: 10px 0;\n}\n\n.waiting_pax_invitation{\n    background: rgba(255, 230, 108, 0.7);\n    border-radius: 10px;\n    padding: 10px;\n    margin: 10px 0;\n}\n\n.declined_pax_invitation{\n    background: rgba(217, 83, 79, 0.7);\n    border-radius: 10px;\n    padding: 10px;\n    margin: 10px 0;\n}\n\n\n            */\n            if(status == 'to_invite'){\n                return 'waiting_pax_invitation';\n            } else if(status == 'invited'){\n                return 'waiting_pax_invitation';\n            } else if(status == 'member'){\n                return 'success_pax_invitation';\n            } else if(status == 'accepted'){\n                return 'success_pax_invitation';\n            } else if(status == 'is_member'){\n                return 'success_pax_invitation';\n            } else if(status == 'declined'){\n                return 'declined_pax_invitation';\n            }\n\n            if(!status && is_member){\n                return 'success_pax_invitation';\n            }\n\n\n            return 'new_pax_invitation';\n        }\n\n        vm.new_passenger_invite_ready = function(index){\n\n            //let's check the email address -->\n             // \n            var email_regex = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n            \n            //vm.new_pax ??\n            //then add vm.new_pax to the passengers?\n\n            if(email_regex.test(vm.new_pax.email)){\n\n                // //console.log(\"SET MEMBER NOW 123\");\n                vm.new_pax.is_member = false;\n                vm.new_pax.status = \"to_invite\";\n\n                vm.new_booking.passengers.push(vm.new_pax);\n\n\n                vm.new_pax = {\n                    id: 0,\n                    email: \"\",\n                    first_name: \"\",\n                    last_name: \"\",\n                    is_member: false,\n                    status: \"\",\n                    not_found: true\n                };\n\n                // //console.log(\"HELLO\");\n                //vm.init_passengers();\n               // free_places();\n                vm.show_new_passenger_invitation = false;\n            } else {\n                ToastService.error(\"Invalid Email\", \"The email address appears to be incorrect  please double check the email address entered.\");\n                return false;\n            }\n        }\n\n        vm.remove_passenger = function(index){\n            console.log(\"hi\");\n            vm.new_booking.passengers.splice(index, 1);\n\n        }\n\n\n        $scope.cancel_booking = function(booking_id){\n\n            //HOW DO WE CANCEL A BOOKING???\n            //at some point we need to define the booking cancellation reasons here (and make a nice popup style cancel)\n\n            var a = prompt(\"Are you sure you wish to cancel this booking? Please type YES in the box below to confirm.\");\n            if(a == \"YES\"){\n                //then we need to delete the booking... \n\n            BookingService.DeleteBooking(vm.user.id, booking_id)\n            .then(function(data){\n                // //console.log(data);\n                ToastService.success(\"Booking Cancelled\", \"The booking has been cancelled.\");\n\n                if(data.success){\n                    $state.go('dashboard.add_booking');\n                    \n                     $scope.all_events = $.grep($scope.all_events, function(e){ \n                        return e.id != booking_id; \n                    });\n\n                    $('#calendar').fullCalendar('refetchEvents');\n                    $('#calendar').fullCalendar('removeEvents');\n                    $('#calendar').fullCalendar('addEventSource', $scope.all_events);\n\n                } else {\n                    ToastService.error(\"Error\", \"An error occurred while cancelling the booking.\");\n                    // //console.log(\"ERROR\", data);\n                }\n\n            });\n\n\n            } else {\n                $state.go('dashboard.add_booking');\n            }\n\n        }\n\n        var get_all_members = function(){\n            console.log(\"hello\", vm.club_id);\n\n                 MemberService.GetAllByClub(vm.club_id)\n                .then(function (data) {\n                    ////console.log(data);\n                        //use GB airfields first...\n                        vm.members = data;\n                        for(var i=0;i<vm.members.length;i++){\n                            vm.members[i].is_member = true;\n                        }\n\n                        vm.all_members = data;\n                        for(var i=0;i<vm.all_members.length;i++){\n                            vm.all_members[i].is_member = true;\n                        }\n                        console.log(vm.all_members);\n                \n                });\n\n            \n        }\n\n        setTimeout(function(){\n            get_all_members();\n\n        }, 200);\n\n\n        vm.invite_passenger = function(email, i){\n            ////console.log(\"SEND INVITE\", vm.bookout.passengers[i]);\n\n            var passenger_membership_id = 9;\n            //interesting - this may not be required?\n\n            vm.new_booking.passengers.push(vm.new_pax);\n\n\n            // UserService.InvitePassenger(vm.new_booking.passengers[i].email, vm.user_id, vm.club_id, passenger_membership_id, vm.new_booking.booking_id)\n            //     .then(function (data) {\n            //             //use GB airfields first...\n            //             ////console.log(\"INVITE IS \", data);\n            //             vm.new_booking.passengers[i].status = data.invite.status;\n            //             vm.new_booking.passengers[i].invitation_token = data.invite.invitation_token;\n                \n            //     });\n\n\n        }\n\n        vm.refresh_passenger = function(member, i){\n            ////console.log(\"SEND REFRESH\");\n            UserService.GetInvite(vm.new_booking.passengers[i].invitation_token)\n                .then(function (data) {\n                        //use GB airfields first...\n                        // //console.log(\"INVITED IS \", data);\n                        vm.new_booking.passengers[i].status = data.status;\n                        vm.new_booking.passengers[i].user_id = data.user_id;\n                        vm.new_booking.passengers[i].first_name = data.first_name;\n                        vm.new_booking.passengers[i].last_name = data.last_name;\n                });\n            //vm.bookout.passengers[i].status = \"accepted\";\n        }\n\n        vm.update_passenger_list = function(){\n\n            //let's get ALL the ones required\n             BookoutService.GetPassengers($stateParams.booking_id)\n                .then(function (data) {\n                    ////console.log(data);\n                    if(data.success){\n                       //alert(\"GET\");\n                       ////console.log(\"PAX\", data.passengers);\n                       vm.new_booking.passengers = data.passengers;\n\n                       vm.new_pax = {\n                            id: 0,\n                            email: \"\",\n                            first_name: \"\",\n                            last_name: \"\",\n                            is_member: false,\n                            status: \"\",\n                            not_found: true\n                        };\n\n                    }\n                });\n\n        }\n\n        vm.resend_invitation = function(obj){\n\n            var to_resend = obj;\n             BookingService.ResendInvitation(to_resend, to_resend.id)\n                .then(function(data){\n                    // //console.log(data);\n                    if(data.success == true){\n                        ToastService.success(\"Invitation Resent\", data.message);\n                    } else {\n                        ToastService.error(\"Resend Failed\", data.message);\n                    }\n\n                });\n        }\n\n\n        vm.refresh_all_passenger = function(){\n            var i = 0;\n             function next() {\n                i++;\n                if(i < vm.new_booking.passengers.length) {\n                    // //console.log(\"SEND REFRESH EVERYTHING\");\n                    if(vm.new_booking.passengers[i] && vm.new_booking.passengers[i].status == \"invited\" && vm.new_booking.passengers[i].invitation_token !== \"\"){\n\n                         UserService.GetInvite(vm.new_booking.passengers[i].invitation_token)\n                            .then(function (data) {\n                                    // //console.log(\"INVITED IS \", data);\n                                    // //console.log(\"INVITED IS \", vm.bookout.passengers[i]);\n                                    vm.new_booking.passengers[i].status = data.status;\n                                    vm.new_booking.passengers[i].user_id = data.user_id;\n                                    vm.new_booking.passengers[i].first_name = data.first_name;\n                                    vm.new_booking.passengers[i].last_name = data.last_name;\n                            });\n                    }\n                } else {\n                   /// nothing\n                }\n            }\n            next();\n         \n            //vm.bookout.passengers[i].status = \"accepted\";\n        }\n\n\n        vm.get_passenger_status = function(member){\n            // //console.log(\"MEMBER\", member);\n            if(member){\n\n\n                if(member.is_member){\n                    // //console.log(\"this one is true\");\n                    return \"OK - is already club member\";\n                } else {\n\n                    if(member.status == \"accepted\"){\n                        return \"OK - passenger has accepted the terms\";\n                    } else if(member.status == \"declined\"){\n                        return \"NO - passenger declined the offer\";\n                    } else if(member.status == \"invited\"){\n                        return \"Waiting for user response\";\n                    } else {\n                        return \"\";\n                    }\n                }\n\n                return \"\";\n            }\n\n        }\n\n       \n                         ////console.log(\"ACCESS : \", vm.user.access);\n        // const delay = (delayInms) => {\n        //   return new Promise(resolve => setTimeout(resolve, delayInms));\n        // };\n\n        function prepare_add_edit(club_id=null, after_booking_end=null){\n\n            var cid = (club_id) ? club_id : vm.club_id;\n            var bed = (after_booking_end) ? after_booking_end : vm.new_booking.end_datetime;\n\n            if(cid > 0 && bed){\n\n                    var bed2 = new Date(bed).toISOString();\n\n                 MemberService.GetAllActiveByClub(cid, bed2)\n                    .then(function (data) {\n                        // //console.log(\"CLUB ID IS :\", vm.club_id);\n\n                        if(vm.user.access.instructor.indexOf(vm.club_id) > -1 || vm.user.access.manager.indexOf(vm.club_id) > -1){\n                            // //console.log(\"THIS IS AN INSTRUCTOR IN THIS CLUB...\");\n                            vm.booking_self = false;\n                            vm.show_self_option = true;\n                        }\n\n                        // if(vm.user.access.instructor.indexOf(vm.club_id) > -1){\n                        //     // //console.log(\"THIS IS AN INSTRUCTOR IN THIS CLUB...\");\n                        //     vm.booking_self = false;\n                        //     vm.show_self_option = true;\n                        // }\n\n                        //use GB airfields first...\n                        vm.members = data.members || data;\n                        if(vm.members && vm.members.length > 0){\n                            for(var j=0;j<vm.members.length;j++){\n                                vm.members[j].is_member = true;\n                            }\n                        }\n\n                        if(vm.new_booking.instructor && vm.new_booking.instructor.id == vm.user.id){\n                            vm.show_self_option = true;\n                            vm.booking_self = false;\n                        }\n\n                        if(!vm.new_booking.user){\n                            // vm.booking_self = false;\n                            //set the member\n\n                            if(!vm.all_members){\n                                 MemberService.GetAllByClub(vm.club_id)\n                                    .then(function (data) {\n                                       \n\n                                            vm.all_members = data;\n                                            for(var i=0;i<vm.all_members.length;i++){\n                                                vm.all_members[i].is_member = true;\n                                            }\n\n                                             vm.new_booking.user = vm.all_members.find(function(member, index) {\n                                                                    if(member.user_id == vm.new_booking.user_id)\n                                                                        return true;\n                                                                });\n\n                                    });\n\n\n                            } else {\n                                vm.new_booking.user = vm.all_members.find(function(member, index) {\n                                                                    if(member.user_id == vm.new_booking.user_id)\n                                                                        return true;\n                                                                });\n                            }\n\n                            //console.log(\"MEMBERS: \", vm.all_members);\n                           \n\n                        }\n\n\n                        if(vm.members && vm.members.length > 0){\n                            for(var i=0;i<vm.members.length;i++){\n                                vm.members[i].is_member = true;\n                            }\n                        }\n                       \n                        // //console.log(vm.members);\n                    \n                    });\n\n            }\n\n           \n        }\n\n\n\n        vm.remove_invite = function(i){\n\n\n                vm.new_booking.passengers.splice(i, 1);\n                vm.init_passengers();\n\n\n        }\n\n\n        // vm.remove_passenger = function(i){\n\n\n        //     var to_remove = vm.new_booking.passengers[i];\n        //     if( vm.pax_invited(to_remove) ){\n\n        //         //full removal from the backend\n        //         BookingService.DeleteInvitation(to_remove, to_remove.id)\n        //         .then(function(data){\n        //             // //console.log(data);\n        //             if(data.success == true){\n        //                 //alert(data.message);\n        //                 vm.new_booking.passengers.splice(i, 1);\n        //                 vm.init_passengers();\n        //             } else {\n        //                 alert(data.message);\n        //             }\n\n        //         });\n\n\n\n\n        //     } else {\n\n        //         //this pax was not YET saved - hence just remove from list\n\n        //         vm.new_booking.passengers.splice(i, 1);\n        //         vm.init_passengers();\n\n        //     }\n\n        //         //below YES --> but needs to remove the invitation as well.\n\n        //         // vm.new_booking.passengers.splice(i, 1);\n        //         // vm.init_passengers();\n\n        // }\n\n        vm.resend_invitation = function(i){\n\n\n            var to_resend = vm.new_booking.passengers[i];\n             BookingService.ResendInvitation(to_resend, to_resend.id)\n                .then(function(data){\n                    // //console.log(data);\n                    if(data.success == true){\n                        ToastService.success(\"Invitation Resent\", data.message);\n                    } else {\n                        ToastService.error(\"Resend Failed\", data.message);\n                    }\n\n                });\n\n\n        }\n\n        vm.pax_invited = function(pax){\n            if(pax.status == \"\" || pax.status == \"to_invite\"){\n                return false;\n            }\n            return true;\n        }\n\n        vm.get_passenger_status = function(member){\n            // //console.log(\"MEMBER\", member);\n            if(member){\n\n                if(member.is_member){\n                    // //console.log(\"this one is true\");\n                    return \"This passenger is already club member and hence is ready for flight\";\n                } else {\n\n                    if(member.status == \"accepted\"){\n                        return \"This passenger has accepted the terms and is ready for flight\";\n                    } else if(member.status == \"declined\"){\n                        return \"This passenger has declined the terms\";\n                    } else if(member.status == \"to_invite\"){\n                        return \"Invitation will be sent once the booking is saved.\";\n                    } else if(member.status == \"invited\"){\n                        return \"This passenger has been invited but has not yet responded.\";\n                    } else {\n                        return \"\";\n                    }\n                }\n\n                return \"\";\n            }\n\n        }\n\n        vm.get_passenger_status_edit = function(member){\n            // //console.log(\"MEMBER\", member);\n            if(member){\n\n                if(member.is_member){\n                    // //console.log(\"this one is true\");\n                    return \"This passenger is already club member and hence is ready for flight\";\n                } else {\n\n                    if(member.status == \"accepted\"){\n                        return \"This passenger has accepted the terms and is ready for flight\";\n                    } else if(member.status == \"declined\"){\n                        return \"This passenger has declined the terms\";\n                    } else if(member.status == \"to_invite\"){\n                        return \"Invitation will be sent once the booking is saved.\";\n                    } else if(member.status == \"member\"){\n                        return \"This passenger is a member\";\n                    } else if(member.status == \"invited\"){\n                        return \"This passenger has been invited but has not yet accepted.\";\n                    }else {\n                        return \"\";\n                    }\n                }\n\n                return \"\";\n            }\n\n        }\n\n        vm.invite_new_passenger = function(index){\n\n            // //console.log(\"HERE\");\n            // //console.log(vm.new_booking.passengers[index]);\n\n            vm.show_new_passenger_invitation = true;\n            vm.new_pax = index;\n\n            vm.new_booking.passengers.push({\n                    first_name: \"\",\n                    last_name: \"\",\n                    email: \"\",\n                    status: \"\"\n                });\n\n\n        }\n\n        vm.close_passenger_invitation = function(){\n            vm.new_pax = -1;\n            vm.show_new_passenger_invitation = false;\n        }\n\n\n        vm.get_members = function(name, i){\n\n\n            // console.log(\"GET MEMBER\", name);\n            // console.log(\"GET vm.club_id : \", vm.club_id);\n            // console.log(\"GET vm.new_booking : \", vm.new_booking.club_id);\n            // console.log(\"GET vm.new_booking.plane.club_id : \", vm.new_booking.plane.club_id);\n            ////console.log(\"get members\", name);\n            if((vm.club_id == 0 || !vm.club_id) && vm.new_booking.plane && vm.new_booking.plane.id){\n                vm.club_id = vm.new_booking.plane.club_id;\n            }\n\n            if((vm.club_id == 0 || !vm.club_id) && vm.new_booking && vm.new_booking.club_id && vm.new_booking.club_id > 0){\n                vm.club_id = vm.new_booking.club_id;\n            }\n            console.log(\"GET vm.club_id : \", vm.club_id);\n\n            if(name && name.length > 2){\n\n                 MemberService.GetAllByClubAndName(vm.club_id, name)\n                .then(function (data) {\n                    ////console.log(data);\n                    if(data.success){\n                        //use GB airfields first...\n\n                        //filter the ones that are already there....\n                        // myArray.filter( el => !toRemove.includes( el ) );\n                        // var myArray = data.members.filter( el => !vm.bookout.passengers.includes( el ) ); //filter( ( el ) => !vm.bookout.passengers.includes( el ) );\n\n\n                        var filtered_array = data.members.filter(ar => !vm.new_booking.passengers.find(rm => (rm.email === ar.email) ));\n                        //vm.members = data.members;\n                        vm.members = filtered_array;\n                        ////console.log(\"CHECK JANES\", myArray);\n\n\n                        if(vm.members.length < 1){\n                            // //console.log(\"not found in members\");\n                            // vm.new_pax.not_found = true;\n                            // vm.new_pax.email = \"\";\n                            // vm.new_pax.status = \"\";\n                            // vm.new_pax.first_name = \"\";\n                            // vm.new_pax.last_name = \"\";\n\n                            vm.new_pax = {\n                                id: 0,\n                                email: \"\",\n                                first_name: \"\",\n                                last_name: \"\",\n                                is_member: false,\n                                status: \"\",\n                                not_found: true\n                            };\n\n                            \n                           // var email_regex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$/;\n\n                            var email_regex = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n                            if(email_regex.test(name)){\n\n                                vm.new_pax.email = name;\n\n                            } else {\n                                if(name.indexOf(\" \") > -1){\n                                    var splits = name.split(\" \");\n                                    vm.new_pax.first_name = splits[0];\n                                    vm.new_pax.last_name = splits[1];\n                                } else {\n                                    vm.new_pax.first_name = name;\n                                }\n                            }\n\n\n                        }\n\n                        return true;\n\n                    } else {\n                        //clear original vals\n                            vm.new_pax.status = \"\";\n                            vm.new_pax.email = \"\";\n                            vm.new_pax.first_name = \"\";\n                            vm.new_pax.last_name = \"\";\n                        //if email add the email here\n\n                             var email_regex = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n                            \n                                       // var email_regex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$/;\n\n                            if(email_regex.test(name)){\n                                ////console.log(\"here we match?  it is an email?\");\n                                vm.new_pax.email = name;\n                                vm.new_pax.not_found = true;\n\n                            } else {\n                                ////console.log(\"user not found?\");\n                            }\n\n\n                        // var email_regex = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n                        // if(email_regex.test(name)){\n\n                        //         clearTimeout(setting_new_member);\n                        //         setting_new_member = undefined;\n\n                        //         setting_new_member = setTimeout(set_new_member, 900, name, index);\n\n                        // } else {\n                        //     //console.log(\"WOOOPSIES...\");\n                        //     //this should be very very rare...\n                        // }\n                        \n\n                       return false;\n                    }\n\n                });\n\n\n            }\n        }\n\n\n        // $scope.get_members = function(name, index){\n\n\n        //     ////console.log(\"get members\", name);\n        //     if((vm.club_id == 0 || !vm.club_id) && vm.new_booking.plane && vm.new_booking.plane.id){\n        //         vm.club_id = vm.new_booking.plane.club_id;\n        //     }\n\n        //     if(name.length > 2){\n\n        //          MemberService.GetAllByClubAndName(vm.club_id, name)\n        //         .then(function (data) {\n        //             // //console.log(data);\n        //             if(data.success){\n        //                 //use GB airfields first...\n        //                 vm.members = data.members;\n\n        //                 if(vm.members.length < 1){\n        //                     ////console.log(\"not found in members\");\n        //                     vm.new_booking.passengers[index].not_found = true;\n        //                     vm.new_booking.passengers[index].email = \"\";\n        //                     vm.new_booking.passengers[index].status = \"\";\n        //                     vm.new_booking.passengers[index].first_name = \"\";\n        //                     vm.new_booking.passengers[index].last_name = \"\";\n\n                            \n        //                    // var email_regex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$/;\n\n        //                     var email_regex = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n        //                     if(email_regex.test(name)){\n\n        //                         vm.new_booking.passengers[index].email = name;\n\n        //                     } else {\n        //                         if(name.indexOf(\" \") > -1){\n        //                             var splits = name.split(\" \");\n        //                             vm.new_booking.passengers[index].first_name = splits[0];\n        //                             vm.new_booking.passengers[index].last_name = splits[1];\n        //                         } else {\n        //                             vm.new_booking.passengers[index].first_name = name;\n        //                         }\n        //                     }\n\n\n        //                 }\n\n        //             } else {\n        //                 //clear original vals\n        //                     vm.new_booking.passengers[index].status = \"\";\n        //                     vm.new_booking.passengers[index].email = \"\";\n        //                     vm.new_booking.passengers[index].first_name = \"\";\n        //                     vm.new_booking.passengers[index].last_name = \"\";\n        //                 //if email add the email here\n\n        //                      var email_regex = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n                            \n        //                                // var email_regex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$/;\n\n        //                     if(email_regex.test(name)){\n        //                         ////console.log(\"here we match?  it is an email?\");\n        //                         vm.new_booking.passengers[index].email = name;\n        //                         vm.new_booking.passengers[index].not_found = true;\n\n        //                     } else {\n        //                         ////console.log(\"user not found?\");\n        //                     }\n\n\n        //                 // var email_regex = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n        //                 // if(email_regex.test(name)){\n\n        //                 //         clearTimeout(setting_new_member);\n        //                 //         setting_new_member = undefined;\n\n        //                 //         setting_new_member = setTimeout(set_new_member, 900, name, index);\n\n        //                 // } else {\n        //                 //     //console.log(\"WOOOPSIES...\");\n        //                 //     //this should be very very rare...\n        //                 // }\n                        \n\n                   \n        //             }\n\n        //         });\n\n\n        //     }\n        // }\n\n        $scope.save = function(){\n            if(vm.action == \"add\"){\n                ////console.log(\"CREATE click\");\n                $scope.create();\n            } else {\n                ////console.log(\"EDIT click\");\n                ////console.log(vm.club.membership);\n                generate_datetimes();\n                $scope.update();\n            }\n        }\n\n        $scope.update = function() {\n            var d = new Date();\n            d.setHours( 14 );\n            d.setMinutes( 0 );\n            $scope.mytime = d;\n        };\n\n        vm.show_self_option = false;\n\n        $scope.select_plane = function(val){\n            $scope.check_rental_items();\n            free_places();\n\n            ////console.log(\"AIRCRAFT SELECTED\");\n            if( (vm.user.access.instructor.indexOf(vm.club_id) > -1) || (vm.user.access.manager.indexOf(vm.club_id) > -1) ){\n                vm.show_self_option = true;\n            } else {\n                vm.show_self_option = false;\n            }\n\n\n            if(vm.user.access.instructor.indexOf(vm.club_id) > -1){\n                // //console.log(\"THIS IS AN INSTRUCTOR IN THIS CLUB...\");\n                vm.booking_self = false;\n            }\n\n            \n        }\n\n        // Handler for when an aircraft is selected in the INSTRUCTOR-FIRST flow\n        // Derives club from plane, loads members + courses, refreshes instructors for that plane\n        vm.onInstructorPlaneSelected = function(){\n            if(!vm.new_booking.plane) return;\n\n            var booking_club_id = parseInt(vm.new_booking.plane.club_id);\n            vm.club_id = booking_club_id;\n\n            // Set permissions based on club role\n            if((vm.user.access.instructor.indexOf(booking_club_id) > -1) || (vm.user.access.manager.indexOf(booking_club_id) > -1)){\n                vm.booking_self = false;\n                vm.show_self_option = true;\n            }\n            if(vm.user.access.manager.indexOf(booking_club_id) > -1){\n                vm.booking_admin = true;\n            }\n\n            // Generate datetimes for the API calls\n            generate_datetimes();\n\n            var from = new Date(vm.new_booking.start_datetime).toISOString();\n            var to = new Date(vm.new_booking.end_datetime).toISOString();\n            var savedInstructor = vm.new_booking.instructor;\n\n            // Load members for this club\n            var bed = new Date(vm.new_booking.end_datetime).toISOString();\n            MemberService.GetAllActiveByClub(booking_club_id, bed)\n            .then(function(data){\n                vm.members = data.members || data;\n                if(vm.members && vm.members.length > 0){\n                    for(var j = 0; j < vm.members.length; j++){\n                        vm.members[j].is_member = true;\n                    }\n                }\n            });\n\n            // Load courses for this club\n            CourseService.GetCoursesByClubId(booking_club_id)\n            .then(function(data){\n                vm.courses = data.items;\n            });\n\n            // Refresh instructors for this specific plane, but preserve our pre-selected instructor\n            var show_all = 1;\n            BookingService.GetPlaneInstructors(vm.user.id, vm.new_booking.plane.id, from, to, show_all)\n            .then(function(data){\n                vm.instructors = data;\n\n                // Try to match our pre-selected instructor in the updated list\n                if(savedInstructor){\n                    var found = false;\n                    for(var i = 0; i < vm.instructors.length; i++){\n                        if(vm.instructors[i].id == savedInstructor.id || vm.instructors[i].user_id == savedInstructor.user_id){\n                            // Update to the full API instructor object\n                            vm.new_booking.instructor = vm.instructors[i];\n                            found = true;\n                            break;\n                        }\n                    }\n                    if(!found){\n                        // Instructor not available for this plane - keep them but warn\n                        // Add them to the list so the dropdown still shows them\n                        vm.instructors.push(savedInstructor);\n                    }\n                }\n\n                free_places();\n            });\n\n            // Check rental items\n            $scope.check_rental_items();\n        };\n\n        function generate_datetimes(){\n            var start = new Date(vm.new_booking.start_date);\n            var c = new Date();\n            var start_split = (vm.new_booking.start_time) ? vm.new_booking.start_time.time.split(\":\") : [c.getHours(), c.getMinutes()];\n            // var start_split = vm.new_booking.start_time.time.split(\":\");\n\n            start.setHours(start_split[0]);\n            start.setMinutes(start_split[1]);\n            start.setSeconds(0);\n\n            var end = new Date(vm.new_booking.end_date);\n            //var end_split = vm.new_booking.end_time.time.split(\":\");\n            var end_split = (vm.new_booking.end_time) ? vm.new_booking.end_time.time.split(\":\") : [c.getHours(), c.getMinutes()];\n\n            end.setHours(end_split[0]);\n            end.setMinutes(end_split[1]);\n            end.setSeconds(0);\n\n            vm.new_booking.start_datetime = start.toISOString();//moment(start).format(\"Y-MM-DD HH:mm\");\n            vm.new_booking.end_datetime = end.toISOString();//moment(end).format(\"Y-MM-DD HH:mm\");\n            // console.log(\"GENERATE DATETIME ==> \", vm.new_booking.start_datetime);\n            // console.log(\"GENERATE DATETIME ==> \", vm.new_booking.end_datetime);\n        }\n\n        function get_times(data, tofrom){\n            var date = $scope.myDatetimeRange.date[tofrom];\n            var d = date.getDate();\n            var m = date.getMonth();\n            var y = date.getFullYear();\n            \n            //need to combuine both\n            var a = data[tofrom];\n            var h = a.slice(0,2);\n            var i = a.slice(3,5);\n            // i = (i == 00)? 0 : i;\n            i = (i.toString() == \"00\")? 0 : i;\n\n            // $scope.myDatetimeRange.date.from = new Date(y, m, d, h, m, 0);\n            // //console.log(\"vars are: \"+y+\", \"+m+\", \"+d+\", \"+h+\", \"+i+\", \"+0+\" soooo\");\n            var date = new Date(y, m, d, h, i, 0);\n            return date;\n        }\n\n        function check_business_hours(i, k = null, start = 0){\n            //i is hours\n            //k is minutes\n            k = parseInt(k);\n            i = parseInt(i);\n\n            var this_step_disabled = 0; \n            if(vm.new_booking.options.business_hours){\n                var split = vm.new_booking.options.business_hours.from.split(\":\");\n                var split2 = vm.new_booking.options.business_hours.to.split(\":\");\n\n                if(start == 0){\n                    //adjust to match times / end min 1 hour slots\n                   // split2[0] = parseInt(split2[0]) + 1;\n                } else {\n                    split2[0] = parseInt(split2[0]) - 1;\n                }\n\n                if(k || k == 0){\n                    \n                    if(i < parseInt(split[0]) ){\n                        // //console.log(\"we disable because \"+i+\":\"+k+\" is before \"+split.join(\":\") );\n                        this_step_disabled = 1;\n                    } else if(i == parseInt(split[0]) && k < parseInt(split[1])){\n                         // //console.log(\"we disable because \"+i+\":\"+k+\" is before \"+split.join(\":\") );\n                        this_step_disabled = 1;\n                    }\n\n                    // if(i >= parseInt(split2[0]) && k >= parseInt(split2[1]) ){\n                    //     // //console.log(\"we disable because \"+i+\":\"+k+\" is after \"+split2.join(\":\") );\n                    //     this_step_disabled = 1;\n                    // } \n\n\n                    if(i > parseInt(split2[0])){\n                        this_step_disabled = 1; \n                    } else if( i == parseInt(split2[0]) && k > parseInt(split2[1])){\n                        this_step_disabled = 1;\n                    }\n\n\n                } else {\n                    if(parseInt(split[0]) < i){\n                        this_step_disabled = 1;\n                    } \n                    if(parseInt(split2[0]) > i){\n                        this_step_disabled = 1;\n                    } \n                }\n            }\n\n            return this_step_disabled;\n        }\n\n\n   \n\n    function clean_times(which, start_end, compared_to = null){\n\n        var compare_date;\n\n        switch(which){\n            case 'today':\n                compare_date = new Date();\n            break;\n            case 'past':\n                //we need to consider the back-dating as possible issue...\n                compare_date = new Date(\"1990-07-26\");\n            break;\n            case 'future':\n                compare_date = new Date(\"1990-07-26\");\n            break;\n            case 'after':\n            //differentiate here\n                compare_date = new Date(compared_to);\n            break;\n            case 'before':\n            //differentiate here\n                compare_date = new Date(compared_to);\n            break;\n        }\n\n            var this_date = new Date(vm.new_booking.start_date);\n\n            // //console.log(\"HERE WE GO this_date!\", this_date);\n            // //console.log(\"HERE WE GO start_end!\", start_end);\n            // //console.log(\"HERE WE GO vm[start_end]!\", vm[start_end]);\n\n            vm[start_end].forEach(function(time, i){\n\n                //this may very well be the case function here to change when the re-do the times            \n                var split_time = time.time.split(\":\");\n                this_date.setHours(split_time[0]);\n                this_date.setMinutes(split_time[1]);\n                this_date.setSeconds(0);\n\n\n                if( moment(this_date).isAfter(moment(compare_date)) ){\n                    //vm[start_end][i].disabled = 0;\n                    vm[start_end][i].disabled = check_business_hours(parseInt(split_time[0]), parseInt(split_time[1]), (start_end == \"start_times\")? 1 : 0);\n                } else {\n                    vm[start_end][i].disabled = 1;\n                }\n            });\n\n        //by definition as we are changing something to cause this function from being called - we need to recalculate the times:\n        calculate_duration();\n\n    }\n\n    function get_duration_str(seconds){\n        //var seconds = Math.floor(seconds);\n        // //console.log(seconds);\n        // //console.log(moment.duration(seconds));\n        // //console.log(\"days: \"+moment.duration(seconds).days());\n        // //console.log(\"hours: \"+moment.duration(seconds).hours());\n        // //console.log(\"minutes: \"+moment.duration(seconds).minutes());\n\n        var days = moment.duration(seconds).days();\n        var hours = moment.duration(seconds).hours();\n        var minutes = moment.duration(seconds).minutes();\n\n        //occasional issue showing 59 minutes - unsure where but this is a fix for it... think moment() has a bug\n        if(minutes == 59){\n            hours++;\n            minutes = 0;\n        }\n\n\n        var string = \"\";\n        if(days > 0){\n            string = string+\" \"+days+\" day\";\n            string = (days > 1)? string+\"s\" : string;\n        }\n        if(hours > 0){\n            string = string+\" \"+hours+\" hour\";\n            string = (hours > 1)? string+\"s\" : string;\n        }\n        if(minutes > 0){\n            string = string+\" \"+minutes+\" minute\";\n            string = (minutes > 1)? string+\"s\" : string;\n        }\n\n         // //console.log(\"STR : \"+string);\n\n        return string;\n\n    }\n\n    function add_hour_to_end(){\n        var a = vm.new_booking.start_time.time.split(\":\");\n        //var b = new Date();\n        var b = new Date(vm.new_booking.start_date);\n        b.setHours(a[0]);\n        b.setMinutes(a[1]);\n        b.setSeconds(0);\n        var future = moment(b).add(1, \"hour\").format();\n       // clean_times('after', 'end_times', future);\n       //\n\n         //clean_times(check_relative_date(vm.new_booking.end_date, \"end\"), 'end_times', future);\n\n\n\n        if(parseInt(a[0]) >= 23){\n            if(moment(vm.new_booking.start_date).isSame(moment(vm.new_booking.end_date))){\n                 // //console.log(\"THIS ADD DAY\");\n                // //console.log(\"start\", vm.new_booking.start_date);\n                // //console.log(\"end\", vm.new_booking.end_date);\n                 // //console.log(\"after or = 11pm - then we need to change the date that follows the same pattern\");\n                vm.new_booking.end_date = new Date(moment(vm.new_booking.end_date).add(1, \"day\").format());\n                clean_times('future', 'end_times');\n\n                //set it to 00:00 hours probably a wise thing...\n                vm.new_booking.end_time = vm.end_times[0];\n\n\n            } \n        } else {\n            clean_times('after', 'end_times', b);\n        }\n\n    }\n\n\n    function start_after_end(){\n            var start_after_end = false;\n            if(vm.new_booking.end_time){\n                // //console.log(\"START AFTER END LOOP\");\n                var start_datetime = new Date(vm.new_booking.start_date);\n                var start_time = vm.new_booking.start_time.time.split(\":\");\n                start_datetime.setHours(start_time[0]);\n                start_datetime.setMinutes(start_time[1]);\n                start_datetime.setSeconds(0);\n\n                var end_datetime = new Date(vm.new_booking.end_date);\n                var end_time = vm.new_booking.end_time.time.split(\":\");\n                end_datetime.setHours(end_time[0]);\n                end_datetime.setMinutes(end_time[1]);\n                end_datetime.setSeconds(0);\n\n                if(moment(start_datetime).isAfter(moment(end_datetime)) || moment(start_datetime).isSame(end_datetime) || end_datetime == start_datetime){\n                    start_after_end = true;\n                }\n\n\n            }\n            return start_after_end;\n    }\n\n\n    function booking_today(){\n        if(moment(vm.new_booking.start_date).format(\"DD/MM/YYYY\") == moment().format(\"DD/MM/YYYY\")){\n            // //console.log(\"WE ARE TODAY?\");\n            clean_times('today', 'start_times');\n\n        } else {\n            // //console.log(\"should get full day\");\n            if(moment(vm.new_booking.start_date).isAfter(moment()) ){\n                clean_times('future', 'start_times');\n            }\n        }\n\n        if(moment(vm.new_booking.end_date).format(\"DD/MM/YYYY\") == moment().format(\"DD/MM/YYYY\")){\n            if(vm.new_booking.start_time){\n               // //console.log(\"START TIME\", vm.new_booking.start_time);\n                add_hour_to_end(); \n            }\n            clean_times(check_relative_date(vm.new_booking.start_date), 'end_times');\n        }\n\n\n        if(vm.new_booking.end_date == vm.new_booking.start_date){\n                // //console.log(\"booking today where end = start\");\n                if(vm.new_booking.start_time){\n                    var a = vm.new_booking.start_time.time.split(\":\");\n                    var b = new Date(vm.new_booking.start_date);\n                    b.setHours(a[0]);\n                    b.setMinutes(a[1]);\n                    b.setSeconds(0);\n\n                    //we need to check the times give\n                    if(start_after_end()){\n                        clean_times(check_relative_date(vm.new_booking.start_date), 'start_times');\n                        // //console.log(\"UPDATE END BITS IF START > END required?\");\n                        clean_times(check_relative_date(vm.new_booking.end_date, \"end\"), 'end_times', b);\n                        add_hour_to_end();\n                    } else {\n                        // //console.log(\"UPDATE END BITS IF START > END 2\", check_relative_date(vm.new_booking.start_date, \"end\"));\n                        clean_times(check_relative_date(vm.new_booking.end_date, \"end\"), 'end_times', b);\n                    }\n\n\n                }\n        }\n\n    }\n\n    // clean_times('today', 'start_times');\n    booking_today();\n\n\n    function check_relative_date(date, start_end = \"start\"){\n        var relative = \"today\";\n        // //console.log(\"RELATIVE TIME CHECK\", date);\n        if(moment(moment(date).format(\"YYYY/MM/DD\")).isAfter(moment().format(\"YYYY/MM/DD\"))){\n            relative = \"future\";\n\n            //then is after today\n            // the catch is that if date == start / end date --> THEN we need to present that it is today even though it isnt - this is premise\n            // that is valid only for the \"END\" cases (so that we return AFTER rather than today) --> otherwise the end_times available won't reflect\n            //the fact that the start_times have been selected allowing the user to select an end time before start time (which is silly really...)\n\n            if(vm.new_booking.start_date && vm.new_booking.end_date && start_end == \"end\"){\n                if(moment(vm.new_booking.start_date).isSame(moment(vm.new_booking.end_date))){\n                    relative = \"after\"; // because we need to act as though it is after in the clean_times (to not be able to select end < start times)\n                }\n            }\n            \n        } else if(moment(date).format(\"YYYY/MM/DD\") == moment().format(\"YYYY/MM/DD\")){\n            //then today\n            relative = (start_end == \"start\") ? \"today\" : \"after\";\n        } else {\n            //must be in the past...\n            relative = \"past\";\n        }\n\n        \n        // //console.log(\"relative is \", relative);\n        return relative;\n    }\n\n\n      if($stateParams.start){\n                    //alert(\"add\");\n                    vm.new_booking.start_date = new Date($stateParams.start);\n                    vm.new_booking.end_date = new Date($stateParams.start);\n                    vm.new_booking.start_time = {time: moment($stateParams.start).format(\"HH:mm\")};\n                    vm.new_booking.end_time = {time: moment($stateParams.start).add(30, \"minutes\").format(\"HH:mm\") };\n                    var default_end = moment($stateParams.start).add(30, \"minutes\");\n\n                    vm.default_date = vm.new_booking.start_date;\n\n                    $(\"#calendar\").fullCalendar(\"gotoDate\", vm.new_booking.start_date );\n\n\n                    setTimeout(function(){\n\n\n\n\n                        var new_event = [{\n                                         \"id\":\"TEMP\",\n                                         \"title\":\"TEMPORARY\",\n                                         \"resourceId\": 7,\n                                         \"start\":$stateParams.start,\n                                         \"end\":default_end,\n                                         \"editable\":false,\n                                         \"color\":\"rgb(255, 110, 110)\",\n                                         \"opacity\":\"1\"\n                                      }];\n                    \n\n                                        $('#calendar').fullCalendar('addEventSource', new_event);\n                                                    setTimeout(function(){\n\n\n\n                                                        //scrolling?\n\n\n                                                    }, 500);\n\n                        $scope.update_dateTime(\"edit2\", $stateParams.plane_id);\n\n\n\n                    }, 500);\n\n                    \n\n\n      \n\n                }\n\n                vm.already_added_temp = false;\n\n\n    // vm.add_booking_event = function(obj){\n\n    //     vm.new_booking.start_date = new Date(obj.start);\n    //     vm.new_booking.end_date = new Date(obj.start);\n    //     vm.new_booking.start_time = {time: moment(obj.start).format(\"HH:mm\")};\n    //     //console.log(\"PLANE => \", vm.planes.find(x => parseInt(x.id) === parseInt(obj.plane_id) ));\n    //     alert(\"HI\");\n    //     vm.new_booking.plane = vm.planes.find(x => parseInt(x.id) === parseInt(obj.plane_id) );\n\n    //     vm.new_booking.end_time = {time: moment(obj.start).add(30, \"minutes\").format(\"HH:mm\") };\n    //     var default_end = moment(obj.start).add(30, \"minutes\");\n\n    //     vm.default_date = vm.new_booking.start_date;\n\n    //       var new_event = {\n    //                          \"id\":\"TEMP\",\n    //                          \"title\":\"TEMPORARY\",\n    //                          \"resourceId\": 7,\n    //                          \"start\":obj.start,\n    //                          \"end\":default_end,\n    //                          \"editable\":false,\n    //                          \"color\":\"rgb(255, 110, 110)\",\n    //                          \"opacity\":\"1\"\n    //                       };\n                   \n\n    //     if(vm.already_added_temp){\n\n    //             $('#calendar').fullCalendar(\"removeEvents\", \"TEMP\")\n           \n\n    //                 setTimeout(function(){\n\n    //                     $scope.update_dateTime(\"edit\");\n\n\n    //                     $('#calendar').fullCalendar('renderEvent', new_event);\n    //                 }, 100);\n\n\n    //     } else {\n\n    //         setTimeout(function(){\n\n           \n        \n\n    //                         $('#calendar').fullCalendar('renderEvent', new_event);\n    //                         vm.already_added_temp = true;\n    //                                     setTimeout(function(){\n\n    //                                         //console.log(\"new_even\", new_event);\n\n    //                                         //scrolling?\n\n\n    //                                     }, 500);\n\n    //         $scope.update_dateTime(\"edit2\", obj.plane_id);\n\n\n\n    //     }, 500);\n\n    //     }\n\n        \n\n        \n\n    // }\n\n\n\n\n    vm.add_booking_event = function(obj){\n\n        // Auto-open the booking panel when a diary slot is clicked\n        vm.bookingPanelOpen = true;\n\n        vm.new_booking.start_date = new Date(obj.start);\n        vm.new_booking.end_date = new Date(luxon.DateTime.fromISO(new Date(obj.end).toISOString()).plus({minutes: 60}).toISO());//new Date(obj.start).toISOString();\n        vm.new_booking.start_time = {time: moment(obj.start).format(\"HH:mm\")};\n\n\n        vm.new_booking.end_time = {time: moment(obj.start).add(60, \"minutes\").format(\"HH:mm\") };\n        // var default_end = new Date(new Date(obj.start).getTime() + 30*60000); //moment(obj.start).add(30, \"minutes\");\n        // var default_end = luxon.DateTime.fromMillis(obj.start).plus({minutes: 30}).toFormat(\"HH:mm\");\n        // var default_end2 = luxon.DateTime.fromMillis(obj.start).plus({minutes: 30}).toISO();\n        // var default_end3 = luxon.DateTime.fromMillis(obj.start).plus({minutes: 30}).toFormat(\"yyyy-MM-DD HH:mm:ss\");\n\n        // console.log(\"ADD BOOKING EVENT : \", default_end);\n        // console.log(\"ADD BOOKING EVENT : \", obj.start);\n        // console.log(\"ADD BOOKING EVENT : \", luxon.DateTime.fromMillis(obj.start));\n        // console.log(\"ADD BOOKING EVENT : \", luxon.DateTime.fromMillis(obj.start).toFormat(\"HH:mm\"));\n        // console.log(\"ADD BOOKING EVENT 2: \", default_end2);\n        // console.log(\"ADD BOOKING EVENT 3: \", default_end3);\n\n        // console.log(\"ADD BOOKING EVENT s: \", vm.new_booking.start_date);\n        // console.log(\"ADD BOOKING EVENT e: \", vm.new_booking.end_date);\n\n        //luxon.DateTime.fromString(obj.start).toFormat(\"HH:mm\");\n        // console.log(\"CHECK START DATE HERE???\");\n        // console.log(vm.new_booking.start_date);\n        // console.log(vm.new_booking.start_date.toISOString());\n\n         BookingService.GetAllPlanes(vm.user.id, vm.new_booking.start_date.toISOString(), vm.new_booking.end_date.toISOString(), 0, 0)\n            .then(function(data){\n               \n                //this gets the events and bookings for the period checked here...\n                // var events = data.events;\n                vm.planes = data;\n\n                // Instructor resource IDs start with \"fi_\" followed by the user_id\n                var resourceId = String(obj.plane_id);\n                var isInstructorRow = resourceId.indexOf(\"fi_\") === 0;\n\n                console.log(\"[DIARY CLICK] resourceId:\", resourceId);\n                console.log(\"[DIARY CLICK] isInstructorRow:\", isInstructorRow);\n                console.log(\"[DIARY CLICK] resourceObj:\", obj.resourceObj);\n                console.log(\"[DIARY CLICK] planes loaded:\", vm.planes.length);\n\n                if(isInstructorRow){\n                    // Strip \"fi_\" prefix to get the instructor's user_id\n                    var instructorUserId = parseInt(resourceId.replace(\"fi_\", \"\"));\n                    console.log(\"[DIARY CLICK] Instructor user_id extracted:\", instructorUserId);\n\n                    // Set the instructor-first booking flag\n                    vm.instructor_first_booking = true;\n\n                    // Set booking permissions so instructor/member fields are visible\n                    vm.booking_self = false;\n                    vm.booking_admin = true;\n                    vm.show_self_option = true;\n\n                    var start_iso = vm.new_booking.start_date.toISOString();\n                    var end_iso = vm.new_booking.end_date.toISOString();\n\n                    // Fetch the full instructor object via new endpoint\n                    BookingService.GetInstructorByUser(instructorUserId)\n                    .then(function(instructorData){\n                        console.log(\"[DIARY CLICK] GetInstructorByUser response:\", instructorData);\n\n                        vm.new_booking.instructor = instructorData;\n                        vm.instructors = [instructorData];\n\n                        // Now fetch planes this instructor can teach on via new endpoint\n                        return BookingService.GetInstructorPlanes(vm.user.id, instructorUserId, start_iso, end_iso);\n                    })\n                    .then(function(planesData){\n                        console.log(\"[DIARY CLICK] GetInstructorPlanes response:\", planesData);\n\n                        vm.planes = planesData;\n                        console.log(\"[DIARY CLICK] Instructor planes loaded:\", vm.planes.length);\n\n                        $scope.update_dateTime(\"edit2\");\n                    });\n                } else {\n                    // Clicked on a plane row  aircraft-first flow\n                    vm.instructor_first_booking = false;\n                    vm.new_booking.plane = vm.planes.find(x => parseInt(x.id) === parseInt(obj.plane_id) );\n                    $scope.update_dateTime(\"edit2\");\n                }\n\n            });\n       \n\n\n    }\n\n\n    $scope.calendarOptions = {\n        initialView: 'dayGridMonth'\n    };\n\n    $scope.calendarEvents = [\n        { title: 'Event 1', start: '2024-02-17' },\n        { title: 'Event 2', start: '2024-02-18' }\n    ];\n\n\n    //  Field validation helper \n    // Returns the first missing field name, highlights + scrolls to it, or null if all ok\n    function validateBookingFields() {\n        // Clear previous error markers\n        var prev = document.querySelectorAll('.make_booking_table tr.field-error');\n        for (var i = 0; i < prev.length; i++) { prev[i].classList.remove('field-error'); }\n\n        var checks = [\n            { ok: vm.new_booking.start_time,  id: 'field-start-time',  label: 'Start Time' },\n            { ok: vm.new_booking.end_time,    id: 'field-end-time',    label: 'End Time' },\n            { ok: vm.new_booking.plane,       id: 'field-aircraft',    label: 'Aircraft' }\n        ];\n\n        // Member is required when booking for someone else\n        if (!vm.booking_self) {\n            checks.push({ ok: vm.new_booking.user, id: 'field-member', label: 'Member' });\n        }\n\n        for (var j = 0; j < checks.length; j++) {\n            if (!checks[j].ok) {\n                var row = document.getElementById(checks[j].id);\n                if (row) {\n                    row.classList.add('field-error');\n                    row.scrollIntoView({ behavior: 'smooth', block: 'center' });\n                }\n                ToastService.error('Missing: ' + checks[j].label, 'Please fill in the highlighted field before submitting.');\n                return checks[j].label;\n            }\n        }\n        return null;\n    }\n\n    $scope.make_booking = function(isValid){\n\n       //console.log(\"make booking\", isValid);\n            $scope.submitted = true;\n\n            // Validate required fields first  catch missing member etc. before they crash\n            var missingField = validateBookingFields();\n            if (missingField) { return false; }\n\n            // check to make sure the form is completely valid\n            if(isValid) {\n                // //console.log('our form is working');\n                //then we send the booking request to the server woooohooooo!\n\n                //clean and prepare the bits that we require\n                var booking = {};\n                var booking = jQuery.extend(true, {}, vm.new_booking); \n                // //console.log(booking);\n                delete booking.options;\n                delete booking.instructor;\n                delete booking.plane;\n                delete booking.start_date;\n                delete booking.start_time;\n                delete booking.end_date;\n                delete booking.end_time;\n                delete booking.start_datetime;\n                delete booking.end_datetime;\n                delete booking.tuition_required;\n                delete booking.user;\n                // //console.log(booking);\n                // //console.log(vm.new_booking);\n\n                //generate_datetimes();\n\n                // //console.log(\"START DATE1 : \", vm.new_booking.start_datetime );\n\n                // //console.log(\"START DATE2 : \", moment(vm.new_booking.start_datetime).isAfter() );\n                // //console.log(\"START DATE3 : \", moment(vm.new_booking.start_datetime).isBefore() );\n\n                // //console.log(\"START DATE4 : \", moment(Date.parse(vm.new_booking.start_datetime)) );\n                // //console.log(\"END DATE : \", moment(vm.new_booking.end_datetime) );\n                // //console.log(\"NOW : \", moment());\n\n                //console.log(vm.new_booking.start_datetime);\n\n                if(moment(Date.parse(vm.new_booking.end_datetime)).add(60, \"minutes\").isBefore()){\n                    ToastService.error(\"Booking in the past\", \"This booking ends in the past  you cannot create a booking in the past.\");\n                    return false;\n                }\n                //60 mintues leeway in case of booking starting within the 15 minute period or similar\n                if(moment(Date.parse(vm.new_booking.start_datetime)).add(60, \"minutes\").isBefore()){\n                    ToastService.error(\"Booking in the past\", \"This booking starts in the past  you cannot create a booking in the past.\");\n                    return false;\n                }\n\n\n\n\n\n                booking.override = (vm.new_booking.override) ? vm.new_booking.override : 0;\n\n                if(vm.booking_self){\n                    // //console.log(\"SELF\");\n                    booking.user_id = vm.user.id;\n                    booking.instructor_id = (vm.new_booking.instructor) ? vm.new_booking.instructor.id : 0;\n                    // //console.log(\"USER IS \", booking.user_id);\n                } else {\n                    // //console.log(\"NON SELF\");\n\n                    booking.user_id = vm.new_booking.user.user_id;\n                    if(vm.user.access.manager.indexOf(vm.club_id) > -1){\n                        //admin does not automatically become the instructor...\n                        booking.instructor_id = (vm.new_booking.instructor) ? vm.new_booking.instructor.id : 0;                \n                    } else {\n                        //then its an instructor - so likely booking for student not just member\n                        booking.instructor_id = vm.user.id;                \n                    }\n                    booking.booked_by_admin_instructor = 1;\n                    booking.override = 1;\n\n                }\n               \n\n\n\n\n                booking.free_seats = (vm.new_booking.free_seats.constructor === Array) ? 0 : vm.new_booking.free_seats;\n                booking.start = vm.new_booking.start_datetime;\n                booking.end = vm.new_booking.end_datetime;               \n                booking.plane_id = vm.new_booking.plane.id;\n                booking.club_id = vm.new_booking.plane.club_id;\n                booking.booked_by = vm.user.id;\n                booking.course_id = (vm.new_booking.tuition_required) ? vm.new_booking.tuition_required.id : 0;\n\n                booking.maintenance_flight = vm.new_booking.maintenance_flight;\n                // //console.log(\"UUID \",booking.user_id);\n\n                // return false;\n\n                // //console.log(\"new booking obj to be sent... \",booking);\n\n                //make booking call with new_booking as items to send! :D wooohoooooooo :P\n                BookingService.Create(vm.user.id, booking)\n                .then(function(data){\n\n                    if(data.success == true){\n                        // //console.log(\"WAS SENT HERE! \");\n                        $scope.clear_booking();\n                        \n                        //console.log(\"START IS\", booking.start);\n                        // var split = booking.start.split(\"-\");\n                        // var month = (parseInt(split[1]) > 9) ? split[1] : \"0\"+split[1];\n                        // var day_split = split[2].split(\" \");\n                        // var day = (parseInt(day_split[0]) > 9) ? day_split[0] : \"0\"+day_split[0];\n                        // var rebuild = split[0]+\"-\"+month+\"-\"+day+\"T\"+day_split[1]+\":00\";\n\n                        // //var split = booking.start.replace(\" \", \"T\")+\":00\";\n\n\n                        // console.log(\"START TO: \", rebuild);\n                        // console.log(\"START TO\", moment(rebuild).format(\"Y-MM-DD\"));\n\n                        // console.log(\"START IS\", moment(booking.start).format(\"Y-MM-D\"));\n\n                        BookingService.GetAll(vm.user.id, moment(booking.start).format(\"Y-MM-DD\"), \"\")\n                            .then(function(data){\n                                       //console.log(data);        \n\n                                ToastService.success(\"Booking Created\", \"Your booking has been created successfully.\");\n\n                                $scope.all_events = data.events;\n                                $scope.all_resources = data.resources;\n\n                                $('#calendar').fullCalendar('refetchEvents');\n                                $('#calendar').fullCalendar('removeEvents');\n                                $('#calendar').fullCalendar('addEventSource', $scope.all_events);\n                            });\n\n                        \n\n                        //$(\"#calendar\").fullCalendar(\"refetchEvents\");\n                        //must have some sort of feedback saying booking was made successfully!\n                        $state.go('dashboard.add_booking');\n                    } else {\n\n                        // //console.log(\"clearly something went wrong here... :'-( \", data.message);\n                        //if it is something about currency - perhaps return the possibility of self-certify or book instructor for this purpose!\n                        \n                        if(data.more && data.more.length > 0){\n                            console.log(\"MORE\", data);\n                            var addon = \"\";\n\n                            for(var i=0;i<data.more.length;i++){\n                                if(data.more[i][\"name\"] == \"differences_verified\"){\n                                    addon += \"\\n - Your differences training sign-offs need to be verified by a member of staff. \\n\";\n                                }\n                                if(data.more[i][\"name\"] == \"licence_verified\"){\n                                    addon += \"\\n - Your licence needs to be verified by a member of staff. \\n\";\n                                }\n                                if(data.more[i][\"name\"] == \"medical_verified\"){\n                                    addon += \"\\n - Your medical needs to be verified by a member of staff. \\n\";\n                                }\n                                if(data.more[i][\"name\"] == \"medical\"){\n                                    addon += \"\\n - You need to upload a copy of your medical. \\n\";\n                                }\n                                if(data.more[i][\"name\"] == \"licence\"){\n                                    addon += \"\\n - You need to upload a copy of your licence. \\n\";\n                                }\n                                if(data.more[i][\"name\"] == \"differences\"){\n                                    addon += \"\\n - You need to upload a copy of your differences training signed off. \\n\";\n                                }\n                                // addon += \"You need to add your \"+data.more[i][0]+\" to book solo\";\n                            }\n                            // //console.log(\"MORE:: \", addon);\n\n                            data.message = data.message + addon;\n                        }\n                        \n                        //console.log(\"NO MORE\", data);\n\n                        if(data.allow_override){\n\n                            if(vm.user.access.manager.indexOf(vm.club_id) > -1){\n                                //admin does not automatically become the instructor...\n                                //alert(\"we can override this\");\n\n                                var errors = [];\n                                if(data.reason == \"instructor\"){\n                                    errors.push({\n                                        type: \"instructor\",\n                                        message: \"It looks like the instructor is not available for this booking\",\n                                        api: data.instructor,\n                                        override: \"instructor_override\",\n                                        button: \"OVERRIDE INSTRUTOR AVAILABILITY\" \n                                    });\n                                } \n\n                                vm.new_booking_errors = errors;\n                                // else if(data.check_user !== true){\n\n                                //     if(data.check_user.indexOf(\"self-certify\") > -1){\n\n                                //         errors.push({\n                                //             type: \"check_user\",\n                                //             message: \"It would appear that you are not within the currency requirements to book this aircraft for this flight.\",\n                                //             api: data.check_user,\n                                //             override: \"currency_override\",\n                                //             button: \"I am Current\" \n                                //         });\n\n\n                                //     } else {\n                                //         errors.push({\n                                //             type: \"check_user\",\n                                //             message: \"It looks like your user account does not allow this booking to happen\",\n                                //             api: data.check_user,\n                                //             override: \"currency_override\",\n                                //             button: \"\" \n                                //         });\n                                //     }\n\n                                   \n                                // } else if(data.rental_items !== true){\n                                //     errors.push({\n                                //         type: \"rental_items\",\n                                //         message: \"It looks like some of the rental items are not available\",\n                                //         api: data.rental_items,\n                                //         override: \"update_rental_items\",\n                                //         button: \"Confirm Changes\" \n                                //     });\n                                // }\n\n\n\n                            }\n\n\n                        }\n\n\n\n                        ToastService.error(\"Booking Error\", data.message);\n                    }\n                    \n                });\n\n\n            } else {\n                //console.log(\"NOT SENT - please fix errors\");\n            }\n\n    }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        \n        \n\n      \n\n\n\n\n\n\n\n\n\n\n\n\n        // MODALS FOR ALL THE POPUPS TO BE CHANGED INTO --> SAMPLE HERE\n\n        // var warning_msg = \"By deleting this membership, you will also cancel all reservations that this membership currently has.\"\n\n        $scope.popup2 = {\n          opened: false\n        };\n\n        $scope.popup3 = {\n          opened: false\n        };\n\n        $scope.popup4 = {\n          opened: false\n        };\n          \n        $scope.open2 = function() {\n          $scope.popup2.opened = true;\n        };\n\n          $scope.open3 = function() {\n          $scope.popup3.opened = true;\n        };\n\n          $scope.open4 = function() {\n          $scope.popup4.opened = true;\n        };\n\n\n        $scope.open = function (member_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return member_id;\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (member_id) {\n              $log.info('PRESSED GO: '+member_id);\n              MemberService.Delete(member_id)\n              .then(function(){\n                ////console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.members = $.grep(vm.club.members, function(e){ \n                    return e.id != member_id; \n                });\n              })\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n          };\n\n         \n\n\n    }\n app.controller('BookingsController', BookingsController);\n\n    BookingsController.$inject = ['UserService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'BookingService', 'InstructorCharges', 'CourseService', 'ToastService'];\n    function BookingsController(UserService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, BookingService, InstructorCharges, CourseService, ToastService) {\n        \n        var vm = this;\n        var defaultStartTime = 480;\n        var defaultEndTime = 1080;\n\n        $scope.va1 = '123';\n        \n\n        vm.user = $rootScope.globals.currentUser;\n\n        vm.allUsers = [];\n        vm.club = {};\n        vm.page_title = \"\";\n        vm.club.member = {};\n        \n        vm.imported_new_headers = [];\n        vm.see_booking = {};\n\n        vm.is_current = false;\n        vm.currency_type = \"\";\n        vm.currency_days = \"\";\n\n        vm.booking_self = true;\n\n        vm.times_clean_type = \"start_times\";\n\n\n        // vm.club.member.membership_id = {};\n        \n        vm.action = $state.current.data.action;\n        vm.return_to = $state.current.data.return_to;\n        vm.club_id = 0;\n\n        //just in case i missed a changed value...\n        vm.user_id = vm.user.id;\n\n        vm.no_show_cols = [\"membership_start\", \"membership_id\", \"selected\"];\n\n        var newDate = new Date();\n        \n        var h_start = Math.floor( defaultStartTime / 60 );          \n        var i_start = defaultStartTime % 60;\n        var h_end = Math.floor( defaultEndTime / 60 );          \n        var i_end = defaultEndTime % 60;\n\n        var defaultStart = new Date(newDate.getFullYear(), newDate.getMonth(), newDate.getDate(), h_start, i_start, 0);\n        var defaultEnd = new Date(newDate.getFullYear(), newDate.getMonth(), newDate.getDate(), h_end, i_end, 0);\n        vm.default_date =  new Date();\n\n        vm.datepickerOptions = {\n            customClass: getDayClass,\n            format: 'dd/MM/yyyy',\n            showWeeks: false\n        }\n\n        vm.dateTimeRangePickerOptions = {\n            hour_step: 1,\n            minute_step: 30,\n            min_date: today,\n            datepicker:{\n                customClass: getDayClass,\n                format: 'dd/MM/yyyy',\n                showWeeks: false,\n                minDate: today\n            }\n            ,\n            business_hours: {\n                from: \"09:00\",\n                to: \"22:30\"\n            }\n        };\n\n        $scope.whole_day_booking = false;\n\n\n        // BookingService.GetAll(vm.user.id, moment().format(\"Y-M-D\"), \"\")\n        //     .then(function(data){\n        //         $scope.all_events = data.events;\n        //         $scope.all_resources = data.resources;\n        //     });\n\n\n        vm.instructor_charges = [];\n\n\n\n\n        vm.cancellation = { \n                            reasons: [\n                                \"Pilot Unwell\",\n                                \"Pilot Unavailable\",\n                                \"Weather at home base\",\n                                \"Weather at destination\",\n                                \"Plane Unavailable\",\n                                \"Plane Unserviceable\",\n                                \"Plane Returned Too Late by previous booking\",\n                                \"Instructor Not Available\",\n                                \"Airfield Closed\",\n                                \"Airspace Closed\",\n                                \"Other - please specify\"\n                            ],\n                            notes: \"\"\n                        };\n\n\n\n        var today = new Date();\n        today.setMinutes(0);\n        today.setSeconds(0);\n        var end = moment(today);\n        end.add(2, \"hours\");\n        end = new Date(end);\n        end.setSeconds(0);\n\n        var datepicker_today = new Date().format(\"d/M/yyyy\");\n\n\n        vm.start_times = [];\n        vm.end_times = [];\n\n        vm.new_booking = {\n            start_date: today,\n            end_date: today,\n            free_seats: [],\n            passengers: [],\n            options: vm.dateTimeRangePickerOptions\n        };\n\n        $scope.toggle = true;\n        $scope.whentimechangedata = {};\n        $scope.overridePicker = true;\n\n        var date = Date();\n        vm.planes = [];\n        init_times();\n\n      $scope.formats = ['dd/MM/yyyy', 'yyyy/MM/dd', 'dd.MM.yyyy', 'shortDate'];\n      $scope.format = $scope.formats[0];\n        //prepare_add_edit();\n\n\n       \n\n\n        switch(vm.action){\n            case \"add\":\n                //console.log(\"adding a new member please\");\n                vm.page_title = \"Add a Booking\";\n\n                //update_bookings();\n\n                vm.new_booking = {\n                                    start_date: today,\n                                    end_date: today,\n                                    free_seats: [],\n                                    passengers: [],\n                                    options: vm.dateTimeRangePickerOptions\n                };\n                figure_out_steps();\n\n\n\n\n\n            break;\n            case \"edit\":\n                vm.page_title = \"Edit a Booking\";\n                //console.log(\"edit an existing booking\");\n\n                vm.see_booking.visible = 0;\n\n                // vm.default_date = new Date(\"2016-10-11\");\n                vm.new_booking = {\n                                    start_date: today,\n                                    end_date: today,\n                                    free_seats: [],\n                                    passengers: [],\n                                    options: vm.dateTimeRangePickerOptions\n                };\n                figure_out_steps();\n                //vm.new_booking.\n                //get a single events\n                \n                update_bookings();\n\n                if($stateParams.booking_id){\n\n\n\n                     BookingService.GetEdit(vm.user.id, $stateParams.booking_id)\n                        .then(function(data){\n                            //console.log(\"GETTING CONTENT FROM EDIT : \", data);\n\n                            if(data.success){\n\n\n                                //console.log(\"EDIT THIS CONTENT HERE\", data);\n                                //console.log(\"CHECK CONTENT FROM RETURN\", data.booking.instructor);\n\n                                vm.new_booking = data.booking;\n                                //console.log(\"MY INSTRUCTOR HERE: \", vm.new_booking.instructor);\n                                vm.new_booking.options = vm.dateTimeRangePickerOptions;\n                                vm.new_booking.edit_booking = 1;\n\n                                vm.new_booking.start_date = new Date(vm.new_booking.start);\n                                // vm.new_booking.start_time = {time: moment(vm.new_booking.start).format(\"HH:mm\"), disabled: 1};\n                                vm.new_booking.start_time = {time: moment(vm.new_booking.start).format(\"HH:mm\")};\n                                vm.new_booking.end_date = new Date(vm.new_booking.end);\n                                vm.new_booking.end_time = {time: moment(vm.new_booking.end).format(\"HH:mm\")};\n\n                                vm.new_booking.after_booking_end = moment().isAfter(moment(vm.new_booking.end));\n                                \n                                //vm.default_date = new Date(vm.new_booking.start);\n                                \n                                \n                                if(vm.new_booking.instructor && vm.new_booking.instructor.id == vm.user_id){\n                                    vm.booking_self = false;\n                                }\n\n\n                                 //this will require breaking up quite a bit... but to access the parent one...\n                                $scope.$parent.vm.default_date =  vm.new_booking.start_date;\n                                setTimeout(function(){\n                                    $scope.$parent.vm.see_booking.visible = 0;\n                                    $scope.$apply();\n\n\n\n                                }, 1000);\n\n                                // //console.log(\"DEFAULT\", vm.default_date);                               \n\n                                generate_datetimes();\n\n                                $scope.update_dateTime(\"edit\");\n                                \n                                // //console.log(\"EDIT\", vm.new_booking);\n                                // //console.log(\"=== CHECK AT EDIT\", vm.new_booking.instructor);\n                                \n\n                                // InstructorCharges.GetByClubId(vm.new_booking.club_id)\n                                //     .then(function(data){\n\n                                //         vm.instructor_charges = data.items;  \n                                //         // //console.log(\"====> \", data); \n                                //     });\n\n                                //vm.courses\n\n                                CourseService.GetCoursesByClubId(vm.new_booking.club_id)\n                                .then(function(data){\n                                    vm.courses = data.items;   \n                                });\n\n\n\n                                //get all the club members by first and last name and email --> nothing else\n                                //this would only include the members that are for the plane that was selected....\n\n\n                                ////console.log(\"BEFORE GET\", vm.new_booking.end_time);\n                                prepare_add_edit(vm.new_booking.club_id, vm.new_booking.end);\n\n\n\n                                if(vm.new_booking.rental_items){\n                                    //then we may have shizzle to check / update\n                                    for(var i=0;i<vm.new_booking.rental_items.length;i++){\n                                        //first and foremost we need to check the available bits....\n                                        // //console.log(\"NO TO BOOK: \"+vm.new_booking.rental_items[i][\"number_to_book\"]);\n                                        vm.new_booking.rental_items[i][\"number_to_book\"] = parseInt(vm.new_booking.rental_items[i][\"number_to_book\"]);\n                                    }\n                                }\n\n                                if(vm.new_booking.free_seats){\n                                    // //console.log(\"FREE\", vm.new_booking.free_seats);\n                                    vm.new_booking.free_seats = parseInt(vm.new_booking.free_seats);\n                                }\n\n                                if(vm.new_booking.instructor){\n                                    // //console.log(\"MY INSTRUCTOR HERE22: \", vm.new_booking.instructor);\n\n                                }\n\n\n\n\n                                if((vm.club_id == 0 || !vm.club_id) && vm.new_booking.plane && vm.new_booking.plane.id){\n                                    vm.club_id = vm.new_booking.plane.club_id;\n                                }\n\n                                free_places();\n                                \n                                // //console.log(\"MY INSTRUCTOR HERE2244: \", vm.new_booking.instructor);\n\n                            } else {\n                                ToastService.error('Booking Error', data.message);\n                                $state.go('dashboard.bookings.add');\n                            }\n\n                        });\n\n\n                }\n               \n\n\n               \n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                // //console.log(\"VM\", vm);\n                // //console.log(\"VM\", $stateParams);\n\n                //alert(\"LIST\");\n                //alert(moment($stateParams.start).add(1, \"hour\").format(\"HH:mm\"));\n\n             \n\n\n                vm.show_no_membership_message = false;\n                vm.hide_dropdown = false; \n                vm.clubs = [];\n\n                //we need to get the memberships that the user is a member of....\n                MemberService.GetUserClubs(vm.user.id)\n                 .then(function(data){\n                        vm.clubs = data.clubs;\n\n                        //console.log(\"CLUBS HERE : \", data);\n\n                        if(vm.clubs && vm.clubs.length > 1){\n                            vm.hide_dropdown = true;\n                        } else if(vm.clubs.length == 1) {\n                            vm.club_id = vm.clubs[0].id;\n                            // //console.log(\"SETTING THE CLUB ID HERE:: \", vm.club_id);\n                        }\n                    \n                        update_bookings();\n\n                    });\n                 \n                 //generate_datetimes();\n\n                //  BookingService.GetAllPlanes(vm.user.id, moment(vm.new_booking.start_datetime).format(\"Y-M-D HH:mm\"), moment(vm.new_booking.end_datetime).format(\"Y-M-D HH:mm\"), 0, 0)\n                // .then(function(data){\n                   \n                //     vm.planes = data;\n                //     // //console.log(\"PLANES NOW SET\", vm.planes);\n                //     if($stateParams.plane_id){\n                //         // //console.log(\"plane_id\", $stateParams.plane_id);\n                //         for(var i=0;i<vm.planes.length;i++){\n                //             // //console.log(\"I\", i);\n                //             // //console.log(\"id 1\", vm.planes[i].id);\n                //             // //console.log(\"I\", i);\n                //             if(parseInt(vm.planes[i].id) == $stateParams.plane_id){\n                //                 vm.new_booking.plane = vm.planes[i];\n                //                 // //console.log(\"found\", vm.planes[i]);\n                //             }\n                //         }\n\n                //     }\n\n                // });\n\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n\n\n        function getAllPlaneUpdate(){\n            check_times();\n            //$scope.update_dateTime('edit');\n             // BookingService.GetAllPlanes(vm.user.id, vm.new_booking.start_datetime, vm.new_booking.end_datetime, 0, 0)\n             //    .then(function(data){\n                   \n             //        //this gets the events and bookings for the period checked here...\n             //        // var events = data.events;\n             //        vm.planes = data;\n                \n\n             //    });\n        }\n\n        \n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        /* THIS SECTION IS ABOUT THE CALENDAR SHOWN ON ALL PAGES */\n\n\n        /* FUNCTIONS REQUIRED FOR ALL PAGES SHOWING THE BOOKINGS ON CALENDAR */\n\n\n        $scope.test = function(){\n            //console.log(\"UPDATE\");\n            vm.new_booking.instructor = {\n                id: 90,\n                first_name: \"A\",\n                last_name: \"REYNIER\"\n            };\n        }\n    \n\n    $scope.updateEvents = function(start, end){\n        ////console.log(\"start\", start, \"end\", end);\n\n        BookingService.GetAll(vm.user.id, start, end)\n        .then(function(data){\n            //console.log(data);\n\n            $scope.all_events = data.events;\n            $scope.all_resources = data.resources;\n\n            // //console.log(\"hello\", $scope.all_events);\n            // //console.log(\"hello\", $scope.all_resources);\n\n            return data;\n\n        });\n    }\n\n\n\n    /* Render Tooltip */\n    $scope.eventRender = function( event, element, view ) {\n        element.attr({'tooltip': event.title,\n                      'tooltip-append-to-body': true});\n        $compile(element)($scope);\n    };\n\n    \n    $scope.alertOnClicked = function(calEvent, jsEvent, view){\n            \n            vm.see_booking = calEvent;\n\n            vm.see_booking.start_date = moment(vm.see_booking.start).format(\"DD/MM/YYYY\");\n            vm.see_booking.end_date = moment(vm.see_booking.end).format(\"DD/MM/YYYY\");\n            vm.see_booking.start_time = moment(vm.see_booking.start).format(\"HH:mm\");\n            vm.see_booking.end_time = moment(vm.see_booking.end).format(\"HH:mm\");\n\n            vm.see_booking.start_datetime = new Date(new Date(vm.see_booking.start).toUTCString());\n            vm.see_booking.end_datetime = new Date(vm.see_booking.end);\n            vm.see_booking.visible = 1;\n\n            vm.see_booking.after_booking_end = moment().isAfter(moment(vm.see_booking.end));\n\n            $scope.$apply();\n    };\n\n\n    $scope.close_details = function(){\n            vm.see_booking.visible = 0;\n    }\n\n\n    $scope.changeLang = function() {\n    \n        $scope.uiConfig.calendar.dayNames = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\n        $scope.uiConfig.calendar.dayNamesShort = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n      \n    };\n\n    $scope.changed = function () {\n        // $log.log('Time changed to: ' + $scope.mytime);\n        $scope.check_plane_availability();\n    };\n\n    function j_changed() {\n        // $log.log('Time changed to: ' + $scope.mytime);\n        $scope.check_plane_availability();\n    };\n\n    $scope.check_plane_availability = function(){\n       \n        generate_datetimes();\n\n        //getALL?\n        var getA = (vm.new_booking.edit_booking == 1)? 1 : 0;\n        var plane_id = (vm.new_booking.plane_id > 0)? vm.new_booking.plane_id : 0;\n        if(vm.new_booking.plane && vm.new_booking.plane.id){\n            plane_id = vm.new_booking.plane.id;\n        }\n\n        console.log(\"START\", vm.new_booking.start_datetime);\n        // console.log(\"START\", moment(vm.new_booking.start_datetime).format(\"Y-M-D HH:mm\"));\n        console.log(\"START iso\", new Date(vm.new_booking.start_datetime).toIsoString());\n        console.log(\"END\", vm.new_booking.end_datetime);\n\n        BookingService.GetAllPlanes(vm.user.id, vm.new_booking.start_datetime, vm.new_booking.end_datetime, 0, plane_id)\n        .then(function(data){\n           \n            //this gets the events and bookings for the period checked here...\n            // var events = data.events;\n            vm.planes = data;\n            \n\n            if(getA == 1){\n                //then I just want to iterate through these and return the plane already selected as \"available...\"\n\n                ////console.log(\"PLANE\", vm.new_booking.plane);\n\n                for(var i = 0; i<vm.planes.length; i++){\n                    if(vm.planes[i].id == vm.new_booking.plane.id){\n                        reset_chosen = 0;\n                        vm.new_booking.plane = vm.planes[i];\n                        //chosen is still available WOOOO\n                        $scope.check_rental_items();\n                    }\n                }\n\n\n\n            } else {\n\n                 //check if anything was already selected...\n                var reset_chosen = 1;\n                if(vm.new_booking.plane){\n                    for(var i = 0; i<vm.planes.length; i++){\n                        if(vm.planes[i].id == vm.new_booking.plane.id){\n                            reset_chosen = 0;\n                            //chosen is still available WOOOO\n                            $scope.check_rental_items();\n                        }\n                    }\n                    if(reset_chosen == 1){\n                        //then we just need to clear currently selected plane\n                        vm.new_booking.plane = {};\n                        delete(vm.new_booking.plane);\n                    }\n                    //otherwise we can leave that we've already done! :)\n                }\n\n\n            }\n\n        });\n\n    }\n\n    $scope.events = [];\n\n    function getDayClass(data) {\n        var date = data.date,\n          mode = data.mode;\n        if (mode === 'day') {\n          var dayToCheck = new Date(date).setHours(0,0,0,0);\n\n          for (var i = 0; i < $scope.events.length; i++) {\n            var currentDay = new Date($scope.events[i].date).setHours(0,0,0,0);\n\n            if (dayToCheck === currentDay) {\n              return $scope.events[i].status;\n            }\n          }\n        }\n\n        return '';\n      }\n\n\n    $scope.addOne = function(start=null, plane_id=null, end=null){\n        // //console.log(\"ADDING HERE --> with \", start);\n\n        if(start && !end){                 \n            end = moment(start).add(1, \"hour\").format();\n        }\n\n        //alert(end);\n        $state.go('dashboard.bookings.add', {\"start\": start, \"plane_id\": plane_id, \"end\": end});\n    }\n\n    $scope.cancel_changes = function(){\n        $state.go('dashboard.bookings.add');\n    }\n\n    $scope.check_rental_items = function(){\n        generate_datetimes();\n\n        vm.rental_items = [];\n\n        if(vm.new_booking.plane){\n\n            var club_id = (vm.new_booking.edit_booking == 1) ? vm.new_booking.club_id : vm.new_booking.plane.club_id;\n\n            BookingService.GetRentalItems(club_id, moment(vm.new_booking.start_datetime).format(\"Y-M-D HH:mm\"), moment(vm.new_booking.end_datetime).format(\"Y-M-D HH:mm\"), 0)\n            .then(function(data){\n           \n                vm.rental_items = data;\n\n                if(vm.new_booking.rental_items){\n                    //then we may have shizzle to check / update\n                    for(var i=0;i<vm.new_booking.rental_items;i++){\n                        //first and foremost we need to check the available bits....\n                        var found = 0;\n                        for(var j=0;j<vm.rental_items.length;j++){\n                            if(vm.rental_items[j][\"id\"] == vm.new_booking.rental_items[i][\"id\"]){\n                                //then we need to check that the current numbers available are still the same as before...\n                                if(parseInt(vm.new_booking.rental_items[i][\"number_to_book\"]) > parseInt(vm.rental_items[j][\"number_available\"])){\n                                    vm.new_booking.rental_items[i][\"number_to_book\"] = parseInt(vm.rental_items[j][\"number_available\"]);\n                                }\n                                vm.new_booking.rental_items[i][\"number_available\"] = parseInt(vm.rental_items[j][\"number_available\"]);\n                                found = 1;\n                                break;\n                            }\n                        }\n                        if(found == 0){\n                            //then we need to remove it...\n                            delete vm.new_booking.rental_items[i];\n                        }\n\n                    }\n\n                }\n\n\n                for(var k=0; k<vm.rental_items.length;k++){\n                    vm.rental_items[k].number = 0;\n                }\n\n                //if there is one already selected?\n                //check if anything was already selected...\n                if(vm.new_booking.rental_items){\n                    for(var j=0; j<vm.new_booking.rental_items; j++){\n                        var reset_chosen = 1;\n                        for(var i = 0; i<vm.rental_items.length; i++){\n                            if(vm.rental_items[i].id == vm.new_booking.rental_items[j].id){\n                                reset_chosen = 0;\n                                //chosen is still available WOOOO\n                            }\n                        }\n                        if(reset_chosen == 1){\n                            //then we just need to clear currently selected plane\n                            delete vm.new_booking.rental_items[j];\n                        }\n                    }\n                    //otherwise we can leave that we've already done! :)\n                }\n\n\n\n\n            });\n\n        }\n    }\n\n    function check_times(clean_type = null){\n\n            var c = new Date();\n            var a = (vm.new_booking.start_time) ? vm.new_booking.start_time.time.split(\":\") : [c.getHours(), c.getMinutes()];\n            var b = new Date(vm.new_booking.start_date);\n            b.setHours(a[0]);\n            b.setMinutes(a[1]);\n            b.setSeconds(0);\n            var future = moment(b).add(1, \"hour\").format();\n\n            //check if the end_time is set && if the end time is > start time...\n            if(start_after_end() || !vm.new_booking.end_time){\n\n                clean_times(check_relative_date(vm.new_booking.end_date, \"end\"), 'end_times', b);\n\n                var id;\n                // vm.end_times.forEach(function(time, i){ \n                //   if(time.time == moment(future).format(\"H:mm\")){ id = i; return true;}; \n                // });\n                vm.end_times.some(function(time, i){ \n                  if(time.time == moment(future).format(\"HH:mm\")){ id = i; return i;};  \n                });\n\n                vm.new_booking.end_time = {};\n                vm.new_booking.end_time = vm.end_times[id];\n\n            } else {\n                if(!clean_type){\n                    clean_times(check_relative_date(vm.new_booking.end_date, \"end\"), 'end_times', b);\n                } \n            }\n\n\n             //need to update the selection of the end time if this has been set\n            if(vm.new_booking.end_time && vm.new_booking.end_time.disabled == 1){\n\n                var id;\n                //used to use a forEach loop but decided to run a some loop instead due to the benefit of not going through all elements\n                // vm.end_times.forEach(function(time, i){ \n                //   if(time.time == moment(future).format(\"HH:mm\")){ id = i; return true;}; \n                // });\n                vm.end_times.some(function(time, i){ \n                  if(time.time == moment(future).format(\"HH:mm\")){ id = i; return i;};  \n                });\n\n                vm.new_booking.end_time = {};\n                vm.new_booking.end_time = vm.end_times[id];\n\n            }\n\n            if(vm.new_booking.start_time && vm.new_booking.start_time.disabled == 1){\n                if(!clean_type){\n               \n                var id;\n                vm.start_times.some(function(time, i){ \n                  if(time.disabled == 0){ id = i; return i;}; \n                });\n\n                vm.new_booking.start_time = {};\n                vm.new_booking.start_time = vm.start_times[id];\n                 } \n\n                calculate_duration();\n            }\n    }\n\n    $scope.update_dateTime = function(which_update, params=null){\n\n        ////console.log(\"UPDATE TIME HERE\", which_update);\n\n        switch(which_update){\n\n            case 'start_date':\n\n                booking_today();\n\n                if(vm.new_booking.start_date > vm.new_booking.end_date){\n                    vm.new_booking.end_date = vm.new_booking.start_date;\n                }\n\n                clean_times(check_relative_date(vm.new_booking.start_date), 'start_times');\n\n                check_times();\n\n                if(start_after_end()){\n                    add_hour_to_end();\n                }\n\n            break;\n\n            case 'end_date':\n\n                 booking_today();\n                \n                check_times();\n\n                if(vm.new_booking.end_date < vm.new_booking.start_date){\n                    vm.new_booking.start_date = vm.new_booking.end_date;\n                    clean_times(check_relative_date(vm.new_booking.start_date), 'start_times');\n                } else {\n                    clean_times(check_relative_date(vm.new_booking.start_date), 'start_times');\n                    clean_times(check_relative_date(vm.new_booking.end_date, \"end\"), 'end_times');\n                }\n\n                if(start_after_end()){\n                    add_hour_to_end();\n                }\n\n\n            break;\n\n            case 'start_time':\n\n                // alert(\"start_time\");\n                //do we need to clean the times? if so.. \n                booking_today();\n\n                check_times();\n\n                //we need to calculate the time in between the start and the end!\n                calculate_duration();\n                \n\n            break;\n\n            case 'end_time':\n                // vm.times_clean_type = \"start_times\";\n                // if(moment(vm.new_booking.start).unix() < moment().unix()){\n                //     vm.times_clean_type = \"past\";\n                // }\n                if(vm.times_clean_type == \"past\"){\n                    //alert(\"end_time\");\n                    check_times(\"edit\");\n                } else {\n                    check_times();\n                }\n\n\n            break;\n\n            case 'edit':\n\n                // //this is the edit function that needs to be setup.\n                // booking_today();\n\n                // //number 1 = we have set start and end of the current date....\n                // // setTimeout(function(){\n                // //     check_times();\n                // //     // calculate_duration();\n                // // }, 5000);\n                // //console.log(\"ASD \",vm.new_booking.start_date);\n                // // clean_times(check_relative_date(vm.new_booking.start_date), 'start_times');\n                // check_times();\n                // calculate_duration();\n                //alert(\"EDIT 1\");\n\n\n //start_times\n                vm.times_clean_type = \"start_times\";\n                if(moment(vm.new_booking.start).unix() < moment().unix()){\n                    vm.times_clean_type = \"past\";\n                    //clean_times(check_relative_date(vm.new_booking.start_date), \"end_times\");\n                                \n\n\n                } else {\n                                check_times();\n                    booking_today();\n                }\n                calculate_duration();\n\n                setTimeout(function(){\n                    //do we need to clean the times? if so.. \n                    // pre_select_value_id(\"start_times\", vm.new_booking.start_time);\n                    pre_select_value_id();\n                    //we need to calculate the time in between the start and the end!\n                }, 500);\n\n\n\n\n                //we need to set the previously selected plane here...\n\n\n            break;\n\n            case 'edit2':\n\n                // //this is the edit function that needs to be setup.\n                // booking_today();\n\n                // //number 1 = we have set start and end of the current date....\n                // // setTimeout(function(){\n                // //     check_times();\n                // //     // calculate_duration();\n                // // }, 5000);\n                // //console.log(\"ASD \",vm.new_booking.start_date);\n                // // clean_times(check_relative_date(vm.new_booking.start_date), 'start_times');\n                // check_times();\n                // calculate_duration();\n\n                booking_today();\n\n                clean_times(check_relative_date(vm.new_booking.start_date), 'start_times');\n\n                check_times();\n\n                calculate_duration();\n\n                setTimeout(function(){\n                    //do we need to clean the times? if so.. \n                    // pre_select_value_id(\"start_times\", vm.new_booking.start_time);\n                    pre_select_value_id();\n                    //we need to calculate the time in between the start and the end!\n\n                     if(params){\n                        // alert(\"plane\");\n                        // alert(params);\n                        // //console.log(\"SELECT ME \", vm.planes);\n                                for(var i=0;i<vm.planes.length;i++){\n                                    // //console.log(\"I\", i);\n                                    // //console.log(\"id 1\", vm.planes[i].id);\n                                    // //console.log(\"I\", i);\n                                    if(parseInt(vm.planes[i].id) == params){\n                                        vm.new_booking.plane = vm.planes[i];\n                                        $scope.getPlaneInstructors(vm.new_booking.plane.id);\n                                         ////console.log(\"found\", vm.new_booking);\n                                         $scope.$apply();\n                                    }\n                                }\n                    }\n                    \n                }, 500);\n\n\n\n\n                //we need to set the previously selected plane here...\n\n\n            break;\n\n\n        }\n\n\n        //an update on the form would require an update of the plane / waiting lists available\n        $scope.check_plane_availability();\n\n        if(vm.new_booking.plane){\n            //then we check what is available for these guys!\n            $scope.check_rental_items();\n        }\n\n        //if the plane was already selected - then we can also update the instructors so as to not require\n        //the user to have to re-select the plane\n        if(vm.new_booking.plane){\n            $scope.getPlaneInstructors();\n        }\n\n\n    }\n\n\n\n\n    function pre_select_value_id(){\n\n        vm.start_times.forEach(function(times, i){\n            // //console.log(times.time+\" == \"+vm.new_booking.start_time.time);\n            if(times.time == vm.new_booking.start_time.time){\n                // //console.log(\"THIS I \", i);\n                vm.new_booking.start_time = vm.start_times[i];\n            }\n\n        });\n        // //console.log(\"END\", vm.end_times);\n\n         vm.end_times.forEach(function(times, i){\n\n            if(times.time == vm.new_booking.end_time.time){\n                // //console.log(\"THIS I \", i);\n                vm.new_booking.end_time = vm.end_times[i];\n            }\n\n        });\n\n        $scope.$apply();\n\n    }\n\n\n\n    $scope.update_booking = function(valid){\n\n\n        //alert(\"UPDATE\");\n\n        generate_datetimes();\n\n        if(valid){\n\n                // //console.log(\"VALID SUBMISSION\");\n                // //console.log(\"START\", vm.new_booking.start_datetime);\n                // //console.log(\"END\", vm.new_booking.end_datetime);\n\n                var booking = {};\n                var booking = jQuery.extend(true, {}, vm.new_booking); \n                // //console.log(booking);\n                delete booking.options;\n                delete booking.instructor;\n                delete booking.plane;\n                delete booking.start_date;\n                delete booking.start_time;\n                delete booking.end_date;\n                delete booking.end_time;\n                delete booking.start_datetime;\n                delete booking.end_datetime;\n                delete booking.tuition_required;\n                delete booking.after_booking_end;\n                // //console.log(booking);\n                // //console.log(vm.new_booking);\n                booking.free_seats = (vm.new_booking.free_seats.constructor === Array) ? 0 : vm.new_booking.free_seats;\n                booking.start = vm.new_booking.start_datetime;\n                booking.end = vm.new_booking.end_datetime;\n                booking.course_id = vm.new_booking.tuition_required.id;\n\n\n// Date.parse(vm.new_booking.start_datetime)\n\n                if(moment(Date.parse(vm.new_booking.end_datetime)).add(1, \"hour\").isBefore()){\n                    ToastService.warning('Past Booking', 'This booking ends in the past by more than an hour - you cannot amend a booking that finished in the past.');\n                    return false;\n                }\n                //30 mintues leeway in case of booking starting within the 15 minute period or similar\n                // if(moment(vm.new_booking.start_datetime).add(30, \"minutes\") < moment()){\n                //     alert(\"This booking starts in the past - you cannot create a booking in the past.\");\n                //     return false;\n                // }\n\n\n\n\n\n\n                // //console.log(\"START\", booking.start);\n                // //console.log(\"END\", booking.end);\n\n                ////console.log(\"PLANE\", vm.new_booking.plane);\n                booking.resourceId = vm.new_booking.plane.id;\n\n                if(vm.new_booking.plane.id.toString().indexOf(\"w\") > -1){\n                    booking.changed_to_waiting_list = true;\n                    booking.resourceId = vm.new_booking.plane.id.slice(0, -1);\n                }\n\n                if(!vm.booking_self){\n                    booking.user_id = vm.new_booking.user.user_id;\n                    booking.instructor_id = (vm.new_booking.instructor) ? vm.new_booking.instructor.id : vm.user.id;\n                } else {\n                    booking.user_id = vm.user.id;\n                    booking.instructor_id = (vm.new_booking.instructor) ? vm.new_booking.instructor.id : 0;\n                }\n                \n                \n\n\n                booking.plane_id = vm.new_booking.plane.id;\n                booking.override = (vm.new_booking.override) ? vm.new_booking.override : 0;\n                booking.club_id = vm.new_booking.plane.club_id;\n\n                // //console.log(\"====> booking to be sent = \", booking);\n\n                check_before_changing_event(booking);\n\n        }\n\n    }\n\n    $scope.update_club = function(){\n            //console.log(\"we changed club here\");\n            vm.club_id = vm.change_club.id;\n                //console.log(\"CLUB ID IS :\", vm.club_id);\n                if(vm.user.access.instructor.indexOf(vm.club_id) > -1 || vm.user.access.manager.indexOf(vm.club_id) > -1){\n                    //console.log(\"THIS IS AN INSTRUCTOR/MANAGER IN THIS CLUB...\");\n                    vm.booking_self = false;\n                } else {\n                    vm.booking_self = true;\n                }\n            //now we need to update the planes the user can see on the calendar! \n            update_bookings();\n\n    }\n\n    function update_bookings(){\n\n\n         // BookingService.GetAllUserClub(vm.user.id,vm.club_id, moment().format(\"Y-M-D\"), \"\")\n         //        .then(function(data){\n                   \n         //            $scope.all_events = data.events;\n         //            $scope.all_resources = data.resources;\n\n         //        });\n\n         //console.log(\"UPDATE BOOKINGS \");\n         BookingService.GetAll(vm.user.id, moment().format(\"Y-M-D\"), \"\")\n        .then(function(data){\n            //console.log(data);\n\n            $scope.all_events = data.events;\n            $scope.all_resources = data.resources;\n\n            //console.log(\"hello\", $scope.all_events);\n            //console.log(\"hello\", $scope.all_resources);\n\n            return data;\n\n        });\n\n    }\n\n    /* alert on eventClick */\n    $scope.alertOnEventClick = function( date, jsEvent, view){\n        $scope.alertMessage = (date.title + ' was clicked ');\n        //console.log(\"HELLO BOOBIES\");\n        //console.log(event);\n        //show event details\n\n    };\n\n    /* alert on Drop */\n     $scope.alertOnDrop = function(event, delta, revertFunc, jsEvent, ui, view){\n  \n\n\n        if(event.resourceId.toString().indexOf(\"w\") > -1){\n            event.changed_to_waiting_list = true;\n            event.resourceId = event.resourceId.slice(0, -1);\n        }\n\n        // //console.log(\"HELLO BOOBIES\", event);\n\n\n        check_before_changing_event(event);\n       \n    };\n\n\n    /* alert on Resize */\n    $scope.alertOnResize = function(event, delta, revertFunc, jsEvent, ui, view ){\n        \n        check_before_changing_event(event);\n\n    };\n\n\n\n    $scope.override_booking_change = function(override){\n\n        vm.error_event[override] = true;\n        //vm.error_event.override = true;\n\n        check_before_changing_event(vm.error_event, true);\n\n\n    }\n\n    $scope.decline_booking_change = function(){\n\n        vm.booking_errors = {};\n        vm.error_event = {};\n        $('#calendar').fullCalendar('removeEvents');\n        $('#calendar').fullCalendar('addEventSource', all_events);\n\n    }\n\n\n    function check_before_changing_event(event, err=null){\n        //the important bit is the eventID \n\n       if(err){\n         vm.booking_errors = {};\n            vm.error_event = {};\n       }\n\n        var evnt = jQuery.extend({}, event);\n\n        // evnt.start = moment(evnt.start).format(\"YYYY-MM-DD HH:mm\");\n        // evnt.end = moment(evnt.end).format(\"YYYY-MM-DD HH:mm\");\n        \n        //this covers the change of plane for the booking...\n        evnt.plane_id = event.resourceId;\n        if(event.instructor_id !== \"\"){\n            evnt.instructor_id = event.instructor_id;\n        } else {\n            evnt.instructor_id = \"0\";\n        }\n        //updatable bits:\n\n        delete evnt._start;\n        delete evnt._end;\n        delete evnt._id;\n        delete evnt.source;\n        delete evnt._allDay;\n        delete evnt.allDay;\n        delete evnt.className;\n        delete evnt.plane;\n        delete evnt.title;\n        delete evnt.editable;\n        delete evnt.resourceIds;\n        evnt.update_rental_items = true;\n\n        // //console.log(\"EVENT CHANGE\", evnt);\n\n        var original_event;\n        for(var i=0; i<$scope.all_events.length;i++){\n            if($scope.all_events[i].id == evnt.id){\n                original_event = $scope.all_events[i];\n                // //console.log(\"original EVENT\", original_event);\n            }\n        }\n\n\n        // //console.log(\"original end: \", moment(original_event.end).unix());\n        // //console.log(\"new end is : \", evnt.end.unix());\n\n        // //console.log(\"1original start: \", original_event.start);\n        // //console.log(\"1new start is : \", evnt.start);\n\n        // //console.log(\"2original start: \", moment(original_event.start).unix());\n        // //console.log(\"2new start is : \", evnt.start.unix());\n\n        // //console.log(\"1original start again: \", original_event.start);\n\n\n        //event in the past cannot be amended AFTER the booking - but the booking can be exte\n\n        // //console.log(\"all_events\", $scope.all_events);\n\n        if(moment(Date.parse(evnt.end)) < moment()){\n            ToastService.warning('Past Booking', 'This booking ends in the past - you cannot amend a booking in the past.');\n            return false;\n        }\n        // 30 mintues leeway in case of booking starting within the 15 minute period or similar\n        if(moment(evnt.start).add(30, \"minutes\") < moment()){\n                // //console.log(\"start is older than 30 minutes ago\");\n                // //console.log(\"1original start again: \", original_event.start);\n\n            if(moment(original_event.end) !== evnt.end){\n                // //console.log(\"end is not the same end\");\n                // //console.log(\"original end: \", moment(original_event.end).unix());\n                // //console.log(\"new end is : \", evnt.end.unix());\n\n                var p = confirm(\"This booking starts in the past - you cannot amend the start date or time of a booking in the past, would you like to amend the end time along with any other changes you have made?\");\n                if(p){  \n                    // //console.log(\"START UPDATE = \",evnt.start );\n                    evnt.start = original_event.start;\n                    // //console.log(\"START UPDATE = \",evnt.start );\n                } else {\n                    return false;\n                }\n\n            }\n\n\n\n\n            //let's reset the booking'start time\n\n           \n\n\n\n\n           // return false;\n        }\n\n        // //console.log(\"UPDATE CONTENT BEFORE\", evnt);\n\n        BookingService.updateBooking(evnt, vm.user.id)\n        .then(function(data){\n            //console.log(data);\n\n            if(data.success == true){\n                //console.log(\"the booking did not need to be altered and has been updated successfully.\", evnt);\n\n                //only if the edition is being made from the \"edit\" otherwise the changes are already reflected appropriately.\n                if(evnt.edit_booking == 1){\n                    $scope.$parent.updateEvents(evnt.start, evnt.end);\n                }\n                \n                ToastService.success('Changes Saved', 'Your changes were saved successfully');\n                \n                if(vm.return_to == \"bookout\") {\n                    //console.log(\"WE ARE AT THE BOOKOUT BIT - SO RETURN THERE!!!\");\n                    $state.go('dashboard.my_account.bookout_with_booking', { \"booking_id\": event.id });\n                } else {\n                    //console.log(\"NORMAL booking\");\n                    $state.go('dashboard.bookings.add');\n                }\n\n\n\n            } else {\n                //display the error\n                //console.log(\"The booking cannot remain the same due to : \"+data.message);\n\n                //hollow :::     $(\"#calendar\").fullCalendar('refetchEvents');\n\n\n                //I have decided to do this as a sequential check / accept / decline as opposed to combined\n                //this can be altered at a later date to be combined, with accept / decline on each error\n                //but this is more work than i can do right now!\n\n                var errors = [];\n                if(data.instructor !== true){\n                    errors.push({\n                        type: \"instructor\",\n                        message: \"It looks like your instructor is not available on the updated date and time\",\n                        api: data.instructor,\n                        override: \"instructor_override\",\n                        button: \"\" \n                    });\n                } else if(data.check_user !== true){\n\n                    if(data.check_user.indexOf(\"self-certify\") > -1){\n\n                        errors.push({\n                            type: \"check_user\",\n                            message: \"It would appear that you are not within the currency requirements to book this aircraft for this flight.\",\n                            api: data.check_user,\n                            override: \"currency_override\",\n                            button: \"I am Current\" \n                        });\n\n\n                    } else {\n                        errors.push({\n                            type: \"check_user\",\n                            message: \"It looks like your user account does not allow this booking to happen\",\n                            api: data.check_user,\n                            override: \"currency_override\",\n                            button: \"\" \n                        });\n                    }\n\n                   \n                } else if(data.rental_items !== true){\n                    errors.push({\n                        type: \"rental_items\",\n                        message: \"It looks like some of the rental items are not available\",\n                        api: data.rental_items,\n                        override: \"update_rental_items\",\n                        button: \"Confirm Changes\" \n                    });\n                }\n\n\n                //show the errors:::\n\n                // alert(\"ERROR FOUND IN ALTERING THE BOOKING\");\n\n                vm.booking_errors = errors;\n                //console.log(\"ERRORS ARE : \", vm.booking_errors);\n                vm.error_event = evnt;\n\n                //on GO--> check_before_changing_event(evnt)    \n\n\n                //if CANCEL?\n                //this would reset the change... do we want this?\n                //$(\"#calendar\").fullCalendar('refetchEvents');\n\n\n\n            }\n\n            return data;\n\n        });\n\n    }\n\n    $scope.wholeDay = function(){\n\n       if($scope.whole_day_booking == true){\n            $scope.whole_day_booking = false;\n            $scope.myDatetimeRange.time.from = defaultStartTime;\n            $scope.myDatetimeRange.time.to = defaultEndTime;\n       } else {\n            $scope.whole_day_booking = true;\n            $scope.myDatetimeRange.time.from = 0;\n            $scope.myDatetimeRange.time.to = 1440;\n       }\n       \n\n    }\n\n    //Changing the view of the calendar\n    $scope.changeView = function(view,calendar) {\n      uiCalendarConfig.calendars[calendar].fullCalendar('changeView',view);\n    };\n\n    /* Change View */\n    $scope.renderCalender = function(calendar) {\n      $timeout(function() {\n        if(uiCalendarConfig.calendars[calendar]){\n          uiCalendarConfig.calendars[calendar].fullCalendar('render');\n        }\n      });\n    };\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    /* THIS SECTION IS ABOUT THE ADD / EDIT OF THE CALENDAR EVENTS VIA THE EDIT / ADD NEW BOOKING */\n\n    /* ADD OR EDIT THE BOOKING */\n\n    function figure_out_steps(){\n        //console.log(\"OPTIONS\", vm.dateTimeRangePickerOptions);\n        vm.new_booking.options = vm.dateTimeRangePickerOptions;\n         for(var i=0;i<24;i+=vm.new_booking.options.hour_step){\n\n            if(vm.new_booking.options.minute_step && vm.new_booking.options.minute_step > 0){\n                for(var j=0; j<(60/vm.new_booking.options.minute_step); j++){\n                    var k = vm.new_booking.options.minute_step * j;\n                    k = ((k < 10) ? '0' : '') + k;\n                    vm.start_times.push({time: i+\":\"+k, disabled: check_business_hours(i, k)});\n                    vm.end_times.push({time: i+\":\"+k, disabled: check_business_hours(i, k), duration: \"\"});\n                }\n            } else {\n                vm.start_times.push({time: i+\":00\", disabled: check_business_hours(i)});\n                vm.end_times.push({time: i+\":00\", disabled: check_business_hours(i), duration: \"\"});\n            }\n\n        }\n    }\n\n    function init_times(){\n       for(var i=0;i<24;i+=vm.new_booking.options.hour_step){\n\n            if(vm.new_booking.options.minute_step && vm.new_booking.options.minute_step > 0){\n                for(var j=0; j<(60/vm.new_booking.options.minute_step); j++){\n                    var k = vm.new_booking.options.minute_step * j;\n                    k = ((k < 10) ? '0' : '') + k;\n                    vm.start_times.push({time: i+\":\"+k, disabled: check_business_hours(i, k)});\n                    vm.end_times.push({time: i+\":\"+k, disabled: check_business_hours(i, k), duration: \"\"});\n                }\n            } else {\n                vm.start_times.push({time: i+\":00\", disabled: check_business_hours(i)});\n                vm.end_times.push({time: i+\":00\", disabled: check_business_hours(i), duration: \"\"});\n            }\n\n        } \n    }\n    \n\n    $scope.add_rental_item = function(){\n        if(vm.rental_item && vm.new_booking.rental_items && vm.rental_item.id){\n            var add_to_list = 1;\n            var delete_this = 0;\n            for(var j=0; j<vm.new_booking.rental_items.length; j++){\n                if(vm.new_booking.rental_items[j].id == vm.rental_item.id){\n                    add_to_list = 0;\n                    delete_this = vm.new_booking.rental_items[j];\n                    //console.log(\"item was already found there...\");\n                }\n            }\n            if(add_to_list == 1){\n                //then its not already in teh list!\n                vm.new_booking.rental_items.push(vm.rental_item);\n                delete vm.rental_item;\n\n            }\n\n        } else {\n            if(vm.rental_item){\n                //console.log(\"rental_item is: \", vm.rental_item);\n                if(!vm.new_booking.rental_items){\n                    //init here if its the first item...\n                    vm.new_booking.rental_items = [];\n                }\n                vm.new_booking.rental_items.push(vm.rental_item);\n                delete vm.rental_item;\n            }\n               \n        }\n\n    }\n\n\n    $scope.rental_item_remove = function(id){\n        //as this is before we actually do the shizzle!\n        vm.new_booking.rental_items = $.grep(vm.new_booking.rental_items, function(e){ \n                return e.id != id; \n        });\n    }\n\n\n\n    $scope.getPlaneInstructors = function(){\n\n\n        //console.log(\"CHANGE OF PLANE HERE\");\n\n        // Determine the club from the selected plane (most reliable source)\n        var booking_club_id = parseInt(vm.new_booking.plane.club_id) || vm.club_id;\n        vm.club_id = booking_club_id;\n\n        if((vm.user.access.instructor.indexOf(booking_club_id) > -1) || (vm.user.access.manager.indexOf(booking_club_id) > -1) ){\n            //console.log(\"NOT BOOKING FOR SELF?\");\n            vm.booking_self = false;\n            prepare_add_edit();\n        } else {\n            vm.booking_self = true;\n        }\n\n        if( vm.user.access.manager.indexOf(booking_club_id) > -1 ){\n            vm.booking_admin = true;\n        } else {\n            vm.booking_admin = false;\n        }\n\n        vm.init_passengers();\n        $scope.check_rental_items();\n\n\n        if(vm.action == \"add\"){\n\n          \n\n\n            BookingService.GetPlaneInstructors(vm.user.id, vm.new_booking.plane.id, vm.new_booking.start_datetime, vm.new_booking.end_datetime, (vm.booking_self)? 0 : 1)\n            .then(function(data){\n                //console.log(data);\n                //console.log(\"NEW INSTRUCTORS ARE : \", data);\n                vm.instructors = data;\n\n                var reset_chosen = 1;\n                if(vm.new_booking.instructor){\n                    for(var i = 0; i<vm.instructors.length; i++){\n                        if(vm.instructors[i].id == vm.new_booking.instructor.id){\n                            reset_chosen = 0;\n                        }\n                    }\n                    if(reset_chosen == 1){\n                        //then we just need to clear currently selected plane\n                        vm.new_booking.instructor = {};\n                        delete(vm.new_booking.instructor);\n                    }\n                    //otherwise we can leave that we've already done! :)\n                }\n                free_places();\n            });\n\n\n        } else {\n            //must be edit... sooooooo\n\n            BookingService.GetPlaneInstructorsEdit(vm.user.id, vm.new_booking.plane.id, vm.new_booking.start_datetime, vm.new_booking.end_datetime, (vm.booking_self)? 0 : 1, vm.new_booking.id)\n            .then(function(data){\n                //console.log(data);\n                //console.log(\"NEW INSTRUCTORS ARE : \", data);\n\n\n                vm.instructors = data;\n\n                var reset_chosen = 1;\n                if(vm.new_booking.instructor){\n                    for(var i = 0; i<vm.instructors.length; i++){\n                        if(vm.instructors[i].id == vm.new_booking.instructor.id){\n                            reset_chosen = 0;\n                        }\n                    }\n                    if(reset_chosen == 1){\n                        //then we just need to clear currently selected plane\n                        vm.new_booking.instructor = {};\n                        delete(vm.new_booking.instructor);\n                    }\n                    //otherwise we can leave that we've already done! :)\n                }\n                free_places();\n            });\n\n        }\n\n\n        // InstructorCharges.GetByClubId(vm.new_booking.plane.club_id)\n        //         .then(function(data){\n        //             vm.instructor_charges = data.items;  \n        //             ////console.log(\"====> \", data); \n        //         });\n\n         CourseService.GetCoursesByClubId(vm.new_booking.plane.club_id)\n                    .then(function(data){\n                        vm.courses = data.items;   \n                    });\n\n\n        //console.log(\"vm.new_booking.plane.club_id\", vm.new_booking.plane.club_id);\n        //console.log(\"vm.new_booking.plane.club_id\", vm.user.access.instructor);\n        //console.log(\"INDEX :: \", vm.user.access.instructor.indexOf(parseInt(vm.new_booking.plane.club_id)));\n        \n        // if(vm.user.access.instructor.indexOf(parseInt(vm.new_booking.plane.club_id)) > -1){\n        //     //console.log(\"THIS IS AN INSTRUCTOR IN THIS CLUB...\");\n        //     vm.booking_self = false;\n        // }\n\n\n\n\n\n        //if is_current getPlaneInstructors\n        BookingService.GetIfCurrent(vm.user_id, vm.new_booking.plane.id, vm.new_booking.end_datetime)\n        .then(function (data) {\n            ////console.log(data);\n            if(data.success){\n                //use GB airfields first...\n                vm.is_current = data.is_current;\n                //console.log(\"CURRENCY \", vm.is_current);\n\n                vm.currency_type = data.requirements.currency_type;\n                vm.currency_days = data.requirements.currency_days;\n            } else {\n            }\n        });\n        \n\n        \n\n    }\n\n\n    function free_places(){\n        // //console.log(\"UPDATE FREE PLACES...\", vm.new_booking.passengers.length);\n        // //console.log(\"UPDATE FREE PLACES...\", vm.new_booking.instructor);\n\n        vm.free_seats = [];\n\n        var seats = vm.new_booking.plane.seats - 1;\n\n        if(vm.new_booking.instructor){\n            if(vm.new_booking.instructor.id > 0){\n                // //console.log(\"the instructor was selected for this flight...\");\n                seats--;\n            }\n        }\n\n        if(vm.new_booking.passengers.length > 0){\n            for(var i=0;i<vm.new_booking.passengers.length;i++){\n                if(vm.new_booking.passengers[i] && vm.new_booking.passengers[i][\"email\"] !== \"\"){\n                    seats--;\n                }\n            }\n        }\n\n        for(var i=0; i<seats;i++){\n            vm.free_seats.push(i);\n        }\n\n        // //console.log(\"free seats now...\", vm.free_seats);\n\n        // $scope.$apply();\n\n    }\n\n\n    $scope.clear_booking = function(){\n        vm.new_booking = {\n            start_date: today,\n            end_date: today,\n            free_seats: [],\n            passengers: [],\n            instructor: undefined,\n            options: vm.dateTimeRangePickerOptions\n        };\n        $scope.submitted = false;\n    }\n\n    function calculate_duration(){\n        if(vm.new_booking.start_date && vm.new_booking.start_time){\n            var start_datetime = new Date(vm.new_booking.start_date);\n            var start_time = vm.new_booking.start_time.time.split(\":\");\n            start_datetime.setHours(start_time[0]);\n            start_datetime.setMinutes(start_time[1]);\n            start_datetime.setSeconds(0);\n            // //console.log(\"START DATETIME\", start_datetime);  \n\n            vm.end_times.forEach(function(time, i){ \n                //no need to go through each element if its not required to be shown!\n                if(time.disabled == 0){\n\n                    var end_datetime = new Date(vm.new_booking.end_date);\n                    var end_time = time.time.split(\":\");\n                    end_datetime.setHours(end_time[0]);\n                    end_datetime.setMinutes(end_time[1]);  \n                    end_datetime.setSeconds(0);\n                    // //console.log(\"END DATETIME\", end_datetime);  \n\n                    var difference = moment(moment(end_datetime).startOf(\"minute\")).diff(moment(start_datetime).startOf(\"minute\"));\n\n                    //now we need to calculate the difference in datetime\n                    // //console.log(\"d: \"+moment.duration(difference).days()+\" h: \"+moment.duration(difference).hours()+\" m: \"+moment.duration(difference).minutes());\n                    var human_str = get_duration_str(difference);\n                    // //console.log(\"human string\", human_str);\n                    if(human_str == \"\"){\n                        vm.end_times[i].disabled = 1;\n                    } else {\n                        vm.end_times[i].duration = \"( \"+human_str+\" )\";\n                    }\n\n\n                } else {\n                    vm.end_times[i].duration = \"\";\n                }\n              //if(time.time == moment(future).format(\"H:mm\")){ id = i; return true;}; \n            });\n        }\n    }\n\n    vm.seats_in_plane = function(){\n            free_places();\n\n            //base\n            var no_seats = vm.new_booking.plane.seats;\n\n            //check if instructor aboard?\n            if(vm.new_booking.instructor){   \n                no_seats--;\n            }\n\n            //include self\n            no_seats--;\n\n            // //console.log(\"seats left\", no_seats);\n\n\n            //return final number\n            return no_seats;\n        }\n\n        vm.adding_a_member = function(){\n            //console.log(\"ADDING ONE?\");\n            vm.init_passengers();\n        }\n\n        vm.init_passengers = function(){\n            var no_of_seats = vm.seats_in_plane();\n            // var already_filled = 0;\n            // for(var i=0;i<vm.new_booking.passengers.length;i++){\n            //         if(vm.new_booking.passengers[i] && vm.new_booking.passengers[i][\"email\"] !== \"\"){\n            //             already_filled++;\n            //         }          \n            // };\n            // var cc = no_of_seats - already_filled;\n            // // //console.log(\"CCCC seats -> \",no_of_seats);\n            // // //console.log(\"CCCC already_filled -> \",already_filled);\n            // // //console.log(\"CCCC -> \",cc);\n            // if(cc > 0){\n                vm.new_booking.passengers.push({\n                    first_name: \"\",\n                    last_name: \"\",\n                    email: \"\",\n                    status: \"\"\n                });\n            // }\n            \n        }\n\n        var setting_new_member;\n\n\n        var set_new_member = function(email, index){\n            // //console.log(\"SET MEMBER NOW 123\");\n            vm.new_booking.passengers[index] = {\n                                id: 0,\n                                email: email,\n                                first_name: \"\",\n                                last_name: \"\",\n                                is_member: false,\n                                status: \"to_invite\"\n                            };\n            // //console.log(\"HELLO\");\n            vm.init_passengers();\n            free_places();\n        }\n\n        vm.new_passenger_invite_ready = function(index){\n\n            //let's check the email address -->\n             // \n            var email_regex = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n\n            if(email_regex.test(vm.new_booking.passengers[index].email)){\n\n                // //console.log(\"SET MEMBER NOW 123\");\n                vm.new_booking.passengers[index].is_member = false;\n                vm.new_booking.passengers[index].status = \"to_invite\";\n\n                // //console.log(\"HELLO\");\n                vm.init_passengers();\n                free_places();\n                vm.show_new_passenger_invitation = false;\n            } else {\n                ToastService.warning('Invalid Email', 'The email address appears to be incorrect - please double check the email address entered.');\n                return false;\n            }\n        }\n\n\n        $scope.cancel_booking = function(booking_id){\n\n            //HOW DO WE CANCEL A BOOKING???\n            //at some point we need to define the booking cancellation reasons here (and make a nice popup style cancel)\n\n            var a = prompt(\"Are you sure you wish to cancel this booking? Please type YES in the box below to confirm.\");\n            if(a == \"YES\"){\n                //then we need to delete the booking... \n\n            BookingService.DeleteBooking(vm.user.id, booking_id)\n            .then(function(data){\n                //console.log(data);\n                ToastService.success('Booking Cancelled', 'The booking has been cancelled');\n\n                if(data.success){\n                    $state.go('dashboard.bookings.add');\n                    \n                     $scope.all_events = $.grep($scope.all_events, function(e){ \n                        return e.id != booking_id; \n                    });\n\n                    $('#calendar').fullCalendar('refetchEvents');\n                    $('#calendar').fullCalendar('removeEvents');\n                    $('#calendar').fullCalendar('addEventSource', $scope.all_events);\n\n                } else {\n                    ToastService.error('Error', 'An error occurred');\n                    //console.log(\"ERROR\", data);\n                }\n\n            });\n\n\n            } else {\n                $state.go('dashboard.bookings.add');\n            }\n\n        }\n\n       \n\n\n        function prepare_add_edit(club_id=null, after_booking_end=null){\n\n            var cid = (club_id) ? club_id : vm.club_id;\n            var bed = (after_booking_end) ? after_booking_end : vm.new_booking.end_datetime;\n\n            if(cid > 0 && bed){\n\n                 MemberService.GetAllActiveByClub(cid, bed)\n                    .then(function (data) {\n                        //console.log(\"members are : \", data);\n                        //console.log(\"CLUB ID IS :\", vm.club_id);\n\n                        if(vm.user.access.instructor.indexOf(vm.club_id) > -1){\n                            //console.log(\"THIS IS AN INSTRUCTOR IN THIS CLUB...\");\n                            vm.booking_self = false;\n                        }\n\n                        //use GB airfields first...\n                        vm.members = data;\n\n\n                        if(vm.new_booking.instructor && vm.new_booking.instructor.id == vm.user.id){\n                            vm.booking_self = false;\n                        }\n\n                        if(!vm.new_booking.user){\n                            // vm.booking_self = false;\n                            //set the member\n\n                            vm.new_booking.user = vm.members.find(function(member, index) {\n                                                                    if(member.user_id == vm.new_booking.user_id)\n                                                                        return true;\n                                                                });\n\n                        }\n\n\n\n                        for(var i=0;i<vm.members.length;i++){\n                            vm.members[i].is_member = true;\n                        }\n                        //console.log(vm.members);\n                    \n                    });\n\n            }\n\n           \n        }\n\n\n\n        vm.remove_invite = function(i){\n\n\n                vm.new_booking.passengers.splice(i, 1);\n                vm.init_passengers();\n\n\n        }\n\n\n        vm.remove_passenger = function(i){\n\n\n            var to_remove = vm.new_booking.passengers[i];\n            if( vm.pax_invited(to_remove) ){\n\n                //full removal from the backend\n                BookingService.DeleteInvitation(to_remove, to_remove.id)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success == true){\n                        //alert(data.message);\n                        vm.new_booking.passengers.splice(i, 1);\n                        vm.init_passengers();\n                    } else {\n                        ToastService.error('Error', data.message);\n                    }\n\n                });\n\n\n\n\n            } else {\n\n                //this pax was not YET saved - hence just remove from list\n\n                vm.new_booking.passengers.splice(i, 1);\n                vm.init_passengers();\n\n            }\n\n                //below YES --> but needs to remove the invitation as well.\n\n                // vm.new_booking.passengers.splice(i, 1);\n                // vm.init_passengers();\n\n        }\n\n        vm.resend_invitation = function(i){\n\n\n            var to_resend = vm.new_booking.passengers[i];\n             BookingService.ResendInvitation(to_resend, to_resend.id)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success == true){\n                        ToastService.success('Success', data.message);\n                    } else {\n                        ToastService.error('Error', data.message);\n                    }\n\n                });\n\n\n        }\n\n        vm.pax_invited = function(pax){\n            if(pax.status == \"\" || pax.status == \"to_invite\"){\n                return false;\n            }\n            return true;\n        }\n\n        vm.get_passenger_status = function(member){\n            // //console.log(\"MEMBER\", member);\n            if(member){\n\n                if(member.is_member){\n                    // //console.log(\"this one is true\");\n                    return \"This passenger is already club member and hence is ready for flight\";\n                } else {\n\n                    if(member.status == \"accepted\"){\n                        return \"This passenger has accepted the terms and is ready for flight\";\n                    } else if(member.status == \"declined\"){\n                        return \"This passenger has declined the terms\";\n                    } else if(member.status == \"to_invite\"){\n                        return \"Invitation will be sent once the booking is saved.\";\n                    } else if(member.status == \"invited\"){\n                        return \"This passenger has been invited but has not yet responded.\";\n                    } else {\n                        return \"\";\n                    }\n                }\n\n                return \"\";\n            }\n\n        }\n\n        vm.get_passenger_status_edit = function(member){\n            // //console.log(\"MEMBER\", member);\n            if(member){\n\n                if(member.is_member){\n                    // //console.log(\"this one is true\");\n                    return \"This passenger is already club member and hence is ready for flight\";\n                } else {\n\n                    if(member.status == \"accepted\"){\n                        return \"This passenger has accepted the terms and is ready for flight\";\n                    } else if(member.status == \"declined\"){\n                        return \"This passenger has declined the terms\";\n                    } else if(member.status == \"to_invite\"){\n                        return \"Invitation will be sent once the booking is saved.\";\n                    } else if(member.status == \"member\"){\n                        return \"This passenger is a member\";\n                    } else if(member.status == \"invited\"){\n                        return \"This passenger has been invited but has not yet accepted.\";\n                    }else {\n                        return \"\";\n                    }\n                }\n\n                return \"\";\n            }\n\n        }\n\n        vm.invite_new_passenger = function(index){\n\n            //console.log(\"HERE\");\n            //console.log(vm.new_booking.passengers[index]);\n\n            vm.show_new_passenger_invitation = true;\n            vm.new_pax = index;\n\n\n        }\n\n        vm.close_passenger_invitation = function(){\n            vm.new_pax = -1;\n            vm.show_new_passenger_invitation = false;\n        }\n\n        $scope.get_members = function(name, index){\n\n\n            ////console.log(\"get members\", name);\n            if((vm.club_id == 0 || !vm.club_id) && vm.new_booking.plane && vm.new_booking.plane.id){\n                vm.club_id = vm.new_booking.plane.club_id;\n            }\n\n            if(name.length > 2){\n\n                 MemberService.GetAllByClubAndName(vm.club_id, name)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //use GB airfields first...\n                        vm.members = data.members;\n\n                        if(vm.members.length < 1){\n                            ////console.log(\"not found in members\");\n                            vm.new_booking.passengers[index].not_found = true;\n                            vm.new_booking.passengers[index].email = \"\";\n                            vm.new_booking.passengers[index].status = \"\";\n                            vm.new_booking.passengers[index].first_name = \"\";\n                            vm.new_booking.passengers[index].last_name = \"\";\n\n                            \n                           // var email_regex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$/;\n\n                            var email_regex = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n                            if(email_regex.test(name)){\n\n                                vm.new_booking.passengers[index].email = name;\n\n                            } else {\n                                if(name.indexOf(\" \") > -1){\n                                    var splits = name.split(\" \");\n                                    vm.new_booking.passengers[index].first_name = splits[0];\n                                    vm.new_booking.passengers[index].last_name = splits[1];\n                                } else {\n                                    vm.new_booking.passengers[index].first_name = name;\n                                }\n                            }\n\n\n                        }\n\n                    } else {\n                        //clear original vals\n                            vm.new_booking.passengers[index].status = \"\";\n                            vm.new_booking.passengers[index].email = \"\";\n                            vm.new_booking.passengers[index].first_name = \"\";\n                            vm.new_booking.passengers[index].last_name = \"\";\n                        //if email add the email here\n\n                             var email_regex = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n                            \n                                       // var email_regex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$/;\n\n                            if(email_regex.test(name)){\n                                ////console.log(\"here we match?  it is an email?\");\n                                vm.new_booking.passengers[index].email = name;\n                                vm.new_booking.passengers[index].not_found = true;\n\n                            } else {\n                                ////console.log(\"user not found?\");\n                            }\n\n\n                        // var email_regex = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n                        // if(email_regex.test(name)){\n\n                        //         clearTimeout(setting_new_member);\n                        //         setting_new_member = undefined;\n\n                        //         setting_new_member = setTimeout(set_new_member, 900, name, index);\n\n                        // } else {\n                        //     //console.log(\"WOOOPSIES...\");\n                        //     //this should be very very rare...\n                        // }\n                        \n\n                   \n                    }\n\n                });\n\n\n            }\n        }\n\n        $scope.save = function(){\n            if(vm.action == \"add\"){\n                ////console.log(\"CREATE click\");\n                $scope.create();\n            } else {\n                ////console.log(\"EDIT click\");\n                ////console.log(vm.club.membership);\n                generate_datetimes();\n                $scope.update();\n            }\n        }\n\n        $scope.update = function() {\n            var d = new Date();\n            d.setHours( 14 );\n            d.setMinutes( 0 );\n            $scope.mytime = d;\n        };\n\n        vm.show_self_option = false;\n\n        $scope.select_plane = function(val){\n            $scope.check_rental_items();\n            free_places();\n\n            ////console.log(\"AIRCRAFT SELECTED\");\n            if( (vm.user.access.instructor.indexOf(vm.club_id) > -1) || (vm.user.access.manager.indexOf(vm.club_id) > -1) ){\n                vm.show_self_option = true;\n            } else {\n                vm.show_self_option = false;\n            }\n\n\n            if(vm.user.access.instructor.indexOf(vm.club_id) > -1){\n                //console.log(\"THIS IS AN INSTRUCTOR IN THIS CLUB...\");\n                vm.booking_self = false;\n            }\n\n            \n        }\n\n        function generate_datetimes(){\n            var start = new Date(vm.new_booking.start_date);\n            var c = new Date();\n            var start_split = (vm.new_booking.start_time) ? vm.new_booking.start_time.time.split(\":\") : [c.getHours(), c.getMinutes()];\n            // var start_split = vm.new_booking.start_time.time.split(\":\");\n\n            start.setHours(start_split[0]);\n            start.setMinutes(start_split[1]);\n            start.setSeconds(0);\n\n            var end = new Date(vm.new_booking.end_date);\n            //var end_split = vm.new_booking.end_time.time.split(\":\");\n            var end_split = (vm.new_booking.end_time) ? vm.new_booking.end_time.time.split(\":\") : [c.getHours(), c.getMinutes()];\n\n            end.setHours(end_split[0]);\n            end.setMinutes(end_split[1]);\n            end.setSeconds(0);\n\n            vm.new_booking.start_datetime = moment(start).format(\"Y-M-D HH:mm\");\n            vm.new_booking.end_datetime = moment(end).format(\"Y-M-D HH:mm\");\n        }\n\n        function get_times(data, tofrom){\n            var date = $scope.myDatetimeRange.date[tofrom];\n            var d = date.getDate();\n            var m = date.getMonth();\n            var y = date.getFullYear();\n            \n            //need to combuine both\n            var a = data[tofrom];\n            var h = a.slice(0,2);\n            var i = a.slice(3,5);\n            // i = (i == 00)? 0 : i;\n            i = (i.toString() == \"00\")? 0 : i;\n\n            // $scope.myDatetimeRange.date.from = new Date(y, m, d, h, m, 0);\n            // //console.log(\"vars are: \"+y+\", \"+m+\", \"+d+\", \"+h+\", \"+i+\", \"+0+\" soooo\");\n            var date = new Date(y, m, d, h, i, 0);\n            return date;\n        }\n\n        function check_business_hours(i, k = null, start = 0){\n            //i is hours\n            //k is minutes\n            k = parseInt(k);\n            i = parseInt(i);\n\n            var this_step_disabled = 0; \n            if(vm.new_booking.options.business_hours){\n                var split = vm.new_booking.options.business_hours.from.split(\":\");\n                var split2 = vm.new_booking.options.business_hours.to.split(\":\");\n\n                if(start == 0){\n                    //adjust to match times / end min 1 hour slots\n                   // split2[0] = parseInt(split2[0]) + 1;\n                } else {\n                    split2[0] = parseInt(split2[0]) - 1;\n                }\n\n                if(k || k == 0){\n                    \n                    if(i < parseInt(split[0]) ){\n                        // //console.log(\"we disable because \"+i+\":\"+k+\" is before \"+split.join(\":\") );\n                        this_step_disabled = 1;\n                    } else if(i == parseInt(split[0]) && k < parseInt(split[1])){\n                         // //console.log(\"we disable because \"+i+\":\"+k+\" is before \"+split.join(\":\") );\n                        this_step_disabled = 1;\n                    }\n\n                    // if(i >= parseInt(split2[0]) && k >= parseInt(split2[1]) ){\n                    //     // //console.log(\"we disable because \"+i+\":\"+k+\" is after \"+split2.join(\":\") );\n                    //     this_step_disabled = 1;\n                    // } \n\n\n                    if(i > parseInt(split2[0])){\n                        this_step_disabled = 1; \n                    } else if( i == parseInt(split2[0]) && k > parseInt(split2[1])){\n                        this_step_disabled = 1;\n                    }\n\n\n                } else {\n                    if(parseInt(split[0]) < i){\n                        this_step_disabled = 1;\n                    } \n                    if(parseInt(split2[0]) > i){\n                        this_step_disabled = 1;\n                    } \n                }\n            }\n\n            return this_step_disabled;\n        }\n\n\n   \n\n    function clean_times(which, start_end, compared_to = null){\n\n        var compare_date;\n\n        switch(which){\n            case 'today':\n                compare_date = new Date();\n            break;\n            case 'past':\n                //we need to consider the back-dating as possible issue...\n                compare_date = new Date(\"1990-07-26\");\n            break;\n            case 'future':\n                compare_date = new Date(\"1990-07-26\");\n            break;\n            case 'after':\n            //differentiate here\n                compare_date = new Date(compared_to);\n            break;\n            case 'before':\n            //differentiate here\n                compare_date = new Date(compared_to);\n            break;\n        }\n\n            var this_date = new Date(vm.new_booking.start_date);\n\n            //console.log(\"HERE WE GO this_date!\", this_date);\n            //console.log(\"HERE WE GO start_end!\", start_end);\n            //console.log(\"HERE WE GO vm[start_end]!\", vm[start_end]);\n\n            vm[start_end].forEach(function(time, i){\n\n                //this may very well be the case function here to change when the re-do the times            \n                var split_time = time.time.split(\":\");\n                this_date.setHours(split_time[0]);\n                this_date.setMinutes(split_time[1]);\n                this_date.setSeconds(0);\n\n\n                if( moment(this_date).isAfter(moment(compare_date)) ){\n                    //vm[start_end][i].disabled = 0;\n                    vm[start_end][i].disabled = check_business_hours(parseInt(split_time[0]), parseInt(split_time[1]), (start_end == \"start_times\")? 1 : 0);\n                } else {\n                    vm[start_end][i].disabled = 1;\n                }\n            });\n\n        //by definition as we are changing something to cause this function from being called - we need to recalculate the times:\n        calculate_duration();\n\n    }\n\n    function get_duration_str(seconds){\n        //var seconds = Math.floor(seconds);\n        // //console.log(seconds);\n        // //console.log(moment.duration(seconds));\n        // //console.log(\"days: \"+moment.duration(seconds).days());\n        // //console.log(\"hours: \"+moment.duration(seconds).hours());\n        // //console.log(\"minutes: \"+moment.duration(seconds).minutes());\n\n        var days = moment.duration(seconds).days();\n        var hours = moment.duration(seconds).hours();\n        var minutes = moment.duration(seconds).minutes();\n\n        //occasional issue showing 59 minutes - unsure where but this is a fix for it... think moment() has a bug\n        if(minutes == 59){\n            hours++;\n            minutes = 0;\n        }\n\n\n        var string = \"\";\n        if(days > 0){\n            string = string+\" \"+days+\" day\";\n            string = (days > 1)? string+\"s\" : string;\n        }\n        if(hours > 0){\n            string = string+\" \"+hours+\" hour\";\n            string = (hours > 1)? string+\"s\" : string;\n        }\n        if(minutes > 0){\n            string = string+\" \"+minutes+\" minute\";\n            string = (minutes > 1)? string+\"s\" : string;\n        }\n\n         // //console.log(\"STR : \"+string);\n\n        return string;\n\n    }\n\n    function add_hour_to_end(){\n        var a = vm.new_booking.start_time.time.split(\":\");\n        //var b = new Date();\n        var b = new Date(vm.new_booking.start_date);\n        b.setHours(a[0]);\n        b.setMinutes(a[1]);\n        b.setSeconds(0);\n        var future = moment(b).add(1, \"hour\").format();\n       // clean_times('after', 'end_times', future);\n       //\n\n         //clean_times(check_relative_date(vm.new_booking.end_date, \"end\"), 'end_times', future);\n\n\n\n        if(parseInt(a[0]) >= 23){\n            if(moment(vm.new_booking.start_date).isSame(moment(vm.new_booking.end_date))){\n                 // //console.log(\"THIS ADD DAY\");\n                // //console.log(\"start\", vm.new_booking.start_date);\n                // //console.log(\"end\", vm.new_booking.end_date);\n                 // //console.log(\"after or = 11pm - then we need to change the date that follows the same pattern\");\n                vm.new_booking.end_date = new Date(moment(vm.new_booking.end_date).add(1, \"day\").format());\n                clean_times('future', 'end_times');\n\n                //set it to 00:00 hours probably a wise thing...\n                vm.new_booking.end_time = vm.end_times[0];\n\n\n            } \n        } else {\n            clean_times('after', 'end_times', b);\n        }\n\n    }\n\n\n    function start_after_end(){\n            var start_after_end = false;\n            if(vm.new_booking.end_time){\n                // //console.log(\"START AFTER END LOOP\");\n                var start_datetime = new Date(vm.new_booking.start_date);\n                var start_time = vm.new_booking.start_time.time.split(\":\");\n                start_datetime.setHours(start_time[0]);\n                start_datetime.setMinutes(start_time[1]);\n                start_datetime.setSeconds(0);\n\n                var end_datetime = new Date(vm.new_booking.end_date);\n                var end_time = vm.new_booking.end_time.time.split(\":\");\n                end_datetime.setHours(end_time[0]);\n                end_datetime.setMinutes(end_time[1]);\n                end_datetime.setSeconds(0);\n\n                if(moment(start_datetime).isAfter(moment(end_datetime)) || moment(start_datetime).isSame(end_datetime) || end_datetime == start_datetime){\n                    start_after_end = true;\n                }\n\n\n            }\n            return start_after_end;\n    }\n\n\n    function booking_today(){\n        if(moment(vm.new_booking.start_date).format(\"DD/MM/YYYY\") == moment().format(\"DD/MM/YYYY\")){\n            //console.log(\"WE ARE TODAY?\");\n            clean_times('today', 'start_times');\n\n        } else {\n            // //console.log(\"should get full day\");\n            if(moment(vm.new_booking.start_date).isAfter(moment()) ){\n                clean_times('future', 'start_times');\n            }\n        }\n\n        if(moment(vm.new_booking.end_date).format(\"DD/MM/YYYY\") == moment().format(\"DD/MM/YYYY\")){\n            if(vm.new_booking.start_time){\n               //console.log(\"START TIME\", vm.new_booking.start_time);\n                add_hour_to_end(); \n            }\n            clean_times(check_relative_date(vm.new_booking.start_date), 'end_times');\n        }\n\n\n        if(vm.new_booking.end_date == vm.new_booking.start_date){\n                // //console.log(\"booking today where end = start\");\n                if(vm.new_booking.start_time){\n                    var a = vm.new_booking.start_time.time.split(\":\");\n                    var b = new Date(vm.new_booking.start_date);\n                    b.setHours(a[0]);\n                    b.setMinutes(a[1]);\n                    b.setSeconds(0);\n\n                    //we need to check the times give\n                    if(start_after_end()){\n                        clean_times(check_relative_date(vm.new_booking.start_date), 'start_times');\n                        // //console.log(\"UPDATE END BITS IF START > END required?\");\n                        clean_times(check_relative_date(vm.new_booking.end_date, \"end\"), 'end_times', b);\n                        add_hour_to_end();\n                    } else {\n                        // //console.log(\"UPDATE END BITS IF START > END 2\", check_relative_date(vm.new_booking.start_date, \"end\"));\n                        clean_times(check_relative_date(vm.new_booking.end_date, \"end\"), 'end_times', b);\n                    }\n\n\n                }\n        }\n\n    }\n\n    // clean_times('today', 'start_times');\n    booking_today();\n\n\n    function check_relative_date(date, start_end = \"start\"){\n        var relative = \"today\";\n        // //console.log(\"RELATIVE TIME CHECK\", date);\n        if(moment(moment(date).format(\"YYYY/MM/DD\")).isAfter(moment().format(\"YYYY/MM/DD\"))){\n            relative = \"future\";\n\n            //then is after today\n            // the catch is that if date == start / end date --> THEN we need to present that it is today even though it isnt - this is premise\n            // that is valid only for the \"END\" cases (so that we return AFTER rather than today) --> otherwise the end_times available won't reflect\n            //the fact that the start_times have been selected allowing the user to select an end time before start time (which is silly really...)\n\n            if(vm.new_booking.start_date && vm.new_booking.end_date && start_end == \"end\"){\n                if(moment(vm.new_booking.start_date).isSame(moment(vm.new_booking.end_date))){\n                    relative = \"after\"; // because we need to act as though it is after in the clean_times (to not be able to select end < start times)\n                }\n            }\n            \n        } else if(moment(date).format(\"YYYY/MM/DD\") == moment().format(\"YYYY/MM/DD\")){\n            //then today\n            relative = (start_end == \"start\") ? \"today\" : \"after\";\n        } else {\n            //must be in the past...\n            relative = \"past\";\n        }\n\n        \n        // //console.log(\"relative is \", relative);\n        return relative;\n    }\n\n\n      if($stateParams.start){\n                    //alert(\"add\");\n                    vm.new_booking.start_date = new Date($stateParams.start);\n                    vm.new_booking.end_date = new Date($stateParams.start);\n                    vm.new_booking.start_time = {time: moment($stateParams.start).format(\"HH:mm\")};\n                    vm.new_booking.end_time = {time: moment($stateParams.start).add(30, \"minutes\").format(\"HH:mm\") };\n\n                    vm.default_date = vm.new_booking.start_date;\n\n\n\n                    setTimeout(function(){\n\n\n                        //console.log(\"CALL ME HERE BOOBS\");\n\n\n                        var new_event = {\n                                         \"id\":\"TEMP\",\n                                         \"title\":\"TEMPORARY\",\n                                         \"resourceId\": 7,\n                                         \"start\":\"2021-03-21 19:30:00\",\n                                         \"end\":\"2021-03-21 21:00:00\",\n                                         \"editable\":false,\n                                         \"color\":\"#FFcccc\",\n                                         \"opacity\":\"1\"\n                                      };\n                    \n\n                                      $('#calendar').fullCalendar('renderEvent', new_event);\n\n\n                    $scope.update_dateTime(\"edit2\", $stateParams.plane_id);\n\n\n\n                    }, 1000);\n\n                    \n\n\n      \n\n                }\n\n\n\n\n    $scope.make_booking = function(isValid){\n\n        //console.log(\"make booking\", isValid);\n            $scope.submitted = true;\n            // check to make sure the form is completely valid\n            if(isValid) {\n                // //console.log('our form is working');\n                //then we send the booking request to the server woooohooooo!\n\n                //clean and prepare the bits that we require\n                var booking = {};\n                var booking = jQuery.extend(true, {}, vm.new_booking); \n                // //console.log(booking);\n                delete booking.options;\n                delete booking.instructor;\n                delete booking.plane;\n                delete booking.start_date;\n                delete booking.start_time;\n                delete booking.end_date;\n                delete booking.end_time;\n                delete booking.start_datetime;\n                delete booking.end_datetime;\n                delete booking.tuition_required;\n                delete booking.user;\n                // //console.log(booking);\n                // //console.log(vm.new_booking);\n\n                //generate_datetimes();\n\n                // //console.log(\"START DATE1 : \", vm.new_booking.start_datetime );\n\n                // //console.log(\"START DATE2 : \", moment(vm.new_booking.start_datetime).isAfter() );\n                // //console.log(\"START DATE3 : \", moment(vm.new_booking.start_datetime).isBefore() );\n\n                // //console.log(\"START DATE4 : \", moment(Date.parse(vm.new_booking.start_datetime)) );\n                // //console.log(\"END DATE : \", moment(vm.new_booking.end_datetime) );\n                // //console.log(\"NOW : \", moment());\n\n                if(moment(Date.parse(vm.new_booking.start_datetime)).isBefore()){\n                    ToastService.warning('Past Booking', 'This booking ends in the past - you cannot create a booking in the past.');\n                    return false;\n                }\n                //30 mintues leeway in case of booking starting within the 15 minute period or similar\n                if(moment(Date.parse(vm.new_booking.start_datetime)).add(30, \"minutes\").isBefore()){\n                    ToastService.warning('Past Booking', 'This booking starts in the past - you cannot create a booking in the past.');\n                    return false;\n                }\n\n\n\n\n\n                booking.override = (vm.new_booking.override) ? vm.new_booking.override : 0;\n\n                if(vm.booking_self){\n                    // //console.log(\"SELF\");\n                    booking.user_id = vm.user.id;\n                    booking.instructor_id = (vm.new_booking.instructor) ? vm.new_booking.instructor.id : 0;\n                    // //console.log(\"USER IS \", booking.user_id);\n                } else {\n                    // //console.log(\"NON SELF\");\n\n                    booking.user_id = vm.new_booking.user.user_id;\n                    if(vm.user.access.manager.indexOf(vm.club_id) > -1){\n                        //admin does not automatically become the instructor...\n                        booking.instructor_id = (vm.new_booking.instructor) ? vm.new_booking.instructor.id : 0;                \n                    } else {\n                        //then its an instructor - so likely booking for student not just member\n                        booking.instructor_id = vm.user.id;                \n                    }\n                    booking.booked_by_admin_instructor = 1;\n                    booking.override = 1;\n\n                }\n               \n\n\n\n\n                booking.free_seats = (vm.new_booking.free_seats.constructor === Array) ? 0 : vm.new_booking.free_seats;\n                booking.start = vm.new_booking.start_datetime;\n                booking.end = vm.new_booking.end_datetime;               \n                booking.plane_id = vm.new_booking.plane.id;\n                booking.club_id = vm.new_booking.plane.club_id;\n                booking.booked_by = vm.user.id;\n                booking.course_id = (vm.new_booking.tuition_required) ? vm.new_booking.tuition_required.id : 0;\n\n                // //console.log(\"UUID \",booking.user_id);\n\n                // return false;\n\n                // //console.log(\"new booking obj to be sent... \",booking);\n\n                //make booking call with new_booking as items to send! :D wooohoooooooo :P\n                BookingService.Create(vm.user.id, booking)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success == true){\n                        // //console.log(\"WAS SENT HERE! \");\n                        $scope.clear_booking();\n                        \n\n                        BookingService.GetAll(vm.user.id, moment(vm.new_booking.start_date).format(\"Y-M-D\"), \"\")\n                            .then(function(data){\n\n                                $scope.all_events = data.events;\n                                $scope.all_resources = data.resources;\n\n                                $('#calendar').fullCalendar('refetchEvents');\n                                $('#calendar').fullCalendar('removeEvents');\n                                $('#calendar').fullCalendar('addEventSource', $scope.all_events);\n                            });\n\n                        \n\n                        //$(\"#calendar\").fullCalendar(\"refetchEvents\");\n                        //must have some sort of feedback saying booking was made successfully!\n                        $state.go('dashboard.bookings.add');\n                    } else {\n\n                        // //console.log(\"clearly something went wrong here... :'-( \", data.message);\n                        //if it is something about currency - perhaps return the possibility of self-certify or book instructor for this purpose!\n                        \n                        if(data.more && data.more.length > 0){\n                            // //console.log(\"MORE\");\n                            var addon = \"\";\n\n                            for(var i=0;i<data.more.length;i++){\n                                if(data.more[i][\"name\"] == \"differences_verified\"){\n                                    addon += \"\\n - Your differences training sign-offs need to be verified by a member of staff. \\n\";\n                                }\n                                if(data.more[i][\"name\"] == \"licence_verified\"){\n                                    addon += \"\\n - Your licence needs to be verified by a member of staff. \\n\";\n                                }\n                                if(data.more[i][\"name\"] == \"medical_verified\"){\n                                    addon += \"\\n - Your medical needs to be verified by a member of staff. \\n\";\n                                }\n                                if(data.more[i][\"name\"] == \"medical\"){\n                                    addon += \"\\n - You need to upload a copy of your medical. \\n\";\n                                }\n                                if(data.more[i][\"name\"] == \"licence\"){\n                                    addon += \"\\n - You need to upload a copy of your licence. \\n\";\n                                }\n                                if(data.more[i][\"name\"] == \"differences\"){\n                                    addon += \"\\n - You need to upload a copy of your differences training signed off. \\n\";\n                                }\n                                // addon += \"You need to add your \"+data.more[i][0]+\" to book solo\";\n                            }\n                            // //console.log(\"MORE:: \", addon);\n\n                            data.message = data.message + addon;\n                        }\n\n                        ToastService.error('Error', data.message);\n                    }\n                    \n                });\n\n\n            } else {\n                //console.log(\"NOT SENT - please fix errors\");\n            }\n\n    }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        \n        \n\n      \n\n\n\n\n\n\n\n\n\n\n\n\n        // MODALS FOR ALL THE POPUPS TO BE CHANGED INTO --> SAMPLE HERE\n\n        // var warning_msg = \"By deleting this membership, you will also cancel all reservations that this membership currently has.\"\n\n        $scope.popup2 = {\n          opened: false\n        };\n\n        $scope.popup3 = {\n          opened: false\n        };\n\n        $scope.popup4 = {\n          opened: false\n        };\n          \n        $scope.open2 = function() {\n          $scope.popup2.opened = true;\n        };\n\n          $scope.open3 = function() {\n          $scope.popup3.opened = true;\n        };\n\n          $scope.open4 = function() {\n          $scope.popup4.opened = true;\n        };\n\n\n        $scope.open = function (member_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return member_id;\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (member_id) {\n              $log.info('PRESSED GO: '+member_id);\n              MemberService.Delete(member_id)\n              .then(function(){\n                //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.members = $.grep(vm.club.members, function(e){ \n                    return e.id != member_id; \n                });\n              })\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n          };\n\n         \n\n\n    }\n\n app.controller('BookoutController', BookoutController);\n\n    BookoutController.$inject = ['UserService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$interval', '$timeout', 'uiCalendarConfig', 'BookingService', 'LicenceService', 'BookoutService', '$filter', 'InstructorCharges', 'PlaneService', '$http', '$cookieStore', 'AuthenticationService', 'CourseService', 'ToastService'];\n    function BookoutController(UserService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $interval, $timeout, uiCalendarConfig, BookingService, LicenceService, BookoutService, $filter, InstructorCharges, PlaneService, $http, $cookieStore, AuthenticationService, CourseService, ToastService) {\n        \n        var vm = this;\n\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n        //this club ID needs to reflect the club that has been selected....\n        //vm.club_id = 6;\n        // SAY WHAAAAAT?\n\n        //   {{ $rootScope.globals | json }} to be able to see what club was selected\n\n     //vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n\n        // vm.user = $rootScope.globals.currentUser;\n        // vm.user_id = vm.user.id;\n\n        vm.booking = {};\n\n        //base location to sort the airfields below\n        vm.wgs_n = \"51.51\";\n        vm.wgs_e = \"0.12\";\n\n        vm.change_booking = {};\n        vm.show_change_plane = false;\n        //we need to get the booking ID to pull as much data as we can!\n\n        vm.bookout = {\n            start: true,\n            passengers: [],\n            pic: {\n                id: vm.user_id\n            }\n        };\n\n        vm.reported_defects = [];\n      \n        vm.can_authorise = false;\n\n        vm.bookout.plane = {\n            id: 12,\n            registration: \"G-BSXA\",\n            type: \"PA28\",\n            current_tacho: 5112.3,\n            estimated_fuel: 100,\n            consumption: 30,\n            seats: 4,\n            last_tacho: 3941.01,\n            last_position: 12\n        };\n\n\n        \n\n        //vm.custom_users = [];\n\n        vm.dateFormat = 'date:HH:mm \\'on\\' dd/MM/yyyy';\n\n        $scope.show_change_plane = function(){\n            // //console.log(\"change plane\");\n            vm.show_change_plane = true;\n\n        }\n\n        // //console.log(\"PARASM\", $stateParams);\n\n        vm.seats_in_plane = function(){\n\n            //base\n            var no_seats = vm.bookout.plane.seats;\n\n            //check if instructor aboard?\n            if(vm.bookout.pic.id !== vm.user_id){   \n                no_seats--;\n            }\n\n            if(vm.bookout.passengers.length > 0){\n                no_seats = no_seats - vm.bookout.passengers.length;\n            }\n\n            //include self\n            no_seats--;\n\n            // //console.log(no_seats);\n\n            //return final number\n            return no_seats;\n        }\n\n        vm.init_passengers = function(){\n            // var no_of_seats = vm.seats_in_plane();\n\n            // //console.log(\"no_of_seats\", no_of_seats);\n\n            // for(var i=0;i<no_of_seats;i++){\n            //     //console.log(\"-- loop\", i);\n            //     vm.bookout.passengers.push({\n            //         first_name: \"\",\n            //         last_name: \"\",\n            //         email: \"\",\n            //         user_id: i,\n            //         status: \"\"\n            //     });\n            // };\n        }\n        \n\n        $scope.amend_booking = function(){\n            // //console.log(\"AMEND BOOKING NOW\");\n\n        }\n\n\n\n        // BookoutService.GetAirfields(\"EG\")\n        //         .then(function (data) {\n        //             //console.log(data);\n        //             if(data.success){\n        //                 //use GB airfields first...\n        //                 vm.airfields = data.airfields;\n\n        //             } else {\n        //                 //console.log(\"WOOOPSIES...\");\n        //                 //this should be very very rare...\n        //             }\n\n        //         });\n\n\n\n        $scope.accept_defects = function(){\n\n\n            var a = confirm(\"You accept to fly the aircraft despite known defect(s) which have been reported by previous pilots\");\n            if(a){\n                vm.bookout.accept_defects = true;\n            } else {\n                //do nothing\n            }\n\n\n\n        }\n\n        $scope.reject_defects = function(){\n\n            var a = confirm(\"Would you like to cancel this booking?\");\n            if(a){\n                \n            } else {\n                //do nothing\n                vm.bookout.accept_defects = false;\n            }\n        }\n\n\n        $scope.get_hours_from_decimal = function(number){\n\n            // if(time){\n            //      var sign = time < 0 ? \"-\" : \"\";\n            //      var hour = Math.floor(Math.abs(time));\n            //      var min = Math.round((Math.abs(time) * 60) % 60);\n            //      return sign + (hour < 10 ? \"0\" : \"\") + hour + \":\" + (min < 10 ? \"0\" : \"\") + min;\n            //  } else {\n            //      return \"N/A\";\n            //  }\n            var sign = (number >= 0) ? 1 : -1;\n\n            // Set positive value of number of sign negative\n            number = number * sign;\n\n            // Separate the int from the decimal part\n            var hour = Math.floor(number);\n            var decpart = number - hour;\n\n            var min = 1 / 60;\n            // Round to nearest minute\n            decpart = min * Math.round(decpart / min);\n\n            var minute = Math.floor(decpart * 60) + '';\n\n            // Add padding if need\n            if (minute.length < 2) {\n            minute = '0' + minute; \n            }\n\n            // Add Sign in final result\n            sign = sign == 1 ? '' : '-';\n\n            if(minute == 60){\n                hour = hour+1;\n                minute = '00';\n            }\n\n            // Concate hours and minutes\n            var time = sign + hour + ':' + minute;\n\n            return time;\n            \n        }\n\n\n\n\n        $scope.get_airfields = function(name){\n\n            if(name.length > 2 && name.length < 5){\n\n                 BookoutService.GetAirfieldsByCode(name)\n                .then(function (data) {\n                    // //console.log(data);\n                    if(data.success){\n                        //use GB airfields first...\n                        vm.airfields = data.airfields;\n                       \n                         if(vm.airfields.length == 0){\n                            // //console.log(\"SETTINGS HERE\");\n                               vm.airfields = [\n                                    {\n                                        id:0,\n                                        title: \"NOT LISTED : \"+ name,\n                                        code: \"ZZZZ\",\n                                        wgs_n: \"0\",\n                                        wgs_e: \"0\"\n                                    }];\n                        }\n\n                    } else {\n\n\n                         //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n            }\n\n            if(name.length > 4){\n                var code = name.replace(/\\s/g, \"_\");\n                BookoutService.GetAirfields(code)\n                .then(function (data) {\n                    // //console.log(data);\n                    if(data.success){\n                        //use GB airfields first...\n                        vm.airfields = data.airfields;\n\n\n                        if(vm.airfields.length == 0){\n                            // //console.log(\"SETTINGS HERE\");\n                               vm.airfields = [\n                                    {\n                                        id:0,\n                                        title: \"NOT LISTED : \"+ name,\n                                        code: \"ZZZZ\",\n                                        wgs_n: \"0\",\n                                        wgs_e: \"0\"\n                                    }];\n                        }\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n            }\n\n\n             \n\n           \n        }\n\n        var setting_new_member;\n\n\n        var set_new_member = function(email, index){\n            // //console.log(\"before change \", vm.bookout.passengers);\n            // //console.log(\"SET MEMBER NOW 123\", vm.bookout.passengers[index]);\n                \n             var user_obj = {\n                                id: 0,\n                                email: email,\n                                first_name: \"\",\n                                last_name: \"\",\n                                is_member: false,\n                                status: \"to_invite\"\n                            };\n\n            if(vm.bookout.passengers[index].email !== \"\"){\n                // //console.log(\"override it? and tell the server about it?\", vm.bookout.passengers[index]);\n\n                UserService.ChangeInvitation({from: vm.bookout.passengers[index], to: user_obj}, vm.bookout.booking_id)\n                .then(function (data) {\n                    if(data.success){\n                        // //console.log(\"OK\");\n\n                    }\n                });\n            \n            }\n           \n\n            // vm.custom_users.push(user_obj);\n            // vm.members = vm.members.concat(vm.custom_users);\n            // //console.log(\"CUSTOMER USERS\", vm.custom_users);\n            vm.bookout.passengers[index] = user_obj;\n        }\n\n\n        $scope.update_pic = function(){\n            // //console.log(\"--> \", vm.user.id);\n            // //console.log(\"--> \", vm.bookout.instructor_id);\n            // //console.log(\"--> \", vm.bookout.pic.user_id);\n\n            if(vm.bookout.pic.user_id == vm.user.id && vm.bookout.instructor_id > 0){\n                //console.log(\"okay... so you want the instructor to be put? interesting...\");\n                //adheres to booking\n\n            } else if(vm.bookout.instructor_id > 0 && vm.bookout.pic.user_id == vm.bookout.instructor_id) {\n                //console.log(\"okay so you now have your booked instructor as the PIC again - nice\");\n                //adheres to booking\n\n            } else {\n                //console.log(\"you've change instructor? what happened?\");\n                //availability has been checked hence we're OK\n\n            }\n        }\n\n\n        // $scope.get_members = function(name, index){\n\n        //     if(name.length > 2){\n\n        //          MemberService.GetAllByClubAndName(vm.club_id, name)\n        //         .then(function (data) {\n        //             //console.log(data);\n        //             if(data.success){\n        //                 //use GB airfields first...\n        //                 // var m = data.members;\n        //                 // var members = m.concat(vm.custom_users);\n        //                 vm.members = data.members;\n\n        //             } else {\n\n\n\n        //                 var email_regex = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n        //                 if(email_regex.test(name)){\n        //                     //console.log(\"valid email address found\");\n        //                     //if entered bit is an email address\n        //                     // vm.members = [\n        //                     // {\n        //                     //     id: 0,\n        //                     //     email: name,\n        //                     //     first_name: \"\",\n        //                     //     last_name: \"\",\n        //                     //     is_member: false\n        //                     // }];\n        //                         //console.log(\"BEFORE\", setting_new_member);\n        //                         clearTimeout(setting_new_member);\n        //                         setting_new_member = undefined;\n        //                         //console.log(\"AFTER\", setting_new_member);\n\n        //                         setting_new_member = setTimeout(set_new_member, 1000, name, index);\n        //                         //console.log(\"again after\", setting_new_member);\n                            \n\n\n        //                 } else {\n        //                 //console.log(\"WOOOPSIES...\");\n        //                 //this should be very very rare...\n        //                 }\n                        \n\n                   \n        //             }\n\n        //         });\n\n\n        //     }\n        // }\n\n\n\n\n\n         vm.invite_new_passenger = function(index){\n\n            // //console.log(\"HERE\");\n            // //console.log(vm.new_pax);\n\n             if(vm.new_pax && vm.new_pax.email !== \"\" && vm.new_pax.is_member == false){\n\n\n                 //send a single invitation to join the gang....\n                 vm.new_pax.invited_by = vm.user.id;\n\n\n                 BookoutService.AddPassenger(vm.new_pax, $stateParams.booking_id)\n                .then(function (data) {\n                    // //console.log(data);\n                    if(data.success){\n                       ToastService.success('Invitation Sent', 'The invitation has been sent successfully');\n                        vm.update_passenger_list();\n                        vm.show_new_passenger_invitation = false;\n                    }\n                });\n\n\n\n\n\n\n             } else {\n                 ToastService.warning('Invalid Email', 'Please enter a valid email address to send the invitation to.');\n             }\n           \n\n\n        }\n\n\n\n\n\n        vm.add_new_passenger = function(index){\n\n            // //console.log(\"HERE\");\n            // //console.log(vm.new_pax);\n\n            if(vm.new_pax.is_member){\n\n\n                //then we already have everything we need and we just invite them separately\n                // var to_send = {\n                //     booking_id: $stateParams.booking_id,\n                //     club_id: vm.club_id\n                // }\n                vm.new_pax.club_id = vm.club_id;\n                vm.new_pax.invited_by = vm.user.id;\n\n                //add passenger to booking\n                BookoutService.AddPassenger(vm.new_pax, $stateParams.booking_id)\n                .then(function (data) {\n                    // //console.log(data);\n                    if(data.success){\n                       \n\n\n                        //let's call the update on the passengers\n                        vm.update_passenger_list();\n\n\n\n\n                    }\n                });\n\n\n\n\n            } else {\n                vm.show_new_passenger_invitation = true;\n            }\n\n           \n\n\n        }\n\n\n        vm.new_pax = {\n                        id: 0,\n                        email: \"\",\n                        first_name: \"\",\n                        last_name: \"\",\n                        is_member: false,\n                        status: \"\",\n                        not_found: true\n                    };\n\n        vm.close_passenger_invitation = function(){\n            vm.show_new_passenger_invitation = false;\n        }\n\n        $scope.get_members = function(name){\n\n            // //console.log(\"GET MEMBER\", name);\n            ////console.log(\"get members\", name);\n            if((vm.club_id == 0 || !vm.club_id) && vm.bookout.plane && vm.bookout.plane.id){\n                vm.club_id = vm.bookout.plane.club_id;\n            }\n\n            if(name.length > 2){\n\n                 MemberService.GetAllByClubAndName(vm.club_id, name)\n                .then(function (data) {\n                    ////console.log(data);\n                    if(data.success){\n                        //use GB airfields first...\n\n                        //filter the ones that are already there....\n                        // myArray.filter( el => !toRemove.includes( el ) );\n                        // var myArray = data.members.filter( el => !vm.bookout.passengers.includes( el ) ); //filter( ( el ) => !vm.bookout.passengers.includes( el ) );\n\n\n                        var filtered_array = data.members.filter(ar => !vm.bookout.passengers.find(rm => (rm.email === ar.email) ));\n                        //vm.members = data.members;\n                        vm.members = filtered_array;\n                        ////console.log(\"CHECK JANES\", myArray);\n\n\n                        if(vm.members.length < 1){\n                            // //console.log(\"not found in members\");\n                            // vm.new_pax.not_found = true;\n                            // vm.new_pax.email = \"\";\n                            // vm.new_pax.status = \"\";\n                            // vm.new_pax.first_name = \"\";\n                            // vm.new_pax.last_name = \"\";\n\n                            vm.new_pax = {\n                                id: 0,\n                                email: \"\",\n                                first_name: \"\",\n                                last_name: \"\",\n                                is_member: false,\n                                status: \"\",\n                                not_found: true\n                            };\n\n                            \n                           // var email_regex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$/;\n\n                            var email_regex = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n                            if(email_regex.test(name)){\n\n                                vm.new_pax.email = name;\n\n                            } else {\n                                if(name.indexOf(\" \") > -1){\n                                    var splits = name.split(\" \");\n                                    vm.new_pax.first_name = splits[0];\n                                    vm.new_pax.last_name = splits[1];\n                                } else {\n                                    vm.new_pax.first_name = name;\n                                }\n                            }\n\n\n                        }\n\n                    } else {\n                        //clear original vals\n                            vm.new_pax.status = \"\";\n                            vm.new_pax.email = \"\";\n                            vm.new_pax.first_name = \"\";\n                            vm.new_pax.last_name = \"\";\n                        //if email add the email here\n\n                             var email_regex = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n                            \n                                       // var email_regex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$/;\n\n                            if(email_regex.test(name)){\n                                ////console.log(\"here we match?  it is an email?\");\n                                vm.new_pax.email = name;\n                                vm.new_pax.not_found = true;\n\n                            } else {\n                                ////console.log(\"user not found?\");\n                            }\n\n\n                        // var email_regex = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n                        // if(email_regex.test(name)){\n\n                        //         clearTimeout(setting_new_member);\n                        //         setting_new_member = undefined;\n\n                        //         setting_new_member = setTimeout(set_new_member, 900, name, index);\n\n                        // } else {\n                        //     //console.log(\"WOOOPSIES...\");\n                        //     //this should be very very rare...\n                        // }\n                        \n\n                   \n                    }\n\n                });\n\n\n            }\n        }\n\n        var get_all_members = function(){\n\n\n                 MemberService.GetAllByClub(vm.club_id)\n                .then(function (data) {\n                    ////console.log(data);\n                        //use GB airfields first...\n                        vm.members = data;\n                        for(var i=0;i<vm.members.length;i++){\n                            vm.members[i].is_member = true;\n                        }\n                        // //console.log(vm.members);\n                \n                });\n\n            \n        }\n\n        get_all_members();\n\n\n        vm.invite_passenger = function(email, i){\n            ////console.log(\"SEND INVITE\", vm.bookout.passengers[i]);\n\n            var passenger_membership_id = 9;\n\n            UserService.InvitePassenger(vm.bookout.passengers[i].email, vm.user_id, vm.club_id, passenger_membership_id, vm.bookout.booking_id)\n                .then(function (data) {\n                        //use GB airfields first...\n                        ////console.log(\"INVITE IS \", data);\n                        vm.bookout.passengers[i].status = data.invite.status;\n                        vm.bookout.passengers[i].invitation_token = data.invite.invitation_token;\n                \n                });\n\n\n        }\n\n        vm.refresh_passenger = function(member, i){\n            ////console.log(\"SEND REFRESH\");\n            UserService.GetInvite(vm.bookout.passengers[i].invitation_token)\n                .then(function (data) {\n                        //use GB airfields first...\n                        // //console.log(\"INVITED IS \", data);\n                        vm.bookout.passengers[i].status = data.status;\n                        vm.bookout.passengers[i].user_id = data.user_id;\n                        vm.bookout.passengers[i].first_name = data.first_name;\n                        vm.bookout.passengers[i].last_name = data.last_name;\n                });\n            //vm.bookout.passengers[i].status = \"accepted\";\n        }\n\n        vm.update_passenger_list = function(){\n\n            //let's get ALL the ones required\n             BookoutService.GetPassengers($stateParams.booking_id)\n                .then(function (data) {\n                    ////console.log(data);\n                    if(data.success){\n                       //alert(\"GET\");\n                       ////console.log(\"PAX\", data.passengers);\n                       vm.bookout.passengers = data.passengers;\n\n                       vm.new_pax = {\n                            id: 0,\n                            email: \"\",\n                            first_name: \"\",\n                            last_name: \"\",\n                            is_member: false,\n                            status: \"\",\n                            not_found: true\n                        };\n\n                    }\n                });\n\n        }\n\n        vm.resend_invitation = function(obj){\n\n            var to_resend = obj;\n             BookingService.ResendInvitation(to_resend, to_resend.id)\n                .then(function(data){\n                    // //console.log(data);\n                    if(data.success == true){\n                        ToastService.success('Success', data.message);\n                    } else {\n                        ToastService.error('Error', data.message);\n                    }\n\n                });\n        }\n\n\n        vm.refresh_all_passenger = function(){\n            var i = 0;\n             function next() {\n                i++;\n                if(i < vm.bookout.passengers.length) {\n                    // //console.log(\"SEND REFRESH EVERYTHING\");\n                    if(vm.bookout.passengers[i] && vm.bookout.passengers[i].status == \"invited\" && vm.bookout.passengers[i].invitation_token !== \"\"){\n\n                         UserService.GetInvite(vm.bookout.passengers[i].invitation_token)\n                            .then(function (data) {\n                                    // //console.log(\"INVITED IS \", data);\n                                    // //console.log(\"INVITED IS \", vm.bookout.passengers[i]);\n                                    vm.bookout.passengers[i].status = data.status;\n                                    vm.bookout.passengers[i].user_id = data.user_id;\n                                    vm.bookout.passengers[i].first_name = data.first_name;\n                                    vm.bookout.passengers[i].last_name = data.last_name;\n                            });\n                    }\n                } else {\n                   /// nothing\n                }\n            }\n            next();\n         \n            //vm.bookout.passengers[i].status = \"accepted\";\n        }\n\n\n        vm.get_passenger_status = function(member){\n            // //console.log(\"MEMBER\", member);\n            if(member){\n\n\n                if(member.is_member){\n                    // //console.log(\"this one is true\");\n                    return \"OK - is already club member\";\n                } else {\n\n                    if(member.status == \"accepted\"){\n                        return \"OK - passenger has accepted the terms\";\n                    } else if(member.status == \"declined\"){\n                        return \"NO - passenger declined the offer\";\n                    } else if(member.status == \"invited\"){\n                        return \"Waiting for user response\";\n                    } else {\n                        return \"\";\n                    }\n                }\n\n                return \"\";\n            }\n\n        }\n\n\n        \n\n        vm.pics = [\n            \n        ];\n\n\n        // the ARRIVAL option should be automatically filled in when there was a departure prior to the flight and home airfield was\n        //entered as the destination\n\n        vm.flight_types = [\n            {\n                id: 1,\n                title: \"Local\"\n            }, \n            {\n                id: 2,\n                title: \"Departure\"\n            },\n            {\n                id: 3,\n                title: \"Circuits\"\n            },\n            {\n                id: 4,\n                title: \"Other\"\n            }\n        ];\n\n\n        vm.biggin_hill = {\n\n            routes: [\n                {\n                    id: 1,\n                    title: \"Kenley\"\n                },\n                {\n                    id: 2,\n                    title: \"Sevenoaks\"\n                },\n                {\n                    id: 3,\n                    title: \"Swanley\"\n                },\n                {\n                    id: 4,\n                    title: \"Other\"\n                }\n            ],\n            parking: \"\"\n\n        }\n\n        vm.flight_rules = [\n            {\n                id: 1,\n                title: \"VFR\"\n            },\n            {\n                id: 2,\n                title: \"IFR\"\n            }\n        ];\n\n\n\n       \n\n\n        function clean_times(which, start_end, compared_to = null){\n\n            var compare_date;\n\n            switch(which){\n                case 'today':\n                    compare_date = new Date();\n                break;\n                case 'past':\n                    //we need to consider the back-dating as possible issue...\n                    compare_date = new Date(\"1990-07-26\");\n                break;\n                case 'future':\n                    compare_date = new Date(\"1990-07-26\");\n                break;\n                case 'after':\n                //differentiate here\n                    compare_date = new Date(compared_to);\n                break;\n                case 'before':\n                //differentiate here\n                    compare_date = new Date(compared_to);\n                break;\n            }\n\n            var this_date = new Date();\n\n\n            vm[start_end].forEach(function(time, i){\n\n                        //this may very well be the case function here to change when the re-do the times            \n                        var split_time = time.time.split(\":\");\n                        this_date.setHours(split_time[0]);\n                        this_date.setMinutes(split_time[1]);\n                        this_date.setSeconds(0);\n\n\n                        if( moment(this_date).isAfter(moment(compare_date)) ){\n                            vm[start_end][i].disabled = 0;\n                            //we should / could be checking airport opening hours...?\n                            //vm[start_end][i].disabled = check_business_hours(parseInt(split_time[0]), parseInt(split_time[1]), (start_end == \"start_times\")? 1 : 0);\n                        } else {\n                            vm[start_end][i].disabled = 1;\n                        }\n                    });\n\n                //by definition as we are changing something to cause this function from being called - we need to recalculate the times:\n                //calculate_duration();\n\n        }\n\n\n        vm.start_times = [];\n        vm.all_times = [];\n\n        for(var i=0;i<24;i++){\n\n                for(var j=0; j<(60/5); j++){\n                    var k = 5 * j;\n                    k = ((k < 10) ? '0' : '') + k;\n                    vm.start_times.push({time: i+\":\"+k, disabled: false});\n                }\n\n                for(var j=0; j<(60/10); j++){\n                    var k = 10 * j;\n                    k = ((k < 10) ? '0' : '') + k;\n                    vm.all_times.push({time: i+\":\"+k, disabled: false});\n                }\n           \n\n        }\n        clean_times('today', 'start_times');\n        clean_times('future', 'all_times');\n        vm.init_passengers();\n        // vm.bookout.pic = vm.pics[0];\n        vm.currency_days = 28;\n        vm.extra_information_required = false;\n        vm.filing_flightplan = false;\n\n        vm.instructor_charges = [];\n\n        vm.club = {\n            plane: {}\n        };\n\n        switch($state.current.data.action){\n            case \"add\":\n                console.log(\"ADD\");\n                    //vm.selected_rating = vm.ratings[0];\n                    //vm.selected_rating = \n\n                    // //console.log(\"AA\", vm.selected_rating);\n                // //console.log(\"booking_id\", $stateParams.booking_id);\n                //so now we can load the BOOKING with this ID, and therefore can sort it all out :)\n                // let us preload the content required from the booking - fetch the booking\n                // //console.log(\"FETCH THE BOOKING\");\n\n                BookingService.GetForBookout(vm.user.id, $stateParams.booking_id)\n                 .then(function (data) {\n                    // //console.log(\"data is : \", data);\n                    if(data.success){\n                        // //console.log(\"success\");\n                        vm.booking = data.booking;\n                        MemberService.GetAllByPicsBookinout(data.booking.id, data.booking.club_id, vm.user.id)\n                            .then(function (pics) {\n                                    //use GB airfields first...\n                                    ////console.log(\"PICS ARE\", pics);\n\n                                    // if(data.booking.course_id){\n                                    //      CourseService.GetChargesByCourseId(data.booking.course_id)\n                                    //     .then(function(data){\n                                    //         vm.instructor_charges = data.items;  \n                                    //     });\n                                    // } else {\n                                    //      InstructorCharges.GetByClubId(data.booking.club_id)\n                                    //     .then(function(data){\n                                    //         vm.instructor_charges = data.items;  \n                                    //     });\n                                    // }\n                                   \n\n\n                                    PlaneService.GetByIdMaintenance(vm.booking.plane.id, data.booking.club_id)\n                                    .then(function(data){\n                                        vm.club.plane = data;  \n                                        \n                                        status();\n\n                                        //console.log(\"BOOOO - get all maintenance....\", vm.club.plane);\n                                        // vm.page_title = \"Edit a Plane Maintenance - \"+vm.club.plane.registration;\n                                    });\n\n\n                                    vm.pics = pics;\n                                    //vm.bookout.pic\n                                    process_booking_to_bookout(data.booking);\n\n                            });\n\n                    }\n                });\n\n                \n\n\n\n\n            break;\n            case \"edit\":\n\n            console.log(\"EDIT ONE\");\n            // //console.log(\"PARAMS: \", $stateParams);\n\n             LicenceService.GetById($stateParams.licence_id)\n                .then(function (data) {\n                    if(data.success){\n                        vm.licence = data.licence;\n                        vm.licence.licence_issue_date = new Date(vm.licence.licence_issue_date);\n                        vm.licence.licence_expiry_date = new Date(vm.licence.licence_expiry_date);\n                        // //console.log(\"licence\", vm.licence);\n\n                        vm.licence.licence_type = $.grep(vm.licence_types, function(e){ return e.id == vm.licence.licence_id; })[0];\n                        vm.licence.state_of_issue = $.grep(vm.authority, function(e){ return e.id == vm.licence.authority_id; })[0];\n                        // //console.log(\"SET\", vm.licence.state_of_issue);\n\n                        //pre-selection bits?\n                        // //console.log(\"NEW RATINGS\", vm.licence.ratings);\n                        for(var i=0;i<vm.licence.ratings.length;i++){\n                            delete vm.licence.ratings[i].id;\n                            vm.licence.ratings[i].id = vm.licence.ratings[i].rating_id;\n                            delete vm.licence.ratings[i].rating_id;\n                            vm.licence.ratings[i].test_date = new Date(vm.licence.ratings[i].test_date);\n                            vm.licence.ratings[i].expiry_date = new Date(vm.licence.ratings[i].expiry_date);\n\n                            //need to remove the rating from the ratings lists too :)\n                            vm.ratings = $.grep(vm.ratings, function(e){ \n                                return e.id != vm.licence.ratings[i].id; \n                            });\n\n                        }\n\n\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n\n            break;\n            case \"list\":\n\n                // //console.log(\"LIST ALL\");\n\n                 //1 get the user's licence...\n                 //list stuff\n\n                LicenceService.GetByUserId(vm.user_id)\n                .then(function (data) {\n                    // //console.log(data);\n                    if(data.success){\n                        vm.user_licences = data.licences;\n\n                    } else {\n                        // //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n            break;\n            default:\n                 //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n\n        function base64ToBlob(base64) {\n          const binaryString = window.atob(base64);\n          const len = binaryString.length;\n          const bytes = new Uint8Array(len);\n          for (let i = 0; i < len; ++i) {\n            bytes[i] = binaryString.charCodeAt(i);\n          }\n\n          return new Blob([bytes], { type: 'application/pdf' });\n        };\n\n\n        $scope.show_file_now = false;\n        $scope.show_file_url = \"\";\n\n        // $scope.show_file = function(url){\n        //    // var url = \"api/v1/plane_radio_licence/show_file/\"+url;\n        //    //1559216525VmmkQHNrVx6yuTZzDz0h0Q7.jpg.jpg\n\n        //     var ddd = url.replace(/^.*[\\\\\\/]/, '');\n\n\n        //    var url = \"api/v1/plane_documents/show_file/\"+ddd;\n        //     $http.get(url).\n        //       success(function(data, status, headers, config) {\n        //         // 400/500 errors show up here\n        //         //console.log(\"STATUS\", status);\n        //         if (status == 404 || status == 401)\n        //         {\n        //             alert(\"file not found\");\n        //             //console.log('Should never happen');\n\n        //         }\n        //         if(status == 200){\n\n        //            $scope.show_file_url = url;\n        //           // $scope.expression = '<embed src=\"'+url+'\" width=\"100%\" height=\"auto\" />';\n        //             $scope.show_file_now = true;\n\n        //             setTimeout(function(){\n        //                 var divElement = angular.element(document.querySelector('#add_embed'));\n        //                 var htmlElement = angular.element('<embed src=\"'+url+'\" width=\"100%\" height=\"auto\" />');\n        //                 divElement.append(htmlElement);\n        //                 $compile(divElement)($scope);\n        //             }, 500)\n\n                    \n\n\n        //         }\n        //       }).\n        //       error(function(data, status, headers, config) {\n        //         // never reached even for 400/500 status codes\n        //         //console.log(\"STATUS\", status);\n        //          if (status == 404 || status == 401)\n        //         {\n        //             alert(\"file not found\");\n        //             //console.log('Should never happen');\n\n        //         }\n        //       });\n        // }      \n\n\n        // $scope.show_file = function(doc) {\n        //     var data = $.param({\n        //         id: doc\n        //     });\n\n        //     var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n        //     $http.get('api/v1/plane_documents/show_file/'+ddd, {\n        //             responseType: 'arraybuffer'\n        //         })\n        //         .success(function(data, status, headers) {\n        //             var zipName = processArrayBufferToBlob(data, headers);\n\n        //             //Delete file from temp folder in server - file needs to remain open until blob is created\n        //             //deleteFileFromServerTemp(zipName);\n        //         }).error(function(data, status) {\n        //             alert(\"There was an error downloading the selected document(s).\");\n        //         })\n        // };\n\n        $scope.show_file = function(doc, type) {\n            var data = $.param({\n                id: doc\n            });\n\n            //alert(\"type\", type);\n\n            var controller = \"plane_documents\";\n\n            switch(type){\n                 case \"radio\": \n                    controller = \"plane_radio_licence\";\n                break;\n                 case \"insurance\": \n                    controller = \"plane_insurance\";\n                break;\n                 case \"certificate\": \n                    controller = \"plane_certificate\";\n                break;\n                case \"noise\": \n                    controller = \"plane_documents\";\n                break;\n                case \"docs\": \n                    controller = \"plane_documents\";\n                break;\n                default:\n                    controller = \"plane_documents\";\n                break;\n            }\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/'+controller+'/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Error', 'There was an error downloading the selected document(s)');\n                })\n        };\n\n         function processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], {\n                    type: contentType\n                });\n                if (navigator.msSaveBlob)\n                    navigator.msSaveBlob(blob, filename);\n                else {\n                    // Try using other saveBlob implementations, if available\n                    var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                    if (saveBlob === undefined) throw \"Not supported\";\n                    saveBlob(blob, filename);\n                }\n                success = true;\n            } catch (ex) {\n                $log.info(\"saveBlob method failed with the following exception:\");\n                $log.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            $log.info(\"Download link method with simulated click failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n\n\n        $scope.close_file = function(){\n            $scope.show_file_now = false;\n            $scope.show_file_url = \"\";\n        }\n\n        $scope.applyFilter = function(model, filter) {\n            if(filter){\n\n                var pieces = filter.split(':');\n\n                var filterName = pieces[0];\n\n                var params = [model];\n\n                if(pieces.length>1){\n                    \n                    // //console.log(\"hello\", pieces.slice(1).join(\":\"));\n                    if(filterName.toLowerCase() == \"date\"){\n                       params.push( pieces.slice(1).join(\":\") );\n                    }\n                    //params = params.slice(1, -1);\n                    // //console.log(\"contact it\", params);\n\n                } else {\n                    params = params.concat(pieces.slice(1));\n                }\n\n                return $filter(filterName).apply(this,params);\n            }else{\n                return model;\n            }\n        }\n\n        $scope.status = {\n            days: \"\",\n            hours: \"\",\n            insurance: \"\",\n            certificate: \"\",\n            radio_licence: \"\",\n        };\n\n        function status(){\n\n            var plane = vm.club.plane;\n\n            if(plane.maintenance){\n\n                $scope.status.days = (plane.maintenance.days_remaining > 0)? \"ok\" : \"expired\";\n                $scope.status.hours = (plane.maintenance.hours_remaining > 0)? \"ok\" : \"expired\";\n\n            }\n\n            $scope.status.certificate = (plane.certificate.days_to_expiry > 0)? \"ok\" : \"expired\";\n            $scope.status.insurance = (plane.insurance.days_to_expiry > 0)? \"ok\" : \"expired\";\n            $scope.status.radio_licence = (plane.radio_licence.days_to_expiry > 0)? \"ok\" : \"expired\";\n\n\n\n        }\n\n        vm.update_course = function(){\n\n            if(vm.bookout.selected_course && vm.bookout.selected_course.id > 0){\n                //let us set it\n                // console.log(\"ONE COURSE?\", vm.bookout.selected_course.id);\n                 CourseService.GetChargesByCourseId(vm.bookout.selected_course.id)\n                                        .then(function(data){\n                                            vm.instructor_charges = data.items; \n\n                                            if(vm.instructor_charges.length == 1){\n                                                vm.bookout.tuition_required = vm.instructor_charges[0];\n                                            }\n\n                                        });\n\n            } else {\n                // console.log(\"MORE COURSE?\");\n                //let us clear it?\n                 InstructorCharges.GetByClubId(vm.bookout.club_id)\n                                        .then(function(data){\n                                            vm.instructor_charges = data.items; \n\n                                            if(vm.instructor_charges.length == 1){\n                                                vm.bookout.tuition_required = vm.instructor_charges[0];\n                                            }\n                                             \n                                        });\n                                           \n            }\n\n        }\n\n        function process_booking_to_bookout(booking){\n\n\n            //vm.bookout is where we want to fill the content....\n            vm.bookout.booking_id = booking.id;\n            vm.bookout.club_id = booking.club_id;\n            vm.bookout.user_id = booking.user_id;\n            vm.bookout.plane = booking.plane;\n            vm.club_id = booking.club_id;\n            vm.bookout.lesson_id = $stateParams.lesson_id || 0;\n            vm.bookout.return = new Date(booking.end);\n            vm.bookout.booking_start = new Date(booking.start);\n\n\n            if((vm.user.access.instructor.indexOf(vm.club_id) > -1) || (vm.user.access.manager.indexOf(vm.club_id) > -1) ){\n                //console.log(\"NOT BOOKING FOR SELF?\");\n                vm.can_authorise = true;\n                //prepare_add_edit();\n            }\n\n\n             PlaneService.GetOpenIssues(booking.plane.id)\n            .then(function (data) {\n                    ////console.log(\"data is : \", data);\n                   vm.reported_defects = data;\n                });\n\n            //to be able to update the content of the members on the lists...\n            get_all_members();\n\n            //we need to update the PICS now...\n\n\n            //we need to know where the plane was last booked-in at \n            //(ie: if last flight bookout was completed - where the plane landed at last)\n            //if the last booking was not yet completed, then we can assume that this last flight was returning to base.\n\n\n\n            if(booking.instructor && booking.instructor.id > 0){\n                // then we need to set the PIC as the instructor\n                //select from pics where user_id = booking.user_id;\n                var selected_pic = vm.pics.find(item => item.user_id === booking.instructor.id);\n                //set the PIC now...\n                vm.bookout.pic = selected_pic;\n                vm.bookout.instructor_id = booking.instructor.id;\n                vm.bookout.instructor = booking.instructor;\n                vm.bookout.course_id = booking.course_id;\n\n               \n                //set the tuition now... \n                //console.log(\"BOOKING HERE IS : \", booking);\n                vm.bookout.tuition_required = booking.tuition_required;\n\n                // vm.bookout.tuition_required\n                CourseService.GetCoursesByClubId(vm.bookout.club_id)\n                                .then(function(data){\n                                    vm.courses = data.items;   \n                                     console.log(\"COURSES\", vm.courses);\n                                     console.log(\"COURSES\", vm.bookout.course_id);\n\n                                    //set new_booking.tuition-required \n                                    vm.bookout.selected_course = vm.courses.find(function(course, index) {\n                                                                    if(course.id == vm.bookout.course_id)\n                                                                        return true;\n                                                                });\n\n                                    //link to instructor charges??\n\n                                    //auto-fill??\n                                    console.log(\"vm.bookout.course_id\", vm.bookout.course_id);\n                                    vm.update_course();\n\n\n\n                 });\n\n                 // vm.bookout.tuition_required = vm.courses.find(function(course, index) {\n                 //                                                    if(course.id == vm.bookout.course_id)\n                 //                                                        return true;\n                 //                                                });\n\n                var selected_put = vm.pics.find(item => item.user_id === booking.user_id);\n                vm.bookout.put = selected_put;\n                //console.log(\"PICS ARE : \", vm.pics);\n                //console.log(\"INSTRUCTOR IS : \", vm.bookout.instructor);\n                //console.log(\"user IS : \", booking.user_id);\n                //console.log(\"PIC IS : \", booking.pic);\n                //console.log(\"PUT IS : \", vm.bookout.put);\n\n            } else {\n                //then the user is the PIC\n                var selected_pic = vm.pics.find(item => item.user_id === booking.user_id);\n                vm.bookout.pic = selected_pic;\n\n            }\n\n            //preload the pax\n            vm.bookout.passengers = booking.passengers;\n            //setup the pax addition on the bookout page\n            vm.init_passengers();\n\n\n            if(booking && booking.plane_details && booking.plane_details.location && booking.plane_details.location.wgs_n){\n                vm.wgs_n = booking.plane_details.location.wgs_n\n                vm.wgs_e = booking.plane_details.location.wgs_e;\n            }\n            var location_default = \"\";\n\n            if(booking && booking.plane_details && booking.plane_details.location && booking.plane_details.location.code){\n                location_default = booking.plane_details.location.code.slice(0, -1);\n            } else {\n                location_default = \"EG\";\n            }\n\n\n            BookoutService.GetAirfieldsByCode(location_default)\n                .then(function (data) {\n                    if(data.success){\n                        //use GB airfields first...\n                        vm.airfields = data.airfields;\n                        var selected_location = vm.airfields.find(item => item.id === booking.plane_details.location.id);\n                        //console.log(\"selected_location\", selected_location);\n                        vm.bookout.from_airfield = selected_location;\n                       }\n                    });\n\n          \n            //booking.plane_details.location.id\n            // vm.bookout.pic = selected_pic;\n\n\n        }\n\n\n        $scope.selected_airfield_check = function(){\n            //console.log(\"airfield has been selected\", vm.bookout.from_airfield.id);\n            if(vm.bookout.from_airfield.id == 150 || (vm.bookout.to_airfield && vm.bookout.to_airfield.id == 150)){\n                //console.log(\"extra information required\");\n                vm.extra_information_required = true;\n            } else {\n                if(!vm.filing_flightplan && vm.bookout.from_airfield.id !== 150){\n                    if(vm.bookout.to_airfield && vm.bookout.to_airfield.id){\n                        if(vm.bookout.to_airfield.id !== 150){\n                            //console.log(\"not going to biggin and no need for filing a flightplan so wa can ignore this\");\n                            vm.extra_information_required = false;\n                        }\n                    } else {\n                        //console.log(\"not going to biggin and no need for filing a flightplan so wa can ignore this\");\n                        vm.extra_information_required = false;\n                    }\n                    \n                }\n            }\n\n        }\n\n\n            $scope.add_rating = function(){\n\n                //remove from first array\n                vm.ratings = $.grep(vm.ratings, function(e){ \n                    return e.id != vm.selected_rating.id; \n                });\n\n                vm.licence.ratings.push(vm.selected_rating);\n\n                //clear selected\n                delete vm.selected_rating;\n                \n                //clean the array to show what we want to show :)\n                //delete $scope.formData.license.add_to[bit_type];\n\n            }\n\n            $scope.remove_rating = function(index){\n\n                //add to dropdown\n                vm.ratings.push(vm.licence.ratings[index]);\n                vm.licence.ratings.splice(index,1)\n\n                //$scope.formData.license[bit_type] = $scope.formData.license[bit_type].filter(Boolean);\n\n                //  //console.log($scope.formData.license[bit_type]);\n                //  $scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n            }\n\n            //default add the first rating required...\n            \n\n            $scope.bookout_plane = function(){\n\n                ////console.log(\"PAX \", vm.bookout.passengers);\n                //flight type\n                if(!vm.bookout.flight_type || vm.bookout.flight_type.id < 1){\n                    ToastService.highlightField('flight_type');\n                    ToastService.warning('Flight Type', 'You need to select a flight type - is this a local flight? Or a departure?');\n                    return false;\n                }\n\n                if(!vm.bookout.pic || vm.bookout.pic.id < 1){\n                    ToastService.highlightField('pic');\n                    ToastService.warning('Missing PIC', 'You need to select a Pilot In Command (PIC)');\n                    return false;\n                }\n\n                if( (!vm.bookout.is_current || vm.bookout.is_current == 0) && vm.bookout.instructor_id < 1 ){\n                    ToastService.highlightField('is_current');\n                    ToastService.warning('Currency Check', 'Please confirm that you are current according to the club rules, as you do not have an instructor booked.');\n                    return false;\n                }\n\n\n\n\n\n\n\n                //check the destination is entered if required\n                if(vm.bookout.flight_type.id == 2 && (!vm.bookout.to_airfield || (vm.bookout.to_airfield.id < 1 && vm.bookout.to_airfield.title == \"\" ) )){\n                    ToastService.highlightField('to_airfield');\n                    ToastService.warning('Missing Destination', 'As you selected this flight to be a departure, please select a destination airfield');\n                    return false;\n                }\n\n\n\n\n\n\n\n\n\n\n                if(!vm.bookout.accept_defects && vm.reported_defects.length > 0){\n                    ToastService.highlightField('accept_defects');\n                    ToastService.warning('Defects Acknowledgement', 'You must state that you have read the defects currently reported and accept to fly the plane in the condition provided prior to booking out the plane.');\n                    return false;\n                }\n\n                //checking the pax are either member or accepted the invitation\n                vm.refresh_all_passenger();\n\n                var pax = vm.bookout.passengers;\n                for(var i=0;i<pax.length;i++){\n                    if(pax[i][\"status\"] == \"to_invite\"){\n                        ToastService.warning('Passenger Invite', \"You need to press the invitation button for your passenger who isn't already a member before booking out.\");\n                        return false;\n                    }\n                    if(pax[i][\"status\"] == \"invited\" && pax[i][\"aboard\"]){\n                        ToastService.warning('Passenger Status', 'You need to make sure that your passenger has completed his membership and has agreed to the terms of your flight before you go flying.');\n                        return false;\n                    }\n                }\n\n                //then we compose our object for the server...\n\n                var bookout_obj = {\n                    club_id: vm.bookout.club_id,\n                    plane_id: vm.bookout.plane.id,\n                    user_id: vm.bookout.user_id,\n                    pic_id: vm.bookout.pic.user_id,\n                    booking_id: vm.bookout.booking_id,\n                    is_pilot_current: vm.bookout.is_current,\n                    dual_flight: (vm.bookout.instructor_id > 0 && vm.bookout.pic.id == vm.bookout.instructor.id) ? 1 : 0,\n                    instructor_id: vm.bookout.instructor_id,\n                    tuition_id: (vm.bookout.instructor_id > 0 && vm.bookout.tuition_required && !vm.bookout.authorised_solo) ? vm.bookout.tuition_required.id : 0,\n                    detail_type_id: vm.bookout.flight_type.id,\n                    from_airport_id: vm.bookout.from_airfield.id,\n                    to_airport_id: (vm.bookout.flight_type.id == 1 || vm.bookout.flight_type.id == 3) ? vm.bookout.from_airfield.id : vm.bookout.to_airfield.id,\n                    booked_out: 1,\n                    booked_in: 0,\n                    flight_date: new Date(vm.bookout.booking_start),\n                    passengers: vm.bookout.passengers,\n                    authorised_solo: (vm.bookout.authorised_solo)? true : false,\n                    authorised_by: (vm.bookout.authorised_solo)? vm.user.id : 0,\n                    //optional for Biggin / flightplan...\n                    endurance_time: vm.bookout.endurance,\n                    estimated_enroute_time: vm.bookout.en_route,\n                    flight_rules: vm.bookout.flight_rule,\n                    flight_notes: vm.bookout.additional_details,\n                    parking_note: vm.bookout.parking_note,\n                    estimated_departure: vm.bookout.departure,\n                    routing_via_id: (vm.bookout.routing_via) ? vm.bookout.routing_via.id : 0,\n                    lesson_id: vm.bookout.lesson_id || 0\n                }\n\n\n\n                 if(bookout_obj.to_airport_id == 0){\n                    bookout_obj.new_to_airport = vm.bookout.to_airfield;\n                    bookout_obj.new_to_airport.title = bookout_obj.new_to_airport.title.replace(\"NOT LISTED : \", \"\");\n                }\n\n                if(bookout_obj.from_airport_id == 0){\n                    bookout_obj.new_from_airport = vm.bookout.from_airfield;\n                    bookout_obj.new_from_airport.title = bookout_obj.new_from_airport.title.replace(\"NOT LISTED : \", \"\");\n                }    \n\n\n                // console.log(\"READY WITH: \", bookout_obj);\n                // return false;\n\n                BookoutService.SendBookout(vm.user.id, bookout_obj)\n                .then(function(data){\n                    if(data.success){\n                        $state.go('dashboard.my_account.booked_out', {booking_id: vm.bookout.booking_id});\n                    } else {\n                        ToastService.error('Bookout Failed', 'Something went wrong: ' + (data.message || 'Unknown error'));\n                    }\n                });\n\n\n                //console.log(\"OBJECT HERE\", bookout_obj);\n\n            }\n\n\n\n\n/*\n\nOLD VERSION FOR LEGACY PURPOSES\n\n  $scope.add_element = function(bit_type){\n\n                //remove from first array\n                $scope[bit_type][bit_type] = $.grep($scope[bit_type][bit_type], function(e){ \n                    return e.id != $scope.formData.license.add_to[bit_type].id; \n                });\n\n                if(bit_type == \"differences\"){\n                    $scope.formData.license.add_to[bit_type].day = true;\n                    $scope.formData.license.add_to[bit_type].vfr = true;\n                }\n                //console.log($scope.formData.license.add_to[bit_type]);\n\n                $scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n                \n                //clean the array to show what we want to show :)\n                delete $scope.formData.license.add_to[bit_type];\n\n            }\n\n\n            $scope.remove_element = function(bit_type, index){\n\n                //add to dropdown\n                $scope[bit_type][bit_type].push($scope.formData.license[bit_type][index]);\n            \n                $scope.formData.license[bit_type].splice(index,1)\n\n                $scope.formData.license[bit_type] = $scope.formData.license[bit_type].filter(Boolean);\n                //console.log($scope.formData.license[bit_type]);\n                //$scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n            }\n\n\n*/\n\n\n            //nice looking date pickers\n\n\n            $scope.popup = [];\n\n            $scope.open = function(id, $event) {\n                //console.log(\"THIS\", id);\n                //this comment would allow the event not to be affect by clicking it again... not sure this is a good idea\n                if($scope.popup[id] && $scope.popup[id].opened == true){\n                    $event.preventDefault();\n                    $event.stopPropagation();\n                } else {\n                    $scope.popup[id] = {opened: true};\n                }\n            };\n\n            $scope.formats = ['dd/MM/yyyy', 'yyyy/MM/dd', 'dd.MM.yyyy', 'shortDate'];\n            $scope.format = $scope.formats[0];\n\n            $scope.datePickerOptions = {\n                                        format: 'dd/MM/yyyy',\n                                        showWeeks: false\n                                    };\n\n           \n\n           $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.licence.images = $.grep(vm.licence.images, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                \n\n          }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            //console.log(\"REMOVE: \", j);\n            //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            LicenceService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.licence_images = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n            $scope.processFiles = function(files){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    files[i].file.temp_path = j.saved_url;\n                    // //console.log(\"file\", files[i].file);\n                    vm.licence_images.push(files[i].file);\n                }\n               \n            }\n\n\n\n            $scope.delete_licence = function(id){\n\n\n                var a = prompt(\"Are you sure you wish to delete this licence? \\n\\n This change is irreversible! To confirm please type YES in the box below.\");\n                if(a == \"YES\"){\n                    //console.log(\"WE DELETE IT\");\n\n\n                    LicenceService.Delete(vm.user_id, id)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                //console.log(\"HUZZAH\", data);\n                                //then we need to remove this from the list of files...\n                                vm.user_licences = $.grep(vm.user_licences, function(e){ \n                                    return e.id != id; \n                                });\n                                \n                                //refresh?\n                                $state.reload();\n                                $state.go('dashboard.my_account.licence');\n\n                            } else {\n\n                                ToastService.error('Error', data.message);\n\n                            }\n\n                        });\n\n\n\n                } else {\n                    //console.log(\"ignore\");\n                }\n\n\n            }\n\n\n\n\n            $scope.save_licence = function(isValid){\n\n                if(vm.licence_images.length < 1 && vm.licence.images.length < 1){\n\n                    $(\".drop\").focus();\n                    ToastService.warning('Missing Image', 'You must at least have 1 image of your licence!');\n\n                    return false;   \n                }\n\n\n                if(!vm.licence.licence_type){\n                    $(\"#licence_type\").focus();\n                    ToastService.warning('Missing Licence Type', 'You must select a licence type');\n\n                    return false;\n                }\n\n\n                if(!vm.licence.state_of_issue){\n                    $(\"#state_of_issue\").focus();\n                    ToastService.warning('Missing State', 'You must select a licence state of issue');\n\n                    return false;\n                }\n\n\n                if(vm.licence.ratings.length < 1){\n\n                    $(\"#ratings\").focus();\n                    ToastService.warning('Missing Rating', 'You must at least have 1 rating!');\n                    \n                    return false;   \n                }\n\n                //console.log(\"FLOW: \", vm.licence_images);\n\n\n\n                //compile the required elements YAY\n\n                //console.log(\"LICENCE GOOD TO GO \", vm.licence);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n                    for(var i=0;i<vm.licence.images.length;i++){\n                        delete vm.licence.images[i].data_uri;\n                    }\n\n                    // vm.licence.images = vm.licence_images;\n                    vm.licence.images = vm.licence.images.concat(vm.licence_images);\n\n                    vm.licence.licence_id = vm.licence.licence_type.id;\n                    vm.licence.authority_id = vm.licence.state_of_issue.id;\n                    vm.licence.user_id = vm.user_id;\n\n                    delete vm.licence.licence_type;\n                    delete vm.licence.state_of_issue;\n\n\n                if(vm.licence.id){\n                    //then its an udpate\n\n                    //merge the images left?\n                    LicenceService.Update(vm.licence)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                //console.log(\"HUZZAH\", vm.licence);\n                                //console.log(\"HUZZAH\", data);\n                                //then we need to remove this from the list of files...\n                                \n                                \n                                //move somewhere?\n                                $state.go('dashboard.my_account.licence', {}, { reload: true });\n\n\n\n\n\n                            } else {\n\n                                ToastService.error('Error', data.message);\n\n                            }\n\n                        });\n\n                } else {\n\n\n                   \n\n\n                    //then its a create\n                    //console.log(vm.licence);\n\n                    LicenceService.Create(vm.licence)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                //console.log(\"HUZZAH\", vm.licence);\n                                //console.log(\"HUZZAH\", data);\n                                //then we need to remove this from the list of files...\n                                \n                                \n                                //move somewhere?\n                                $state.reload();\n                                $state.go('dashboard.my_account.licence', {}, { reload: true });\n\n\n                            } else {\n\n                                ToastService.error('Error', data.message);\n\n                            }\n\n                        });\n\n\n                }\n\n\n\n            };\n\n\n\n\n            $scope.logout = function(){\n                //alert(\"LOG ME OUT\");\n                AuthenticationService.Logout(function(data){\n\n                               AuthenticationService.ClearCredentials();\n                                 \n                                $cookieStore.remove('globals');\n                                $cookieStore.remove('session');\n\n                                // Clear return URL  this is an intentional logout, not a session timeout\n                                try { localStorage.removeItem('toaviate_return_url'); } catch(e) {}\n\n                                $location.path('/login');\n\n\n                             \n                            \n                        });\n            }\n\n            $scope.go_flying = function(){\n                //alert(\"LOG ME OUT\");\n             \n\n                $state.go('dashboard.my_account', {}, { reload: true });\n\n\n                       \n            }\n\n\n\n\n\n\n\n            //EDITING OF THE BOOKING FROM THE BOOKOUT...\n             /* THIS SECTION IS ABOUT THE ADD / EDIT OF THE CALENDAR EVENTS VIA THE EDIT / ADD NEW BOOKING */\n\n            // vm.dateTimeRangePickerOptions = {\n            //     hour_step: 1,\n            //     minute_step: 30,\n            //     min_date: today,\n            //     datepicker:{\n            //         customClass: getDayClass,\n            //         format: 'dd/MM/yyyy',\n            //         showWeeks: false,\n            //         minDate: today\n            //     }\n            //     ,\n            //     business_hours: {\n            //         from: \"09:00\",\n            //         to: \"22:30\"\n            //     }\n            // };\n\n\n            // /* ADD OR EDIT THE BOOKING */\n\n            // function figure_out_steps(){\n            //     //console.log(\"OPTIONS\", vm.dateTimeRangePickerOptions);\n            //     vm.new_booking.options = vm.dateTimeRangePickerOptions;\n            //      for(var i=0;i<24;i+=vm.new_booking.options.hour_step){\n\n            //         if(vm.new_booking.options.minute_step && vm.new_booking.options.minute_step > 0){\n            //             for(var j=0; j<(60/vm.new_booking.options.minute_step); j++){\n            //                 var k = vm.new_booking.options.minute_step * j;\n            //                 k = ((k < 10) ? '0' : '') + k;\n            //                 vm.start_times.push({time: i+\":\"+k, disabled: check_business_hours(i, k)});\n            //                 vm.end_times.push({time: i+\":\"+k, disabled: check_business_hours(i, k), duration: \"\"});\n            //             }\n            //         } else {\n            //             vm.start_times.push({time: i+\":00\", disabled: check_business_hours(i)});\n            //             vm.end_times.push({time: i+\":00\", disabled: check_business_hours(i), duration: \"\"});\n            //         }\n\n            //     }\n            // }\n\n            // function init_times(){\n            //    for(var i=0;i<24;i+=vm.new_booking.options.hour_step){\n\n            //         if(vm.new_booking.options.minute_step && vm.new_booking.options.minute_step > 0){\n            //             for(var j=0; j<(60/vm.new_booking.options.minute_step); j++){\n            //                 var k = vm.new_booking.options.minute_step * j;\n            //                 k = ((k < 10) ? '0' : '') + k;\n            //                 vm.start_times.push({time: i+\":\"+k, disabled: check_business_hours(i, k)});\n            //                 vm.end_times.push({time: i+\":\"+k, disabled: check_business_hours(i, k), duration: \"\"});\n            //             }\n            //         } else {\n            //             vm.start_times.push({time: i+\":00\", disabled: check_business_hours(i)});\n            //             vm.end_times.push({time: i+\":00\", disabled: check_business_hours(i), duration: \"\"});\n            //         }\n\n            //     } \n            // }\n\n\n        \n\n\n\n\n\n\n\n\n\n\n\n\n        \n\n\n    }\napp.controller('CategoriesController', CategoriesController);\n \n    CategoriesController.$inject = ['UserService', 'CategoryService', '$location', '$rootScope', 'FlashService', '$routeParams', '$scope'];\n    function CategoriesController(UserService, CategoryService, $location, $rootScope, FlashService, $routeParams, $scope) {\n        var vm = this;\n\n        // vm.cats = [\n        // \t{\"title\": \"art\", \"id\": 1},\n        // \t{\"title\": \"fashion\", \"id\": 2},\n        // \t{\"title\": \"glass\", \"id\": 3},\n        // \t{\"title\": \"metal\", \"id\": 4}\n        // ];\n       \n         CategoryService.GetAll()\n                .then(function (data) {\n                    vm.cats = data;\n                });\n\n       \tvm.id = 1;\n       \tvm.myModel = 'Click here and delete me';\n\t\t$scope.myUpdateHandler = function(id, category){\n\t\t  // check your console\n\t\t  //console.log('value of '+id+' your model is now: ' + category);\n\t\t  var update = {\"id\": id, \"title\": category};\n\t\t  CategoryService.Update(update)\n                .then(function (data) {\n                    //console.log(\"SAVED :)\");\n                });\n\t\t};\n\n\t\t$scope.addCategory = function(){\n\t\t\t//console.log(\"ADD ONE \"+vm.new_category);\n\t\t\t//need to call the outside world here and now :0\n\t\t\tvar add_one = {\"title\": vm.new_category};\n\t\t\tCategoryService.Create(add_one)\n                .then(function (data) {\n                    vm.cats.push(data);\n                    //reset\n\t\t\t\t\tvm.new_category = \"\";\n                });\n\t\t}\n\n\t\t$scope.deleteCategory = function(id){\n\n\t\t\tCategoryService.Delete(id)\n                .then(function (data) {\n                    vm.cats = $.grep(vm.cats, function(e){ \n\t\t\t\t\t     return e.id != id; \n\t\t\t\t\t});\n                });\n\n\t\t}\n\n    }\n app.controller('ClaimAFlightController', ClaimAFlightController);\n\n    ClaimAFlightController.$inject = ['UserService', 'FoxService', '$rootScope', '$scope', '$stateParams', '$location'];\n    function ClaimAFlightController(UserService, FoxService, $rootScope, $scope, $stateParams, $location) {\n        var vm = this;\n\n        vm.user = $rootScope.globals.currentUser;\n        vm.unclaimed = [];\n\n        vm.looking_for = $stateParams.registration;\n\n        // View toggle: 'aircraft' (grouped by aircraft) or 'all' (flat list)\n        vm.activeView = 'aircraft';\n        vm.setView = function(view) { vm.activeView = view; };\n\n        // Aircraft ui-select\n        vm.aircraftList = [];      // flat list of all aircraft for the ui-select\n        vm.selectedAircraft = null;\n        vm.allFlights = [];        // flat list of every flight for the \"all\" view\n\n        vm.onAircraftSelected = function(item) {\n            vm.selectedAircraft = item || null;\n        };\n\n        vm.clearAircraftFilter = function() {\n            vm.selectedAircraft = null;\n        };\n\n        // Build helper lists after data loads\n        function buildHelperLists() {\n            vm.aircraftList = [];\n            vm.allFlights = [];\n            if (!vm.unclaimed || !vm.unclaimed.to_claim) return;\n\n            vm.unclaimed.to_claim.forEach(function(club) {\n                (club.aircraft || []).forEach(function(plane) {\n                    var entry = {\n                        plane_id: plane.plane_id,\n                        registration: plane.registration,\n                        plane_type: plane.plane_type,\n                        club_name: club.club_name,\n                        label: plane.registration + '  ' + plane.plane_type\n                    };\n                    vm.aircraftList.push(entry);\n\n                    (plane.flights || []).forEach(function(log) {\n                        vm.allFlights.push({\n                            registration: plane.registration,\n                            plane_type: plane.plane_type,\n                            club_name: club.club_name,\n                            flight_date: log.flight_date,\n                            brakes_time: log.brakes_time,\n                            plane_log_sheet_id: log.plane_log_sheet_id,\n                            brakes_off: log.brakes_off,\n                            brakes_on: log.brakes_on,\n                            from_airfield_code: log.from_airfield_code,\n                            from_airfield_name: log.from_airfield_name,\n                            to_airfield_code: log.to_airfield_code,\n                            to_airfield_name: log.to_airfield_name,\n                            airborne_seconds: log.airborne_seconds,\n                            number_landings: log.number_landings,\n                            takeoffs_landings: log.takeoffs_landings\n                        });\n                    });\n                });\n            });\n\n            // Sort all flights newest first (by flight_date + brakes_off time)\n            vm.allFlights.sort(function(a, b) {\n                var dateA = new Date(a.flight_date + ' ' + (a.brakes_off || '00:00'));\n                var dateB = new Date(b.flight_date + ' ' + (b.brakes_off || '00:00'));\n                return dateB - dateA;\n            });\n\n            // Pre-select aircraft if route param was provided\n            if (vm.looking_for) {\n                var match = vm.aircraftList.filter(function(a) {\n                    return a.registration.toLowerCase().indexOf(vm.looking_for.toLowerCase()) !== -1;\n                });\n                if (match.length) vm.selectedAircraft = match[0];\n            }\n        }\n\n        // Filter functions for aircraft view\n        vm.aircraftFilter = function(plane) {\n            if (!vm.selectedAircraft) return true;\n            return plane.registration === vm.selectedAircraft.registration;\n        };\n\n        // vm.allUsers = [];\n        // vm.deleteUser = deleteUser;\n\n        initController();\n\n        function initController() {\n            // loadCurrentUser();\n            console.log(\"init claim a flight controller\");\n            GetFoxEntries();\n            // loadAllUsers();\n        }\n\n        function GetFoxEntries() {\n            //is this a club_id ? OR is this a USER id --> therefore return all clubs with all un-claimed flights?\n            FoxService.GetFoxEntries($rootScope.globals.currentUser.id)\n                .then(function (data) {\n                    console.log(\"GetFoxEntries was called here\");\n                    vm.unclaimed = data;\n                    console.log(\"vm.unclaimed\", vm.unclaimed);\n                    buildHelperLists();\n                });\n        }\n\n        // function loadAllUsers() {\n        //     UserService.GetAll()\n        //         .then(function (data) {\n        //             vm.allUsers = data.users;\n        //         });\n        // }\n\n       \n        // function deleteUser(id) {\n        //     UserService.Delete(id)\n        //     .then(function(data) {\n        //         if(data.success){\n\t       //          $location.path('/');\n        //         }\n        //     });\n        // }\n\n        $scope.search = function(row){\n            ////console.log(\"hi\", (angular.lowercase(row.title).indexOf(angular.lowercase($scope.my_search) || '') !== -1));\n            return (angular.lowercase(row.title).indexOf(angular.lowercase($scope.my_search) || '') !== -1);\n        };\n\n        $scope.search2 = function(row){\n            return (angular.lowercase(row.registration).indexOf(angular.lowercase($scope.my_search2) || '') !== -1);\n        };\n\n        $scope.getMySearchCount = function(str){\n            var docs = str.documents;\n            var total = 0;\n            for(var i=0;i<docs.length;i++){\n                if($scope.search(docs[i])){\n                    total++;\n                }\n            }\n            return total;\n        }\n        \n        vm.clean_times = function(time){\n                return time.substring(0,5);\n        }\n\n        vm.difference_times = function(to, from){\n            var to_datetime = moment(to);\n            var from_datetime = moment(from);\n            // console.log(\"to datetime\", to_datetime);\n            // console.log(\"from datetime\", from_datetime);\n            var duration = moment.duration(from_datetime.diff(to_datetime));\n            var hours = duration.asHours();\n            //now to hours and seconds??\n            var hour = Math.floor(Math.abs(hours));\n            var min = Math.round((Math.abs(hours) * 60) % 60);\n            return (hour < 10 ? \"0\" : \"\") + hour + \":\" + (min < 10 ? \"0\" : \"\") + min;\n            //return hours;\n        }\n\n        vm.difference_times_decimal = function(to, from){\n            var to_datetime = moment(to);\n            var from_datetime = moment(from);\n            var duration = moment.duration(from_datetime.diff(to_datetime));\n            var hours = duration.asHours();\n            return hours;\n        }\n\n        vm.airborne_decimal = function(seconds){\n             var hours = seconds / 60 / 60;\n             return hours;\n        }\n\n        vm.airborne_to_hours = function(seconds){\n             var hours = seconds / 60 / 60;\n             var hour = Math.floor(Math.abs(hours));\n             var min = Math.round((Math.abs(hours) * 60) % 60);\n             if(min == 60){\n                 hour = hour +1;\n                 min = 0;\n             }\n             return (hour < 10 ? \"0\" : \"\") + hour + \":\" + (min < 10 ? \"0\" : \"\") + min;\n        }\n\n        $scope.get_hours_from_decimal = function(time){\n\n            if(time){\n                 var sign = time < 0 ? \"-\" : \"\";\n                 var hour = Math.floor(Math.abs(time));\n                 var min = Math.round((Math.abs(time) * 60) % 60);\n                 if(min == 60){\n                     hour++;\n                     min = 0;\n                 }\n                 return sign + (hour < 10 ? \"0\" : \"\") + hour + \":\" + (min < 10 ? \"0\" : \"\") + min;\n             } else {\n                 return \"N/A\";\n             }\n        }\n\n\n    }\n app.controller('ClubDocumentsController', ClubDocumentsController);\n\n    ClubDocumentsController.$inject = ['UserService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'BookingService', 'LicenceService', 'ClubDocumentService', '$http', 'ToastService'];\n    function ClubDocumentsController(UserService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, BookingService, LicenceService, ClubDocumentService, $http, ToastService) {\n        \n        var vm = this;\n        vm.licence_images = [];\n        vm.documents = [];\n        vm.licence = {\n                images: [],\n                ratings: []\n        };\n        // vm.user_id = 59;\n        // vm.club_id = 6;\n\n\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n\n        vm.uploaded_document = {};\n\n        //GetByClubId\n\n        // LicenceService.GetLicenceTypes()\n        //         .then(function (data) {\n        //             vm.licence_types = data;\n        //             //console.log(\"licence_types: \", vm.licence_types);\n        //         });\n\n        // LicenceService.GetRatings()\n        //     .then(function (data) {\n        //         vm.ratings = data;\n        //         //console.log(\"ratings: \", vm.ratings);\n\n        //         if($state.current.data.action == \"add\"){\n\n        //             vm.selected_rating = $.grep(vm.ratings, function(e){ return e.id == 7; })[0];\n        //             $scope.add_rating();\n\n        //             // for(var i=0;i<vm.ratings.length; i++){\n        //             //     //console.log(\"LOOP\", vm.ratings[i]);\n        //             //     if(vm.ratings[i].id == 7){\n        //             //         vm.selected_rating = vm.ratings[i];\n        //             //         //console.log(\"FOUND\", vm.selected_rating);\n        //             //         $scope.add_rating();\n        //             //         break;\n        //             //     }\n        //             // }\n        //         }\n               \n\n\n        //     });\n\n        // LicenceService.GetAuthority()\n        //     .then(function (data) {\n        //         vm.authority = data;\n        //         //console.log(\"authority: \", vm.authority);\n        //     });\n\n\n        switch($state.current.data.action){\n            case \"add\":\n\n                    //vm.selected_rating = vm.ratings[0];\n                    //vm.selected_rating = \n                    \n\n                    // //console.log(\"AA\", vm.selected_rating);\n\n            \n\n            break;\n            case \"edit\":\n\n            // //console.log(\"EDIT ONE\");\n            // //console.log(\"PARAMS: \", $stateParams);\n\n             ClubDocumentService.GetById($stateParams.document_id)\n                .then(function (data) {\n                    if(data.success){\n                        //console.log(\"WE GOT data\", data);\n                        vm.document = data.document;\n                        vm.uploaded_document = {file: vm.document.document};\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n\n            break;\n            case \"list\":\n\n                //console.log(\"LIST ALL\");\n\n                 //1 get the user's licence...\n                 //list stuff\n\n                ClubDocumentService.GetByClubId(vm.club_id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        vm.club_documents = data.club_documents;\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n\n\n            $scope.add_rating = function(){\n\n                //remove from first array\n                vm.ratings = $.grep(vm.ratings, function(e){ \n                    return e.id != vm.selected_rating.id; \n                });\n\n                vm.licence.ratings.push(vm.selected_rating);\n\n                //clear selected\n                delete vm.selected_rating;\n                \n                //clean the array to show what we want to show :)\n                //delete $scope.formData.license.add_to[bit_type];\n\n            }\n\n            $scope.remove_rating = function(index){\n\n                //add to dropdown\n                vm.ratings.push(vm.licence.ratings[index]);\n                vm.licence.ratings.splice(index,1)\n\n                //$scope.formData.license[bit_type] = $scope.formData.license[bit_type].filter(Boolean);\n\n                //  //console.log($scope.formData.license[bit_type]);\n                //  $scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n            }\n\n            //default add the first rating required...\n            \n\n\n\n/*\n\nOLD VERSION FOR LEGACY PURPOSES\n\n  $scope.add_element = function(bit_type){\n\n                //remove from first array\n                $scope[bit_type][bit_type] = $.grep($scope[bit_type][bit_type], function(e){ \n                    return e.id != $scope.formData.license.add_to[bit_type].id; \n                });\n\n                if(bit_type == \"differences\"){\n                    $scope.formData.license.add_to[bit_type].day = true;\n                    $scope.formData.license.add_to[bit_type].vfr = true;\n                }\n                //console.log($scope.formData.license.add_to[bit_type]);\n\n                $scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n                \n                //clean the array to show what we want to show :)\n                delete $scope.formData.license.add_to[bit_type];\n\n            }\n\n\n            $scope.remove_element = function(bit_type, index){\n\n                //add to dropdown\n                $scope[bit_type][bit_type].push($scope.formData.license[bit_type][index]);\n            \n                $scope.formData.license[bit_type].splice(index,1)\n\n                $scope.formData.license[bit_type] = $scope.formData.license[bit_type].filter(Boolean);\n                //console.log($scope.formData.license[bit_type]);\n                //$scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n            }\n\n\n*/\n\n\n            //nice looking date pickers\n\n\n            $scope.popup = [];\n\n            $scope.open = function(id, $event) {\n                //console.log(\"THIS\", id);\n                //this comment would allow the event not to be affect by clicking it again... not sure this is a good idea\n                if($scope.popup[id] && $scope.popup[id].opened == true){\n                    $event.preventDefault();\n                    $event.stopPropagation();\n                } else {\n                    $scope.popup[id] = {opened: true};\n                }\n            };\n\n            $scope.formats = ['dd/MM/yyyy', 'yyyy/MM/dd', 'dd.MM.yyyy', 'shortDate'];\n            $scope.format = $scope.formats[0];\n\n            $scope.datePickerOptions = {\n                                        format: 'dd/MM/yyyy',\n                                        showWeeks: false\n                                    };\n\n           \n\n          //  $scope.remove_real_file = function(file){\n\n          //       //remove_file\n\n          //       vm.licence.images = $.grep(vm.licence.images, function(e){ \n          //               return e.id != file.id; \n          //           });\n\n          //       //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                \n\n          // }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            //console.log(\"REMOVE: \", j);\n            //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            LicenceService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.licence_images = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n            // $scope.processFiles = function(files){\n            //     // //console.log(\"files\", files);\n\n            //     for(var i=0; i<files.length; i++){\n            //         // //console.log(\"JSON\", files[i].file_return);\n            //         var j = JSON.parse(files[i].file_return);\n            //         // //console.log(\"PARSED\", j);\n            //         files[i].file.temp_path = j.saved_url;\n            //         // //console.log(\"file\", files[i].file);\n            //         vm.documents.push(files[i].file);\n            //     }\n               \n            // }\n            $scope.processFiles = function(files){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    //console.log(\"J is : \",j);\n                    //console.log(\"name is : \", j.files.file.name);\n\n                    files[i].file.temp_path = j.saved_url;\n                    files[i].file.save_name = j.files.file.name;\n                    var ft = j.files.file.name;\n                    ft = ft.split('.').pop();\n                    files[i].file.extension = ft;\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.documents.push(files[i].file);\n                }\n\n\n            }\n\n\n\n            $scope.delete_licence = function(id){\n\n\n                var a = prompt(\"Are you sure you wish to delete this licence? \\n\\n This change is irreversible! To confirm please type YES in the box below.\");\n                if(a == \"YES\"){\n                    //console.log(\"WE DELETE IT\");\n\n\n                    ClubDocumentService.Delete(vm.user_id, id)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                //console.log(\"HUZZAH\", data);\n                                //then we need to remove this from the list of files...\n                                vm.club_documents = $.grep(vm.club_documents, function(e){ \n                                    return e.id != id; \n                                });\n                                \n                                //refresh?\n                                $state.reload();\n                                $state.go('dashboard.manage_club.documents');\n\n                            } else {\n\n                                ToastService.error('Save Failed', 'Something went terribly wrong... ' + data.message);\n\n                            }\n\n                        });\n\n\n\n                } else {\n                    //console.log(\"ignore\");\n                }\n\n\n            }\n\n\n\n\n            $scope.save_licence = function(isValid){\n\n                if(!vm.document.id){\n                    // Creating  a file upload is mandatory\n                    if(!vm.documents || vm.documents.length < 1){\n                        ToastService.highlightField('.drop');\n                        ToastService.warning('Missing Document', 'You must upload at least 1 file before saving!');\n                        return false;\n                    }\n                } else {\n                    // Editing  existing doc must still have its file\n                    if((!vm.documents || vm.documents.length < 1) && (!vm.document.document || vm.document.document == \"\")){\n                        ToastService.highlightField('.drop');\n                        ToastService.warning('Missing Document', 'You must at least have 1 pdf!');\n                        return false;\n                    }\n                }\n\n                if(!vm.document.title || vm.document.title.trim() === ''){\n                    ToastService.highlightField('doc_title');\n                    ToastService.warning('Title Required', 'Please enter a title for this document.');\n                    return false;\n                }\n\n\n                //console.log(\"LICENCE GOOD TO GO \", vm.documents);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n                    // for(var i=0;i<vm.documents.images.length;i++){\n                    //     delete vm.documents.images[i].data_uri;\n                    // }\n\n                    // // vm.licence.images = vm.licence_images;\n                    // vm.documents.images = vm.documents.images.concat(vm.documents);\n\n                    //vm.documents.images = vm.documents.images[0];\n\n                \n\n                if(vm.document.id){\n                    //then its an udpate\n\n                    //merge the images left?\n                    ClubDocumentService.Update(vm.document)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                //console.log(\"HUZZAH\", vm.document);\n                                //console.log(\"HUZZAH\", data);\n                                //then we need to remove this from the list of files...\n                                \n                                \n                                //move somewhere?\n                                $state.go('dashboard.manage_club.documents', {}, { reload: true });\n\n\n\n\n\n                            } else {\n\n                                ToastService.error('Save Failed', 'Something went terribly wrong... ' + data.message);\n\n                            }\n\n                        });\n\n                } else {\n\n\n                   \n\n\n                    //then its a create\n                    //console.log(\"ONE\", vm.documents[0]);\n\n                    var the_file = vm.documents[0];\n                    //console.log(\"TWO\", the_file);\n\n                    var to_send = {\n                        my_file: the_file,\n                        title: vm.document.title,\n                        description: vm.document.description,\n                        club_id: vm.club_id\n                    };\n\n                    //console.log(\"tosend\", to_send);\n\n                    ClubDocumentService.Create(to_send)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n\n                                //console.log(\"HUZZAH\", data);\n                                //then we need to remove this from the list of files...\n                                \n                                \n                                //move somewhere?\n                                $state.reload();\n                                $state.go('dashboard.manage_club.documents', {}, { reload: true });\n\n\n                            } else {\n\n                                ToastService.error('Save Failed', 'Something went terribly wrong... ' + data.message);\n\n                            }\n\n                        });\n\n\n                }\n\n\n\n            };\n\n\n\n   var warning_msg = \"By deleting this document no other member will be able to see it.\"\n\n          $scope.open = function (doc_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return doc_id;\n                },\n                params: function() {\n                  return {id: doc_id};\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (doc) {\n                var id = doc.id;\n              $log.info('PRESSED GO: ', id);\n              ClubDocumentService.Delete(vm.user_id, id)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                //console.log(\"HUZZAH\", data);\n                                //then we need to remove this from the list of files...\n                                vm.club_documents = $.grep(vm.club_documents, function(e){ \n                                    return e.id != id; \n                                });\n\n                                \n                                //refresh?\n                                $state.reload();\n                                $state.go('dashboard.manage_club.documents');\n\n                            } else {\n\n                                ToastService.error('Delete Failed', 'Something went terribly wrong... ' + data.message);\n\n                            }\n\n                        });\n              // ItemService.Delete(vm.user_id, plane_id.id)\n              // .then(function(){\n              //   //console.log(\"HELLO DELETE\");\n              //   //update view?\n              //    vm.club.items = $.grep(vm.club.items, function(e){ \n              //       return e.id != plane_id.id; \n              //   });\n              // })\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n          };\n\n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            $scope.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n\n            $scope.downloadDocument = function(doc) {\n            var data = $.param({\n                id: doc\n            });\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/plane_documents/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n\n\n        $scope.downloadClubDocument = function(doc) {\n            var data = $.param({\n                id: doc\n            });\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/club_documents/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n\n\n        function processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], {\n                    type: contentType\n                });\n                if (navigator.msSaveBlob)\n                    navigator.msSaveBlob(blob, filename);\n                else {\n                    // Try using other saveBlob implementations, if available\n                    var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                    if (saveBlob === undefined) throw \"Not supported\";\n                    saveBlob(blob, filename);\n                }\n                success = true;\n            } catch (ex) {\n                $log.info(\"saveBlob method failed with the following exception:\");\n                $log.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            $log.info(\"Download link method with simulated click failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n\n        \n        \n\n\n    }\n app.controller('ClubPaymentsController', ClubPaymentsController);\n\n    ClubPaymentsController.$inject = ['UserService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'PaymentService', 'PoidService'];\n    function ClubPaymentsController(UserService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, PaymentService, PoidService) {\n        \n        var vm = this;        \n\n        vm.poid_images = [];\n        vm.poid = {\n                images: []\n        };\n        \n        // vm.user_id = 59;\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n        vm.customer_token = \"\";\n\n\n        // function stripeResponseHandler(status, response) {\n        //   // Grab the form:\n        //   var $form = $('#payment-form');\n\n        //   if (response.error) { // Problem!\n\n        //     // Show the errors on the form:\n        //     $form.find('.payment-errors').text(response.error.message);\n        //     $form.find('.submit').prop('disabled', false); // Re-enable submission\n\n        //   } else { // Token was created!\n\n        //     // Get the token ID:\n        //     var token = response.id;\n\n        //     //console.log(\"CARD TOKEN IS: \"+token);\n\n        //     // Insert the token ID into the form so it gets submitted to the server:\n        //     $form.append($('<input type=\"hidden\" name=\"stripeToken\">').val(token));\n\n        //     // Submit the form:\n        //     //$form.get(0).submit();\n        //   }\n        // };\n\n\n        $scope.get_addresses = function(){\n\n            //  trial key\n            //  auth: api-key: BP-8KOdw8ka3F2eDU-Zz-g5865   \n            //  https://api.getAddress.io/v2/uk/{postcode}\n            // PaymentService.getAddress()\n\n            PaymentService.GetAddresses(vm.postcode)\n                .then(function (data) {\n                    if(data.success){\n\n                        //console.log(\"addresses: \"+data.addresses);\n                        vm.addresses = data.addresses;\n                        //fill the drop down menu\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n\n                    }\n                });\n\n\n\n        }\n\n\n        // $scope.add_card = function () {\n           \n        //         var $form = $('#payment-form');\n        //         $form.submit(function(event) {\n        //         // Disable the submit button to prevent repeated clicks:\n        //         $form.find('.submit').prop('disabled', true);\n\n        //         // Request a token from Stripe:\n        //         Stripe.card.createToken($form, stripeResponseHandler);\n\n        //         Stripe.bankAccount.createToken('bank_account', {\n        //           country: 'gb',\n        //           currency: 'gbp',\n        //           routing_number: '110000000',\n        //           account_number: '000123456789',\n        //           account_holder_name: 'Jenny Rosen',\n        //           account_holder_type: 'individual',\n        //         }).then(function(result) {\n        //           // handle result.error or result.token\n        //         });\n\n\n\n        //         // Prevent the form from being submitted:\n        //         return false;\n        //       });\n\n\n        // };\n\n\n\n        switch($state.current.data.action){\n            case \"add\":\n\n                    //vm.selected_component = vm.components[0];\n                    //vm.selected_component = \n                    \n\n                    // //console.log(\"AA\", vm.selected_component);\n\n            \n\n            break;\n            case \"edit\":\n\n            // //console.log(\"EDIT ONE\");\n            // //console.log(\"PARAMS: \", $stateParams);\n\n             PoidService.GetById($stateParams.card_id)\n                .then(function (data) {\n                    if(data.success){\n                        vm.poid = data.poid;\n                        vm.poid.expiry_date = new Date(vm.poid.expiry_date);\n\n                        \n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n\n            break;\n            case \"list\":\n\n                //console.log(\"LIST ALL\");\n\n                 //list stuff\n\n                PaymentService.GetByUserId(vm.user_id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        vm.cards = data.cards;\n                        //console.log(\"CARDS\", vm.cards);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n        \n\n\n    }\napp.controller('ClubSignupController', ClubSignupController);\n\n    ClubSignupController.$inject = ['ClubService', 'MemberService', 'UserService', 'GoCardService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$cookies', '$http', 'ToastService' ];\n    function ClubSignupController(ClubService, MemberService, UserService, GoCardService, $rootScope, $location, $scope, $state, $stateParams, $cookies, $http, ToastService) {\n        \n\n    \t\tvar vm = this;\n\n\n    \t\t$scope.companies = [];\n\n    \t\t$scope.selected_company;\n\n    \t\t$scope.selected_phone;\n\n    \t\t\n\n    \t\t$scope.verified_mobile = false;\n    \t\t$scope.text_verification = \"\";\n\n    \t\tvm.check_id = 12;\n\n    \t\t$scope.link = \"\";\n\n    \t\t//country code for text messages\n\n    \t\t$scope.prefix = \"\";\n\n\n    \t\t$scope.countries = [\n {\n   \"CountryCode\": \"+247\",\n   \"CountryCodeISO\": \"SH\",\n   \"Country\": \"Ascension\"\n },\n {\n   \"CountryCode\": \"+246\",\n   \"CountryCodeISO\": \"DG\",\n   \"Country\": \"Diego Garcia\"\n },\n {\n   \"CountryCode\": \"+291\",\n   \"CountryCodeISO\": \"ER\",\n   \"Country\": \"Eritrea\"\n },\n {\n   \"CountryCode\": \"+500\",\n   \"CountryCodeISO\": \"FK\",\n   \"Country\": \"Falkland (Malvinas) Islands\"\n },\n {\n   \"CountryCode\": \"+692\",\n   \"CountryCodeISO\": \"MH\",\n   \"Country\": \"Marshall Islands\"\n },\n {\n   \"CountryCode\": \"+691\",\n   \"CountryCodeISO\": \"FM\",\n   \"Country\": \"Micronesia\"\n },\n {\n   \"CountryCode\": \"+683\",\n   \"CountryCodeISO\": \"NU\",\n   \"Country\": \"Niue Island\"\n },\n {\n   \"CountryCode\": \"+290\",\n   \"CountryCodeISO\": \"SH\",\n   \"Country\": \"Saint Helena\"\n },\n {\n   \"CountryCode\": \"+508\",\n   \"CountryCodeISO\": \"PM\",\n   \"Country\": \"Saint Pierre and Miquelon\"\n },\n {\n   \"CountryCode\": \"+690\",\n   \"CountryCodeISO\": \"TK\",\n   \"Country\": \"Tokelau\"\n },\n {\n   \"CountryCode\": \"+688\",\n   \"CountryCodeISO\": \"TV\",\n   \"Country\": \"Tuvalu\"\n },\n {\n   \"CountryCode\": \"+379\",\n   \"CountryCodeISO\": \"VA\",\n   \"Country\": \"Vatican City\"\n },\n {\n   \"CountryCode\": \"+681\",\n   \"CountryCodeISO\": \"WF\",\n   \"Country\": \"Wallis and Futuna\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"AS\",\n   \"Country\": \"American Samoa\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"CA\",\n   \"Country\": \"Canada\"\n },\n {\n   \"CountryCode\": \"+61\",\n   \"CountryCodeISO\": \"AU\",\n   \"Country\": \"Australia\"\n },\n {\n   \"CountryCode\": \"+93\",\n   \"CountryCodeISO\": \"AF\",\n   \"Country\": \"Afghanistan\"\n },\n {\n   \"CountryCode\": \"+355\",\n   \"CountryCodeISO\": \"AL\",\n   \"Country\": \"Albania\"\n },\n {\n   \"CountryCode\": \"+213\",\n   \"CountryCodeISO\": \"DZ\",\n   \"Country\": \"Algeria\"\n },\n {\n   \"CountryCode\": \"+376\",\n   \"CountryCodeISO\": \"AD\",\n   \"Country\": \"Andorra\"\n },\n {\n   \"CountryCode\": \"+244\",\n   \"CountryCodeISO\": \"AO\",\n   \"Country\": \"Angola\"\n },\n {\n   \"CountryCode\": \"+54\",\n   \"CountryCodeISO\": \"AR\",\n   \"Country\": \"Argentina\"\n },\n {\n   \"CountryCode\": \"+374\",\n   \"CountryCodeISO\": \"AM\",\n   \"Country\": \"Armenia\"\n },\n {\n   \"CountryCode\": \"+297\",\n   \"CountryCodeISO\": \"AW\",\n   \"Country\": \"Aruba\"\n },\n {\n   \"CountryCode\": \"+43\",\n   \"CountryCodeISO\": \"AT\",\n   \"Country\": \"Austria\"\n },\n {\n   \"CountryCode\": \"+994\",\n   \"CountryCodeISO\": \"AZ\",\n   \"Country\": \"Azerbaijan\"\n },\n {\n   \"CountryCode\": \"+973\",\n   \"CountryCodeISO\": \"BH\",\n   \"Country\": \"Bahrain\"\n },\n {\n   \"CountryCode\": \"+880\",\n   \"CountryCodeISO\": \"BD\",\n   \"Country\": \"Bangladesh\"\n },\n {\n   \"CountryCode\": \"+375\",\n   \"CountryCodeISO\": \"BY\",\n   \"Country\": \"Belarus\"\n },\n {\n   \"CountryCode\": \"+32\",\n   \"CountryCodeISO\": \"BE\",\n   \"Country\": \"Belgium\"\n },\n {\n   \"CountryCode\": \"+501\",\n   \"CountryCodeISO\": \"BZ\",\n   \"Country\": \"Belize\"\n },\n {\n   \"CountryCode\": \"+229\",\n   \"CountryCodeISO\": \"BJ\",\n   \"Country\": \"Benin\"\n },\n {\n   \"CountryCode\": \"+975\",\n   \"CountryCodeISO\": \"BT\",\n   \"Country\": \"Bhutan\"\n },\n {\n   \"CountryCode\": \"+591\",\n   \"CountryCodeISO\": \"BO\",\n   \"Country\": \"Bolivia\"\n },\n {\n   \"CountryCode\": \"+387\",\n   \"CountryCodeISO\": \"BA\",\n   \"Country\": \"Bosnia and Herzegovina\"\n },\n {\n   \"CountryCode\": \"+267\",\n   \"CountryCodeISO\": \"BW\",\n   \"Country\": \"Botswana\"\n },\n {\n   \"CountryCode\": \"+55\",\n   \"CountryCodeISO\": \"BR\",\n   \"Country\": \"Brazil\"\n },\n {\n   \"CountryCode\": \"+673\",\n   \"CountryCodeISO\": \"BN\",\n   \"Country\": \"Brunei\"\n },\n {\n   \"CountryCode\": \"+359\",\n   \"CountryCodeISO\": \"BG\",\n   \"Country\": \"Bulgaria\"\n },\n {\n   \"CountryCode\": \"+226\",\n   \"CountryCodeISO\": \"BF\",\n   \"Country\": \"Burkina Faso\"\n },\n {\n   \"CountryCode\": \"+257\",\n   \"CountryCodeISO\": \"BI\",\n   \"Country\": \"Burundi\"\n },\n {\n   \"CountryCode\": \"+855\",\n   \"CountryCodeISO\": \"KH\",\n   \"Country\": \"Cambodia\"\n },\n {\n   \"CountryCode\": \"+237\",\n   \"CountryCodeISO\": \"CM\",\n   \"Country\": \"Cameroon\"\n },\n {\n   \"CountryCode\": \"+238\",\n   \"CountryCodeISO\": \"CV\",\n   \"Country\": \"Cape Verde\"\n },\n {\n   \"CountryCode\": \"+236\",\n   \"CountryCodeISO\": \"CF\",\n   \"Country\": \"Central African Republic\"\n },\n {\n   \"CountryCode\": \"+235\",\n   \"CountryCodeISO\": \"TD\",\n   \"Country\": \"Chad\"\n },\n {\n   \"CountryCode\": \"+56\",\n   \"CountryCodeISO\": \"CL\",\n   \"Country\": \"Chile\"\n },\n {\n   \"CountryCode\": \"+86\",\n   \"CountryCodeISO\": \"CN\",\n   \"Country\": \"China\"\n },\n {\n   \"CountryCode\": \"+57\",\n   \"CountryCodeISO\": \"CO\",\n   \"Country\": \"Colombia\"\n },\n {\n   \"CountryCode\": \"+269\",\n   \"CountryCodeISO\": \"KM\",\n   \"Country\": \"Comoros\"\n },\n {\n   \"CountryCode\": \"+242\",\n   \"CountryCodeISO\": \"CG\",\n   \"Country\": \"Congo\"\n },\n {\n   \"CountryCode\": \"+682\",\n   \"CountryCodeISO\": \"CK\",\n   \"Country\": \"Cook Islands\"\n },\n {\n   \"CountryCode\": \"+506\",\n   \"CountryCodeISO\": \"CR\",\n   \"Country\": \"Costa Rica\"\n },\n {\n   \"CountryCode\": \"+385\",\n   \"CountryCodeISO\": \"HR\",\n   \"Country\": \"Croatia\"\n },\n {\n   \"CountryCode\": \"+53\",\n   \"CountryCodeISO\": \"CU\",\n   \"Country\": \"Cuba\"\n },\n {\n   \"CountryCode\": \"+357\",\n   \"CountryCodeISO\": \"CY\",\n   \"Country\": \"Cyprus\"\n },\n {\n   \"CountryCode\": \"+420\",\n   \"CountryCodeISO\": \"CZ\",\n   \"Country\": \"Czech Republic\"\n },\n {\n   \"CountryCode\": \"+243\",\n   \"CountryCodeISO\": \"CD\",\n   \"Country\": \"Democratic Republic of Congo\"\n },\n {\n   \"CountryCode\": \"+45\",\n   \"CountryCodeISO\": \"DK\",\n   \"Country\": \"Denmark\"\n },\n {\n   \"CountryCode\": \"+253\",\n   \"CountryCodeISO\": \"DJ\",\n   \"Country\": \"Djibouti\"\n },\n {\n   \"CountryCode\": \"+670\",\n   \"CountryCodeISO\": \"TL\",\n   \"Country\": \"East Timor\"\n },\n {\n   \"CountryCode\": \"+593\",\n   \"CountryCodeISO\": \"EC\",\n   \"Country\": \"Ecuador\"\n },\n {\n   \"CountryCode\": \"+20\",\n   \"CountryCodeISO\": \"EG\",\n   \"Country\": \"Egypt\"\n },\n {\n   \"CountryCode\": \"+503\",\n   \"CountryCodeISO\": \"SV\",\n   \"Country\": \"El Salvador\"\n },\n {\n   \"CountryCode\": \"+240\",\n   \"CountryCodeISO\": \"GQ\",\n   \"Country\": \"Equatorial Guinea\"\n },\n {\n   \"CountryCode\": \"+372\",\n   \"CountryCodeISO\": \"EE\",\n   \"Country\": \"Estonia\"\n },\n {\n   \"CountryCode\": \"+251\",\n   \"CountryCodeISO\": \"ET\",\n   \"Country\": \"Ethiopia\"\n },\n {\n   \"CountryCode\": \"+298\",\n   \"CountryCodeISO\": \"FO\",\n   \"Country\": \"Faroe Islands\"\n },\n {\n   \"CountryCode\": \"+679\",\n   \"CountryCodeISO\": \"FJ\",\n   \"Country\": \"Fiji\"\n },\n {\n   \"CountryCode\": \"+358\",\n   \"CountryCodeISO\": \"FI\",\n   \"Country\": \"Finland\"\n },\n {\n   \"CountryCode\": \"+33\",\n   \"CountryCodeISO\": \"FR\",\n   \"Country\": \"France\"\n },\n {\n   \"CountryCode\": \"+594\",\n   \"CountryCodeISO\": \"GF\",\n   \"Country\": \"French Guiana\"\n },\n {\n   \"CountryCode\": \"+689\",\n   \"CountryCodeISO\": \"PF\",\n   \"Country\": \"French Polynesia\"\n },\n {\n   \"CountryCode\": \"+241\",\n   \"CountryCodeISO\": \"GA\",\n   \"Country\": \"Gabon\"\n },\n {\n   \"CountryCode\": \"+220\",\n   \"CountryCodeISO\": \"GM\",\n   \"Country\": \"Gambia\"\n },\n {\n   \"CountryCode\": \"+995\",\n   \"CountryCodeISO\": \"GE\",\n   \"Country\": \"Georgia\"\n },\n {\n   \"CountryCode\": \"+49\",\n   \"CountryCodeISO\": \"DE\",\n   \"Country\": \"Germany\"\n },\n {\n   \"CountryCode\": \"+233\",\n   \"CountryCodeISO\": \"GH\",\n   \"Country\": \"Ghana\"\n },\n {\n   \"CountryCode\": \"+350\",\n   \"CountryCodeISO\": \"GI\",\n   \"Country\": \"Gibraltar\"\n },\n {\n   \"CountryCode\": \"+30\",\n   \"CountryCodeISO\": \"GR\",\n   \"Country\": \"Greece\"\n },\n {\n   \"CountryCode\": \"+299\",\n   \"CountryCodeISO\": \"GL\",\n   \"Country\": \"Greenland\"\n },\n {\n   \"CountryCode\": \"+590\",\n   \"CountryCodeISO\": \"GP\",\n   \"Country\": \"Guadeloupe\"\n },\n {\n   \"CountryCode\": \"+502\",\n   \"CountryCodeISO\": \"GT\",\n   \"Country\": \"Guatemala\"\n },\n {\n   \"CountryCode\": \"+224\",\n   \"CountryCodeISO\": \"GN\",\n   \"Country\": \"Guinea\"\n },\n {\n   \"CountryCode\": \"+245\",\n   \"CountryCodeISO\": \"GW\",\n   \"Country\": \"Guinea-Bissau\"\n },\n {\n   \"CountryCode\": \"+592\",\n   \"CountryCodeISO\": \"GY\",\n   \"Country\": \"Guyana\"\n },\n {\n   \"CountryCode\": \"+509\",\n   \"CountryCodeISO\": \"HT\",\n   \"Country\": \"Haiti\"\n },\n {\n   \"CountryCode\": \"+504\",\n   \"CountryCodeISO\": \"HN\",\n   \"Country\": \"Honduras\"\n },\n {\n   \"CountryCode\": \"+852\",\n   \"CountryCodeISO\": \"HK\",\n   \"Country\": \"Hong Kong\"\n },\n {\n   \"CountryCode\": \"+36\",\n   \"CountryCodeISO\": \"HU\",\n   \"Country\": \"Hungary\"\n },\n {\n   \"CountryCode\": \"+354\",\n   \"CountryCodeISO\": \"IS\",\n   \"Country\": \"Iceland\"\n },\n {\n   \"CountryCode\": \"+91\",\n   \"CountryCodeISO\": \"IN\",\n   \"Country\": \"India\"\n },\n {\n   \"CountryCode\": \"+62\",\n   \"CountryCodeISO\": \"ID\",\n   \"Country\": \"Indonesia\"\n },\n {\n   \"CountryCode\": \"+98\",\n   \"CountryCodeISO\": \"IR\",\n   \"Country\": \"Iran\"\n },\n {\n   \"CountryCode\": \"+964\",\n   \"CountryCodeISO\": \"IQ\",\n   \"Country\": \"Iraq\"\n },\n {\n   \"CountryCode\": \"+353\",\n   \"CountryCodeISO\": \"IE\",\n   \"Country\": \"Ireland\"\n },\n {\n   \"CountryCode\": \"+972\",\n   \"CountryCodeISO\": \"IL\",\n   \"Country\": \"Israel\"\n },\n {\n   \"CountryCode\": \"+39\",\n   \"CountryCodeISO\": \"IT\",\n   \"Country\": \"Italy\"\n },\n {\n   \"CountryCode\": \"+225\",\n   \"CountryCodeISO\": \"CI\",\n   \"Country\": \"Ivory Coast\"\n },\n {\n   \"CountryCode\": \"+81\",\n   \"CountryCodeISO\": \"JP\",\n   \"Country\": \"Japan\"\n },\n {\n   \"CountryCode\": \"+962\",\n   \"CountryCodeISO\": \"JO\",\n   \"Country\": \"Jordan\"\n },\n {\n   \"CountryCode\": \"+254\",\n   \"CountryCodeISO\": \"KE\",\n   \"Country\": \"Kenya\"\n },\n {\n   \"CountryCode\": \"+686\",\n   \"CountryCodeISO\": \"KI\",\n   \"Country\": \"Kiribati\"\n },\n {\n   \"CountryCode\": \"+965\",\n   \"CountryCodeISO\": \"KW\",\n   \"Country\": \"Kuwait\"\n },\n {\n   \"CountryCode\": \"+996\",\n   \"CountryCodeISO\": \"KG\",\n   \"Country\": \"Kyrgyzstan\"\n },\n {\n   \"CountryCode\": \"+856\",\n   \"CountryCodeISO\": \"LA\",\n   \"Country\": \"Laos\"\n },\n {\n   \"CountryCode\": \"+371\",\n   \"CountryCodeISO\": \"LV\",\n   \"Country\": \"Latvia\"\n },\n {\n   \"CountryCode\": \"+961\",\n   \"CountryCodeISO\": \"LB\",\n   \"Country\": \"Lebanon\"\n },\n {\n   \"CountryCode\": \"+266\",\n   \"CountryCodeISO\": \"LS\",\n   \"Country\": \"Lesotho\"\n },\n {\n   \"CountryCode\": \"+231\",\n   \"CountryCodeISO\": \"LR\",\n   \"Country\": \"Liberia\"\n },\n {\n   \"CountryCode\": \"+218\",\n   \"CountryCodeISO\": \"LY\",\n   \"Country\": \"Libya\"\n },\n {\n   \"CountryCode\": \"+423\",\n   \"CountryCodeISO\": \"LI\",\n   \"Country\": \"Liechtenstein\"\n },\n {\n   \"CountryCode\": \"+370\",\n   \"CountryCodeISO\": \"LT\",\n   \"Country\": \"Lithuania\"\n },\n {\n   \"CountryCode\": \"+352\",\n   \"CountryCodeISO\": \"LU\",\n   \"Country\": \"Luxembourg\"\n },\n {\n   \"CountryCode\": \"+853\",\n   \"CountryCodeISO\": \"MO\",\n   \"Country\": \"Macau\"\n },\n {\n   \"CountryCode\": \"+389\",\n   \"CountryCodeISO\": \"MK\",\n   \"Country\": \"Macedonia\"\n },\n {\n   \"CountryCode\": \"+261\",\n   \"CountryCodeISO\": \"MG\",\n   \"Country\": \"Madagascar\"\n },\n {\n   \"CountryCode\": \"+265\",\n   \"CountryCodeISO\": \"MW\",\n   \"Country\": \"Malawi\"\n },\n {\n   \"CountryCode\": \"+60\",\n   \"CountryCodeISO\": \"MY\",\n   \"Country\": \"Malaysia\"\n },\n {\n   \"CountryCode\": \"+960\",\n   \"CountryCodeISO\": \"MV\",\n   \"Country\": \"Maldives\"\n },\n {\n   \"CountryCode\": \"+223\",\n   \"CountryCodeISO\": \"ML\",\n   \"Country\": \"Mali\"\n },\n {\n   \"CountryCode\": \"+356\",\n   \"CountryCodeISO\": \"MT\",\n   \"Country\": \"Malta\"\n },\n {\n   \"CountryCode\": \"+596\",\n   \"CountryCodeISO\": \"MQ\",\n   \"Country\": \"Martinique\"\n },\n {\n   \"CountryCode\": \"+222\",\n   \"CountryCodeISO\": \"MR\",\n   \"Country\": \"Mauritania\"\n },\n {\n   \"CountryCode\": \"+230\",\n   \"CountryCodeISO\": \"MU\",\n   \"Country\": \"Mauritius\"\n },\n {\n   \"CountryCode\": \"+262\",\n   \"CountryCodeISO\": \"RE\",\n   \"Country\": \"Reunion\"\n },\n {\n   \"CountryCode\": \"+52\",\n   \"CountryCodeISO\": \"MX\",\n   \"Country\": \"Mexico\"\n },\n {\n   \"CountryCode\": \"+373\",\n   \"CountryCodeISO\": \"MD\",\n   \"Country\": \"Moldova\"\n },\n {\n   \"CountryCode\": \"+377\",\n   \"CountryCodeISO\": \"MC\",\n   \"Country\": \"Monaco\"\n },\n {\n   \"CountryCode\": \"+976\",\n   \"CountryCodeISO\": \"MN\",\n   \"Country\": \"Mongolia\"\n },\n {\n   \"CountryCode\": \"+382\",\n   \"CountryCodeISO\": \"ME\",\n   \"Country\": \"Montenegro\"\n },\n {\n   \"CountryCode\": \"+212\",\n   \"CountryCodeISO\": \"MA\",\n   \"Country\": \"Morocco\"\n },\n {\n   \"CountryCode\": \"+258\",\n   \"CountryCodeISO\": \"MZ\",\n   \"Country\": \"Mozambique\"\n },\n {\n   \"CountryCode\": \"+95\",\n   \"CountryCodeISO\": \"MM\",\n   \"Country\": \"Myanmar\"\n },\n {\n   \"CountryCode\": \"+264\",\n   \"CountryCodeISO\": \"NA\",\n   \"Country\": \"Namibia\"\n },\n {\n   \"CountryCode\": \"+674\",\n   \"CountryCodeISO\": \"NR\",\n   \"Country\": \"Nauru\"\n },\n {\n   \"CountryCode\": \"+977\",\n   \"CountryCodeISO\": \"NP\",\n   \"Country\": \"Nepal\"\n },\n {\n   \"CountryCode\": \"+31\",\n   \"CountryCodeISO\": \"NL\",\n   \"Country\": \"Netherlands\"\n },\n {\n   \"CountryCode\": \"+599\",\n   \"CountryCodeISO\": \"AN\",\n   \"Country\": \"Netherlands Antilles\"\n },\n {\n   \"CountryCode\": \"+687\",\n   \"CountryCodeISO\": \"NC\",\n   \"Country\": \"New Caledonia\"\n },\n {\n   \"CountryCode\": \"+64\",\n   \"CountryCodeISO\": \"NZ\",\n   \"Country\": \"New Zealand\"\n },\n {\n   \"CountryCode\": \"+505\",\n   \"CountryCodeISO\": \"NI\",\n   \"Country\": \"Nicaragua\"\n },\n {\n   \"CountryCode\": \"+227\",\n   \"CountryCodeISO\": \"NE\",\n   \"Country\": \"Niger\"\n },\n {\n   \"CountryCode\": \"+234\",\n   \"CountryCodeISO\": \"NG\",\n   \"Country\": \"Nigeria\"\n },\n {\n   \"CountryCode\": \"+850\",\n   \"CountryCodeISO\": \"KP\",\n   \"Country\": \"North Korea\"\n },\n {\n   \"CountryCode\": \"+47\",\n   \"CountryCodeISO\": \"NO\",\n   \"Country\": \"Norway\"\n },\n {\n   \"CountryCode\": \"+968\",\n   \"CountryCodeISO\": \"OM\",\n   \"Country\": \"Oman\"\n },\n {\n   \"CountryCode\": \"+92\",\n   \"CountryCodeISO\": \"PK\",\n   \"Country\": \"Pakistan\"\n },\n {\n   \"CountryCode\": \"+680\",\n   \"CountryCodeISO\": \"PW\",\n   \"Country\": \"Palau\"\n },\n {\n   \"CountryCode\": \"+507\",\n   \"CountryCodeISO\": \"PA\",\n   \"Country\": \"Panama\"\n },\n {\n   \"CountryCode\": \"+675\",\n   \"CountryCodeISO\": \"PG\",\n   \"Country\": \"Papua New Guinea\"\n },\n {\n   \"CountryCode\": \"+595\",\n   \"CountryCodeISO\": \"PY\",\n   \"Country\": \"Paraguay\"\n },\n {\n   \"CountryCode\": \"+51\",\n   \"CountryCodeISO\": \"PE\",\n   \"Country\": \"Peru\"\n },\n {\n   \"CountryCode\": \"+63\",\n   \"CountryCodeISO\": \"PH\",\n   \"Country\": \"Philippines\"\n },\n {\n   \"CountryCode\": \"+48\",\n   \"CountryCodeISO\": \"PL\",\n   \"Country\": \"Poland\"\n },\n {\n   \"CountryCode\": \"+351\",\n   \"CountryCodeISO\": \"PT\",\n   \"Country\": \"Portugal\"\n },\n {\n   \"CountryCode\": \"+974\",\n   \"CountryCodeISO\": \"QA\",\n   \"Country\": \"Qatar\"\n },\n {\n   \"CountryCode\": \"+40\",\n   \"CountryCodeISO\": \"RO\",\n   \"Country\": \"Romania\"\n },\n {\n   \"CountryCode\": \"+7\",\n   \"CountryCodeISO\": \"KZ\",\n   \"Country\": \"Kazakhstan\"\n },\n {\n   \"CountryCode\": \"+250\",\n   \"CountryCodeISO\": \"RW\",\n   \"Country\": \"Rwanda\"\n },\n {\n   \"CountryCode\": \"+685\",\n   \"CountryCodeISO\": \"WS\",\n   \"Country\": \"Samoa\"\n },\n {\n   \"CountryCode\": \"+378\",\n   \"CountryCodeISO\": \"SM\",\n   \"Country\": \"San Marino\"\n },\n {\n   \"CountryCode\": \"+239\",\n   \"CountryCodeISO\": \"ST\",\n   \"Country\": \"Sao Tome and Principe\"\n },\n {\n   \"CountryCode\": \"+966\",\n   \"CountryCodeISO\": \"SA\",\n   \"Country\": \"Saudi Arabia\"\n },\n {\n   \"CountryCode\": \"+221\",\n   \"CountryCodeISO\": \"SN\",\n   \"Country\": \"Senegal\"\n },\n {\n   \"CountryCode\": \"+381\",\n   \"CountryCodeISO\": \"RS\",\n   \"Country\": \"Serbia\"\n },\n {\n   \"CountryCode\": \"+248\",\n   \"CountryCodeISO\": \"SC\",\n   \"Country\": \"Seychelles\"\n },\n {\n   \"CountryCode\": \"+232\",\n   \"CountryCodeISO\": \"SL\",\n   \"Country\": \"Sierra Leone\"\n },\n {\n   \"CountryCode\": \"+65\",\n   \"CountryCodeISO\": \"SG\",\n   \"Country\": \"Singapore\"\n },\n {\n   \"CountryCode\": \"+421\",\n   \"CountryCodeISO\": \"SK\",\n   \"Country\": \"Slovakia\"\n },\n {\n   \"CountryCode\": \"+386\",\n   \"CountryCodeISO\": \"SI\",\n   \"Country\": \"Slovenia\"\n },\n {\n   \"CountryCode\": \"+677\",\n   \"CountryCodeISO\": \"SB\",\n   \"Country\": \"Solomon Islands\"\n },\n {\n   \"CountryCode\": \"+252\",\n   \"CountryCodeISO\": \"SO\",\n   \"Country\": \"Somalia\"\n },\n {\n   \"CountryCode\": \"+27\",\n   \"CountryCodeISO\": \"ZA\",\n   \"Country\": \"South Africa\"\n },\n {\n   \"CountryCode\": \"+82\",\n   \"CountryCodeISO\": \"KR\",\n   \"Country\": \"South Korea\"\n },\n {\n   \"CountryCode\": \"+34\",\n   \"CountryCodeISO\": \"ES\",\n   \"Country\": \"Spain\"\n },\n {\n   \"CountryCode\": \"+94\",\n   \"CountryCodeISO\": \"LK\",\n   \"Country\": \"Sri Lanka\"\n },\n {\n   \"CountryCode\": \"+249\",\n   \"CountryCodeISO\": \"SD\",\n   \"Country\": \"Sudan\"\n },\n {\n   \"CountryCode\": \"+597\",\n   \"CountryCodeISO\": \"SR\",\n   \"Country\": \"Suriname\"\n },\n {\n   \"CountryCode\": \"+268\",\n   \"CountryCodeISO\": \"SZ\",\n   \"Country\": \"Swaziland\"\n },\n {\n   \"CountryCode\": \"+46\",\n   \"CountryCodeISO\": \"SE\",\n   \"Country\": \"Sweden\"\n },\n {\n   \"CountryCode\": \"+41\",\n   \"CountryCodeISO\": \"CH\",\n   \"Country\": \"Switzerland\"\n },\n {\n   \"CountryCode\": \"+963\",\n   \"CountryCodeISO\": \"SY\",\n   \"Country\": \"Syria\"\n },\n {\n   \"CountryCode\": \"+886\",\n   \"CountryCodeISO\": \"TW\",\n   \"Country\": \"Taiwan\"\n },\n {\n   \"CountryCode\": \"+992\",\n   \"CountryCodeISO\": \"TJ\",\n   \"Country\": \"Tajikistan\"\n },\n {\n   \"CountryCode\": \"+255\",\n   \"CountryCodeISO\": \"TZ\",\n   \"Country\": \"Tanzania\"\n },\n {\n   \"CountryCode\": \"+66\",\n   \"CountryCodeISO\": \"TH\",\n   \"Country\": \"Thailand\"\n },\n {\n   \"CountryCode\": \"+228\",\n   \"CountryCodeISO\": \"TG\",\n   \"Country\": \"Togo\"\n },\n {\n   \"CountryCode\": \"+216\",\n   \"CountryCodeISO\": \"TN\",\n   \"Country\": \"Tunisia\"\n },\n {\n   \"CountryCode\": \"+90\",\n   \"CountryCodeISO\": \"TR\",\n   \"Country\": \"Turkey\"\n },\n {\n   \"CountryCode\": \"+993\",\n   \"CountryCodeISO\": \"TM\",\n   \"Country\": \"Turkmenistan\"\n },\n {\n   \"CountryCode\": \"+256\",\n   \"CountryCodeISO\": \"UG\",\n   \"Country\": \"Uganda\"\n },\n {\n   \"CountryCode\": \"+380\",\n   \"CountryCodeISO\": \"UA\",\n   \"Country\": \"Ukraine\"\n },\n {\n   \"CountryCode\": \"+971\",\n   \"CountryCodeISO\": \"AE\",\n   \"Country\": \"United Arab Emirates\"\n },\n {\n   \"CountryCode\": \"+44\",\n   \"CountryCodeISO\": \"GB\",\n   \"Country\": \"United Kingdom\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"VI\",\n   \"Country\": \"U.S. Virgin Islands\"\n },\n {\n   \"CountryCode\": \"+598\",\n   \"CountryCodeISO\": \"UY\",\n   \"Country\": \"Uruguay\"\n },\n {\n   \"CountryCode\": \"+998\",\n   \"CountryCodeISO\": \"UZ\",\n   \"Country\": \"Uzbekistan\"\n },\n {\n   \"CountryCode\": \"+678\",\n   \"CountryCodeISO\": \"VU\",\n   \"Country\": \"Vanuatu\"\n },\n {\n   \"CountryCode\": \"+58\",\n   \"CountryCodeISO\": \"VE\",\n   \"Country\": \"Venezuela\"\n },\n {\n   \"CountryCode\": \"+84\",\n   \"CountryCodeISO\": \"VN\",\n   \"Country\": \"Vietnam\"\n },\n {\n   \"CountryCode\": \"+967\",\n   \"CountryCodeISO\": \"YE\",\n   \"Country\": \"Yemen\"\n },\n {\n   \"CountryCode\": \"+260\",\n   \"CountryCodeISO\": \"ZM\",\n   \"Country\": \"Zambia\"\n },\n {\n   \"CountryCode\": \"+263\",\n   \"CountryCodeISO\": \"ZW\",\n   \"Country\": \"Zimbabwe\"\n },\n {\n   \"CountryCode\": \"+262\",\n   \"CountryCodeISO\": \"YT\",\n   \"Country\": \"Mayotte\"\n },\n {\n   \"CountryCode\": \"+7\",\n   \"CountryCodeISO\": \"RU\",\n   \"Country\": \"Russian Federation\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"AI\",\n   \"Country\": \"Anguilla\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"AG\",\n   \"Country\": \"Antigua and Barbuda\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"BS\",\n   \"Country\": \"Bahamas\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"BB\",\n   \"Country\": \"Barbados\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"BM\",\n   \"Country\": \"Bermuda\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"VG\",\n   \"Country\": \"British Virgin Islands\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"KY\",\n   \"Country\": \"Cayman Islands\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"DM\",\n   \"Country\": \"Dominica\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"DO\",\n   \"Country\": \"Dominican Republic\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"GD\",\n   \"Country\": \"Grenada\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"GU\",\n   \"Country\": \"Guam\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"JM\",\n   \"Country\": \"Jamaica\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"MS\",\n   \"Country\": \"Montserrat\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"MP\",\n   \"Country\": \"Northern Marianas\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"PR\",\n   \"Country\": \"Puerto Rico\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"KN\",\n   \"Country\": \"Saint Kitts and Nevis\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"LC\",\n   \"Country\": \"Saint Lucia\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"VC\",\n   \"Country\": \"Saint Vincent and the Grenadines\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"TT\",\n   \"Country\": \"Trinidad and Tobago\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"TC\",\n   \"Country\": \"Turks and Caicos Islands\"\n },\n {\n   \"CountryCode\": \"+676\",\n   \"CountryCodeISO\": \"TO\",\n   \"Country\": \"Tonga\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"US\",\n   \"Country\": \"United States of America\"\n },\n {\n   \"CountryCode\": \"+970\",\n   \"CountryCodeISO\": \"PS\",\n   \"Country\": \"Palestine\"\n },\n {\n   \"CountryCode\": \"+211\",\n   \"CountryCodeISO\": \"SS\",\n   \"Country\": \"South Sudan\"\n },\n {\n   \"CountryCode\": \"+44\",\n   \"CountryCodeISO\": \"IM\",\n   \"Country\": \"Isle of Man\"\n }\n];\n\n\n    \t\t\n\n\n    \t\tvar loc = $location.path().split(\"/\");\n\n    \t\tif(loc[loc.length -3] == \"verified\"){\n    \t\t\n\t    \t\tvar last = loc[loc.length -1];\n\t    \t\tvar pre = loc[loc.length -2];\n\n\t            //console.log(\"THIS IS A VERIFY TOKEN VERIFICATION\", pre);\n\n\t    \t\tif(last && pre){\n\n\t\t            //console.log(\"THIS IS A VERIFY TOKEN VERIFICATION\", last);\n\n\t\t             UserService.Verify(last, pre)\n\t\t                .then(function (response) {\n\t\t                    if (response.success) {\n\t\t                    \t//alert(\"verified\");\n\n\t\t                    \t//lets create a temp create cookie here...\n\n\t\t                        // vm.title = \"Thank You!\";\n\t\t                        // vm.verify_status = \"Your email address has been verified.\";\n\t\t                    } else {\n\t\t                    \tToastService.error('Verification Failed', 'Sorry - your verification link seems to be incorrect.')\n\t\t                        // vm.title = \"Sorry!\";\n\t\t                        // vm.verify_status = \"Sorry - something went wrong here! Please try clicking the link your email again. Should this still be a problem, please contact support.\";\n\t\t                    }\n\t\t                });\n\n\t\t        }            \n    \t\t}\n\n\n    \t\tif(loc[loc.length -1].split(\"?\")[0] == \"payment_setup_confirmation\"){\n\n    \t\t\t// //console.log(\"PARAMS1231\", $location.search());\n\t    \t\t// //console.log(\"PARAMSCODE123\", $location.search().code);\n\n\t    \t\tvar mid = $cookies.get('mid');\n\t    \t\tvar bid = $cookies.get('bid');\n\n\t    \t\t// //console.log(\"PARAMS123123\", mid);\n\n\t    \t\t GoCardService.SetupGoCard({mid: mid, bid: bid, code: $location.search().code})\n\t\t                .then(function (response) {\n\t\t                \t//console.log(\"response\", response);\n\t\t                    if (response.success) {\n\t\t                    \t//alert(\"verified\");\n\t\t                    \t\n\t\t                    \t//SetupGoCard\n\n\t\t                        // vm.title = \"Thank You!\";\n\t\t                        // vm.verify_status = \"Your email address has been verified.\";\n\t\t                    } else {\n\t\t                    \tToastService.error('Setup Failed', 'Sorry - we were unable to setup your connection to our payment provider GoCardless.')\n\t\t                        // vm.title = \"Sorry!\";\n\t\t                        // vm.verify_status = \"Sorry - something went wrong here! Please try clicking the link your email again. Should this still be a problem, please contact support.\";\n\t\t                    }\n\t\t                });\n\n\n\n\n    \t\t}\n\n    \t\t$scope.go_to_login = function(){\n\t\t\t\t$state.go(\"login\");\n    \t\t}\n\n    \t\t\n\n    \t\t$scope.verify_mobile = function(text_verification){\n    \t\t\t//console.log(\"called\", vm.text_verification);\n\n    \t\t\tif(vm.text_verification.length == 4){\n    \t\t\t\t//then we check\n\n    \t\t\t\t// //console.log(\"4 chars\", vm.text_verification);\n    \t\t\t\t// //console.log(\"4 chars\", last);\n\n    \t\t\t\tMemberService.VerifyPhone(vm.text_verification, last)\n\t\t                .then(function (data) {\n\t\t                    // //console.log(data);\n\t\t                    if(data.success){\n\t\t                        //use GB airfields first...\n\t\t                        $scope.verified_mobile = true;\n\n\t\t                        $scope.link = data.link.url;\n\t\t                    \t$cookies.put('mid', last);\n\t\t                    \t$cookies.put('bid', data.bid);\n\n\n\n\n\t\t                    } else {\n\t\t                    \tToastService.error('Verification Failed', 'Your verification code is incorrect.');\n    \t\t\t\t\t\t\t$scope.verified_mobile = false;\n\t\t                    }\n\n\t\t                });\n\n    \t\t\t\t// if(text_verification == \"1234\"){\n\n    \t\t\t\t// \t$scope.verified_mobile = true;\n    \t\t\t\t// }\n\n    \t\t\t} else {\n    \t\t\t\t//do nothing\n    \t\t\t}\n\n    \t\t}\n\n\n\n    \t\t$scope.get_companies = function(name){\n\t\t         \n\t\t            if(name.length > 2){\n\n\t\t             MemberService.GetCompany(name)\n\t\t                .then(function (data) {\n\t\t                    //console.log(data);\n\t\t                    if(data.success){\n\t\t                        //use GB airfields first...\n\t\t                        $scope.companies = data.items;\n\n\t\t                    } else {\n\n\n\t\t                            //console.log(\"WOOOPSIES...\");\n\t\t                            //this should be very very rare...\n\t\t                        \n\t\t                        \n\t\t                   \n\t\t                    }\n\n\t\t                });\n\n\n\t\t            }\n\t\t        }\n\n\t\t        $scope.prefix_length = 0;\n\t\t        $scope.prefix = \"\";\n\n\t\t        $scope.set_prefix = function(){\n\n\t\t        \t//$scope.prefix = \n\n\t\t        \t// var current_phone = $scope.formData.user.phone;\n\t\t        \t// if($scope.prefix_length > 0){\n\t\t        \t// \tcurrent_phone = current_phone.substring($scope.prefix_length);\n\t\t        \t// }\n\t\t        \t// $scope.prefix_length = vm.selected_phone.CountryCode.length;\n\t\t        \t// $scope.prefix = vm.selected_phone.CountryCode + \"\" + current_phone;\n\n\t\t        }\n\n\t\t        $scope.set_company = function(){\n\t\t        \t\n\n\t\t        \t MemberService.GetCompanyDetail(vm.selected_company.company_number)\n\t\t                .then(function (data) {\n\t\t                    //console.log(data);\n\t\t                    if(data.success){\n\t\t                        //use GB airfields first...\n\t\t                        //console.log(\"detail\", data);\n\t\t                        $scope.company = data;\n\n\t\t                        sort_company_data(data);\n\n\n\n\n\t\t                    } else {\n\n\n\t\t                            //console.log(\"WOOOPSIES...\");\n\t\t                            //this should be very very rare...\n\t\t                        \n\t\t                        \n\t\t                   \n\t\t                    }\n\n\t\t                });\n\n\t\t        }\n\n         \t// we will store all of our form data in this object\n\t\t    $scope.formData = {\n\t\t    \tclub: {\n\t\t    \t\tis_company: true\n\t\t    \t},\n\t\t    \tuser: {\n\t\t    \t\tphone: \"\"\n\t\t    \t}\n\t\t    };\n\n\n\n\t\t    function sort_company_data(data){\n\n\t\t    \tvm.officers = data.officer;\n\t\t    \tvm.company_details = data.company;\n\n\t\t    \t//match the firstname and last name entered with a director of the company\n\t\t    \tvar user_is_named_on_company_selected = false;\n\n\t\t    \tvar fname = $scope.formData.user.first_name.toLowerCase();\n\t\t    \tvar lname = $scope.formData.user.last_name.toLowerCase();\n\t\t    \tvar matched = 0;\n\n\n\n\n\t\t    \tfor(var i=0; i<vm.officers.length;i++){\n\n\t\t    \t\tif(vm.officers[i].name.toLowerCase().indexOf(fname) > -1 && vm.officers[i].name.toLowerCase().indexOf(lname) > -1){\n\n\t\t    \t\t\tuser_is_named_on_company_selected = true;\n\t\t    \t\t\tmatched = i;\n\n\t\t    \t\t}\n\n\t\t    \t}\n\n\n\t\t    \tif(user_is_named_on_company_selected){\n\n\t\t    \t\tToastService.success('Match Found', 'We have matched you!');\n\n\t\t    \t\t//now that we have some basic setup then we can get into the nitty gritty of adding\n\t\t    \t\t$scope.formData.club = {};\n\n\t\t    \t\t$scope.formData.club.company_name = data.company.company_name;\n\t\t    \t\t$scope.formData.club.trading_as = data.company.company_name;\n\t\t    \t\t$scope.formData.club.title = data.company.company_name.replace(\"LTD\", \"\").replace(\"LIMITED\", \"\").replace(\"LLC\", \"\");\n\t\t    \t\t$scope.formData.club.company_number = data.company.company_number;\n\t\t    \t\t$scope.formData.club.date_of_creation = data.company.date_of_creation;\n\t\t    \t\t$scope.formData.club.address_line_1 = data.company.registered_office_address.address_line_1;\n\t\t    \t\t$scope.formData.club.address_line_2 = data.company.registered_office_address.address_line_2;\n\t\t    \t\t$scope.formData.club.city = data.company.registered_office_address.locality;\n\t\t    \t\t$scope.formData.club.post_code = data.company.registered_office_address.postal_code;\n\n\t\t    \t\t$scope.formData.user.dob_year = data.officer[matched].date_of_birth.year;\n\t\t    \t\t$scope.formData.user.dob_month = data.officer[matched].date_of_birth.month;\n\t\t    \t\t$scope.formData.user.role = data.officer[matched].officer_role;\n\t\t    \t\t$scope.formData.club.is_company = true;\n\t\t    \t\t\n\n\n\n\t\t    \t} else {\n\n\t\t    \t\tToastService.error('No Match', 'Unfortunately we cannot match your personal details with any of the company directors. Did you select the correct company from the drop-down list?');\n\n\t\t    \t}\n\n\n\n\n\n\n\t\t    }\n\n\t\t    $scope.setup_direct_debit = function(){\n\t\t    \t//console.log($scope.link);\n\t\t    \twindow.open($scope.link);\n\t\t    \t//window.location = $scope.link;\n\n\t\t    }\n\t\t    \n\t\t    $scope.checkValid = function(){\n\t\t    \tconsole.log(\"CLICK\");\n\t\t    \t//console.log($('#signup-form')[0].checkValidity());\n\n\n          //console.log(\"HERE WE GO?\");\n\n            //let's check the passwords match first...\n            if($scope.formData.user.password !== $scope.formData.user.password2){\n              $(\"input[type='password']\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n              ToastService.warning('Password Mismatch', 'Your passwords do not match');\n              return false;\n            }\n\n            //check the password length > 8 characters\n            var strongPassword = new RegExp('(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[^A-Za-z0-9])(?=.{8,})')\n            if(strongPassword.test($scope.formData.user.password)) {\n              //console.log(\"password strength OK\");\n            } else {\n              $(\"input[type='password']\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n              ToastService.warning('Weak Password', 'Your password must be at least 8 characters in length, contain 1 uppercase, 1 lowercase, 1 number, and 1 special character');\n              return false;\n            }\n\n\n\n\t\t    \tif(! $('#signup-form')[0].checkValidity()){\n\t\t    \t\t$(\".ng-pristine\").not(\".ng-valid\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n\t\t    \t\t$(\"input:checkbox:not(:checked)\").addClass(\"ng-checkbox-unchecked\");\n\t\t    \t\t//console.log(\"STOP\");\n\t\t    \t\treturn false;\n\t\t    \t} else {\n\t\t    \t\t//console.log(\"HERE\");\n\t\t    \t\t$(\"input:checkbox:not(:checked)\").removeClass(\"ng-checkbox-unchecked\");\n\t\t    \t\tif(!$scope.formData.user){\n\t\t    \t\t\t//console.log(\"missing first bit...\");\n\t\t\t\t    \t$state.go(\"club_signup.my_profile\");\n\t\t    \t\t\treturn false;\n\t\t    \t\t}\n\n\t\t    \t\tif(!vm.selected_phone.CountryCode){\n\t\t\t    \t\tToastService.warning('Country Code Required', 'Please select the country prefix of the mobile phone entered from the drop-down menu, this will ensure that the text messages we send will be sent to the correct telephone number.');\n\t\t\t    \t\treturn false;\n\t\t\t    \t}\n\t\t\t    \tvar mobile = $scope.formData.user.phone;\n\n\t\t\t    \tif($scope.formData.user.phone.slice(0,1) == 0){\n\t\t\t    \t\tToastService.warning('Phone Number', 'Your telephone number seems to start with a 0, as we will be using your international phone number, the first zero will be stripped automatically.');\n\t\t\t    \t\t$scope.formData.user.phone.phone = $scope.formData.user.phone.phone.substring(1);\n\t\t\t    \t}\n\n\t\t    \t\tif(!$scope.formData.club || !$scope.formData.club.title){\n\t\t    \t\t\t//console.log(\"missing second bit...\");\n\t\t\t\t    \t$state.go(\"club_signup.my_club\");\n\t\t    \t\t\treturn false;\n\t\t    \t\t}\n\t\t    \t\tif(!$scope.formData.tnc){\n\t\t    \t\t\t//console.log(\"missing third bit...\");\n\t\t\t\t    \t$state.go(\"club_signup.terms\");\n\t\t    \t\t\treturn false;\n\t\t    \t\t}\n\n            \n            \n\t\t    \t\tif($scope.formData.user.password == $scope.formData.user.password2){\n\t\t\t    \t\tvar next = $(\".btn-info\").attr(\"one-ui-sref\");\n\t\t\t    \t\t\t//console.log(\"NEXT\", next);\n\t\t\t    \t\tif(next == \"club_signup.verify\"){\n\t\t\t    \t\t\t//console.log(\"verifying account\");\n\t\t\t    \t\t\t$scope.processForm();\n\t\t\t    \t\t} else {\n\t\t\t\t    \t\t$state.go(next);\n\t\t\t    \t\t}\n\t\t    \t\t} else {\n\t\t\t    \t\t$(\"input[type='password']\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n\t\t    \t\t\treturn false;\n\t\t    \t\t}\n\t\t    \t}\n\t\t    }\n\n\n\t\t    // function to process the form\n\t\t    $scope.processForm = function() {\n\t\t         if ($scope.formData) {\n\t                //contact the service to create a new club! :)\n\n\t                //sort out the phone number: \n\t                $scope.formData.user.phone = vm.selected_phone.CountryCode + $scope.formData.user.phone;\n\n \t\t\t\t\t//console.log(\"GO!\");\n \t\t\t\t\tClubService.Create($scope.formData)\n\t\t                .then(function(data){\n\t\t                    //console.log(data);\n\t\t                    if(data.success){\n\t\t\t                    $state.go(\"club_signup.verify\");\n\t\t\t                    $scope.formData = {};\n\t\t                    } else {\n\t\t                    \t$(\"#error_message\").html(data.message);\n\t\t                    }\n\t\t                });\n\n\t            } else {\n\t            \tToastService.error('Error', 'Something went wrong.');\n\t            }\n\t\t    };\n\n\n\n\n\n\n\t\t$scope.downloadClubDocument = function(doc) {\n            var data = $.param({\n                id: doc\n            });\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n            $http.defaults.headers.common['Api-Key'] = \"eW91a25vd25vdGhpbmdqb25zbm93\";\n\n            $http.get('api/v1/term_documents/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n\n        function titlepath(path,name){\n\n        //In this path defined as your pdf url and name (your pdf name)\n            var prntWin = window.open();\n            prntWin.document.write(\"<html><head><title>\"+name+\"</title></head><body>\"\n                + '<embed width=\"100%\" height=\"100%\" name=\"plugin\" src=\"'+ path+ '\" '\n                + 'type=\"application/pdf\" internalinstanceid=\"21\"></body></html>');\n            prntWin.document.close();\n        }\n\n        function processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], {\n                    //type: contentType\n                    type: 'application/pdf'\n                });\n\n                var fileURL = URL.createObjectURL(blob);\n                titlepath(fileURL, \"Secure Documents\");\n\n                // if (navigator.msSaveBlob)\n                //     navigator.msSaveBlob(blob, filename);\n                // else {\n                //     // Try using other saveBlob implementations, if available\n                //     var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                //     if (saveBlob === undefined) throw \"Not supported\";\n                //     saveBlob(blob, filename);\n                // }\n                success = true;\n            } catch (ex) {\n                $log.info(\"saveBlob method failed with the following exception:\");\n                $log.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            $log.info(\"Download link method with simulated click failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n\n\n\n\n\n\n\n\n\n\n\n    }\napp.controller('CreateGalleryController', CreateGalleryController);\n \n    CreateGalleryController.$inject = ['UserService', 'ArtpiecesService', 'ImagesService', 'KeywordsService', 'CategoryService', '$location', '$rootScope', 'FlashService', '$routeParams', '$scope', 'LocalDataService', 'GalleryService'];\n    function CreateGalleryController(UserService, ArtpiecesService, ImagesService, KeywordsService, CategoryService, $location, $rootScope, FlashService, $routeParams, $scope, LocalDataService, GalleryService) {\n        var vm = this;\n\n        vm.gallery = {\n            is_protected: \"false\",\n            download_low: \"false\",\n            download_medium: \"false\",\n            download_high: \"false\",\n            gallery_link: \"\",\n            fullscreen: \"false\"\n        };\n\n        //get all galleries to check if name is already in use...\n        GalleryService.GetAll()\n                .then(function(data){\n                     vm.all_galleries = data;\n                });\n\n\n\n        vm.images = LocalDataService.data.selected_images;\n\n        //this is where we do the selection of images\n        $scope.remove_image = function(image){\n            //check if set selected\n            //well its selected - so we deselect right?\n            vm.images = $.grep(vm.images, function(e){ \n                return e.id != image.id; \n            });\n            //console.log(vm.images);\n            LocalDataService.SetSelectedImages(vm.images);\n        }\n\n        $scope.check_link_unique = function(){\n            for(var i = 0; i < vm.all_galleries.length; i++){\n                if(vm.all_galleries[i].link===vm.gallery.link){\n                    return false;\n                }\n            }\n        }\n\n\n        $scope.generate_gallery = function(){\n            //console.log(\"CLICKED GALLERY BIT\");\n            //console.log(LocalDataService.data.selected_images);\n            //we need to set the ORDER as organise in the vm.images\n            var organise = 0;\n            for(var i = 0; i < vm.images.length; i++){\n                vm.images[i].organise = i;\n            }\n            //console.log(\"ORGANISE BELOW?\");\n            //console.log(vm.images);\n\n            vm.gallery.images = vm.images;\n            //console.log(vm.gallery);\n            GalleryService.Create(vm.gallery)\n                .then(function(data){\n                    //console.log(data);\n                    $location.path(\"/gallery/\"+data.gallery_link);\n                });\n        }\n\n       \n\n\n\n    }\n app.controller('DashboardClubAirframeLogbookController', DashboardClubAirframeLogbookController);\n\n    DashboardClubAirframeLogbookController.$inject = ['UserService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'LicenceService', 'MedicalService', 'DifferencesService', 'PlaneDocumentService', '$http', 'ToastService', 'LogbookLinkService', 'WorkpackService'];\n    function DashboardClubAirframeLogbookController(UserService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, LicenceService, MedicalService, DifferencesService, PlaneDocumentService, $http, ToastService, LogbookLinkService, WorkpackService) {\n        var vm = this;\n\n       \n        \n        switch(vm.action){\n            case \"add\":\n                // //console.log(\"adding a new plane please\");\n                vm.page_title = \"Add a New Plane\";\n            break;\n            case \"edit\":\n                // //console.log(\"edit an existing plane\");\n                \n                PlaneService.GetByIdMaintenance2($stateParams.plane_id, vm.club_id)\n                    .then(function(data){\n                        vm.club.plane = data;  \n                        vm.this_plane_id = $stateParams.plane_id; \n\n                        if(vm.club.plane && vm.club.plane.maintenance){\n                            //console.log(\"vm.club.plane == > \", vm.club.plane);\n                            vm.obj.hours_remaining = vm.club.plane.maintenance.hours_remaining;\n                            vm.obj.next_check = new Date(vm.club.plane.maintenance.next_maintenance);\n                            vm.obj.check_date = new Date();\n                            vm.obj.extension_granted = new Date();\n                        }\n                       \n\n                        // vm.club.plane.requirements = {\n                        //         licence: [],\n                        //         medical: [],\n                        //         differences: [],\n                        //         hours: []\n                        // };\n                        // //console.log(\"BOOOO - get all planes....\");\n                        vm.page_title = \"Edit a Plane Maintenance - \"+vm.club.plane.registration;\n                    });\n\n                PlaneService.GetOpenIssues($stateParams.plane_id)\n                    .then(function (data) {\n                            ////console.log(\"data is : \", data);\n                           vm.reported_defects = data;\n                        });\n\n\n               \n\n\n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                // PlaneService.GetAllByClubMaintenance(vm.club_id)\n                //     .then(function(data){\n                //         vm.club.planes = data;   \n                //         // //console.log(vm.club.planes);\n                //     });\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n       \n\n        $scope.get_hours_from_decimal = function(time){\n\n            if(time){\n                 var sign = time < 0 ? \"-\" : \"\";\n                 var hour = Math.floor(Math.abs(time));\n                 var min = Math.round((Math.abs(time) * 60) % 60);\n                 if(min == 60){\n                     hour++;\n                     min = 0;\n                 }\n                 return sign + (hour < 10 ? \"0\" : \"\") + hour + \":\" + (min < 10 ? \"0\" : \"\") + min;\n             } else {\n                 return \"N/A\";\n             }\n            \n\n        }\n\n        vm.prop_no = \"\";\n\n        // PlaneService.GetAircraftJourneyLogs($stateParams.plane_id, 0, 25)\n        //     .then(function (data) {\n        //             // //console.log(\"ALL is : \", data);\n        //            // vm.logs = data.logs;\n        //            vm.aircraft = data.aircraft;\n        //            if(vm.aircraft.propeller_2_id > 0){\n\n        //                    // console.log(vm.aircraft);\n\n        //                if(vm.aircraft.propeller_2_id == $stateParams.prop_id){\n        //                    // console.log(\"show 2\");\n        //                    vm.prop_no = \"2\";\n        //                } else {\n        //                    // console.log(\"show 1\");\n        //                    vm.prop_no = \"1\";\n        //                }\n        //            }\n\n\n        //         });\n\n\n            vm.getAge = function(dateString) {\n                var today = new Date();\n                var birthDate = dateString;\n                var age = today.getFullYear() - dateString;\n                // var m = today.getMonth() - birthDate.getMonth();\n                // if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {\n                //     age--;\n                // }\n                return age;\n            }\n\n\n            PlaneService.GetAirframeLogs( $stateParams.plane_id, 0, 25)\n            .then(function (data) {\n                    // //console.log(\"ALL is : \", data);\n                   vm.logs = data.logs;\n                   vm.plane = data.plane;\n\n\n                });\n\n            vm.current_offset = 0;\n            vm.loaded_per_batch = 25;\n            vm.all_loaded = false;\n\n            vm.load_more = function(){\n                vm.current_offset = vm.current_offset + vm.loaded_per_batch;\n                PlaneService.GetAirframeLogs($stateParams.plane_id, vm.current_offset, vm.loaded_per_batch)\n                .then(function (data) {\n                        // //console.log(\"ALL is : \", data);\n                        if(data.logs.length > 0){\n                            data.logs.forEach(log => vm.logs.push(log));\n                        } else {\n                            vm.all_loaded = true;\n                        }\n                       //vm.logs = data.logs;\n                       vm.plane = data.plane;\n\n\n                    });\n\n            }\n\n            vm.update_logbooks = function(){\n                \n\n                PlaneService.UpdateAircraftLogbooks($stateParams.plane_id)\n                .then(function (data) {\n                        \n                        if(data.success){\n\n                           PlaneService.GetAirframeLogs( $stateParams.plane_id, 0, 25)\n                            .then(function (data) {\n                                    // //console.log(\"ALL is : \", data);\n                                   vm.logs = data.logs;\n                                   vm.plane = data.plane;\n\n\n                                });\n\n                        }\n\n\n                    });\n            }\n\n            vm.get_initial = function(text){\n                return text.charAt(0);\n            }\n\n\n            vm.clean_times = function(time){\n                if(time == \"00:00:00\"){\n                    return \" - \";\n                }\n                return time.substring(0,5);\n            }\n\n            //  Maintenance entry helpers \n\n            vm.maintenanceTypeLabels = {\n                '50hour': '50-Hour Check',\n                '100hour': '100-Hour Check',\n                '150hour': '150-Hour Check',\n                '25hours': '25-Hour Check',\n                '50hours': '50-Hour Check',\n                '100hours': '100-Hour Check',\n                'annual': 'Annual Inspection',\n                'cofa': 'Certificate of Airworthiness',\n                'arc': 'Airworthiness Review Certificate',\n                'engine_overhaul': 'Engine Overhaul',\n                'propeller_overhaul': 'Propeller Overhaul',\n                'interim': 'Interim Inspection',\n                '6months': '6-Month Check',\n                'extension': 'Extension',\n                'workpack': 'Workpack',\n                'other': 'Other Maintenance'\n            };\n\n            vm.formatMaintenanceType = function(type) {\n                return vm.maintenanceTypeLabels[type] || type || 'Maintenance';\n            };\n\n            vm.isMaintenanceEntry = function(log) {\n                return (log.entry_type === 'maintenance_check');\n            };\n\n            vm.getEntryType = function(log) {\n                return log.entry_type || 'flight';\n            };\n\n            vm.getEntryPosition = function(log) {\n                return log.entry_position || 'full_day';\n            };\n\n            vm.getHoursRemainingClass = function(hoursRemaining) {\n                if (hoursRemaining === null || hoursRemaining === undefined) return '';\n                if (hoursRemaining <= 5) return 'hours-critical';\n                if (hoursRemaining <= 10) return 'hours-warning';\n                return '';\n            };\n\n            vm.formatHoursRemaining = function(hoursRemaining) {\n                if (hoursRemaining === null || hoursRemaining === undefined) return 'N/A';\n                return hoursRemaining.toFixed(2) + ' hrs';\n            };\n\n            //  Maintenance check detail panel \n            vm.selected_check = null;\n            vm.show_check_detail = false;\n            vm.check_logbook_links = [];\n            vm.check_logbook_loading = false;\n            vm.check_logbook_error = false;\n            vm.check_workpack = null;\n            vm.check_workpack_loading = false;\n\n            vm.viewMaintenanceCheck = function(log) {\n                if (!vm.isMaintenanceEntry(log)) return;\n                vm.selected_check = log;\n                vm.show_check_detail = true;\n\n                // Reset state\n                vm.check_logbook_links = [];\n                vm.check_logbook_error = false;\n                vm.check_workpack = null;\n\n                var checkData = log.maintenance_check || {};\n                var checkId = checkData.id || log.maintenance_check_id || null;\n                if (checkId) {\n                    vm.loadCheckLogbookLinks(checkId);\n                    vm.loadCheckWorkpack(log);\n                }\n            };\n\n            vm.closeMaintenanceCheck = function() {\n                vm.selected_check = null;\n                vm.show_check_detail = false;\n                vm.check_logbook_links = [];\n                vm.check_logbook_error = false;\n                vm.check_workpack = null;\n            };\n\n            // Load logbook associations for a maintenance check.\n            // Uses the same pattern as the maintenance detail edit panel:\n            // 1. Fetch all available logbooks for the plane\n            // 2. Fetch which logbooks this specific check is linked to\n            // 3. Cross-reference to show linked (on) vs unlinked (off)\n            vm.loadCheckLogbookLinks = function(maintenance_check_id) {\n                if (!maintenance_check_id) return;\n                vm.check_logbook_loading = true;\n                vm.check_logbook_error = false;\n                vm.check_logbook_links = [];\n\n                LogbookLinkService.GetAvailableLogbooks($stateParams.plane_id)\n                    .then(function(availData) {\n                        var available = (availData && availData.available_logbooks) ? availData.available_logbooks : [];\n                        if (available.length === 0) {\n                            vm.check_logbook_loading = false;\n                            vm.check_logbook_error = true;\n                            return;\n                        }\n\n                        LogbookLinkService.GetLinks(maintenance_check_id)\n                            .then(function(linkData) {\n                                vm.check_logbook_loading = false;\n                                var links = [];\n                                if (linkData && linkData.maintenance_check && linkData.maintenance_check.logbook_links) {\n                                    links = linkData.maintenance_check.logbook_links;\n                                }\n                                // Build list: each available logbook with isLinked flag\n                                vm.check_logbook_links = available.map(function(lb) {\n                                    var isLinked = links.some(function(link) {\n                                        return link.logbook_type === lb.logbook_type &&\n                                               link.logbook_entity_id == lb.logbook_entity_id;\n                                    });\n                                    return {\n                                        logbook_type: lb.logbook_type,\n                                        logbook_entity_id: lb.logbook_entity_id,\n                                        label: lb.label,\n                                        position: lb.position || null,\n                                        isLinked: isLinked\n                                    };\n                                });\n                            }, function() {\n                                vm.check_logbook_loading = false;\n                                vm.check_logbook_error = true;\n                            });\n                    }, function() {\n                        vm.check_logbook_loading = false;\n                        vm.check_logbook_error = true;\n                    });\n            };\n\n            // Load linked workpack detail\n            vm.loadCheckWorkpack = function(log) {\n                var d = log.maintenance_check || {};\n                // Try linked_workpack_id first, then workpack_id (used when a workpack is created with the check)\n                var wpId = d.linked_workpack_id || d.workpack_id || null;\n                if (!wpId) return;\n                vm.check_workpack_loading = true;\n                WorkpackService.GetById(wpId)\n                    .then(function(data) {\n                        vm.check_workpack_loading = false;\n                        if (data && data.workpack) {\n                            vm.check_workpack = data.workpack;\n                        }\n                    }, function() {\n                        vm.check_workpack_loading = false;\n                    });\n            };\n\n            vm.downloadWorkpackDocument = function(filename) {\n                if (!filename) return;\n                $http.get('/api/v1/maintenance_workpacks/file/' + filename, {\n                    responseType: 'arraybuffer'\n                }).success(function(data, status, headers) {\n                    // Create PDF blob and open in new window (same as maintenance controller)\n                    var blob = new Blob([data], { type: 'application/pdf' });\n                    var fileURL = URL.createObjectURL(blob);\n                    var prntWin = window.open();\n                    prntWin.document.write('<html><head><title>Workpack Document</title></head><body>'\n                        + '<embed width=\"100%\" height=\"100%\" name=\"plugin\" src=\"' + fileURL + '\" '\n                        + 'type=\"application/pdf\" internalinstanceid=\"21\"></body></html>');\n                    prntWin.document.close();\n                }).error(function() {\n                    ToastService.error('Download Error', 'There was an error downloading the workpack document.');\n                });\n            };\n\n            vm.getLogbookIcon = function(type) {\n                switch (type) {\n                    case 'airframe': return 'fa-plane';\n                    case 'engine': return 'fa-cog';\n                    case 'propeller': return 'fa-refresh';\n                    default: return 'fa-book';\n                }\n            };\n\n            vm.getCheckTypeIcon = function(type) {\n                if (!type) return 'fa-wrench';\n                switch (type.toLowerCase()) {\n                    case 'annual': return 'fa-calendar-check-o';\n                    case '50hours': case '50hour': case '25hours': case '100hours': case '100hour': case '150hour': return 'fa-tachometer';\n                    case 'extension': return 'fa-clock-o';\n                    case 'interim': return 'fa-cogs';\n                    case '6months': return 'fa-calendar';\n                    case 'cofa': case 'arc': return 'fa-certificate';\n                    case 'engine_overhaul': return 'fa-cog';\n                    case 'propeller_overhaul': return 'fa-repeat';\n                    case 'workpack': return 'fa-briefcase';\n                    default: return 'fa-wrench';\n                }\n            };\n\n\n\n\n\n        $scope.update_this_file = function(file){\n            //console.log(\"==== update is : \", file.id);\n            if(update_this_file.indexOf(file.id) === -1){\n                update_this_file.push(file.id)\n            } else {\n               ////console.log(\"This item already exists\"); \n            } \n        }\n\n\n         $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.club.plane.plane_documents = $.grep(vm.club.plane.plane_documents, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                PlaneDocumentService.Delete(vm.user_id, file.id)\n                .then(function (data) {\n                    // //console.log(data);\n                    if(data.success){\n                        // //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            // //console.log(\"REMOVE: \", j);\n            // //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n\n            //this SHOULD BE TO THE CURRENT POSITION\n\n            // PoidService.DeleteTmp(j.saved_url)\n            //     .then(function (data) {\n            //         //console.log(data);\n            //         if(data.success){\n            //             //console.log(\"HUZZAH\", current_files);\n            //             //then we need to remove this from the list of files...\n            //             //clear files\n            //             vm.plane_documents = [];\n            //             //and re-process available files\n            //             $scope.processFiles(current_files);\n\n            //         } else {\n            //             //console.log(\"WOOOPSIES...\");\n            //             //this should be very very rare...\n            //         }\n\n            //     });\n\n          }\n          \n\n          // $scope.$on('flow::fileAdded', function (event, $flow, flowFile) {\n          //     event.preventDefault();//prevent file from uploading\n          //     //console.log(\"FILE ADDED\");\n          //     //console.log($flow);\n          //   });\n\n            vm.files = {\n                radio: [],\n                cert: [],\n                insurance: []\n            }\n\n\n            $scope.processFiles = function(files, location){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    // //console.log(\"J is : \",j);\n                    // //console.log(\"name is : \", j.files.file.name);\n\n                    files[i].file.temp_path = j.saved_url;\n                    files[i].file.save_name = j.files.file.name;\n                    var ft = j.files.file.name;\n                    ft = ft.split('.').pop();\n                    files[i].file.extension = ft;\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.files[location].push(files[i].file);\n                }\n\n\n            }\n\n\n             $scope.processFile = function(files, location){\n                 //console.log(\"files\", files[0].file_return);\n\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[0].file_return);\n                    // //console.log(\"PARSED\", j);\n                    // //console.log(\"J is : \",j);\n                    // //console.log(\"name is : \", j.files.file.name);\n\n                    files[0].file.temp_path = j.saved_url;\n                    files[0].file.save_name = j.files.file.name;\n\n                    var ft = j.files.file.name;\n                    // //console.log(\"ft\", ft);\n                    var fft = ft.split('.').pop();\n                    files[0].file.extension = fft;\n                    // //console.log(\"FILE is : \", files[0]);\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.files[location].push(files[0]);\n\n\n            }\n\n            $scope.set_title = function(file){\n                // //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            $scope.get_icon2 = function(file){\n                ////console.log(\"FILE\", file);\n                if(!file || file == \"\"){\n                    return \"\";\n                }\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            vm.defect_severity;\n                vm.defect_severities = [\n                    { title: \"No Fly Item - Ground the plane\"},\n                    { title: \"Flyable - needs to be checked at next maintenance\"},\n                    { title: \"Not urgent - but needs noting\"},\n                    { title: \"Unsure of severity\"}\n                ]; \n\n\n            $scope.delete_poid = function(id){\n\n              \n                var a = prompt(\"Are you sure you wish to delete this poid? \\n\\n This change is irreversible! To confirm please type YES in the box below.\");\n                if(a == \"YES\"){\n\n\n                    //console.log(\"WE DELETE IT\");\n\n\n                    // PoidService.Delete(vm.user_id, id)\n                    //     .then(function (data) {\n                    //         //console.log(data);\n                    //         if(data.success){\n                    //             //console.log(\"HUZZAH\", data);\n                    //             //then we need to remove this from the list of files...\n                    //             vm.user_poids = $.grep(vm.user_poids, function(e){ \n                    //                 return e.id != id; \n                    //             });\n                                \n                    //             //refresh?\n                    //             $state.reload();\n                    //             $state.go('dashboard.my_account.poid');\n\n                    //         } else {\n\n                    //             alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n                    //         }\n\n                    //     });\n\n\n\n                } else {\n                    //console.log(\"ignore123\");\n                }\n\n\n            }\n\n\n\n\n            $scope.save_plane_documents = function(){\n\n               \n              \n\n                // //console.log(\"plane_documents: \", vm.plane_documents);\n\n\n                //compile the required elements YAY\n\n                // //console.log(\"plane_document \", vm.plane_document);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n                    // for(var i=0;i<vm.plane_document.images.length;i++){\n                    //     delete vm.plane_document.images[i].data_uri;\n                    // }\n\n                    // // vm.plane_document.images = vm.plane_documents;\n                    // vm.plane_document.images = vm.plane_document.images.concat(vm.plane_documents);\n                    // vm.plane_document.user_id = vm.user_id;\n\n\n\n\n            //     if(vm.plane_document.id){\n            //         //then its an udpate\n\n            //         //merge the images left?\n            //         PoidService.Update(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                     $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n            //     } else {\n\n\n                   \n\n\n            //         //then its a create\n            //         //console.log(vm.plane_document);\n\n            //         PoidService.Create(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                    // $state.reload();\n            //                    // $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n\n            //     }\n\n\n\n             };\n\n\n\n\n             $scope.change_file_name = function(file){\n                \n                //this is terribly ineficient... unfortunately... can't \n                //work out how else to do it! (lol)\n\n                // //console.log(\"TO BE CHANGED\", file);\n\n                // //console.log(\"BEFORE BEFORE\", vm.plane_documents);\n\n                vm.plane_documents = $.grep(vm.plane_documents, function(e){ \n                    return e.temp_path != file.temp_path; \n                });\n\n                // //console.log(\"BEFORE\", vm.plane_documents);\n\n                vm.plane_documents.push(file);\n\n                // //console.log(\"AFTER\", vm.plane_documents);\n\n             }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n          //var warning_msg = \"By deleting this plane, you will also cancel all reservations that this plane currently has.\"\n\n          // $scope.open = function (plane_id) {\n          //   var modalInstance = $uibModal.open({\n          //     animation: true,\n          //     templateUrl: 'views/modals/deleteModal.html',\n          //     controller: 'ModalInstanceCtrl',\n          //     //params: {},\n          //     size: \"lg\",\n          //     resolve: {\n          //       id: function () {\n          //         return plane_id;\n          //       },\n          //       warning: function(){\n          //           return warning_msg;\n          //       }\n          //     }\n          //   });\n          //   modalInstance.result.then(function (plane_id) {\n          //     $log.info('PRESSED GO: '+plane_id);\n          //     PlaneService.Delete(plane_id)\n          //     .then(function(){\n          //       //console.log(\"HELLO DELETE\");\n          //       //update view?\n          //        vm.club.planes = $.grep(vm.club.planes, function(e){ \n          //           return e.plane_id != plane_id; \n          //       });\n          //     })\n          //   }, function () {\n          //     $log.info('Modal dismissed at: ' + new Date());\n          //   });\n          // };\n\n            $scope.open = function (club_plane_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return club_plane_id;\n                },\n                params: function() {\n                  return {id: club_plane_id};\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (plane) {\n                var id = plane.id;\n              $log.info('PRESSED GO: ', id);\n              \n              PlaneService.Delete(id)\n              .then(function(){\n                // //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.planes = $.grep(vm.club.planes, function(e){ \n                    return e.id != id; \n                });\n             });\n\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n\n\n          };\n         \n          \n\n\n        //   $scope.downloadCertificate = function(doc) {\n        //     var data = $.param({\n        //         id: doc\n        //     });\n\n        //     var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n        //     $http.get('api/v1/plane_certificate/show_file/'+ddd, {\n        //             responseType: 'arraybuffer'\n        //         })\n        //         .success(function(data, status, headers) {\n        //             var zipName = processArrayBufferToBlob(data, headers);\n\n        //             //Delete file from temp folder in server - file needs to remain open until blob is created\n        //             //deleteFileFromServerTemp(zipName);\n        //         }).error(function(data, status) {\n        //             alert(\"There was an error downloading the selected document(s).\");\n        //         })\n        // };\n\n\n        // $scope.downloadInsurance = function(doc) {\n        //     var data = $.param({\n        //         id: doc\n        //     });\n\n        //     var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n        //     $http.get('api/v1/plane_insurance/show_file/'+ddd, {\n        //             responseType: 'arraybuffer'\n        //         })\n        //         .success(function(data, status, headers) {\n        //             var zipName = processArrayBufferToBlob(data, headers);\n\n        //             //Delete file from temp folder in server - file needs to remain open until blob is created\n        //             //deleteFileFromServerTemp(zipName);\n        //         }).error(function(data, status) {\n        //             alert(\"There was an error downloading the selected document(s).\");\n        //         })\n        // };\n\n\n\n\n        $scope.downloadDocument = function(doc, type = 'docs') {\n            var data = $.param({\n                id: doc\n            });\n\n            var controller = \"plane_documents\";\n\n            switch(type){\n                 case \"radio\": \n                    controller = \"plane_radio_licence\";\n                break;\n                 case \"insurance\": \n                    controller = \"plane_insurance\";\n                break;\n                 case \"certificate\": \n                    controller = \"plane_certificate\";\n                break;\n                case \"noise\": \n                    controller = \"plane_noise_certificate\";\n                break;\n                case \"docs\": \n                    controller = \"plane_documents\";\n                break;\n                default:\n                    controller = \"plane_documents\";\n                break;\n\n            }\n\n\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/'+controller+'/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        $scope.downloadClubDocument = function(doc) {\n            var data = $.param({\n                id: doc\n            });\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/club_documents/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        function processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], {\n                    type: contentType\n                });\n                if (navigator.msSaveBlob)\n                    navigator.msSaveBlob(blob, filename);\n                else {\n                    // Try using other saveBlob implementations, if available\n                    var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                    if (saveBlob === undefined) throw \"Not supported\";\n                    saveBlob(blob, filename);\n                }\n                success = true;\n            } catch (ex) {\n                $log.info(\"saveBlob method failed with the following exception:\");\n                $log.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            $log.info(\"Download link method with simulated click failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n\n\n\n        $scope.search2 = function(row){\n            //(angular.lowercase(row.first_name).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)  || (angular.lowercase(row.last_name).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)\n            ////console.log(\"answer\", (angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1));\n            // return ((angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || (angular.lowercase(row.flight_time).indexOf(angular.lowercase($scope.my_search2)) || '') !== -1)));\n            //(angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)\n           \n            // if( (test_date($scope.my_search2, row.flight_date)) || (angular.lowercase(row.destination_airport).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) || (angular.lowercase(row.departure_airport).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) || (angular.lowercase(row.destination_airport_code).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) || (angular.lowercase(row.departure_airport_code).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)){\n            //     return true;\n            // } else {\n            //     return false;\n            // }test_aircraft\n\n            //console.log(\"TEST \" , test_date($scope.my_search2));\n\n            ////console.log($scope.my_search2);\n            if(!$scope.my_search2 || ($scope.my_search2 == \"\")){\n                return true;\n            } else if(test_date($scope.my_search2, row.entry_date)){\n                return true;\n            } else {\n                return false;\n            }\n\n            // we are testing for the date, the pilot, the departure and destination.\n\n            // return (angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1); // ? (angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) : (angular.lowercase(row.flight_time).indexOf(angular.lowercase($scope.my_search2) || '') !== -1);\n\n        };\n\n        function test_date(search, date){\n\n\n            if(search.length < 2){\n                return false;\n            }\n\n            if(search && search.length <= 3){\n                if(date.indexOf(search) > -1){\n                    return true;\n                }\n            } else {\n                var parsed_date = \"\";\n                var b = moment(search);\n                if(b.isValid() && b.format(\"YYYY\") != \"2001\"){\n                    parsed_date = b.format(\"YYYY-MM-DD\");\n                } else if(b.isValid()){\n                    parsed_date = b.format(\"MM-DD\");\n                }\n\n\n                var search_type = 0;\n\n                if(parsed_date !== \"\" && date.indexOf(parsed_date) > -1){\n                    // //console.log(\"found\");\n                    return true;\n                } else {\n\n                    //backup in case of wrong parsing data::;\n                    //european method\n\n                    if(search.length <= 5 && search.length >= 4){\n\n                        var c = moment(search, \"DDMM\");\n                        // //console.log(\"C is : \", c);\n                        if(c.isValid()){\n                            var c2 = c.format(\"MM-DD\");\n                            if(date.indexOf(c2) > -1){\n                                return true;\n                            }\n                        }\n\n                    } else if(search.length == 8 || search.length == 10){\n                        \n                        var c = moment(search, \"DDMMYYYY\");\n                        // //console.log(\"C is : \", c);\n                        if(c.isValid()){\n                            var c2 = c.format(\"YYYY-MM-DD\");\n                            if(date.indexOf(c2) > -1){\n                                return true;\n                            }\n                        }\n\n                    }\n\n                    // //console.log(\"not found\");\n                    return false;\n                }\n            }\n\n        }\n\n        $scope.getMySearchCount = function(str){\n            var docs = str.documents;\n            var total = 0;\n            for(var i=0;i<docs.length;i++){\n                if($scope.search(docs[i])){\n                    total++;\n                }\n            }\n            return total;\n        }\n\n        $scope.getMySearchCount2 = function(str){\n            var charges = str.charges;\n            var total = 0;\n            for(var i=0;i<charges.length;i++){\n                if($scope.search(charges[i])){\n                    total++;\n                }\n            }\n            return total;\n        }\n\n\n    }\n app.controller('DashboardClubCourseController', DashboardClubCourseController);\n\n    DashboardClubCourseController.$inject = ['UserService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'CourseService', 'ToastService'];\n    function DashboardClubCourseController(UserService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, CourseService, ToastService) {\n        var vm = this;\n\n           //    /* PLEASE DO NOT COPY AND PASTE THIS CODE. */(function(){var w=window,C='___grecaptcha_cfg',cfg=w[C]=w[C]||{},N='grecaptcha';var gr=w[N]=w[N]||{};gr.ready=gr.ready||function(f){(cfg['fns']=cfg['fns']||[]).push(f);};(cfg['render']=cfg['render']||[]).push('explicit');(cfg['onload']=cfg['onload']||[]).push('initRecaptcha');w['__google_recaptcha_client']=true;var d=document,po=d.createElement('script');po.type='text/javascript';po.async=true;po.src='https://www.gstatic.com/recaptcha/releases/JPZ52lNx97aD96bjM7KaA0bo/recaptcha__en.js';var e=d.querySelector('script[nonce]'),n=e&&(e['nonce']||e.getAttribute('nonce'));if(n){po.setAttribute('nonce',n);}var s=d.getElementsByTagName('script')[0];s.parentNode.insertBefore(po, s);})();\n\n           // var initRecaptcha = function () { \n           //     // document.getElementById(\"SearchModule\").scope().vm.parent.isGrecaptchaLoaded = !0, \n           //     // document.getElementById(\"SearchModule\").scope().vm.showRecaptcha();\n           //     vm.showRecaptcha();\n           // };\n              \n\n\n        vm.charge_type = [\"brakes\", \"session\", \"plane\", \"brakes_rounded\"];\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {\n            course: {\n                \n            }\n        };\n\n        vm.page_title = \"\";\n        \n        vm.course_document = {};\n        vm.course_documents = [];\n\n        var update_this_file = [];\n        \n       \n\n        vm.action = $state.current.data.action;\n        vm.user = $rootScope.globals.currentUser;\n        // //console.log(\"$rootScope.globals.currentUser : \", $rootScope.globals.currentUser);\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user_id = vm.user.id;\n\n\n        vm.course_certificate = {};\n        vm.course_noise = {};\n        vm.course_radio = {};\n        vm.course_maintenance = {};\n        vm.course_insurance = {};\n\n        vm.club.lessons = [];\n        vm.exams = [];\n        vm.tags = [];\n        vm.instructor_charges = [];\n\n        // //console.log(vm.action);\n        // //console.log($stateParams);\n        // //console.log($stateParams.id);\n\n\n        vm.editing = false;\n        vm.edit_course = false;\n\n        switch(vm.action){\n            case \"add\":\n                //console.log(\"adding a new course please\");\n                vm.page_title = \"Add a New Course\";\n            break;\n            case \"edit\":\n                vm.editing = true;\n                vm.edit_course = true;\n                //console.log(\"edit an existing course\");\n\n\n                CourseService.GetCourseById($stateParams.course_id)\n                    .then(function(data){\n                        vm.club.course = data.item;   \n            \n                        vm.page_title = \"Edit a Course - \"+vm.club.course.title;\n                    });\n \n                    CourseService.GetLessonsByCourseId($stateParams.course_id)\n                    .then(function(data){\n                        vm.club.lessons = data.items;   \n            \n\n\n                    });\n\n                      refresh_exams();\n                      refresh_tags();\n                      refresh_charges();\n\n\n\n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                CourseService.GetCoursesByClubId(vm.club_id)\n                    .then(function(data){\n                        vm.club.courses = data.items;   \n                        //console.log(vm.club.courses);\n                    });\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n        function refresh_exams(){\n             CourseService.GetExamsByCourseId($stateParams.course_id)\n                    .then(function(data){\n                        vm.exams = data.items;   \n                \n\n\n                    });\n        }\n\n        function refresh_tags(){\n             CourseService.GetTagsByCourseId($stateParams.course_id)\n                    .then(function(data){\n                        vm.tags = data.items;   \n                \n\n\n                    });\n        }\n\n        function refresh_charges(){\n\n                 CourseService.GetChargesByCourseId($stateParams.course_id)\n                    .then(function(data){\n                        vm.instructor_charges = data.items;   \n                \n\n\n                    });\n        }\n\n        //'9' needs to refer the the user's account set to manage\n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n\n\n        vm.clearFieldError = function(event) { ToastService.clearFieldError(event); };\n\n        $scope.save = function(){\n            var checks = [\n                { ok: vm.club.course.title, field: 'title', label: 'Course Title' }\n            ];\n            if (!ToastService.validateForm(checks)) return;\n\n            if(vm.action == \"add\"){\n                $scope.create();\n            } else {\n                $scope.update();\n            }\n        }\n\n        \n        $scope.save_lesson_order = function(){\n            // //console.log(\"hiya\");\n            var update_order = [];\n            for(var i=0; i < vm.club.lessons.length;i++){\n                var me = {\n                    id: vm.club.lessons[i].id,\n                    organise: i\n                }\n                update_order.push(me);\n            }\n            // //console.log(\"organised: \", update_order);\n\n            CourseService.UpdateLessonOrder({\"order\": update_order})\n                .then(function(data){\n                    //console.log(data);\n\n                    // vm.items = data.items;\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n\n                });\n\n        }\n\n        vm.delete_lesson = function(id, index){\n\n            if(confirm(\"Are you sure you wish to delete this lesson? This is irreversible.\")){\n                CourseService.DeleteLesson(id)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success){\n                        vm.club.lessons.splice(index, 1);\n                    } else {\n                        ToastService.error('Error', 'An error occurred');\n                    }\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n                });\n            }\n\n            \n        }\n\n        vm.update_exam = function(exam, index){\n\n            delete(exam.edit_me);\n\n            CourseService.UpdateExam(exam)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success){\n\n                        vm.exams[index].edit_me = false;\n\n                    } else {\n                        ToastService.error('Error', 'An error occurred');\n                    }\n                    //refresh_tem();\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n                });\n        }\n\n        vm.update_cancel = function(index){\n            refresh_exams();\n        }\n\n        vm.edit_exam = function(index){\n\n            vm.exams[index].edit_me = true;\n\n        }\n\n        vm.delete_exam = function(exam, index){\n            // //console.log(\"EXAM\", exam);\n            if(confirm(\"Are you sure you wish to delete this exam? This is irreversible.\")){\n\n                CourseService.DeleteExam(exam.id)\n                    .then(function(data){\n                        //console.log(data);\n                        if(data.success){\n                            vm.exams.splice(index, 1);\n                        } else {\n                            ToastService.error('Error', 'An error occurred');\n                        }\n                        //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n                    });\n            }\n        }\n\n       \n        \n        vm.add_exam = function(){\n\n            vm.new_exam.course_id = $stateParams.course_id; \n            vm.new_exam.club_id = vm.club_id; \n\n            CourseService.CreateExam(vm.new_exam)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success){\n\n                        vm.exams.push(data.item);\n\n                        vm.new_exam = {\n                            title: \"\",\n                            description: \"\"\n                        }\n\n                    } else {\n                        ToastService.error('Error', 'An error occurred');\n                    }\n\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n\n                });\n        }\n\n\n\n\n\n\n        vm.update_tag = function(tag, index){\n\n            ToastService.warning('Tag Removal', 'This tag being removed will not remove the tag from previous flights where this tag was already applied.');\n\n            delete(tag.edit_me);\n\n            CourseService.UpdateTags(tag)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success){\n\n                        vm.tags[index].edit_me = false;\n\n                    } else {\n                        ToastService.error('Error', 'An error occurred');\n                    }\n                    //refresh_tem();\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n                });\n        }\n\n        vm.update_cancel_tag = function(index){\n            refresh_tags();\n        }\n\n        vm.edit_tag = function(index){\n\n            vm.tags[index].edit_me = true;\n\n        }\n\n        vm.delete_tag = function(tag, index){\n            // //console.log(\"EXAM\", exam);\n            if(confirm(\"Are you sure you wish to delete this tag? If this tag has already been assigned to particular flight(s) this will not remove these from existing flights.\")){\n\n                CourseService.DeleteTags(tag.id)\n                    .then(function(data){\n                        //console.log(data);\n                        if(data.success){\n                            vm.tags.splice(index, 1);\n                        } else {\n                            ToastService.error('Error', 'An error occurred');\n                        }\n                        //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n                    });\n            }\n        }\n\n       \n        \n        vm.add_tag = function(){\n\n            vm.new_tag.course_id = $stateParams.course_id; \n            vm.new_tag.club_id = vm.club_id; \n\n            CourseService.CreateTags(vm.new_tag)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success){\n\n                        vm.tags.push(data.item);\n\n                        vm.new_tag = {\n                            title: \"\"\n                        }\n\n                    } else {\n                        ToastService.error('Error', 'An error occurred');\n                    }\n\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n\n                });\n        }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        vm.update_charge = function(charge, index){\n\n            delete(charge.edit_me);\n\n            CourseService.UpdateCharge(charge)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success){\n\n                        vm.instructor_charges[index].edit_me = false;\n\n                    } else {\n                        ToastService.error('Error', 'An error occurred');\n                    }\n                    //refresh_tem();\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n                });\n        }\n\n        vm.update_cancel_charge = function(index){\n            refresh_charges();\n        }\n\n        vm.edit_charge = function(index){\n\n            vm.instructor_charges[index].edit_me = true;\n\n        }\n\n        vm.delete_charge = function(charge, index){\n            // //console.log(\"EXAM\", exam);\n            if(confirm(\"Are you sure you wish to delete this instructor charge? This is irreversible.\")){\n\n                CourseService.DeleteCharge(charge.id)\n                    .then(function(data){\n                        //console.log(data);\n                        if(data.success){\n                            vm.instructor_charges.splice(index, 1);\n                        } else {\n                            ToastService.error('Error', 'An error occurred');\n                        }\n                        //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n                    });\n            }\n        }\n\n       \n        \n        vm.add_charge = function(){\n\n            vm.new_charge.course_id = $stateParams.course_id; \n            vm.new_charge.club_id = vm.club_id; \n\n            CourseService.CreateCharge(vm.new_charge)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success){\n\n                        vm.instructor_charges.push(data.item);\n\n                        vm.new_charge = {\n                            title: \"\",\n                            charge_type: \"\",\n                            price: \"\"\n                        }\n\n                    } else {\n                        ToastService.error('Error', 'An error occurred');\n                    }\n\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n\n                });\n        }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n         vm.delete_course = function(id, index){\n            if(confirm(\"Are you sure you wish to delete this course? This is irreversible.\")){\n\n                CourseService.DeleteCourse(id)\n                    .then(function(data){\n                        //console.log(data);\n                        if(data.success){\n                            vm.club.courses.splice(index, 1);\n                        } else {\n                            ToastService.error('Error', 'An error occurred');\n                        }\n                        //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n                    });\n            } \n        }\n\n        $scope.create = function(){\n            ////console.log(\"CREATE ME NOW\");\n         \n            //return false;\n            //return false;\n            vm.club.course.club_id = vm.club_id;\n\n            CourseService.CreateCourse(vm.club.course)\n                .then(function(data){\n                    ////console.log(data);\n                    if(data.success){\n                        $state.go('dashboard.manage_club.edit_course', {course_id: data.id, reload: true});\n                    }\n\n                });\n\n\n        }\n\n        $scope.delete = function(){\n            //console.log(\"CLICK\");\n            ToastService.warning('Delete Course', 'Are you sure you would like to delete this course?');\n            CourseService.DeleteCourse(vm.club.course.id)\n                .then(function(data){\n                    //console.log(data);\n                });\n        }\n\n        function get_update_docs(){\n            var documents = [];\n\n            for(var i=0;i<update_this_file.length;i++){\n                var id = update_this_file[i];\n                //console.log(\"looking for : \", id);\n                //console.log(\"in: \", vm.course_documents);\n\n                for(var k=0;k<vm.club.course.course_documents.length;k++){\n                    //console.log(\"comparing to : \", vm.club.course.course_documents[k].id);\n                    if(vm.club.course.course_documents[k].id == id){\n                        documents.push(vm.club.course.course_documents[k]);\n                    }\n                }\n\n            }\n\n            // //console.log(\"DOCS TO UPDATE : \", documents);\n\n            return documents;\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n         \n\n            CourseService.UpdateCourse(vm.club.course)\n                .then(function(data){\n                    //console.log(data);\n                    //console.log(\"saved\");\n                    $state.go('dashboard.manage_club.courses');\n                });\n        }\n\n\n        function containsObject(obj, list, params) {\n\n            // //console.log(\"obj\", obj);\n            // //console.log(\"list\", list);\n            // //console.log(\"params\", params);\n\n            for(var i=0; i<list.length; i++) {\n                // //console.log(\"list i : \", list[i]);\n                // //console.log(\"obj is: \", obj);\n\n                var count_success = 0;\n                for(var j=0;j<params.length;j++){\n                    if(list[i][params[j]] && obj[params[j]] && list[i][params[j]] == obj[params[j]]){\n                        count_success++;\n                    }\n                }\n\n                if(count_success === params.length) {                    \n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n\n       \n\n        $scope.add_item = function(type){\n            //console.log(\"ADD\");\n            switch(type){\n                case \"licence\":\n                    //console.log(\"licence\");\n                    if(vm.temporary.licence && vm.temporary.licence !== \"\" && vm.temporary.rating && vm.temporary.rating !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_licence = {\n                            licence_id: vm.temporary.licence.id,\n                            licence_title: vm.temporary.licence.abbreviation,\n                            rating_title: vm.temporary.rating.abbreviation,\n                            rating_id: vm.temporary.rating.id\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_licence, vm.club.course.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n                            vm.club.course.requirements.licence.push(add_licence);\n                        }\n\n                        delete vm.temporary.licence;\n                        delete vm.temporary.rating;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a licence and rating that is required to book the course solo!');\n                    }\n\n                break;\n\n\n                case \"medical\":\n                    //console.log(\"medical\");\n                    if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_medical = {\n                            authority_id: vm.temporary.medical_authority.id,\n                            authority_title: vm.temporary.medical_authority.abbreviation,\n                            medical_component_id: vm.temporary.medical_component.id,\n                            medical_component_title: vm.temporary.medical_component.title\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_medical, vm.club.course.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n                            vm.club.course.requirements.medical.push(add_medical);\n                        }\n\n                        delete vm.temporary.medical_authority;\n                        delete vm.temporary.medical_component;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a medical that is required to book the course solo!');\n                    }\n\n                break;\n\n\n                case \"differences\":\n                    //console.log(\"difference\");\n                    if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_difference = {\n                            difference_id: vm.temporary.difference.id,\n                            difference_title: vm.temporary.difference.title\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_difference, vm.club.course.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n                            vm.club.course.requirements.differences.push(add_difference);\n                        }\n\n                        delete vm.temporary.difference;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a difference that is required to book the course solo!');\n                    }\n\n                break;\n\n\n            }\n\n\n\n        }\n\n\n\n\n\n\n\n\n\n\n\n\n\n        $scope.update_this_file = function(file){\n            //console.log(\"==== update is : \", file.id);\n            if(update_this_file.indexOf(file.id) === -1){\n                update_this_file.push(file.id)\n            } else {\n               ////console.log(\"This item already exists\"); \n            } \n        }\n\n\n         $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.club.course.course_documents = $.grep(vm.club.course.course_documents, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                PlaneDocumentService.Delete(vm.user_id, file.id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.course_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n\n\n        vm.files = {\n            radio: [],\n            cert: [],\n            insurance: [],\n            noise: []\n        }\n\n\n           $scope.processFile = function(files, location){\n                 //console.log(\"files\", files[0].file_return);\n\n                     // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[0].file_return);\n                     ////console.log(\"PARSED\", j);\n                    // //console.log(\"J is : \",j);\n                    // //console.log(\"name is : \", j.files.file.name);\n\n                    files[0].file.temp_path = j.saved_url;\n                    files[0].file.save_name = j.files.file.name;\n\n                    var ft = j.files.file.name;\n                    //console.log(\"ft\", ft);\n                    var fft = ft.split('.').pop();\n                    files[0].file.extension = fft;\n                    //console.log(\"FILE is : \", files[0]);\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.files[location].push(files[0].file);\n\n\n            }\n\n            $scope.set_title = function(file){\n                //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            //console.log(\"REMOVE: \", j);\n            //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            PoidService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.course_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n          // $scope.$on('flow::fileAdded', function (event, $flow, flowFile) {\n          //     event.preventDefault();//prevent file from uploading\n          //     //console.log(\"FILE ADDED\");\n          //     //console.log($flow);\n          //   });\n\n            $scope.processFiles = function(files){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    //console.log(\"J is : \",j);\n                    //console.log(\"name is : \", j.files.file.name);\n\n                    files[i].file.temp_path = j.saved_url;\n                    files[i].file.save_name = j.files.file.name;\n                    var ft = j.files.file.name;\n                    ft = ft.split('.').pop();\n                    files[i].file.extension = ft;\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.course_documents.push(files[i].file);\n                }\n\n\n            }\n\n            $scope.set_title = function(file){\n                //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            $scope.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n       \n\n\n    }\n app.controller('DashboardClubEngineLogbookController', DashboardClubEngineLogbookController);\n\n    DashboardClubEngineLogbookController.$inject = ['UserService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'LicenceService', 'MedicalService', 'DifferencesService', 'PlaneDocumentService', '$http', 'ToastService', 'LogbookLinkService', 'WorkpackService'];\n    function DashboardClubEngineLogbookController(UserService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, LicenceService, MedicalService, DifferencesService, PlaneDocumentService, $http, ToastService, LogbookLinkService, WorkpackService) {\n        var vm = this;\n\n       \n        \n        switch(vm.action){\n            case \"add\":\n                // //console.log(\"adding a new plane please\");\n                vm.page_title = \"Add a New Plane\";\n            break;\n            case \"edit\":\n                // //console.log(\"edit an existing plane\");\n                \n                PlaneService.GetByIdMaintenance2($stateParams.plane_id, vm.club_id)\n                    .then(function(data){\n                        vm.club.plane = data;  \n                        vm.this_plane_id = $stateParams.plane_id; \n\n                        if(vm.club.plane && vm.club.plane.maintenance){\n                            //console.log(\"vm.club.plane == > \", vm.club.plane);\n                            vm.obj.hours_remaining = vm.club.plane.maintenance.hours_remaining;\n                            vm.obj.next_check = new Date(vm.club.plane.maintenance.next_maintenance);\n                            vm.obj.check_date = new Date();\n                            vm.obj.extension_granted = new Date();\n                        }\n                       \n\n                        // vm.club.plane.requirements = {\n                        //         licence: [],\n                        //         medical: [],\n                        //         differences: [],\n                        //         hours: []\n                        // };\n                        // //console.log(\"BOOOO - get all planes....\");\n                        vm.page_title = \"Edit a Plane Maintenance - \"+vm.club.plane.registration;\n                    });\n\n                PlaneService.GetOpenIssues($stateParams.plane_id)\n                    .then(function (data) {\n                            ////console.log(\"data is : \", data);\n                           vm.reported_defects = data;\n                        });\n\n\n               \n\n\n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                // PlaneService.GetAllByClubMaintenance(vm.club_id)\n                //     .then(function(data){\n                //         vm.club.planes = data;   \n                //         // //console.log(vm.club.planes);\n                //     });\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n       \n\n        $scope.get_hours_from_decimal = function(time){\n\n            if(time){\n                 var sign = time < 0 ? \"-\" : \"\";\n                 var hour = Math.floor(Math.abs(time));\n                 var min = Math.round((Math.abs(time) * 60) % 60);\n                 if(min == 60){\n                     hour++;\n                     min = 0;\n                 }\n                 return sign + (hour < 10 ? \"0\" : \"\") + hour + \":\" + (min < 10 ? \"0\" : \"\") + min;\n             } else {\n                 return \"N/A\";\n             }\n            \n\n        }\n\n\n        // PlaneService.GetAircraftJourneyLogs($stateParams.plane_id, 0, 25)\n        //     .then(function (data) {\n        //             // //console.log(\"ALL is : \", data);\n        //            // vm.logs = data.logs;\n        //            vm.aircraft = data.aircraft;\n        //             if(vm.aircraft.engine_2_id > 0){\n        //                if(vm.aircraft.engine_2_id == $stateParams.engine_id){\n        //                    vm.multiple = 2;\n        //                } else {\n        //                    vm.multiple = 1;\n        //                }\n        //            }\n\n        //         });\n\n\n            PlaneService.GetEngineLogs($stateParams.engine_id,$stateParams.plane_id, 0, 25)\n            .then(function (data) {\n                    // //console.log(\"ALL is : \", data);\n                   vm.logs = data.logs;\n                   vm.engine = data.engine;\n\n\n                });\n\n            vm.current_offset = 0;\n            vm.loaded_per_batch = 25;\n            vm.all_loaded = false;\n\n            vm.load_more = function(){\n                vm.current_offset = vm.current_offset + vm.loaded_per_batch;\n                PlaneService.GetEngineLogs($stateParams.engine_id,$stateParams.plane_id, vm.current_offset, vm.loaded_per_batch)\n                .then(function (data) {\n                        // //console.log(\"ALL is : \", data);\n                        if(data.logs.length > 0){\n                            data.logs.forEach(log => vm.logs.push(log));\n                        } else {\n                            vm.all_loaded = true;\n                        }\n                       //vm.logs = data.logs;\n                       vm.engine = data.engine;\n\n\n                    });\n\n            }\n\n            vm.get_initial = function(text){\n                return text.charAt(0);\n            }\n\n\n            vm.clean_times = function(time){\n                if(time == \"00:00:00\"){\n                    return \" - \";\n                }\n                return time.substring(0,5);\n            }\n\n            //  Maintenance entry helpers \n\n            vm.maintenanceTypeLabels = {\n                '50hour': '50-Hour Check',\n                '100hour': '100-Hour Check',\n                '150hour': '150-Hour Check',\n                '25hours': '25-Hour Check',\n                '50hours': '50-Hour Check',\n                '100hours': '100-Hour Check',\n                'annual': 'Annual Inspection',\n                'cofa': 'Certificate of Airworthiness',\n                'arc': 'Airworthiness Review Certificate',\n                'engine_overhaul': 'Engine Overhaul',\n                'propeller_overhaul': 'Propeller Overhaul',\n                'interim': 'Interim Inspection',\n                '6months': '6-Month Check',\n                'extension': 'Extension',\n                'workpack': 'Workpack',\n                'other': 'Other Maintenance'\n            };\n\n            vm.formatMaintenanceType = function(type) {\n                return vm.maintenanceTypeLabels[type] || type || 'Maintenance';\n            };\n\n            vm.isMaintenanceEntry = function(log) {\n                return (log.entry_type === 'maintenance_check');\n            };\n\n            vm.getEntryType = function(log) {\n                return log.entry_type || 'flight';\n            };\n\n            vm.getEntryPosition = function(log) {\n                return log.entry_position || 'full_day';\n            };\n\n            vm.getHoursRemainingClass = function(hoursRemaining) {\n                if (hoursRemaining === null || hoursRemaining === undefined) return '';\n                if (hoursRemaining <= 5) return 'hours-critical';\n                if (hoursRemaining <= 10) return 'hours-warning';\n                return '';\n            };\n\n            vm.formatHoursRemaining = function(hoursRemaining) {\n                if (hoursRemaining === null || hoursRemaining === undefined) return 'N/A';\n                return hoursRemaining.toFixed(2) + ' hrs';\n            };\n\n            //  Maintenance check detail panel \n            vm.selected_check = null;\n            vm.show_check_detail = false;\n            vm.check_logbook_links = [];\n            vm.check_logbook_loading = false;\n            vm.check_logbook_error = false;\n            vm.check_workpack = null;\n            vm.check_workpack_loading = false;\n\n            vm.viewMaintenanceCheck = function(log) {\n                if (!vm.isMaintenanceEntry(log)) return;\n                vm.selected_check = log;\n                vm.show_check_detail = true;\n\n                // Reset state\n                vm.check_logbook_links = [];\n                vm.check_logbook_error = false;\n                vm.check_workpack = null;\n\n                var checkData = log.maintenance_check || {};\n                var checkId = checkData.id || log.maintenance_check_id || null;\n                if (checkId) {\n                    vm.loadCheckLogbookLinks(checkId);\n                    vm.loadCheckWorkpack(log);\n                }\n            };\n\n            vm.closeMaintenanceCheck = function() {\n                vm.selected_check = null;\n                vm.show_check_detail = false;\n                vm.check_logbook_links = [];\n                vm.check_logbook_error = false;\n                vm.check_workpack = null;\n            };\n\n            // Load logbook associations for a maintenance check.\n            vm.loadCheckLogbookLinks = function(maintenance_check_id) {\n                if (!maintenance_check_id) return;\n                vm.check_logbook_loading = true;\n                vm.check_logbook_error = false;\n                vm.check_logbook_links = [];\n\n                LogbookLinkService.GetAvailableLogbooks($stateParams.plane_id)\n                    .then(function(availData) {\n                        var available = (availData && availData.available_logbooks) ? availData.available_logbooks : [];\n                        if (available.length === 0) {\n                            vm.check_logbook_loading = false;\n                            vm.check_logbook_error = true;\n                            return;\n                        }\n\n                        LogbookLinkService.GetLinks(maintenance_check_id)\n                            .then(function(linkData) {\n                                vm.check_logbook_loading = false;\n                                var links = [];\n                                if (linkData && linkData.maintenance_check && linkData.maintenance_check.logbook_links) {\n                                    links = linkData.maintenance_check.logbook_links;\n                                }\n                                // Build list: each available logbook with isLinked flag\n                                vm.check_logbook_links = available.map(function(lb) {\n                                    var isLinked = links.some(function(link) {\n                                        return link.logbook_type === lb.logbook_type &&\n                                               link.logbook_entity_id == lb.logbook_entity_id;\n                                    });\n                                    return {\n                                        logbook_type: lb.logbook_type,\n                                        logbook_entity_id: lb.logbook_entity_id,\n                                        label: lb.label,\n                                        position: lb.position || null,\n                                        isLinked: isLinked\n                                    };\n                                });\n                            }, function() {\n                                vm.check_logbook_loading = false;\n                                vm.check_logbook_error = true;\n                            });\n                    }, function() {\n                        vm.check_logbook_loading = false;\n                        vm.check_logbook_error = true;\n                    });\n            };\n\n            // Load linked workpack detail\n            vm.loadCheckWorkpack = function(log) {\n                var d = log.maintenance_check || {};\n                var wpId = d.linked_workpack_id || d.workpack_id || null;\n                if (!wpId) return;\n                vm.check_workpack_loading = true;\n                WorkpackService.GetById(wpId)\n                    .then(function(data) {\n                        vm.check_workpack_loading = false;\n                        if (data && data.workpack) {\n                            vm.check_workpack = data.workpack;\n                        }\n                    }, function() {\n                        vm.check_workpack_loading = false;\n                    });\n            };\n\n            vm.downloadWorkpackDocument = function(filename) {\n                if (!filename) return;\n                $http.get('/api/v1/maintenance_workpacks/file/' + filename, {\n                    responseType: 'arraybuffer'\n                }).success(function(data, status, headers) {\n                    var blob = new Blob([data], { type: 'application/pdf' });\n                    var fileURL = URL.createObjectURL(blob);\n                    var prntWin = window.open();\n                    prntWin.document.write('<html><head><title>Workpack Document</title></head><body>'\n                        + '<embed width=\"100%\" height=\"100%\" name=\"plugin\" src=\"' + fileURL + '\" '\n                        + 'type=\"application/pdf\" internalinstanceid=\"21\"></body></html>');\n                    prntWin.document.close();\n                }).error(function() {\n                    ToastService.error('Download Error', 'There was an error downloading the workpack document.');\n                });\n            };\n\n            vm.getLogbookIcon = function(type) {\n                switch (type) {\n                    case 'airframe': return 'fa-plane';\n                    case 'engine': return 'fa-cog';\n                    case 'propeller': return 'fa-refresh';\n                    default: return 'fa-book';\n                }\n            };\n\n            vm.getCheckTypeIcon = function(type) {\n                if (!type) return 'fa-wrench';\n                switch (type.toLowerCase()) {\n                    case 'annual': return 'fa-calendar-check-o';\n                    case '50hours': case '50hour': case '25hours': case '100hours': case '100hour': case '150hour': return 'fa-tachometer';\n                    case 'extension': return 'fa-clock-o';\n                    case 'interim': return 'fa-cogs';\n                    case '6months': return 'fa-calendar';\n                    case 'cofa': case 'arc': return 'fa-certificate';\n                    case 'engine_overhaul': return 'fa-cog';\n                    case 'propeller_overhaul': return 'fa-repeat';\n                    case 'workpack': return 'fa-briefcase';\n                    default: return 'fa-wrench';\n                }\n            };\n\n            vm.update_logbooks = function(){\n                \n\n                PlaneService.UpdateAircraftLogbooks($stateParams.plane_id)\n                .then(function (data) {\n                        \n                        if(data.success){\n\n                            //lets reload the logbook elements!!\n                            PlaneService.GetEngineLogs($stateParams.engine_id,$stateParams.plane_id, 0, 25)\n                            .then(function (data) {\n                                    // //console.log(\"ALL is : \", data);\n                                   vm.logs = data.logs;\n                                   vm.engine = data.engine;\n                                   ToastService.success('Recheck Complete', 'The logbook has been re-checked');\n\n                                });\n\n                        }\n\n\n                    });\n            }\n\n\n\n\n\n        $scope.update_this_file = function(file){\n            //console.log(\"==== update is : \", file.id);\n            if(update_this_file.indexOf(file.id) === -1){\n                update_this_file.push(file.id)\n            } else {\n               ////console.log(\"This item already exists\"); \n            } \n        }\n\n\n         $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.club.plane.plane_documents = $.grep(vm.club.plane.plane_documents, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                PlaneDocumentService.Delete(vm.user_id, file.id)\n                .then(function (data) {\n                    // //console.log(data);\n                    if(data.success){\n                        // //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            // //console.log(\"REMOVE: \", j);\n            // //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n\n            //this SHOULD BE TO THE CURRENT POSITION\n\n            // PoidService.DeleteTmp(j.saved_url)\n            //     .then(function (data) {\n            //         //console.log(data);\n            //         if(data.success){\n            //             //console.log(\"HUZZAH\", current_files);\n            //             //then we need to remove this from the list of files...\n            //             //clear files\n            //             vm.plane_documents = [];\n            //             //and re-process available files\n            //             $scope.processFiles(current_files);\n\n            //         } else {\n            //             //console.log(\"WOOOPSIES...\");\n            //             //this should be very very rare...\n            //         }\n\n            //     });\n\n          }\n          \n\n          // $scope.$on('flow::fileAdded', function (event, $flow, flowFile) {\n          //     event.preventDefault();//prevent file from uploading\n          //     //console.log(\"FILE ADDED\");\n          //     //console.log($flow);\n          //   });\n\n            vm.files = {\n                radio: [],\n                cert: [],\n                insurance: []\n            }\n\n\n            $scope.processFiles = function(files, location){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    // //console.log(\"J is : \",j);\n                    // //console.log(\"name is : \", j.files.file.name);\n\n                    files[i].file.temp_path = j.saved_url;\n                    files[i].file.save_name = j.files.file.name;\n                    var ft = j.files.file.name;\n                    ft = ft.split('.').pop();\n                    files[i].file.extension = ft;\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.files[location].push(files[i].file);\n                }\n\n\n            }\n\n\n             $scope.processFile = function(files, location){\n                 //console.log(\"files\", files[0].file_return);\n\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[0].file_return);\n                    // //console.log(\"PARSED\", j);\n                    // //console.log(\"J is : \",j);\n                    // //console.log(\"name is : \", j.files.file.name);\n\n                    files[0].file.temp_path = j.saved_url;\n                    files[0].file.save_name = j.files.file.name;\n\n                    var ft = j.files.file.name;\n                    // //console.log(\"ft\", ft);\n                    var fft = ft.split('.').pop();\n                    files[0].file.extension = fft;\n                    // //console.log(\"FILE is : \", files[0]);\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.files[location].push(files[0]);\n\n\n            }\n\n            $scope.set_title = function(file){\n                // //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            $scope.get_icon2 = function(file){\n                ////console.log(\"FILE\", file);\n                if(!file || file == \"\"){\n                    return \"\";\n                }\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            vm.defect_severity;\n                vm.defect_severities = [\n                    { title: \"No Fly Item - Ground the plane\"},\n                    { title: \"Flyable - needs to be checked at next maintenance\"},\n                    { title: \"Not urgent - but needs noting\"},\n                    { title: \"Unsure of severity\"}\n                ]; \n\n\n            $scope.delete_poid = function(id){\n\n              \n                var a = prompt(\"Are you sure you wish to delete this poid? \\n\\n This change is irreversible! To confirm please type YES in the box below.\");\n                if(a == \"YES\"){\n\n\n                    //console.log(\"WE DELETE IT\");\n\n\n                    // PoidService.Delete(vm.user_id, id)\n                    //     .then(function (data) {\n                    //         //console.log(data);\n                    //         if(data.success){\n                    //             //console.log(\"HUZZAH\", data);\n                    //             //then we need to remove this from the list of files...\n                    //             vm.user_poids = $.grep(vm.user_poids, function(e){ \n                    //                 return e.id != id; \n                    //             });\n                                \n                    //             //refresh?\n                    //             $state.reload();\n                    //             $state.go('dashboard.my_account.poid');\n\n                    //         } else {\n\n                    //             alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n                    //         }\n\n                    //     });\n\n\n\n                } else {\n                    //console.log(\"ignore123\");\n                }\n\n\n            }\n\n\n\n\n            $scope.save_plane_documents = function(){\n\n               \n              \n\n                // //console.log(\"plane_documents: \", vm.plane_documents);\n\n\n                //compile the required elements YAY\n\n                // //console.log(\"plane_document \", vm.plane_document);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n                    // for(var i=0;i<vm.plane_document.images.length;i++){\n                    //     delete vm.plane_document.images[i].data_uri;\n                    // }\n\n                    // // vm.plane_document.images = vm.plane_documents;\n                    // vm.plane_document.images = vm.plane_document.images.concat(vm.plane_documents);\n                    // vm.plane_document.user_id = vm.user_id;\n\n\n\n\n            //     if(vm.plane_document.id){\n            //         //then its an udpate\n\n            //         //merge the images left?\n            //         PoidService.Update(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                     $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n            //     } else {\n\n\n                   \n\n\n            //         //then its a create\n            //         //console.log(vm.plane_document);\n\n            //         PoidService.Create(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                    // $state.reload();\n            //                    // $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n\n            //     }\n\n\n\n             };\n\n\n\n\n             $scope.change_file_name = function(file){\n                \n                //this is terribly ineficient... unfortunately... can't \n                //work out how else to do it! (lol)\n\n                // //console.log(\"TO BE CHANGED\", file);\n\n                // //console.log(\"BEFORE BEFORE\", vm.plane_documents);\n\n                vm.plane_documents = $.grep(vm.plane_documents, function(e){ \n                    return e.temp_path != file.temp_path; \n                });\n\n                // //console.log(\"BEFORE\", vm.plane_documents);\n\n                vm.plane_documents.push(file);\n\n                // //console.log(\"AFTER\", vm.plane_documents);\n\n             }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n          //var warning_msg = \"By deleting this plane, you will also cancel all reservations that this plane currently has.\"\n\n          // $scope.open = function (plane_id) {\n          //   var modalInstance = $uibModal.open({\n          //     animation: true,\n          //     templateUrl: 'views/modals/deleteModal.html',\n          //     controller: 'ModalInstanceCtrl',\n          //     //params: {},\n          //     size: \"lg\",\n          //     resolve: {\n          //       id: function () {\n          //         return plane_id;\n          //       },\n          //       warning: function(){\n          //           return warning_msg;\n          //       }\n          //     }\n          //   });\n          //   modalInstance.result.then(function (plane_id) {\n          //     $log.info('PRESSED GO: '+plane_id);\n          //     PlaneService.Delete(plane_id)\n          //     .then(function(){\n          //       //console.log(\"HELLO DELETE\");\n          //       //update view?\n          //        vm.club.planes = $.grep(vm.club.planes, function(e){ \n          //           return e.plane_id != plane_id; \n          //       });\n          //     })\n          //   }, function () {\n          //     $log.info('Modal dismissed at: ' + new Date());\n          //   });\n          // };\n\n            $scope.open = function (club_plane_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return club_plane_id;\n                },\n                params: function() {\n                  return {id: club_plane_id};\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (plane) {\n                var id = plane.id;\n              $log.info('PRESSED GO: ', id);\n              \n              PlaneService.Delete(id)\n              .then(function(){\n                // //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.planes = $.grep(vm.club.planes, function(e){ \n                    return e.id != id; \n                });\n             });\n\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n\n\n          };\n         \n          \n\n\n        //   $scope.downloadCertificate = function(doc) {\n        //     var data = $.param({\n        //         id: doc\n        //     });\n\n        //     var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n        //     $http.get('api/v1/plane_certificate/show_file/'+ddd, {\n        //             responseType: 'arraybuffer'\n        //         })\n        //         .success(function(data, status, headers) {\n        //             var zipName = processArrayBufferToBlob(data, headers);\n\n        //             //Delete file from temp folder in server - file needs to remain open until blob is created\n        //             //deleteFileFromServerTemp(zipName);\n        //         }).error(function(data, status) {\n        //             alert(\"There was an error downloading the selected document(s).\");\n        //         })\n        // };\n\n\n        // $scope.downloadInsurance = function(doc) {\n        //     var data = $.param({\n        //         id: doc\n        //     });\n\n        //     var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n        //     $http.get('api/v1/plane_insurance/show_file/'+ddd, {\n        //             responseType: 'arraybuffer'\n        //         })\n        //         .success(function(data, status, headers) {\n        //             var zipName = processArrayBufferToBlob(data, headers);\n\n        //             //Delete file from temp folder in server - file needs to remain open until blob is created\n        //             //deleteFileFromServerTemp(zipName);\n        //         }).error(function(data, status) {\n        //             alert(\"There was an error downloading the selected document(s).\");\n        //         })\n        // };\n\n\n\n\n        $scope.downloadDocument = function(doc, type = 'docs') {\n            var data = $.param({\n                id: doc\n            });\n\n            var controller = \"plane_documents\";\n\n            switch(type){\n                 case \"radio\": \n                    controller = \"plane_radio_licence\";\n                break;\n                 case \"insurance\": \n                    controller = \"plane_insurance\";\n                break;\n                 case \"certificate\": \n                    controller = \"plane_certificate\";\n                break;\n                case \"noise\": \n                    controller = \"plane_noise_certificate\";\n                break;\n                case \"docs\": \n                    controller = \"plane_documents\";\n                break;\n                default:\n                    controller = \"plane_documents\";\n                break;\n\n            }\n\n\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/'+controller+'/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        $scope.downloadClubDocument = function(doc) {\n            var data = $.param({\n                id: doc\n            });\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/club_documents/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        function processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], {\n                    type: contentType\n                });\n                if (navigator.msSaveBlob)\n                    navigator.msSaveBlob(blob, filename);\n                else {\n                    // Try using other saveBlob implementations, if available\n                    var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                    if (saveBlob === undefined) throw \"Not supported\";\n                    saveBlob(blob, filename);\n                }\n                success = true;\n            } catch (ex) {\n                $log.info(\"saveBlob method failed with the following exception:\");\n                $log.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            $log.info(\"Download link method with simulated click failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n\n\n\n        $scope.search2 = function(row){\n            //(angular.lowercase(row.first_name).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)  || (angular.lowercase(row.last_name).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)\n            ////console.log(\"answer\", (angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1));\n            // return ((angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || (angular.lowercase(row.flight_time).indexOf(angular.lowercase($scope.my_search2)) || '') !== -1)));\n            //(angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)\n           \n            // if( (test_date($scope.my_search2, row.flight_date)) || (angular.lowercase(row.destination_airport).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) || (angular.lowercase(row.departure_airport).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) || (angular.lowercase(row.destination_airport_code).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) || (angular.lowercase(row.departure_airport_code).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)){\n            //     return true;\n            // } else {\n            //     return false;\n            // }test_aircraft\n\n            //console.log(\"TEST \" , test_date($scope.my_search2));\n\n            ////console.log($scope.my_search2);\n            if(!$scope.my_search2 || ($scope.my_search2 == \"\")){\n                return true;\n            } else if(test_date($scope.my_search2, row.entry_date)){\n                return true;\n            } else {\n                return false;\n            }\n\n            // we are testing for the date, the pilot, the departure and destination.\n\n            // return (angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1); // ? (angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) : (angular.lowercase(row.flight_time).indexOf(angular.lowercase($scope.my_search2) || '') !== -1);\n\n        };\n\n        function test_date(search, date){\n\n\n            if(search.length < 2){\n                return false;\n            }\n\n            if(search && search.length <= 3){\n                if(date.indexOf(search) > -1){\n                    return true;\n                }\n            } else {\n                var parsed_date = \"\";\n                var b = moment(search);\n                if(b.isValid() && b.format(\"YYYY\") != \"2001\"){\n                    parsed_date = b.format(\"YYYY-MM-DD\");\n                } else if(b.isValid()){\n                    parsed_date = b.format(\"MM-DD\");\n                }\n\n\n                var search_type = 0;\n\n                if(parsed_date !== \"\" && date.indexOf(parsed_date) > -1){\n                    // //console.log(\"found\");\n                    return true;\n                } else {\n\n                    //backup in case of wrong parsing data::;\n                    //european method\n\n                    if(search.length <= 5 && search.length >= 4){\n\n                        var c = moment(search, \"DDMM\");\n                        // //console.log(\"C is : \", c);\n                        if(c.isValid()){\n                            var c2 = c.format(\"MM-DD\");\n                            if(date.indexOf(c2) > -1){\n                                return true;\n                            }\n                        }\n\n                    } else if(search.length == 8 || search.length == 10){\n                        \n                        var c = moment(search, \"DDMMYYYY\");\n                        // //console.log(\"C is : \", c);\n                        if(c.isValid()){\n                            var c2 = c.format(\"YYYY-MM-DD\");\n                            if(date.indexOf(c2) > -1){\n                                return true;\n                            }\n                        }\n\n                    }\n\n                    // //console.log(\"not found\");\n                    return false;\n                }\n            }\n\n        }\n\n        $scope.getMySearchCount = function(str){\n            var docs = str.documents;\n            var total = 0;\n            for(var i=0;i<docs.length;i++){\n                if($scope.search(docs[i])){\n                    total++;\n                }\n            }\n            return total;\n        }\n\n        $scope.getMySearchCount2 = function(str){\n            var charges = str.charges;\n            var total = 0;\n            for(var i=0;i<charges.length;i++){\n                if($scope.search(charges[i])){\n                    total++;\n                }\n            }\n            return total;\n        }\n\n\n    }\n app.controller('DashboardClubExperienceDiscountsController', DashboardClubExperienceDiscountsController);\n\n    DashboardClubExperienceDiscountsController.$inject = ['UserService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'LicenceService', 'MedicalService', 'DifferencesService', 'ExperiencesService', 'ToastService'];\n    function DashboardClubExperienceDiscountsController(UserService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, LicenceService, MedicalService, DifferencesService, ExperiencesService, ToastService) {\n        var vm = this;\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {\n            item: {\n            }\n        };\n        vm.page_title = \"\";\n        \n        vm.plane_document = {};\n        vm.plane_documents = [];\n\n        var update_this_file = [];\n        \n\n        vm.action = $state.current.data.action;\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n        vm.charge_type = [\"brakes\", \"session\", \"plane\"];\n\n\n        vm.planes = [];\n   \n\n        ExperiencesService.GetByClubId(vm.club_id)\n                    .then(function(data){\n                        //console.log(\"planes\", data);\n                        vm.experiences = data.items;\n                    });\n\n        ////console.log(\"club_id : \"+vm.club_id);\n\n        // //console.log(vm.action);\n         //console.log($stateParams);\n        // //console.log($stateParams.id);\n        switch(vm.action){\n            case \"add\":\n                //console.log(\"adding a new plane please\");\n                vm.page_title = \"Add an Experience\";\n            break;\n            case \"edit\":\n                //console.log(\"edit an existing plane\");\n                 //console.log($stateParams);\n                ExperiencesService.GetById($stateParams.id)\n                    .then(function(data){\n                        vm.club.item = data.item; \n                        //console.log(vm.club);\n                        // vm.page_title = \"Edit an Experience - \"+vm.club.item.title;\n                    });\n\n\n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                ExperiencesService.GetDiscountsByClubId(vm.club_id)\n                    .then(function(data){\n                        vm.club.items = data.items;   \n                        //console.log(vm.club.items);\n                    });\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n        //'9' needs to refer the the user's account set to manage\n       \n\n        $scope.check_code = function(){\n            //console.log(\"CHECKING NOW\");\n        }\n\n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        vm.clearFieldError = function(event) { ToastService.clearFieldError(event); };\n\n        $scope.save = function(){\n            var checks = [\n                { ok: vm.club.item.experience && vm.club.item.experience.id, field: 'experience_select', label: 'Experience' },\n                { ok: vm.club.item.discount_type && vm.club.item.discount_type !== '0', field: 'discount_type', label: 'Discount Type' },\n                { ok: vm.club.item.discount_code, field: 'discount_code', label: 'Discount Code' }\n            ];\n            if (vm.club.item.discount_type == '1') {\n                checks.push({ ok: vm.club.item.price != null && vm.club.item.price !== '', field: 'price', label: 'Discounted Price' });\n            }\n            if (vm.club.item.discount_type == '2') {\n                checks.push({ ok: vm.club.item.percentage != null && vm.club.item.percentage !== '', field: 'percentage', label: 'Discounted Percentage' });\n            }\n            if (!ToastService.validateForm(checks)) return;\n\n            if(vm.action == \"add\"){\n                $scope.create();\n            } else {\n                $scope.update();\n            }\n        }\n\n\n        $scope.create = function(){\n            //console.log(\"CREATE ME NOW\");\n            vm.club.item.experience_id = vm.club.item.experience.id;\n            delete vm.club.item.experience;\n            vm.club.item.club_id = vm.club_id;\n            ExperiencesService.CreateDiscount(vm.club.item)\n                .then(function(data){\n                    //console.log(data);\n                    //$state.reload();\n                    $state.go('dashboard.manage_club.experience_discounts', {}, {reload: true});\n\n                });\n        }\n\n        $scope.delete = function(){\n            //console.log(\"CLICK\");\n            ToastService.warning('Confirm Delete', 'Are you sure you would like to delete this plane?');\n            ExperiencesService.DeleteDiscount(vm.user.id, vm.club.item)\n                .then(function(data){\n                    //console.log(data);\n                });\n        }\n\n        function get_update_docs(){\n            var documents = [];\n\n            for(var i=0;i<update_this_file.length;i++){\n                var id = update_this_file[i];\n                //console.log(\"looking for : \", id);\n                //console.log(\"in: \", vm.plane_documents);\n\n                for(var k=0;k<vm.club.plane.plane_documents.length;k++){\n                    //console.log(\"comparing to : \", vm.club.plane.plane_documents[k].id);\n                    if(vm.club.plane.plane_documents[k].id == id){\n                        documents.push(vm.club.plane.plane_documents[k]);\n                    }\n                }\n\n            }\n\n            // //console.log(\"DOCS TO UPDATE : \", documents);\n\n            return documents;\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n            vm.club.item.club_id = vm.club_id;\n            ExperiencesService.UpdateDiscount(vm.club.item, vm.user.id)\n                .then(function(data){\n                    //console.log(data);\n                    //console.log(\"saved\");\n                    //$state.reload();\n                    $state.go('dashboard.manage_club.experience_discounts', {}, {reload: true});\n                });\n        }\n\n\n        function containsObject(obj, list, params) {\n\n            // //console.log(\"obj\", obj);\n            // //console.log(\"list\", list);\n            // //console.log(\"params\", params);\n\n            for(var i=0; i<list.length; i++) {\n                // //console.log(\"list i : \", list[i]);\n                // //console.log(\"obj is: \", obj);\n\n                var count_success = 0;\n                for(var j=0;j<params.length;j++){\n                    if(list[i][params[j]] && obj[params[j]] && list[i][params[j]] == obj[params[j]]){\n                        count_success++;\n                    }\n                }\n\n                if(count_success === params.length) {                    \n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n\n\n\n        function check_all(){\n\n            //maybe a nice to have one day... not yet though.\n\n\n            //licences\n            vm.club.plane.requirements.licence.forEach(function(obj){\n\n            });\n\n        }\n\n      \n\n\n\n        $scope.add_item = function(type){\n            //console.log(\"ADD\");\n            switch(type){\n                case \"plane\":\n                    //console.log(\"plane\");\n                    if(vm.temporary.plane && vm.temporary.plane !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        // var add_plane = {\n                        //     id: vm.temporary.plane.id\n                        // };\n\n                        //check if it doesnt exist first...\n                        //if(vm.club.item.planes && vm.club.item.planes.indexOf(vm.temporary.plane.plane_id) == -1){\n\n\n                        if(!vm.club.item.planes){\n                            vm.club.item.planes = [];\n                        }\n\n                        if(containsObject(vm.temporary.plane, vm.club.item.planes, new Array(\"plane_id\") ) == false){\n                            vm.club.item.planes.push(vm.temporary.plane);\n\n                            // vm.club.item.planes.indexOf(vm.temporary.plane)\n                            // vm.planes.filter(function(el) { return el.plane_id !== vm.temporary.plane.plane_id; });\n                        } \n\n                        delete vm.temporary.plane;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a plane that this activity be done on!');\n                    }\n\n                break;\n\n            }\n\n\n\n        }\n\n\n        $scope.remove_item = function(type, index){\n            //console.log(\"REMOVE\");\n\n            vm.club.item.planes.splice(index, 1);\n\n\n            // switch(type){\n            //     case \"plane\":\n            //             //console.log(\"plane\");\n                   \n            //             //check if it doesnt exist first...\n            //             // if(containsObject(add_licence, vm.club.plane.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n            //             //     vm.club.plane.requirements.licence.push(add_licence);\n            //             // }\n\n            //             vm.club.item.planes.splice(index, 1);\n                      \n            //     break;\n            // }\n\n\n            //     case \"medical\":\n            //         //console.log(\"medical\");\n            //         if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_medical = {\n            //                 authority_id: vm.temporary.medical_authority.id,\n            //                 authority_title: vm.temporary.medical_authority.abbreviation,\n            //                 medical_component_id: vm.temporary.medical_component.id,\n            //                 medical_component_title: vm.temporary.medical_component.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_medical, vm.club.plane.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n            //                 vm.club.plane.requirements.medical.push(add_medical);\n            //             }\n\n            //             delete vm.temporary.medical_authority;\n            //             delete vm.temporary.medical_component;\n\n            //         } else {\n            //             alert(\"Please select a medical that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            //     case \"differences\":\n            //         //console.log(\"difference\");\n            //         if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_difference = {\n            //                 difference_id: vm.temporary.difference.id,\n            //                 difference_title: vm.temporary.difference.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_difference, vm.club.plane.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n            //                 vm.club.plane.requirements.differences.push(add_difference);\n            //             }\n\n            //             delete vm.temporary.difference;\n\n            //         } else {\n            //             alert(\"Please select a difference that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            // }\n\n\n\n        }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        $scope.update_this_file = function(file){\n            //console.log(\"==== update is : \", file.id);\n            if(update_this_file.indexOf(file.id) === -1){\n                update_this_file.push(file.id)\n            } else {\n               ////console.log(\"This item already exists\"); \n            } \n        }\n\n\n         $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.club.plane.plane_documents = $.grep(vm.club.plane.plane_documents, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                PlaneDocumentService.Delete(vm.user.id, file.id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            //console.log(\"REMOVE: \", j);\n            //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            PoidService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n          // $scope.$on('flow::fileAdded', function (event, $flow, flowFile) {\n          //     event.preventDefault();//prevent file from uploading\n          //     //console.log(\"FILE ADDED\");\n          //     //console.log($flow);\n          //   });\n\n            $scope.processFiles = function(files){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    //console.log(\"J is : \",j);\n                    //console.log(\"name is : \", j.files.file.name);\n\n                    files[i].file.temp_path = j.saved_url;\n                    files[i].file.save_name = j.files.file.name;\n                    var ft = j.files.file.name;\n                    ft = ft.split('.').pop();\n                    files[i].file.extension = ft;\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.plane_documents.push(files[i].file);\n                }\n\n\n            }\n\n            $scope.set_title = function(file){\n                //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            $scope.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n\n            $scope.delete_poid = function(id){\n\n              \n                var a = prompt(\"Are you sure you wish to delete this poid? \\n\\n This change is irreversible! To confirm please type YES in the box below.\");\n                if(a == \"YES\"){\n\n\n                    //console.log(\"WE DELETE IT\");\n\n\n                    // PoidService.Delete(vm.user_id, id)\n                    //     .then(function (data) {\n                    //         //console.log(data);\n                    //         if(data.success){\n                    //             //console.log(\"HUZZAH\", data);\n                    //             //then we need to remove this from the list of files...\n                    //             vm.user_poids = $.grep(vm.user_poids, function(e){ \n                    //                 return e.id != id; \n                    //             });\n                                \n                    //             //refresh?\n                    //             $state.reload();\n                    //             $state.go('dashboard.my_account.poid');\n\n                    //         } else {\n\n                    //             alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n                    //         }\n\n                    //     });\n\n\n\n                } else {\n                    //console.log(\"ignore123\");\n                }\n\n\n            }\n\n\n\n\n            $scope.save_plane_documents = function(){\n\n               \n              \n\n                //console.log(\"plane_documents: \", vm.plane_documents);\n\n\n                //compile the required elements YAY\n\n                //console.log(\"plane_document \", vm.plane_document);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n                    // for(var i=0;i<vm.plane_document.images.length;i++){\n                    //     delete vm.plane_document.images[i].data_uri;\n                    // }\n\n                    // // vm.plane_document.images = vm.plane_documents;\n                    // vm.plane_document.images = vm.plane_document.images.concat(vm.plane_documents);\n                    // vm.plane_document.user_id = vm.user_id;\n\n\n\n\n            //     if(vm.plane_document.id){\n            //         //then its an udpate\n\n            //         //merge the images left?\n            //         PoidService.Update(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                     $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n            //     } else {\n\n\n                   \n\n\n            //         //then its a create\n            //         //console.log(vm.plane_document);\n\n            //         PoidService.Create(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                    // $state.reload();\n            //                    // $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n\n            //     }\n\n\n\n             };\n\n\n\n\n             $scope.change_file_name = function(file){\n                \n                //this is terribly ineficient... unfortunately... can't \n                //work out how else to do it! (lol)\n\n                // //console.log(\"TO BE CHANGED\", file);\n\n                // //console.log(\"BEFORE BEFORE\", vm.plane_documents);\n\n                vm.plane_documents = $.grep(vm.plane_documents, function(e){ \n                    return e.temp_path != file.temp_path; \n                });\n\n                // //console.log(\"BEFORE\", vm.plane_documents);\n\n                vm.plane_documents.push(file);\n\n                // //console.log(\"AFTER\", vm.plane_documents);\n\n             }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n            var warning_msg = \"By deleting this plane, you will also cancel all reservations that this plane currently has.\"\n\n          $scope.open = function (plane_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return plane_id;\n                },\n                params: function() {\n                  return {id: plane_id};\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (plane_id) {\n              $log.info('PRESSED GO: '+plane_id.id);\n              ExperiencesService.Delete(vm.user.id, plane_id.id)\n              .then(function(){\n                //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.items = $.grep(vm.club.items, function(e){ \n                    return e.id != plane_id.id; \n                });\n              })\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n          };\n\n         \n\n\n    }\n app.controller('DashboardClubExperiencesController', DashboardClubExperiencesController);\n\n    DashboardClubExperiencesController.$inject = ['UserService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'LicenceService', 'MedicalService', 'DifferencesService', 'ExperiencesService', 'ToastService'];\n    function DashboardClubExperiencesController(UserService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, LicenceService, MedicalService, DifferencesService, ExperiencesService, ToastService ) {\n        var vm = this;\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {\n            item: {\n                planes: []\n            }\n        };\n        vm.page_title = \"\";\n        \n        vm.plane_document = {};\n        vm.plane_documents = [];\n\n        var update_this_file = [];\n        \n\n        vm.action = $state.current.data.action;\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n        vm.charge_type = [\"brakes\", \"session\", \"plane\"];\n\n\n        vm.planes = [];\n        vm.club.item.planes = [];\n        vm.temporary = {};\n        vm.temporary.plane = {};\n\n        PlaneService.GetAllByClub(vm.club_id)\n                    .then(function(data){\n                        //console.log(\"planes\", data);\n                        vm.planes = data;\n                    });\n\n        ////console.log(\"club_id : \"+vm.club_id);\n\n        // //console.log(vm.action);\n         //console.log($stateParams);\n        // //console.log($stateParams.id);\n        switch(vm.action){\n            case \"add\":\n                //console.log(\"adding a new plane please\");\n                vm.page_title = \"Add an Experience\";\n            break;\n            case \"edit\":\n                //console.log(\"edit an existing plane\");\n                 //console.log($stateParams);\n                ExperiencesService.GetById($stateParams.id)\n                    .then(function(data){\n                        vm.club.item = data.item; \n                        //console.log(vm.club);\n                        // vm.page_title = \"Edit an Experience - \"+vm.club.item.title;\n                    });\n\n\n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                ExperiencesService.GetByClubId(vm.club_id)\n                    .then(function(data){\n                        vm.club.items = data.items;   \n                        //console.log(vm.club.items);\n                    });\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n        //'9' needs to refer the the user's account set to manage\n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        vm.clearFieldError = function(event) { ToastService.clearFieldError(event); };\n\n        $scope.save = function(){\n            var item = vm.club.item || {};\n            var checks = [\n                { ok: item.title,                                                              field: 'title',            label: 'Title' },\n                { ok: item.price != null && item.price !== '',                                  field: 'price',            label: 'Price' },\n                { ok: item.valid_for != null && item.valid_for !== '',                          field: 'valid_for',        label: 'Validity (days)' },\n                { ok: item.booking_duration != null && item.booking_duration !== '',             field: 'booking_duration', label: 'Slot Required (hours)' }\n            ];\n            if (!ToastService.validateForm(checks)) return;\n\n            if (!item.planes || item.planes.length < 1) {\n                ToastService.highlightField('.card');\n                ToastService.warning('Aircraft Required', 'You must add at least 1 aircraft to this experience.');\n                return;\n            }\n\n            if(vm.action == \"add\"){\n                $scope.create();\n            } else {\n                $scope.update();\n            }\n        }\n\n\n        $scope.create = function(){\n            //console.log(\"CREATE ME NOW\");\n            vm.club.item.club_id = vm.club_id;\n            ExperiencesService.Create(vm.club.item)\n                .then(function(data){\n                    //console.log(data);\n                    //$state.reload();\n                    $state.go('dashboard.manage_club.experiences', {}, {reload: true});\n\n                });\n        }\n\n        $scope.delete = function(){\n            //console.log(\"CLICK\");\n            ToastService.warning('Confirm Delete', 'Are you sure you would like to delete this plane?');\n            ExperiencesService.Delete(vm.user.id, vm.club.item)\n                .then(function(data){\n                    //console.log(data);\n                });\n        }\n\n        function get_update_docs(){\n            var documents = [];\n\n            for(var i=0;i<update_this_file.length;i++){\n                var id = update_this_file[i];\n                //console.log(\"looking for : \", id);\n                //console.log(\"in: \", vm.plane_documents);\n\n                for(var k=0;k<vm.club.plane.plane_documents.length;k++){\n                    //console.log(\"comparing to : \", vm.club.plane.plane_documents[k].id);\n                    if(vm.club.plane.plane_documents[k].id == id){\n                        documents.push(vm.club.plane.plane_documents[k]);\n                    }\n                }\n\n            }\n\n            // //console.log(\"DOCS TO UPDATE : \", documents);\n\n            return documents;\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n            vm.club.item.club_id = vm.club_id;\n            ExperiencesService.Update(vm.club.item, vm.user.id)\n                .then(function(data){\n                    //console.log(data);\n                    //console.log(\"saved\");\n                    //$state.reload();\n                    $state.go('dashboard.manage_club.experiences', {}, {reload: true});\n                });\n        }\n\n\n        function containsObject(obj, list, params) {\n\n            // //console.log(\"obj\", obj);\n            // //console.log(\"list\", list);\n            // //console.log(\"params\", params);\n\n            for(var i=0; i<list.length; i++) {\n                // //console.log(\"list i : \", list[i]);\n                // //console.log(\"obj is: \", obj);\n\n                var count_success = 0;\n                for(var j=0;j<params.length;j++){\n                    if(list[i][params[j]] && obj[params[j]] && list[i][params[j]] == obj[params[j]]){\n                        count_success++;\n                    }\n                }\n\n                if(count_success === params.length) {                    \n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n\n\n\n        function check_all(){\n\n            //maybe a nice to have one day... not yet though.\n\n\n            //licences\n            vm.club.plane.requirements.licence.forEach(function(obj){\n\n            });\n\n        }\n\n      \n\n\n\n        $scope.add_item = function(type){\n            //console.log(\"ADD\");\n            switch(type){\n                case \"plane\":\n                    //console.log(\"plane\");\n                    if(vm.temporary.plane && vm.temporary.plane.id){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        // var add_plane = {\n                        //     id: vm.temporary.plane.id\n                        // };\n\n                        //check if it doesnt exist first...\n                        //if(vm.club.item.planes && vm.club.item.planes.indexOf(vm.temporary.plane.plane_id) == -1){\n\n\n                        if(!vm.club.item.planes){\n                            vm.club.item.planes = [];\n                        }\n\n                        if(containsObject(vm.temporary.plane, vm.club.item.planes, new Array(\"plane_id\") ) == false){\n                            vm.club.item.planes.push(vm.temporary.plane);\n\n                            // vm.club.item.planes.indexOf(vm.temporary.plane)\n                            // vm.planes.filter(function(el) { return el.plane_id !== vm.temporary.plane.plane_id; });\n                        } \n\n                        delete vm.temporary.plane;\n\n                    } else {\n                        ToastService.highlightField('add_aircraft_select');\n                        ToastService.warning('Missing Plane', 'Please select a plane that this activity be done on!');\n                    }\n\n                break;\n\n            }\n\n\n\n        }\n\n\n        $scope.remove_item = function(type, index){\n            //console.log(\"REMOVE\");\n\n            vm.club.item.planes.splice(index, 1);\n\n\n            // switch(type){\n            //     case \"plane\":\n            //             //console.log(\"plane\");\n                   \n            //             //check if it doesnt exist first...\n            //             // if(containsObject(add_licence, vm.club.plane.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n            //             //     vm.club.plane.requirements.licence.push(add_licence);\n            //             // }\n\n            //             vm.club.item.planes.splice(index, 1);\n                      \n            //     break;\n            // }\n\n\n            //     case \"medical\":\n            //         //console.log(\"medical\");\n            //         if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_medical = {\n            //                 authority_id: vm.temporary.medical_authority.id,\n            //                 authority_title: vm.temporary.medical_authority.abbreviation,\n            //                 medical_component_id: vm.temporary.medical_component.id,\n            //                 medical_component_title: vm.temporary.medical_component.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_medical, vm.club.plane.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n            //                 vm.club.plane.requirements.medical.push(add_medical);\n            //             }\n\n            //             delete vm.temporary.medical_authority;\n            //             delete vm.temporary.medical_component;\n\n            //         } else {\n            //             alert(\"Please select a medical that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            //     case \"differences\":\n            //         //console.log(\"difference\");\n            //         if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_difference = {\n            //                 difference_id: vm.temporary.difference.id,\n            //                 difference_title: vm.temporary.difference.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_difference, vm.club.plane.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n            //                 vm.club.plane.requirements.differences.push(add_difference);\n            //             }\n\n            //             delete vm.temporary.difference;\n\n            //         } else {\n            //             alert(\"Please select a difference that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            // }\n\n\n\n        }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        $scope.update_this_file = function(file){\n            //console.log(\"==== update is : \", file.id);\n            if(update_this_file.indexOf(file.id) === -1){\n                update_this_file.push(file.id)\n            } else {\n               ////console.log(\"This item already exists\"); \n            } \n        }\n\n\n         $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.club.plane.plane_documents = $.grep(vm.club.plane.plane_documents, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                PlaneDocumentService.Delete(vm.user.id, file.id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            //console.log(\"REMOVE: \", j);\n            //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            PoidService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n          // $scope.$on('flow::fileAdded', function (event, $flow, flowFile) {\n          //     event.preventDefault();//prevent file from uploading\n          //     //console.log(\"FILE ADDED\");\n          //     //console.log($flow);\n          //   });\n\n            $scope.processFiles = function(files){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    //console.log(\"J is : \",j);\n                    //console.log(\"name is : \", j.files.file.name);\n\n                    files[i].file.temp_path = j.saved_url;\n                    files[i].file.save_name = j.files.file.name;\n                    var ft = j.files.file.name;\n                    ft = ft.split('.').pop();\n                    files[i].file.extension = ft;\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.plane_documents.push(files[i].file);\n                }\n\n\n            }\n\n            $scope.set_title = function(file){\n                //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            $scope.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n\n            $scope.delete_poid = function(id){\n\n              \n                var a = prompt(\"Are you sure you wish to delete this poid? \\n\\n This change is irreversible! To confirm please type YES in the box below.\");\n                if(a == \"YES\"){\n\n\n                    //console.log(\"WE DELETE IT\");\n\n\n                    // PoidService.Delete(vm.user_id, id)\n                    //     .then(function (data) {\n                    //         //console.log(data);\n                    //         if(data.success){\n                    //             //console.log(\"HUZZAH\", data);\n                    //             //then we need to remove this from the list of files...\n                    //             vm.user_poids = $.grep(vm.user_poids, function(e){ \n                    //                 return e.id != id; \n                    //             });\n                                \n                    //             //refresh?\n                    //             $state.reload();\n                    //             $state.go('dashboard.my_account.poid');\n\n                    //         } else {\n\n                    //             alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n                    //         }\n\n                    //     });\n\n\n\n                } else {\n                    //console.log(\"ignore123\");\n                }\n\n\n            }\n\n\n\n\n            $scope.save_plane_documents = function(){\n\n               \n              \n\n                //console.log(\"plane_documents: \", vm.plane_documents);\n\n\n                //compile the required elements YAY\n\n                //console.log(\"plane_document \", vm.plane_document);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n                    // for(var i=0;i<vm.plane_document.images.length;i++){\n                    //     delete vm.plane_document.images[i].data_uri;\n                    // }\n\n                    // // vm.plane_document.images = vm.plane_documents;\n                    // vm.plane_document.images = vm.plane_document.images.concat(vm.plane_documents);\n                    // vm.plane_document.user_id = vm.user_id;\n\n\n\n\n            //     if(vm.plane_document.id){\n            //         //then its an udpate\n\n            //         //merge the images left?\n            //         PoidService.Update(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                     $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n            //     } else {\n\n\n                   \n\n\n            //         //then its a create\n            //         //console.log(vm.plane_document);\n\n            //         PoidService.Create(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                    // $state.reload();\n            //                    // $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n\n            //     }\n\n\n\n             };\n\n\n\n\n             $scope.change_file_name = function(file){\n                \n                //this is terribly ineficient... unfortunately... can't \n                //work out how else to do it! (lol)\n\n                // //console.log(\"TO BE CHANGED\", file);\n\n                // //console.log(\"BEFORE BEFORE\", vm.plane_documents);\n\n                vm.plane_documents = $.grep(vm.plane_documents, function(e){ \n                    return e.temp_path != file.temp_path; \n                });\n\n                // //console.log(\"BEFORE\", vm.plane_documents);\n\n                vm.plane_documents.push(file);\n\n                // //console.log(\"AFTER\", vm.plane_documents);\n\n             }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n            var warning_msg = \"By deleting this plane, you will also cancel all reservations that this plane currently has.\"\n\n          $scope.open = function (plane_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return plane_id;\n                },\n                params: function() {\n                  return {id: plane_id};\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (plane_id) {\n              $log.info('PRESSED GO: '+plane_id.id);\n              ExperiencesService.Delete(vm.user.id, plane_id.id)\n              .then(function(){\n                //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.items = $.grep(vm.club.items, function(e){ \n                    return e.id != plane_id.id; \n                });\n              })\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n          };\n\n         \n\n\n    }\n app.controller('DashboardClubFlightsController', DashboardClubFlightsController);\n\n    DashboardClubFlightsController.$inject = ['UserService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'LicenceService', 'MedicalService', 'DifferencesService', 'PlaneDocumentService', 'ToastService'];\n    function DashboardClubFlightsController(UserService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, LicenceService, MedicalService, DifferencesService, PlaneDocumentService, ToastService) {\n        var vm = this;\n\n           //    /* PLEASE DO NOT COPY AND PASTE THIS CODE. */(function(){var w=window,C='___grecaptcha_cfg',cfg=w[C]=w[C]||{},N='grecaptcha';var gr=w[N]=w[N]||{};gr.ready=gr.ready||function(f){(cfg['fns']=cfg['fns']||[]).push(f);};(cfg['render']=cfg['render']||[]).push('explicit');(cfg['onload']=cfg['onload']||[]).push('initRecaptcha');w['__google_recaptcha_client']=true;var d=document,po=d.createElement('script');po.type='text/javascript';po.async=true;po.src='https://www.gstatic.com/recaptcha/releases/JPZ52lNx97aD96bjM7KaA0bo/recaptcha__en.js';var e=d.querySelector('script[nonce]'),n=e&&(e['nonce']||e.getAttribute('nonce'));if(n){po.setAttribute('nonce',n);}var s=d.getElementsByTagName('script')[0];s.parentNode.insertBefore(po, s);})();\n\n           // var initRecaptcha = function () { \n           //     // document.getElementById(\"SearchModule\").scope().vm.parent.isGrecaptchaLoaded = !0, \n           //     // document.getElementById(\"SearchModule\").scope().vm.showRecaptcha();\n           //     vm.showRecaptcha();\n           // };           \n\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {\n            plane: {\n                requirements: {\n                    licence: [],\n                    medical: [],\n                    differences: []\n                },\n                documents: []\n            }\n        };\n\n        vm.show_loading = false;\n\n        vm.page_title = \"\";\n        \n        vm.plane_document = {};\n        vm.plane_documents = [];\n\n        var update_this_file = [];\n        \n        \n        vm.currency_types = [\"class\", \"type\"];\n        vm.gear_types = [\"tricycle\", \"tailwheel\", \"monowheel\", \"floats\", \"amphibian\", \"skis\"];\n        // vm.certificates = [\"Certificate of Airworthiness\", \"National Certificate of Airworthiness\", \"Permit to Fly\"];\n        vm.certificates = [{id: 1, title: \"Certificate of Airworthiness\", value: \"cofa\"}, {id: 2, title: \"National Certificate of Airworthiness\", value: \"cofa\"}, {id: 2, title: \"LAA Permit to Fly\", value: \"ptf\"}];\n        vm.classes = [\"SEP (land)\", \"SEP (sea)\", \"SET (land)\", \"SET (sea)\", \"MEP (land)\", \"MEP (sea)\", \"ME\"];\n\n        vm.charge_type = [\"airborne\", \"brakes\", \"tacho\", \"hobbs\", \"flight\", \"brakes_rounded\"];\n        vm.surcharge_type = [\"none\", \"flight\", \"hour\"];\n\n        vm.action = $state.current.data.action;\n        vm.user = $rootScope.globals.currentUser;\n        //console.log(\"$rootScope.globals.currentUser : \", $rootScope.globals.currentUser);\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user_id = vm.user.id;\n\n\n       \n        // //console.log(vm.action);\n        // //console.log($stateParams);\n        // //console.log($stateParams.id);\n       \n        vm.to_date = new Date();\n        vm.from_date = new Date();\n        vm.aircraft = \"\";\n\n        vm.from_date.setMonth(vm.from_date.getMonth() - 1);\n        vm.show_loading = true;\n        PlaneService.GetAllFlightsByClub(vm.club_id, vm.from_date, vm.to_date, vm.selected_aircraft)\n        .then(function(data){\n            vm.flights = data.flights;  \n            vm.totals = data.totals; \n            vm.aircraft = data.aircraft; \n            vm.show_loading = false;\n            //console.log(vm.club.planes);\n        });\n\n\n         vm.editing = false;\n        \n        switch(vm.action){\n            case \"add\":\n                //console.log(\"adding a new plane please\");\n                vm.page_title = \"Add a New Plane\";\n            break;\n            case \"edit\":\n                vm.editing = true;\n                //console.log(\"edit an existing plane\");\n                PlaneService.GetById($stateParams.plane_id, vm.club_id)\n                    .then(function(data){\n                        vm.club.plane = data;   \n                        // vm.club.plane.requirements = {\n                        //         licence: [],\n                        //         medical: [],\n                        //         differences: [],\n                        //         hours: []\n                        // };\n\n                        console.log(vm.club.plane);\n\n                        vm.club.plane.airframe_hours = parseFloat(vm.club.plane.airframe_hours);\n\n                        vm.club.plane.vp = (vm.club.plane.vp == 1)? true:false;\n                        vm.club.plane.rg = (vm.club.plane.rg == 1)? true:false; \n                        vm.club.plane.tb = (vm.club.plane.tb == 1)? true:false; \n\n                        vm.plane_engine_1 = vm.club.plane.engine_1;\n                        vm.plane_engine_2 = vm.club.plane.engine_2;\n\n                        vm.plane_propeller_1 = vm.club.plane.propeller_1;\n                        vm.plane_propeller_2 = vm.club.plane.propeller_2;\n\n                        //console.log(vm.club);\n                        vm.page_title = \"Edit a Plane - \"+vm.club.plane.registration;\n                    });\n\n               \n\n\n               \n\n\n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n\n                PlaneService.GetAllByClub(vm.club_id)\n                    .then(function(data){\n                        vm.club.planes = data;   \n                        //console.log(vm.club.planes);\n                    });\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n        //'9' needs to refer the the user's account set to manage\n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        $scope.my_search = \"\";\n\n        $scope.search = function(row){\n            // console.log(\"hi\", (angular.lowercase(row.title).indexOf(angular.lowercase($scope.my_search) || '') !== -1));\n            //console.log(row);\n            if($scope.my_search == \"\"){\n                return true;\n            }\n            var my_return = false;\n            if(row && row.aircraft){\n                if(angular.lowercase(row.aircraft.registration).indexOf(angular.lowercase($scope.my_search) || '') !== -1){\n                    return true;\n                }\n            }\n            if(row && row.flight_date){\n                if(angular.lowercase(row.flight_date.toString()).indexOf(angular.lowercase($scope.my_search) || '') !== -1){\n                    return true;\n                }\n            }\n            if(row && row.from_airport && row.from_airport.code){\n                if(angular.lowercase(row.from_airport.code).indexOf(angular.lowercase($scope.my_search) || '') !== -1){\n                    return true;\n                }\n            }\n            if(row && row.from_airport && row.from_airport.title){\n                if(angular.lowercase(row.from_airport.title).indexOf(angular.lowercase($scope.my_search) || '') !== -1){\n                    return true;\n                }\n            }\n            if(row && row.to_airport && row.to_airport.code){\n                if(angular.lowercase(row.to_airport.code).indexOf(angular.lowercase($scope.my_search) || '') !== -1){\n                    return true;\n                }\n            }\n            if(row && row.to_airport && row.to_airport.title){\n                if(angular.lowercase(row.to_airport.title).indexOf(angular.lowercase($scope.my_search) || '') !== -1){\n                    return true;\n                }\n            }\n\n            return my_return;\n            // return ( (angular.lowercase(row.aircraft.registration).indexOf(angular.lowercase($scope.my_search) || '') !== -1) || \n            //         (angular.lowercase(row.flight_date.toString()).indexOf(angular.lowercase($scope.my_search) || '') !== -1) \n            //          );\n            /*\n    || (angular.lowercase(row.from_airport.title.toString()).indexOf(angular.lowercase($scope.my_search) || '') !== -1) ||\n                    (angular.lowercase(row.to_airport.title.toString()).indexOf(angular.lowercase($scope.my_search) || '') !== -1)\n            */\n        };\n\n        $scope.set_aircraft_details = function(){\n\n            // console.log(\"get deeeets\", vm.plane_search);\n\n            PlaneService.GetAddAircraft(vm.plane_search.registration)\n                .then(function (data) {\n                    ////console.log(data);\n\n                    // console.log(data);\n                                // return false;\n\n                    if(data){\n                        //use GB airfields first...\n                       \n                         if(data.length == 0){\n                            //console.log(\"SETTINGS HERE\");\n                                // vm.plane_search = \n                                //     {\n                                //         id: 0,\n                                //         registation: vm.plane_search.registration,\n                                //         icao_type: \"not known\"\n                                //     };\n\n                                // vm.club.plane.manufacturer = vm.plane_search.manufacturer;      \n\n                        } else {\n\n                                vm.plane_search = data;\n                                // console.log(\"SUCCESS FOUND\", data);\n                                processNewAircraft();\n                        }\n\n\n                        //console.log(\"PLANE SEARCHED\", vm.plane_search);\n\n                    } else {\n\n\n                        console.log(\"WOOOPSIES... this aircraft isn't in our database?\");\n                        //this should be very very rare...\n\n                         // vm.plane_search = \n                         //            {\n                         //                registation: vm.plane_search.registration,\n                         //                icao_type: \"not known\"\n                         //            };\n                                    // vm.club.plane.manufacturer = vm.plane_search.manufacturer;                        \n\n                    }\n\n                });\n\n\n        }\n\n        function processNewAircraft(){\n\n\n            //vm.club.plane \n\n            //TYPES -->>>\n\n              //aircraft_class --> FIXED-WING LANDPLANE\n                  //is_propeller = 1\n                  //number_of_engines  --> 1 = SEP\n                                    // --> >1 = MEP\n\n                  //is_propeller = 0\n                  //number_of_engines  --> 1 = SET\n                                    // --> >1 = ME\n\n\n            vm.club.plane.manufacturer = vm.plane_search.manufacturer;                        \n            vm.club.plane.serial_no = vm.plane_search.serial_number;                        \n            vm.club.plane.plane_type = vm.plane_search.icao_type;                        \n            vm.club.plane.type_name = vm.plane_search.type_name;                        \n            vm.club.plane.year_built = vm.plane_search.year_built;                        \n            vm.club.plane.aircraft_id = vm.plane_search.id;       \n            vm.club.plane.mtow = parseInt(vm.plane_search.mtow);\n            vm.club.plane.airframe_hours = vm.plane_search.airframe_hours;          \n\n\n            // alert(vm.plane_search.gear_type);\n\n            if(vm.plane_search.noise_level){\n\n                var regex = /[+-]?\\d+(\\.\\d+)?/g;\n\n                vm.plane_noise.noise_level = vm.plane_search.noise_level.match(regex).map(function(v) { return parseFloat(v); });\n                ////console.log(floats);\n\n            }\n            // vm.club.plane.noise_level = vm.plane_search.noise_level;//parseInt(vm.plane_search.noise_level);                 \n            \n\n\n            vm.plane_noise.noise_cert_issue = (vm.plane_search.noise_cert_issue)? new Date(vm.plane_search.noise_cert_issue) : \"\";                 \n\n            if(vm.plane_search.aircraft_class.indexOf(\"FIXED-WING\") > -1){\n\n                if(vm.plane_search.is_propeller > 0 && vm.plane_search.engine_name.indexOf(\"PT6A-\") == -1){\n\n                    vm.club.plane.plane_class = (vm.club.plane.number_of_engines > 1) ? \"MEP\" : \"SEP\";\n\n                } else {\n\n                    vm.club.plane.plane_class = (vm.club.plane.number_of_engines > 1) ? \"ME\" : \"SET\";\n\n                }\n\n                if(vm.plane_search.aircraft_class.indexOf(\"LANDPLANE\") > -1){\n                    vm.club.plane.plane_class = vm.club.plane.plane_class + \" (land)\";\n                    vm.club.plane.gear_type = \"\";\n                }\n\n                if(vm.plane_search.aircraft_class.indexOf(\"AMPHIBIAN\") > -1 || vm.plane_search.aircraft_class.indexOf(\"FLOAT\") > -1){\n                    vm.club.plane.plane_class = vm.club.plane.plane_class + \" (sea)\";\n                    vm.club.plane.gear_type = (vm.plane_search.aircraft_class.indexOf(\"AMPHIBIAN\") > -1)? \"amphibian\" : \"floats\";\n                }\n\n\n\n            }        \n\n\n\n            vm.club.plane.seats = (parseInt(vm.plane_search.seats) + 1);\n\n\n            //Certificate of Airworthiness ==> National CofA\n            //Permit to Fly ==> LAA permit\n            //EASA Certificate of Airworthiness ==> EASA CofA\n            vm.plane_maintenance.cofa_category =  (vm.plane_search.cofa_category.indexOf(\"cofa\") > -1)? \"Certificate of Airworthiness\" : \"Permit to Fly\";//(vm.plane_search.cofa_category.indexOf(\"EASA\") > -1)? \"EASA Certificate of Airworthiness\" : ((vm.plane_search.cofa_category.indexOf(\"Certificate of Airworthiness\") > -1)? \"National Certificate of Airworthiness\" : \"Permit to Fly\");\n            vm.plane_maintenance.certificate_expiry = new Date(vm.plane_search.cofa_expiry);\n            \n            vm.club.plane.cofa_category = vm.plane_maintenance.cofa_category;//(vm.plane_search.cofa_category.indexOf(\"EASA\") > -1)? \"easa_cofa\" : ((vm.plane_search.cofa_category.indexOf(\"Certificate of Airworthiness\") > -1)? \"n_cofa\" : \"permit\")\n\n            vm.club.plane.gear_type = vm.plane_search.gear_type;\n\n\n\n            //ENGINES AND PROPS!!!\n            vm.plane_engine_1.make = vm.plane_search.engine_name;                        \n            vm.plane_engine_1.model = vm.plane_search.engine_name;                     \n\n            vm.plane_propeller_1.make = vm.plane_search.propeller_manufacturer;                        \n            vm.plane_propeller_1.model = vm.plane_search.propeller_name;                        \n\n            if(vm.plane_search.number_of_engines > 1){\n                \n                vm.number_of_engine = vm.plane_search.number_of_engines;\n\n                vm.plane_engine_2.make = vm.plane_search.engine_name;                        \n                vm.plane_engine_2.model = vm.plane_search.engine_name;\n                \n                vm.plane_propeller_2.make = vm.plane_search.propeller_manufacturer;                        \n                vm.plane_propeller_2.model = vm.plane_search.propeller_name; \n            }   \n\n        }\n\n\n        $scope.save = function(){\n            if(vm.action == \"add\"){\n                //console.log(\"CREATE click\");\n                $scope.create();\n            } else {\n                //console.log(\"EDIT click\");\n                //console.log(vm.club.plane);\n                $scope.update();\n            }\n        }\n\n        vm.update_ac = function(){\n\n        }\n\n        vm.search_for_flights = function(){\n            vm.show_loading = true;\n            var plane_id = 0;\n            if(vm.selected_aircraft && vm.selected_aircraft.plane_id){\n                plane_id = vm.selected_aircraft.plane_id;\n            }\n             PlaneService.GetAllFlightsByClub(vm.club_id, vm.from_date, vm.to_date, plane_id)\n                .then(function(data){\n                    vm.flights = data.flights;  \n                    vm.totals = data.totals; \n                    vm.aircraft = data.aircraft;\n                    vm.show_loading = false; \n                    //console.log(vm.club.planes);\n                });\n        }\n\n        vm.round_brake_times_start = function(input, earlier_input=null){\n            \n                if(input){\n                  if(input.indexOf(\":\") > -1){\n                    var split = input.split(\":\");\n                    var x = split[1];\n\n\n\n                    var min_nearest_five = ((x % 5) >= 2.5 ? parseInt(x / 5) * 5 + 5 : parseInt(x / 5) * 5);\n                    \n\n\n                    if(min_nearest_five < 10){\n                      min_nearest_five = \"0\"+min_nearest_five;\n                    } else if(min_nearest_five == 60){\n                      split[0]++;\n                      min_nearest_five = \"00\";\n                    } else if(min_nearest_five > 60){\n                      split[0]++;\n                      min_nearest_five = (min_nearest_five - 60);\n                    }\n\n\n                    if(earlier_input && earlier_input.indexOf(\":\") > -1){\n                            // console.log(\"total calculated?\");\n                            // console.log(\"earlier_input: \", earlier_input);\n                            // console.log(\"input: \", input);\n                            var esplit = earlier_input.split(\":\");\n                            var ehour = esplit[0];\n                            var emin = esplit[1];\n                            var etot = (parseInt(ehour)*60) + parseInt(emin); \n                            // console.log(\"etot: \", etot);\n                            var hr = split[0];\n                            var mn = min_nearest_five;\n                            var tot = (parseInt(hr)*60) + parseInt(mn);\n                            // console.log(\"tot: \", tot);\n\n                            if(etot < tot){\n                                //the earlier time is after the end time\n                                // console.log(\"etot < tot\");\n                                min_nearest_five = parseInt(min_nearest_five) - 5;\n                                if(min_nearest_five == 60){\n                                    split[0]++; \n                                    min_nearest_five = \"00\";\n                                } else if(min_nearest_five > 60){\n                                    split[0]++;\n                                    min_nearest_five = (min_nearest_five - 60);\n                                    if(min_nearest_five < 10 ){\n                                      min_nearest_five = \"0\"+min_nearest_five;\n                                    }\n                                } else if(min_nearest_five < 0){\n                                    split[0]--;\n                                    min_nearest_five = (60 + parseInt(min_nearest_five));\n                                }\n                                // console.log(\"split: \", split[0]);\n                                // console.log(\"min_nearest_five: \", min_nearest_five);\n                            }\n\n                    }\n                    //essentially we add 5 in case something happens over the limit\n\n                    return split[0] + \":\" + min_nearest_five;\n                  } else {\n                    return input;\n                  }\n                } else {\n                  return '';\n                }\n          \n\n          }\n\n\n        $scope.create = function(){\n            ////console.log(\"CREATE ME NOW\");\n            vm.club.plane.club_id = vm.club_id;\n            vm.club.plane.add_documents = vm.plane_documents;\n            vm.club.plane.registration = vm.plane_search.registration;\n\n            vm.club.maintenance_type = vm.plane_maintenance.cofa_category.value;\n\n            console.log(\"vm.plane_maintenance.cofa_category \", vm.club.maintenance_type );\n            return false;\n            vm.plane_maintenance.file = vm.files.cert[0];\n            vm.plane_radio.file = vm.files.radio[0];\n            vm.plane_noise.file = vm.files.noise[0];\n            vm.plane_insurance.file = vm.files.insurance[0];\n\n            vm.club.plane.maintenance = vm.plane_maintenance;\n            vm.club.plane.insurance = vm.plane_insurance;\n            vm.club.plane.noise_cert = vm.plane_noise;\n            vm.club.plane.radio_licence= vm.plane_radio;\n\n            vm.club.plane.vp = (vm.club.plane.vp)? 1:0;\n            vm.club.plane.rg = (vm.club.plane.rg)? 1:0; \n            vm.club.plane.tb = (vm.club.plane.tb)? 1:0; \n\n            vm.club.plane.engine_1 = vm.plane_engine_1;\n            vm.club.plane.engine_2 = vm.plane_engine_2;\n            vm.club.plane.propeller_1 = vm.plane_propeller_1;\n            vm.club.plane.propeller_2 = vm.plane_propeller_2;\n\n\n            //return false;\n            //console.log(\"PLANE TO ADD, \", vm.club.plane);\n            //return false;\n            PlaneService.Create(vm.club.plane)\n                .then(function(data){\n                    ////console.log(data);\n                    $state.go('dashboard.manage_club.planes', {reload: true});\n\n                });\n        }\n\n        $scope.delete = function(){\n            //console.log(\"CLICK\");\n            ToastService.warning('Delete Plane', 'Are you sure you would like to delete this plane?');\n            PlaneService.Update(vm.club.plane)\n                .then(function(data){\n                    //console.log(data);\n                });\n        }\n\n        function get_update_docs(){\n            var documents = [];\n\n            for(var i=0;i<update_this_file.length;i++){\n                var id = update_this_file[i];\n                //console.log(\"looking for : \", id);\n                //console.log(\"in: \", vm.plane_documents);\n\n                for(var k=0;k<vm.club.plane.plane_documents.length;k++){\n                    //console.log(\"comparing to : \", vm.club.plane.plane_documents[k].id);\n                    if(vm.club.plane.plane_documents[k].id == id){\n                        documents.push(vm.club.plane.plane_documents[k]);\n                    }\n                }\n\n            }\n\n            // //console.log(\"DOCS TO UPDATE : \", documents);\n\n            return documents;\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n            vm.club.plane.club_id = vm.club_id;\n            vm.club.plane.add_documents = vm.plane_documents;\n\n            vm.club.plane.update_documents = get_update_docs();\n            //get_update_docs();\n\n            PlaneService.Update(vm.club.plane)\n                .then(function(data){\n                    //console.log(data);\n                    //console.log(\"saved\");\n                    $state.go('dashboard.manage_club.planes');\n                });\n        }\n\n        vm.save_new_aircraft_bit = function(item, num){\n            \n            // console.log(item);\n            // console.log(num);\n\n            //this assumes there was an engine and prop already saved\n\n\n            var comb = \"plane_\"+item+\"_\"+num;\n            var comb2 = \"plane_\"+item+\"_\"+num+\"_replace\";\n\n            var item_update = {};\n            \n            if(vm[comb] && vm[comb] !== \"\"){\n                //only if there is one set --> FIRST!!!\n                vm[comb].removed_date = vm[comb2].removed_date;\n                delete(vm[comb2].removed_date);\n\n                item_update = {\n                    old_item: vm[comb],\n                    new_item: vm[comb2],\n                    plane_id: vm.club.plane.id,\n                    item: item,\n                    no: num\n                };\n            } else {\n                item_update = {\n                    old_item: {},\n                    new_item: vm[comb2],\n                    plane_id: vm.club.plane.id,\n                    item: item,\n                    no: num\n                };\n            }\n\n            \n\n            // if(item == \"engine\"){\n            //     if(num == 1){\n                    \n            //         console.log( \"engine\", vm );\n            //         console.log( \"engine\", vm.plane_engine_1 );\n            //         console.log( \"engine\", vm.plane_engine_1.removed_date );\n            //         console.log( \"engine\", vm.plane_engine_1_replace );\n            //         console.log( \"engine\", vm.plane_engine_1_replace.removed_date );\n\n            //         vm.plane_engine_1.removed_date = vm.plane_engine_1_replace.removed_date;\n            //         delete(vm.plane_engine_1_replace.removed_date);\n            //         item_update.old_item = vm.plane_engine_1;\n            //         item_update.new_item = vm.plane_engine_1_replace;\n\n            //     } else if(num == 2){\n            //         vm.plane_engine_2.removed_date = vm.plane_engine_2_replace.removed_date;\n            //         delete(vm.plane_engine_2_replace.removed_date);\n            //         item_update.old_item = vm.plane_engine_2;\n            //         item_update.new_item = vm.plane_engine_2_replace;\n            //     }\n            // } else if(item == \"propeller\"){\n            //     if(num == 1){\n            //         vm.plane_propeller_1.removed_date = vm.plane_engine_1_replace.removed_date;\n            //         delete(vm.plane_engine_1_replace.removed_date);\n            //         item_update.old_item = vm.plane_propeller_1;\n            //         item_update.new_item = vm.plane_engine_1_replace;\n            //     } else if(num == 2){\n            //         vm.plane_propeller_2.removed_date = vm.plane_engine_2_replace.removed_date;\n            //         delete(vm.plane_engine_2_replace.removed_date);\n            //         item_update.old_item = vm.plane_propeller_2;\n            //         item_update.new_item = vm.plane_engine_2_replace;\n            //     }\n            // }\n\n           \n            console.log(\"LETS SEE WHAT WOULD BE SENT\", item_update);\n\n\n            PlaneService.UpdateAircraftBit(item_update)\n                .then(function(data){\n                    console.log(data);\n                    //console.log(\"saved\");\n                    $state.go('dashboard.manage_club.planes');\n                });\n\n        }\n\n\n        function containsObject(obj, list, params) {\n\n            // //console.log(\"obj\", obj);\n            // //console.log(\"list\", list);\n            // //console.log(\"params\", params);\n\n            for(var i=0; i<list.length; i++) {\n                // //console.log(\"list i : \", list[i]);\n                // //console.log(\"obj is: \", obj);\n\n                var count_success = 0;\n                for(var j=0;j<params.length;j++){\n                    if(list[i][params[j]] && obj[params[j]] && list[i][params[j]] == obj[params[j]]){\n                        count_success++;\n                    }\n                }\n\n                if(count_success === params.length) {                    \n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n\n        function check_all(){\n\n            //maybe a nice to have one day... not yet though.\n\n\n            //licences\n            vm.club.plane.requirements.licence.forEach(function(obj){\n\n            });\n\n        }\n\n      \n\n\n        $scope.add_item = function(type){\n            //console.log(\"ADD\");\n            switch(type){\n                case \"licence\":\n                    //console.log(\"licence\");\n                    if(vm.temporary.licence && vm.temporary.licence !== \"\" && vm.temporary.rating && vm.temporary.rating !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_licence = {\n                            licence_id: vm.temporary.licence.id,\n                            licence_title: vm.temporary.licence.abbreviation,\n                            rating_title: vm.temporary.rating.abbreviation,\n                            rating_id: vm.temporary.rating.id\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_licence, vm.club.plane.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n                            vm.club.plane.requirements.licence.push(add_licence);\n                        }\n\n                        delete vm.temporary.licence;\n                        delete vm.temporary.rating;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a licence and rating that is required to book the plane solo!');\n                    }\n\n                break;\n\n\n                case \"medical\":\n                    //console.log(\"medical\");\n                    if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_medical = {\n                            authority_id: vm.temporary.medical_authority.id,\n                            authority_title: vm.temporary.medical_authority.abbreviation,\n                            medical_component_id: vm.temporary.medical_component.id,\n                            medical_component_title: vm.temporary.medical_component.title\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_medical, vm.club.plane.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n                            vm.club.plane.requirements.medical.push(add_medical);\n                        }\n\n                        delete vm.temporary.medical_authority;\n                        delete vm.temporary.medical_component;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a medical that is required to book the plane solo!');\n                    }\n\n                break;\n\n\n                case \"differences\":\n                    //console.log(\"difference\");\n                    if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_difference = {\n                            difference_id: vm.temporary.difference.id,\n                            difference_title: vm.temporary.difference.title\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_difference, vm.club.plane.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n                            vm.club.plane.requirements.differences.push(add_difference);\n                        }\n\n                        delete vm.temporary.difference;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a difference that is required to book the plane solo!');\n                    }\n\n                break;\n\n\n            }\n\n\n\n        }\n\n\n        $scope.remove_item = function(type, index){\n            //console.log(\"REMOVE\");\n\n            vm.club.plane.requirements[type].splice(index, 1);\n\n\n            // switch(type){\n            //     case \"licence\":\n            //             //console.log(\"licence\");\n                   \n            //             //check if it doesnt exist first...\n            //             // if(containsObject(add_licence, vm.club.plane.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n            //             //     vm.club.plane.requirements.licence.push(add_licence);\n            //             // }\n\n            //             vm.club.plane.requirements.licence.splice(index, 1);\n                      \n                   \n\n            //     break;\n\n\n            //     case \"medical\":\n            //         //console.log(\"medical\");\n            //         if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_medical = {\n            //                 authority_id: vm.temporary.medical_authority.id,\n            //                 authority_title: vm.temporary.medical_authority.abbreviation,\n            //                 medical_component_id: vm.temporary.medical_component.id,\n            //                 medical_component_title: vm.temporary.medical_component.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_medical, vm.club.plane.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n            //                 vm.club.plane.requirements.medical.push(add_medical);\n            //             }\n\n            //             delete vm.temporary.medical_authority;\n            //             delete vm.temporary.medical_component;\n\n            //         } else {\n            //             alert(\"Please select a medical that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            //     case \"differences\":\n            //         //console.log(\"difference\");\n            //         if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_difference = {\n            //                 difference_id: vm.temporary.difference.id,\n            //                 difference_title: vm.temporary.difference.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_difference, vm.club.plane.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n            //                 vm.club.plane.requirements.differences.push(add_difference);\n            //             }\n\n            //             delete vm.temporary.difference;\n\n            //         } else {\n            //             alert(\"Please select a difference that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            // }\n\n\n\n        }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        $scope.update_this_file = function(file){\n            //console.log(\"==== update is : \", file.id);\n            if(update_this_file.indexOf(file.id) === -1){\n                update_this_file.push(file.id)\n            } else {\n               ////console.log(\"This item already exists\"); \n            } \n        }\n\n\n         $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.club.plane.plane_documents = $.grep(vm.club.plane.plane_documents, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                PlaneDocumentService.Delete(vm.user_id, file.id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n\n\n        vm.files = {\n            radio: [],\n            cert: [],\n            insurance: [],\n            noise: []\n        }\n\n\n           $scope.processFile = function(files, location){\n                 //console.log(\"files\", files[0].file_return);\n\n                     // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[0].file_return);\n                     ////console.log(\"PARSED\", j);\n                    // //console.log(\"J is : \",j);\n                    // //console.log(\"name is : \", j.files.file.name);\n\n                    files[0].file.temp_path = j.saved_url;\n                    files[0].file.save_name = j.files.file.name;\n\n                    var ft = j.files.file.name;\n                    //console.log(\"ft\", ft);\n                    var fft = ft.split('.').pop();\n                    files[0].file.extension = fft;\n                    //console.log(\"FILE is : \", files[0]);\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.files[location].push(files[0].file);\n\n\n            }\n\n            $scope.set_title = function(file){\n                //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            //console.log(\"REMOVE: \", j);\n            //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            PoidService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n          // $scope.$on('flow::fileAdded', function (event, $flow, flowFile) {\n          //     event.preventDefault();//prevent file from uploading\n          //     //console.log(\"FILE ADDED\");\n          //     //console.log($flow);\n          //   });\n\n            $scope.processFiles = function(files){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    //console.log(\"J is : \",j);\n                    //console.log(\"name is : \", j.files.file.name);\n\n                    files[i].file.temp_path = j.saved_url;\n                    files[i].file.save_name = j.files.file.name;\n                    var ft = j.files.file.name;\n                    ft = ft.split('.').pop();\n                    files[i].file.extension = ft;\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.plane_documents.push(files[i].file);\n                }\n\n\n            }\n\n            $scope.set_title = function(file){\n                //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            $scope.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n\n            $scope.delete_poid = function(id){\n\n              \n                var a = prompt(\"Are you sure you wish to delete this poid? \\n\\n This change is irreversible! To confirm please type YES in the box below.\");\n                if(a == \"YES\"){\n\n\n                    //console.log(\"WE DELETE IT\");\n\n\n                    // PoidService.Delete(vm.user_id, id)\n                    //     .then(function (data) {\n                    //         //console.log(data);\n                    //         if(data.success){\n                    //             //console.log(\"HUZZAH\", data);\n                    //             //then we need to remove this from the list of files...\n                    //             vm.user_poids = $.grep(vm.user_poids, function(e){ \n                    //                 return e.id != id; \n                    //             });\n                                \n                    //             //refresh?\n                    //             $state.reload();\n                    //             $state.go('dashboard.my_account.poid');\n\n                    //         } else {\n\n                    //             alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n                    //         }\n\n                    //     });\n\n\n\n                } else {\n                    //console.log(\"ignore123\");\n                }\n\n\n            }\n\n\n\n\n            $scope.save_plane_documents = function(){\n\n               \n              \n\n                //console.log(\"plane_documents: \", vm.plane_documents);\n\n\n                //compile the required elements YAY\n\n                //console.log(\"plane_document \", vm.plane_document);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n                    // for(var i=0;i<vm.plane_document.images.length;i++){\n                    //     delete vm.plane_document.images[i].data_uri;\n                    // }\n\n                    // // vm.plane_document.images = vm.plane_documents;\n                    // vm.plane_document.images = vm.plane_document.images.concat(vm.plane_documents);\n                    // vm.plane_document.user_id = vm.user_id;\n\n\n\n\n            //     if(vm.plane_document.id){\n            //         //then its an udpate\n\n            //         //merge the images left?\n            //         PoidService.Update(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                     $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n            //     } else {\n\n\n                   \n\n\n            //         //then its a create\n            //         //console.log(vm.plane_document);\n\n            //         PoidService.Create(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                    // $state.reload();\n            //                    // $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n\n            //     }\n\n\n\n             };\n\n\n\n\n             $scope.change_file_name = function(file){\n                \n                //this is terribly ineficient... unfortunately... can't \n                //work out how else to do it! (lol)\n\n                // //console.log(\"TO BE CHANGED\", file);\n\n                // //console.log(\"BEFORE BEFORE\", vm.plane_documents);\n\n                vm.plane_documents = $.grep(vm.plane_documents, function(e){ \n                    return e.temp_path != file.temp_path; \n                });\n\n                // //console.log(\"BEFORE\", vm.plane_documents);\n\n                vm.plane_documents.push(file);\n\n                // //console.log(\"AFTER\", vm.plane_documents);\n\n             }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n          var warning_msg = \"By deleting this plane, you will also cancel all reservations that this plane currently has.\"\n\n          // $scope.open = function (plane_id) {\n          //   var modalInstance = $uibModal.open({\n          //     animation: true,\n          //     templateUrl: 'views/modals/deleteModal.html',\n          //     controller: 'ModalInstanceCtrl',\n          //     //params: {},\n          //     size: \"lg\",\n          //     resolve: {\n          //       id: function () {\n          //         return plane_id;\n          //       },\n          //       warning: function(){\n          //           return warning_msg;\n          //       }\n          //     }\n          //   });\n          //   modalInstance.result.then(function (plane_id) {\n          //     $log.info('PRESSED GO: '+plane_id);\n          //     PlaneService.Delete(plane_id)\n          //     .then(function(){\n          //       //console.log(\"HELLO DELETE\");\n          //       //update view?\n          //        vm.club.planes = $.grep(vm.club.planes, function(e){ \n          //           return e.plane_id != plane_id; \n          //       });\n          //     })\n          //   }, function () {\n          //     $log.info('Modal dismissed at: ' + new Date());\n          //   });\n          // };\n\n            $scope.open = function (club_plane_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return club_plane_id;\n                },\n                params: function() {\n                  return {id: club_plane_id};\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (plane) {\n                var id = plane.id;\n              $log.info('PRESSED GO: ', id);\n              \n              PlaneService.Delete(id)\n              .then(function(){\n                //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.planes = $.grep(vm.club.planes, function(e){ \n                    return e.id != id; \n                });\n             });\n\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n\n\n          };\n         \n\n         vm.aircraft;\n         vm.plane_search;\n         vm.plane_to_add;\n\n         $scope.get_aircraft = function(registration){\n\n            if(registration.length > 3){\n\n                 PlaneService.GetAddAircraft(registration)\n                .then(function (data) {\n                    ////console.log(data);\n                    if(data){\n                        //use GB airfields first...\n                         \n                        // vm.aircraft = data;\n                        // console.log(\"one is : \", data[0]);\n                       \n                         if(data.length == 0){\n                            // console.log(\"SETTINGS HERE\");\n                              vm.aircraft = [\n                                    {\n                                        icao_type: \"not known\",\n                                        registration: registration.toUpperCase()\n                                    }];\n                        } else {\n                            vm.aircraft = data;\n                        }\n\n                    } else {\n\n                          vm.aircraft = [\n                                    {\n                                        icao_type: \"not known\",\n                                        registration: registration.toUpperCase()\n                                    }];\n\n                                    //console.log(vm.aircraft);\n                        // console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n            }\n\n            \n        }\n\n\n    }\n app.controller('DashboardClubFlyingController', DashboardClubFlyingController);\n\n    DashboardClubFlyingController.$inject = ['UserService', 'MemberService', 'MembershipService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'PoidService',  'LicenceService', 'MedicalService', 'DifferencesService', 'AuthenticationService', '$http', 'PaymentService', 'PackageService', 'BookoutService', 'ToastService'];\n    function DashboardClubFlyingController(UserService, MemberService, MembershipService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, PoidService,  LicenceService, MedicalService, DifferencesService, AuthenticationService, $http, PaymentService, PackageService, BookoutService, ToastService) {\n        var vm = this;\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {};\n        vm.page_title = \"\";\n        vm.club.member = {};\n                                vm.club.member.payment_now = true;\n\n        vm.imported_new_headers = [];\n\n        // vm.club.member.membership_id = {};\n\n        vm.test = \"Package valid until 12/03/2022<br /> To be used on:<br /> G-BOOF <br /> G-OARU\";\n        \n        vm.action = $state.current.data.action;\n\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n        vm.no_show_cols = [\"membership_start\", \"membership_id\", \"selected\"];\n\n\n        $scope.sortType     = 'Email'; // set the default sort type\n        $scope.sortReverse  = false;  // set the default sort order\n        $scope.searchTool   = '';     // set the default search/filter term\n\n        ////console.log(\"club_id : \"+vm.club_id);\n\n        // //console.log(vm.action);\n        // //console.log($stateParams);\n        // //console.log($stateParams.id);\n\n\n        $scope.get_human_status = function(status){\n\n            var returned;\n            switch(status){\n                case 'issued':\n            \n                  returned = \"Created\";\n\n              break;\n\n              case 'pending_submission':\n                  \n                    returned = \"Requesting\";\n\n              break;\n\n              case 'submitted':\n                    \n                    returned = \"Requested\";\n\n              break;\n\n              case 'confirmed':\n                    \n                    returned = \"Paid\";\n\n              break;\n\n              case 'paid_out':\n                    returned = \"Paid\";\n\n              break;\n\n              case 'failed':\n                    returned = \"Failed\";\n\n              break;\n\n              case 'charged_back':\n                    returned = \"Charged Back\";\n\n              break;\n              default:\n                  returned = status;\n              break\n            }\n\n            return returned;\n\n        }\n\n        switch(vm.action){\n            case \"add\":\n                //console.log(\"adding a new member please\");\n                vm.page_title = \"Add a New member\";\n\n                 MembershipService.GetAllByClub(vm.club_id)\n                    .then(function(data){\n                        vm.club.memberships = data;\n                        // vm.club.member.membership_id.selected = vm.club.member.membership_id;\n                        // vm.membership = vm.club.member.membership_name;\n                        // vm.club.membership = vm.club.member.membership_name;\n                        // //console.log(vm.club.memberships);\n                    });\n\n            break;\n            case \"edit\":\n                //console.log(\"edit an existing membership\");\n\n                \n\n                       \n\n\n                        // vm.calculate_difference = function(package, difference){\n\n                        //     var price = package.price;\n                        //     var hours_dual = package.hours_dual;\n                        //     var hours_solo = package.hours_solo;\n\n                        //     var base = price / (hours_dual + hours_solo);\n\n                        //     var initial_dual_price = base + difference;\n                        //     var initial_solo_price = (price - (initial_dual_price * hours_dual)) / hours_solo;\n\n                        //     var price_ratio = initial_dual_price / initial_solo_price;\n\n                        //     var hour_ratio = hours_dual / hours_solo;\n                        //     var remaining_ratio = hours_dual_remaining / hours_solo_remaining;\n                        //     var remaining_hours = hours_dual_remaining / hours_solo_remaining;\n\n                        //     //hello world\n\n                        //     vm.package_split = {ratio: hour_ratio, remaining_ratio: remaining_ratio, dual_price: initial_dual_price, solo_price: initial_solo_price, price_ratio: price_ratio, remaining_hours: remaining_hours};\n\n                        // }\n\n\n                        // vm.calculate_change = function(slider_value){\n\n                        //     //100 ==> everything in solo\n                        //     //0 ==> everything in dual flights\n\n                        //     var dual_percent = slide_value/100;\n                        //     var dual_hours = dual_percent * remaining_hours;\n\n                        //     var solo_percent = 100 - (slide_value/100);\n\n\n\n                        //     var changme = slider_value - (vm.package_split.remaining_ratio * 100);\n                        //     if(changeme > 0){\n                        //         //then we are decreasing solo and increasing dual\n\n\n                        //     } else {\n                        //         //then we are increasing solo and decreasing dual\n                        //     }\n\n\n                        // }\n\n                       \n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n\n                //incomplete_club\n\n                PlaneService.GetIncompleteClub(vm.club_id)\n                    .then(function(data){\n                        vm.club.flights = data.bookouts;\n                        // vm.club.member.membership_id.selected = vm.club.member.membership_id;\n                        // vm.membership = vm.club.member.membership_name;\n                        // vm.club.membership = vm.club.member.membership_name;\n                        // //console.log(vm.club.memberships);\n                    });\n\n\n                \n\n                vm.get_pax_html = function(flight_obj){\n                            var pax = \"\";\n                             for(var i=0;i<flight_obj.passengers.length;i++){\n                                 //\"+flight_obj.passengers[i].nok[0].first_name+\" \"+flight_obj.passengers[i].nok[0].last_name+\"\n                                 var nok = \"\";\n                                 if(flight_obj.passengers[i].nok.length > 0){\n                                     for(var j=0;j<flight_obj.passengers[i].nok.length;j++){\n                                         nok = nok + \"<br /><br />Emergency Contact (\"+(j+1)+\"): <br />\"+flight_obj.passengers[i].nok[j].first_name+ \" \" +flight_obj.passengers[i].nok[j].last_name + \" <br />relationship: \"+flight_obj.passengers[i].nok[j].relationship+\"<br />t: \"+flight_obj.passengers[i].nok[j].phone_number+ \" <br /> e: \"+flight_obj.passengers[i].nok[j].email_address+\"<br />\";\n                                     }\n                                 } \n                                pax = pax + \"<span class='bolder'><b>\" + flight_obj.passengers[i].first_name +\" \"+ flight_obj.passengers[i].last_name +\"</b></span><br />e: \"+flight_obj.passengers[i].email+\"<br />t: \"+((flight_obj.passengers[i].telephone_number) ? flight_obj.passengers[i].telephone_number : \"unknown\")+nok+\"  <br /> <br />\";\n                            }\n                            if(flight_obj.passengers.length == 0){\n\n                            }\n                            if(flight_obj.instructor_id > 0){\n\n                                 var nok2 = \"\";\n                                     if(flight_obj.booking.instructor_nok.noks.length > 0){\n                                         for(var j=0;j<flight_obj.booking.instructor_nok.noks.length;j++){\n                                             nok2 = nok2 + \"<br />Emergency Contact (\"+(j+1)+\"): <br />\"+flight_obj.booking.instructor_nok.noks[j].first_name+ \" \" +flight_obj.booking.instructor_nok.noks[j].last_name + \" <br />relationship: \"+flight_obj.booking.instructor_nok.noks[j].relationship+\"<br />t: \"+flight_obj.booking.instructor_nok.noks[j].phone_number+ \" <br /> e: \"+flight_obj.booking.instructor_nok.noks[j].email_address+\"<br />\";\n                                         }\n                                     } \n\n                                    pax = pax + \"<br /><span class='bolder'>Instructor Present</span> <br /> \"+flight_obj.booking.instructor.first_name+\" \"+flight_obj.booking.instructor.last_name+\" <br /> \"+nok2;\n                                }\n                            if(flight_obj.user_id > 0){\n                                    \n                                    var nok1 = \"\";\n                                     if(flight_obj.booking.user_nok.noks.length > 0){\n                                         for(var j=0;j<flight_obj.booking.user_nok.noks.length;j++){\n                                             nok1 = nok1 + \"<br />Emergency Contact (\"+(j+1)+\"): <br />\"+flight_obj.booking.user_nok.noks[j].first_name+ \" \" +flight_obj.booking.user_nok.noks[j].last_name + \" <br />relationship: \"+flight_obj.booking.user_nok.noks[j].relationship+\"<br />t: \"+flight_obj.booking.user_nok.noks[j].phone_number+ \" <br /> e: \"+flight_obj.booking.user_nok.noks[j].email_address+\"<br />\";\n                                         }\n                                     } \n\n                                    // var nok1 = \"<br /><br />Emergency Contact (\"+(j+1)+\"): <br />\"+flight_obj.passengers[i].nok[j].first_name+ \" \" +flight_obj.passengers[i].nok[j].last_name + \" <br />relationship: \"+flight_obj.passengers[i].nok[j].relationship+\"<br />t: \"+flight_obj.passengers[i].nok[j].phone_number+ \" <br /> e: \"+flight_obj.passengers[i].nok[j].email_address+\"<br />\";\n                                    pax = pax + \"<br /><span class='bolder'>Member Present</span><br />\"+flight_obj.booking.user.first_name+ \" \" +flight_obj.booking.user.last_name + \" <br />\"+nok1;\n                            }\n                            return pax;\n\n                            // var b = '<accordion close-others=\"oneAtATime\"> <accordion-group heading=\"Static Header, initially expanded\" is-open=\"true\"> This content is straight in the template. </accordion-group> <accordion-group heading=\"TITLE\" ng-repeat=\"group in groups\"> Some content here </accordion-group> <accordion-group heading=\"Dynamic Body Content\"> <p>The body of the accordion group grows to fit the contents</p> <button class=\"btn btn-default btn-sm\" ng-click=\"addItem()\">Add Item</button> <div ng-repeat=\"item in items\">{{item}}</div> </accordion-group> <accordion-group is-open=\"isopen\"> <accordion-heading> I can have markup, too! <i class=\"pull-right glyphicon\" ng-class=\"{\\'glyphicon-chevron-down\\': isopen, \\'glyphicon-chevron-right\\': !isopen}\"></i> </accordion-heading> This is just some content to illustrate fancy headings. </accordion-group> </accordion>';\n                            // return b;\n                        }\n\n\n\n\n\n\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n        //'9' needs to refer the the user's account set to manage\n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        vm.load_adsb = function(icao_hex){\n            var httpPath = \"https://globe.adsbexchange.com/?icao=\"+icao_hex;\n            window.open(httpPath, '_blank', '');\n        }\n\n\n        vm.cancel_bookout = function(id){\n\n            var a = confirm(\"Please confirm you wish to cancel the bookout.\");\n            if(a){\n                BookoutService.CancelBookout(id)\n                 .then(function(data){\n\n                     if(data.success){\n\n                       //load_bookings();\n                        PlaneService.GetIncompleteClub(vm.club_id)\n                            .then(function(data){\n                                vm.club.flights = data.bookouts;\n                            });\n\n                     } else {\n                         ToastService.error('Error', data.message);\n                     }\n                                                \n                    });\n            }\n\n        }\n\n         \n\n\n    }\n app.controller('DashboardClubInstructorBookings', DashboardClubInstructorBookings);\n\n    DashboardClubInstructorBookings.$inject = ['UserService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'LicenceService', 'MedicalService', 'DifferencesService', 'InstructorService', 'ToastService'];\n    function DashboardClubInstructorBookings(UserService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, LicenceService, MedicalService, DifferencesService, InstructorService, ToastService) {\n        var vm = this;\n\n           //    /* PLEASE DO NOT COPY AND PASTE THIS CODE. */(function(){var w=window,C='___grecaptcha_cfg',cfg=w[C]=w[C]||{},N='grecaptcha';var gr=w[N]=w[N]||{};gr.ready=gr.ready||function(f){(cfg['fns']=cfg['fns']||[]).push(f);};(cfg['render']=cfg['render']||[]).push('explicit');(cfg['onload']=cfg['onload']||[]).push('initRecaptcha');w['__google_recaptcha_client']=true;var d=document,po=d.createElement('script');po.type='text/javascript';po.async=true;po.src='https://www.gstatic.com/recaptcha/releases/JPZ52lNx97aD96bjM7KaA0bo/recaptcha__en.js';var e=d.querySelector('script[nonce]'),n=e&&(e['nonce']||e.getAttribute('nonce'));if(n){po.setAttribute('nonce',n);}var s=d.getElementsByTagName('script')[0];s.parentNode.insertBefore(po, s);})();\n\n           // var initRecaptcha = function () { \n           //     // document.getElementById(\"SearchModule\").scope().vm.parent.isGrecaptchaLoaded = !0, \n           //     // document.getElementById(\"SearchModule\").scope().vm.showRecaptcha();\n           //     vm.showRecaptcha();\n           // };\n              \n\n\n\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {\n            plane: {\n                requirements: {\n                    licence: [],\n                    medical: [],\n                    differences: []\n                },\n                documents: []\n            }\n        };\n\n        vm.page_title = \"\";\n        \n        vm.plane_document = {};\n        vm.plane_documents = [];\n\n        var update_this_file = [];\n        \n        \n        vm.currency_types = [\"class\", \"type\"];\n        vm.gear_types = [\"tricycle\", \"tailwheel\", \"monowheel\", \"floats\", \"amphibian\", \"skis\"];\n        // vm.certificates = [\"Certificate of Airworthiness\", \"National Certificate of Airworthiness\", \"Permit to Fly\"];\n        vm.certificates = [{id: 1, title: \"Certificate of Airworthiness\", value: \"cofa\"}, {id: 2, title: \"National Certificate of Airworthiness\", value: \"cofa\"}, {id: 2, title: \"LAA Permit to Fly\", value: \"ptf\"}];\n        vm.classes = [\"SEP (land)\", \"SEP (sea)\", \"SET (land)\", \"SET (sea)\", \"MEP (land)\", \"MEP (sea)\", \"ME\"];\n\n        vm.charge_type = [\"airborne\", \"brakes\", \"tacho\", \"hobbs\", \"flight\", \"brakes_rounded\"];\n        vm.surcharge_type = [\"none\", \"flight\", \"hour\"];\n\n        vm.action = $state.current.data.action;\n        vm.user = $rootScope.globals.currentUser;\n\n        //console.log(\"$rootScope.globals.currentUser : \", $rootScope.globals.currentUser);\n        \n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user_id = vm.user.id;\n\n\n\n\n         vm.editing = false;\n        \n        switch(vm.action){\n           \n\n\n            // break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                //console.log(\"hey\");\n                InstructorService.GetAllByClub(vm.club_id, vm.user_id)\n                    .then(function(data){\n                        vm.club.instructors = data.instructors;   \n                        //console.log(data);\n                        vm.edit_instructor();\n                    });\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n        //'9' needs to refer the the user's account set to manage\n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        function rgbaToHex (rgba) {\n          var inParts = rgba.substring(rgba.indexOf(\"(\")).split(\",\"),\n              r = parseInt(trim(inParts[0].substring(1)), 10),\n              g = parseInt(trim(inParts[1]), 10),\n              b = parseInt(trim(inParts[2]), 10);\n             // a = parseFloat(trim(inParts[3].substring(0, inParts[3].length - 1))).toFixed(2);\n          var outParts = [\n            r.toString(16),\n            g.toString(16),\n            b.toString(16)\n            //,Math.round(a * 255).toString(16).substring(0, 2)\n          ];\n\n          // Pad single-digit output values\n          outParts.forEach(function (part, i) {\n            if (part.length === 1) {\n              outParts[i] = '0' + part;\n            }\n          })\n\n          return ('#' + outParts.join(''));\n        }\n\n        function trim (str) {\n          return str.replace(/^\\s+|\\s+$/gm,'');\n        }\n        function hexToRGBA(hex, opacity=1) {  \n            let r = parseInt(hex.substring(1,3), 16);  \n            let g = parseInt(hex.substring(3,5), 16);  \n            let b = parseInt(hex.substring(5), 16);  \n            var rtn = \"rgba(\"+r+\", \"+g+\", \"+b+\", \"+opacity+\")\";\n            return rtn;\n        }\n\n        vm.save_instructor = function(instructor){\n\n            console.log(instructor.new_colour);\n\n            if(instructor.new_colour && instructor.new_colour !== \"\"){\n                instructor.instructor_colour = hexToRGBA(instructor.new_colour, 1);\n                delete(instructor.new_colour);\n            }\n            console.log(instructor.new_booking_colour);\n\n            if(instructor.new_booking_colour && instructor.new_booking_colour !== \"\"){\n                instructor.booking_colour = hexToRGBA(instructor.new_booking_colour, 1);\n                delete(instructor.new_booking_colour);\n            }\n\n            console.log(\"SAVE THIS : \", instructor);\n\n            instructor.edit = false;\n\n            delete(instructor.edit);\n\n            InstructorService.UpdateInstructor(instructor, vm.club_id)\n                .then(function(data){\n                    //console.log(data);\n\n                    // vm.items = data.items;\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n\n                });\n\n\n        }\n\n        vm.edit_instructor = function(){\n            \n            for(var i=0; i < vm.club.instructors.length;i++){\n                if(vm.club.instructors[i].instructor_colour && vm.club.instructors[i].instructor_colour !== \"\"){\n                    vm.club.instructors[i].new_colour = rgbaToHex(vm.club.instructors[i].instructor_colour);\n                }\n\n                if(vm.club.instructors[i].booking_colour && vm.club.instructors[i].booking_colour !== \"\"){\n                    vm.club.instructors[i].new_booking_colour = rgbaToHex(vm.club.instructors[i].booking_colour);\n                }\n            }\n        }\n\n        $scope.save_instructor_order = function(){\n            // //console.log(\"hiya\");\n            var update_order = [];\n            for(var i=0; i < vm.club.instructors.length;i++){\n                var me = {\n                    id: vm.club.instructors[i].id,\n                    display_order: i\n                }\n                update_order.push(me);\n            }\n            // //console.log(\"organised: \", update_order);\n\n\n\n            InstructorService.UpdateOrder({\"order\": update_order}, vm.club_id)\n                .then(function(data){\n                    console.log(data);\n\n                    // vm.items = data.items;\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n\n                });\n\n        }\n\n\n        $scope.set_aircraft_details = function(){\n\n            // console.log(\"get deeeets\", vm.plane_search);\n\n            PlaneService.GetAddAircraft(vm.plane_search.registration)\n                .then(function (data) {\n                    ////console.log(data);\n\n                    // console.log(data);\n                                // return false;\n\n                    if(data){\n                        //use GB airfields first...\n                       \n                         if(data.length == 0){\n                            //console.log(\"SETTINGS HERE\");\n                                // vm.plane_search = \n                                //     {\n                                //         id: 0,\n                                //         registation: vm.plane_search.registration,\n                                //         icao_type: \"not known\"\n                                //     };\n\n                                // vm.club.plane.manufacturer = vm.plane_search.manufacturer;      \n\n                        } else {\n\n                                vm.plane_search = data;\n                                // console.log(\"SUCCESS FOUND\", data);\n                                processNewAircraft();\n                        }\n\n\n                        //console.log(\"PLANE SEARCHED\", vm.plane_search);\n\n                    } else {\n\n\n                        console.log(\"WOOOPSIES... this aircraft isn't in our database?\");\n                        //this should be very very rare...\n\n                         // vm.plane_search = \n                         //            {\n                         //                registation: vm.plane_search.registration,\n                         //                icao_type: \"not known\"\n                         //            };\n                                    // vm.club.plane.manufacturer = vm.plane_search.manufacturer;                        \n\n                    }\n\n                });\n\n\n        }\n\n        function processNewAircraft(){\n\n\n            //vm.club.plane \n\n            //TYPES -->>>\n\n              //aircraft_class --> FIXED-WING LANDPLANE\n                  //is_propeller = 1\n                  //number_of_engines  --> 1 = SEP\n                                    // --> >1 = MEP\n\n                  //is_propeller = 0\n                  //number_of_engines  --> 1 = SET\n                                    // --> >1 = ME\n\n\n            vm.club.plane.manufacturer = vm.plane_search.manufacturer;                        \n            vm.club.plane.serial_no = vm.plane_search.serial_number;                        \n            vm.club.plane.plane_type = vm.plane_search.icao_type;                        \n            vm.club.plane.type_name = vm.plane_search.type_name;                        \n            vm.club.plane.year_built = vm.plane_search.year_built;                        \n            vm.club.plane.aircraft_id = vm.plane_search.id;       \n            vm.club.plane.mtow = parseInt(vm.plane_search.mtow);\n            vm.club.plane.airframe_hours = vm.plane_search.airframe_hours;          \n\n\n            // alert(vm.plane_search.gear_type);\n\n            if(vm.plane_search.noise_level){\n\n                var regex = /[+-]?\\d+(\\.\\d+)?/g;\n\n                vm.plane_noise.noise_level = vm.plane_search.noise_level.match(regex).map(function(v) { return parseFloat(v); });\n                ////console.log(floats);\n\n            }\n            // vm.club.plane.noise_level = vm.plane_search.noise_level;//parseInt(vm.plane_search.noise_level);                 \n            \n\n\n            vm.plane_noise.noise_cert_issue = (vm.plane_search.noise_cert_issue)? new Date(vm.plane_search.noise_cert_issue) : \"\";                 \n\n            if(vm.plane_search.aircraft_class.indexOf(\"FIXED-WING\") > -1){\n\n                if(vm.plane_search.is_propeller > 0 && vm.plane_search.engine_name.indexOf(\"PT6A-\") == -1){\n\n                    vm.club.plane.plane_class = (vm.club.plane.number_of_engines > 1) ? \"MEP\" : \"SEP\";\n\n                } else {\n\n                    vm.club.plane.plane_class = (vm.club.plane.number_of_engines > 1) ? \"ME\" : \"SET\";\n\n                }\n\n                if(vm.plane_search.aircraft_class.indexOf(\"LANDPLANE\") > -1){\n                    vm.club.plane.plane_class = vm.club.plane.plane_class + \" (land)\";\n                    vm.club.plane.gear_type = \"\";\n                }\n\n                if(vm.plane_search.aircraft_class.indexOf(\"AMPHIBIAN\") > -1 || vm.plane_search.aircraft_class.indexOf(\"FLOAT\") > -1){\n                    vm.club.plane.plane_class = vm.club.plane.plane_class + \" (sea)\";\n                    vm.club.plane.gear_type = (vm.plane_search.aircraft_class.indexOf(\"AMPHIBIAN\") > -1)? \"amphibian\" : \"floats\";\n                }\n\n\n\n            }        \n\n\n\n            vm.club.plane.seats = (parseInt(vm.plane_search.seats) + 1);\n\n\n            //Certificate of Airworthiness ==> National CofA\n            //Permit to Fly ==> LAA permit\n            //EASA Certificate of Airworthiness ==> EASA CofA\n            vm.plane_maintenance.cofa_category =  (vm.plane_search.cofa_category.indexOf(\"cofa\") > -1)? \"Certificate of Airworthiness\" : \"Permit to Fly\";//(vm.plane_search.cofa_category.indexOf(\"EASA\") > -1)? \"EASA Certificate of Airworthiness\" : ((vm.plane_search.cofa_category.indexOf(\"Certificate of Airworthiness\") > -1)? \"National Certificate of Airworthiness\" : \"Permit to Fly\");\n            vm.plane_maintenance.certificate_expiry = new Date(vm.plane_search.cofa_expiry);\n            \n            vm.club.plane.cofa_category = vm.plane_maintenance.cofa_category;//(vm.plane_search.cofa_category.indexOf(\"EASA\") > -1)? \"easa_cofa\" : ((vm.plane_search.cofa_category.indexOf(\"Certificate of Airworthiness\") > -1)? \"n_cofa\" : \"permit\")\n\n            vm.club.plane.gear_type = vm.plane_search.gear_type;\n\n\n\n            //ENGINES AND PROPS!!!\n            vm.plane_engine_1.make = vm.plane_search.engine_name;                        \n            vm.plane_engine_1.model = vm.plane_search.engine_name;                     \n\n            vm.plane_propeller_1.make = vm.plane_search.propeller_manufacturer;                        \n            vm.plane_propeller_1.model = vm.plane_search.propeller_name;                        \n\n            if(vm.plane_search.number_of_engines > 1){\n                \n                vm.number_of_engine = vm.plane_search.number_of_engines;\n\n                vm.plane_engine_2.make = vm.plane_search.engine_name;                        \n                vm.plane_engine_2.model = vm.plane_search.engine_name;\n                \n                vm.plane_propeller_2.make = vm.plane_search.propeller_manufacturer;                        \n                vm.plane_propeller_2.model = vm.plane_search.propeller_name; \n            }   \n\n        }\n\n\n        $scope.save = function(){\n            if(vm.action == \"add\"){\n                //console.log(\"CREATE click\");\n                $scope.create();\n            } else {\n                //console.log(\"EDIT click\");\n                //console.log(vm.club.plane);\n                $scope.update();\n            }\n        }\n\n\n\n        vm.round_brake_times_start = function(input, earlier_input=null){\n            \n                if(input){\n                  if(input.indexOf(\":\") > -1){\n                    var split = input.split(\":\");\n                    var x = split[1];\n\n\n\n                    var min_nearest_five = ((x % 5) >= 2.5 ? parseInt(x / 5) * 5 + 5 : parseInt(x / 5) * 5);\n                    \n\n\n                    if(min_nearest_five < 10){\n                      min_nearest_five = \"0\"+min_nearest_five;\n                    } else if(min_nearest_five == 60){\n                      split[0]++;\n                      min_nearest_five = \"00\";\n                    } else if(min_nearest_five > 60){\n                      split[0]++;\n                      min_nearest_five = (min_nearest_five - 60);\n                    }\n\n\n                    if(earlier_input && earlier_input.indexOf(\":\") > -1){\n                            // console.log(\"total calculated?\");\n                            // console.log(\"earlier_input: \", earlier_input);\n                            // console.log(\"input: \", input);\n                            var esplit = earlier_input.split(\":\");\n                            var ehour = esplit[0];\n                            var emin = esplit[1];\n                            var etot = (parseInt(ehour)*60) + parseInt(emin); \n                            // console.log(\"etot: \", etot);\n                            var hr = split[0];\n                            var mn = min_nearest_five;\n                            var tot = (parseInt(hr)*60) + parseInt(mn);\n                            // console.log(\"tot: \", tot);\n\n                            if(etot < tot){\n                                //the earlier time is after the end time\n                                // console.log(\"etot < tot\");\n                                min_nearest_five = parseInt(min_nearest_five) - 5;\n                                if(min_nearest_five == 60){\n                                    split[0]++; \n                                    min_nearest_five = \"00\";\n                                } else if(min_nearest_five > 60){\n                                    split[0]++;\n                                    min_nearest_five = (min_nearest_five - 60);\n                                    if(min_nearest_five < 10 ){\n                                      min_nearest_five = \"0\"+min_nearest_five;\n                                    }\n                                } else if(min_nearest_five < 0){\n                                    split[0]--;\n                                    min_nearest_five = (60 + parseInt(min_nearest_five));\n                                }\n                                // console.log(\"split: \", split[0]);\n                                // console.log(\"min_nearest_five: \", min_nearest_five);\n                            }\n\n                    }\n                    //essentially we add 5 in case something happens over the limit\n\n                    return split[0] + \":\" + min_nearest_five;\n                  } else {\n                    return input;\n                  }\n                } else {\n                  return '';\n                }\n          \n\n          }\n\n\n        $scope.create = function(){\n            ////console.log(\"CREATE ME NOW\");\n            vm.club.plane.club_id = vm.club_id;\n            vm.club.plane.add_documents = vm.plane_documents;\n            vm.club.plane.registration = vm.plane_search.registration;\n\n            vm.club.maintenance_type = vm.plane_maintenance.cofa_category.value;\n\n            console.log(\"vm.plane_maintenance.cofa_category \", vm.club.maintenance_type );\n            return false;\n            vm.plane_maintenance.file = vm.files.cert[0];\n            vm.plane_radio.file = vm.files.radio[0];\n            vm.plane_noise.file = vm.files.noise[0];\n            vm.plane_insurance.file = vm.files.insurance[0];\n\n            vm.club.plane.maintenance = vm.plane_maintenance;\n            vm.club.plane.insurance = vm.plane_insurance;\n            vm.club.plane.noise_cert = vm.plane_noise;\n            vm.club.plane.radio_licence= vm.plane_radio;\n\n            vm.club.plane.vp = (vm.club.plane.vp)? 1:0;\n            vm.club.plane.rg = (vm.club.plane.rg)? 1:0; \n            vm.club.plane.tb = (vm.club.plane.tb)? 1:0; \n\n            vm.club.plane.engine_1 = vm.plane_engine_1;\n            vm.club.plane.engine_2 = vm.plane_engine_2;\n            vm.club.plane.propeller_1 = vm.plane_propeller_1;\n            vm.club.plane.propeller_2 = vm.plane_propeller_2;\n\n\n            if(vm.club.plane.colour && vm.club.plane.colour !== \"\" && vm.club.plane.colour.indexOf(\"rgba\") == -1){\n                vm.club.plane.colour = hexToRGBA(vm.club.plane.colour, 0.75);\n            } \n\n            if(vm.club.plane.bg_colour && vm.club.plane.bg_colour !== \"\" && vm.club.plane.bg_colour.indexOf(\"rgba\") == -1){\n                vm.club.plane.bg_colour = hexToRGBA(vm.club.plane.bg_colour, 0.25);\n            } \n\n\n            //return false;\n            //console.log(\"PLANE TO ADD, \", vm.club.plane);\n            //return false;\n            PlaneService.Create(vm.club.plane)\n                .then(function(data){\n                    ////console.log(data);\n                    $state.go('dashboard.manage_club.planes', {reload: true});\n\n                });\n        }\n\n        $scope.delete = function(){\n            //console.log(\"CLICK\");\n            ToastService.warning('Confirm Delete', 'Are you sure you would like to delete this plane?');\n            PlaneService.Update(vm.club.plane)\n                .then(function(data){\n                    //console.log(data);\n                });\n        }\n\n        function get_update_docs(){\n            var documents = [];\n\n            for(var i=0;i<update_this_file.length;i++){\n                var id = update_this_file[i];\n                //console.log(\"looking for : \", id);\n                //console.log(\"in: \", vm.plane_documents);\n\n                for(var k=0;k<vm.club.plane.plane_documents.length;k++){\n                    //console.log(\"comparing to : \", vm.club.plane.plane_documents[k].id);\n                    if(vm.club.plane.plane_documents[k].id == id){\n                        documents.push(vm.club.plane.plane_documents[k]);\n                    }\n                }\n\n            }\n\n            // //console.log(\"DOCS TO UPDATE : \", documents);\n\n            return documents;\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n            vm.club.plane.club_id = vm.club_id;\n            vm.club.plane.add_documents = vm.plane_documents;\n\n            vm.club.plane.update_documents = get_update_docs();\n            //get_update_docs();\n\n            if(vm.club.plane.colour && vm.club.plane.colour !== \"\" && vm.club.plane.colour.indexOf(\"rgba\") == -1){\n                vm.club.plane.colour = hexToRGBA(vm.club.plane.colour, 0.75);\n            } \n\n            if(vm.club.plane.bg_colour && vm.club.plane.bg_colour !== \"\" && vm.club.plane.bg_colour.indexOf(\"rgba\") == -1){\n                vm.club.plane.bg_colour = hexToRGBA(vm.club.plane.bg_colour, 0.25);\n            } \n\n            PlaneService.Update(vm.club.plane)\n                .then(function(data){\n                    //console.log(data);\n                    //console.log(\"saved\");\n                    $state.go('dashboard.manage_club.planes');\n                });\n        }\n\n        vm.save_new_aircraft_bit = function(item, num){\n            \n            // console.log(item);\n            // console.log(num);\n\n            //this assumes there was an engine and prop already saved\n\n\n            var comb = \"plane_\"+item+\"_\"+num;\n            var comb2 = \"plane_\"+item+\"_\"+num+\"_replace\";\n\n            var item_update = {};\n            \n            if(vm[comb] && vm[comb] !== \"\"){\n                //only if there is one set --> FIRST!!!\n                vm[comb].removed_date = vm[comb2].removed_date;\n                delete(vm[comb2].removed_date);\n\n                item_update = {\n                    old_item: vm[comb],\n                    new_item: vm[comb2],\n                    plane_id: vm.club.plane.id,\n                    item: item,\n                    no: num\n                };\n            } else {\n                item_update = {\n                    old_item: {},\n                    new_item: vm[comb2],\n                    plane_id: vm.club.plane.id,\n                    item: item,\n                    no: num\n                };\n            }\n\n            \n\n            // if(item == \"engine\"){\n            //     if(num == 1){\n                    \n            //         console.log( \"engine\", vm );\n            //         console.log( \"engine\", vm.plane_engine_1 );\n            //         console.log( \"engine\", vm.plane_engine_1.removed_date );\n            //         console.log( \"engine\", vm.plane_engine_1_replace );\n            //         console.log( \"engine\", vm.plane_engine_1_replace.removed_date );\n\n            //         vm.plane_engine_1.removed_date = vm.plane_engine_1_replace.removed_date;\n            //         delete(vm.plane_engine_1_replace.removed_date);\n            //         item_update.old_item = vm.plane_engine_1;\n            //         item_update.new_item = vm.plane_engine_1_replace;\n\n            //     } else if(num == 2){\n            //         vm.plane_engine_2.removed_date = vm.plane_engine_2_replace.removed_date;\n            //         delete(vm.plane_engine_2_replace.removed_date);\n            //         item_update.old_item = vm.plane_engine_2;\n            //         item_update.new_item = vm.plane_engine_2_replace;\n            //     }\n            // } else if(item == \"propeller\"){\n            //     if(num == 1){\n            //         vm.plane_propeller_1.removed_date = vm.plane_engine_1_replace.removed_date;\n            //         delete(vm.plane_engine_1_replace.removed_date);\n            //         item_update.old_item = vm.plane_propeller_1;\n            //         item_update.new_item = vm.plane_engine_1_replace;\n            //     } else if(num == 2){\n            //         vm.plane_propeller_2.removed_date = vm.plane_engine_2_replace.removed_date;\n            //         delete(vm.plane_engine_2_replace.removed_date);\n            //         item_update.old_item = vm.plane_propeller_2;\n            //         item_update.new_item = vm.plane_engine_2_replace;\n            //     }\n            // }\n\n           \n            console.log(\"LETS SEE WHAT WOULD BE SENT\", item_update);\n\n\n            PlaneService.UpdateAircraftBit(item_update)\n                .then(function(data){\n                    console.log(data);\n                    //console.log(\"saved\");\n                    $state.go('dashboard.manage_club.planes');\n                });\n\n        }\n\n\n        function containsObject(obj, list, params) {\n\n            // //console.log(\"obj\", obj);\n            // //console.log(\"list\", list);\n            // //console.log(\"params\", params);\n\n            for(var i=0; i<list.length; i++) {\n                // //console.log(\"list i : \", list[i]);\n                // //console.log(\"obj is: \", obj);\n\n                var count_success = 0;\n                for(var j=0;j<params.length;j++){\n                    if(list[i][params[j]] && obj[params[j]] && list[i][params[j]] == obj[params[j]]){\n                        count_success++;\n                    }\n                }\n\n                if(count_success === params.length) {                    \n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n\n        function check_all(){\n\n            //maybe a nice to have one day... not yet though.\n\n\n            //licences\n            vm.club.plane.requirements.licence.forEach(function(obj){\n\n            });\n\n        }\n\n      \n\n\n        $scope.add_item = function(type){\n            //console.log(\"ADD\");\n            switch(type){\n                case \"licence\":\n                    //console.log(\"licence\");\n                    if(vm.temporary.licence && vm.temporary.licence !== \"\" && vm.temporary.rating && vm.temporary.rating !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_licence = {\n                            licence_id: vm.temporary.licence.id,\n                            licence_title: vm.temporary.licence.abbreviation,\n                            rating_title: vm.temporary.rating.abbreviation,\n                            rating_id: vm.temporary.rating.id\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_licence, vm.club.plane.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n                            vm.club.plane.requirements.licence.push(add_licence);\n                        }\n\n                        delete vm.temporary.licence;\n                        delete vm.temporary.rating;\n\n                    } else {\n                        ToastService.warning('Missing Licence', 'Please select a licence and rating that is required to book the plane solo!');\n                    }\n\n                break;\n\n\n                case \"medical\":\n                    //console.log(\"medical\");\n                    if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_medical = {\n                            authority_id: vm.temporary.medical_authority.id,\n                            authority_title: vm.temporary.medical_authority.abbreviation,\n                            medical_component_id: vm.temporary.medical_component.id,\n                            medical_component_title: vm.temporary.medical_component.title\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_medical, vm.club.plane.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n                            vm.club.plane.requirements.medical.push(add_medical);\n                        }\n\n                        delete vm.temporary.medical_authority;\n                        delete vm.temporary.medical_component;\n\n                    } else {\n                        ToastService.warning('Missing Medical', 'Please select a medical that is required to book the plane solo!');\n                    }\n\n                break;\n\n\n                case \"differences\":\n                    //console.log(\"difference\");\n                    if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_difference = {\n                            difference_id: vm.temporary.difference.id,\n                            difference_title: vm.temporary.difference.title\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_difference, vm.club.plane.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n                            vm.club.plane.requirements.differences.push(add_difference);\n                        }\n\n                        delete vm.temporary.difference;\n\n                    } else {\n                        ToastService.warning('Missing Difference', 'Please select a difference that is required to book the plane solo!');\n                    }\n\n                break;\n\n\n            }\n\n\n\n        }\n\n\n        $scope.remove_item = function(type, index){\n            //console.log(\"REMOVE\");\n\n            vm.club.plane.requirements[type].splice(index, 1);\n\n\n            // switch(type){\n            //     case \"licence\":\n            //             //console.log(\"licence\");\n                   \n            //             //check if it doesnt exist first...\n            //             // if(containsObject(add_licence, vm.club.plane.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n            //             //     vm.club.plane.requirements.licence.push(add_licence);\n            //             // }\n\n            //             vm.club.plane.requirements.licence.splice(index, 1);\n                      \n                   \n\n            //     break;\n\n\n            //     case \"medical\":\n            //         //console.log(\"medical\");\n            //         if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_medical = {\n            //                 authority_id: vm.temporary.medical_authority.id,\n            //                 authority_title: vm.temporary.medical_authority.abbreviation,\n            //                 medical_component_id: vm.temporary.medical_component.id,\n            //                 medical_component_title: vm.temporary.medical_component.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_medical, vm.club.plane.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n            //                 vm.club.plane.requirements.medical.push(add_medical);\n            //             }\n\n            //             delete vm.temporary.medical_authority;\n            //             delete vm.temporary.medical_component;\n\n            //         } else {\n            //             alert(\"Please select a medical that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            //     case \"differences\":\n            //         //console.log(\"difference\");\n            //         if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_difference = {\n            //                 difference_id: vm.temporary.difference.id,\n            //                 difference_title: vm.temporary.difference.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_difference, vm.club.plane.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n            //                 vm.club.plane.requirements.differences.push(add_difference);\n            //             }\n\n            //             delete vm.temporary.difference;\n\n            //         } else {\n            //             alert(\"Please select a difference that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            // }\n\n\n\n        }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        $scope.update_this_file = function(file){\n            //console.log(\"==== update is : \", file.id);\n            if(update_this_file.indexOf(file.id) === -1){\n                update_this_file.push(file.id)\n            } else {\n               ////console.log(\"This item already exists\"); \n            } \n        }\n\n\n         $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.club.plane.plane_documents = $.grep(vm.club.plane.plane_documents, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                PlaneDocumentService.Delete(vm.user_id, file.id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n\n\n        vm.files = {\n            radio: [],\n            cert: [],\n            insurance: [],\n            noise: []\n        }\n\n\n           $scope.processFile = function(files, location){\n                 //console.log(\"files\", files[0].file_return);\n\n                     // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[0].file_return);\n                     ////console.log(\"PARSED\", j);\n                    // //console.log(\"J is : \",j);\n                    // //console.log(\"name is : \", j.files.file.name);\n\n                    files[0].file.temp_path = j.saved_url;\n                    files[0].file.save_name = j.files.file.name;\n\n                    var ft = j.files.file.name;\n                    //console.log(\"ft\", ft);\n                    var fft = ft.split('.').pop();\n                    files[0].file.extension = fft;\n                    //console.log(\"FILE is : \", files[0]);\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.files[location].push(files[0].file);\n\n\n            }\n\n            $scope.set_title = function(file){\n                //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            //console.log(\"REMOVE: \", j);\n            //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            PoidService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n          // $scope.$on('flow::fileAdded', function (event, $flow, flowFile) {\n          //     event.preventDefault();//prevent file from uploading\n          //     //console.log(\"FILE ADDED\");\n          //     //console.log($flow);\n          //   });\n\n            $scope.processFiles = function(files){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    //console.log(\"J is : \",j);\n                    //console.log(\"name is : \", j.files.file.name);\n\n                    files[i].file.temp_path = j.saved_url;\n                    files[i].file.save_name = j.files.file.name;\n                    var ft = j.files.file.name;\n                    ft = ft.split('.').pop();\n                    files[i].file.extension = ft;\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.plane_documents.push(files[i].file);\n                }\n\n\n            }\n\n            $scope.set_title = function(file){\n                //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            $scope.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n\n            $scope.delete_poid = function(id){\n\n              \n                var a = prompt(\"Are you sure you wish to delete this poid? \\n\\n This change is irreversible! To confirm please type YES in the box below.\");\n                if(a == \"YES\"){\n\n\n                    //console.log(\"WE DELETE IT\");\n\n\n                    // PoidService.Delete(vm.user_id, id)\n                    //     .then(function (data) {\n                    //         //console.log(data);\n                    //         if(data.success){\n                    //             //console.log(\"HUZZAH\", data);\n                    //             //then we need to remove this from the list of files...\n                    //             vm.user_poids = $.grep(vm.user_poids, function(e){ \n                    //                 return e.id != id; \n                    //             });\n                                \n                    //             //refresh?\n                    //             $state.reload();\n                    //             $state.go('dashboard.my_account.poid');\n\n                    //         } else {\n\n                    //             alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n                    //         }\n\n                    //     });\n\n\n\n                } else {\n                    //console.log(\"ignore123\");\n                }\n\n\n            }\n\n\n\n\n            $scope.save_plane_documents = function(){\n\n               \n              \n\n                //console.log(\"plane_documents: \", vm.plane_documents);\n\n\n                //compile the required elements YAY\n\n                //console.log(\"plane_document \", vm.plane_document);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n                    // for(var i=0;i<vm.plane_document.images.length;i++){\n                    //     delete vm.plane_document.images[i].data_uri;\n                    // }\n\n                    // // vm.plane_document.images = vm.plane_documents;\n                    // vm.plane_document.images = vm.plane_document.images.concat(vm.plane_documents);\n                    // vm.plane_document.user_id = vm.user_id;\n\n\n\n\n            //     if(vm.plane_document.id){\n            //         //then its an udpate\n\n            //         //merge the images left?\n            //         PoidService.Update(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                     $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n            //     } else {\n\n\n                   \n\n\n            //         //then its a create\n            //         //console.log(vm.plane_document);\n\n            //         PoidService.Create(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                    // $state.reload();\n            //                    // $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n\n            //     }\n\n\n\n             };\n\n\n\n\n             $scope.change_file_name = function(file){\n                \n                //this is terribly ineficient... unfortunately... can't \n                //work out how else to do it! (lol)\n\n                // //console.log(\"TO BE CHANGED\", file);\n\n                // //console.log(\"BEFORE BEFORE\", vm.plane_documents);\n\n                vm.plane_documents = $.grep(vm.plane_documents, function(e){ \n                    return e.temp_path != file.temp_path; \n                });\n\n                // //console.log(\"BEFORE\", vm.plane_documents);\n\n                vm.plane_documents.push(file);\n\n                // //console.log(\"AFTER\", vm.plane_documents);\n\n             }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n          var warning_msg = \"By deleting this plane, you will also cancel all reservations that this plane currently has.\"\n\n          // $scope.open = function (plane_id) {\n          //   var modalInstance = $uibModal.open({\n          //     animation: true,\n          //     templateUrl: 'views/modals/deleteModal.html',\n          //     controller: 'ModalInstanceCtrl',\n          //     //params: {},\n          //     size: \"lg\",\n          //     resolve: {\n          //       id: function () {\n          //         return plane_id;\n          //       },\n          //       warning: function(){\n          //           return warning_msg;\n          //       }\n          //     }\n          //   });\n          //   modalInstance.result.then(function (plane_id) {\n          //     $log.info('PRESSED GO: '+plane_id);\n          //     PlaneService.Delete(plane_id)\n          //     .then(function(){\n          //       //console.log(\"HELLO DELETE\");\n          //       //update view?\n          //        vm.club.planes = $.grep(vm.club.planes, function(e){ \n          //           return e.plane_id != plane_id; \n          //       });\n          //     })\n          //   }, function () {\n          //     $log.info('Modal dismissed at: ' + new Date());\n          //   });\n          // };\n\n            $scope.open = function (club_plane_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return club_plane_id;\n                },\n                params: function() {\n                  return {id: club_plane_id};\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (plane) {\n                var id = plane.id;\n              $log.info('PRESSED GO: ', id);\n              \n              PlaneService.Delete(id)\n              .then(function(){\n                //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.planes = $.grep(vm.club.planes, function(e){ \n                    return e.id != id; \n                });\n             });\n\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n\n\n          };\n         \n\n         vm.aircraft;\n         vm.plane_search;\n         vm.plane_to_add;\n\n         $scope.get_aircraft = function(registration){\n\n            if(registration.length > 3){\n\n                 PlaneService.GetAddAircraft(registration)\n                .then(function (data) {\n                    ////console.log(data);\n                    if(data){\n                        //use GB airfields first...\n                         \n                        // vm.aircraft = data;\n                        // console.log(\"one is : \", data[0]);\n                       \n                         if(data.length == 0){\n                            // console.log(\"SETTINGS HERE\");\n                              vm.aircraft = [\n                                    {\n                                        icao_type: \"not known\",\n                                        registration: registration.toUpperCase()\n                                    }];\n                        } else {\n                            vm.aircraft = data;\n                        }\n\n                    } else {\n\n                          vm.aircraft = [\n                                    {\n                                        icao_type: \"not known\",\n                                        registration: registration.toUpperCase()\n                                    }];\n\n                                    //console.log(vm.aircraft);\n                        // console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n            }\n\n            \n        }\n\n\n    }\n app.controller('DashboardClubInstructorChargesController', DashboardClubInstructorChargesController);\n\n    DashboardClubInstructorChargesController.$inject = ['UserService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'LicenceService', 'MedicalService', 'DifferencesService', 'InstructorCharges', 'ToastService'];\n    function DashboardClubInstructorChargesController(UserService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, LicenceService, MedicalService, DifferencesService, InstructorCharges, ToastService) {\n        var vm = this;\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {};\n        vm.page_title = \"\";\n        \n        vm.plane_document = {};\n        vm.plane_documents = [];\n\n        var update_this_file = [];\n        \n\n        vm.action = $state.current.data.action;\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n        vm.charge_type = [\"brakes\", \"session\", \"plane\"];\n\n        ////console.log(\"club_id : \"+vm.club_id);\n\n        // //console.log(vm.action);\n         //console.log($stateParams);\n        // //console.log($stateParams.id);\n        switch(vm.action){\n            case \"add\":\n                //console.log(\"adding a new plane please\");\n                vm.page_title = \"Add a Instructor Charge\";\n            break;\n            case \"edit\":\n                //console.log(\"edit an existing plane\");\n                 //console.log($stateParams);\n                InstructorCharges.GetById($stateParams.id)\n                    .then(function(data){\n                        vm.club.item = data.item;   \n                        //console.log(vm.club);\n                        vm.page_title = \"Edit an instructor charge - \"+vm.club.item.title;\n                    });\n\n\n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                InstructorCharges.GetByClubId(vm.club_id)\n                    .then(function(data){\n                        vm.club.items = data.items;   \n                        //console.log(vm.club.items);\n                    });\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n        //'9' needs to refer the the user's account set to manage\n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        vm.clearFieldError = function(event) { ToastService.clearFieldError(event); };\n\n        $scope.save = function(){\n            var checks = [\n                { ok: vm.club.item.title,                                      field: 'title', label: 'Instructing Type / Name' },\n                { ok: vm.club.item.charge_type,                                field: 'description', label: 'Charged By' },\n                { ok: vm.club.item.price != null && vm.club.item.price !== '',  field: 'price', label: 'Cost per Unit' }\n            ];\n            if (!ToastService.validateForm(checks)) return;\n\n            if(vm.action == \"add\"){\n                $scope.create();\n            } else {\n                $scope.update();\n            }\n        }\n\n        $scope.create = function(){\n            vm.club.item.club_id = vm.club_id;\n            InstructorCharges.Create(vm.club.item)\n                .then(function(data){\n                    //console.log(data);\n                    //$state.reload();\n                    $state.go('dashboard.manage_club.instructor_charges', {}, {reload: true});\n\n                });\n        }\n\n        $scope.delete = function(){\n            //console.log(\"CLICK\");\n            ToastService.warning('Confirm Delete', 'Are you sure you would like to delete this item?');\n            InstructorCharges.Delete(vm.user.id, vm.club.item)\n                .then(function(data){\n                    //console.log(data);\n                });\n        }\n\n        function get_update_docs(){\n            var documents = [];\n\n            for(var i=0;i<update_this_file.length;i++){\n                var id = update_this_file[i];\n                //console.log(\"looking for : \", id);\n                //console.log(\"in: \", vm.plane_documents);\n\n                for(var k=0;k<vm.club.plane.plane_documents.length;k++){\n                    //console.log(\"comparing to : \", vm.club.plane.plane_documents[k].id);\n                    if(vm.club.plane.plane_documents[k].id == id){\n                        documents.push(vm.club.plane.plane_documents[k]);\n                    }\n                }\n\n            }\n\n            // //console.log(\"DOCS TO UPDATE : \", documents);\n\n            return documents;\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n            vm.club.item.club_id = vm.club_id;\n            InstructorCharges.Update(vm.club.item, vm.user.id)\n                .then(function(data){\n                    //console.log(data);\n                    //console.log(\"saved\");\n                    //$state.reload();\n                    $state.go('dashboard.manage_club.instructor_charges', {}, {reload: true});\n                });\n        }\n\n\n        function containsObject(obj, list, params) {\n\n            // //console.log(\"obj\", obj);\n            // //console.log(\"list\", list);\n            // //console.log(\"params\", params);\n\n            for(var i=0; i<list.length; i++) {\n                // //console.log(\"list i : \", list[i]);\n                // //console.log(\"obj is: \", obj);\n\n                var count_success = 0;\n                for(var j=0;j<params.length;j++){\n                    if(list[i][params[j]] && obj[params[j]] && list[i][params[j]] == obj[params[j]]){\n                        count_success++;\n                    }\n                }\n\n                if(count_success === params.length) {                    \n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n\n        function check_all(){\n\n            //maybe a nice to have one day... not yet though.\n\n\n            //licences\n            vm.club.plane.requirements.licence.forEach(function(obj){\n\n            });\n\n        }\n\n      \n\n\n        $scope.add_item = function(type){\n            //console.log(\"ADD\");\n            switch(type){\n                case \"licence\":\n                    //console.log(\"licence\");\n                    if(vm.temporary.licence && vm.temporary.licence !== \"\" && vm.temporary.rating && vm.temporary.rating !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_licence = {\n                            licence_id: vm.temporary.licence.id,\n                            licence_title: vm.temporary.licence.abbreviation,\n                            rating_title: vm.temporary.rating.abbreviation,\n                            rating_id: vm.temporary.rating.id\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_licence, vm.club.plane.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n                            vm.club.plane.requirements.licence.push(add_licence);\n                        }\n\n                        delete vm.temporary.licence;\n                        delete vm.temporary.rating;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a licence and rating that is required to book the plane solo!');\n                    }\n\n                break;\n\n\n                case \"medical\":\n                    //console.log(\"medical\");\n                    if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_medical = {\n                            authority_id: vm.temporary.medical_authority.id,\n                            authority_title: vm.temporary.medical_authority.abbreviation,\n                            medical_component_id: vm.temporary.medical_component.id,\n                            medical_component_title: vm.temporary.medical_component.title\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_medical, vm.club.plane.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n                            vm.club.plane.requirements.medical.push(add_medical);\n                        }\n\n                        delete vm.temporary.medical_authority;\n                        delete vm.temporary.medical_component;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a medical that is required to book the plane solo!');\n                    }\n\n                break;\n\n\n                case \"differences\":\n                    //console.log(\"difference\");\n                    if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_difference = {\n                            difference_id: vm.temporary.difference.id,\n                            difference_title: vm.temporary.difference.title\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_difference, vm.club.plane.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n                            vm.club.plane.requirements.differences.push(add_difference);\n                        }\n\n                        delete vm.temporary.difference;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a difference that is required to book the plane solo!');\n                    }\n\n                break;\n\n\n            }\n\n\n\n        }\n\n\n        $scope.remove_item = function(type, index){\n            //console.log(\"REMOVE\");\n\n            vm.club.plane.requirements[type].splice(index, 1);\n\n\n            // switch(type){\n            //     case \"licence\":\n            //             //console.log(\"licence\");\n                   \n            //             //check if it doesnt exist first...\n            //             // if(containsObject(add_licence, vm.club.plane.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n            //             //     vm.club.plane.requirements.licence.push(add_licence);\n            //             // }\n\n            //             vm.club.plane.requirements.licence.splice(index, 1);\n                      \n                   \n\n            //     break;\n\n\n            //     case \"medical\":\n            //         //console.log(\"medical\");\n            //         if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_medical = {\n            //                 authority_id: vm.temporary.medical_authority.id,\n            //                 authority_title: vm.temporary.medical_authority.abbreviation,\n            //                 medical_component_id: vm.temporary.medical_component.id,\n            //                 medical_component_title: vm.temporary.medical_component.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_medical, vm.club.plane.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n            //                 vm.club.plane.requirements.medical.push(add_medical);\n            //             }\n\n            //             delete vm.temporary.medical_authority;\n            //             delete vm.temporary.medical_component;\n\n            //         } else {\n            //             alert(\"Please select a medical that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            //     case \"differences\":\n            //         //console.log(\"difference\");\n            //         if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_difference = {\n            //                 difference_id: vm.temporary.difference.id,\n            //                 difference_title: vm.temporary.difference.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_difference, vm.club.plane.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n            //                 vm.club.plane.requirements.differences.push(add_difference);\n            //             }\n\n            //             delete vm.temporary.difference;\n\n            //         } else {\n            //             alert(\"Please select a difference that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            // }\n\n\n\n        }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        $scope.update_this_file = function(file){\n            //console.log(\"==== update is : \", file.id);\n            if(update_this_file.indexOf(file.id) === -1){\n                update_this_file.push(file.id)\n            } else {\n               ////console.log(\"This item already exists\"); \n            } \n        }\n\n\n         $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.club.plane.plane_documents = $.grep(vm.club.plane.plane_documents, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                PlaneDocumentService.Delete(vm.user.id, file.id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            //console.log(\"REMOVE: \", j);\n            //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            PoidService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n          // $scope.$on('flow::fileAdded', function (event, $flow, flowFile) {\n          //     event.preventDefault();//prevent file from uploading\n          //     //console.log(\"FILE ADDED\");\n          //     //console.log($flow);\n          //   });\n\n            $scope.processFiles = function(files){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    //console.log(\"J is : \",j);\n                    //console.log(\"name is : \", j.files.file.name);\n\n                    files[i].file.temp_path = j.saved_url;\n                    files[i].file.save_name = j.files.file.name;\n                    var ft = j.files.file.name;\n                    ft = ft.split('.').pop();\n                    files[i].file.extension = ft;\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.plane_documents.push(files[i].file);\n                }\n\n\n            }\n\n            $scope.set_title = function(file){\n                //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            $scope.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n\n            $scope.delete_poid = function(id){\n\n              \n                var a = prompt(\"Are you sure you wish to delete this poid? \\n\\n This change is irreversible! To confirm please type YES in the box below.\");\n                if(a == \"YES\"){\n\n\n                    //console.log(\"WE DELETE IT\");\n\n\n                    // PoidService.Delete(vm.user_id, id)\n                    //     .then(function (data) {\n                    //         //console.log(data);\n                    //         if(data.success){\n                    //             //console.log(\"HUZZAH\", data);\n                    //             //then we need to remove this from the list of files...\n                    //             vm.user_poids = $.grep(vm.user_poids, function(e){ \n                    //                 return e.id != id; \n                    //             });\n                                \n                    //             //refresh?\n                    //             $state.reload();\n                    //             $state.go('dashboard.my_account.poid');\n\n                    //         } else {\n\n                    //             alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n                    //         }\n\n                    //     });\n\n\n\n                } else {\n                    //console.log(\"ignore123\");\n                }\n\n\n            }\n\n\n\n\n            $scope.save_plane_documents = function(){\n\n               \n              \n\n                //console.log(\"plane_documents: \", vm.plane_documents);\n\n\n                //compile the required elements YAY\n\n                //console.log(\"plane_document \", vm.plane_document);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n                    // for(var i=0;i<vm.plane_document.images.length;i++){\n                    //     delete vm.plane_document.images[i].data_uri;\n                    // }\n\n                    // // vm.plane_document.images = vm.plane_documents;\n                    // vm.plane_document.images = vm.plane_document.images.concat(vm.plane_documents);\n                    // vm.plane_document.user_id = vm.user_id;\n\n\n\n\n            //     if(vm.plane_document.id){\n            //         //then its an udpate\n\n            //         //merge the images left?\n            //         PoidService.Update(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                     $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n            //     } else {\n\n\n                   \n\n\n            //         //then its a create\n            //         //console.log(vm.plane_document);\n\n            //         PoidService.Create(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                    // $state.reload();\n            //                    // $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n\n            //     }\n\n\n\n             };\n\n\n\n\n             $scope.change_file_name = function(file){\n                \n                //this is terribly ineficient... unfortunately... can't \n                //work out how else to do it! (lol)\n\n                // //console.log(\"TO BE CHANGED\", file);\n\n                // //console.log(\"BEFORE BEFORE\", vm.plane_documents);\n\n                vm.plane_documents = $.grep(vm.plane_documents, function(e){ \n                    return e.temp_path != file.temp_path; \n                });\n\n                // //console.log(\"BEFORE\", vm.plane_documents);\n\n                vm.plane_documents.push(file);\n\n                // //console.log(\"AFTER\", vm.plane_documents);\n\n             }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n            var warning_msg = \"By deleting this plane, you will also cancel all reservations that this plane currently has.\"\n\n          $scope.open = function (plane_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return plane_id;\n                },\n                params: function() {\n                  return {id: plane_id};\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (plane_id) {\n              $log.info('PRESSED GO: '+plane_id.id);\n              InstructorCharges.Delete(vm.user.id, plane_id.id)\n              .then(function(){\n                //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.items = $.grep(vm.club.items, function(e){ \n                    return e.id != plane_id.id; \n                });\n              })\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n          };\n\n         \n\n\n    }\n app.controller('DashboardClubInvoicesController', DashboardClubInvoicesController);\n\n    DashboardClubInvoicesController.$inject = ['$sce', 'PaymentService', 'UserService', 'ClubService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'BookingService', 'LicenceService', 'ClubDocumentService', 'PlaneDocumentService', '$http', 'ToastService'];\n    function DashboardClubInvoicesController($sce, PaymentService, UserService, ClubService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, BookingService, LicenceService, ClubDocumentService, PlaneDocumentService, $http, ToastService) {\n        \n        var vm = this;\n\n        vm.clubs = [];\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n        \n        vm.club_id = vm.user.current_club_admin.id;\n\n        vm.to_date = new Date();\n        vm.from_date = new Date();\n\n        vm.from_date.setMonth(vm.from_date.getMonth() - 1);\n\n\n        vm.show_pay_now = false;\n        vm.show_loading = false;\n\n        vm.last_invoice_opened = {};\n\n\n        var iconBank = '<svg viewBox=\"0 0 24 24\"><path d=\"M3 10h18M4 10V8l8-5 8 5v2M5 10v8M9 10v8M15 10v8M19 10v8M3 18h18M2 20h20\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        var iconCard = '<svg viewBox=\"0 0 24 24\"><rect x=\"2\" y=\"4\" width=\"20\" height=\"16\" rx=\"2\" ry=\"2\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><path d=\"M2 9h20M6 14h6\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        var iconNew  = '<svg viewBox=\"0 0 24 24\"><circle cx=\"12\" cy=\"12\" r=\"9\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><path d=\"M12 8v8M8 12h8\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        var iconTerm = '<svg viewBox=\"0 0 24 24\"><rect x=\"6\" y=\"2\" width=\"12\" height=\"14\" rx=\"2\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><rect x=\"8\" y=\"5\" width=\"8\" height=\"3\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><rect x=\"9\" y=\"10\" width=\"6\" height=\"3\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        \n          vm.donConfirm = function(methodLabel, paymentIntent){\n            // console.log(\"confirmation is called\", methodLabel);\n            // console.log(\"paymentIntent\", paymentIntent);\n          //alert('Parent received D confirmation: ' + methodLabel);\n            vm.complete_invoice(methodLabel, paymentIntent);\n          };\n\n          vm.default_payment = 'direct-debit';\n\n          vm.methods = [\n            { id: 'direct-debit', title: 'Direct Debit', subtitle: 'Use your BACS mandate', type: 'direct-debit', iconSvg: $sce.trustAsHtml(iconBank), visible: true },\n            { id: 'saved-card',   title: 'Saved card',   subtitle: 'Use a card on file',    type: 'saved-card',  iconSvg: $sce.trustAsHtml(iconCard), visible: true },\n            { id: 'new-card',     title: 'New card',     subtitle: 'Add a new debit/credit card', type: 'new-card', iconSvg: $sce.trustAsHtml(iconNew), visible: false },\n            { id: 'card-machine', title: 'Card Machine', subtitle: 'Pay in person',          type: 'card-machine', iconSvg: $sce.trustAsHtml(iconTerm), visible: true }\n          ];\n\n           vm.savedCards = [];\n\n           vm.complete_invoice = function(method, paymentIntent){\n\n               //we now have a payment to complete\n               //process_payment\n\n               var obj = {\n                   user_id: vm.last_invoice_opened.user_id,\n                   club_id: vm.last_invoice_opened.club_id,\n                   paymentIntent: paymentIntent,\n                   invoice_id: vm.last_invoice_opened.id,\n                   method: method\n               }\n\n               PaymentService.ProcessPayment(obj)\n                   .then(function (data) {\n\n                       if(data.success){\n\n                           //finish with:\n                           //RELOAD THE INVOICES!!!\n                           ClubService.GetClubInvoices(vm.club_id, vm.from_date, vm.to_date)\n                            .then(function (data) {\n                                   console.log(\"data is : \", data);\n                                   vm.invoices = data.invoices;\n                                   vm.totals = data.totals;\n\n                                   vm.show_pay_now = false;\n                                   vm.show_loading = false;\n                                   //alert(\"SUCCESS!\");\n\n\n                                });\n\n                           \n\n                       } else {\n                          // alert(\"Something happened which was not supposed to happen... Please try again\");\n                           console.log(\"===== ERROR =====\");\n                           console.log(data);\n                           console.log(\"===== ERROR =====\");\n                       }\n\n\n                   });\n\n           }\n\n           vm.close_pay_now = function(){\n               vm.show_pay_now = false;\n               vm.show_loading = false;\n           }\n\n           vm.show_payment_option = function(invoice){\n            var status = invoice.status;\n            if(status == \"pending_submission\"){\n                return true;\n            } else if(status == \"issued\"){\n                return true;\n            } else {\n                return false;\n            }\n\n        }\n\n        vm.info;\n\n        vm.show_payment = function(invoice){\n            console.log(\"invoice details: \", invoice);\n            vm.last_invoice_opened = invoice;\n            vm.send = {\n                club_id: invoice.club_id,\n                user_id: invoice.user_id,\n                invoice_id: invoice.id\n            }\n\n            //get user cards\n            //get user info\n\n            MemberService.GetMandate(invoice.user_id, invoice.club_id)\n                    .then(function (data) {\n                            ////console.log(\"data is : \", data);\n                           \n                    if(data.success){\n                        vm.info = data.info;\n\n                        vm.savedCards = data.cards;\n\n                        if(vm.savedCards.length > 0){\n                            vm.methods[1].visible = true;\n                        } else {\n                            vm.methods[1].visible = false;\n                        }\n\n                        vm.machine = data.machine;\n                        if(vm.machine.success){\n                            vm.methods[3].visible = true;\n                        } else {\n                            vm.methods[3].visible = false;\n                        }\n\n                        vm.show_pay_now = true;\n                    }\n\n                });\n\n           \n\n        }\n\n\n\n\n        // console.log(\"GLOBALS\", $rootScope.globals);\n        // console.log(\"USER\", vm.user.current_club_admin.id);\n\n        vm.get_package_html = function(pack_obj){\n\n\n\n                            var used_on = \"\";\n                            for(var i=0;i<pack_obj.aircraft.length;i++){\n                                used_on = used_on + \" \" + pack_obj.aircraft[i].registration +\" (\"+ pack_obj.aircraft[i].plane_type +\") <br />\";\n                            }\n                            var text = \"\";\n                            if(pack_obj.validity == 0){\n                               text = \"Package purchased on: \"+moment(pack_obj.created_at).format(\"D MMM Y\")+\"<br /> Package does not expire <br /> To be used on:<br />\";\n                            } else {\n                               text = \"Package purchased on: \"+moment(pack_obj.created_at).format(\"D MMM Y\")+\"<br /> Package expires on: \"+ moment(pack_obj.created_at).add(pack_obj.validity, \"days\").format(\"D MMM Y\") +\" <br /> To be used on:<br />\";\n                            }\n                    \n                            var intro =  text+used_on;\n\n\n                            // bit = bit + '<h4 uib-tooltip=\"'+intro+'\"> '+package.title+' <i class=\"fa fa-question-circle\"></i></h4><div class=\"dual_solo\"><div class=\"dual\" uib-tooltip=\"Hours remaining on this package to fly dual (with an instructor)\"><span class=\"bigger_text\">'+vm.convert_decimal_to_hours( package.remaining_hours_dual )+'</span><span class=\"smaller_text\">DUAL</span></div><div class=\"solo\" uib-tooltip=\"Hours remaining on this package of solo rental\"><span class=\"bigger_text\">'+vm.convert_decimal_to_hours( package.remaining_hours_solo )+'</span><span class=\"smaller_text\">SOLO</span></div></div>';\n\n\n                            \n                            return intro;\n\n        }\n        vm.quick_select = {};\n        vm.base_date = new Date();\n        vm.yesterday = new Date();\n        vm.sevendaysago = new Date();\n        vm.thirtydaysago = new Date();\n        vm.yesterday.setDate(vm.yesterday.getDate() - 1);\n        vm.sevendaysago.setDate(vm.yesterday.getDate() - 7);\n        vm.thirtydaysago.setDate(vm.yesterday.getDate() - 30);\n\n        function getMonday(d) {\n          var date = new Date(d);\n          const day = date.getDay();\n          const diff = date.getDate() - day + (day === 0 ? -6 : 1);\n          return new Date(d.setDate(diff));\n        }\n        function getSunday(d){\n            const sunday = new Date(d)\n            sunday.setDate(sunday.getDate() + 6);\n            return sunday;\n        }\n\n        var date = new Date();\n        var firstDay = new Date(date.getFullYear(), date.getMonth(), 1);\n        var lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);\n        \n        var lm_firstDay = new Date(date.getFullYear(), (date.getMonth() - 1), 1);\n        var lm_lastDay = new Date(date.getFullYear(), date.getMonth(), 0);\n        \n\n        vm.quick_selects = [\n           {\n               title: \"Today\",\n               from_date: vm.base_date,\n               to_date: vm.base_date\n           },\n           {\n               title: \"Yesterday\",\n               from_date: vm.yesterday,\n               to_date: vm.yesterday\n           },\n           {\n               title: \"Last 7 days\",\n               from_date: vm.sevendaysago,\n               to_date: vm.base_date\n           },\n           {\n               title: \"Last 30 days\",\n               from_date: vm.thirtydaysago,\n               to_date: vm.yesterday\n           },\n           {\n               title: \"This week\",\n               from_date: getMonday(new Date()),\n               to_date: getSunday(getMonday(new Date()))\n           },\n           {\n               title: \"This month\",\n               from_date: firstDay,\n               to_date: lastDay\n           },\n           {\n               title: \"Last month\",\n               from_date: lm_firstDay,\n               to_date: lm_lastDay\n           }\n\n\n        ];\n        vm.update_qs = function(){\n            console.log(\"QUICK SELECT : \");\n            console.log(vm.quick_select.from_date);\n            console.log(vm.quick_select.to_date);\n            vm.from_date = vm.quick_select.from_date;\n            vm.to_date = vm.quick_select.to_date;\n            vm.update_date_range();\n        }\n        vm.update_date_range = function(){\n            //update the invoices\n            ClubService.GetClubInvoices(vm.club_id, vm.from_date, vm.to_date)\n            .then(function (data) {\n                   console.log(\"data is : \", data);\n                   vm.invoices = data.invoices;\n                   vm.totals = data.totals;\n                });\n\n        }\n       \n\n        vm.convert_decimal_to_hours = function(number){\n            \n                            var sign = (number >= 0) ? 1 : -1;\n\n                            // Set positive value of number of sign negative\n                            number = number * sign;\n\n                            // Separate the int from the decimal part\n                            var hour = Math.floor(number);\n                            var decpart = number - hour;\n\n                            var min = 1 / 60;\n                            // Round to nearest minute\n                            decpart = min * Math.round(decpart / min);\n\n                            var minute = Math.floor(decpart * 60) + '';\n\n                            // Add padding if need\n                            if (minute.length < 2) {\n                            minute = '0' + minute; \n                            }\n\n                            if(minute == 60){\n                                hour = hour+1;\n                                minute = '00';\n                            }\n\n                            // Add Sign in final result\n                            sign = sign == 1 ? '' : '-';\n\n                            // Concate hours and minutes\n                            var time = sign + hour + ':' + minute;\n\n                            return time;\n\n                        }\n\n                        // var from_date = \"2024-01-01\";\n                        // var to_date = \"2024-07-01\";\n\n        ClubService.GetClubInvoices(vm.club_id, vm.from_date, vm.to_date)\n            .then(function (data) {\n                   console.log(\"data is : \", data);\n                   vm.invoices = data.invoices;\n                   vm.totals = data.totals;\n                });\n\n\n        // ClubService.GetClubTotals(vm.user.id, from_date, to_date)\n        //     .then(function (data) {\n        //             ////console.log(\"data is : \", data);\n        //            vm.upcoming = data.upcoming;\n        //         });\n       \n          \n        $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            vm.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n        \n        $scope.search = function(row){\n            //plane_registration\n            ////console.log(\"hi\", (angular.lowercase(row.title).indexOf(angular.lowercase($scope.my_search) || '') !== -1));\n            if(row.plane_registration){\n                if(angular.lowercase(row.plane_registration).indexOf(angular.lowercase($scope.my_search) || '') !== -1){\n                    return true;\n                }\n            }\n\n\n            return ( (angular.lowercase(row.invoice_number).indexOf(angular.lowercase($scope.my_search) || '') !== -1) || \n                    (angular.lowercase(row.user.last_name).indexOf(angular.lowercase($scope.my_search) || '') !== -1) ||\n                    (angular.lowercase(row.created_at.toString()).indexOf(angular.lowercase($scope.my_search) || '') !== -1) ||\n                    (angular.lowercase((parseFloat(row.total).toFixed(2)).toString()).indexOf(angular.lowercase($scope.my_search) || '') !== -1) ||\n                    (angular.lowercase(row.status).indexOf(angular.lowercase($scope.my_search) || '') !== -1) );\n        };\n\n        $scope.show_more = function(index){\n\n\n            vm.invoices[index].show_more = (vm.invoices[index].show_more)? false : true;\n\n\n        }\n\n\n\n\n        function process_payment_bits(payments){\n\n\n\n\n\n\n\n\n\n        }\n\n\n        $scope.get_human_status = function(status){\n\n            var returned;\n            switch(status){\n                case 'issued':\n            \n                  returned = \"Created\";\n\n              break;\n\n              case 'pending_submission':\n                  \n                    returned = \"Requesting\";\n\n              break;\n\n              case 'submitted':\n                    \n                    returned = \"Requested\";\n\n              break;\n\n              case 'confirmed':\n                    \n                    returned = \"Paid\";\n\n              break;\n\n              case 'paid_out':\n                    returned = \"Paid\";\n\n              break;\n\n              case 'failed':\n                    returned = \"Failed\";\n\n              break;\n\n              case 'charged_back':\n                    returned = \"Charged Back\";\n\n              break;\n              default:\n                  returned = status;\n              break\n            }\n\n            return returned;\n\n        }\n\n     \n        $scope.downloadDocument = function(doc) {\n            var data = $.param({\n                id: doc\n            });\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('/api/v1/plane_documents/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Error', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        $scope.downloadInvoice = function(id) {\n            // var data = $.param({\n            //     id: doc\n            // });\n\n            //var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/invoice_pdf/get_ad_hoc_invoice/'+id, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Error', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        function processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], {\n                    type: contentType\n                });\n                if (navigator.msSaveBlob)\n                    navigator.msSaveBlob(blob, filename);\n                else {\n                    // Try using other saveBlob implementations, if available\n                    var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                    if (saveBlob === undefined) throw \"Not supported\";\n                    saveBlob(blob, filename);\n                }\n                success = true;\n            } catch (ex) {\n                $log.info(\"!!saveBlob method failed with the following exception:\");\n                $log.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            $log.info(\"Download link method with simulated click failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n\n      \n\n\n\n    }\n\n\n\n\n\n app.controller('DashboardClubItemsController', DashboardClubItemsController);\n\n    DashboardClubItemsController.$inject = ['UserService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'LicenceService', 'MedicalService', 'DifferencesService', 'ItemService', 'ToastService'];\n    function DashboardClubItemsController(UserService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, LicenceService, MedicalService, DifferencesService, ItemService, ToastService) {\n        var vm = this;\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {};\n        vm.page_title = \"\";\n        \n        vm.plane_document = {};\n        vm.plane_documents = [];\n\n        var update_this_file = [];\n        \n\n        vm.action = $state.current.data.action;\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n        ////console.log(\"club_id : \"+vm.club_id);\n\n        // //console.log(vm.action);\n         //console.log($stateParams);\n        // //console.log($stateParams.id);\n        switch(vm.action){\n            case \"add\":\n                //console.log(\"adding a new plane please\");\n                vm.page_title = \"Add a New Plane\";\n            break;\n            case \"edit\":\n                //console.log(\"edit an existing plane\");\n                 //console.log($stateParams);\n                ItemService.GetById($stateParams.item_id)\n                    .then(function(data){\n                        vm.club.item = data.item;   \n                        //console.log(vm.club);\n                        vm.page_title = \"Edit an Item - \"+vm.club.item.title;\n                    });\n\n\n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                ItemService.GetByClubId(vm.club_id)\n                    .then(function(data){\n                        vm.club.items = data.items;   \n                        //console.log(vm.club.items);\n                    });\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n        //'9' needs to refer the the user's account set to manage\n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        vm.clearFieldError = function(event) { ToastService.clearFieldError(event); };\n\n        $scope.save = function(){\n            if (!vm.club.item) vm.club.item = {};\n            var checks = [\n                { ok: vm.club.item.title,                                    field: 'title',            label: 'Title' },\n                { ok: vm.club.item.cost != null && vm.club.item.cost !== '',  field: 'cost',             label: 'Cost' },\n                { ok: vm.club.item.number_available != null && vm.club.item.number_available !== '', field: 'number_available', label: 'Number Available' },\n                { ok: vm.club.item.cost_schedule,                            field: 'cost_schedule',    label: 'Cost Schedule' }\n            ];\n            if (!ToastService.validateForm(checks)) return;\n\n            if(vm.action == \"add\"){\n                $scope.create();\n            } else {\n                $scope.update();\n            }\n        }\n\n        $scope.create = function(){\n            vm.club.item.club_id = vm.club_id;\n            ItemService.Create(vm.club.item)\n                .then(function(data){\n                    //console.log(data);\n                    $state.go('dashboard.manage_club.items');\n\n                });\n        }\n\n        // $scope.delete = function(){\n        //     //console.log(\"CLICK\");\n        //     alert(\"Are you sure you would like to delete this plane?\");\n        //     ItemService.Delete(vm.user.id, vm.club.item)\n        //         .then(function(data){\n        //             //console.log(data);\n        //         });\n        // }\n\n        $scope.delete = function(item){\n            var a = confirm(\"Are you sure you would like to delete this item?\");\n            if(a){\n                ItemService.Delete(vm.user.id, item.id)\n                .then(function(data){\n                    \n                    if(data.success){\n\n                         ItemService.GetByClubId(vm.club_id)\n                        .then(function(data){\n                            vm.club.items = data.items;   \n                            // //console.log(vm.club.items);\n                        });\n\n                    } else {\n                        ToastService.error('Delete Error', 'An error occurred when trying to delete this item.');\n                    }\n\n                });\n            }\n            \n        }\n\n        function get_update_docs(){\n            var documents = [];\n\n            for(var i=0;i<update_this_file.length;i++){\n                var id = update_this_file[i];\n                //console.log(\"looking for : \", id);\n                //console.log(\"in: \", vm.plane_documents);\n\n                for(var k=0;k<vm.club.plane.plane_documents.length;k++){\n                    //console.log(\"comparing to : \", vm.club.plane.plane_documents[k].id);\n                    if(vm.club.plane.plane_documents[k].id == id){\n                        documents.push(vm.club.plane.plane_documents[k]);\n                    }\n                }\n\n            }\n\n            // //console.log(\"DOCS TO UPDATE : \", documents);\n\n            return documents;\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n            vm.club.item.club_id = vm.club_id;\n            ItemService.Update(vm.club.item, vm.user.id)\n                .then(function(data){\n                    //console.log(data);\n                    //console.log(\"saved\");\n                    $state.go('dashboard.manage_club.items');\n                });\n        }\n\n\n        function containsObject(obj, list, params) {\n\n            // //console.log(\"obj\", obj);\n            // //console.log(\"list\", list);\n            // //console.log(\"params\", params);\n\n            for(var i=0; i<list.length; i++) {\n                // //console.log(\"list i : \", list[i]);\n                // //console.log(\"obj is: \", obj);\n\n                var count_success = 0;\n                for(var j=0;j<params.length;j++){\n                    if(list[i][params[j]] && obj[params[j]] && list[i][params[j]] == obj[params[j]]){\n                        count_success++;\n                    }\n                }\n\n                if(count_success === params.length) {                    \n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n\n\n      \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n            var warning_msg = \"By deleting this plane, you will also cancel all reservations that this plane currently has.\"\n\n          $scope.open = function (plane_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return plane_id;\n                },\n                params: function() {\n                  return {id: plane_id};\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (plane_id) {\n              $log.info('PRESSED GO: '+plane_id.id);\n              ItemService.Delete(vm.user.id, plane_id.id)\n              .then(function(){\n                //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.items = $.grep(vm.club.items, function(e){ \n                    return e.id != plane_id.id; \n                });\n              })\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n          };\n\n         \n\n\n    }\n app.controller('DashboardClubLessonController', DashboardClubLessonController);\n\n    DashboardClubLessonController.$inject = ['UserService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'CourseService', 'ToastService'];\n    function DashboardClubLessonController(UserService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, CourseService, ToastService) {\n        var vm = this;\n\n           //    /* PLEASE DO NOT COPY AND PASTE THIS CODE. */(function(){var w=window,C='___grecaptcha_cfg',cfg=w[C]=w[C]||{},N='grecaptcha';var gr=w[N]=w[N]||{};gr.ready=gr.ready||function(f){(cfg['fns']=cfg['fns']||[]).push(f);};(cfg['render']=cfg['render']||[]).push('explicit');(cfg['onload']=cfg['onload']||[]).push('initRecaptcha');w['__google_recaptcha_client']=true;var d=document,po=d.createElement('script');po.type='text/javascript';po.async=true;po.src='https://www.gstatic.com/recaptcha/releases/JPZ52lNx97aD96bjM7KaA0bo/recaptcha__en.js';var e=d.querySelector('script[nonce]'),n=e&&(e['nonce']||e.getAttribute('nonce'));if(n){po.setAttribute('nonce',n);}var s=d.getElementsByTagName('script')[0];s.parentNode.insertBefore(po, s);})();\n\n           // var initRecaptcha = function () { \n           //     // document.getElementById(\"SearchModule\").scope().vm.parent.isGrecaptchaLoaded = !0, \n           //     // document.getElementById(\"SearchModule\").scope().vm.showRecaptcha();\n           //     vm.showRecaptcha();\n           // };\n              \n\n\n\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {\n            lesson: {\n                \n            }\n        };\n\n        vm.page_title = \"\";\n        \n        vm.lesson_document = {};\n        vm.lesson_documents = [];\n\n        var update_this_file = [];\n        \n       \n\n        vm.action = $state.current.data.action;\n        vm.user = $rootScope.globals.currentUser;\n        // //console.log(\"$rootScope.globals.currentUser : \", $rootScope.globals.currentUser);\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user_id = vm.user.id;\n\n\n        vm.lesson_certificate = {};\n        vm.lesson_noise = {};\n        vm.lesson_radio = {};\n        vm.lesson_maintenance = {};\n        vm.lesson_insurance = {};\n\n        vm.club.lessons = [];\n        vm.club.lesson = {};\n\n        //  Lesson Content Tabs \n        vm.lessonContentTab = 'upload'; // 'upload' or 'form'\n        \n        //  File Upload State \n        vm.contentFiles = [];             // existing uploaded files from backend\n        vm.uploadQueue = [];              // files staged for upload\n        vm.uploadProgress = {};           // per-file upload progress\n        vm.isUploading = false;\n        vm.dragOver = false;\n        \n        //  PDF Page Selector State \n        vm.pdfSelector = {\n            active: false,\n            file: null,\n            fileName: '',\n            pages: [],\n            totalPages: 0,\n            selectedPages: [],\n            loading: false,\n            error: null\n        };\n\n\n        vm.new_tem = {\n            threat: \"\",\n            consequence: \"\",\n            mitigation: \"\"\n        }\n\n        vm.new = {\n            preflight: {\n                title: \"\",\n                bullet_format: \"0\"\n            },\n            airex: {\n                title: \"\",\n                bullet_format: \"0\"\n            },\n            debrief: {\n                title: \"\",\n                bullet_format: \"0\"\n            }\n        }\n\n\n        // //console.log(vm.action);\n        // //console.log($stateParams);\n        // //console.log($stateParams.id);\n\n\n        vm.editing = false;\n        \n        switch(vm.action){\n            case \"add\":\n                //console.log(\"adding a new lesson please\");\n                vm.page_title = \"Add a New Course\";\n            break;\n            case \"edit\":\n                vm.editing = true;\n                //console.log(\"edit an existing lesson\");\n\n\n                CourseService.GetLessonById($stateParams.lesson_id)\n                    .then(function(data){\n                        vm.club.lesson = data.item;   \n            \n                    });\n\n                \n                refresh_tem();\n\n                refresh_bullets();\n\n                refresh_items();\n\n                refresh_content_files();\n\n               \n                    // CourseService.GetLessonsByCourseId($stateParams.lesson_id)\n                    // .then(function(data){\n                    //     vm.club.lessons = data.items;   \n           \n                    // });\n\n\n\n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                // CourseService.GetLessonsByCourseId(vm.club_id)\n                //     .then(function(data){\n                //         vm.club.lessons = data.items;   \n                //         //console.log(vm.club.lessons);\n                //     });\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n        //'9' needs to refer the the user's account set to manage\n       \n\n        function refresh_bullets(){\n             CourseService.GetBulletsByLessonId($stateParams.lesson_id)\n                    .then(function(data){\n\n                        vm.bullets = data.bullets;\n            \n                    });\n        }\n\n        function refresh_tem(){\n            CourseService.GetTemByLessonId($stateParams.lesson_id)\n                .then(function(data){\n                    //console.log(data);\n\n                    vm.tem = data.items;\n\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n\n                });\n        }\n\n        vm.add_tem = function(){\n\n            vm.new_tem.lesson_id = $stateParams.lesson_id; \n            vm.new_tem.organise = (vm.tem && vm.tem.length > 0) ? vm.tem.length : 0;\n\n            CourseService.CreateTem(vm.new_tem)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success){\n\n                        vm.tem.push(data.item);\n\n                        vm.new_tem = {\n                            threat: \"\",\n                            consequence: \"\",\n                            mitigation: \"\"\n                        }\n                    } else {\n                        ToastService.error('Error', 'An error occurred');\n                    }\n\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n\n                });\n        }\n\n        vm.update_tem = function(tem, index){\n\n            delete(tem.edit_me);\n\n            CourseService.UpdateTem(tem)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success){\n\n                        vm.tem[index].edit_me = false;\n\n                    } else {\n                        ToastService.error('Error', 'An error occurred');\n                    }\n                    //refresh_tem();\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n                });\n        }\n\n        vm.update_cancel = function(index){\n            refresh_tem();\n        }\n\n        vm.edit_tem = function(index){\n\n            vm.tem[index].edit_me = true;\n\n        }\n\n        vm.delete_tem = function(tem, index){\n\n            CourseService.DeleteTem(tem.id)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success){\n                        vm.tem.splice(index, 1);\n                    } else {\n                        ToastService.error('Error', 'An error occurred');\n                    }\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n                });\n        }\n\n\n\n\n\n\n\n        vm.add_bullet = function(type){\n\n            var no = (vm.bullets[type] && vm.bullets[type].length > 0) ? vm.bullets[type].length : 0;\n\n            var send_me = {\n                title: vm.new[type].title,\n                bullet_format: vm.new[type].bullet_format,\n                lesson_id: $stateParams.lesson_id,\n                bullet_type: type,\n                organise: no\n            }\n\n            //vm.new_tem.lesson_id = $stateParams.lesson_id; \n\n            CourseService.CreateBullet(send_me)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success){\n                        if(vm.bullets[type]){\n                            vm.bullets[type].push(data.item);\n                        } else {\n                            vm.bullets[type] = Array(data.item);\n                        }\n\n                        vm.new[type].title = \"\";\n                        vm.new[type].bullet_format = \"0\";\n                        \n                    } else {\n                        ToastService.error('Error', 'An error occurred');\n                    }\n\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n\n                });\n        }\n\n        vm.update_bullet = function(type, bullet, index){\n\n            delete(bullet.edit_me);\n\n            CourseService.UpdateBullet(bullet)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success){\n\n                        vm.bullets[type][index].edit_me = false;\n\n                    } else {\n                        ToastService.error('Error', 'An error occurred');\n                    }\n                    //refresh_tem();\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n                });\n        }\n\n        vm.update_cancel_bullet = function(index){\n            refresh_bullets();\n        }\n\n        vm.edit_bullet = function(type, index){\n\n            vm.bullets[type][index].edit_me = true;\n\n        }\n\n        vm.delete_bullet = function(type, bullet, index){\n\n            CourseService.DeleteBullet(bullet.id)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success){\n                        vm.bullets[type].splice(index, 1);\n                    } else {\n                        ToastService.error('Error', 'An error occurred');\n                    }\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n                });\n        }\n\n\n\n\n\n  \n\n        $scope.save_bullet_order = function(type){\n            ////console.log(\"hiya\");\n            var update_order = [];\n            for(var i=0; i < vm.bullets[type].length;i++){\n                var me = {\n                    id: vm.bullets[type][i].id,\n                    organise: i\n                }\n                update_order.push(me);\n            }\n            // //console.log(\"organised: \", update_order);\n\n            CourseService.UpdateBulletOrder({\"order\": update_order})\n                .then(function(data){\n                   // //console.log(data);\n\n                    // vm.items = data.items;\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n\n                });\n\n        }\n\n\n        $scope.save_items_order = function(){\n            // //console.log(\"hiya\");\n            var update_order = [];\n            for(var i=0; i < vm.items.length;i++){\n                var me = {\n                    id: vm.items[i].id,\n                    organise: i\n                }\n                update_order.push(me);\n            }\n            // //console.log(\"organised: \", update_order);\n\n            CourseService.UpdateItemsOrder({\"order\": update_order})\n                .then(function(data){\n                    //console.log(data);\n\n                    // vm.items = data.items;\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n\n                });\n\n        }\n\n        $scope.save_tem_order = function(){\n            // //console.log(\"hiya\");\n            var update_order = [];\n            for(var i=0; i < vm.tem.length;i++){\n                var me = {\n                    id: vm.tem[i].id,\n                    organise: i\n                }\n                update_order.push(me);\n            }\n            // //console.log(\"organised: \", update_order);\n\n            CourseService.UpdateTemOrder({\"order\": update_order})\n                .then(function(data){\n                    //console.log(data);\n\n                    // vm.items = data.items;\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n\n                });\n\n        }\n\n\n\n\n        function refresh_items(){\n            CourseService.GetItemsByLessonId($stateParams.lesson_id)\n                .then(function(data){\n                    //console.log(data);\n\n                    vm.items = data.items;\n\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n\n                });\n        }\n\n        vm.add_item = function(){\n\n            vm.new_item.lesson_id = $stateParams.lesson_id; \n\n            vm.new_item.organise = (vm.items && vm.items.length > 0) ? vm.items.length : 0;\n\n            CourseService.CreateItem(vm.new_item)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success){\n\n                        vm.items.push(data.item);\n\n                        vm.new_item = {\n                            title: \"\"\n                        }\n                    } else {\n                        ToastService.error('Error', 'An error occurred');\n                    }\n\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n\n                });\n        }\n\n        vm.update_item = function(item, index){\n\n            delete(item.edit_me);\n\n            CourseService.UpdateItem(item)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success){\n\n                        vm.items[index].edit_me = false;\n\n                    } else {\n                        ToastService.error('Error', 'An error occurred');\n                    }\n                    //refresh_tem();\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n                });\n        }\n\n        vm.update_cancel_item = function(index){\n            refresh_items();\n        }\n\n        vm.edit_item = function(index){\n\n            vm.items[index].edit_me = true;\n\n        }\n\n        vm.delete_item = function(item, index){\n\n            CourseService.DeleteItem(item.id)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success){\n                        vm.items.splice(index, 1);\n                    } else {\n                        ToastService.error('Error', 'An error occurred');\n                    }\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n                });\n        }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        $scope.back = function(){\n            $window.history.back();\n        }\n\n\n\n        vm.clearFieldError = function(event) { ToastService.clearFieldError(event); };\n\n        $scope.save = function(){\n            var checks = [\n                { ok: vm.club.lesson.title, field: 'title', label: 'Lesson Title' }\n            ];\n            if (!ToastService.validateForm(checks)) return;\n\n            $scope.update();\n        }\n\n\n        $scope.create = function(){\n            var checks = [\n                { ok: vm.club.lesson.title, field: 'title', label: 'Lesson Title' }\n            ];\n            if (!ToastService.validateForm(checks)) return;\n\n            vm.club.lesson.course_id = $stateParams.course_id;\n\n            CourseService.CreateLesson(vm.club.lesson)\n                .then(function(data){\n                    ////console.log(data);\n                    $state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n\n                });\n\n\n        }\n\n        $scope.delete = function(){\n            //console.log(\"CLICK\");\n            ToastService.warning('Confirm Delete', 'Are you sure you would like to delete this lesson?');\n            CourseService.DeleteLesson(vm.club.lesson.id)\n                .then(function(data){\n                    //console.log(data);\n                });\n        }\n\n        function get_update_docs(){\n            var documents = [];\n\n            for(var i=0;i<update_this_file.length;i++){\n                var id = update_this_file[i];\n                //console.log(\"looking for : \", id);\n                //console.log(\"in: \", vm.lesson_documents);\n\n                for(var k=0;k<vm.club.lesson.lesson_documents.length;k++){\n                    //console.log(\"comparing to : \", vm.club.lesson.lesson_documents[k].id);\n                    if(vm.club.lesson.lesson_documents[k].id == id){\n                        documents.push(vm.club.lesson.lesson_documents[k]);\n                    }\n                }\n\n            }\n\n            // //console.log(\"DOCS TO UPDATE : \", documents);\n\n            return documents;\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n         \n\n            CourseService.UpdateLesson(vm.club.lesson)\n                .then(function(data){\n                    //console.log(data);\n                    //console.log(\"saved\");\n                    $state.go('dashboard.manage_club.edit_course', {course_id: vm.club.lesson.course_id, reload: true});\n                });\n        }\n\n\n        function containsObject(obj, list, params) {\n\n            // //console.log(\"obj\", obj);\n            // //console.log(\"list\", list);\n            // //console.log(\"params\", params);\n\n            for(var i=0; i<list.length; i++) {\n                // //console.log(\"list i : \", list[i]);\n                // //console.log(\"obj is: \", obj);\n\n                var count_success = 0;\n                for(var j=0;j<params.length;j++){\n                    if(list[i][params[j]] && obj[params[j]] && list[i][params[j]] == obj[params[j]]){\n                        count_success++;\n                    }\n                }\n\n                if(count_success === params.length) {                    \n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n\n       \n\n        $scope.add_item = function(type){\n            //console.log(\"ADD\");\n            switch(type){\n                case \"licence\":\n                    //console.log(\"licence\");\n                    if(vm.temporary.licence && vm.temporary.licence !== \"\" && vm.temporary.rating && vm.temporary.rating !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_licence = {\n                            licence_id: vm.temporary.licence.id,\n                            licence_title: vm.temporary.licence.abbreviation,\n                            rating_title: vm.temporary.rating.abbreviation,\n                            rating_id: vm.temporary.rating.id\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_licence, vm.club.lesson.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n                            vm.club.lesson.requirements.licence.push(add_licence);\n                        }\n\n                        delete vm.temporary.licence;\n                        delete vm.temporary.rating;\n\n                    } else {\n                        ToastService.warning('Missing Licence', 'Please select a licence and rating that is required to book the lesson solo!');\n                    }\n\n                break;\n\n\n                case \"medical\":\n                    //console.log(\"medical\");\n                    if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_medical = {\n                            authority_id: vm.temporary.medical_authority.id,\n                            authority_title: vm.temporary.medical_authority.abbreviation,\n                            medical_component_id: vm.temporary.medical_component.id,\n                            medical_component_title: vm.temporary.medical_component.title\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_medical, vm.club.lesson.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n                            vm.club.lesson.requirements.medical.push(add_medical);\n                        }\n\n                        delete vm.temporary.medical_authority;\n                        delete vm.temporary.medical_component;\n\n                    } else {\n                        ToastService.warning('Missing Medical', 'Please select a medical that is required to book the lesson solo!');\n                    }\n\n                break;\n\n\n                case \"differences\":\n                    //console.log(\"difference\");\n                    if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_difference = {\n                            difference_id: vm.temporary.difference.id,\n                            difference_title: vm.temporary.difference.title\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_difference, vm.club.lesson.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n                            vm.club.lesson.requirements.differences.push(add_difference);\n                        }\n\n                        delete vm.temporary.difference;\n\n                    } else {\n                        ToastService.warning('Missing Difference', 'Please select a difference that is required to book the lesson solo!');\n                    }\n\n                break;\n\n\n            }\n\n\n\n        }\n\n\n\n\n\n\n\n\n\n\n\n\n\n        $scope.update_this_file = function(file){\n            //console.log(\"==== update is : \", file.id);\n            if(update_this_file.indexOf(file.id) === -1){\n                update_this_file.push(file.id)\n            } else {\n               ////console.log(\"This item already exists\"); \n            } \n        }\n\n\n         $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.club.lesson.lesson_documents = $.grep(vm.club.lesson.lesson_documents, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                PlaneDocumentService.Delete(vm.user_id, file.id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.lesson_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n\n\n        vm.files = {\n            radio: [],\n            cert: [],\n            insurance: [],\n            noise: []\n        }\n\n\n           $scope.processFile = function(files, location){\n                 //console.log(\"files\", files[0].file_return);\n\n                     // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[0].file_return);\n                     ////console.log(\"PARSED\", j);\n                    // //console.log(\"J is : \",j);\n                    // //console.log(\"name is : \", j.files.file.name);\n\n                    files[0].file.temp_path = j.saved_url;\n                    files[0].file.save_name = j.files.file.name;\n\n                    var ft = j.files.file.name;\n                    //console.log(\"ft\", ft);\n                    var fft = ft.split('.').pop();\n                    files[0].file.extension = fft;\n                    //console.log(\"FILE is : \", files[0]);\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.files[location].push(files[0].file);\n\n\n            }\n\n            $scope.set_title = function(file){\n                //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            //console.log(\"REMOVE: \", j);\n            //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            PoidService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.lesson_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n          // $scope.$on('flow::fileAdded', function (event, $flow, flowFile) {\n          //     event.preventDefault();//prevent file from uploading\n          //     //console.log(\"FILE ADDED\");\n          //     //console.log($flow);\n          //   });\n\n            $scope.processFiles = function(files){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    //console.log(\"J is : \",j);\n                    //console.log(\"name is : \", j.files.file.name);\n\n                    files[i].file.temp_path = j.saved_url;\n                    files[i].file.save_name = j.files.file.name;\n                    var ft = j.files.file.name;\n                    ft = ft.split('.').pop();\n                    files[i].file.extension = ft;\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.lesson_documents.push(files[i].file);\n                }\n\n\n            }\n\n            $scope.set_title = function(file){\n                //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            $scope.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n\n\n\n        initController();\n\n        // \n        // LESSON CONTENT FILE UPLOAD & PDF PAGE SELECTOR\n        // \n\n        function refresh_content_files() {\n            CourseService.GetLessonContentFiles($stateParams.lesson_id)\n                .then(function(data) {\n                    if (data && data.items) {\n                        vm.contentFiles = data.items;\n                        // Fetch decrypted file data for each file\n                        angular.forEach(vm.contentFiles, function(file) {\n                            file._loading = true;\n                            file.data_uri = null;\n                            CourseService.GetLessonContentFileData(file.id)\n                                .then(function(res) {\n                                    if (res && res.success) {\n                                        file.data_uri = res.data_uri;\n                                        file.file_base64 = res.file;\n                                    }\n                                    file._loading = false;\n                                })\n                                .catch(function() {\n                                    file._loading = false;\n                                    file._loadError = true;\n                                });\n                        });\n                    } else {\n                        vm.contentFiles = [];\n                    }\n                });\n        }\n\n        //  Tab switching \n        vm.switchContentTab = function(tab) {\n            vm.lessonContentTab = tab;\n        };\n\n        //  File input handler \n        vm.triggerFileInput = function() {\n            var input = document.getElementById('lesson-content-file-input');\n            if (input) input.click();\n        };\n\n        vm.onFileInputChange = function(files) {\n            if (files && files.length > 0) {\n                vm.handleSelectedFiles(files);\n            }\n        };\n\n        //  Process selected files \n        vm.handleSelectedFiles = function(fileList) {\n            var allowedTypes = ['image/png', 'image/jpeg', 'image/jpg', 'application/pdf'];\n            var maxSize = 20 * 1024 * 1024; // 20MB\n\n            for (var i = 0; i < fileList.length; i++) {\n                var file = fileList[i];\n\n                // Validate type\n                if (allowedTypes.indexOf(file.type) === -1) {\n                    ToastService.error('Invalid File Type', file.name + ' is not a supported format. Please use PNG, JPG, or PDF.');\n                    continue;\n                }\n\n                // Validate size\n                if (file.size > maxSize) {\n                    ToastService.error('File Too Large', file.name + ' exceeds the 20MB limit.');\n                    continue;\n                }\n\n                // If PDF, open page selector\n                if (file.type === 'application/pdf') {\n                    vm.openPdfSelector(file);\n                    return; // Only one PDF at a time\n                }\n\n                // For images, generate preview and add to queue\n                vm.addImageToQueue(file);\n            }\n\n            $scope.$applyAsync();\n        };\n\n        //  Image preview + queue \n        vm.addImageToQueue = function(file) {\n            var reader = new FileReader();\n            reader.onload = function(e) {\n                $scope.$apply(function() {\n                    vm.uploadQueue.push({\n                        file: file,\n                        name: file.name,\n                        size: file.size,\n                        type: file.type,\n                        preview: e.target.result,\n                        isPdf: false,\n                        pdfPages: null\n                    });\n                });\n            };\n            reader.readAsDataURL(file);\n        };\n\n        //  Remove from queue \n        vm.removeFromQueue = function(index) {\n            vm.uploadQueue.splice(index, 1);\n        };\n\n        // \n        // PDF PAGE SELECTOR\n        // \n\n        vm.openPdfSelector = function(file) {\n            vm.pdfSelector.active = true;\n            vm.pdfSelector.file = file;\n            vm.pdfSelector.fileName = file.name;\n            vm.pdfSelector.pages = [];\n            vm.pdfSelector.selectedPages = [];\n            vm.pdfSelector.totalPages = 0;\n            vm.pdfSelector.loading = true;\n            vm.pdfSelector.error = null;\n\n            var reader = new FileReader();\n            reader.onload = function(e) {\n                var typedArray = new Uint8Array(e.target.result);\n                \n                // Use PDF.js to load the document\n                if (typeof pdfjsLib === 'undefined') {\n                    $scope.$apply(function() {\n                        vm.pdfSelector.loading = false;\n                        vm.pdfSelector.error = 'PDF viewer library not loaded. Please refresh the page and try again.';\n                    });\n                    return;\n                }\n\n                pdfjsLib.getDocument({ data: typedArray }).promise.then(function(pdf) {\n                    $scope.$apply(function() {\n                        vm.pdfSelector.totalPages = pdf.numPages;\n                    });\n\n                    // Render thumbnails for each page\n                    var renderPromises = [];\n                    for (var p = 1; p <= pdf.numPages; p++) {\n                        renderPromises.push(renderPdfPage(pdf, p));\n                    }\n\n                    Promise.all(renderPromises).then(function(pages) {\n                        $scope.$apply(function() {\n                            vm.pdfSelector.pages = pages;\n                            vm.pdfSelector.loading = false;\n                        });\n                    });\n\n                }).catch(function(err) {\n                    $scope.$apply(function() {\n                        vm.pdfSelector.loading = false;\n                        vm.pdfSelector.error = 'Failed to read PDF file. Please ensure it is a valid PDF.';\n                    });\n                });\n            };\n            reader.readAsArrayBuffer(file);\n        };\n\n        function renderPdfPage(pdf, pageNum) {\n            return pdf.getPage(pageNum).then(function(page) {\n                var scale = 1.5;\n                var viewport = page.getViewport({ scale: scale });\n                var canvas = document.createElement('canvas');\n                var context = canvas.getContext('2d');\n                canvas.height = viewport.height;\n                canvas.width = viewport.width;\n\n                return page.render({\n                    canvasContext: context,\n                    viewport: viewport\n                }).promise.then(function() {\n                    return {\n                        pageNum: pageNum,\n                        thumbnail: canvas.toDataURL('image/png'),\n                        selected: false\n                    };\n                });\n            });\n        }\n\n        vm.togglePdfPage = function(page) {\n            if (page.selected) {\n                // Deselect\n                page.selected = false;\n                vm.pdfSelector.selectedPages = vm.pdfSelector.selectedPages.filter(function(p) {\n                    return p !== page.pageNum;\n                });\n            } else {\n                // Check limit\n                if (vm.pdfSelector.selectedPages.length >= 2) {\n                    ToastService.warning('Page Limit', 'You can select a maximum of 2 pages per PDF file.');\n                    return;\n                }\n                page.selected = true;\n                vm.pdfSelector.selectedPages.push(page.pageNum);\n            }\n        };\n\n        vm.confirmPdfPages = function() {\n            if (vm.pdfSelector.selectedPages.length === 0) {\n                ToastService.warning('No Pages Selected', 'Please select at least one page from the PDF.');\n                return;\n            }\n\n            // Find selected page thumbnails for preview\n            var selectedThumbnails = vm.pdfSelector.pages.filter(function(p) {\n                return p.selected;\n            }).map(function(p) {\n                return { pageNum: p.pageNum, thumbnail: p.thumbnail };\n            });\n\n            vm.uploadQueue.push({\n                file: vm.pdfSelector.file,\n                name: vm.pdfSelector.fileName,\n                size: vm.pdfSelector.file.size,\n                type: 'application/pdf',\n                preview: selectedThumbnails[0].thumbnail,\n                isPdf: true,\n                pdfPages: vm.pdfSelector.selectedPages.slice().sort(),\n                pdfThumbnails: selectedThumbnails\n            });\n\n            vm.closePdfSelector();\n        };\n\n        vm.closePdfSelector = function() {\n            vm.pdfSelector.active = false;\n            vm.pdfSelector.file = null;\n            vm.pdfSelector.pages = [];\n            vm.pdfSelector.selectedPages = [];\n            vm.pdfSelector.totalPages = 0;\n            vm.pdfSelector.loading = false;\n            vm.pdfSelector.error = null;\n        };\n\n        // \n        // UPLOAD FILES TO SERVER\n        // \n\n        vm.uploadAllFiles = function() {\n            if (vm.uploadQueue.length === 0) {\n                ToastService.warning('No Files', 'Please add at least one file to upload.');\n                return;\n            }\n\n            vm.isUploading = true;\n            var uploadPromises = [];\n\n            for (var i = 0; i < vm.uploadQueue.length; i++) {\n                uploadPromises.push(uploadSingleFile(vm.uploadQueue[i], i));\n            }\n\n            Promise.all(uploadPromises).then(function() {\n                $scope.$apply(function() {\n                    vm.isUploading = false;\n                    vm.uploadQueue = [];\n                    vm.uploadProgress = {};\n                    refresh_content_files();\n                    ToastService.success('Upload Complete', 'Your lesson content files have been uploaded successfully.');\n                });\n            }).catch(function() {\n                $scope.$apply(function() {\n                    vm.isUploading = false;\n                    ToastService.error('Upload Error', 'One or more files failed to upload. Please try again.');\n                });\n            });\n        };\n\n        function uploadSingleFile(queueItem, index) {\n            var formData = new FormData();\n            formData.append('file', queueItem.file);\n            formData.append('lesson_id', $stateParams.lesson_id);\n            formData.append('file_type', queueItem.isPdf ? 'pdf' : 'image');\n\n            if (queueItem.isPdf && queueItem.pdfPages) {\n                formData.append('pdf_pages', JSON.stringify(queueItem.pdfPages));\n            }\n\n            vm.uploadProgress[index] = 0;\n\n            return CourseService.UploadLessonContentFile(formData)\n                .then(function(data) {\n                    $scope.$applyAsync(function() {\n                        vm.uploadProgress[index] = 100;\n                    });\n                    if (!data.success) {\n                        throw new Error(data.message || 'Upload failed');\n                    }\n                    return data;\n                })\n                .catch(function(err) {\n                    $scope.$applyAsync(function() {\n                        vm.uploadProgress[index] = -1; // mark as failed\n                    });\n                    throw err;\n                });\n        }\n\n        //  Reorder content files (called after dnd-moved) \n        $scope.save_content_files_order = function() {\n            var update_order = [];\n            for (var i = 0; i < vm.contentFiles.length; i++) {\n                update_order.push({\n                    id: vm.contentFiles[i].id,\n                    organise: i\n                });\n            }\n\n            CourseService.UpdateLessonContentFilesOrder({ order: update_order })\n                .then(function(data) {\n                    if (data.success) {\n                        ToastService.success('Order Saved', 'File order has been updated.');\n                    }\n                });\n        };\n\n        //  Delete an existing content file \n        vm.deleteContentFile = function(file, index) {\n            if (!confirm('Are you sure you want to delete this file?')) return;\n\n            CourseService.DeleteLessonContentFile(file.id)\n                .then(function(data) {\n                    if (data.success) {\n                        vm.contentFiles.splice(index, 1);\n                        ToastService.success('Deleted', 'File has been removed.');\n                    } else {\n                        ToastService.error('Error', 'Failed to delete the file.');\n                    }\n                });\n        };\n\n        //  Replace an existing content file \n        vm.replaceContentFile = function(existingFile) {\n            var input = document.createElement('input');\n            input.type = 'file';\n            input.accept = '.png,.jpg,.jpeg,.pdf';\n            input.onchange = function(e) {\n                var file = e.target.files[0];\n                if (!file) return;\n\n                var allowedTypes = ['image/png', 'image/jpeg', 'image/jpg', 'application/pdf'];\n                if (allowedTypes.indexOf(file.type) === -1) {\n                    $scope.$apply(function() {\n                        ToastService.error('Invalid File Type', 'Please use PNG, JPG, or PDF.');\n                    });\n                    return;\n                }\n\n                if (file.type === 'application/pdf') {\n                    $scope.$apply(function() {\n                        vm.replacingFileId = existingFile.id;\n                        vm.openPdfSelector(file);\n                    });\n                    return;\n                }\n\n                // Direct image replacement\n                var formData = new FormData();\n                formData.append('file', file);\n                formData.append('lesson_id', $stateParams.lesson_id);\n                formData.append('file_type', 'image');\n\n                CourseService.UpdateLessonContentFile(existingFile.id, formData)\n                    .then(function(data) {\n                        if (data.success) {\n                            refresh_content_files();\n                            ToastService.success('Replaced', 'File has been updated.');\n                        } else {\n                            ToastService.error('Error', 'Failed to replace the file.');\n                        }\n                    });\n            };\n            input.click();\n        };\n\n        //  Format file size \n        vm.formatFileSize = function(bytes) {\n            if (!bytes) return '0 B';\n            var sizes = ['B', 'KB', 'MB', 'GB'];\n            var i = Math.floor(Math.log(bytes) / Math.log(1024));\n            return (bytes / Math.pow(1024, i)).toFixed(1) + ' ' + sizes[i];\n        };\n\n        //  Get file type icon class \n        vm.getFileTypeIcon = function(fileType) {\n            if (!fileType) return 'fa-file';\n            if (fileType.indexOf('pdf') > -1) return 'fa-file-pdf';\n            if (fileType.indexOf('image') > -1) return 'fa-file-image';\n            return 'fa-file';\n        };\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n       \n\n\n    }\n app.controller('DashboardClubMaintenanceController', DashboardClubMaintenanceController);\n\n    DashboardClubMaintenanceController.$inject = ['UserService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'LicenceService', 'MedicalService', 'DifferencesService', 'PlaneDocumentService', 'FoxService', '$http', 'WorkpackService', 'CrsService', 'LogbookLinkService', 'ToastService'];\n    function DashboardClubMaintenanceController(UserService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, LicenceService, MedicalService, DifferencesService, PlaneDocumentService, FoxService, $http, WorkpackService, CrsService, LogbookLinkService, ToastService) {\n        var vm = this;\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {\n            plane: {\n                requirements: {\n                    licence: [],\n                    medical: [],\n                    differences: []\n                },\n                documents: []\n            }\n        };\n\n        vm.page_title = \"\";\n        \n        vm.plane_document = {};\n        vm.plane_documents = [];\n\n        var update_this_file = [];\n        \n        \n        vm.currency_types = [\"class\", \"type\"];\n        vm.gear_types = [\"tricycle\", \"tailwheel\", \"monowheel\", \"floats\", \"skis\"];\n\n        vm.charge_type = [\"brakes\", \"tacho\", \"hobbs\"];\n        vm.surcharge_type = [\"none\", \"flight\", \"hour\"];\n\n        // Determine action from stateParams rather than $state.current.data.action,\n        // because when a child state (e.g. airframe_logbook) is active, $state.current\n        // points to the child whose data.action may differ from the parent's.\n        vm.action = $stateParams.plane_id ? 'edit' : ($state.current.data.action || 'list');\n        vm.user = $rootScope.globals.currentUser;\n        // //console.log(\"$rootScope.globals.currentUser : \", $rootScope.globals.currentUser);\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user_id = vm.user.id;\n\n        vm.show_overlay = false;\n        vm.show_cert = false;\n        vm.show_maintenance = false;\n        vm.show_radio = false;\n        vm.show_noise = false;\n        vm.show_insurance = false;\n        vm.show_offline = false;\n        vm.show_crs = false;\n        vm.crs_records = [];\n\n        vm.obj = {\n            issues: [],\n            issue_confirmation: false\n        };\n\n       vm.reported_defects = [];\n\n       vm.maintenance_types = [\n        \"annual\", \"25hours\", \"50hours\", \"100hours\", \"interim\", \"6months\", \"extension\", \"workpack\"\n       ];\n\n       //  Workpacks \n       vm.workpacks = [];\n       vm.workpack = null;\n       vm.open_workpacks = [];\n       vm.new_workpack = {};\n       vm.show_create_workpack = false;\n       vm.show_workpack_detail = false;\n       vm.workpack_files = { workpack_doc: [] };\n       vm.defect_workpack_files = { defect_wp_doc: [] };\n       vm.show_link_defect = false;\n       vm.show_link_maintenance = false;\n       vm.show_defect_workpack = false;\n       vm.selected_defect_for_wp = null;\n       vm.defect_wp = {};\n\n       //  Maintenance Events \n       vm.maintenance_events = [];\n       vm.selected_event = null;\n       vm.show_event_detail = false;\n       vm.event_filter = 'all';\n\n       //  Logbook Links \n       vm.available_logbooks = [];\n       vm.event_logbook_links = [];\n       vm.logbook_checkboxes = [];\n       vm.saving_logbook_links = false;\n       vm.logbook_load_error = false;\n       vm.create_logbook_checkboxes = [];\n       vm.create_logbook_loading = false;\n       vm.create_logbook_error = false;\n\n      \n        //  List loading function (called on init and when returning from detail) \n        function loadMaintenanceList() {\n            PlaneService.GetAllByClubMaintenance(vm.club_id)\n                .then(function(data){\n                    vm.club.planes = data;\n                });\n        }\n\n        //  Detail loading function (called on init and when returning from child states) \n        function loadMaintenanceDetail() {\n            PlaneService.GetByIdMaintenance2($stateParams.plane_id, vm.club_id)\n                .then(function(data){\n                    vm.club.plane = data;  \n                    vm.this_plane_id = $stateParams.plane_id; \n\n                    if(vm.club.plane && vm.club.plane.maintenance){\n                        vm.obj.hours_remaining = vm.club.plane.maintenance.hours_remaining;\n                        vm.obj.next_check = new Date(vm.club.plane.maintenance.next_maintenance);\n                        vm.obj.check_date = new Date();\n                        vm.obj.extension_granted = new Date();\n                    }\n\n                    vm.page_title = \"Edit a Plane Maintenance - \"+vm.club.plane.registration;\n                });\n\n            PlaneService.GetOpenIssues($stateParams.plane_id)\n                .then(function (data) {\n                    vm.reported_defects = data;\n                });\n\n            WorkpackService.GetByPlane($stateParams.plane_id)\n                .then(function (data) {\n                    if (data.success !== false) {\n                        vm.workpacks = data.workpacks || [];\n                    }\n                });\n\n            WorkpackService.GetOpenByPlane($stateParams.plane_id)\n                .then(function (data) {\n                    if (data.success !== false) {\n                        vm.open_workpacks = data.workpacks || [];\n                    }\n                });\n\n            PlaneService.GetMaintenanceEvents($stateParams.plane_id)\n                .then(function (data) {\n                    if (data && data.maintenance_events) {\n                        vm.maintenance_events = data.maintenance_events;\n                    } else if (data && data.events) {\n                        vm.maintenance_events = data.events;\n                    } else if (Array.isArray(data)) {\n                        vm.maintenance_events = data;\n                    }\n                });\n        }\n\n        switch(vm.action){\n            case \"add\":\n                // //console.log(\"adding a new plane please\");\n                vm.page_title = \"Add a New Plane\";\n            break;\n            case \"edit\":\n                // //console.log(\"edit an existing plane\");\n                \n                loadMaintenanceDetail();\n\n                // Reload data when navigating back from child states (e.g. logbook pages)\n                var deregisterStateChange = $scope.$on('$stateChangeSuccess', function(event, toState) {\n                    if (toState.name === 'dashboard.manage_club.maintenance.detail') {\n                        loadMaintenanceDetail();\n                    }\n                });\n                $scope.$on('$destroy', deregisterStateChange);\n\n\n               \n\n\n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                loadMaintenanceList();\n\n                // Reload list when navigating back from child states (e.g. detail page)\n                var deregisterListChange = $scope.$on('$stateChangeSuccess', function(event, toState) {\n                    if (toState.name === 'dashboard.manage_club.maintenance') {\n                        loadMaintenanceList();\n                    }\n                });\n                $scope.$on('$destroy', deregisterListChange);\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n        vm.reset_aeroplane = function(){\n            if(vm.this_plane_id && vm.this_plane_id > 0){\n                var a = confirm(\"Are you sure you wish to override the logs?\");\n                if(a){\n                    FoxService.ResetOneClubPlane(vm.this_plane_id)\n                    .then(function(data){\n                        console.log(data);\n                        if(data.success){\n                            ToastService.success('Reset Complete', 'Logbooks have been re-checked.');\n                        }  \n                        // //console.log(vm.club.planes);\n                    });\n                } else {\n                    //ignore for now\n                }\n            } else {\n                ToastService.error('Error', 'An unexpected error occurred.');\n            }\n        }\n\n        //'9' needs to refer the the user's account set to manage\n        vm.selected_type = \"\";\n        vm.send_obj = {};\n        $scope.show_overlay = function(type){\n        \n            vm.show_overlay = true;\n            \n            vm.selected_type = type;\n\n            if(type == \"maintenance\"){\n                vm.show_cert = true;\n                vm.show_insurance = true;\n                vm.show_radio = true;\n                vm.show_maintenance = true;\n                vm.show_noise = true;\n                vm.show_crs = true;\n                vm.show_offline = false;\n                // Default new workpack status to 'completed'\n                vm.new_workpack = { status: 'completed' };\n                vm.workpack_files = { workpack_doc: [] };\n                // Load available logbooks for the checkbox section\n                vm.loadCreateLogbooks();\n            } else if(type == \"crs\"){\n                vm.show_cert = false;\n                vm.show_insurance = false;\n                vm.show_radio = false;\n                vm.show_maintenance = false;\n                vm.show_noise = false;\n                vm.show_crs = true;\n                vm.show_offline = false;\n            } else if(type == \"cert\"){\n                vm.show_cert = true;\n                vm.show_insurance = false;\n                vm.show_radio = false;\n                vm.show_maintenance = false;\n                vm.show_noise = false;\n                vm.show_crs = false;\n                vm.show_offline = false;\n            } else if(type == \"insurance\"){\n                vm.show_cert = false;\n                vm.show_insurance = true;\n                vm.show_radio = false;\n                vm.show_maintenance = false;\n                vm.show_noise = false;\n                vm.show_crs = false;\n                vm.show_offline = false;\n            } else if(type == \"radio\"){\n                vm.show_cert = false;\n                vm.show_insurance = false;\n                vm.show_radio = true;\n                vm.show_maintenance = false;\n                vm.show_noise = false;\n                vm.show_crs = false;\n                vm.show_offline = false;\n            } else if(type == \"noise\"){\n                vm.show_cert = false;\n                vm.show_insurance = false;\n                vm.show_radio = false;\n                vm.show_maintenance = false;\n                vm.show_noise = true;\n                vm.show_crs = false;\n                vm.show_offline = false;\n            } else if(type == \"offline\"){\n                vm.show_cert = false;\n                vm.show_insurance = false;\n                vm.show_offline = true;\n                vm.show_radio = false;\n                vm.show_noise = false;\n                vm.show_crs = false;\n                vm.show_maintenance = false;\n            } \n\n            \n\n       }\n\n       $scope.close_overlay = function(){\n            vm.show_overlay = false;\n\n       }\n\n\n        $scope.get_hours_from_decimal = function(time){\n\n            if(time){\n                 var sign = time < 0 ? \"-\" : \"\";\n                 var hour = Math.floor(Math.abs(time));\n                 var min = Math.round((Math.abs(time) * 60) % 60);\n                 if(min == 60){\n                     hour++;\n                     min = 0;\n                 }\n                 return sign + (hour < 10 ? \"0\" : \"\") + hour + \":\" + (min < 10 ? \"0\" : \"\") + min;\n             } else {\n                 return \"N/A\";\n             }\n            \n\n        }\n\n\n\n        $scope.filter_detail = function(show_all = 0){\n                return (show_all == 0) ? {status: \"open\"} : {};\n            }\n\n            $scope.count_defects = function(defects, show_all = 0){\n\n               var counter = 0;\n\n               for(var i=0;i<defects.length;i++){\n                   if(show_all == 1){\n                       counter++;\n                   } else {\n                       if(defects[i].status == \"open\"){\n                           counter++;\n                       }\n                   }\n               }\n\n               return counter;\n\n           }\n\n\n\n\n        $scope.save_overlay = function(){\n\n            //first we save stuff   \n\n           \n            \n\n            var save = vm.obj;\n            \n            // //console.log(\"FILES ARE \", vm.files);\n\n            save.files = {\n                radio: (vm.files.radio[0]) ? vm.files.radio[0].file : {},\n                cert: (vm.files.cert[0]) ? vm.files.cert[0].file : {},\n                noise_cert: (vm.files.noise_cert[0]) ? vm.files.noise_cert[0].file : {},\n                insurance: (vm.files.insurance[0]) ? vm.files.insurance[0].file : {}\n            }\n\n            var send_update = false;\n\n\n            save.selected_type = vm.selected_type;\n\n            var send_obj = {};\n\n            if(vm.one_ticked){\n               for(var i=0;i<vm.reported_defects.length;i++){\n                if(vm.reported_defects[i].resolved){\n                    vm.obj.issues.push(vm.reported_defects[i]);\n                }\n               } \n               send_obj.issues = vm.obj.issues;\n               if(send_obj.issues.length > 0){\n                   send_update = true;\n               }\n            }\n\n            if((vm.files.radio[0] && vm.obj.radio_expiry == null) || (!vm.files.radio[0] && vm.obj.radio_expiry)){\n                ToastService.warning('Radio Incomplete', 'Please add both the expiry date and the new certificate.');\n                return false;\n            } else if(vm.files.radio[0] && vm.obj.radio_expiry){\n                send_obj.radio = {\n                    file: (vm.files.radio[0]) ? vm.files.radio[0].file : {},\n                    expiry: vm.obj.radio_expiry\n                };\n                send_update = true;\n            }\n\n            // //console.log(\"radio file \", vm.files.radio[0]);\n\n\n            if((vm.files.cert[0] && vm.obj.certificate_expiry == null) || (vm.files.cert[0] == null && vm.obj.certificate_expiry)){\n                ToastService.warning('Certificate Incomplete', 'Please add both the expiry date and the new certificate.');\n                return false;\n            } else if(vm.files.cert[0] && vm.obj.certificate_expiry) {\n                send_obj.cert = {\n                    file: (vm.files.cert[0]) ? vm.files.cert[0].file : {},\n                    expiry: vm.obj.certificate_expiry,\n                    date_issued: vm.obj.certificate_issue\n                }\n                send_update = true;\n            }\n\n            // //console.log(\"insurance file \", vm.files.insurance[0]);\n\n            if((vm.files.insurance[0] && !vm.obj.insurance_expiry) || (vm.files.insurance[0] == null && vm.obj.insurance_expiry)){\n                ToastService.warning('Insurance Incomplete', 'Please add both the expiry date and the new certificate.');\n                return false;\n            } else if(vm.files.insurance[0] && vm.obj.insurance_expiry) {\n                send_obj.insurance = {\n                    file: (vm.files.insurance[0]) ? vm.files.insurance[0].file : {},\n                    expiry: vm.obj.insurance_expiry\n                }\n                send_update = true;\n            }\n\n\n\n            if((vm.files.noise_cert[0] && !vm.obj.noise_date) || (vm.files.noise_cert[0] == null && vm.obj.noise_date)){\n                ToastService.warning('Noise Certificate Incomplete', 'Please add both the date and the certificate, or leave both empty.');\n                return false;\n            } else if(vm.files.noise_cert[0] && vm.obj.noise_date) {\n                send_obj.noise_cert = {\n                    file: (vm.files.noise_cert[0]) ? vm.files.noise_cert[0].file : {},\n                    noise_level: vm.obj.noise_level,\n                    date_issued: vm.obj.noise_date\n                }\n                send_update = true;\n            }\n\n\n            //  CRS (Certificate of Release to Service) \n            if (vm.files.crs[0]) {\n                if (!vm.obj.crs_release_date || !vm.obj.crs_release_time) {\n                    ToastService.warning('CRS Incomplete', 'Please add the release date, release time, and the certificate.');\n                    return false;\n                }\n                // CRS uses its own endpoint, not AddMaintenance\n                var crsPayload = {\n                    plane_id: parseInt(vm.this_plane_id),\n                    release_date: moment(vm.obj.crs_release_date).format('YYYY-MM-DD'),\n                    release_time: moment(vm.obj.crs_release_time).format('HH:mm:ss'),\n                    file: vm.files.crs[0].file\n                };\n                send_obj.crs = crsPayload;\n                send_update = true;\n            } else if (vm.obj.crs_release_date || vm.obj.crs_release_time) {\n                ToastService.warning('CRS Incomplete', 'Please upload the certificate document along with the release date and time.');\n                return false;\n            }\n\n\n            // //console.log(\"type:\", vm.obj.maintenance_type);\n            // //console.log(\"remaining:\", vm.obj.hours_remaining);\n            // //console.log(\"next_check:\", vm.obj.next_check);\n           \n\n\n            // //console.log(\"firs: \", (vm.obj.maintenance_type !== undefined \n            //  || vm.obj.hours_remaining !== undefined \n            //  || vm.obj.next_check !== undefined));\n\n            // //console.log(\"secon: \",((vm.obj.maintenance_type !== \"\" || vm.obj.maintenance_type !== undefined) && (vm.obj.hours_remaining !== undefined || vm.obj.hours_remaining !== \"\") \n            //     && (vm.obj.next_check !== undefined && vm.obj.next_check !== \"\")) );\n          \n            // Only validate maintenance fields when the maintenance overlay is active\n            if(vm.show_maintenance){\n\n              //  Validate required fields before proceeding \n              // 1. Maintenance type must be selected\n              if (!vm.obj.maintenance_type || vm.obj.maintenance_type === '') {\n                  ToastService.warning('Maintenance Type Required', 'Please select a maintenance type.');\n                  return false;\n              }\n\n              // 2. Time of maintenance must be filled\n              if (!vm.obj.check_time) {\n                  ToastService.warning('Time Required', 'Please enter the time of maintenance.');\n                  return false;\n              }\n\n              // 3. Checked by must be filled\n              if (!vm.obj.checked_by || vm.obj.checked_by.trim() === '') {\n                  ToastService.warning('Checked By Required', 'Please enter who checked/signed off the maintenance.');\n                  return false;\n              }\n\n              // 4. For non-extension types, date of maintenance must be filled\n              if (vm.obj.maintenance_type !== 'extension' && !vm.obj.check_date) {\n                  ToastService.warning('Date Required', 'Please enter the date of maintenance.');\n                  return false;\n              }\n\n              // 5. For extension types, extension granted date must be filled\n              if (vm.obj.maintenance_type === 'extension' && !vm.obj.extension_granted) {\n                  ToastService.warning('Date Required', 'Please enter the extension granted date.');\n                  return false;\n              }\n\n              if(((vm.obj.maintenance_type !== undefined && vm.obj.maintenance_type !==\"extension\") \n               || vm.obj.hours_remaining !== undefined \n               || vm.obj.next_check !== undefined)){\n                      if((vm.obj.maintenance_type !== \"\" || vm.obj.maintenance_type !== undefined) && (vm.obj.hours_remaining !== undefined || vm.obj.hours_remaining !== \"\") \n                  && (vm.obj.next_check !== undefined && vm.obj.next_check !== \"\")){\n\n                      var check_date =  moment( moment(vm.obj.check_date).format(\"YYYY-MM-DD\")+ \" \"+moment(vm.obj.check_time).format(\"HH:mm:ss\") ).format(\"YYYY-MM-DD HH:mm:ss\");\n\n                      send_obj.maintenance = {\n                          maintenance_type: vm.obj.maintenance_type,\n                          hours_remaining: vm.obj.hours_remaining,\n                          check_date: check_date,\n                          expiry_date: vm.obj.next_check,\n                          checked_by: vm.obj.checked_by,\n                          description: vm.obj.notes\n                      } \n\n                      // Include workpack_id if selected from existing\n                      if (vm.obj.workpack_option === 'existing' && vm.obj.workpack_id) {\n                          send_obj.maintenance.workpack_id = parseInt(vm.obj.workpack_id);\n                      }\n\n                      send_update = true;\n                  } else {\n                      ToastService.warning('Maintenance Incomplete', 'Please add check date, next check, and hours remaining.');\n                      return false; \n                  }\n                }\n\n                if(vm.obj.maintenance_type == \"extension\"){\n                      if((vm.obj.extension_hours !== \"\" || vm.obj.extension_days !== \"\")){\n\n                      var extension_granted =  moment( moment(vm.obj.extension_granted).format(\"YYYY-MM-DD\")+ \" \"+moment(vm.obj.check_time).format(\"HH:mm:ss\") ).format(\"YYYY-MM-DD HH:mm:ss\");\n\n\n                      send_obj.extension = {\n                          maintenance_type: vm.obj.maintenance_type,\n                          extension_hours: vm.obj.extension_hours,\n                          extension_days: vm.obj.extension_days,\n                          extension_granted: extension_granted,\n                          description: vm.obj.notes\n                      } \n                      send_update = true;\n                  } else {\n                      ToastService.warning('Maintenance Incomplete', 'Please add check date, next check, and hours remaining.');\n                      return false; \n                  }\n                }\n            }\n\n\n            // Only validate offline fields when the offline overlay is active\n            if(vm.show_offline){\n              if((vm.obj.offline_until !== \"\" || vm.obj.offline_notes !== \"\")){\n                    send_obj.offline = {\n                        offline_until: vm.obj.offline_until,\n                        offline_notes: vm.obj.offline_notes,\n                        club_id: vm.club_id\n                    } \n                    send_update = true;\n                } else {\n                    ToastService.warning('Offline Date', 'Please ensure the offline date is set in the future.');\n                    return false; \n              }\n            }\n\n            // var send_obj = {\n            //     radio: {\n            //         file: (vm.files.radio[0]) ? vm.files.radio[0].file : {},\n            //         expiry: vm.obj.radio_expiry\n            //     },\n            //     cert: {\n            //         file: (vm.files.cert[0]) ? vm.files.cert[0].file : {},\n            //         expiry: vm.obj.certificate_expiry\n            //     },\n            //     insurance: {\n            //         file: (vm.files.insurance[0]) ? vm.files.insurance[0].file : {},\n            //         expiry: vm.obj.insurance_expiry\n            //     },\n            //     maintenance: {\n            //         maintenance_type: vm.obj.maintenance_type,\n            //         hours_remaining: vm.obj.hours_remaining,\n            //         next_check: vm.obj.next_check\n            //     },\n            //     issues: vm.obj.issues\n            // };\n            // //console.log(\"TIME NOW : \", vm.obj.check_date);\n            // //console.log(\"TIME NOW : \", moment(vm.obj.check_date) );\n            // //console.log(\"TIME NOW : \", vm.obj.check_time);\n            // //console.log(\"TIME NOW : \", moment(vm.obj.check_time));\n\n            // //console.log(\"TIME NOW : \", moment( moment(vm.obj.check_date).format(\"YYYY-MM-DD\")+ \" \"+vm.obj.check_time ) );\n\n\n            // return false;\n\n            if(!send_update){\n                ToastService.warning('Nothing Saved', 'No changes were made  the panel will close.');\n\n            } else {\n                // //console.log(\"TOSAVE: \", send_obj);\n                \n                vm.send_obj = send_obj;\n\n                // Helper: save defect workpack info for resolved defects\n                // If workpackId is provided, defects marked with _link_to_workpack will be\n                // linked to that workpack instead of getting standalone workpack fields.\n                var saveDefectWorkpacks = function (workpackId) {\n                    if (vm.reported_defects && vm.reported_defects.length > 0) {\n                        for (var d = 0; d < vm.reported_defects.length; d++) {\n                            var def = vm.reported_defects[d];\n                            if (def.resolved) {\n                                // Link defect to the new workpack if user chose that option\n                                if (workpackId && def._link_to_workpack) {\n                                    WorkpackService.LinkDefect(workpackId, def.id);\n                                } else if (def.defect_workpack_number || def.defect_workpack_signatory || def._uploaded_file) {\n                                    // Standalone workpack info\n                                    var payload = {\n                                        workpack_number: def.defect_workpack_number || '',\n                                        signatory: def.defect_workpack_signatory || ''\n                                    };\n                                    if (def._uploaded_file) {\n                                        payload.document_temp_path = def._uploaded_file.temp_path;\n                                        payload.document_extension = def._uploaded_file.extension;\n                                        payload.document_original_name = def._uploaded_file.name;\n                                    }\n                                    WorkpackService.UpdateDefectWorkpack(def.id, payload);\n                                }\n                            }\n                        }\n                    }\n                };\n\n                // Helper: also create CRS if one was provided\n                var saveCrs = function () {\n                    if (send_obj.crs) {\n                        return CrsService.Create(send_obj.crs);\n                    }\n                    // Return resolved promise if no CRS\n                    return { then: function (cb) { cb({}); } };\n                };\n\n                // Create maintenance event first, then workpack if needed\n                PlaneService.AddMaintenance(vm.this_plane_id, send_obj)\n                    .then(function (data) {\n\n                        // Save CRS alongside (fire and forget alongside workpack)\n                        saveCrs();\n\n                        // Save logbook links for the new maintenance check (fire and forget)\n                        if (data.maintenance_check_id) {\n                            vm.saveCreateLogbookLinks(data.maintenance_check_id);\n                        }\n\n                        // If creating a new workpack, do it AFTER the maintenance event is created\n                        // so we can associate the workpack with the new maintenance_check_id\n                        if (vm.obj.workpack_option === 'new' && vm.new_workpack.workpack_number) {\n                            var wp = {\n                                club_id: vm.club_id,\n                                plane_id: parseInt(vm.this_plane_id),\n                                workpack_number: vm.new_workpack.workpack_number,\n                                authorised_signatory: vm.new_workpack.authorised_signatory,\n                                description: vm.new_workpack.description,\n                                status: vm.new_workpack.status || 'completed',\n                                created_by_user_id: vm.user_id\n                            };\n\n                            // Link to the maintenance event that was just created\n                            if (data.maintenance_check_id) {\n                                wp.maintenance_check_id = data.maintenance_check_id;\n                            }\n\n                            if (vm.workpack_files.workpack_doc && vm.workpack_files.workpack_doc.length > 0) {\n                                var f = vm.workpack_files.workpack_doc[0];\n                                wp.document_temp_path = f.temp_path;\n                                wp.document_extension = f.extension;\n                                wp.document_original_name = f.name;\n                            }\n\n                            WorkpackService.Create(wp)\n                                .then(function (wpData) {\n                                    if (wpData.success) {\n                                        // Link resolved defects to this workpack or save standalone info\n                                        saveDefectWorkpacks(wpData.id);\n                                        vm.new_workpack = {};\n                                        vm.workpack_files = { workpack_doc: [] };\n                                        $state.go('dashboard.manage_club.maintenance.detail', {plane_id: vm.this_plane_id}, {reload: true});\n                                    } else {\n                                        ToastService.error('Workpack Error', wpData.message || 'Unknown error');\n                                        $state.go('dashboard.manage_club.maintenance.detail', {plane_id: vm.this_plane_id}, {reload: true});\n                                    }\n                                });\n                        } else {\n                            // No new workpack  save standalone defect workpack info\n                            saveDefectWorkpacks();\n                            $state.go('dashboard.manage_club.maintenance.detail', {plane_id: vm.this_plane_id}, {reload: true});\n                        }\n                    });\n\n            }\n\n\n            //EASYPEASY LEMON SQUEEEEEZY\n\n            ////console.log(\"SAVE CERT\");\n            vm.show_overlay = false;\n        }\n\n\n\n        $scope.check_ticked = function(){\n            var count = 0;\n            for(var i=0;i<vm.reported_defects.length;i++){\n                if(vm.reported_defects[i].resolved){\n                    count++;\n                }\n            }\n\n            ////console.log(\"total = \", count);\n\n            vm.one_ticked = (count > 0)? true : false;\n\n            // if(count > 0){\n            //     vm.one_ticked = true;\n            // } else {\n            //     vm.one_ticked = false;\n            // }\n        }\n\n\n\n\n        $scope.show_cert = function(){\n            //console.log(\"SHOW CERT HERE\");\n            vm.show_cert = true;\n\n        }\n\n        $scope.close_cert = function(){\n            //console.log(\"CLOSE CERT\");\n            vm.show_cert = false;\n        }\n\n        $scope.save_cert = function(){\n\n            //first we save stuff   \n\n\n\n\n\n            //console.log(\"SAVE CERT\");\n            vm.show_cert = false;\n        }\n\n\n        $scope.show_insurance = function(){\n            //console.log(\"SHOW INSURANCE HERE\");\n            vm.show_insurance = true;\n\n        }\n\n        $scope.close_insurance = function(){\n            //console.log(\"CLOSE INSURANCE\");\n            vm.show_insurance = false;\n        }\n\n        $scope.save_insurance = function(){\n\n            //first we save stuff   \n            \n\n\n            \n\n            //console.log(\"SAVE INSURANCE\");\n            vm.show_insurance = false;\n        }\n\n\n\n        $scope.show_radio = function(){\n            //console.log(\"SHOW radio HERE\");\n            vm.show_radio = true;\n\n        }\n\n        $scope.close_radio = function(){\n            //console.log(\"CLOSE radio\");\n            vm.show_radio = false;\n        }\n\n        $scope.save_radio = function(){\n\n            //first we save stuff   \n            \n\n\n            \n\n            //console.log(\"SAVE radio\");\n            vm.show_radio = false;\n        }\n\n        $scope.show_noise = function(){\n            //console.log(\"SHOW radio HERE\");\n            vm.show_noise = true;\n\n        }\n\n        $scope.close_noise = function(){\n            //console.log(\"CLOSE radio\");\n            vm.show_noise = false;\n        }\n\n        $scope.save_noise = function(){\n\n            //first we save stuff              \n            //console.log(\"SAVE radio\");\n            vm.show_noise = false;\n        }\n\n\n        $scope.show_maintenance = function(){\n            //console.log(\"SHOW maintenance HERE\");\n            vm.show_maintenance = true;\n\n        }\n\n        $scope.close_maintenance = function(){\n            //console.log(\"CLOSE maintenance\");\n            vm.show_maintenance = false;\n        }\n\n        $scope.save_maintenance = function(){\n\n            //first we save stuff   \n\n            //console.log(\"SAVE maintenance\");\n            vm.show_maintenance = false;\n        }\n\n\n        vm.add_defect = function(){\n\n\n                var obj = {\n                    club_id: vm.club_id,\n                    user_id: vm.user_id,\n                    plane_id: vm.this_plane_id,\n                    defect: vm.defect,\n                    severity: vm.defect_severity.title,\n                    status: \"open\"\n                }\n\n\n\n                PlaneService.AddDefect(obj)\n                 .then(function (data) {\n                        ////console.log(\"data is : \", data);\n                        data.item.can_delete = true;\n\n                        //HELLO\n                        vm.club.plane.defects.push(data.item);\n                        //vm.reported_defects.push(data.item);\n\n                        vm.defect = \"\";\n                        vm.defect_severity = \"\";\n\n\n\n                    });\n\n            }\n\n            vm.delete_defect = function(id){\n               // //console.log(\"UNDO DEFECT ID \", id);\n\n                PlaneService.DeleteDefect(id)\n                .then(function (data) {\n                        ////console.log(\"data is : \", data);\n                       \n                        PlaneService.GetOpenIssues(vm.bookout.plane_id)\n                        .then(function (data) {\n                                ////console.log(\"data is : \", data);\n                               vm.reported_defects = data;\n                            });\n\n\n                    });\n\n            }\n\n\n\n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        $scope.save = function(){\n            if(vm.action == \"add\"){\n                // //console.log(\"CREATE click\");\n                $scope.create();\n            } else {\n                // //console.log(\"EDIT click\");\n                // //console.log(vm.club.plane);\n                $scope.update();\n            }\n        }\n\n\n        $scope.create = function(){\n            // //console.log(\"CREATE ME NOW\");\n            vm.club.plane.club_id = vm.club_id;\n            vm.club.plane.add_documents = vm.plane_documents;\n            // //console.log(\"PLANE TO ADD, \", vm.club.plane);\n            //return false;\n            PlaneService.Create(vm.club.plane)\n                .then(function(data){\n                    // //console.log(data);\n                    $state.go('dashboard.manage_club.planes', {reload: true});\n\n                });\n        }\n\n        $scope.delete = function(){\n            // //console.log(\"CLICK\");\n            ToastService.warning('Confirm Delete', 'Are you sure you would like to delete this plane?');\n            PlaneService.Update(vm.club.plane)\n                .then(function(data){\n                    // //console.log(data);\n                });\n        }\n\n        $scope.getColours = function(value){\n            if(value < 1){\n                return \"red\";\n            }\n            if(value < 5){\n                return \"warning\"\n            }\n            if(value < 10){\n                return \"amber\";\n            }\n        }\n\n        function get_update_docs(){\n            var documents = [];\n\n            for(var i=0;i<update_this_file.length;i++){\n                var id = update_this_file[i];\n                // //console.log(\"looking for : \", id);\n                // //console.log(\"in: \", vm.plane_documents);\n\n                for(var k=0;k<vm.club.plane.plane_documents.length;k++){\n                    // //console.log(\"comparing to : \", vm.club.plane.plane_documents[k].id);\n                    if(vm.club.plane.plane_documents[k].id == id){\n                        documents.push(vm.club.plane.plane_documents[k]);\n                    }\n                }\n\n            }\n\n            // //console.log(\"DOCS TO UPDATE : \", documents);\n\n            return documents;\n        }\n\n        $scope.update = function(){\n            // //console.log(\"CLICK\");\n            vm.club.plane.club_id = vm.club_id;\n            vm.club.plane.add_documents = vm.plane_documents;\n\n            vm.club.plane.update_documents = get_update_docs();\n            //get_update_docs();\n\n            PlaneService.Update(vm.club.plane)\n                .then(function(data){\n                    // //console.log(data);\n                    // //console.log(\"saved\");\n                    $state.go('dashboard.manage_club.planes');\n                });\n        }\n\n\n        function containsObject(obj, list, params) {\n\n            // //console.log(\"obj\", obj);\n            // //console.log(\"list\", list);\n            // //console.log(\"params\", params);\n\n            for(var i=0; i<list.length; i++) {\n                // //console.log(\"list i : \", list[i]);\n                // //console.log(\"obj is: \", obj);\n\n                var count_success = 0;\n                for(var j=0;j<params.length;j++){\n                    if(list[i][params[j]] && obj[params[j]] && list[i][params[j]] == obj[params[j]]){\n                        count_success++;\n                    }\n                }\n\n                if(count_success === params.length) {                    \n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n\n        function check_all(){\n\n            //maybe a nice to have one day... not yet though.\n\n\n            //licences\n            vm.club.plane.requirements.licence.forEach(function(obj){\n\n            });\n\n        }\n\n      \n\n\n        $scope.add_item = function(type){\n            // //console.log(\"ADD\");\n            switch(type){\n                case \"licence\":\n                    // //console.log(\"licence\");\n                    if(vm.temporary.licence && vm.temporary.licence !== \"\" && vm.temporary.rating && vm.temporary.rating !== \"\"){\n                        //then we can add it\n                        // //console.log(\"here we go\");\n                        var add_licence = {\n                            licence_id: vm.temporary.licence.id,\n                            licence_title: vm.temporary.licence.abbreviation,\n                            rating_title: vm.temporary.rating.abbreviation,\n                            rating_id: vm.temporary.rating.id\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_licence, vm.club.plane.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n                            vm.club.plane.requirements.licence.push(add_licence);\n                        }\n\n                        delete vm.temporary.licence;\n                        delete vm.temporary.rating;\n\n                    } else {\n                        ToastService.warning('Missing Selection', 'Please select a licence and rating required to book the plane solo.');\n                    }\n\n                break;\n\n\n                case \"medical\":\n                    //console.log(\"medical\");\n                    if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_medical = {\n                            authority_id: vm.temporary.medical_authority.id,\n                            authority_title: vm.temporary.medical_authority.abbreviation,\n                            medical_component_id: vm.temporary.medical_component.id,\n                            medical_component_title: vm.temporary.medical_component.title\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_medical, vm.club.plane.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n                            vm.club.plane.requirements.medical.push(add_medical);\n                        }\n\n                        delete vm.temporary.medical_authority;\n                        delete vm.temporary.medical_component;\n\n                    } else {\n                        ToastService.warning('Missing Selection', 'Please select a medical required to book the plane solo.');\n                    }\n\n                break;\n\n\n                case \"differences\":\n                    //console.log(\"difference\");\n                    if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_difference = {\n                            difference_id: vm.temporary.difference.id,\n                            difference_title: vm.temporary.difference.title\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_difference, vm.club.plane.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n                            vm.club.plane.requirements.differences.push(add_difference);\n                        }\n\n                        delete vm.temporary.difference;\n\n                    } else {\n                        ToastService.warning('Missing Selection', 'Please select a differences training required to book the plane solo.');\n                    }\n\n                break;\n\n\n            }\n\n\n\n        }\n\n\n        $scope.remove_item = function(type, index){\n            //console.log(\"REMOVE\");\n\n            vm.club.plane.requirements[type].splice(index, 1);\n\n\n            // switch(type){\n            //     case \"licence\":\n            //             //console.log(\"licence\");\n                   \n            //             //check if it doesnt exist first...\n            //             // if(containsObject(add_licence, vm.club.plane.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n            //             //     vm.club.plane.requirements.licence.push(add_licence);\n            //             // }\n\n            //             vm.club.plane.requirements.licence.splice(index, 1);\n                      \n                   \n\n            //     break;\n\n\n            //     case \"medical\":\n            //         //console.log(\"medical\");\n            //         if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_medical = {\n            //                 authority_id: vm.temporary.medical_authority.id,\n            //                 authority_title: vm.temporary.medical_authority.abbreviation,\n            //                 medical_component_id: vm.temporary.medical_component.id,\n            //                 medical_component_title: vm.temporary.medical_component.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_medical, vm.club.plane.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n            //                 vm.club.plane.requirements.medical.push(add_medical);\n            //             }\n\n            //             delete vm.temporary.medical_authority;\n            //             delete vm.temporary.medical_component;\n\n            //         } else {\n            //             alert(\"Please select a medical that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            //     case \"differences\":\n            //         //console.log(\"difference\");\n            //         if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_difference = {\n            //                 difference_id: vm.temporary.difference.id,\n            //                 difference_title: vm.temporary.difference.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_difference, vm.club.plane.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n            //                 vm.club.plane.requirements.differences.push(add_difference);\n            //             }\n\n            //             delete vm.temporary.difference;\n\n            //         } else {\n            //             alert(\"Please select a difference that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            // }\n\n\n\n        }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        $scope.update_this_file = function(file){\n            //console.log(\"==== update is : \", file.id);\n            if(update_this_file.indexOf(file.id) === -1){\n                update_this_file.push(file.id)\n            } else {\n               ////console.log(\"This item already exists\"); \n            } \n        }\n\n\n         $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.club.plane.plane_documents = $.grep(vm.club.plane.plane_documents, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                PlaneDocumentService.Delete(vm.user_id, file.id)\n                .then(function (data) {\n                    // //console.log(data);\n                    if(data.success){\n                        // //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            // //console.log(\"REMOVE: \", j);\n            // //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n\n            //this SHOULD BE TO THE CURRENT POSITION\n\n            // PoidService.DeleteTmp(j.saved_url)\n            //     .then(function (data) {\n            //         //console.log(data);\n            //         if(data.success){\n            //             //console.log(\"HUZZAH\", current_files);\n            //             //then we need to remove this from the list of files...\n            //             //clear files\n            //             vm.plane_documents = [];\n            //             //and re-process available files\n            //             $scope.processFiles(current_files);\n\n            //         } else {\n            //             //console.log(\"WOOOPSIES...\");\n            //             //this should be very very rare...\n            //         }\n\n            //     });\n\n          }\n          \n\n          // $scope.$on('flow::fileAdded', function (event, $flow, flowFile) {\n          //     event.preventDefault();//prevent file from uploading\n          //     //console.log(\"FILE ADDED\");\n          //     //console.log($flow);\n          //   });\n\n            vm.files = {\n                radio: [],\n                cert: [],\n                noise_cert: [],\n                insurance: [],\n                crs: []\n            }\n\n\n            $scope.processFiles = function(files, location){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    // //console.log(\"J is : \",j);\n                    // //console.log(\"name is : \", j.files.file.name);\n\n                    files[i].file.temp_path = j.saved_url;\n                    files[i].file.save_name = j.files.file.name;\n                    var ft = j.files.file.name;\n                    ft = ft.split('.').pop();\n                    files[i].file.extension = ft;\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.files[location].push(files[i].file);\n                }\n\n\n            }\n\n\n             $scope.processFile = function(files, location){\n                 //console.log(\"files\", files[0].file_return);\n\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[0].file_return);\n                    // //console.log(\"PARSED\", j);\n                    // //console.log(\"J is : \",j);\n                    // //console.log(\"name is : \", j.files.file.name);\n\n                    files[0].file.temp_path = j.saved_url;\n                    files[0].file.save_name = j.files.file.name;\n\n                    var ft = j.files.file.name;\n                    // //console.log(\"ft\", ft);\n                    var fft = ft.split('.').pop();\n                    files[0].file.extension = fft;\n                    // //console.log(\"FILE is : \", files[0]);\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.files[location].push(files[0]);\n\n\n            }\n\n            $scope.set_title = function(file){\n                // //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            $scope.get_icon2 = function(file){\n                ////console.log(\"FILE\", file);\n                if(!file || file == \"\"){\n                    return \"\";\n                }\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            vm.defect_severity;\n                vm.defect_severities = [\n                    { title: \"No Fly Item - Ground the plane\"},\n                    { title: \"Flyable - needs to be checked at next maintenance\"},\n                    { title: \"Not urgent - but needs noting\"},\n                    { title: \"Unsure of severity\"}\n                ]; \n\n\n            $scope.delete_poid = function(id){\n\n              \n                var a = prompt(\"Are you sure you wish to delete this poid? \\n\\n This change is irreversible! To confirm please type YES in the box below.\");\n                if(a == \"YES\"){\n\n\n                    //console.log(\"WE DELETE IT\");\n\n\n                    // PoidService.Delete(vm.user_id, id)\n                    //     .then(function (data) {\n                    //         //console.log(data);\n                    //         if(data.success){\n                    //             //console.log(\"HUZZAH\", data);\n                    //             //then we need to remove this from the list of files...\n                    //             vm.user_poids = $.grep(vm.user_poids, function(e){ \n                    //                 return e.id != id; \n                    //             });\n                                \n                    //             //refresh?\n                    //             $state.reload();\n                    //             $state.go('dashboard.my_account.poid');\n\n                    //         } else {\n\n                    //             alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n                    //         }\n\n                    //     });\n\n\n\n                } else {\n                    //console.log(\"ignore123\");\n                }\n\n\n            }\n\n\n\n\n            $scope.save_plane_documents = function(){\n\n               \n              \n\n                // //console.log(\"plane_documents: \", vm.plane_documents);\n\n\n                //compile the required elements YAY\n\n                // //console.log(\"plane_document \", vm.plane_document);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n                    // for(var i=0;i<vm.plane_document.images.length;i++){\n                    //     delete vm.plane_document.images[i].data_uri;\n                    // }\n\n                    // // vm.plane_document.images = vm.plane_documents;\n                    // vm.plane_document.images = vm.plane_document.images.concat(vm.plane_documents);\n                    // vm.plane_document.user_id = vm.user_id;\n\n\n\n\n            //     if(vm.plane_document.id){\n            //         //then its an udpate\n\n            //         //merge the images left?\n            //         PoidService.Update(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                     $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n            //     } else {\n\n\n                   \n\n\n            //         //then its a create\n            //         //console.log(vm.plane_document);\n\n            //         PoidService.Create(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                    // $state.reload();\n            //                    // $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n\n            //     }\n\n\n\n             };\n\n\n\n\n             $scope.change_file_name = function(file){\n                \n                //this is terribly ineficient... unfortunately... can't \n                //work out how else to do it! (lol)\n\n                // //console.log(\"TO BE CHANGED\", file);\n\n                // //console.log(\"BEFORE BEFORE\", vm.plane_documents);\n\n                vm.plane_documents = $.grep(vm.plane_documents, function(e){ \n                    return e.temp_path != file.temp_path; \n                });\n\n                // //console.log(\"BEFORE\", vm.plane_documents);\n\n                vm.plane_documents.push(file);\n\n                // //console.log(\"AFTER\", vm.plane_documents);\n\n             }\n\n\n        // \n        // WORKPACK METHODS\n        // \n\n        vm.loadWorkpacks = function () {\n            if (!vm.this_plane_id) return;\n            WorkpackService.GetByPlane(vm.this_plane_id)\n                .then(function (data) {\n                    if (data.success !== false) {\n                        vm.workpacks = data.workpacks || [];\n                    }\n                });\n        };\n\n        vm.loadOpenWorkpacks = function () {\n            if (!vm.this_plane_id) return;\n            WorkpackService.GetOpenByPlane(vm.this_plane_id)\n                .then(function (data) {\n                    if (data.success !== false) {\n                        vm.open_workpacks = data.workpacks || [];\n                    }\n                });\n        };\n\n        vm.createWorkpack = function () {\n            var wp = {\n                club_id: vm.club_id,\n                plane_id: parseInt(vm.this_plane_id),\n                workpack_number: vm.new_workpack.workpack_number,\n                authorised_signatory: vm.new_workpack.authorised_signatory,\n                description: vm.new_workpack.description,\n                status: vm.new_workpack.status || 'completed',\n                created_by_user_id: vm.user_id\n            };\n\n            // If a document was uploaded\n            if (vm.workpack_files.workpack_doc && vm.workpack_files.workpack_doc.length > 0) {\n                var f = vm.workpack_files.workpack_doc[0];\n                wp.document_temp_path = f.temp_path;\n                wp.document_extension = f.extension;\n                wp.document_original_name = f.name;\n            }\n\n            WorkpackService.Create(wp)\n                .then(function (data) {\n                    if (data.success) {\n                        vm.show_create_workpack = false;\n                        vm.new_workpack = {};\n                        vm.workpack_files = { workpack_doc: [] };\n                        vm.loadWorkpacks();\n                        vm.loadOpenWorkpacks();\n                    } else {\n                        ToastService.error('Workpack Error', data.message || 'Unknown error');\n                    }\n                });\n        };\n\n        vm.viewWorkpack = function (id) {\n            WorkpackService.GetById(id)\n                .then(function (data) {\n                    if (data.success !== false) {\n                        vm.workpack = data.workpack;\n                        vm.show_workpack_detail = true;\n                    }\n                });\n        };\n\n        vm.closeWorkpackDetail = function () {\n            vm.workpack = null;\n            vm.show_workpack_detail = false;\n            vm.show_link_defect = false;\n            vm.show_link_maintenance = false;\n        };\n\n        vm.updateWorkpack = function (field, value) {\n            if (!vm.workpack) return;\n            var update = {};\n            update[field] = value;\n            WorkpackService.Update(vm.workpack.id, update)\n                .then(function (data) {\n                    if (data.success) {\n                        vm.viewWorkpack(vm.workpack.id);\n                        vm.loadWorkpacks();\n                        vm.loadOpenWorkpacks();\n                    }\n                });\n        };\n\n        vm.completeWorkpack = function () {\n            if (!vm.workpack) return;\n            var a = confirm('Are you sure you want to mark this workpack as completed?');\n            if (a) {\n                WorkpackService.Update(vm.workpack.id, { status: 'completed' })\n                    .then(function (data) {\n                        if (data.success) {\n                            vm.viewWorkpack(vm.workpack.id);\n                            vm.loadWorkpacks();\n                            vm.loadOpenWorkpacks();\n                        }\n                    });\n            }\n        };\n\n        vm.reopenWorkpack = function () {\n            if (!vm.workpack) return;\n            WorkpackService.Update(vm.workpack.id, { status: 'open' })\n                .then(function (data) {\n                    if (data.success) {\n                        vm.viewWorkpack(vm.workpack.id);\n                        vm.loadWorkpacks();\n                        vm.loadOpenWorkpacks();\n                    }\n                });\n        };\n\n        vm.deleteWorkpack = function () {\n            if (!vm.workpack) return;\n            var a = confirm('Are you sure you want to delete (archive) this workpack? This will unlink all defects and maintenance events.');\n            if (a) {\n                WorkpackService.Delete(vm.workpack.id)\n                    .then(function (data) {\n                        if (data.success) {\n                            vm.closeWorkpackDetail();\n                            vm.loadWorkpacks();\n                            vm.loadOpenWorkpacks();\n                        }\n                    });\n            }\n        };\n\n        vm.uploadWorkpackDocument = function () {\n            if (!vm.workpack) return;\n            if (vm.workpack_files.workpack_doc && vm.workpack_files.workpack_doc.length > 0) {\n                var f = vm.workpack_files.workpack_doc[0];\n                WorkpackService.Update(vm.workpack.id, {\n                    document_temp_path: f.temp_path,\n                    document_extension: f.extension,\n                    document_original_name: f.name\n                }).then(function (data) {\n                    if (data.success) {\n                        vm.workpack_files = { workpack_doc: [] };\n                        vm.viewWorkpack(vm.workpack.id);\n                    }\n                });\n            }\n        };\n\n        vm.removeWorkpackDocument = function () {\n            if (!vm.workpack) return;\n            WorkpackService.Update(vm.workpack.id, { remove_document: true })\n                .then(function (data) {\n                    if (data.success) {\n                        vm.viewWorkpack(vm.workpack.id);\n                    }\n                });\n        };\n\n        $scope.downloadWorkpackDocument = function (filename) {\n            if (!filename) return;\n            $http.get('/api/v1/maintenance_workpacks/file/' + filename, {\n                responseType: 'arraybuffer'\n            }).success(function (data, status, headers) {\n                var zipName = processArrayBufferToBlob(data, headers);\n            }).error(function (data, status) {\n                ToastService.error('Download Error', 'There was an error downloading the workpack document.');\n            });\n        };\n\n        //  Link / Unlink Defects \n\n        vm.linkDefectToWorkpack = function (defect_id) {\n            if (!vm.workpack || !defect_id) return;\n            WorkpackService.LinkDefect(vm.workpack.id, defect_id)\n                .then(function (data) {\n                    if (data.success) {\n                        vm.show_link_defect = false;\n                        vm.viewWorkpack(vm.workpack.id);\n                    } else {\n                        ToastService.error('Link Error', data.message || 'Error linking defect.');\n                    }\n                });\n        };\n\n        vm.unlinkDefect = function (defect_id) {\n            if (!defect_id) return;\n            var a = confirm('Unlink this defect from the workpack?');\n            if (a) {\n                WorkpackService.UnlinkDefect(defect_id)\n                    .then(function (data) {\n                        if (data.success) {\n                            vm.viewWorkpack(vm.workpack.id);\n                        }\n                    });\n            }\n        };\n\n        //  Link / Unlink Maintenance Events \n\n        vm.linkMaintenanceToWorkpack = function (maintenance_check_id) {\n            if (!vm.workpack || !maintenance_check_id) return;\n            WorkpackService.LinkMaintenance(vm.workpack.id, maintenance_check_id)\n                .then(function (data) {\n                    if (data.success) {\n                        vm.show_link_maintenance = false;\n                        vm.viewWorkpack(vm.workpack.id);\n                    } else {\n                        ToastService.error('Link Error', data.message || 'Error linking maintenance event.');\n                    }\n                });\n        };\n\n        vm.unlinkMaintenance = function (maintenance_check_id) {\n            if (!maintenance_check_id) return;\n            var a = confirm('Unlink this maintenance event from the workpack?');\n            if (a) {\n                WorkpackService.UnlinkMaintenance(maintenance_check_id)\n                    .then(function (data) {\n                        if (data.success) {\n                            vm.viewWorkpack(vm.workpack.id);\n                        }\n                    });\n            }\n        };\n\n        //  Standalone Defect Workpack \n\n        vm.openDefectWorkpack = function (defect) {\n            vm.selected_defect_for_wp = defect;\n            vm.defect_wp = {\n                workpack_number: defect.defect_workpack_number || '',\n                signatory: defect.defect_workpack_signatory || ''\n            };\n            vm.show_defect_workpack = true;\n        };\n\n        vm.closeDefectWorkpack = function () {\n            vm.selected_defect_for_wp = null;\n            vm.defect_wp = {};\n            vm.defect_workpack_files = { defect_wp_doc: [] };\n            vm.show_defect_workpack = false;\n        };\n\n        vm.saveDefectWorkpack = function () {\n            if (!vm.selected_defect_for_wp) return;\n\n            var payload = {\n                workpack_number: vm.defect_wp.workpack_number,\n                signatory: vm.defect_wp.signatory\n            };\n\n            if (vm.defect_workpack_files.defect_wp_doc && vm.defect_workpack_files.defect_wp_doc.length > 0) {\n                var f = vm.defect_workpack_files.defect_wp_doc[0];\n                payload.document_temp_path = f.temp_path;\n                payload.document_extension = f.extension;\n                payload.document_original_name = f.name;\n            }\n\n            WorkpackService.UpdateDefectWorkpack(vm.selected_defect_for_wp.id, payload)\n                .then(function (data) {\n                    if (data.success) {\n                        vm.closeDefectWorkpack();\n                        // Refresh defects\n                        PlaneService.GetByIdMaintenance2(vm.this_plane_id, vm.club_id)\n                            .then(function (planeData) {\n                                vm.club.plane = planeData;\n                            });\n                    } else {\n                        ToastService.error('Workpack Error', data.message || 'Error saving defect workpack info.');\n                    }\n                });\n        };\n\n        //  CRS (Certificate of Release to Service) \n\n        vm.loadCrs = function () {\n            CrsService.GetAll(vm.this_plane_id)\n                .then(function (data) {\n                    if (data.success) {\n                        vm.crs_records = data.plane_crs || [];\n                    }\n                });\n        };\n\n        vm.deleteCrs = function (id) {\n            var a = confirm('Are you sure you want to archive this CRS?');\n            if (a) {\n                CrsService.Delete(id)\n                    .then(function (data) {\n                        if (data.success) {\n                            vm.loadCrs();\n                            // Refresh plane data so vm.club.plane.crs updates\n                            $state.go('dashboard.manage_club.maintenance.detail', {plane_id: vm.this_plane_id}, {reload: true});\n                        }\n                    });\n            }\n        };\n\n        vm.downloadCrs = function (filename) {\n            if (!filename) return;\n            var url = CrsService.DownloadFile(filename);\n            $window.open(url, '_blank');\n        };\n\n        // Standalone CRS update (from document table UPDATE button)\n        vm.saveCrsStandalone = function () {\n            if (!vm.files.crs[0]) {\n                ToastService.warning('CRS Missing', 'Please upload the CRS certificate document.');\n                return;\n            }\n            if (!vm.obj.crs_release_date || !vm.obj.crs_release_time) {\n                ToastService.warning('CRS Incomplete', 'Please provide both the release date and release time.');\n                return;\n            }\n            var payload = {\n                plane_id: parseInt(vm.this_plane_id),\n                release_date: moment(vm.obj.crs_release_date).format('YYYY-MM-DD'),\n                release_time: moment(vm.obj.crs_release_time).format('HH:mm:ss'),\n                file: vm.files.crs[0].file\n            };\n            CrsService.Create(payload)\n                .then(function (data) {\n                    if (data.success) {\n                        vm.files.crs = [];\n                        vm.obj.crs_release_date = null;\n                        vm.obj.crs_release_time = null;\n                        vm.show_overlay = false;\n                        $state.go('dashboard.manage_club.maintenance.detail', {plane_id: vm.this_plane_id}, {reload: true});\n                    } else {\n                        ToastService.error('CRS Error', data.message || 'Unknown error');\n                    }\n                });\n        };\n\n        $scope.processWorkpackFile = function (files, location) {\n            if (!files || files.length === 0) return;\n            try {\n                var j = JSON.parse(files[0].file_return);\n                files[0].file.temp_path = j.saved_url;\n                files[0].file.save_name = j.files.file.name;\n                var ft = j.files.file.name;\n                var fft = ft.split('.').pop();\n                files[0].file.extension = fft;\n\n                if (location === 'workpack_doc') {\n                    vm.workpack_files.workpack_doc = [files[0].file];\n                } else if (location === 'defect_wp_doc') {\n                    vm.defect_workpack_files.defect_wp_doc = [files[0].file];\n                }\n            } catch (e) {\n                console.error('Error processing workpack file upload:', e, files[0].file_return);\n                ToastService.error('Upload Error', 'There was an error uploading the document. Please try again.');\n            }\n        };\n\n        // Helper: process file upload for a resolved defect's workpack document\n        vm.processDefectFile = function (files, defect) {\n            if (!files || files.length === 0) return;\n            try {\n                var j = JSON.parse(files[0].file_return);\n                files[0].file.temp_path = j.saved_url;\n                files[0].file.save_name = j.files.file.name;\n                var ft = j.files.file.name;\n                var fft = ft.split('.').pop();\n                files[0].file.extension = fft;\n                defect._uploaded_file = files[0].file;\n            } catch (e) {\n                console.error('Error processing defect file upload:', e, files[0].file_return);\n                ToastService.error('Upload Error', 'There was an error uploading the document. Please try again.');\n            }\n        };\n\n        // \n        // END WORKPACK METHODS\n        // \n\n        // \n        // MAINTENANCE EVENT METHODS\n        // \n\n        vm.loadMaintenanceEvents = function () {\n            if (!vm.this_plane_id) return;\n            PlaneService.GetMaintenanceEvents(vm.this_plane_id)\n                .then(function (data) {\n                    if (data && data.maintenance_events) {\n                        vm.maintenance_events = data.maintenance_events;\n                    } else if (data && data.events) {\n                        vm.maintenance_events = data.events;\n                    } else if (Array.isArray(data)) {\n                        vm.maintenance_events = data;\n                    }\n                });\n        };\n\n        vm.viewEvent = function (event) {\n            vm.selected_event = angular.copy(event);\n            // Parse dates for date inputs\n            if (vm.selected_event.check_date) {\n                vm.selected_event._check_date = new Date(vm.selected_event.check_date);\n            }\n            if (vm.selected_event.expiry_date) {\n                vm.selected_event._expiry_date = new Date(vm.selected_event.expiry_date);\n            }\n            if (vm.selected_event.check_date) {\n                vm.selected_event._check_time = new Date(vm.selected_event.check_date);\n            }\n            vm.show_event_detail = true;\n\n            // Load logbook links for this event\n            vm.loadLogbookLinks(event.id);\n        };\n\n        vm.closeEventDetail = function () {\n            vm.selected_event = null;\n            vm.show_event_detail = false;\n            vm.logbook_checkboxes = [];\n            vm.event_logbook_links = [];\n            vm.logbook_load_error = false;\n        };\n\n        vm.saveEvent = function () {\n            if (!vm.selected_event || !vm.selected_event.id) return;\n\n            var payload = {\n                maintenance_type: vm.selected_event.maintenance_type,\n                hours_remaining: vm.selected_event.hours_remaining,\n                description: vm.selected_event.description,\n                checked_by: vm.selected_event.checked_by\n            };\n\n            if (vm.selected_event._check_date) {\n                var checkDateTime = moment(vm.selected_event._check_date).format('YYYY-MM-DD');\n                if (vm.selected_event._check_time) {\n                    checkDateTime += ' ' + moment(vm.selected_event._check_time).format('HH:mm:ss');\n                }\n                payload.check_date = checkDateTime;\n            }\n\n            if (vm.selected_event._expiry_date) {\n                payload.expiry_date = moment(vm.selected_event._expiry_date).format('YYYY-MM-DD');\n            }\n\n            PlaneService.UpdateMaintenanceEvent(vm.selected_event.id, payload)\n                .then(function (data) {\n                    if (data && data.success !== false) {\n                        vm.closeEventDetail();\n                        vm.loadMaintenanceEvents();\n                        // Refresh plane data too\n                        PlaneService.GetByIdMaintenance2(vm.this_plane_id, vm.club_id)\n                            .then(function (planeData) {\n                                vm.club.plane = planeData;\n                            });\n                    } else {\n                        ToastService.error('Update Error', (data && data.message) || 'Error updating maintenance event.');\n                    }\n                });\n        };\n\n        vm.getEventTypeIcon = function (type) {\n            if (!type) return 'fa-wrench';\n            switch (type.toLowerCase()) {\n                case 'annual': return 'fa-calendar-check-o';\n                case '50hours': case '25hours': case '100hours': return 'fa-tachometer';\n                case 'extension': return 'fa-clock-o';\n                case 'interim': return 'fa-tools';\n                case '6months': return 'fa-calendar';\n                default: return 'fa-wrench';\n            }\n        };\n\n        vm.getEventTypeLabel = function (type) {\n            if (!type) return 'Maintenance';\n            switch (type.toLowerCase()) {\n                case 'annual': return 'Annual';\n                case '50hours': return '50 Hour';\n                case '25hours': return '25 Hour';\n                case '100hours': return '100 Hour';\n                case 'extension': return 'Extension';\n                case 'interim': return 'Interim';\n                case '6months': return '6 Month';\n                default: return type;\n            }\n        };\n\n        //  Logbook Link Methods \n\n        // Load available logbooks for the CREATE form\n        vm.loadCreateLogbooks = function () {\n            if (!vm.this_plane_id) return;\n            vm.create_logbook_loading = true;\n            vm.create_logbook_error = false;\n            vm.create_logbook_checkboxes = [];\n\n            LogbookLinkService.GetAvailableLogbooks(vm.this_plane_id)\n                .then(function (data) {\n                    vm.create_logbook_loading = false;\n                    var available = (data && data.available_logbooks) ? data.available_logbooks : [];\n                    // Pre-check airframe by default (backend auto-links airframe anyway)\n                    vm.create_logbook_checkboxes = available.map(function (lb) {\n                        return {\n                            logbook_type: lb.logbook_type,\n                            logbook_entity_id: lb.logbook_entity_id,\n                            label: lb.label,\n                            position: lb.position || null,\n                            isLinked: lb.logbook_type === 'airframe'\n                        };\n                    });\n                }, function () {\n                    vm.create_logbook_loading = false;\n                    vm.create_logbook_error = true;\n                });\n        };\n\n        // Save logbook links after a new maintenance check is created\n        vm.saveCreateLogbookLinks = function (maintenance_check_id) {\n            if (!maintenance_check_id) return;\n\n            var selectedLogbooks = vm.create_logbook_checkboxes\n                .filter(function (lb) { return lb.isLinked; })\n                .map(function (lb) {\n                    return {\n                        logbook_type: lb.logbook_type,\n                        logbook_entity_id: lb.logbook_entity_id\n                    };\n                });\n\n            // Backend already auto-links airframe, so if only airframe is checked nothing extra to do\n            if (selectedLogbooks.length <= 1) return;\n\n            LogbookLinkService.BulkLink(maintenance_check_id, selectedLogbooks);\n        };\n\n        vm.toggleCreateLogbook = function (lb) {\n            var checked = vm.create_logbook_checkboxes.filter(function (l) { return l.isLinked; }).length;\n            if (!lb.isLinked && checked < 1) {\n                lb.isLinked = true;\n                ToastService.warning('Logbook Required', 'At least one logbook must be selected.');\n            }\n        };\n\n        vm.loadAvailableLogbooks = function () {\n            if (!vm.this_plane_id) return;\n            LogbookLinkService.GetAvailableLogbooks(vm.this_plane_id)\n                .then(function (data) {\n                    if (data && data.available_logbooks) {\n                        vm.available_logbooks = data.available_logbooks;\n                    }\n                });\n        };\n\n        vm.loadLogbookLinks = function (maintenance_check_id) {\n            if (!maintenance_check_id) return;\n            vm.logbook_checkboxes = [];\n            vm.logbook_load_error = false;\n\n            // Load both available logbooks and current links, then build checkbox state\n            LogbookLinkService.GetAvailableLogbooks(vm.this_plane_id)\n                .then(function (availData) {\n                    var available = (availData && availData.available_logbooks) ? availData.available_logbooks : [];\n                    vm.available_logbooks = available;\n\n                    if (available.length === 0) {\n                        vm.logbook_load_error = true;\n                        return;\n                    }\n\n                    LogbookLinkService.GetLinks(maintenance_check_id)\n                        .then(function (linkData) {\n                            var links = [];\n                            if (linkData && linkData.maintenance_check && linkData.maintenance_check.logbook_links) {\n                                links = linkData.maintenance_check.logbook_links;\n                            }\n                            vm.event_logbook_links = links;\n\n                            // Build checkbox array  include position for sorting\n                            vm.logbook_checkboxes = available.map(function (lb) {\n                                var isLinked = links.some(function (link) {\n                                    return link.logbook_type === lb.logbook_type &&\n                                           link.logbook_entity_id == lb.logbook_entity_id;\n                                });\n                                return {\n                                    logbook_type: lb.logbook_type,\n                                    logbook_entity_id: lb.logbook_entity_id,\n                                    label: lb.label,\n                                    position: lb.position || null,\n                                    isLinked: isLinked\n                                };\n                            });\n                        }, function () {\n                            vm.logbook_load_error = true;\n                        });\n                }, function () {\n                    vm.logbook_load_error = true;\n                });\n        };\n\n        vm.saveLogbookLinks = function () {\n            if (!vm.selected_event || !vm.selected_event.id) return;\n\n            var selectedLogbooks = vm.logbook_checkboxes\n                .filter(function (lb) { return lb.isLinked; })\n                .map(function (lb) {\n                    return {\n                        logbook_type: lb.logbook_type,\n                        logbook_entity_id: lb.logbook_entity_id\n                    };\n                });\n\n            if (selectedLogbooks.length === 0) {\n                ToastService.warning('Logbook Required', 'At least one logbook must be selected.');\n                return;\n            }\n\n            vm.saving_logbook_links = true;\n            LogbookLinkService.BulkLink(vm.selected_event.id, selectedLogbooks)\n                .then(function (data) {\n                    vm.saving_logbook_links = false;\n                    if (data && data.success !== false) {\n                        // Refresh the links\n                        vm.loadLogbookLinks(vm.selected_event.id);\n                    } else {\n                        ToastService.error('Logbook Links', 'Error saving logbook links: ' + ((data && data.message) || 'Unknown error'));\n                    }\n                });\n        };\n\n        vm.getLogbookIcon = function (type) {\n            switch (type) {\n                case 'airframe': return 'fa-plane';\n                case 'engine': return 'fa-cog';\n                case 'propeller': return 'fa-refresh';\n                default: return 'fa-book';\n            }\n        };\n\n        // Count how many logbooks are currently checked\n        vm.countCheckedLogbooks = function () {\n            if (!vm.logbook_checkboxes || !vm.logbook_checkboxes.length) return 0;\n            return vm.logbook_checkboxes.filter(function (lb) { return lb.isLinked; }).length;\n        };\n\n        // Prevent unchecking the very last logbook (at least one must remain)\n        vm.toggleLogbook = function (lb) {\n            if (!lb.isLinked && vm.countCheckedLogbooks() < 1) {\n                // Re-check it  can't uncheck the last one\n                lb.isLinked = true;\n                ToastService.warning('Logbook Required', 'At least one logbook must remain linked.');\n            }\n        };\n\n        // \n        // END MAINTENANCE EVENT METHODS\n        // \n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n          var warning_msg = \"By deleting this plane, you will also cancel all reservations that this plane currently has.\"\n\n          // $scope.open = function (plane_id) {\n          //   var modalInstance = $uibModal.open({\n          //     animation: true,\n          //     templateUrl: 'views/modals/deleteModal.html',\n          //     controller: 'ModalInstanceCtrl',\n          //     //params: {},\n          //     size: \"lg\",\n          //     resolve: {\n          //       id: function () {\n          //         return plane_id;\n          //       },\n          //       warning: function(){\n          //           return warning_msg;\n          //       }\n          //     }\n          //   });\n          //   modalInstance.result.then(function (plane_id) {\n          //     $log.info('PRESSED GO: '+plane_id);\n          //     PlaneService.Delete(plane_id)\n          //     .then(function(){\n          //       //console.log(\"HELLO DELETE\");\n          //       //update view?\n          //        vm.club.planes = $.grep(vm.club.planes, function(e){ \n          //           return e.plane_id != plane_id; \n          //       });\n          //     })\n          //   }, function () {\n          //     $log.info('Modal dismissed at: ' + new Date());\n          //   });\n          // };\n\n            $scope.open = function (club_plane_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return club_plane_id;\n                },\n                params: function() {\n                  return {id: club_plane_id};\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (plane) {\n                var id = plane.id;\n              $log.info('PRESSED GO: ', id);\n              \n              PlaneService.Delete(id)\n              .then(function(){\n                // //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.planes = $.grep(vm.club.planes, function(e){ \n                    return e.id != id; \n                });\n             });\n\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n\n\n          };\n         \n          \n\n\n        //   $scope.downloadCertificate = function(doc) {\n        //     var data = $.param({\n        //         id: doc\n        //     });\n\n        //     var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n        //     $http.get('api/v1/plane_certificate/show_file/'+ddd, {\n        //             responseType: 'arraybuffer'\n        //         })\n        //         .success(function(data, status, headers) {\n        //             var zipName = processArrayBufferToBlob(data, headers);\n\n        //             //Delete file from temp folder in server - file needs to remain open until blob is created\n        //             //deleteFileFromServerTemp(zipName);\n        //         }).error(function(data, status) {\n        //             alert(\"There was an error downloading the selected document(s).\");\n        //         })\n        // };\n\n\n        // $scope.downloadInsurance = function(doc) {\n        //     var data = $.param({\n        //         id: doc\n        //     });\n\n        //     var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n        //     $http.get('api/v1/plane_insurance/show_file/'+ddd, {\n        //             responseType: 'arraybuffer'\n        //         })\n        //         .success(function(data, status, headers) {\n        //             var zipName = processArrayBufferToBlob(data, headers);\n\n        //             //Delete file from temp folder in server - file needs to remain open until blob is created\n        //             //deleteFileFromServerTemp(zipName);\n        //         }).error(function(data, status) {\n        //             alert(\"There was an error downloading the selected document(s).\");\n        //         })\n        // };\n\n\n\n\n        $scope.downloadDocument = function(doc, type = 'docs') {\n            var data = $.param({\n                id: doc\n            });\n\n            var controller = \"plane_documents\";\n\n            switch(type){\n                 case \"radio\": \n                    controller = \"plane_radio_licence\";\n                break;\n                 case \"insurance\": \n                    controller = \"plane_insurance\";\n                break;\n                 case \"certificate\": \n                    controller = \"plane_certificate\";\n                break;\n                case \"noise\": \n                    controller = \"plane_noise_certificate\";\n                break;\n                case \"docs\": \n                    controller = \"plane_documents\";\n                break;\n                default:\n                    controller = \"plane_documents\";\n                break;\n\n            }\n\n\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/'+controller+'/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Error', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        $scope.downloadClubDocument = function(doc) {\n            var data = $.param({\n                id: doc\n            });\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/club_documents/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Error', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        // function processArrayBufferToBlob(data, headers) {\n        //     var octetStreamMime = 'application/octet-stream';\n        //     var success = false;\n\n        //     // Get the headers\n        //     headers = headers();\n        //     //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n        //     // Get the filename from the x-filename header or default to \"download.bin\"\n        //     var filename = headers['x-filename'] || 'download.zip';\n\n        //     // Determine the content type from the header or default to \"application/octet-stream\"\n        //     var contentType = headers['content-type'] || octetStreamMime;\n\n        //     try {\n        //         // Try using msSaveBlob if supported\n        //         var blob = new Blob([data], {\n        //             type: contentType\n        //         });\n        //         if (navigator.msSaveBlob)\n        //             navigator.msSaveBlob(blob, filename);\n        //         else {\n        //             // Try using other saveBlob implementations, if available\n        //             var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n        //             if (saveBlob === undefined) throw \"Not supported\";\n        //             saveBlob(blob, filename);\n        //         }\n        //         success = true;\n        //     } catch (ex) {\n        //         $log.info(\"saveBlob method failed with the following exception:\");\n        //         $log.info(ex);\n        //     }\n\n        //     if (!success) {\n        //         // Get the blob url creator\n        //         var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n        //         if (urlCreator) {\n        //             // Try to use a download link\n        //             var link = document.createElement('a');\n        //             if ('download' in link) {\n        //                 // Try to simulate a click\n        //                 try {\n        //                     // Prepare a blob URL\n        //                     var blob = new Blob([data], {\n        //                         type: contentType\n        //                     });\n        //                     var url = urlCreator.createObjectURL(blob);\n        //                     link.setAttribute('href', url);\n\n        //                     // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n        //                     link.setAttribute(\"download\", filename);\n\n        //                     // Simulate clicking the download link\n        //                     var event = document.createEvent('MouseEvents');\n        //                     event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n        //                     link.dispatchEvent(event);\n        //                     success = true;\n\n        //                 } catch (ex) {\n        //                     $log.info(\"Download link method with simulated click failed with the following exception:\");\n        //                     $log.info(ex);\n        //                 }\n        //             }\n\n        //             if (!success) {\n        //                 // Fallback to window.location method\n        //                 try {\n        //                     // Prepare a blob URL\n        //                     // Use application/octet-stream when using window.location to force download\n        //                     var blob = new Blob([data], {\n        //                         type: octetStreamMime\n        //                     });\n        //                     var url = urlCreator.createObjectURL(blob);\n        //                     window.location = url;\n        //                     success = true;\n        //                 } catch (ex) {\n        //                     $log.info(\"Download link method with window.location failed with the following exception:\");\n        //                     $log.info(ex);\n        //                 }\n        //             }\n        //         }\n        //     }\n\n        //     if (!success) {\n        //         // Fallback to window.open method\n        //         $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n        //         window.open(httpPath, '_blank', '');\n        //     }\n        //     return filename;\n        // };\n\n        function titlepath(path,name){\n\n        //In this path defined as your pdf url and name (your pdf name)\n            var prntWin = window.open();\n            prntWin.document.write(\"<html><head><title>\"+name+\"</title></head><body>\"\n                + '<embed width=\"100%\" height=\"100%\" name=\"plugin\" src=\"'+ path+ '\" '\n                + 'type=\"application/pdf\" internalinstanceid=\"21\"></body></html>');\n            prntWin.document.close();\n        }\n        \n        function processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n\n                $log.info(\"first try\");\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], {\n                    //type: contentType\n                    type: 'application/pdf'\n                });\n\n                var fileURL = URL.createObjectURL(blob);\n                titlepath(fileURL, \"Secure Documents\");\n\n                // if (navigator.msSaveBlob)\n                //     navigator.msSaveBlob(blob, filename);\n                // else {\n                //     // Try using other saveBlob implementations, if available\n                //     var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                //     if (saveBlob === undefined) throw \"Not supported\";\n                //     saveBlob(blob, filename);\n                // }\n                success = true;\n            } catch (ex) {\n                $log.info(\"saveBlob method failed with the following exception:\");\n                $log.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            $log.info(\"second try\");\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            $log.info(\"Download link method with simulated click failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n\n                            $log.info(\"third try\");\n\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n\n\n\n\n\n\n    }\n app.controller('DashboardClubMemberRequestsController', DashboardClubMemberRequestsController);\n\n    DashboardClubMemberRequestsController.$inject = ['UserService', 'MemberService', 'MembershipService', 'PaymentService', 'InstructorService', 'HolidayService', 'ClubService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'LicenceService', 'NokService', '$cookies', 'ToastService'];\n    function DashboardClubMemberRequestsController(UserService, MemberService, MembershipService, PaymentService, InstructorService, HolidayService, ClubService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, LicenceService, NokService, $cookies, ToastService) {\n        \n        var vm = this;        \n\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;  \n\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n\n        vm.noks = [];\n        vm.requests = [];\n        vm.auto_renew = false;\n\n        \n    \n\n\n\n\n        function update_requests(){\n            MembershipService.GetRequestsByClub(vm.club_id)\n                .then(function (data) {\n                    if(data.success){\n                        vm.requests = data.requests;\n                        //console.log(\"memberships\", vm.memberships);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n        }\n\n        update_requests();\n\n            $scope.popup = [];\n\n            $scope.open = function(id, $event) {\n                //console.log(\"THIS\", id);\n                //this comment would allow the event not to be affect by clicking it again... not sure this is a good idea\n                if($scope.popup[id] && $scope.popup[id].opened == true){\n                    $event.preventDefault();\n                    $event.stopPropagation();\n                } else {\n                    $scope.popup[id] = {opened: true};\n                }\n            };\n\n            $scope.formats = ['dd/MM/yyyy', 'yyyy/MM/dd', 'dd.MM.yyyy', 'shortDate'];\n            $scope.format = $scope.formats[0];\n\n            $scope.datePickerOptions = {\n                                        format: 'dd/MM/yyyy',\n                                        showWeeks: false\n                                    };\n\n           \n\n            vm.show_memberships = false;\n\n        \n\n\n\n\n\n            $scope.accept_request = function(id){\n\n                //basic checks...\n                var obj = {\n                    status: \"Accepted\"\n                };\n\n                MembershipService.ClubAcceptRequest(id, obj)\n                .then(function (data) {\n                    // //console.log(\"ACCEPT HERE\", data);\n                    //vm.memberships = data;\n\n                    update_requests();\n\n                    // $state.go('dashboard.my_account.memberships', {}, {reload: true});\n\n                }); \n\n            }\n\n\n            $scope.decline_request = function(){\n\n\n                MembershipService.ClubDeclineRequest(vm.this_req.id)\n                .then(function (data) {\n                    //console.log(\"DECLINE HERE\", data);\n                    //vm.memberships = data;\n\n                    update_requests();\n\n                    // $state.go('dashboard.my_account.memberships', {}, {reload: true});\n\n                }); \n\n            }\n\n\n          \n\n            // $scope.delete_request = function(){\n\n\n            //     MembershipService.ClubDeclineRequest(vm.this_req.id)\n            //     .then(function (data) {\n            //         //console.log(\"DECLINE HERE\", data);\n            //         //vm.memberships = data;\n\n            //         update_requests();\n\n            //         // $state.go('dashboard.my_account.memberships', {}, {reload: true});\n\n            //     }); \n\n            // }\n\n\n\n\n\n\n\n            $scope.delete_request = function(id){\n                MembershipService.DeleteRequest(id)\n                .then(function (data) {\n                    //console.log(\"DELETE HERE\", data);\n\n\n                    update_requests();\n                }); \n            }\n\n             $scope.resend_request = function(id){\n                MembershipService.ResendRequest({request_id: id})\n                .then(function (data) {\n                    //vm.memberships = data;\n\n                    if(data.success){\n                        ToastService.success('Request Sent', 'Request re-sent. Please ask them to check their junk / spam folders if they do not see it within the next 5 minutes.')\n                    }\n\n                    update_requests();\n                }); \n            }\n\n\n        \n        \n\n\n    }\napp.controller('DashboardClubMembersController', DashboardClubMembersController);\n\n    DashboardClubMembersController.$inject = ['$sce', 'PaymentService', 'UserService', 'MemberService', 'MembershipService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'PoidService',  'LicenceService', 'MedicalService', 'DifferencesService', 'AuthenticationService', '$http', 'PackageService', 'ToastService'];\n    function DashboardClubMembersController($sce, PaymentService, UserService, MemberService, MembershipService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, PoidService,  LicenceService, MedicalService, DifferencesService, AuthenticationService, $http, PackageService, ToastService) {\n        var vm = this;\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {};\n        vm.page_title = \"\";\n        vm.club.member = {};\n        vm.club.member.user = {}; // Initialize user object for form binding\n                                vm.club.member.payment_now = true;\n\n        vm.imported_new_headers = [];\n\n        // vm.club.member.membership_id = {};\n\n        vm.test = \"Package valid until 12/03/2022<br /> To be used on:<br /> G-BOOF <br /> G-OARU\";\n        \n        vm.action = $state.current.data.action;\n\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n        vm.no_show_cols = [\"membership_start\", \"membership_id\", \"selected\"];\n\n        vm.show_loading = true;\n\n        $scope.sortType     = 'Email'; // set the default sort type\n        $scope.sortReverse  = false;  // set the default sort order\n        $scope.searchTool   = '';     // set the default search/filter term\n\n        ////console.log(\"club_id : \"+vm.club_id);\n\n        // //console.log(vm.action);\n        // //console.log($stateParams);\n        // //console.log($stateParams.id);\n\n\n\n        vm.show_pay_now = false;\n        vm.show_loading = false;\n\n        vm.last_invoice_opened = {};\n\n\n        var iconBank = '<svg viewBox=\"0 0 24 24\"><path d=\"M3 10h18M4 10V8l8-5 8 5v2M5 10v8M9 10v8M15 10v8M19 10v8M3 18h18M2 20h20\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        var iconCard = '<svg viewBox=\"0 0 24 24\"><rect x=\"2\" y=\"4\" width=\"20\" height=\"16\" rx=\"2\" ry=\"2\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><path d=\"M2 9h20M6 14h6\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        var iconNew  = '<svg viewBox=\"0 0 24 24\"><circle cx=\"12\" cy=\"12\" r=\"9\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><path d=\"M12 8v8M8 12h8\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        var iconTerm = '<svg viewBox=\"0 0 24 24\"><rect x=\"6\" y=\"2\" width=\"12\" height=\"14\" rx=\"2\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><rect x=\"8\" y=\"5\" width=\"8\" height=\"3\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><rect x=\"9\" y=\"10\" width=\"6\" height=\"3\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        \n          vm.donConfirm = function(methodLabel, paymentIntent){\n            // console.log(\"confirmation is called\", methodLabel);\n            // console.log(\"paymentIntent\", paymentIntent);\n          //alert('Parent received D confirmation: ' + methodLabel);\n            vm.complete_invoice(methodLabel, paymentIntent);\n          };\n\n          vm.default_payment = 'direct-debit';\n\n          vm.methods = [\n            { id: 'direct-debit', title: 'Direct Debit', subtitle: 'Use your BACS mandate', type: 'direct-debit', iconSvg: $sce.trustAsHtml(iconBank), visible: true },\n            { id: 'saved-card',   title: 'Saved card',   subtitle: 'Use a card on file',    type: 'saved-card',  iconSvg: $sce.trustAsHtml(iconCard), visible: true },\n            { id: 'new-card',     title: 'New card',     subtitle: 'Add a new debit/credit card', type: 'new-card', iconSvg: $sce.trustAsHtml(iconNew), visible: false },\n            { id: 'card-machine', title: 'Card Machine', subtitle: 'Pay in person',          type: 'card-machine', iconSvg: $sce.trustAsHtml(iconTerm), visible: true }\n          ];\n\n           vm.savedCards = [];\n\n           vm.complete_invoice = function(method, paymentIntent){\n\n               //we now have a payment to complete\n               //process_payment\n\n               var obj = {\n                   user_id: vm.last_invoice_opened.user_id,\n                   club_id: vm.last_invoice_opened.club_id,\n                   paymentIntent: paymentIntent,\n                   invoice_id: vm.last_invoice_opened.id,\n                   method: method\n               }\n\n               PaymentService.ProcessPayment(obj)\n                   .then(function (data) {\n\n                       if(data.success){\n\n                           //finish with:\n                           //RELOAD THE INVOICES!!!\n\n                            UserService.GetInvoicesUserClub(vm.club.member.user_id, vm.club_id, vm.current_invoice_offset, vm.loaded_per_batch, 0)\n                            .then(function (data) {\n                                   vm.invoices = data.invoices;\n                                   vm.upcoming = data.upcoming;\n\n\n                                    vm.add_credit_amount = 0;\n                                    vm.add_credit_note = \"\";\n                                    vm.show_add_credit = false;    \n                                    vm.show_loading = false;\n                                       \n                                    vm.show_pay_now = false;\n\n                                    ToastService.success('Success', 'Operation completed successfully');\n\n\n                                });\n\n\n\n                           // ClubService.GetClubInvoices(vm.club_id, vm.from_date, vm.to_date)\n                           //  .then(function (data) {\n                           //         console.log(\"data is : \", data);\n                           //         vm.invoices = data.invoices;\n                           //         vm.totals = data.totals;\n\n                           //         vm.show_pay_now = false;\n                           //         vm.show_loading = false;\n                           //         alert(\"SUCCESS!\");\n\n\n                           //      });\n\n                           \n\n                       } else {\n                           ToastService.error('Error', 'Something happened which was not supposed to happen... Please try again');\n                           console.log(\"===== ERROR =====\");\n                           console.log(data);\n                           console.log(\"===== ERROR =====\");\n                       }\n\n\n                   });\n\n           }\n\n           vm.close_pay_now = function(){\n               vm.show_pay_now = false;\n               vm.show_loading = false;\n           }\n\n           vm.show_payment_option = function(invoice){\n            var status = invoice.status;\n            if(status == \"pending_submission\"){\n                return true;\n            } else if(status == \"issued\"){\n                return true;\n            } else {\n                return false;\n            }\n\n        }\n\n        vm.info;\n\n        vm.show_payment = function(invoice){\n            console.log(\"invoice details: \", invoice);\n            vm.last_invoice_opened = invoice;\n            vm.send = {\n                club_id: invoice.club_id,\n                user_id: invoice.user_id,\n                invoice_id: invoice.id\n            }\n\n            //get user cards\n            //get user info\n\n            MemberService.GetMandate(invoice.user_id, invoice.club_id)\n                    .then(function (data) {\n                            ////console.log(\"data is : \", data);\n                           \n                    if(data.success){\n                        vm.info = data.info;\n\n                        vm.savedCards = data.cards;\n\n                        if(vm.savedCards.length > 0){\n                            vm.methods[1].visible = true;\n                        } else {\n                            vm.methods[1].visible = false;\n                        }\n\n                        vm.machine = data.machine;\n                        if(vm.machine.success){\n                            vm.methods[3].visible = true;\n                        } else {\n                            vm.methods[3].visible = false;\n                        }\n\n                        vm.show_pay_now = true;\n                    }\n\n                });\n\n           \n\n        }\n\n\n\n\n\n\n\n        $scope.get_human_status = function(status){\n\n            var returned;\n            switch(status){\n                case 'issued':\n            \n                  returned = \"Created\";\n\n              break;\n\n              case 'pending_submission':\n                  \n                    returned = \"Requesting\";\n\n              break;\n\n              case 'submitted':\n                    \n                    returned = \"Requested\";\n\n              break;\n\n              case 'confirmed':\n                    \n                    returned = \"Paid\";\n\n              break;\n\n              case 'paid_out':\n                    returned = \"Paid\";\n\n              break;\n\n              case 'failed':\n                    returned = \"Failed\";\n\n              break;\n\n              case 'charged_back':\n                    returned = \"Charged Back\";\n\n              break;\n              default:\n                  returned = status;\n              break\n            }\n\n            return returned;\n\n        }\n\n        switch(vm.action){\n            case \"add\":\n                //console.log(\"adding a new member please\");\n                vm.page_title = \"Add a New member\";\n\n                // Prefill membership_start to today\n                vm.club.member.membership_start = new Date();\n\n                 MembershipService.GetAllByClub(vm.club_id)\n                    .then(function(data){\n                        vm.club.memberships = data;\n                        // vm.club.member.membership_id.selected = vm.club.member.membership_id;\n                        // vm.membership = vm.club.member.membership_name;\n                        // vm.club.membership = vm.club.member.membership_name;\n                        // //console.log(vm.club.memberships);\n                    });\n\n            break;\n            case \"edit\":\n                //console.log(\"edit an existing membership\");\n\n                \n\n                 MemberService.GetById($stateParams.member_id, vm.club_id)\n                    .then(function(data){\n                        vm.club.member = data.member;   \n                        // //console.log(vm.club);\n                        vm.club.member.is_manager = (vm.club.member.is_manager == 1) ? true : false;\n                        vm.club.member.approved = (vm.club.member.approved == 1) ? true : false;\n\n                        \n\n                        PoidService.GetByUserIdClub(vm.club.member.user_id, vm.club_id)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                vm.poids = data.poids;\n                                //console.log(\"POIDS\", data.poids);\n                            } else {\n                                //console.log(\"WOOOPSIES...\");\n                                //this should be very very rare...\n                            }\n\n                        });\n\n\n                        MedicalService.GetByUserIdClub(vm.club.member.user_id, vm.club_id)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                vm.medicals = data.medicals;\n                                //console.log(\"medicals\", vm.medicals);\n                            } else {\n                                //console.log(\"WOOOPSIES...\");\n                                //this should be very very rare...\n                            }\n\n                        });\n\n                        LicenceService.GetByUserIdClub(vm.club.member.user_id, vm.club_id)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                vm.licences = data.licences;\n                                //console.log(\"LICENCES\", vm.licences);\n\n                            } else {\n                                //console.log(\"WOOOPSIES...\");\n                                //this should be very very rare...\n                            }\n\n                        });\n\n                        DifferencesService.GetByUserIdClub(vm.club.member.user_id, vm.club_id)\n                        .then(function (data) {\n                                var diff = data.differences.differences;\n                                for(var i=0;i<diff.length;i++){\n                                    if(diff[i].sign_off_date == \"0000-00-00\"){\n                                       delete diff[i].sign_off_date;\n                                    }\n                                    diff[i].sign_off_date = new Date(diff[i].sign_off_date);\n                                    diff[i].day = (diff[i].day == 1)? true : false;\n                                    diff[i].night = (diff[i].night == 1)? true : false;\n                                    diff[i].vfr = (diff[i].vfr == 1)? true : false;\n                                    diff[i].ifr = (diff[i].ifr == 1)? true : false;\n                                }\n                                data.differences.differences = diff;\n                                vm.differences = data.differences.differences;\n                                vm.differences_images = data.differences.images;\n                                //console.log(\"GET DIFFS\", vm.differences);\n\n                        });\n\n\n                        PackageService.GetPackagesByUserIdAndClubId(vm.club.member.user_id, vm.club_id)\n                            .then(function (data) {\n                                //console.log(data);\n                                vm.packages = data.items;\n                            });\n\n\n                        vm.get_package_html = function(pack_obj){\n                            var used_on = \"\";\n                            for(var i=0;i<pack_obj.aircraft.length;i++){\n                                used_on = used_on + \" \" + pack_obj.aircraft[i].registration +\" (\"+ pack_obj.aircraft[i].plane_type +\") <br />\";\n                            }\n                            var text = \"\";\n                            if(pack_obj.validity == 0){\n                               text = \"Package purchased on: \"+moment(pack_obj.created_at).format(\"D MMM Y\")+\"<br /> Package does not expire <br /> To be used on:<br />\";\n                            } else {\n                               text = \"Package purchased on: \"+moment(pack_obj.created_at).format(\"D MMM Y\")+\"<br /> Package expires on: \"+ moment(pack_obj.created_at).add(pack_obj.validity, \"days\").format(\"D MMM Y\") +\" <br /> To be used on:<br />\";\n                            }\n                    \n                            return text+used_on;\n\n                        }\n\n                        vm.get_pax_html = function(flight_obj){\n                            var pax = \"\";\n                             for(var i=0;i<flight_obj.passengers.length;i++){\n                                 //\"+flight_obj.passengers[i].nok[0].first_name+\" \"+flight_obj.passengers[i].nok[0].last_name+\"\n                                 var nok = \"\";\n                                 if(flight_obj.passengers[i].nok.length > 0){\n                                     for(var j=0;j<flight_obj.passengers[i].nok.length;j++){\n                                         nok = nok + \"<br /><br />Emergency Contact (\"+(j+1)+\"): <br />\"+flight_obj.passengers[i].nok[j].first_name+ \" \" +flight_obj.passengers[i].nok[j].last_name + \" <br />relationship: \"+flight_obj.passengers[i].nok[j].relationship+\"<br />t: \"+flight_obj.passengers[i].nok[j].phone_number+ \" <br /> e: \"+flight_obj.passengers[i].nok[j].email_address+\"<br />\";\n                                     }\n                                 } \n                                pax = pax + \"<span class='bolder'><b>\" + flight_obj.passengers[i].first_name +\" \"+ flight_obj.passengers[i].last_name +\"</b></span><br />e: \"+flight_obj.passengers[i].email+\"<br />t: \"+((flight_obj.passengers[i].telephone_number) ? flight_obj.passengers[i].telephone_number : \"unknown\")+nok+\"  <br /> <br />\";\n                            }\n                            if(flight_obj.passengers.length == 0){\n\n                            }\n                            if(flight_obj.instructor_id > 0){\n\n                                 var nok2 = \"\";\n                                     if(vm.club.member.nok.noks.length > 0){\n                                         for(var j=0;j<vm.club.member.nok.noks.length;j++){\n                                             nok2 = nok2 + \"<br />Emergency Contact (\"+(j+1)+\"): <br />\"+vm.club.member.nok.noks[j].first_name+ \" \" +vm.club.member.nok.noks[j].last_name + \" <br />relationship: \"+vm.club.member.nok.noks[j].relationship+\"<br />t: \"+vm.club.member.nok.noks[j].phone_number+ \" <br /> e: \"+vm.club.member.nok.noks[j].email_address+\"<br />\";\n                                         }\n                                     } \n\n                                    pax = pax + \"<br /><span class='bolder'>Instructor Present</span> <br /> \"+flight_obj.booking.instructor.first_name+\" \"+flight_obj.booking.instructor.last_name+\" <br /> \"+nok2;\n                                }\n                            if(flight_obj.user_id > 0){\n                                    \n                                    var nok1 = \"\";\n                                     if(vm.club.member.nok.noks.length > 0){\n                                         for(var j=0;j<vm.club.member.nok.noks.length;j++){\n                                             nok1 = nok1 + \"<br />Emergency Contact (\"+(j+1)+\"): <br />\"+vm.club.member.nok.noks[j].first_name+ \" \" +vm.club.member.nok.noks[j].last_name + \" <br />relationship: \"+vm.club.member.nok.noks[j].relationship+\"<br />t: \"+vm.club.member.nok.noks[j].phone_number+ \" <br /> e: \"+vm.club.member.nok.noks[j].email_address+\"<br />\";\n                                         }\n                                     } \n\n                                    // var nok1 = \"<br /><br />Emergency Contact (\"+(j+1)+\"): <br />\"+flight_obj.passengers[i].nok[j].first_name+ \" \" +flight_obj.passengers[i].nok[j].last_name + \" <br />relationship: \"+flight_obj.passengers[i].nok[j].relationship+\"<br />t: \"+flight_obj.passengers[i].nok[j].phone_number+ \" <br /> e: \"+flight_obj.passengers[i].nok[j].email_address+\"<br />\";\n                                    pax = pax + \"<br /><span class='bolder'>Member Present</span> <br />\"+nok1;\n                            }\n                            return pax;\n\n                            // var b = '<accordion close-others=\"oneAtATime\"> <accordion-group heading=\"Static Header, initially expanded\" is-open=\"true\"> This content is straight in the template. </accordion-group> <accordion-group heading=\"TITLE\" ng-repeat=\"group in groups\"> Some content here </accordion-group> <accordion-group heading=\"Dynamic Body Content\"> <p>The body of the accordion group grows to fit the contents</p> <button class=\"btn btn-default btn-sm\" ng-click=\"addItem()\">Add Item</button> <div ng-repeat=\"item in items\">{{item}}</div> </accordion-group> <accordion-group is-open=\"isopen\"> <accordion-heading> I can have markup, too! <i class=\"pull-right glyphicon\" ng-class=\"{\\'glyphicon-chevron-down\\': isopen, \\'glyphicon-chevron-right\\': !isopen}\"></i> </accordion-heading> This is just some content to illustrate fancy headings. </accordion-group> </accordion>';\n                            // return b;\n                        }\n\n\n\n                        // vm.calculate_difference = function(package, difference){\n\n                        //     var price = package.price;\n                        //     var hours_dual = package.hours_dual;\n                        //     var hours_solo = package.hours_solo;\n\n                        //     var base = price / (hours_dual + hours_solo);\n\n                        //     var initial_dual_price = base + difference;\n                        //     var initial_solo_price = (price - (initial_dual_price * hours_dual)) / hours_solo;\n\n                        //     var price_ratio = initial_dual_price / initial_solo_price;\n\n                        //     var hour_ratio = hours_dual / hours_solo;\n                        //     var remaining_ratio = hours_dual_remaining / hours_solo_remaining;\n                        //     var remaining_hours = hours_dual_remaining / hours_solo_remaining;\n\n                        //     //hello world\n\n                        //     vm.package_split = {ratio: hour_ratio, remaining_ratio: remaining_ratio, dual_price: initial_dual_price, solo_price: initial_solo_price, price_ratio: price_ratio, remaining_hours: remaining_hours};\n\n                        // }\n\n\n                        // vm.calculate_change = function(slider_value){\n\n                        //     //100 ==> everything in solo\n                        //     //0 ==> everything in dual flights\n\n                        //     var dual_percent = slide_value/100;\n                        //     var dual_hours = dual_percent * remaining_hours;\n\n                        //     var solo_percent = 100 - (slide_value/100);\n\n\n\n                        //     var changme = slider_value - (vm.package_split.remaining_ratio * 100);\n                        //     if(changeme > 0){\n                        //         //then we are decreasing solo and increasing dual\n\n\n                        //     } else {\n                        //         //then we are increasing solo and decreasing dual\n                        //     }\n\n\n                        // }\n\n                        vm.change_package = {};\n\n                        vm.calculate_change = function(new_percent=0) {\n\n                            // output.innerHTML = \"slider percentage: \"+Number(slider.value).toFixed(2)+\"%\";\n\n                              ////console.log(\"CHANGE\");\n\n                            var slider_val = (new_percent > 0) ? new_percent : vm.change_package.slider_value;\n\n                            vm.change_package.dual_percent = slider_val/100;\n                            vm.change_package.dual_hours = ( vm.change_package.dual_percent * vm.change_package.remaining_price ) / vm.change_package.initial_dual_price;\n\n                            // var solo_percent = 100 - (slider_val/100);\n\n                            vm.change_package.dual_price = vm.change_package.dual_percent * vm.change_package.remaining_price;\n\n                            if(vm.change_package.dual_price >= vm.change_package.remaining_price){\n\n                               vm.change_package.dual_price = vm.change_package.remaining_price;\n                               vm.change_package.dual_hours = vm.change_package.dual_price / vm.change_package.initial_dual_price;\n\n                            }\n\n                            vm.change_package.remaining_solo_hours = (vm.change_package.remaining_price - vm.change_package.dual_price) / vm.change_package.initial_solo_price; \n                            \n                            console.log(\"CHANGE CALC??\", vm.change_package);\n                            vm.change_package.solo_number = vm.change_package.remaining_solo_hours;\n                            vm.change_package.dual_number = vm.change_package.dual_hours;\n\n                            // dual.innerHTML = \"DUAL: \"+Number(dual_hours).toFixed(2)+\" hours\"; // Display the default slider value\n                            // dual_price_div.innerHTML = \"DUAL: \"+Number(dual_price).toFixed(2);\n                            \n                            // vm.change_package.dual_number = dual_hours;\n\n                            vm.change_package.solo_price = (vm.change_package.remaining_solo_hours * vm.change_package.initial_solo_price);\n\n                            // solo.innerHTML = \"SOLO: \"+Number(remaining_solo_hours).toFixed(2)+\" hours\"; // Display the default slider value\n                            // solo_number.value = remaining_solo_hours;\n                            // solo_price_div.innerHTML = \"SOLO: \"+Number(solo_price).toFixed(2);\n\n\n                            // price_total.innerHTML = \"TOTAL: \"+Number(solo_price + dual_price).toFixed(2);\n\n                        }\n\n\n                        vm.show_package_change = function(pack_obj){\n                            console.log(pack_obj);\n\n                            vm.show_package_popup = true;\n\n                            var slider = document.getElementById(\"myRange\");\n\n                            vm.change_package.id = pack_obj.id;\n                            vm.change_package.price = pack_obj.price;\n                            // vm.change_package.hours_dual = pack_obj.hours_dual;\n                            // vm.change_package.hours_solo = pack_obj.hours_solo;\n                            // vm.change_package.dual_hours = pack_obj.hours_dual;\n                            // vm.change_package.solo_hours = pack_obj.hours_solo;\n\n                            vm.change_package.hours_dual = pack_obj.remaining_hours_dual;\n                            vm.change_package.hours_solo = pack_obj.remaining_hours_solo;\n                            vm.change_package.dual_hours = pack_obj.remaining_hours_dual;\n                            vm.change_package.solo_hours = pack_obj.remaining_hours_solo;\n\n\n                            // vm.change_package.dual_percent = pack_obj.hours_solo;\n                            vm.change_package.difference = pack_obj.difference;\n                            vm.change_package.hours_dual_remaining = pack_obj.remaining_hours_dual;\n                            vm.change_package.hours_solo_remaining = pack_obj.remaining_hours_solo;\n\n                            vm.change_package.solo_number = pack_obj.remaining_hours_solo;\n                            vm.change_package.dual_number = pack_obj.remaining_hours_dual;\n                            //console.log(\"vm.change_package.dual_number : \", vm.change_package.dual_number);\n\n                            vm.change_package.base = (vm.change_package.price - (vm.change_package.difference * vm.change_package.hours_dual) ) / (vm.change_package.hours_dual + vm.change_package.hours_solo);\n                            vm.change_package.initial_dual_price = vm.change_package.base + vm.change_package.difference;\n                            if(vm.change_package.hours_solo > 0){\n                                vm.change_package.initial_solo_price = ((vm.change_package.price - (vm.change_package.initial_dual_price * vm.change_package.hours_dual)) / vm.change_package.hours_solo);\n                            } else {\n                                vm.change_package.initial_solo_price = vm.change_package.base;\n                            }\n                            // var price_ratio = initial_dual_price / initial_solo_price;\n                            vm.change_package.remaining_price = (vm.change_package.hours_dual_remaining * vm.change_package.initial_dual_price) + (vm.change_package.hours_solo_remaining * vm.change_package.initial_solo_price);\n\n                            // var hour_ratio = hours_dual / hours_solo;\n                            vm.change_package.remaining_ratio = (vm.change_package.initial_dual_price * vm.change_package.hours_dual_remaining) / vm.change_package.remaining_price;//hours_dual_remaining / (hours_solo_remaining + hours_dual_remaining);\n\n                            vm.change_package.slider_value = (vm.change_package.remaining_ratio * 100);\n\n                            //hello visuals\n                            // var output = document.getElementById(\"demo\");\n                            // var solo = document.getElementById(\"solo\");\n                            // var dual = document.getElementById(\"dual\");\n                            // var solo_price_div = document.getElementById(\"solo_price\");\n                            // var dual_price_div = document.getElementById(\"dual_price\");\n                            // var price_total = document.getElementById(\"price_total\");\n                            // var dual_number = document.getElementById(\"dual_number\");\n                            // var solo_number = document.getElementById(\"solo_number\");\n\n                            // solo_number.value = hours_solo_remaining;\n                            // solo_number.max = remaining_price / initial_solo_price;\n                            // dual_number.value = hours_dual_remaining;\n                            // dual_number.max = remaining_price / initial_dual_price;\n\n\n                            // output.innerHTML = \"slider percentage: \"+slider.value+\"%\"; // Display the default slider value\n                            // dual.innerHTML = \"DUAL: \"+hours_dual_remaining; // Display the default slider value\n                            // solo.innerHTML = \"SOLO: \"+hours_solo_remaining; // Display the default slider value\n                            // price_total.innerHTML = \"REMAINING FUNDS: \"+remaining_price;\n\n                            var percent = 0;\n\n\n                            // Update the current slider value (each time you drag the slider handle)\n                            // slider.oninput = calculate_change();\n                            \n\n                            //uncomment the calc\n                            vm.calculate_change();\n\n                        }\n                        \n\n                        vm.hide_package_change = function(){\n                            vm.show_package_popup = false;\n                        }\n\n                        vm.refund_package_to_credit = function(){\n                            vm.show_loading = true;\n                            var check = confirm(\"Are you sure you wish to refund this package? This is irreversible!\");\n                            if(check){\n\n                                 PackageService.RefundPackageToAccount(vm.change_package.id)\n                                     .then(function (data) {\n                                        //console.log(data);\n                                        if(data.success) {\n                                            vm.packages = data.items;\n                                            vm.show_package_popup = false;\n                                            vm.show_loading = false;\n                                        } else {\n                                            ToastService.error('Error', 'An error happened - please try again');\n                                            vm.show_package_popup = false;\n                                            vm.show_loading = false;\n                                        }\n                                        \n\n                                    });\n\n                            } else {\n                                return false;\n                            }\n                           \n                        }\n\n                        vm.save_package_change = function(){\n                            vm.show_loading = true;\n\n                            var obj = {\n                                \"remaining_hours_dual\": vm.change_package.dual_number,\n                                \"remaining_hours_solo\": vm.change_package.solo_number\n                            };\n\n                            PackageService.SwapPackageHours(vm.change_package.id, obj)\n                             .then(function (data) {\n                                //console.log(data);\n                                if(data.success) {\n                                    vm.packages = data.items;\n                                    vm.show_package_popup = false;\n                                } else {\n                                    ToastService.error('Error', 'An error happened - please try again');\n                                    vm.show_package_popup = false;\n                                }\n                            vm.show_loading = false;\n\n                            });\n\n                        }\n\n                        vm.change_numbers = function(solo_dual){\n                            console.log(\"CHANGE NUMBER\");\n                            val = 0;\n                            if(solo_dual == 'solo'){\n\n                                if( vm.change_package.solo_number > (vm.change_package.remaining_price / vm.change_package.initial_solo_price) ){\n                                    vm.change_package.solo_number = (vm.change_package.remaining_price / vm.change_package.initial_solo_price);\n                                    val = 0;\n                                } else if(vm.change_package.solo_number >= 0) {\n                                    val = 1 - ((vm.change_package.solo_number * vm.change_package.initial_solo_price) / vm.change_package.remaining_price); // (remaining_hours - solo_number.value) / remaining_hours;\n                                    ////console.log(\"SOLO: \", val);\n                                } else {\n                                    val = 1;\n                                }\n\n                            } else {\n\n                                if( vm.change_package.dual_number > (vm.change_package.remaining_price / vm.change_package.initial_dual_price) ){\n                                    vm.change_package.dual_number = (vm.change_package.remaining_price / vm.change_package.initial_dual_price);\n                                    val = 1;\n                                } else if(vm.change_package.dual_number >= 0) {\n                                    val = (vm.change_package.dual_number * vm.change_package.initial_dual_price) / vm.change_package.remaining_price;\n                                } else {\n                                    val = 0;\n                                }\n\n\n                            }\n                            vm.change_package.percent = (val * 100);\n                            vm.change_package.slider_value = vm.change_package.percent;\n                            vm.calculate_change(vm.change_package.percent);\n                        }\n\n\n                        \n\n\n\n                        // vm.convert_decimal_to_hours = function(decimal_time){\n                        //     var temp = new Array();\n                        //     temp = decimal_time.toString().split('.');\n                            \n                        //     var hours = temp[0];\n                        //     if(hours < 10){\n                        //         hours = \"0\"+hours;\n                        //     }\n                        //     if(temp[1]){\n                        //        var minutes = 100 / temp[1];\n                        //         minutes = Math.round(60 / minutes); \n\n                        //         if(minutes < 10){\n                        //             minutes = \"0\"+minutes;\n                        //         }\n                        //     } else {\n                        //         minutes = \"00\"\n                        //     }\n\n                        //     return hours + ':' + minutes;\n                        // }\n\n                        vm.convert_decimal_to_hours = function(number){\n            \n                            var sign = (number >= 0) ? 1 : -1;\n\n                            // Set positive value of number of sign negative\n                            number = number * sign;\n\n                            // Separate the int from the decimal part\n                            var hour = Math.floor(number);\n                            var decpart = number - hour;\n\n                            var min = 1 / 60;\n                            // Round to nearest minute\n                            decpart = min * Math.round(decpart / min);\n\n                            var minute = Math.floor(decpart * 60) + '';\n\n                            // Add padding if need\n                            if (minute.length < 2) {\n                            minute = '0' + minute; \n                            }\n\n                            // Add Sign in final result\n                            sign = sign == 1 ? '' : '-';\n\n\n                            if(minute == 60){\n                                hour = hour+1;\n                                minute = '00';\n                            }\n\n\n                            // Concate hours and minutes\n                            var time = sign + hour + ':' + minute;\n\n                            return time;\n\n                        }\n                        \n\n                        vm.show_add_credit = false;    \n                        vm.add_credit = function(){\n                                \n                            //show the add credit for the user.\n                            vm.show_add_credit = true;\n\n                        }\n\n                        vm.close_credit = function(){\n                            vm.show_add_credit = false;\n                        }\n\n                        vm.apply_credit = function(){\n                            //create the negative invoice.\n                            vm.show_loading = true;\n\n                              \n \n                            var obj_to_send = {\n                                    items: [{ \n                                        quantity: 1,\n                                        price: -vm.add_credit_amount,\n                                        title: vm.add_credit_note,\n                                        vat: 0,\n                                        is_credit_from_admin: 1\n                                }\n                                ],\n                              user: {user_id: vm.club.member.user_id},\n                              club_id: vm.club_id,\n                              payment: {direct_debit: true},\n                              credit_only: 1\n                            };\n\n\n                            // SAMPLE OF WHERE WE NEED TO SEND THE SHIZZLE....\n                            PaymentService.CreateCustom(obj_to_send)\n                            .then(function (data) {\n                                if(data.success){\n\n                                    ////console.log(\"CARD: \"+data);\n                                    //fill the drop down menu\n                                    //$state.go('dashboard.my_account.payment_methods', {}, { reload: true });\n                                     UserService.GetInvoicesUserClub(vm.club.member.user_id, vm.club_id, vm.current_invoice_offset, vm.loaded_per_batch, 0)\n                                    .then(function (data) {\n                                           vm.invoices = data.invoices;\n                                           vm.upcoming = data.upcoming;\n\n\n                                            vm.add_credit_amount = 0;\n                                            vm.add_credit_note = \"\";\n                                            vm.show_add_credit = false;    \n                                            vm.show_loading = false;\n\n                                        });\n\n                                   \n\n                                } else {\n                                    //console.log(\"WOOOPSIES...\", data);\n                                    //this should be very very rare...\n                                    vm.show_loading = false;\n\n                                }\n                            });\n\n\n\n\n                            \n\n\n\n\n                        }\n\n\n                        //planes/get_user_journey_log/:user_id/:club_id\n                        \n                        vm.current_offset = 0;\n                        vm.current_invoice_offset = 0;\n                        vm.loaded_per_batch = 5;\n                        vm.all_loaded = false;\n                        vm.all_invoices_loaded = false;\n\n                        PlaneService.GetUserJourneyLogs(vm.club.member.user_id, vm.club_id, vm.current_offset, vm.loaded_per_batch)\n                        .then(function (data) {\n                            // //console.log(data);\n                            vm.logs = data.logs;\n                        });\n\n                         // invoices/get_all_upcoming_for_user_by_club/:user_id/:club_id\n                        \n                        UserService.GetInvoicesUserClub(vm.club.member.user_id, vm.club_id, vm.current_invoice_offset, vm.loaded_per_batch, 0)\n                        .then(function (data) {\n                               vm.invoices = data.invoices;\n                               vm.upcoming = data.upcoming;\n                            });\n\n\n\n\n\n                        vm.load_more = function(){\n                            vm.current_offset = vm.current_offset + vm.loaded_per_batch;\n                            PlaneService.GetUserJourneyLogs(vm.club.member.user_id, vm.club_id, vm.current_offset, vm.loaded_per_batch)\n                            .then(function (data) {\n                                    if(data.logs.length > 0){\n                                        data.logs.forEach(log => vm.logs.push(log));\n                                    } else {\n                                        vm.all_loaded = true;\n                                    }\n                                   //vm.logs = data.logs;\n\n\n                                });\n\n                        }\n\n\n                        vm.load_more_invoices = function(){\n                            vm.current_invoice_offset = vm.current_invoice_offset + vm.loaded_per_batch;\n                        UserService.GetInvoicesUserClub(vm.club.member.user_id, vm.club_id, vm.current_invoice_offset, vm.loaded_per_batch, 1)\n                            .then(function (data) {\n                                    if(data.invoices.length > 0){\n                                        data.invoices.forEach(invoice => vm.invoices.push(invoice));\n                                    } else {\n                                        vm.all_invoices_loaded = true;\n                                    }\n                                   //vm.logs = data.logs;\n\n\n                                });\n\n                        }\n\n                        vm.get_initial = function(text){\n                            return text.charAt(0);\n                        }\n\n                        vm.clean_times = function(time){\n                            if(time == \"00:00:00\"){\n                                return \" - \";\n                            }\n                            return time.substring(0,5);\n                        }\n\n                         $scope.get_hours_from_decimal = function(time){\n\n                            if(time){\n                                 var sign = time < 0 ? \"-\" : \"\";\n                                 var hour = Math.floor(Math.abs(time));\n                                 var min = Math.floor((Math.abs(time) * 60) % 60);\n                                 if(min == 60){\n                                     hour++;\n                                     min = 0;\n                                 }\n                                 return sign + (hour < 10 ? \"0\" : \"\") + hour + \":\" + (min < 10 ? \"0\" : \"\") + min;\n                             } else {\n                                 return \"N/A\";\n                             }\n                        }\n\n\n\n\n\n\n\n\n\n\n                        vm.club.member.instructor = (vm.club.member.instructor == 1) ? true : false;\n                        //vm.club.member.membership_start = Date.parse(vm.club.member.membership_start);\n                        vm.page_title = \"Edit a Member - \"+vm.club.member.first_name+\" \"+vm.club.member.last_name;\n\n                        vm.club.member.membership_start = new Date(vm.club.member.membership_start);\n\n                        MemberService.GetMemberPlanes(vm.club.member.user_id, vm.club_id)\n                        .then(function(data){\n                            vm.club.planes = data;   \n                            //console.log(vm.club.planes);\n                        });\n\n                        // $(\"#membership_start\").datepicker({\n                        //     format: 'dd-mm-yyyy',\n                        //     startDate: vm.club.member.membership_start,\n                        //     endDate: ''\n                        //   }).on(\"show\", function() {\n                        //     $(this).val(new Date()).datepicker('update');\n                        //   });\n\n                    });\n\n                 MembershipService.GetAllByClub(vm.club_id)\n                    .then(function(data){\n                        vm.club.memberships = data;   \n                        // vm.club.member.membership_id.selected = vm.club.member.membership_id;\n                        // vm.membership = vm.club.member.membership_name;\n                        // vm.club.membership = vm.club.member.membership_name;\n                        //console.log(vm.club.memberships);\n                    });\n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                MemberService.GetAllByClub(vm.club_id)\n                    .then(function(data){\n                        vm.club.members = data;   \n                        //console.log(vm.club.members);\n                    });\n\n                 MembershipService.GetAllByClub(vm.club_id)\n                    .then(function(data){\n                        vm.club.memberships = data;   \n                        // vm.club.member.membership_id.selected = vm.club.member.membership_id;\n                        // vm.membership = vm.club.member.membership_name;\n                        // vm.club.membership = vm.club.member.membership_name;\n                        //console.log(vm.club.memberships);\n                    });\n                $scope.checkAll = function () {\n                    //console.log(\"check all\");\n                    if ($scope.selectedAll) {\n                        $scope.selectedAll = true;\n                    } else {\n                        $scope.selectedAll = false;\n                    }\n                    angular.forEach(vm.club.members, function(member) {\n                        member.selected = $scope.selectedAll;\n                    });\n                };\n\n\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n        //'9' needs to refer the the user's account set to manage\n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        $scope.save = function(){\n            if(vm.action == \"add\"){\n                // //console.log(\"CREATE click\");\n                $scope.create();\n            } else {\n                // //console.log(\"EDIT click\");\n                // //console.log(vm.club.membership);\n                $scope.update();\n            }\n        }\n\n        $scope.search = function(row){\n            ////console.log(\"hi\", (angular.lowercase(row.invoice_number).indexOf(angular.lowercase($scope.my_search) || '') !== -1));\n            return ( (angular.lowercase(row.invoice_number).indexOf(angular.lowercase($scope.my_search) || '') !== -1) || \n                    (angular.lowercase(row.club_title).indexOf(angular.lowercase($scope.my_search) || '') !== -1) ||\n                    (angular.lowercase(row.created_at.toString()).indexOf(angular.lowercase($scope.my_search) || '') !== -1) ||\n                    (angular.lowercase(row.total.toString()).indexOf(angular.lowercase($scope.my_search) || '') !== -1) ||\n                    (angular.lowercase(row.status).indexOf(angular.lowercase($scope.my_search) || '') !== -1) );\n        };\n\n        $scope.show_more = function(index){\n\n\n            vm.invoices[index].show_more = (vm.invoices[index].show_more)? false : true;\n\n\n        }\n\n\n        // $scope.readCSV = function() {\n        //     // http get request to read CSV file content\n        //     $http.get('/angular/sample.csv').success($scope.processData);\n        // };\n\n\n        $scope.csvToJSON = function(content) {\n                var lines=content.csv.split(/\\r\\n|\\n/);\n                var result = [];\n                var start = 0;\n                lines[0] += \",membership_id,membership_start,selected\";\n                for (var j=1; j<lines.length; j++) {\n                    lines[j] += \",membership_id,membership_start,true\";\n                }\n                var columnCount = lines[0].split(content.separator).length;\n\n                var headers = [];\n                if (content.header) {\n                    headers=lines[0].split(content.separator);\n                    vm.imported_headers = headers;\n                    start = 1;\n                }\n\n                for (var i=start; i<lines.length; i++) {\n                    var obj = {};\n                        var currentline=lines[i].split(new RegExp(content.separator+'(?![^\"]*\"(?:(?:[^\"]*\"){2})*[^\"]*$)'));\n                        if ( currentline.length === columnCount ) {\n                            if (content.header) {\n                                for (var j=0; j<headers.length; j++) {\n                                    obj[headers[j]] = currentline[j];\n                                }\n                            } else {\n                                for (var k=0; k<currentline.length; k++) {\n                                    obj[k] = currentline[k];\n                                }\n                            }\n                            result.push(obj);\n                        }\n                   \n                }\n\n                //result = $scope.toPrettyJSON(result, 2);\n                //console.log(result);\n\n                return result;\n            };\n\n       \n        vm.apply_default_memberships = function(){\n\n\n             for(var b=0;b<vm.imported_users.length;b++){\n\n                if(!vm.imported_users[b].membership || vm.imported_users[b].membership == {} || vm.imported_users[b].membership == \"\"){\n                    vm.imported_users[b].membership_id = vm.default_membership.id;\n                    vm.imported_users[b].membership = vm.default_membership;\n                }\n               \n             }\n\n        }\n\n\n        function parseLooseDate(input, opts) {\n          opts = opts || {};\n          var prefer = opts.prefer || \"DMY\"; // default to UK style\n          var useUTC = !!opts.utc;\n\n          if (input == null) return null;\n\n          // Already a Date?\n          if (Object.prototype.toString.call(input) === \"[object Date]\") {\n            return isNaN(input.getTime()) ? null : new Date(input.getTime());\n          }\n\n          // Timestamp?\n          if (typeof input === \"number\" && isFinite(input)) {\n            var dNum = new Date(input);\n            return isNaN(dNum.getTime()) ? null : dNum;\n          }\n\n          var s = String(input).trim();\n          if (!s) return null;\n\n          // Try native ISO-ish first (safe formats like 2025-01-06, 2025-01-06T12:34:56Z)\n          // BUT avoid native parsing for ambiguous slash formats like 01/02/2025.\n          var looksAmbiguousSlash = /^\\d{1,2}[\\/. -]\\d{1,2}[\\/. -]\\d{2,4}(\\s+.*)?$/.test(s);\n          if (!looksAmbiguousSlash) {\n            var native = new Date(s);\n            if (!isNaN(native.getTime())) return native;\n          }\n\n          // Normalize separators to \"/\"\n          s = s.replace(/[.\\-]/g, \"/\").replace(/\\s+/g, \" \").trim();\n\n          // Split date and time\n          var parts = s.split(\" \");\n          var datePart = parts[0];\n          var timePart = parts.slice(1).join(\" \").trim(); // ignore timezone words here\n\n          var d = datePart.split(\"/\");\n          if (d.length !== 3) return null;\n\n          // Parse ints\n          var a = parseInt(d[0], 10);\n          var b = parseInt(d[1], 10);\n          var c = parseInt(d[2], 10);\n\n          if (![a, b, c].every(function (n) { return isFinite(n); })) return null;\n\n          // Expand 2-digit years (00-69 => 2000-2069, 70-99 => 1970-1999)\n          function normalizeYear(y) {\n            if (y >= 0 && y <= 99) return (y <= 69) ? (2000 + y) : (1900 + y);\n            return y;\n          }\n\n          var year, month, day;\n\n          // Detect yyyy/mm/dd (or yyyy/dd/mm if someone did that  we only accept yyyy first)\n          if (d[0].length === 4) {\n            year = a;\n            month = b;\n            day = c;\n          } else if (d[2].length === 4) {\n            year = c;\n            // decide between DMY and MDY for a/b\n            // If one is > 12, it's forced.\n            if (a > 12 && b <= 12) { day = a; month = b; }\n            else if (b > 12 && a <= 12) { month = a; day = b; }\n            else {\n              // ambiguous: both <= 12\n              if (prefer === \"MDY\") { month = a; day = b; }\n              else { day = a; month = b; } // DMY default\n            }\n          } else {\n            // No 4-digit year found; accept 2-digit year at end\n            year = normalizeYear(c);\n            if (a > 12 && b <= 12) { day = a; month = b; }\n            else if (b > 12 && a <= 12) { month = a; day = b; }\n            else {\n              if (prefer === \"MDY\") { month = a; day = b; }\n              else { day = a; month = b; }\n            }\n          }\n\n          // Basic range checks\n          if (!(year >= 1 && year <= 9999)) return null;\n          if (!(month >= 1 && month <= 12)) return null;\n          if (!(day >= 1 && day <= 31)) return null;\n\n          // Time (optional)\n          var hh = 0, mm = 0, ss = 0;\n          if (timePart) {\n            // accept HH:mm or HH:mm:ss (ignore trailing timezone text)\n            var mTime = timePart.match(/^(\\d{1,2}):(\\d{2})(?::(\\d{2}))?/);\n            if (mTime) {\n              hh = parseInt(mTime[1], 10);\n              mm = parseInt(mTime[2], 10);\n              ss = mTime[3] ? parseInt(mTime[3], 10) : 0;\n              if (hh > 23 || mm > 59 || ss > 59) return null;\n            }\n          }\n\n          // Construct date\n          var dt = useUTC\n            ? new Date(Date.UTC(year, month - 1, day, hh, mm, ss, 0))\n            : new Date(year, month - 1, day, hh, mm, ss, 0);\n\n          // Validate (catches invalid dates like 31/02/2025)\n          var y2 = useUTC ? dt.getUTCFullYear() : dt.getFullYear();\n          var m2 = (useUTC ? dt.getUTCMonth() : dt.getMonth()) + 1;\n          var d2 = useUTC ? dt.getUTCDate() : dt.getDate();\n\n          if (y2 !== year || m2 !== month || d2 !== day) return null;\n\n          return dt;\n        }\n\n        vm.change_header = function(index, h){\n           \n            if(vm.imported_new_headers[index] == \"membership_start\"){\n\n\n\n                for(var b=0;b<vm.imported_users.length;b++){\n\n                    try{\n                       var parse_me =  parseLooseDate(vm.imported_users[b][h]);\n                      // console.log(\"value: \", parse_me.toISOString());\n                       if(!vm.imported_users[b].membership_start || vm.imported_users[b].membership_start == {} || vm.imported_users[b].membership_start == \"\" || !vm.imported_users[b].membership_start.getTime()){\n                           //console.log(vm.imported_users[b].membership_start.getTime());\n                           vm.imported_users[b].membership_start = new Date(parse_me.toISOString());\n                       }\n\n                    } catch(e){\n                        console.log(\"didnt parse, \", e);\n                    }\n                    \n                \n                }\n            }\n\n        }\n\n        vm.apply_default_start = function(){\n\n\n\n\n             \n\n        }\n\n        function stripDoubleQuotes(str) {\n          if (typeof str !== 'string') return str;\n          return str.replace(/\"/g, '');\n        }\n\n        $scope.processData = function() {\n            //get the stuff\n            //allText = vm.import_users;\n            var tobesorter = {\n                csv: vm.import_users,\n                separator: \",\",\n                header: true\n            }\n            var test_mode = true;\n            var test_e = \"a\";\n            var test_mail = \"@toaviate.com\";\n\n            vm.imported_users = $scope.csvToJSON(tobesorter);\n\n             for(var b=0;b<vm.imported_users.length;b++){\n\n\n\n                if(test_mode){\n                   vm.imported_users[b].matching = vm.imported_users[b].email;\n                   vm.imported_users[b].email = test_e + b + test_mail;\n                }\n\n\n                if(vm.imported_users[b].membership_start){\n                    vm.imported_users[b].membership_start = new Date(vm.imported_users[b].membership_start);\n                } else {\n                    vm.imported_users[b].membership_start = new Date();\n                }\n\n\n                \n                //below set the default membership perhaps?\n\n\n\n\n\n                //vm.imported_users[b].membership = { membership_id: 4, membership_name: \"Annual Membership\" };\n            }\n\n            // split content based on new line\n            // var allTextLines = allText.split(/\\r\\n|\\n/);\n            // var headers = allTextLines[0].split(',');\n            // var lines = [];\n\n            // for ( var i = 0; i < allTextLines.length; i++) {\n            //     // split content based on comma\n            //     var data = allTextLines[i].split(',');\n            //     if (data.length == headers.length) {\n            //         var tarr = [];\n            //         for ( var j = 0; j < headers.length; j++) {\n            //             tarr.push(data[j]);\n            //         }\n            //         lines.push(tarr);\n            //     }\n            // }\n            // $scope.data = lines;\n        };\n       \n\n        vm.user_columns = {\n            first_name: \"First Name\", \n            last_name: \"Last Name\", \n            email: \"Email Address\",\n            dob: \"Date of Birth\",\n            membership_number: \"Membership Number\", \n            membership_start: \"Membership Start Date\",\n            membership_id: \"Membership Name\",\n            matching_email: \"Matching Email\"\n        };\n\n\n        $scope.import_column = function(name){\n            // //console.log(\"update the field\");\n            // for(var i = 0; i < vm.imported_users.length; i++){\n            //     var original_val = vm.imported_users[i][name];\n            //     delete vm.imported_users[i][name];\n            //     vm.imported_users[i][vm.change_col_to] = original_val;\n            //     //console.log(vm.imported_users[i]);\n            // }\n\n        }\n\n        vm.member_check = [];\n\n        function check_member_requirements(){\n\n            var poid = 0;\n            var medical = 0;\n            var licence = 0;\n            var differences = 0;\n            for(var i=0;i<vm.member_check.length;i++){\n\n\n                var a = vm.member_check[i].type;\n\n                switch(a){\n                    case 'poid':\n                        poid++;\n                    break;\n                    case 'medical':\n                        medical++;\n                    break;\n                    case 'licence':\n                        licence++;\n                    break;\n                    case 'difference':\n                        difference++;\n                    break;\n                }\n            }   \n\n            if(poid > 0 && medical > 0 && licence > 0){\n                //TODO\n                //then we now need to check if they're not expired?\n                //then we know that the user is actually 100% valid.\n\n                vm.club.member.approved = 1;\n\n            }\n\n        }\n\n\n        $scope.update_verification = function(type, obj, val){\n\n            //console.log(\"UPDATE VERIFICATION ON : \"+type+\" WITH obj: \", obj);\n            vm.member_check.push({\"type\": type, \"obj\": obj});\n\n            var verify = {\n                \"check_type\": type,\n                \"user_id\": vm.club.member.user_id,\n                \"club_id\": vm.club_id,\n                \"check_id\": obj.id,\n                \"verified\": val\n            };\n\n            MemberService.Verify(verify)\n                .then(function(data){\n                    // //console.log(data);\n            });\n\n            //call the put request here\n\n            check_member_requirements();\n\n        }\n\n\n        $scope.import_users = function(){\n            //console.log(\"import some users now\");\n\n\n            //first let's ignore the ones that weren't in the list\n            vm.imported_users = $.grep(vm.imported_users, function(e){ \n                    return e.selected != \"false\"; \n            });\n\n           \n            // //console.log(vm.imported_users);\n            // //console.log(vm.imported_headers);\n            // //console.log(vm.imported_new_headers);\n\n            //we need to verify that at least first name and last name in addition to email is present in the columns selected.\n            if(vm.imported_new_headers.indexOf(\"first_name\") > -1 && vm.imported_new_headers.indexOf(\"last_name\") > -1 && vm.imported_new_headers.indexOf(\"email\") > -1){\n                // //console.log(\"ALL HEADERS HERE ! YAY!\");\n                \n                for(var b=0;b<vm.imported_users.length;b++){\n                    if(vm.imported_users[b].membership){\n                        if(vm.imported_users[b].membership.membership_id){\n                            vm.imported_users[b][\"membership_id\"] = vm.imported_users[b].membership.id;\n                            delete vm.imported_users[b].membership;\n                        }\n                    }\n                }\n\n                // //console.log(\"===--->===\");\n                // //console.log(vm.imported_users);\n                // //console.log(\"===--->===\");\n\n                vm.imported_new_headers.push(\"membership_id\");\n                vm.imported_new_headers.push(\"membership_start\");\n\n                //now we generate the users with the correct headings for our tables\n                var to_import_users = [];\n                for(var d=0; d<vm.imported_users.length;d++){\n                    var obj = {\n                        user: {},\n                        club_id: vm.club_id\n                    };\n                    for(var c=0; c<vm.imported_new_headers.length;c++){\n                        if(vm.imported_new_headers[c]){\n                            // //console.log(vm.imported_new_headers[c]);\n                            if(vm.imported_new_headers[c] == \"first_name\" || vm.imported_new_headers[c] == \"last_name\" || vm.imported_new_headers[c] == \"dob\" || vm.imported_new_headers[c] == \"email\"){\n                                obj[\"user\"][vm.imported_new_headers[c]] = vm.imported_users[d][Object.keys(vm.imported_users[d])[c]];\n                            } else {\n                                if(vm.imported_new_headers[c] == \"membership_start\" || vm.imported_new_headers[c] == \"membership_id\"){\n                                    obj[vm.imported_new_headers[c]] = vm.imported_users[d][vm.imported_new_headers[c]];\n                                } else {\n                                    obj[vm.imported_new_headers[c]] = vm.imported_users[d][Object.keys(vm.imported_users[d])[c]];\n                                }\n                            }\n                            //we can push this into a new object with new key!\n                        } else {\n                            //we ignore this one...\n                            //console.log(\"blank\");\n                        }\n                    }\n                    to_import_users.push(obj);\n                }\n                // //console.log(\"--==--\");\n                // //console.log(to_import_users);\n                // //console.log(\"--==--\");\n\n                //now that we have what we want to add to our \n                MemberService.CreateMany(to_import_users)\n                .then(function(data){\n                    // //console.log(data);\n                    $state.go('dashboard.manage_club.members');\n                });\n\n            } else {\n                //console.log(\"missing key elements in headers!\");\n                ToastService.warning('Missing Fields', 'You must select the First Name, Last Name and Email Address to be able to add the user to the system!');\n            }\n        \n\n\n        }\n\n        vm.sa_dual = false;\n        vm.sa_solo = false;\n        vm.sa_instruct = false;\n\n        vm.select_all = function(select_all_what){\n            if(select_all_what == \"dual\"){\n                for(var i = 0; i < vm.club.planes.length; i++){\n                    vm.club.planes[i].book_dual = 1;\n                    vm.sa_dual = true;\n                }\n            } else if(select_all_what == \"solo\"){\n                for(var i = 0; i < vm.club.planes.length; i++){\n                    vm.club.planes[i].book_solo = 1;\n                    vm.sa_solo = true;\n                }\n            } else if(select_all_what == \"instruct\"){\n                for(var i = 0; i < vm.club.planes.length; i++){\n                    vm.club.planes[i].instruct = 1;\n                    vm.sa_instruct = true;\n                }\n            }\n        }\n\n        vm.deselect_all = function(select_all_what){\n            if(select_all_what == \"dual\"){\n                for(var i = 0; i < vm.club.planes.length; i++){\n                    vm.club.planes[i].book_dual = 0;\n                    vm.sa_dual = false;\n                }\n            } else if(select_all_what == \"solo\"){\n                for(var i = 0; i < vm.club.planes.length; i++){\n                    vm.club.planes[i].book_solo = 0;\n                    vm.sa_solo = false;\n                }\n            } else if(select_all_what == \"instruct\"){\n                for(var i = 0; i < vm.club.planes.length; i++){\n                    vm.club.planes[i].instruct = 0;\n                    vm.sa_instruct = false;\n                }\n            }\n        }\n\n\n\n        $scope.create = function(){\n            //console.log(\"CREATE ME NOW\");\n            vm.club.member.club_id = vm.club_id;\n            MemberService.Create(vm.club.member)\n                .then(function(data){\n                    //console.log(data);\n                    $state.go('dashboard.manage_club.members');\n                });\n        }\n\n        // Helper function to clear error highlight when field is focused\n        vm.clearFieldError = function(event) {\n            if (event && event.target) {\n                event.target.classList.remove('field-error-highlight');\n            }\n            // Also check parent for ui-select wrapper\n            var parent = event.target.closest('.field-error-highlight');\n            if (parent) {\n                parent.classList.remove('field-error-highlight');\n            }\n        };\n\n        // Helper function to highlight and scroll to invalid field\n        function highlightAndScrollTo(fieldId) {\n            // Clear any previous highlights\n            var highlighted = document.querySelectorAll('.field-error-highlight');\n            for (var i = 0; i < highlighted.length; i++) {\n                highlighted[i].classList.remove('field-error-highlight');\n            }\n            \n            // Find and highlight the field\n            var field = document.getElementById(fieldId);\n            if (field) {\n                field.classList.add('field-error-highlight');\n                field.scrollIntoView({ behavior: 'smooth', block: 'center' });\n                field.focus();\n            }\n        }\n\n        //this should be admin / instructor only\n        $scope.invite_member = function(){\n\n                // Validation checks\n                var first_name = vm.club.member.user && vm.club.member.user.first_name ? vm.club.member.user.first_name.trim() : '';\n                var last_name = vm.club.member.user && vm.club.member.user.last_name ? vm.club.member.user.last_name.trim() : '';\n                var email = vm.club.member.user && vm.club.member.user.email ? vm.club.member.user.email.trim() : '';\n\n                if (!first_name) {\n                    ToastService.error('Validation Error', 'First name is required');\n                    highlightAndScrollTo('first_name');\n                    return;\n                }\n\n                if (!last_name) {\n                    ToastService.error('Validation Error', 'Last name is required');\n                    highlightAndScrollTo('last_name');\n                    return;\n                }\n\n                if (!email) {\n                    ToastService.error('Validation Error', 'Email is required');\n                    highlightAndScrollTo('email');\n                    return;\n                }\n\n                if (!vm.club.member.membership_id) {\n                    ToastService.error('Validation Error', 'Please select a membership');\n                    highlightAndScrollTo('membership_select_wrapper');\n                    return;\n                }\n\n                if (!vm.club.member.membership_start) {\n                    ToastService.error('Validation Error', 'Membership start date is required');\n                    highlightAndScrollTo('membership_start');\n                    return;\n                }\n\n                // If membership is free (0), force payment_now to true\n                if (vm.club.selected_membership && vm.club.selected_membership.price == 0) {\n                    vm.club.member.payment_now = true;\n                }\n\n                vm.club.member.club_id = vm.club_id;\n\n                MemberService.send_invite_by_club(vm.club.member)\n                    .then(function(data){\n                        ////console.log(data);\n                        $state.go('dashboard.manage_club.members');\n                    });\n\n        }\n\n        $scope.delete = function(){\n            //console.log(\"CLICK\");\n            ToastService.warning('Confirm Delete', 'Are you sure you would like to delete this membership?');\n            MemberService.Update(vm.club.membership)\n                .then(function(data){\n                   // //console.log(data);\n                });\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n            vm.club.member.club_id = vm.club_id;\n\n            var process_member_start_dt = new Date(vm.club.member.membership_start);\n            if(!process_member_start_dt.isValid){\n                process_member_start_dt = new Date();\n            }\n\n\n            vm.club.member.membership_start = process_member_start_dt; //.toISOString().split('T')[0];\n           \n            // console.log(vm.club.member);\n            // return false;\n\n            MemberService.Update(vm.club.member)\n                        .then(function(data){\n                            // //console.log(data);\n                            // //console.log(\"saved\");\n                            $state.go('dashboard.manage_club.members');\n                        });\n                        \n            MemberService.SaveMemberPlanes(vm.club.member.user_id, vm.club.member.club_id, vm.club.planes)\n                .then(function(data){\n                    ////console.log(data);\n                    // //console.log(\"saved THE PLANES\");\n                     \n                });\n\n                //         function SaveMemberPlanes(user_id, club_id, planes){\n\n        }\n\n        function refresh_members(){\n\n             MemberService.GetAllByClub(vm.club_id)\n                    .then(function(data){\n                        vm.club.members = data;   \n                        \n                        MembershipService.GetAllByClub(vm.club_id)\n                        .then(function(data){\n                            vm.club.memberships = data;   \n                            return true;\n                        });\n\n                    });\n\n            \n        }\n\n\n        vm.select_member_approval = false;\n        $scope.selected_members = function(type){\n            //get the selected members\n            if(vm.select_member_approval){\n                return false;\n            }\n            vm.show_loading = true;\n            vm.select_member_approval = true;\n\n            //console.log(vm.club.members);\n            vm.selected_members = $.grep(vm.club.members, function(e){ \n                return e.selected == true; \n            });\n            console.log(vm.selected_members);\n\n            //type is the action required...\n            \n\n            for(var j=0;j < vm.selected_members.length; j++){\n\n                if(type == \"approve\"){\n                    vm.selected_members[j].approved = 1;\n                } else {\n                    vm.selected_members[j].approved = 0;\n                }\n                //console.log(\"here\");\n                MemberService.Update(vm.selected_members[j])\n                    .then(function(data){\n                        //console.log(data);\n                        //console.log(\"saved\");\n                    });\n            }\n            console.log(\"refresh members\");\n            //vm.club.members = [];\n            setTimeout(() => {  \n\n                MemberService.GetAllByClub(vm.club_id)\n                .then(function(data){\n                    vm.club.members = data;   \n                    console.log(vm.club.members);\n                    MembershipService.GetAllByClub(vm.club_id)\n                    .then(function(data){\n                        vm.club.memberships = data;   \n                        vm.select_member_approval = false;\n                        vm.show_loading = false;\n                        //$state.go('dashboard.manage_club.members');\n                    });\n\n                });\n\n            }, 1000);\n\n            \n\n\n            // if(refresh_members()){\n            //     vm.select_member_approval = false;\n            //     vm.show_loading = false;\n            // } else {\n            //     alert(\"We failed to update the approval state of the member - please refresh this page\");\n            // }\n\n            \n\n        }\n\n        $scope.update_membership = function(item, model){\n            vm.club.member.membership_id = item.membership_id;\n            vm.club.member.membership_name = item.membership_name;\n            vm.club.selected_membership = item; // Store full item to check price\n        }\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n        var warning_msg = \"By deleting this membership, you will also cancel all reservations that this membership currently has.\"\n\n\n        function actually_open(id, params, document_type, document_id){\n\n\n\n             var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/check_documents.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function() {\n                  return id;\n                },\n                params: function() {\n                  return params;\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n\n\n            modalInstance.result.then(function (params) {\n              $log.info('PRESSED GO: ', params);\n              // alert(\"verified\");\n\n\n               for(var i=0; i<vm[document_type].length; i++){\n                        // //console.log(\"ID\", vm[document_type][i].id);\n                        // //console.log(\"VERI\", vm[document_type][i].verified);\n                        // //console.log(\"DOCU\", document_id);\n                        if(vm[document_type][i].id == document_id && vm[document_type][i].verified != 1){\n                            // //console.log(\"CHECK BELOW : \", vm[document_type][i][\"verified\"]);\n                            // if(vm.poids[i].verified == 0){\n                                vm[document_type][i].verified = 1;\n                                // //console.log(\"HERE\");\n                                var action_name = (document_type == \"differences\")? \"differences\" : document_type.slice(0, -1);\n                                $scope.update_verification(action_name, vm[document_type][i], 1);\n                            // }\n                        }\n                    }   \n\n              switch(document_type){\n                case 'poids':\n                    // vm.poids[0].verified = 0; \n                    // for(var i=0; i<vm.poids.length; i++){\n                    //     //console.log(\"ID\", vm.poids[i].id);\n                    //     //console.log(\"VERI\", vm.poids[i].verified);\n                    //     if(vm.poids[i].id == document_id && vm.poids[i].verified != 1){\n                    //         //console.log(\"CHECK BELOW : \", vm.poids[i][\"verified\"]);\n                    //         // if(vm.poids[i].verified == 0){\n                    //             vm.poids[i].verified = 1;\n                    //             $scope.update_verification('poid', vm.poids[i], 1);\n                    //         // }\n                    //     }\n                    // }   \n\n                break;\n                case 'medicals':\n\n\n                break;\n                case 'licences':\n\n                break;\n                case 'differences':\n\n                break;\n                default:\n                    ToastService.error('Unknown Request', \"Sorry - we didn't recognise the request\");\n                break;\n            }\n\n\n            }, function () {\n              //alert(\"CLOSED\");\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n\n\n\n        }\n\n\n            vm.show_temp_login = false;\n            vm.show_loading = false;\n\n\n        function create_sample(length) {\n                   var result           = '';\n                   var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n                   var charactersLength = characters.length;\n                   for ( var i = 0; i < length; i++ ) {\n                      result += characters.charAt(Math.floor(Math.random() * charactersLength));\n                   }\n                   return result;\n                }\n\n\n                $scope.re_login = function(){\n\n\n                      ////console.log(\"CLICKED\", vm.re_login_pass);\n\n                      //now we use the token that has been assigned already to verify the login password\n\n                        AuthenticationService.Login3(vm.re_login_pass, create_sample(120), function (response) {\n                            //console.log(\"resp\", response);\n                            if (response.success) {\n\n\n                                //we now need to call the query that was called before (decryption)\n\n                                //$scope.getDecrypted();\n                               $scope.openDocument(vm.maybe.doc_type, vm.maybe.doc_id);\n\n\n\n                                vm.show_temp_login = false;\n                            } else {\n                                ToastService.error('Wrong Password', 'This is the wrong password - please try again');\n                            }\n                        });\n\n\n\n                      //vm.show_temp_login = true;\n\n                  }\n\n\n\n        $scope.openDocument = function(document_type, document_id) {\n\n            vm.show_loading = true;\n\n            var id = document_id;\n            //document type : poids, medicals, licences, differences\n            var images = [];\n            switch(document_type){\n                case 'poids':\n                    //console.log(\"PROOF OF ID CHECK FOR ID: \", document_id);\n\n                    PoidService.GetById(document_id, 0, 1)\n                        .then(function (data) {\n                            ////console.log(data);\n                            if(data.success){\n                                ////console.log(\"DATA RTN\", data);\n                                images = data.poid.images;\n\n                                var params = {\n                                    document_type: document_type,\n                                    document_id: document_id,\n                                    images: images\n                                };\n                                    vm.show_loading = false;\n\n                                actually_open(id, params, document_type, document_id);\n                            } else {\n                                //this should be very very rare...\n\n\n                                if(data.fail == \"templogin\"){\n                                    ////console.log(\"WOOOPSIES...\", data);\n                                    vm.show_temp_login = true;\n                                     vm.maybe = {\n                                         doc_type: \"poids\",\n                                         doc_id: document_id\n                                     }\n\n                                }\n                                    vm.show_loading = false;\n\n\n\n                            }\n                    });\n\n                break;\n                case 'medicals':\n                    ////console.log(\"MEDICAL CHECK FOR ID: \", document_id);\n\n                    // MedicalService.GetById(document_id, vm.club.member.user_id)\n                    MedicalService.GetById(document_id, 0, 1)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                //console.log(\"DATA RTN\", data);\n                                images = data.medical.images;\n\n                                var params = {\n                                    document_type: document_type,\n                                    document_id: document_id,\n                                    images: images\n                                };\n                                    vm.show_loading = false;\n\n                                actually_open(id, params, document_type, document_id);\n                            } else {\n                                ////console.log(\"WOOOPSIES...\");\n                                //this should be very very rare...\n\n                                    vm.show_loading = false;\n\n                                 vm.maybe = {\n                                     doc_type: \"medicals\",\n                                     doc_id: document_id\n                                 }\n\n                                if(data.fail == \"templogin\"){\n                                    //console.log(\"WOOOPSIES...\", data);\n                                    vm.show_temp_login = true;\n                                     vm.maybe = {\n                                         doc_type: \"medicals\",\n                                         doc_id: document_id\n                                     }\n\n                                }\n\n\n                            }\n                    });\n\n                break;\n                case 'licences':\n                    //console.log(\"LICENCE CHECK FOR ID: \", document_id);\n                    LicenceService.GetById(document_id, 0, 1)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                //console.log(\"DATA RTN\", data);\n                                images = data.licence.images;\n\n                                var params = {\n                                    document_type: document_type,\n                                    document_id: document_id,\n                                    images: images\n                                };\n                                    vm.show_loading = false;\n\n                                actually_open(id, params, document_type, document_id);\n                            } else {\n                                //console.log(\"WOOOPSIES...\");\n                                //this should be very very rare...\n                                    vm.show_loading = false;\n\n\n                                if(data.fail == \"templogin\"){\n                                    //console.log(\"WOOOPSIES...\", data);\n                                    vm.show_temp_login = true;\n\n                                     vm.maybe = {\n                                         doc_type: \"licences\",\n                                         doc_id: document_id\n                                     }\n\n                                }\n\n\n                            }\n                    });\n\n                break;\n                case 'differences':\n                    //console.log(\"DIFFERENCES CHECK FOR ID: \", document_id);\n\n                                var params = {\n                                    document_type: document_type,\n                                    document_id: document_id,\n                                    images: vm.differences_images\n                                };\n                                //console.log(\"DOCUMENT ID \", document_id);\n                                    vm.show_loading = false;\n                                actually_open(id, params, document_type, document_id);\n\n                break;\n                default:\n                                    vm.show_loading = false;\n                    ToastService.error('Unknown Request', \"Sorry - we didn't recognise the request\");\n                break;\n            }\n\n\n\n\n           \n        };\n\n        $scope.downloadInvoice = function(id) {\n            // var data = $.param({\n            //     id: doc\n            // });\n\n            //var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/invoice_pdf/get_ad_hoc_invoice/'+id, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Error', 'There was an error downloading the selected document(s)');\n                })\n        };\n\n        function processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], {\n                    type: contentType\n                });\n                if (navigator.msSaveBlob)\n                    navigator.msSaveBlob(blob, filename);\n                else {\n                    // Try using other saveBlob implementations, if available\n                    var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                    if (saveBlob === undefined) throw \"Not supported\";\n                    saveBlob(blob, filename);\n                }\n                success = true;\n            } catch (ex) {\n                $log.info(\"saveBlob method failed with the following exception:\");\n                $log.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            $log.info(\"Download link method with simulated click failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n        \n\n        $scope.open = function (member_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return member_id;\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n\n\n            modalInstance.result.then(function (member_id) {\n              $log.info('PRESSED GO: '+member_id);\n              MemberService.Delete(member_id)\n              .then(function(){\n                //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.members = $.grep(vm.club.members, function(e){ \n                    return e.id != member_id; \n                });\n              })\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n          };\n\n         \n\n\n    }\n app.controller('DashboardClubMembershipsController', DashboardClubMembershipsController);\n\n    DashboardClubMembershipsController.$inject = ['UserService', 'MembershipService', 'ClubService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'ToastService'];\n    function DashboardClubMembershipsController(UserService, MembershipService, ClubService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, ToastService) {\n        var vm = this;\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {};\n        vm.page_title = \"\";\n        \n        \n\n        vm.action = $state.current.data.action;\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n        ////console.log(\"club_id : \"+vm.club_id);\n\n        // //console.log(vm.action);\n        // //console.log($stateParams);\n        // //console.log($stateParams.id);\n\n\n        ClubService.GetById(vm.club_id)\n        .then(function(data){\n                console.log(\"DATA HERE\", data);\n                        vm.club = data;   \n                        vm.club.membership = {};\n\n        //default\n\n\n\n        switch(vm.action){\n            case \"add\":\n                //console.log(\"adding a new membership please\");\n                vm.page_title = \"Add a New membership\";\n\n                //setting some default values here\n                vm.club.membership.currency = vm.club.account_currency;\n                vm.club.membership.passenger_only = 0;\n                vm.club.membership.passenger_only_default = 0;\n\n                 MembershipService.GetAllMembershipPlanes(vm.club_id, 1)\n                    .then(function(data){\n                        vm.club_planes = data.membership_planes;   \n                    });\n\n            break;\n            case \"edit\":\n                //console.log(\"edit an existing membership\");\n                MembershipService.GetById($stateParams.membership_id, vm.club_id)\n                    .then(function(data){\n                        vm.club.membership = data;   \n                        //console.log(vm.club);\n                        vm.page_title = \"Edit a membership - \"+vm.club.membership.membership_name;\n                    });\n\n                MembershipService.GetAllMembershipPlanes(vm.club_id, $stateParams.membership_id)\n                    .then(function(data){\n                        vm.club_planes = data.membership_planes;   \n                    });\n\n\n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                MembershipService.GetAllByClub(vm.club_id)\n                    .then(function(data){\n                        vm.club.memberships = data;   \n                        console.log(\"one\", vm.club.memberships);\n                    });\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n\n         });\n        //'9' needs to refer the the user's account set to manage\n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        vm.clearFieldError = function(event) { ToastService.clearFieldError(event); };\n\n        $scope.save = function(){\n            var checks = [\n                { ok: vm.club.membership.membership_name, field: 'membership_name', label: 'Membership Name' },\n                { ok: vm.club.membership.payment_term,    field: 'payment_term',    label: 'Payment Term' }\n            ];\n            if (vm.club.membership.payment_term && vm.club.membership.payment_term !== 'free') {\n                checks.push({ ok: vm.club.membership.price != null && vm.club.membership.price !== '', field: 'price', label: 'Price' });\n            }\n            if (!ToastService.validateForm(checks)) return;\n\n            if(vm.action == \"add\"){\n                $scope.create();\n            } else {\n                $scope.update();\n            }\n        }\n\n\n        $scope.create = function(){\n            //console.log(\"CREATE ME NOW\");\n            vm.club.membership.club_id = vm.club_id;\n            MembershipService.Create(vm.club.membership)\n                .then(function(data){\n                    //console.log(data);\n                    $state.go('dashboard.manage_club.memberships');\n                });\n        }\n\n        $scope.delete = function(){\n            //console.log(\"CLICK\");\n            ToastService.warning('Confirm Delete', 'Are you sure you would like to delete this membership?');\n            MembershipService.Update(vm.club.membership)\n                .then(function(data){\n                    //console.log(data);\n                });\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n            vm.club.membership.club_id = vm.club_id;\n            MembershipService.Update(vm.club.membership)\n                .then(function(data){\n                    //console.log(\"new membership is : \",data);\n                    //console.log(\"saved\");\n\n                    if(vm.club.membership.plane_access == 1){\n                        //sort out what we need from the club_planes\n                        var send_planes = [];\n                        for(var i=0;i<vm.club_planes.length;i++){\n                            var plane = {\n                                id: vm.club_planes[i].id,\n                                tacho_hour_fee: vm.club_planes[i].membership_tacho_hour_fee,\n                                landing_fee: vm.club_planes[i].membership_landing_fee,\n                                touch_and_go_fee: vm.club_planes[i].membership_touch_and_go_fee,\n                                access: vm.club_planes[i].access,\n                                membership_id: data,\n                                plane_id: vm.club_planes[i].plane_id\n                            };\n                            send_planes.push(plane);\n                        }\n\n\n                        //then we need to make an additional call to UPDATE all these...\n                         MembershipService.UpdateMembershipPlanes(data, send_planes)\n                            .then(function(data){\n                                //console.log(data);\n\n                            });\n\n                    }\n\n                    $state.go('dashboard.manage_club.memberships');\n                });\n        }\n\n        initController();\n\n        vm.previous_price = 0;\n\n        vm.update_price = function(){\n\n            ////console.log(\"previous price: \", vm.previous_price);\n\n            if(vm.club.membership.payment_term == \"free\"){\n                vm.previous_price = (vm.club.membership.price > 0)? vm.club.membership.price : 0;\n                vm.club.membership.price = 0;\n            } else {\n                vm.club.membership.price = (vm.club.membership.price > 0) ? vm.club.membership.price : ((vm.previous_price > 0) ? vm.previous_price : 0);\n            }\n\n        }\n\n        \n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n            var warning_msg = \"By deleting this membership, you will also cancel all reservations that this membership currently has.\"\n\n          // $scope.open = function(membership_id) {\n          //     alert(\"HI\");\n          //     //console.log(\"log =- \", membership_id);\n\n          //   var modalInstance = $uibModal.open({\n          //     animation: true,\n          //     templateUrl: 'views/modals/deleteModal.html',\n          //     controller: 'ModalInstanceCtrl',\n          //     size: \"lg\",\n          //     resolve: {\n          //       id: function () {\n          //         return membership_id;\n          //       },\n          //       warning: function(){\n          //           return warning_msg;\n          //       }\n          //     }\n          //   });\n          //   modalInstance.result.then(function (membership_id) {\n          //     $log.info('PRESSED GO: '+membership_id);\n          //     MembershipService.Delete(membership_id)\n          //     .then(function(){\n          //       //console.log(\"HELLO DELETE\");\n          //       //update view?\n          //        vm.club.memberships = $.grep(vm.club.memberships, function(e){ \n          //           return e.id != membership_id; \n          //       });\n          //     })\n          //   }, function () {\n          //     $log.info('Modal dismissed at: ' + new Date());\n          //   });\n          // };\n\n\n           $scope.open = function (memberships) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return memberships;\n                },\n                params: function() {\n                  return {id: memberships};\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (memberships) {\n              $log.info('PRESSED GO: '+memberships.id);\n\n\n                MembershipService.Delete(memberships.id)\n              .then(function(){\n                //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.memberships = $.grep(vm.club.memberships, function(e){ \n                    return e.id != memberships.id; \n                });\n              })\n\n\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n          };\n\n         \n\n\n    }\n app.controller('DashboardClubPackagesController', DashboardClubPackagesController);\n\n    DashboardClubPackagesController.$inject = ['UserService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'PackageService', 'PlaneService', 'ToastService'];\n    function DashboardClubPackagesController(UserService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, PackageService, PlaneService, ToastService) {\n        var vm = this;\n\n        vm.charge_type = [\"brakes\", \"session\", \"plane\"];\n\n\n        vm.page_title = \"\";\n\n        vm.action = $state.current.data.action;\n        vm.user = $rootScope.globals.currentUser;\n        // //console.log(\"$rootScope.globals.currentUser : \", $rootScope.globals.currentUser);\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user_id = vm.user.id;\n\n        vm.packages = [];\n\n\n        // //console.log(vm.action);\n        // //console.log($stateParams);\n        // //console.log($stateParams.id);\n\n\n        vm.editing = false;\n        \n        switch(vm.action){\n            case \"add\":\n                //console.log(\"adding a new packages\");\n\n                  PlaneService.GetAllByClub(vm.club_id)\n                    .then(function(data){\n                        vm.planes_original = data; \n                        vm.planes = JSON.parse(JSON.stringify(vm.planes_original));\n\n\n                    });\n\n            break;\n            case \"edit\":\n                vm.editing = true;\n                //console.log(\"edit an existing packages\");\n\n                vm.package_id = $stateParams.package_id;\n\n                PackageService.GetPackageById($stateParams.package_id)\n                    .then(function(data){\n                        vm.package = data.item;   \n                        vm.package.available = (vm.package.available == 1) ? true : false;\n            \n                        vm.page_title = \"Edit a Package - \"+vm.package.title;\n                    });\n \n                    PackageService.GetPackagePlanesByPackageId($stateParams.package_id)\n                    .then(function(data){\n                        vm.aircraft = data.items;   \n            \n                        PlaneService.GetAllByClub(vm.club_id)\n                        .then(function(data){\n                            vm.planes_original = data; \n                            vm.planes = JSON.parse(JSON.stringify(vm.planes_original));\n\n                            vm.clean_aircraft_selection();\n\n                        });\n\n\n                    });\n\n\n\n\n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                PackageService.GetPackagesByClubId(vm.club_id)\n                    .then(function(data){\n                        vm.packages = data.items;   \n                        //console.log(vm.packages);\n                    });\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n       \n        \n        function refresh_aircraft(){\n\n                  PackageService.GetPackagePlanesByPackageId($stateParams.package_id)\n                    .then(function(data){\n                        vm.aircraft = data.items;   \n                    });\n\n        }\n\n        //'9' needs to refer the the user's account set to manage\n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n\n\n        vm.clearFieldError = function(event) { ToastService.clearFieldError(event); };\n\n        $scope.save = function(){\n            if (!vm.package) vm.package = {};\n            var pkg = vm.package;\n            var checks = [\n                { ok: pkg.title,                                                field: 'title',      label: 'Package Title' },\n                { ok: pkg.price != null && pkg.price !== '',                     field: 'price',      label: 'Price' },\n                { ok: pkg.hours_dual != null && pkg.hours_dual !== '',           field: 'hours_dual', label: 'Hours Dual' },\n                { ok: pkg.hours_solo != null && pkg.hours_solo !== '',           field: 'hours_solo', label: 'Hours Solo' },\n                { ok: pkg.difference != null && pkg.difference !== '',           field: 'difference', label: 'Difference' },\n                { ok: pkg.validity != null && pkg.validity !== '',               field: 'validity',   label: 'Validity' }\n            ];\n            if (!ToastService.validateForm(checks)) return;\n\n            if (!vm.aircraft || vm.aircraft.length < 1) {\n                ToastService.highlightField('.card');\n                ToastService.warning('Aircraft Required', 'You must add at least 1 aircraft to this package.');\n                return;\n            }\n\n            if(vm.action == \"add\"){\n                $scope.create();\n            } else {\n                $scope.update();\n            }\n        }\n\n        \n      \n\n\n\n       \n\n\n        vm.delete_aircraft = function(aircraft, index){\n\n\n            if(vm.action == \"add\"){\n\n                vm.aircraft.splice(index, 1);\n                            vm.clean_aircraft_selection();\n\n            } else {\n                // //console.log(\"EXAM\", exam);\n                if(confirm(\"Are you sure you wish to delete this aircraft for this package? This is irreversible.\")){\n\n                    PackageService.DeletePackagePlane(aircraft.id)\n                        .then(function(data){\n                            //console.log(data);\n                            if(data.success){\n                                vm.aircraft.splice(index, 1);\n                                vm.clean_aircraft_selection();\n                            } else {\n                                ToastService.error('Error', 'An error occurred');\n                            }\n                            //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n                        });\n                }\n            }\n            \n        }\n\n       vm.aircraft = [];\n       vm.new_aircraft2 = {};\n       vm.new_aircraft = {};\n\n        vm.add_aircraft = function(){\n\n\n            if(vm.action == \"add\"){\n                 \n                 vm.aircraft.push(vm.new_aircraft.plane);\n                            vm.clean_aircraft_selection();\n                 vm.new_aircraft = {};\n                            vm.new_aircraft2 = {};\n\n            } else {\n\n                vm.new_aircraft2.package_id = vm.package_id; \n                vm.new_aircraft2.club_id = vm.club_id; \n                vm.new_aircraft2.plane_id = vm.new_aircraft.plane.plane_id;\n\n                PackageService.CreatePackagePlane(vm.new_aircraft2)\n                    .then(function(data){\n                        //console.log(data);\n                        if(data.success){\n\n                            vm.aircraft.push(data.item);\n\n                            vm.clean_aircraft_selection();\n                            \n                            vm.new_aircraft = {};\n                            vm.new_aircraft2 = {};\n\n                        } else {\n                            ToastService.error('Error', 'An error occurred');\n                        }\n\n                        //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n\n                    });\n\n            }\n\n            \n        }\n\n\n        vm.clean_aircraft_selection = function(){\n\n            // vm.aircraft ==> list of aircraft already on this package\n\n            // vm.planes ==> list of aircraft that can be added to this package\n\n            //remove vm.planes entries which match the ones in aircraft list\n\n          \n\n            //vm.planes = vm.planes.filter( ( el ) => !vm.aircraft.includes( el.plane_id ) );\n\n            // vm.planes = vm.planes_original;\n\n            vm.planes = JSON.parse(JSON.stringify(vm.planes_original));\n\n\n           \n            for(var j=0;j<vm.aircraft.length;j++) {\n\n              var i = 0;\n              while (i < vm.planes.length) {\n                if (vm.planes[i].plane_id === vm.aircraft[j].plane_id) {\n                  vm.planes.splice(i, 1);\n                } else {\n                  ++i;\n                }\n              }\n\n\n          }\n\n\n\n\n\n        }\n\n\n\n\n\n\n\n\n\n\n        vm.update_charge = function(charge, index){\n\n            delete(charge.edit_me);\n\n            PackageService.UpdateCharge(charge)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success){\n\n                        vm.instructor_charges[index].edit_me = false;\n\n                    } else {\n                        ToastService.error('Error', 'An error occurred');\n                    }\n                    //refresh_tem();\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n                });\n        }\n\n        vm.update_cancel_charge = function(index){\n            refresh_charges();\n        }\n\n        vm.edit_charge = function(index){\n\n            vm.instructor_charges[index].edit_me = true;\n\n        }\n\n        vm.delete_charge = function(charge, index){\n            // //console.log(\"EXAM\", exam);\n            if(confirm(\"Are you sure you wish to delete this instructor charge? This is irreversible.\")){\n\n                PackageService.DeleteCharge(charge.id)\n                    .then(function(data){\n                        //console.log(data);\n                        if(data.success){\n                            vm.instructor_charges.splice(index, 1);\n                        } else {\n                            ToastService.error('Error', 'An error occurred');\n                        }\n                        //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n                    });\n            }\n        }\n\n       \n        \n        vm.add_charge = function(){\n\n            vm.new_charge.course_id = $stateParams.course_id; \n            vm.new_charge.club_id = vm.club_id; \n\n            PackageService.CreateCharge(vm.new_charge)\n                .then(function(data){\n                    //console.log(data);\n                    if(data.success){\n\n                        vm.instructor_charges.push(data.item);\n\n                        vm.new_charge = {\n                            title: \"\",\n                            charge_type: \"\",\n                            price: \"\"\n                        }\n\n                    } else {\n                        ToastService.error('Error', 'An error occurred');\n                    }\n\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n\n                });\n        }\n\n\n\n\n        vm.convert_decimal_to_hours = function(decimal_time){\n            var temp = new Array();\n            temp = decimal_time.toString().split('.');\n            \n            var hours = temp[0];\n            if(hours < 10){\n                hours = \"0\"+hours;\n            }\n            if(temp[1]){\n               var minutes = 100 / temp[1];\n                minutes = Math.round(60 / minutes); \n\n                if(minutes < 10){\n                    minutes = \"0\"+minutes;\n                }\n            } else {\n                minutes = \"00\"\n            }\n\n            return hours + ':' + minutes;\n        }\n\n\n\n\n\n\n\n\n         vm.delete_course = function(id, index){\n            if(confirm(\"Are you sure you wish to delete this course? This is irreversible.\")){\n\n                PackageService.DeletePackage(id)\n                    .then(function(data){\n                        //console.log(data);\n                        if(data.success){\n                            vm.packages.splice(index, 1);\n                        } else {\n                            ToastService.error('Error', 'An error occurred');\n                        }\n                        //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n                    });\n            } \n        }\n\n        $scope.create = function(){\n            ////console.log(\"CREATE ME NOW\");\n         \n            //return false;\n            //return false;\n            vm.package.club_id = vm.club_id;\n            vm.package.aircraft = vm.aircraft;\n\n            PackageService.CreatePackage(vm.package)\n                .then(function(data){\n                    ////console.log(data);\n                        \n                    $state.go('dashboard.manage_club.package', {reload: true});\n\n                });\n\n\n        }\n\n        $scope.delete = function(){\n            //console.log(\"CLICK\");\n            ToastService.warning('Delete Package', 'Are you sure you would like to delete this package?');\n            PackageService.DeletePackage(vm.package.id)\n                .then(function(data){\n                    //console.log(data);\n                });\n        }\n\n        function get_update_docs(){\n            var documents = [];\n\n            for(var i=0;i<update_this_file.length;i++){\n                var id = update_this_file[i];\n                //console.log(\"looking for : \", id);\n                //console.log(\"in: \", vm.course_documents);\n\n                for(var k=0;k<vm.package.course_documents.length;k++){\n                    //console.log(\"comparing to : \", vm.package.course_documents[k].id);\n                    if(vm.package.course_documents[k].id == id){\n                        documents.push(vm.package.course_documents[k]);\n                    }\n                }\n\n            }\n\n            // //console.log(\"DOCS TO UPDATE : \", documents);\n\n            return documents;\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n         \n\n            PackageService.UpdatePackage(vm.package)\n                .then(function(data){\n                    //console.log(data);\n                    //console.log(\"saved\");\n                    $state.go('dashboard.manage_club.package');\n                });\n        }\n\n\n\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n}\n app.controller('DashboardClubPaymentsController', DashboardClubPaymentsController);\n\n    DashboardClubPaymentsController.$inject = ['UserService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'LicenceService', 'MedicalService', 'DifferencesService', 'PlaneDocumentService', 'ClubPaymentService', 'ToastService'];\n    function DashboardClubPaymentsController(UserService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, LicenceService, MedicalService, DifferencesService, PlaneDocumentService, ClubPaymentService, ToastService) {\n        var vm = this;\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {\n            plane: {\n                requirements: {\n                    licence: [],\n                    medical: [],\n                    differences: []\n                },\n                documents: []\n            }\n        };\n\n        vm.page_title = \"\";\n        \n        vm.plane_document = {};\n        vm.plane_documents = [];\n\n        var update_this_file = [];\n        \n    \n        vm.action = $state.current.data.action;\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n        ClubPaymentService.GetPaymentsByClub(vm.club_id)\n                .then(function(data){\n                    //console.log(\"ALL PAYMENTS...\", data);\n                    vm.payments = data.payments;\n                });\n\n        //'9' needs to refer the the user's account set to manage\n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        $scope.save = function(){\n            if(vm.action == \"add\"){\n                //console.log(\"CREATE click\");\n                $scope.create();\n            } else {\n                //console.log(\"EDIT click\");\n                //console.log(vm.club.plane);\n                $scope.update();\n            }\n        }\n\n\n        $scope.create = function(){\n            //console.log(\"CREATE ME NOW\");\n            vm.club.plane.club_id = vm.club_id;\n            vm.club.plane.add_documents = vm.plane_documents;\n            //console.log(\"PLANE TO ADD, \", vm.club.plane);\n            //return false;\n            PlaneService.Create(vm.club.plane)\n                .then(function(data){\n                    //console.log(data);\n                    $state.go('dashboard.manage_club.planes', {reload: true});\n\n                });\n        }\n\n        $scope.delete = function(){\n            //console.log(\"CLICK\");\n            ToastService.warning('Delete Plane', 'Are you sure you would like to delete this plane?');\n            PlaneService.Update(vm.club.plane)\n                .then(function(data){\n                    //console.log(data);\n                });\n        }\n\n        function get_update_docs(){\n            var documents = [];\n\n            for(var i=0;i<update_this_file.length;i++){\n                var id = update_this_file[i];\n                //console.log(\"looking for : \", id);\n                //console.log(\"in: \", vm.plane_documents);\n\n                for(var k=0;k<vm.club.plane.plane_documents.length;k++){\n                    //console.log(\"comparing to : \", vm.club.plane.plane_documents[k].id);\n                    if(vm.club.plane.plane_documents[k].id == id){\n                        documents.push(vm.club.plane.plane_documents[k]);\n                    }\n                }\n\n            }\n\n            // //console.log(\"DOCS TO UPDATE : \", documents);\n\n            return documents;\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n            vm.club.plane.club_id = vm.club_id;\n            vm.club.plane.add_documents = vm.plane_documents;\n\n            vm.club.plane.update_documents = get_update_docs();\n            //get_update_docs();\n\n            PlaneService.Update(vm.club.plane)\n                .then(function(data){\n                    //console.log(data);\n                    //console.log(\"saved\");\n                    $state.go('dashboard.manage_club.planes');\n                });\n        }\n\n        $scope.get_payment_description = function(payment_method){\n\n            if(payment_method == \"Stripe\"){\n                return \"This invoice was charged using the Stripe integration\";\n            } else if(payment_method == \"Equilibrium\"){\n                return \"This invoice amounted to 0 and hence no payment was taken\";\n            } else if(payment_method == \"GoCardless\"){\n                return \"This invoice was charged using the GoCardless integration\";\n            } else if(payment_method == \"GoCardless + Credit\"){\n                return \"This invoice was charged using the GoCardless integration as well as Credit on file.\";\n            } else if(payment_method == \"Credit\"){\n                return \"This invoice was charged using the Credit the user had on file.\";\n            }\n\n\n        }\n\n\n        function containsObject(obj, list, params) {\n\n            // //console.log(\"obj\", obj);\n            // //console.log(\"list\", list);\n            // //console.log(\"params\", params);\n\n            for(var i=0; i<list.length; i++) {\n                // //console.log(\"list i : \", list[i]);\n                // //console.log(\"obj is: \", obj);\n\n                var count_success = 0;\n                for(var j=0;j<params.length;j++){\n                    if(list[i][params[j]] && obj[params[j]] && list[i][params[j]] == obj[params[j]]){\n                        count_success++;\n                    }\n                }\n\n                if(count_success === params.length) {                    \n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n\n        function check_all(){\n\n            //maybe a nice to have one day... not yet though.\n\n\n            //licences\n            vm.club.plane.requirements.licence.forEach(function(obj){\n\n            });\n\n        }\n\n      \n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n          var warning_msg = \"By deleting this plane, you will also cancel all reservations that this plane currently has.\"\n\n\n            $scope.open = function (payment) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/refundModal.html',\n              controller: 'RefundModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return payment;\n                },\n                params: function() {\n                  return payment;\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (refund) {\n                var id = refund.id;\n              $log.info('PRESSED GO: ', refund);\n              \n              if(refund.to_refund > (refund.amount - refund.amount_refunded)){\n                ToastService.warning('Refund Limit', 'You are trying to refund more than the payment was for. You will need to first refund this amount in full, and then make a payment to the user for the remaining sum.');\n                return false;\n              }\n\n              if(refund.to_refund > 0 && refund.payment_method == \"Stripe\"){\n                //then the amount is OK to refund....\n                //and this is a Stripe payment.\n\n                if(refund.to_refund == refund.amount){\n                    //total refund\n\n                } else {\n                    //partial refund\n\n                }\n\n                ClubPaymentService.Refund(refund)\n                .then(function(data){\n                    //console.log(\"HELLO REFUND\", data);\n                    //update view?\n                    \n\n                 });\n\n\n\n\n              }\n\n\n             //  PlaneService.Delete(id)\n             //  .then(function(){\n             //    //console.log(\"HELLO DELETE\");\n             //    //update view?\n             //     vm.club.planes = $.grep(vm.club.planes, function(e){ \n             //        return e.id != id; \n             //    });\n             // });\n\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n\n\n          };\n\n\n\n\n\n\n\n\n\n\n          $scope.new_charge = function (charge) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/newChargeModal.html',\n              controller: 'NewChargeModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return charge;\n                },\n                params: function() {\n                  return charge;\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (charge) {\n               \n\n              $log.info('PRESSED GO: ', charge);\n              \n                \n\n                // ClubPaymentService.Refund(refund)\n                // .then(function(data){\n                //     //console.log(\"HELLO REFUND\", data);\n                //     //update view?\n                    \n\n                //  });\n\n\n\n\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n\n\n          };\n         \n\n\n    }\n app.controller('DashboardClubPlanesController', DashboardClubPlanesController);\n\n    DashboardClubPlanesController.$inject = ['UserService', 'PlaneService', 'FoxService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'LicenceService', 'MedicalService', 'DifferencesService', 'PlaneDocumentService', 'ToastService'];\n    function DashboardClubPlanesController(UserService, PlaneService, FoxService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, LicenceService, MedicalService, DifferencesService, PlaneDocumentService, ToastService) {\n        var vm = this;\n\n           //    /* PLEASE DO NOT COPY AND PASTE THIS CODE. */(function(){var w=window,C='___grecaptcha_cfg',cfg=w[C]=w[C]||{},N='grecaptcha';var gr=w[N]=w[N]||{};gr.ready=gr.ready||function(f){(cfg['fns']=cfg['fns']||[]).push(f);};(cfg['render']=cfg['render']||[]).push('explicit');(cfg['onload']=cfg['onload']||[]).push('initRecaptcha');w['__google_recaptcha_client']=true;var d=document,po=d.createElement('script');po.type='text/javascript';po.async=true;po.src='https://www.gstatic.com/recaptcha/releases/JPZ52lNx97aD96bjM7KaA0bo/recaptcha__en.js';var e=d.querySelector('script[nonce]'),n=e&&(e['nonce']||e.getAttribute('nonce'));if(n){po.setAttribute('nonce',n);}var s=d.getElementsByTagName('script')[0];s.parentNode.insertBefore(po, s);})();\n\n           // var initRecaptcha = function () { \n           //     // document.getElementById(\"SearchModule\").scope().vm.parent.isGrecaptchaLoaded = !0, \n           //     // document.getElementById(\"SearchModule\").scope().vm.showRecaptcha();\n           //     vm.showRecaptcha();\n           // };\n              \n\n\n        vm.show_loading = false;\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {\n            plane: {\n                requirements: {\n                    licence: [],\n                    medical: [],\n                    differences: []\n                },\n                documents: []\n            }\n        };\n\n        vm.page_title = \"\";\n        \n        vm.plane_document = {};\n        vm.plane_documents = [];\n\n        var update_this_file = [];\n        \n        \n        vm.currency_types = [\"class\", \"type\"];\n        vm.gear_types = [\"tricycle\", \"tailwheel\", \"monowheel\", \"floats\", \"amphibian\", \"skis\"];\n        // vm.certificates = [\"Certificate of Airworthiness\", \"National Certificate of Airworthiness\", \"Permit to Fly\"];\n        vm.certificates = [{id: 1, title: \"Certificate of Airworthiness\", value: \"cofa\"}, {id: 2, title: \"National Certificate of Airworthiness\", value: \"cofa\"}, {id: 2, title: \"LAA Permit to Fly\", value: \"ptf\"}];\n        vm.classes = [\"SEP (land)\", \"SEP (sea)\", \"SET (land)\", \"SET (sea)\", \"MEP (land)\", \"MEP (sea)\", \"ME\"];\n\n        vm.charge_type = [\"airborne\", \"brakes\", \"tacho\", \"hobbs\", \"flight\", \"brakes_rounded\"];\n        vm.surcharge_type = [\"none\", \"flight\", \"hour\", \"taxi\"];\n\n        vm.action = $state.current.data.action;\n        vm.user = $rootScope.globals.currentUser;\n        //console.log(\"$rootScope.globals.currentUser : \", $rootScope.globals.currentUser);\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user_id = vm.user.id;\n\n\n        vm.plane_certificate = {};\n        vm.plane_noise = {};\n        vm.plane_radio = {};\n        vm.plane_maintenance = {};\n        vm.plane_insurance = {};\n\n        vm.plane_engine_1 = {removed_date: \"\"};\n        vm.plane_engine_1_replace = {removed_date: \"\"};\n        vm.plane_engine_2 = {removed_date: \"\"};\n        vm.plane_engine_2_replace = {removed_date: \"\"};\n\n        vm.plane_propeller_1 = {removed_date: \"\"};\n        vm.plane_propeller_1_replace = {removed_date: \"\"};\n        vm.plane_propeller_2 = {removed_date: \"\"};\n        vm.plane_propeller_2_replace = {removed_date: \"\"};\n\n        vm.show_replace_engine_1 = false;\n        vm.show_replace_engine_2 = false;\n        vm.show_replace_prop_1 = false;\n        vm.show_replace_prop_2 = false;\n\n        // //console.log(vm.action);\n        // //console.log($stateParams);\n        // //console.log($stateParams.id);\n\n\n\n\n         LicenceService.GetAll()\n            .then(function(data){\n                //console.log(\"LICENCES : \", data.licences);\n                vm.licences = data.licences;   \n            });\n\n        LicenceService.GetRatings()\n            .then(function(data){\n                //console.log(\"RATINGS : \", data);\n                vm.ratings = data;   \n            });\n\n\n        MedicalService.GetAuthority()\n         .then(function(data){\n                //console.log(\"AUTHORITY : \", data);\n                vm.medical_authorities = data;   \n            });\n\n         MedicalService.GetComponents()\n         .then(function(data){\n                //console.log(\"COMPONENTS : \", data);\n                vm.medical_components = data;\n            });\n\n         DifferencesService.GetDifferences()\n         .then(function(data){\n                //console.log(\"DIFF : \", data);\n                vm.differences = data;\n            });\n\n\n         vm.editing = false;\n        \n        switch(vm.action){\n            case \"add\":\n                //console.log(\"adding a new plane please\");\n                vm.page_title = \"Add a New Plane\";\n            break;\n            case \"edit\":\n                vm.editing = true;\n                //console.log(\"edit an existing plane\");\n                PlaneService.GetById($stateParams.plane_id, vm.club_id)\n                    .then(function(data){\n                        vm.club.plane = data;   \n                        // vm.club.plane.requirements = {\n                        //         licence: [],\n                        //         medical: [],\n                        //         differences: [],\n                        //         hours: []\n                        // };\n\n                        console.log(vm.club.plane);\n\n                        if(vm.club.plane.colour && vm.club.plane.colour.indexOf(\"rgba\") > -1){\n                            vm.club.plane.colour = rgbaToHex(vm.club.plane.colour);\n                        }\n\n                        if(vm.club.plane.bg_colour && vm.club.plane.bg_colour.indexOf(\"rgba\") > -1){\n                            vm.club.plane.bg_colour = rgbaToHex(vm.club.plane.bg_colour);\n                        }\n\n                        vm.club.plane.airframe_hours = parseFloat(vm.club.plane.airframe_hours);\n\n                        vm.club.plane.vp = (vm.club.plane.vp == 1)? true:false;\n                        vm.club.plane.rg = (vm.club.plane.rg == 1)? true:false; \n                        vm.club.plane.tb = (vm.club.plane.tb == 1)? true:false; \n\n                        vm.plane_engine_1 = vm.club.plane.engine_1;\n                        vm.plane_engine_2 = vm.club.plane.engine_2;\n\n                        vm.plane_propeller_1 = vm.club.plane.propeller_1;\n                        vm.plane_propeller_2 = vm.club.plane.propeller_2;\n\n                        //console.log(vm.club);\n                        vm.page_title = \"Edit a Plane - \"+vm.club.plane.registration;\n                    });\n\n               \n\n\n               \n\n\n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                PlaneService.GetAllByClub(vm.club_id)\n                    .then(function(data){\n                        vm.club.planes = data;   \n                        //console.log(vm.club.planes);\n                    });\n\n                    //console.log(\"hello alex\");\n\n\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n        //'9' needs to refer the the user's account set to manage\n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n\n\n        function rgbaToHex (rgba) {\n          var inParts = rgba.substring(rgba.indexOf(\"(\")).split(\",\"),\n              r = parseInt(trim(inParts[0].substring(1)), 10),\n              g = parseInt(trim(inParts[1]), 10),\n              b = parseInt(trim(inParts[2]), 10);\n             // a = parseFloat(trim(inParts[3].substring(0, inParts[3].length - 1))).toFixed(2);\n          var outParts = [\n            r.toString(16),\n            g.toString(16),\n            b.toString(16)\n            //,Math.round(a * 255).toString(16).substring(0, 2)\n          ];\n\n          // Pad single-digit output values\n          outParts.forEach(function (part, i) {\n            if (part.length === 1) {\n              outParts[i] = '0' + part;\n            }\n          })\n\n          return ('#' + outParts.join(''));\n        }\n\n        function trim (str) {\n          return str.replace(/^\\s+|\\s+$/gm,'');\n        }\n        function hexToRGBA(hex, opacity=1) {  \n            let r = parseInt(hex.substring(1,3), 16);  \n            let g = parseInt(hex.substring(3,5), 16);  \n            let b = parseInt(hex.substring(5), 16);  \n            var rtn = \"rgba(\"+r+\", \"+g+\", \"+b+\", \"+opacity+\")\";\n            return rtn;\n        }\n\n        $scope.save_planes_order = function(){\n            // //console.log(\"hiya\");\n            var update_order = [];\n            for(var i=0; i < vm.club.planes.length;i++){\n                var me = {\n                    id: vm.club.planes[i].plane_id,\n                    display_order: i\n                }\n                update_order.push(me);\n            }\n            // //console.log(\"organised: \", update_order);\n\n\n\n            PlaneService.UpdateOrder({\"order\": update_order})\n                .then(function(data){\n                    //console.log(data);\n\n                    // vm.items = data.items;\n                    //$state.go('dashboard.manage_club.edit_lesson', {course_id: vm.club.lesson.course_id, lesson_id: data.id, reload: true});\n\n                });\n\n        }\n\n\n        $scope.set_aircraft_details = function(){\n\n            // console.log(\"get deeeets\", vm.plane_search);\n\n            PlaneService.GetAddAircraft(vm.plane_search.registration)\n                .then(function (data) {\n                    ////console.log(data);\n\n                    // console.log(data);\n                                // return false;\n\n                    if(data){\n                        //use GB airfields first...\n                       \n                         if(data.length == 0){\n                            //console.log(\"SETTINGS HERE\");\n                                // vm.plane_search = \n                                //     {\n                                //         id: 0,\n                                //         registation: vm.plane_search.registration,\n                                //         icao_type: \"not known\"\n                                //     };\n\n                                // vm.club.plane.manufacturer = vm.plane_search.manufacturer;      \n\n                        } else {\n\n                                vm.plane_search = data;\n                                // console.log(\"SUCCESS FOUND\", data);\n                                processNewAircraft();\n                        }\n\n\n                        //console.log(\"PLANE SEARCHED\", vm.plane_search);\n\n                    } else {\n\n\n                        console.log(\"WOOOPSIES... this aircraft isn't in our database?\");\n                        //this should be very very rare...\n\n                         // vm.plane_search = \n                         //            {\n                         //                registation: vm.plane_search.registration,\n                         //                icao_type: \"not known\"\n                         //            };\n                                    // vm.club.plane.manufacturer = vm.plane_search.manufacturer;                        \n\n                    }\n\n                });\n\n\n        }\n\n        function processNewAircraft(){\n\n\n            //vm.club.plane \n\n            //TYPES -->>>\n\n              //aircraft_class --> FIXED-WING LANDPLANE\n                  //is_propeller = 1\n                  //number_of_engines  --> 1 = SEP\n                                    // --> >1 = MEP\n\n                  //is_propeller = 0\n                  //number_of_engines  --> 1 = SET\n                                    // --> >1 = ME\n\n\n            vm.club.plane.manufacturer = vm.plane_search.manufacturer;                        \n            vm.club.plane.serial_no = vm.plane_search.serial_number;                        \n            vm.club.plane.plane_type = vm.plane_search.icao_type;                        \n            vm.club.plane.type_name = vm.plane_search.type_name;                        \n            vm.club.plane.year_built = vm.plane_search.year_built;                        \n            vm.club.plane.aircraft_id = vm.plane_search.id;       \n            vm.club.plane.mtow = parseInt(vm.plane_search.mtow);\n            vm.club.plane.airframe_hours = vm.plane_search.airframe_hours;          \n\n\n            // alert(vm.plane_search.gear_type);\n\n            if(vm.plane_search.noise_level){\n\n                var regex = /[+-]?\\d+(\\.\\d+)?/g;\n\n                vm.plane_noise.noise_level = vm.plane_search.noise_level.match(regex).map(function(v) { return parseFloat(v); });\n                ////console.log(floats);\n\n            }\n            // vm.club.plane.noise_level = vm.plane_search.noise_level;//parseInt(vm.plane_search.noise_level);                 \n            \n\n\n            vm.plane_noise.noise_cert_issue = (vm.plane_search.noise_cert_issue)? new Date(vm.plane_search.noise_cert_issue) : \"\";                 \n\n            if(vm.plane_search.aircraft_class.indexOf(\"FIXED-WING\") > -1){\n\n                if(vm.plane_search.is_propeller > 0 && vm.plane_search.engine_name.indexOf(\"PT6A-\") == -1){\n\n                    vm.club.plane.plane_class = (vm.club.plane.number_of_engines > 1) ? \"MEP\" : \"SEP\";\n\n                } else {\n\n                    vm.club.plane.plane_class = (vm.club.plane.number_of_engines > 1) ? \"ME\" : \"SET\";\n\n                }\n\n                if(vm.plane_search.aircraft_class.indexOf(\"LANDPLANE\") > -1){\n                    vm.club.plane.plane_class = vm.club.plane.plane_class + \" (land)\";\n                    vm.club.plane.gear_type = \"\";\n                }\n\n                if(vm.plane_search.aircraft_class.indexOf(\"AMPHIBIAN\") > -1 || vm.plane_search.aircraft_class.indexOf(\"FLOAT\") > -1){\n                    vm.club.plane.plane_class = vm.club.plane.plane_class + \" (sea)\";\n                    vm.club.plane.gear_type = (vm.plane_search.aircraft_class.indexOf(\"AMPHIBIAN\") > -1)? \"amphibian\" : \"floats\";\n                }\n\n\n\n            }        \n\n\n\n            vm.club.plane.seats = (parseInt(vm.plane_search.seats) + 1);\n\n\n            //Certificate of Airworthiness ==> National CofA\n            //Permit to Fly ==> LAA permit\n            //EASA Certificate of Airworthiness ==> EASA CofA\n\n            if(vm.plane_maintenance && vm.plane_maintenance.cofa_category){\n                vm.plane_maintenance.cofa_category =  (vm.plane_search.cofa_category.indexOf(\"cofa\") > -1)? \"Certificate of Airworthiness\" : \"Permit to Fly\";//(vm.plane_search.cofa_category.indexOf(\"EASA\") > -1)? \"EASA Certificate of Airworthiness\" : ((vm.plane_search.cofa_category.indexOf(\"Certificate of Airworthiness\") > -1)? \"National Certificate of Airworthiness\" : \"Permit to Fly\");\n            }\n\n            vm.plane_maintenance.certificate_expiry = new Date(vm.plane_search.cofa_expiry);\n            \n            vm.club.plane.cofa_category = vm.plane_maintenance.cofa_category;//(vm.plane_search.cofa_category.indexOf(\"EASA\") > -1)? \"easa_cofa\" : ((vm.plane_search.cofa_category.indexOf(\"Certificate of Airworthiness\") > -1)? \"n_cofa\" : \"permit\")\n\n            vm.club.plane.gear_type = vm.plane_search.gear_type;\n\n\n\n            //ENGINES AND PROPS!!!\n            vm.plane_engine_1.make = vm.plane_search.engine_name;                        \n            vm.plane_engine_1.model = vm.plane_search.engine_name;                     \n\n            vm.plane_propeller_1.make = vm.plane_search.propeller_manufacturer;                        \n            vm.plane_propeller_1.model = vm.plane_search.propeller_name;                        \n\n            if(vm.plane_search.number_of_engines > 1){\n                \n                vm.number_of_engine = vm.plane_search.number_of_engines;\n\n                vm.plane_engine_2.make = vm.plane_search.engine_name;                        \n                vm.plane_engine_2.model = vm.plane_search.engine_name;\n                \n                vm.plane_propeller_2.make = vm.plane_search.propeller_manufacturer;                        \n                vm.plane_propeller_2.model = vm.plane_search.propeller_name; \n            }   \n\n        }\n\n\n        vm.clearFieldError = function(event) { ToastService.clearFieldError(event); };\n\n        $scope.save = function(){\n            var checks = [];\n            if (vm.action == 'add') {\n                // Aircraft Details\n                checks.push({ ok: vm.plane_search && vm.plane_search.registration, field: 'registration', label: 'Registration' });\n                checks.push({ ok: vm.club.plane.manufacturer,    field: 'manufacturer',    label: 'Manufacturer' });\n                checks.push({ ok: vm.club.plane.serial_no,       field: 'serial_no',       label: 'Serial Number' });\n                checks.push({ ok: vm.club.plane.year_built,      field: 'year_built',      label: 'Year Built' });\n                checks.push({ ok: vm.club.plane.plane_class,     field: 'plane_class',     label: 'Aircraft Class' });\n                checks.push({ ok: vm.club.plane.gear_type,       field: 'gear_type',       label: 'Undercarriage Type' });\n                checks.push({ ok: vm.club.plane.seats,           field: 'seats',            label: 'Total Seats' });\n                checks.push({ ok: vm.club.plane.mtow,            field: 'mtow',             label: 'MTOW' });\n                checks.push({ ok: vm.club.plane.airframe_hours != null && vm.club.plane.airframe_hours !== '', field: 'airframe_hours', label: 'Airframe Hours' });\n\n                // Engine 1\n                checks.push({ ok: vm.plane_engine_1.make,         field: 'engine1_make',         label: 'Engine Make' });\n                checks.push({ ok: vm.plane_engine_1.model,        field: 'engine1_model',        label: 'Engine Model' });\n                checks.push({ ok: vm.plane_engine_1.serial_no,    field: 'engine1_serial_no',    label: 'Engine Serial Number' });\n                checks.push({ ok: vm.plane_engine_1.total_hours_at_start != null && vm.plane_engine_1.total_hours_at_start !== '', field: 'engine1_total_hours', label: 'Engine Total Hours' });\n                checks.push({ ok: vm.plane_engine_1.date_fitted,  field: 'engine1_date_fitted',  label: 'Engine Date Fitted' });\n                checks.push({ ok: vm.plane_engine_1.tbo_hours != null && vm.plane_engine_1.tbo_hours !== '', field: 'engine1_tbo_hours', label: 'Engine TBO Hours' });\n\n                // Propeller 1\n                checks.push({ ok: vm.plane_propeller_1.make,         field: 'prop1_make',         label: 'Propeller Make' });\n                checks.push({ ok: vm.plane_propeller_1.model,        field: 'prop1_model',        label: 'Propeller Model' });\n                checks.push({ ok: vm.plane_propeller_1.serial_no,    field: 'prop1_serial_no',    label: 'Propeller Serial Number' });\n                checks.push({ ok: vm.plane_propeller_1.date_fitted,  field: 'prop1_date_fitted',  label: 'Propeller Date Fitted' });\n                checks.push({ ok: vm.plane_propeller_1.tbo_hours != null && vm.plane_propeller_1.tbo_hours !== '', field: 'prop1_tbo_hours', label: 'Propeller TBO Hours' });\n                checks.push({ ok: vm.plane_propeller_1.total_hours_at_start != null && vm.plane_propeller_1.total_hours_at_start !== '', field: 'prop1_hours', label: 'Propeller Hours' });\n\n                // Maintenance\n                checks.push({ ok: vm.plane_maintenance.cofa_category,       field: 'cert_type',          label: 'Certificate Type' });\n                checks.push({ ok: vm.plane_maintenance.certificate_expiry,  field: 'cert_expiry',        label: 'Certificate Expiry' });\n                checks.push({ ok: vm.plane_maintenance.next_maintenance,    field: 'next_maintenance',   label: 'Next Maintenance' });\n                checks.push({ ok: vm.plane_maintenance.hours_remaining != null && vm.plane_maintenance.hours_remaining !== '', field: 'hours_remaining', label: 'Hours Remaining' });\n\n                // Default Charges\n                checks.push({ ok: vm.club.plane.charge_type,     field: 'charge_type',     label: 'Charge Type' });\n                checks.push({ ok: vm.club.plane.tacho_hour_fee != null && vm.club.plane.tacho_hour_fee !== '', field: 'tacho_hour_fee', label: 'Cost Per Hour' });\n            }\n            checks.push({ ok: vm.club.plane.plane_type, field: 'plane_type', label: 'ICAO Type' });\n            if (!ToastService.validateForm(checks)) return;\n\n            if(vm.action == \"add\"){\n                $scope.create();\n            } else {\n                $scope.update();\n            }\n        }\n        vm.disable_reset = false;\n        vm.disable_reset2 = false;\n\n\n        //https://local.toaviate.com/api/v1/fox/fix_uncombined\n\n        vm.fix_uncombined = function(){\n\n            var a = confirm(\"Are you sure you wish to fix uncombined flight logs - this will also reset the aerolpane logbooks and cannot be undone.\");\n            if(a && !vm.disable_reset2){\n                vm.disable_reset2 = true;\n                vm.show_loading = true;\n                //FoxService\n                FoxService.FixUncombinedLogs(vm.club_id)\n                .then(function(data){\n                    ////console.log(data);\n                    $state.go('dashboard.manage_club.planes', {reload: true});\n                    vm.disable_reset2 = true;\n                    vm.show_loading = false;\n                });\n\n            } else {\n                console.log(\"cancelled\");\n                vm.show_loading = false;\n            }\n        }\n\n        vm.reset_all_club_logs = function(){\n            var a = confirm(\"Are you sure you wish to reset this?\");\n            if(a && !vm.disable_reset){\n                vm.disable_reset = true;\n                vm.show_loading = true;\n                //FoxService\n                FoxService.ResetAllClubPlanes(vm.club_id)\n                .then(function(data){\n                    ////console.log(data);\n                    $state.go('dashboard.manage_club.planes', {reload: true});\n                    vm.disable_reset = true;\n                    vm.show_loading = false;\n                });\n\n            } else {\n                console.log(\"cancelled\");\n                vm.show_loading = false;\n            }\n        }\n\n        vm.round_brake_times_start = function(input, earlier_input=null){\n            \n                if(input){\n                  if(input.indexOf(\":\") > -1){\n                    var split = input.split(\":\");\n                    var x = split[1];\n\n\n\n                    var min_nearest_five = ((x % 5) >= 2.5 ? parseInt(x / 5) * 5 + 5 : parseInt(x / 5) * 5);\n                    \n\n\n                    if(min_nearest_five < 10){\n                      min_nearest_five = \"0\"+min_nearest_five;\n                    } else if(min_nearest_five == 60){\n                      split[0]++;\n                      min_nearest_five = \"00\";\n                    } else if(min_nearest_five > 60){\n                      split[0]++;\n                      min_nearest_five = (min_nearest_five - 60);\n                    }\n\n\n                    if(earlier_input && earlier_input.indexOf(\":\") > -1){\n                            // console.log(\"total calculated?\");\n                            // console.log(\"earlier_input: \", earlier_input);\n                            // console.log(\"input: \", input);\n                            var esplit = earlier_input.split(\":\");\n                            var ehour = esplit[0];\n                            var emin = esplit[1];\n                            var etot = (parseInt(ehour)*60) + parseInt(emin); \n                            // console.log(\"etot: \", etot);\n                            var hr = split[0];\n                            var mn = min_nearest_five;\n                            var tot = (parseInt(hr)*60) + parseInt(mn);\n                            // console.log(\"tot: \", tot);\n\n                            if(etot < tot){\n                                //the earlier time is after the end time\n                                // console.log(\"etot < tot\");\n                                min_nearest_five = parseInt(min_nearest_five) - 5;\n                                if(min_nearest_five == 60){\n                                    split[0]++; \n                                    min_nearest_five = \"00\";\n                                } else if(min_nearest_five > 60){\n                                    split[0]++;\n                                    min_nearest_five = (min_nearest_five - 60);\n                                    if(min_nearest_five < 10 ){\n                                      min_nearest_five = \"0\"+min_nearest_five;\n                                    }\n                                } else if(min_nearest_five < 0){\n                                    split[0]--;\n                                    min_nearest_five = (60 + parseInt(min_nearest_five));\n                                }\n                                // console.log(\"split: \", split[0]);\n                                // console.log(\"min_nearest_five: \", min_nearest_five);\n                            }\n\n                    }\n                    //essentially we add 5 in case something happens over the limit\n\n                    return split[0] + \":\" + min_nearest_five;\n                  } else {\n                    return input;\n                  }\n                } else {\n                  return '';\n                }\n          \n\n          }\n\n\n        $scope.create = function(){\n            ////console.log(\"CREATE ME NOW\");\n            vm.club.plane.club_id = vm.club_id;\n            vm.club.plane.add_documents = vm.plane_documents;\n            vm.club.plane.registration = vm.plane_search.registration;\n\n            vm.club.maintenance_type = vm.plane_maintenance.cofa_category.value;\n\n            console.log(\"vm.plane_maintenance.cofa_category \", vm.club.maintenance_type );\n            //return false;\n            \n            vm.plane_maintenance.file = vm.files.cert[0];\n            vm.plane_radio.file = vm.files.radio[0];\n            vm.plane_noise.file = vm.files.noise[0];\n            vm.plane_insurance.file = vm.files.insurance[0];\n\n            vm.club.plane.maintenance = vm.plane_maintenance;\n            vm.club.plane.insurance = vm.plane_insurance;\n            vm.club.plane.noise_cert = vm.plane_noise;\n            vm.club.plane.radio_licence= vm.plane_radio;\n\n            vm.club.plane.vp = (vm.club.plane.vp)? 1:0;\n            vm.club.plane.rg = (vm.club.plane.rg)? 1:0; \n            vm.club.plane.tb = (vm.club.plane.tb)? 1:0; \n\n            vm.club.plane.engine_1 = vm.plane_engine_1;\n            vm.club.plane.engine_2 = vm.plane_engine_2;\n            vm.club.plane.propeller_1 = vm.plane_propeller_1;\n            vm.club.plane.propeller_2 = vm.plane_propeller_2;\n\n\n            if(vm.club.plane.colour && vm.club.plane.colour !== \"\" && vm.club.plane.colour.indexOf(\"rgba\") == -1){\n                vm.club.plane.colour = hexToRGBA(vm.club.plane.colour, 0.75);\n            } \n\n            if(vm.club.plane.bg_colour && vm.club.plane.bg_colour !== \"\" && vm.club.plane.bg_colour.indexOf(\"rgba\") == -1){\n                vm.club.plane.bg_colour = hexToRGBA(vm.club.plane.bg_colour, 0.25);\n            } \n\n\n            //return false;\n            //console.log(\"PLANE TO ADD, \", vm.club.plane);\n            //return false;\n            PlaneService.Create(vm.club.plane)\n                .then(function(data){\n                    ////console.log(data);\n                    $state.go('dashboard.manage_club.planes', {reload: true});\n\n                });\n        }\n\n        $scope.delete = function(){\n            //console.log(\"CLICK\");\n            ToastService.warning('Delete Plane', 'Are you sure you would like to delete this plane?');\n            PlaneService.Update(vm.club.plane)\n                .then(function(data){\n                    //console.log(data);\n                });\n        }\n\n        function get_update_docs(){\n            var documents = [];\n\n            for(var i=0;i<update_this_file.length;i++){\n                var id = update_this_file[i];\n                //console.log(\"looking for : \", id);\n                //console.log(\"in: \", vm.plane_documents);\n\n                for(var k=0;k<vm.club.plane.plane_documents.length;k++){\n                    //console.log(\"comparing to : \", vm.club.plane.plane_documents[k].id);\n                    if(vm.club.plane.plane_documents[k].id == id){\n                        documents.push(vm.club.plane.plane_documents[k]);\n                    }\n                }\n\n            }\n\n            // //console.log(\"DOCS TO UPDATE : \", documents);\n\n            return documents;\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n            vm.club.plane.club_id = vm.club_id;\n            vm.club.plane.add_documents = vm.plane_documents;\n\n            vm.club.plane.update_documents = get_update_docs();\n            //get_update_docs();\n\n            if(vm.club.plane.colour && vm.club.plane.colour !== \"\" && vm.club.plane.colour.indexOf(\"rgba\") == -1){\n                vm.club.plane.colour = hexToRGBA(vm.club.plane.colour, 0.75);\n            } \n\n            if(vm.club.plane.bg_colour && vm.club.plane.bg_colour !== \"\" && vm.club.plane.bg_colour.indexOf(\"rgba\") == -1){\n                vm.club.plane.bg_colour = hexToRGBA(vm.club.plane.bg_colour, 0.25);\n            } \n\n            PlaneService.Update(vm.club.plane)\n                .then(function(data){\n                    //console.log(data);\n                    //console.log(\"saved\");\n                    $state.go('dashboard.manage_club.planes');\n                });\n        }\n\n        vm.save_new_aircraft_bit = function(item, num){\n            \n            // console.log(item);\n            // console.log(num);\n\n            //this assumes there was an engine and prop already saved\n\n\n            var comb = \"plane_\"+item+\"_\"+num;\n            var comb2 = \"plane_\"+item+\"_\"+num+\"_replace\";\n\n            var item_update = {};\n            \n            if(vm[comb] && vm[comb] !== \"\"){\n                //only if there is one set --> FIRST!!!\n                vm[comb].removed_date = vm[comb2].removed_date;\n                delete(vm[comb2].removed_date);\n\n                item_update = {\n                    old_item: vm[comb],\n                    new_item: vm[comb2],\n                    plane_id: vm.club.plane.id,\n                    item: item,\n                    no: num\n                };\n            } else {\n                item_update = {\n                    old_item: {},\n                    new_item: vm[comb2],\n                    plane_id: vm.club.plane.id,\n                    item: item,\n                    no: num\n                };\n            }\n\n            \n\n            // if(item == \"engine\"){\n            //     if(num == 1){\n                    \n            //         console.log( \"engine\", vm );\n            //         console.log( \"engine\", vm.plane_engine_1 );\n            //         console.log( \"engine\", vm.plane_engine_1.removed_date );\n            //         console.log( \"engine\", vm.plane_engine_1_replace );\n            //         console.log( \"engine\", vm.plane_engine_1_replace.removed_date );\n\n            //         vm.plane_engine_1.removed_date = vm.plane_engine_1_replace.removed_date;\n            //         delete(vm.plane_engine_1_replace.removed_date);\n            //         item_update.old_item = vm.plane_engine_1;\n            //         item_update.new_item = vm.plane_engine_1_replace;\n\n            //     } else if(num == 2){\n            //         vm.plane_engine_2.removed_date = vm.plane_engine_2_replace.removed_date;\n            //         delete(vm.plane_engine_2_replace.removed_date);\n            //         item_update.old_item = vm.plane_engine_2;\n            //         item_update.new_item = vm.plane_engine_2_replace;\n            //     }\n            // } else if(item == \"propeller\"){\n            //     if(num == 1){\n            //         vm.plane_propeller_1.removed_date = vm.plane_engine_1_replace.removed_date;\n            //         delete(vm.plane_engine_1_replace.removed_date);\n            //         item_update.old_item = vm.plane_propeller_1;\n            //         item_update.new_item = vm.plane_engine_1_replace;\n            //     } else if(num == 2){\n            //         vm.plane_propeller_2.removed_date = vm.plane_engine_2_replace.removed_date;\n            //         delete(vm.plane_engine_2_replace.removed_date);\n            //         item_update.old_item = vm.plane_propeller_2;\n            //         item_update.new_item = vm.plane_engine_2_replace;\n            //     }\n            // }\n\n           \n            console.log(\"LETS SEE WHAT WOULD BE SENT\", item_update);\n\n\n            PlaneService.UpdateAircraftBit(item_update)\n                .then(function(data){\n                    console.log(data);\n                    //console.log(\"saved\");\n                    $state.go('dashboard.manage_club.planes');\n                });\n\n        }\n\n\n        function containsObject(obj, list, params) {\n\n            // //console.log(\"obj\", obj);\n            // //console.log(\"list\", list);\n            // //console.log(\"params\", params);\n\n            for(var i=0; i<list.length; i++) {\n                // //console.log(\"list i : \", list[i]);\n                // //console.log(\"obj is: \", obj);\n\n                var count_success = 0;\n                for(var j=0;j<params.length;j++){\n                    if(list[i][params[j]] && obj[params[j]] && list[i][params[j]] == obj[params[j]]){\n                        count_success++;\n                    }\n                }\n\n                if(count_success === params.length) {                    \n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n\n        function check_all(){\n\n            //maybe a nice to have one day... not yet though.\n\n\n            //licences\n            vm.club.plane.requirements.licence.forEach(function(obj){\n\n            });\n\n        }\n\n      \n\n\n        $scope.add_item = function(type){\n            //console.log(\"ADD\");\n            switch(type){\n                case \"licence\":\n                    //console.log(\"licence\");\n                    if(vm.temporary.licence && vm.temporary.licence !== \"\" && vm.temporary.rating && vm.temporary.rating !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_licence = {\n                            licence_id: vm.temporary.licence.id,\n                            licence_title: vm.temporary.licence.abbreviation,\n                            rating_title: vm.temporary.rating.abbreviation,\n                            rating_id: vm.temporary.rating.id\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_licence, vm.club.plane.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n                            vm.club.plane.requirements.licence.push(add_licence);\n                        }\n\n                        delete vm.temporary.licence;\n                        delete vm.temporary.rating;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a licence and rating that is required to book the plane solo!');\n                    }\n\n                break;\n\n\n                case \"medical\":\n                    //console.log(\"medical\");\n                    if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_medical = {\n                            authority_id: vm.temporary.medical_authority.id,\n                            authority_title: vm.temporary.medical_authority.abbreviation,\n                            medical_component_id: vm.temporary.medical_component.id,\n                            medical_component_title: vm.temporary.medical_component.title\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_medical, vm.club.plane.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n                            vm.club.plane.requirements.medical.push(add_medical);\n                        }\n\n                        delete vm.temporary.medical_authority;\n                        delete vm.temporary.medical_component;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a medical that is required to book the plane solo!');\n                    }\n\n                break;\n\n\n                case \"differences\":\n                    //console.log(\"difference\");\n                    if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_difference = {\n                            difference_id: vm.temporary.difference.id,\n                            difference_title: vm.temporary.difference.title\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_difference, vm.club.plane.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n                            vm.club.plane.requirements.differences.push(add_difference);\n                        }\n\n                        delete vm.temporary.difference;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a difference that is required to book the plane solo!');\n                    }\n\n                break;\n\n\n            }\n\n\n\n        }\n\n\n        $scope.remove_item = function(type, index){\n            //console.log(\"REMOVE\");\n\n            vm.club.plane.requirements[type].splice(index, 1);\n\n\n            // switch(type){\n            //     case \"licence\":\n            //             //console.log(\"licence\");\n                   \n            //             //check if it doesnt exist first...\n            //             // if(containsObject(add_licence, vm.club.plane.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n            //             //     vm.club.plane.requirements.licence.push(add_licence);\n            //             // }\n\n            //             vm.club.plane.requirements.licence.splice(index, 1);\n                      \n                   \n\n            //     break;\n\n\n            //     case \"medical\":\n            //         //console.log(\"medical\");\n            //         if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_medical = {\n            //                 authority_id: vm.temporary.medical_authority.id,\n            //                 authority_title: vm.temporary.medical_authority.abbreviation,\n            //                 medical_component_id: vm.temporary.medical_component.id,\n            //                 medical_component_title: vm.temporary.medical_component.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_medical, vm.club.plane.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n            //                 vm.club.plane.requirements.medical.push(add_medical);\n            //             }\n\n            //             delete vm.temporary.medical_authority;\n            //             delete vm.temporary.medical_component;\n\n            //         } else {\n            //             alert(\"Please select a medical that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            //     case \"differences\":\n            //         //console.log(\"difference\");\n            //         if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_difference = {\n            //                 difference_id: vm.temporary.difference.id,\n            //                 difference_title: vm.temporary.difference.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_difference, vm.club.plane.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n            //                 vm.club.plane.requirements.differences.push(add_difference);\n            //             }\n\n            //             delete vm.temporary.difference;\n\n            //         } else {\n            //             alert(\"Please select a difference that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            // }\n\n\n\n        }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        $scope.update_this_file = function(file){\n            //console.log(\"==== update is : \", file.id);\n            if(update_this_file.indexOf(file.id) === -1){\n                update_this_file.push(file.id)\n            } else {\n               ////console.log(\"This item already exists\"); \n            } \n        }\n\n\n         $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.club.plane.plane_documents = $.grep(vm.club.plane.plane_documents, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                PlaneDocumentService.Delete(vm.user_id, file.id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n\n\n        vm.files = {\n            radio: [],\n            cert: [],\n            insurance: [],\n            noise: []\n        }\n\n\n           $scope.processFile = function(files, location){\n                 //console.log(\"files\", files[0].file_return);\n\n                     // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[0].file_return);\n                     ////console.log(\"PARSED\", j);\n                    // //console.log(\"J is : \",j);\n                    // //console.log(\"name is : \", j.files.file.name);\n\n                    files[0].file.temp_path = j.saved_url;\n                    files[0].file.save_name = j.files.file.name;\n\n                    var ft = j.files.file.name;\n                    //console.log(\"ft\", ft);\n                    var fft = ft.split('.').pop();\n                    files[0].file.extension = fft;\n                    //console.log(\"FILE is : \", files[0]);\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.files[location].push(files[0].file);\n\n\n            }\n\n            $scope.set_title = function(file){\n                //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            //console.log(\"REMOVE: \", j);\n            //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            PoidService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n          // $scope.$on('flow::fileAdded', function (event, $flow, flowFile) {\n          //     event.preventDefault();//prevent file from uploading\n          //     //console.log(\"FILE ADDED\");\n          //     //console.log($flow);\n          //   });\n\n            $scope.processFiles = function(files){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    //console.log(\"J is : \",j);\n                    //console.log(\"name is : \", j.files.file.name);\n\n                    files[i].file.temp_path = j.saved_url;\n                    files[i].file.save_name = j.files.file.name;\n                    var ft = j.files.file.name;\n                    ft = ft.split('.').pop();\n                    files[i].file.extension = ft;\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.plane_documents.push(files[i].file);\n                }\n\n\n            }\n\n            $scope.set_title = function(file){\n                //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            $scope.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n\n            $scope.delete_poid = function(id){\n\n              \n                var a = prompt(\"Are you sure you wish to delete this poid? \\n\\n This change is irreversible! To confirm please type YES in the box below.\");\n                if(a == \"YES\"){\n\n\n                    //console.log(\"WE DELETE IT\");\n\n\n                    // PoidService.Delete(vm.user_id, id)\n                    //     .then(function (data) {\n                    //         //console.log(data);\n                    //         if(data.success){\n                    //             //console.log(\"HUZZAH\", data);\n                    //             //then we need to remove this from the list of files...\n                    //             vm.user_poids = $.grep(vm.user_poids, function(e){ \n                    //                 return e.id != id; \n                    //             });\n                                \n                    //             //refresh?\n                    //             $state.reload();\n                    //             $state.go('dashboard.my_account.poid');\n\n                    //         } else {\n\n                    //             alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n                    //         }\n\n                    //     });\n\n\n\n                } else {\n                    //console.log(\"ignore123\");\n                }\n\n\n            }\n\n\n\n\n            $scope.save_plane_documents = function(){\n\n               \n              \n\n                //console.log(\"plane_documents: \", vm.plane_documents);\n\n\n                //compile the required elements YAY\n\n                //console.log(\"plane_document \", vm.plane_document);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n                    // for(var i=0;i<vm.plane_document.images.length;i++){\n                    //     delete vm.plane_document.images[i].data_uri;\n                    // }\n\n                    // // vm.plane_document.images = vm.plane_documents;\n                    // vm.plane_document.images = vm.plane_document.images.concat(vm.plane_documents);\n                    // vm.plane_document.user_id = vm.user_id;\n\n\n\n\n            //     if(vm.plane_document.id){\n            //         //then its an udpate\n\n            //         //merge the images left?\n            //         PoidService.Update(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                     $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n            //     } else {\n\n\n                   \n\n\n            //         //then its a create\n            //         //console.log(vm.plane_document);\n\n            //         PoidService.Create(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                    // $state.reload();\n            //                    // $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n\n            //     }\n\n\n\n             };\n\n\n\n\n             $scope.change_file_name = function(file){\n                \n                //this is terribly ineficient... unfortunately... can't \n                //work out how else to do it! (lol)\n\n                // //console.log(\"TO BE CHANGED\", file);\n\n                // //console.log(\"BEFORE BEFORE\", vm.plane_documents);\n\n                vm.plane_documents = $.grep(vm.plane_documents, function(e){ \n                    return e.temp_path != file.temp_path; \n                });\n\n                // //console.log(\"BEFORE\", vm.plane_documents);\n\n                vm.plane_documents.push(file);\n\n                // //console.log(\"AFTER\", vm.plane_documents);\n\n             }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n          var warning_msg = \"By deleting this plane, you will also cancel all reservations that this plane currently has.\"\n\n          // $scope.open = function (plane_id) {\n          //   var modalInstance = $uibModal.open({\n          //     animation: true,\n          //     templateUrl: 'views/modals/deleteModal.html',\n          //     controller: 'ModalInstanceCtrl',\n          //     //params: {},\n          //     size: \"lg\",\n          //     resolve: {\n          //       id: function () {\n          //         return plane_id;\n          //       },\n          //       warning: function(){\n          //           return warning_msg;\n          //       }\n          //     }\n          //   });\n          //   modalInstance.result.then(function (plane_id) {\n          //     $log.info('PRESSED GO: '+plane_id);\n          //     PlaneService.Delete(plane_id)\n          //     .then(function(){\n          //       //console.log(\"HELLO DELETE\");\n          //       //update view?\n          //        vm.club.planes = $.grep(vm.club.planes, function(e){ \n          //           return e.plane_id != plane_id; \n          //       });\n          //     })\n          //   }, function () {\n          //     $log.info('Modal dismissed at: ' + new Date());\n          //   });\n          // };\n\n            $scope.open = function (club_plane_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return club_plane_id;\n                },\n                params: function() {\n                  return {id: club_plane_id};\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (plane) {\n                var id = plane.id;\n              $log.info('PRESSED GO: ', id);\n              \n              PlaneService.Delete(id)\n              .then(function(){\n                //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.planes = $.grep(vm.club.planes, function(e){ \n                    return e.id != id; \n                });\n             });\n\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n\n\n          };\n         \n\n         vm.aircraft;\n         vm.plane_search;\n         vm.plane_to_add;\n\n         $scope.get_aircraft = function(registration){\n\n            if(registration.length > 3){\n\n                 PlaneService.GetAddAircraft(registration)\n                .then(function (data) {\n                    ////console.log(data);\n                    if(data){\n                        //use GB airfields first...\n                         \n                        // vm.aircraft = data;\n                        // console.log(\"one is : \", data[0]);\n                       \n                         if(data.length == 0){\n                            // console.log(\"SETTINGS HERE\");\n                              vm.aircraft = [\n                                    {\n                                        icao_type: \"not known\",\n                                        registration: registration.toUpperCase()\n                                    }];\n                        } else {\n                            vm.aircraft = data;\n                        }\n\n                    } else {\n\n                          vm.aircraft = [\n                                    {\n                                        icao_type: \"not known\",\n                                        registration: registration.toUpperCase()\n                                    }];\n\n                                    //console.log(vm.aircraft);\n                        // console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n            }\n\n            \n        }\n\n\n    }\n app.controller('DashboardClubPropellerLogbookController', DashboardClubPropellerLogbookController);\n\n    DashboardClubPropellerLogbookController.$inject = ['UserService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'LicenceService', 'MedicalService', 'DifferencesService', 'PlaneDocumentService', '$http', 'ToastService', 'LogbookLinkService', 'WorkpackService'];\n    function DashboardClubPropellerLogbookController(UserService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, LicenceService, MedicalService, DifferencesService, PlaneDocumentService, $http, ToastService, LogbookLinkService, WorkpackService) {\n        var vm = this;\n\n       \n        \n        switch(vm.action){\n            case \"add\":\n                // //console.log(\"adding a new plane please\");\n                vm.page_title = \"Add a New Plane\";\n            break;\n            case \"edit\":\n                // //console.log(\"edit an existing plane\");\n                \n                PlaneService.GetByIdMaintenance2($stateParams.plane_id, vm.club_id)\n                    .then(function(data){\n                        vm.club.plane = data;  \n                        vm.this_plane_id = $stateParams.plane_id; \n\n                        if(vm.club.plane && vm.club.plane.maintenance){\n                            //console.log(\"vm.club.plane == > \", vm.club.plane);\n                            vm.obj.hours_remaining = vm.club.plane.maintenance.hours_remaining;\n                            vm.obj.next_check = new Date(vm.club.plane.maintenance.next_maintenance);\n                            vm.obj.check_date = new Date();\n                            vm.obj.extension_granted = new Date();\n                        }\n                       \n\n                        // vm.club.plane.requirements = {\n                        //         licence: [],\n                        //         medical: [],\n                        //         differences: [],\n                        //         hours: []\n                        // };\n                        // //console.log(\"BOOOO - get all planes....\");\n                        vm.page_title = \"Edit a Plane Maintenance - \"+vm.club.plane.registration;\n                    });\n\n                PlaneService.GetOpenIssues($stateParams.plane_id)\n                    .then(function (data) {\n                            ////console.log(\"data is : \", data);\n                           vm.reported_defects = data;\n                        });\n\n\n               \n\n\n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                // PlaneService.GetAllByClubMaintenance(vm.club_id)\n                //     .then(function(data){\n                //         vm.club.planes = data;   \n                //         // //console.log(vm.club.planes);\n                //     });\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n       \n\n        $scope.get_hours_from_decimal = function(time){\n\n            if(time){\n                 var sign = time < 0 ? \"-\" : \"\";\n                 var hour = Math.floor(Math.abs(time));\n                 var min = Math.round((Math.abs(time) * 60) % 60);\n                 if(min == 60){\n                     hour++;\n                     min = 0;\n                 }\n                 return sign + (hour < 10 ? \"0\" : \"\") + hour + \":\" + (min < 10 ? \"0\" : \"\") + min;\n             } else {\n                 return \"N/A\";\n             }\n            \n\n        }\n\n        vm.prop_no = \"\";\n\n        // PlaneService.GetAircraftJourneyLogs($stateParams.plane_id, 0, 25)\n        //     .then(function (data) {\n        //             // //console.log(\"ALL is : \", data);\n        //            // vm.logs = data.logs;\n        //            vm.aircraft = data.aircraft;\n        //            if(vm.aircraft.propeller_2_id > 0){\n\n        //                    // console.log(vm.aircraft);\n\n        //                if(vm.aircraft.propeller_2_id == $stateParams.prop_id){\n        //                    // console.log(\"show 2\");\n        //                    vm.prop_no = \"2\";\n        //                } else {\n        //                    // console.log(\"show 1\");\n        //                    vm.prop_no = \"1\";\n        //                }\n        //            }\n\n\n        //         });\n\n\n            PlaneService.GetPropLogs($stateParams.prop_id, $stateParams.plane_id, 0, 25)\n            .then(function (data) {\n                    // //console.log(\"ALL is : \", data);\n                   vm.logs = data.logs;\n                   vm.propeller = data.propeller;\n\n\n                });\n\n            vm.current_offset = 0;\n            vm.loaded_per_batch = 25;\n            vm.all_loaded = false;\n\n            vm.load_more = function(){\n                vm.current_offset = vm.current_offset + vm.loaded_per_batch;\n                PlaneService.GetPropLogs($stateParams.prop_id,$stateParams.plane_id, vm.current_offset, vm.loaded_per_batch)\n                .then(function (data) {\n                        // //console.log(\"ALL is : \", data);\n                        if(data.logs.length > 0){\n                            data.logs.forEach(log => vm.logs.push(log));\n                        } else {\n                            vm.all_loaded = true;\n                        }\n                       //vm.logs = data.logs;\n                       vm.propeller = data.propeller;\n\n\n                    });\n\n            }\n\n            vm.get_initial = function(text){\n                return text.charAt(0);\n            }\n\n\n            vm.clean_times = function(time){\n                if(time == \"00:00:00\"){\n                    return \" - \";\n                }\n                return time.substring(0,5);\n            }\n\n            //  Maintenance entry helpers \n\n            vm.maintenanceTypeLabels = {\n                '50hour': '50-Hour Check',\n                '100hour': '100-Hour Check',\n                '150hour': '150-Hour Check',\n                '25hours': '25-Hour Check',\n                '50hours': '50-Hour Check',\n                '100hours': '100-Hour Check',\n                'annual': 'Annual Inspection',\n                'cofa': 'Certificate of Airworthiness',\n                'arc': 'Airworthiness Review Certificate',\n                'engine_overhaul': 'Engine Overhaul',\n                'propeller_overhaul': 'Propeller Overhaul',\n                'interim': 'Interim Inspection',\n                '6months': '6-Month Check',\n                'extension': 'Extension',\n                'workpack': 'Workpack',\n                'other': 'Other Maintenance'\n            };\n\n            vm.formatMaintenanceType = function(type) {\n                return vm.maintenanceTypeLabels[type] || type || 'Maintenance';\n            };\n\n            vm.isMaintenanceEntry = function(log) {\n                return (log.entry_type === 'maintenance_check');\n            };\n\n            vm.getEntryType = function(log) {\n                return log.entry_type || 'flight';\n            };\n\n            vm.getEntryPosition = function(log) {\n                return log.entry_position || 'full_day';\n            };\n\n            vm.getHoursRemainingClass = function(hoursRemaining) {\n                if (hoursRemaining === null || hoursRemaining === undefined) return '';\n                if (hoursRemaining <= 5) return 'hours-critical';\n                if (hoursRemaining <= 10) return 'hours-warning';\n                return '';\n            };\n\n            vm.formatHoursRemaining = function(hoursRemaining) {\n                if (hoursRemaining === null || hoursRemaining === undefined) return 'N/A';\n                return hoursRemaining.toFixed(2) + ' hrs';\n            };\n\n            //  Maintenance check detail panel \n            vm.selected_check = null;\n            vm.show_check_detail = false;\n            vm.check_logbook_links = [];\n            vm.check_logbook_loading = false;\n            vm.check_logbook_error = false;\n            vm.check_workpack = null;\n            vm.check_workpack_loading = false;\n\n            vm.viewMaintenanceCheck = function(log) {\n                if (!vm.isMaintenanceEntry(log)) return;\n                vm.selected_check = log;\n                vm.show_check_detail = true;\n\n                // Reset state\n                vm.check_logbook_links = [];\n                vm.check_logbook_error = false;\n                vm.check_workpack = null;\n\n                var checkData = log.maintenance_check || {};\n                var checkId = checkData.id || log.maintenance_check_id || null;\n                if (checkId) {\n                    vm.loadCheckLogbookLinks(checkId);\n                    vm.loadCheckWorkpack(log);\n                }\n            };\n\n            vm.closeMaintenanceCheck = function() {\n                vm.selected_check = null;\n                vm.show_check_detail = false;\n                vm.check_logbook_links = [];\n                vm.check_logbook_error = false;\n                vm.check_workpack = null;\n            };\n\n            // Load logbook associations for a maintenance check.\n            vm.loadCheckLogbookLinks = function(maintenance_check_id) {\n                if (!maintenance_check_id) return;\n                vm.check_logbook_loading = true;\n                vm.check_logbook_error = false;\n                vm.check_logbook_links = [];\n\n                LogbookLinkService.GetAvailableLogbooks($stateParams.plane_id)\n                    .then(function(availData) {\n                        var available = (availData && availData.available_logbooks) ? availData.available_logbooks : [];\n                        if (available.length === 0) {\n                            vm.check_logbook_loading = false;\n                            vm.check_logbook_error = true;\n                            return;\n                        }\n\n                        LogbookLinkService.GetLinks(maintenance_check_id)\n                            .then(function(linkData) {\n                                vm.check_logbook_loading = false;\n                                var links = [];\n                                if (linkData && linkData.maintenance_check && linkData.maintenance_check.logbook_links) {\n                                    links = linkData.maintenance_check.logbook_links;\n                                }\n                                // Build list: each available logbook with isLinked flag\n                                vm.check_logbook_links = available.map(function(lb) {\n                                    var isLinked = links.some(function(link) {\n                                        return link.logbook_type === lb.logbook_type &&\n                                               link.logbook_entity_id == lb.logbook_entity_id;\n                                    });\n                                    return {\n                                        logbook_type: lb.logbook_type,\n                                        logbook_entity_id: lb.logbook_entity_id,\n                                        label: lb.label,\n                                        position: lb.position || null,\n                                        isLinked: isLinked\n                                    };\n                                });\n                            }, function() {\n                                vm.check_logbook_loading = false;\n                                vm.check_logbook_error = true;\n                            });\n                    }, function() {\n                        vm.check_logbook_loading = false;\n                        vm.check_logbook_error = true;\n                    });\n            };\n\n            // Load linked workpack detail\n            vm.loadCheckWorkpack = function(log) {\n                var d = log.maintenance_check || {};\n                var wpId = d.linked_workpack_id || d.workpack_id || null;\n                if (!wpId) return;\n                vm.check_workpack_loading = true;\n                WorkpackService.GetById(wpId)\n                    .then(function(data) {\n                        vm.check_workpack_loading = false;\n                        if (data && data.workpack) {\n                            vm.check_workpack = data.workpack;\n                        }\n                    }, function() {\n                        vm.check_workpack_loading = false;\n                    });\n            };\n\n            vm.downloadWorkpackDocument = function(filename) {\n                if (!filename) return;\n                $http.get('/api/v1/maintenance_workpacks/file/' + filename, {\n                    responseType: 'arraybuffer'\n                }).success(function(data, status, headers) {\n                    var blob = new Blob([data], { type: 'application/pdf' });\n                    var fileURL = URL.createObjectURL(blob);\n                    var prntWin = window.open();\n                    prntWin.document.write('<html><head><title>Workpack Document</title></head><body>'\n                        + '<embed width=\"100%\" height=\"100%\" name=\"plugin\" src=\"' + fileURL + '\" '\n                        + 'type=\"application/pdf\" internalinstanceid=\"21\"></body></html>');\n                    prntWin.document.close();\n                }).error(function() {\n                    ToastService.error('Download Error', 'There was an error downloading the workpack document.');\n                });\n            };\n\n            vm.getLogbookIcon = function(type) {\n                switch (type) {\n                    case 'airframe': return 'fa-plane';\n                    case 'engine': return 'fa-cog';\n                    case 'propeller': return 'fa-refresh';\n                    default: return 'fa-book';\n                }\n            };\n\n            vm.getCheckTypeIcon = function(type) {\n                if (!type) return 'fa-wrench';\n                switch (type.toLowerCase()) {\n                    case 'annual': return 'fa-calendar-check-o';\n                    case '50hours': case '50hour': case '25hours': case '100hours': case '100hour': case '150hour': return 'fa-tachometer';\n                    case 'extension': return 'fa-clock-o';\n                    case 'interim': return 'fa-cogs';\n                    case '6months': return 'fa-calendar';\n                    case 'cofa': case 'arc': return 'fa-certificate';\n                    case 'engine_overhaul': return 'fa-cog';\n                    case 'propeller_overhaul': return 'fa-repeat';\n                    case 'workpack': return 'fa-briefcase';\n                    default: return 'fa-wrench';\n                }\n            };\n\n            vm.update_logbooks = function(){\n                \n\n                PlaneService.UpdateAircraftLogbooks($stateParams.plane_id)\n                .then(function (data) {\n                        \n                        if(data.success){\n\n                           PlaneService.GetPropLogs($stateParams.prop_id, $stateParams.plane_id, 0, 25)\n                            .then(function (data) {\n                                    // //console.log(\"ALL is : \", data);\n                                   vm.logs = data.logs;\n                                   vm.propeller = data.propeller;\n\n\n                                });\n\n                        }\n\n\n                    });\n            }\n\n\n\n        $scope.update_this_file = function(file){\n            //console.log(\"==== update is : \", file.id);\n            if(update_this_file.indexOf(file.id) === -1){\n                update_this_file.push(file.id)\n            } else {\n               ////console.log(\"This item already exists\"); \n            } \n        }\n\n\n         $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.club.plane.plane_documents = $.grep(vm.club.plane.plane_documents, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                PlaneDocumentService.Delete(vm.user_id, file.id)\n                .then(function (data) {\n                    // //console.log(data);\n                    if(data.success){\n                        // //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            // //console.log(\"REMOVE: \", j);\n            // //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n\n            //this SHOULD BE TO THE CURRENT POSITION\n\n            // PoidService.DeleteTmp(j.saved_url)\n            //     .then(function (data) {\n            //         //console.log(data);\n            //         if(data.success){\n            //             //console.log(\"HUZZAH\", current_files);\n            //             //then we need to remove this from the list of files...\n            //             //clear files\n            //             vm.plane_documents = [];\n            //             //and re-process available files\n            //             $scope.processFiles(current_files);\n\n            //         } else {\n            //             //console.log(\"WOOOPSIES...\");\n            //             //this should be very very rare...\n            //         }\n\n            //     });\n\n          }\n          \n\n          // $scope.$on('flow::fileAdded', function (event, $flow, flowFile) {\n          //     event.preventDefault();//prevent file from uploading\n          //     //console.log(\"FILE ADDED\");\n          //     //console.log($flow);\n          //   });\n\n            vm.files = {\n                radio: [],\n                cert: [],\n                insurance: []\n            }\n\n\n            $scope.processFiles = function(files, location){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    // //console.log(\"J is : \",j);\n                    // //console.log(\"name is : \", j.files.file.name);\n\n                    files[i].file.temp_path = j.saved_url;\n                    files[i].file.save_name = j.files.file.name;\n                    var ft = j.files.file.name;\n                    ft = ft.split('.').pop();\n                    files[i].file.extension = ft;\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.files[location].push(files[i].file);\n                }\n\n\n            }\n\n\n             $scope.processFile = function(files, location){\n                 //console.log(\"files\", files[0].file_return);\n\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[0].file_return);\n                    // //console.log(\"PARSED\", j);\n                    // //console.log(\"J is : \",j);\n                    // //console.log(\"name is : \", j.files.file.name);\n\n                    files[0].file.temp_path = j.saved_url;\n                    files[0].file.save_name = j.files.file.name;\n\n                    var ft = j.files.file.name;\n                    // //console.log(\"ft\", ft);\n                    var fft = ft.split('.').pop();\n                    files[0].file.extension = fft;\n                    // //console.log(\"FILE is : \", files[0]);\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.files[location].push(files[0]);\n\n\n            }\n\n            $scope.set_title = function(file){\n                // //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            $scope.get_icon2 = function(file){\n                ////console.log(\"FILE\", file);\n                if(!file || file == \"\"){\n                    return \"\";\n                }\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            vm.defect_severity;\n                vm.defect_severities = [\n                    { title: \"No Fly Item - Ground the plane\"},\n                    { title: \"Flyable - needs to be checked at next maintenance\"},\n                    { title: \"Not urgent - but needs noting\"},\n                    { title: \"Unsure of severity\"}\n                ]; \n\n\n            $scope.delete_poid = function(id){\n\n              \n                var a = prompt(\"Are you sure you wish to delete this poid? \\n\\n This change is irreversible! To confirm please type YES in the box below.\");\n                if(a == \"YES\"){\n\n\n                    //console.log(\"WE DELETE IT\");\n\n\n                    // PoidService.Delete(vm.user_id, id)\n                    //     .then(function (data) {\n                    //         //console.log(data);\n                    //         if(data.success){\n                    //             //console.log(\"HUZZAH\", data);\n                    //             //then we need to remove this from the list of files...\n                    //             vm.user_poids = $.grep(vm.user_poids, function(e){ \n                    //                 return e.id != id; \n                    //             });\n                                \n                    //             //refresh?\n                    //             $state.reload();\n                    //             $state.go('dashboard.my_account.poid');\n\n                    //         } else {\n\n                    //             alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n                    //         }\n\n                    //     });\n\n\n\n                } else {\n                    //console.log(\"ignore123\");\n                }\n\n\n            }\n\n\n\n\n            $scope.save_plane_documents = function(){\n\n               \n              \n\n                // //console.log(\"plane_documents: \", vm.plane_documents);\n\n\n                //compile the required elements YAY\n\n                // //console.log(\"plane_document \", vm.plane_document);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n                    // for(var i=0;i<vm.plane_document.images.length;i++){\n                    //     delete vm.plane_document.images[i].data_uri;\n                    // }\n\n                    // // vm.plane_document.images = vm.plane_documents;\n                    // vm.plane_document.images = vm.plane_document.images.concat(vm.plane_documents);\n                    // vm.plane_document.user_id = vm.user_id;\n\n\n\n\n            //     if(vm.plane_document.id){\n            //         //then its an udpate\n\n            //         //merge the images left?\n            //         PoidService.Update(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                     $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n            //     } else {\n\n\n                   \n\n\n            //         //then its a create\n            //         //console.log(vm.plane_document);\n\n            //         PoidService.Create(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                    // $state.reload();\n            //                    // $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n\n            //     }\n\n\n\n             };\n\n\n\n\n             $scope.change_file_name = function(file){\n                \n                //this is terribly ineficient... unfortunately... can't \n                //work out how else to do it! (lol)\n\n                // //console.log(\"TO BE CHANGED\", file);\n\n                // //console.log(\"BEFORE BEFORE\", vm.plane_documents);\n\n                vm.plane_documents = $.grep(vm.plane_documents, function(e){ \n                    return e.temp_path != file.temp_path; \n                });\n\n                // //console.log(\"BEFORE\", vm.plane_documents);\n\n                vm.plane_documents.push(file);\n\n                // //console.log(\"AFTER\", vm.plane_documents);\n\n             }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n          //var warning_msg = \"By deleting this plane, you will also cancel all reservations that this plane currently has.\"\n\n          // $scope.open = function (plane_id) {\n          //   var modalInstance = $uibModal.open({\n          //     animation: true,\n          //     templateUrl: 'views/modals/deleteModal.html',\n          //     controller: 'ModalInstanceCtrl',\n          //     //params: {},\n          //     size: \"lg\",\n          //     resolve: {\n          //       id: function () {\n          //         return plane_id;\n          //       },\n          //       warning: function(){\n          //           return warning_msg;\n          //       }\n          //     }\n          //   });\n          //   modalInstance.result.then(function (plane_id) {\n          //     $log.info('PRESSED GO: '+plane_id);\n          //     PlaneService.Delete(plane_id)\n          //     .then(function(){\n          //       //console.log(\"HELLO DELETE\");\n          //       //update view?\n          //        vm.club.planes = $.grep(vm.club.planes, function(e){ \n          //           return e.plane_id != plane_id; \n          //       });\n          //     })\n          //   }, function () {\n          //     $log.info('Modal dismissed at: ' + new Date());\n          //   });\n          // };\n\n            $scope.open = function (club_plane_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return club_plane_id;\n                },\n                params: function() {\n                  return {id: club_plane_id};\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (plane) {\n                var id = plane.id;\n              $log.info('PRESSED GO: ', id);\n              \n              PlaneService.Delete(id)\n              .then(function(){\n                // //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.planes = $.grep(vm.club.planes, function(e){ \n                    return e.id != id; \n                });\n             });\n\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n\n\n          };\n         \n          \n\n\n        //   $scope.downloadCertificate = function(doc) {\n        //     var data = $.param({\n        //         id: doc\n        //     });\n\n        //     var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n        //     $http.get('api/v1/plane_certificate/show_file/'+ddd, {\n        //             responseType: 'arraybuffer'\n        //         })\n        //         .success(function(data, status, headers) {\n        //             var zipName = processArrayBufferToBlob(data, headers);\n\n        //             //Delete file from temp folder in server - file needs to remain open until blob is created\n        //             //deleteFileFromServerTemp(zipName);\n        //         }).error(function(data, status) {\n        //             alert(\"There was an error downloading the selected document(s).\");\n        //         })\n        // };\n\n\n        // $scope.downloadInsurance = function(doc) {\n        //     var data = $.param({\n        //         id: doc\n        //     });\n\n        //     var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n        //     $http.get('api/v1/plane_insurance/show_file/'+ddd, {\n        //             responseType: 'arraybuffer'\n        //         })\n        //         .success(function(data, status, headers) {\n        //             var zipName = processArrayBufferToBlob(data, headers);\n\n        //             //Delete file from temp folder in server - file needs to remain open until blob is created\n        //             //deleteFileFromServerTemp(zipName);\n        //         }).error(function(data, status) {\n        //             alert(\"There was an error downloading the selected document(s).\");\n        //         })\n        // };\n\n\n\n\n        $scope.downloadDocument = function(doc, type = 'docs') {\n            var data = $.param({\n                id: doc\n            });\n\n            var controller = \"plane_documents\";\n\n            switch(type){\n                 case \"radio\": \n                    controller = \"plane_radio_licence\";\n                break;\n                 case \"insurance\": \n                    controller = \"plane_insurance\";\n                break;\n                 case \"certificate\": \n                    controller = \"plane_certificate\";\n                break;\n                case \"noise\": \n                    controller = \"plane_noise_certificate\";\n                break;\n                case \"docs\": \n                    controller = \"plane_documents\";\n                break;\n                default:\n                    controller = \"plane_documents\";\n                break;\n\n            }\n\n\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/'+controller+'/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        $scope.downloadClubDocument = function(doc) {\n            var data = $.param({\n                id: doc\n            });\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/club_documents/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        function processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], {\n                    type: contentType\n                });\n                if (navigator.msSaveBlob)\n                    navigator.msSaveBlob(blob, filename);\n                else {\n                    // Try using other saveBlob implementations, if available\n                    var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                    if (saveBlob === undefined) throw \"Not supported\";\n                    saveBlob(blob, filename);\n                }\n                success = true;\n            } catch (ex) {\n                $log.info(\"saveBlob method failed with the following exception:\");\n                $log.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            $log.info(\"Download link method with simulated click failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n\n\n\n        $scope.search2 = function(row){\n            //(angular.lowercase(row.first_name).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)  || (angular.lowercase(row.last_name).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)\n            ////console.log(\"answer\", (angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1));\n            // return ((angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || (angular.lowercase(row.flight_time).indexOf(angular.lowercase($scope.my_search2)) || '') !== -1)));\n            //(angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)\n           \n            // if( (test_date($scope.my_search2, row.flight_date)) || (angular.lowercase(row.destination_airport).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) || (angular.lowercase(row.departure_airport).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) || (angular.lowercase(row.destination_airport_code).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) || (angular.lowercase(row.departure_airport_code).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)){\n            //     return true;\n            // } else {\n            //     return false;\n            // }test_aircraft\n\n            //console.log(\"TEST \" , test_date($scope.my_search2));\n\n            ////console.log($scope.my_search2);\n            if(!$scope.my_search2 || ($scope.my_search2 == \"\")){\n                return true;\n            } else if(test_date($scope.my_search2, row.entry_date)){\n                return true;\n            } else {\n                return false;\n            }\n\n            // we are testing for the date, the pilot, the departure and destination.\n\n            // return (angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1); // ? (angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) : (angular.lowercase(row.flight_time).indexOf(angular.lowercase($scope.my_search2) || '') !== -1);\n\n        };\n\n        function test_date(search, date){\n\n\n            if(search.length < 2){\n                return false;\n            }\n\n            if(search && search.length <= 3){\n                if(date.indexOf(search) > -1){\n                    return true;\n                }\n            } else {\n                var parsed_date = \"\";\n                var b = moment(search);\n                if(b.isValid() && b.format(\"YYYY\") != \"2001\"){\n                    parsed_date = b.format(\"YYYY-MM-DD\");\n                } else if(b.isValid()){\n                    parsed_date = b.format(\"MM-DD\");\n                }\n\n\n                var search_type = 0;\n\n                if(parsed_date !== \"\" && date.indexOf(parsed_date) > -1){\n                    // //console.log(\"found\");\n                    return true;\n                } else {\n\n                    //backup in case of wrong parsing data::;\n                    //european method\n\n                    if(search.length <= 5 && search.length >= 4){\n\n                        var c = moment(search, \"DDMM\");\n                        // //console.log(\"C is : \", c);\n                        if(c.isValid()){\n                            var c2 = c.format(\"MM-DD\");\n                            if(date.indexOf(c2) > -1){\n                                return true;\n                            }\n                        }\n\n                    } else if(search.length == 8 || search.length == 10){\n                        \n                        var c = moment(search, \"DDMMYYYY\");\n                        // //console.log(\"C is : \", c);\n                        if(c.isValid()){\n                            var c2 = c.format(\"YYYY-MM-DD\");\n                            if(date.indexOf(c2) > -1){\n                                return true;\n                            }\n                        }\n\n                    }\n\n                    // //console.log(\"not found\");\n                    return false;\n                }\n            }\n\n        }\n\n        $scope.getMySearchCount = function(str){\n            var docs = str.documents;\n            var total = 0;\n            for(var i=0;i<docs.length;i++){\n                if($scope.search(docs[i])){\n                    total++;\n                }\n            }\n            return total;\n        }\n\n        $scope.getMySearchCount2 = function(str){\n            var charges = str.charges;\n            var total = 0;\n            for(var i=0;i<charges.length;i++){\n                if($scope.search(charges[i])){\n                    total++;\n                }\n            }\n            return total;\n        }\n\n\n    }\n app.controller('DashboardClubReceiptsApprovalController', DashboardClubReceiptsApprovalController);\n\n    DashboardClubReceiptsApprovalController.$inject = ['UserService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'LicenceService', 'MedicalService', 'DifferencesService', 'ItemService', '$sce', 'ToastService'];\n    function DashboardClubReceiptsApprovalController(UserService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, LicenceService, MedicalService, DifferencesService, ItemService, $sce, ToastService) {\n        var vm = this;\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {};\n        vm.page_title = \"\";\n        \n        vm.plane_document = {};\n        vm.plane_documents = [];\n\n        var update_this_file = [];\n        \n        vm.action = $state.current.data.action;\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n        // //console.log(\"club_id : \"+vm.club_id);\n        // //console.log(vm.action);\n        // //console.log($stateParams);\n        // //console.log($stateParams.id);\n        \n        PlaneService.GetCurrencies(vm.club_id)\n         .then(function(data){\n                        vm.currencies = data.currencies;   \n                        vm.club_currency = data.club_currency;\n\n                    });\n\n\n        PlaneService.GetReceiptsApproval(vm.club_id)\n                    .then(function(data){\n                        vm.receipts = data.receipts;   \n                           \n                           //check for modded\n                           vm.receipts.forEach(receipt => {\n                               vm.verify_reimbursement(receipt);\n                           })\n\n                    });\n\n\n        $scope.get_currency = function(iso_code){\n\n           return $.grep(vm.currencies, function(e){ \n                        return e.iso_code == iso_code; \n                    })[0];\n\n        }\n        //'9' needs to refer the the user's account set to manage\n       \n\n        vm.update_price = function(receipt){\n            //console.log(\"change price\", receipt.modified_price);\n            var obj = {\n                modified_price: receipt.modified_price\n            };\n            PlaneService.UpdateReceipt(receipt.id, obj)\n            .then(function(data){\n                //console.log(\"UPDATE ::: \", data);\n\n                //maybe that's where we re-calculate the price?\n\n                vm.verify_reimbursement(receipt);\n\n            });\n        }\n\n        vm.verify_reimbursement = function(receipt){\n            //console.log(\"WE GET HERE VERIFY REIMBURSEMENT\");\n            // receipt.reimbursed_amount = 12.5;\n            // //console.log(\"receipt\", receipt);\n            if(receipt.modified_price && !receipt.modified_currency){\n                receipt.modified_reimbursed_amount = receipt.modified_price;\n                receipt.modified_reimbursed_difference = parseFloat(parseFloat(receipt.modified_reimbursed_amount) - parseFloat(receipt.reimbursed_amount));\n            } else if((!receipt.modified_price || !receipt.modified_currency) || receipt.reimbursement == 0){\n                return false;\n            }\n\n            //console.log(\"WE GET THERE\");\n\n            var receipt = $.grep(vm.receipts, function(e){ \n                        return e.id == receipt.id; \n                    })[0];\n\n            var obj = {\n                club_id: receipt.club_id,\n                currency: (receipt.modified_currency)? receipt.modified_currency : receipt.currency,\n                price: (receipt.modified_price) ? receipt.modified_price : receipt.price,\n                requested_at: receipt.created_at\n            }\n            PlaneService.CheckReimbursement(obj)\n            .then(function(data){\n                ////console.log(\"CHANGE ::: \", data.reimburse.reimbursed_amount);\n\n                //maybe that's where we re-calculate the price?\n                receipt.modified_reimbursed_amount = data.reimburse.reimbursed_amount;\n                receipt.modified_reimbursed_rate = data.reimburse.rate;\n\n                //currency is always the same\n                receipt.modified_reimbursed_difference = parseFloat(parseFloat(receipt.modified_reimbursed_amount) - parseFloat(receipt.reimbursed_amount));\n                if(receipt.modified_reimbursed_difference == 0){\n                    receipt.modified_reimbursed_difference = 0;\n                    // //console.log(\"TOTAL CHANGE IS : \", receipt.modified_reimbursed_difference)\n                }\n                    // //console.log(\"TOTAL CHANGE IS : \", receipt.modified_reimbursed_difference)\n\n            });\n\n\n\n\n        }\n\n\n        vm.modified_reimbursement_tooltip = function(receipt){\n\n            var currency = (receipt.modified_currency) ? receipt.modified_currency : receipt.currency;\n            var price = (receipt.modified_price) ? parseFloat(receipt.modified_price).toFixed(2) : parseFloat(receipt.price).toFixed(2);\n\n            var added_currency = currency+\"\"+parseFloat(price).toFixed(2);\n            if((receipt.modified_currency && (receipt.modified_currency !== receipt.reimbursed_currency)) || (receipt.reimbursed_currency !== receipt.currency) && receipt.modified_reimbursed_rate){\n                //currency was modified\n                var datetime = moment(receipt.created_at).format(\"DD MMM YYYY HH:mm\");\n                added_currency = added_currency+\" which on \"+datetime+\" the Transferwise currency conversion of \"+parseFloat(receipt.modified_reimbursed_rate).toFixed(5)+\" gave a value of \"+receipt.reimbursed_currency+\"\"+parseFloat(receipt.modified_reimbursed_amount).toFixed(2);\n            }\n            // if(receipt.)\n            var reimbursing = \"<br /><br /> By approving this receipt, we will automatically adjust the reimbursement by \"+receipt.reimbursed_currency+\"\"+parseFloat(receipt.modified_reimbursed_difference).toFixed(2)+\" for this claim.\";\n            if(receipt.modified_reimbursed_difference == 0){\n                reimbursing = \"<br /><br /> By approving this receipt, there will be no financial charge for this change.\";\n            }\n\n           return $sce.getTrustedHtml(\"<div>This is the amount that should have been removed from the associated invoice. <br /><br /> This is based on the receipt value of \"+added_currency+\". \"+reimbursing+\"</div>\");// {{ receipt.modified_currency || receipt.currency }}{{ receipt.modified_price | number:2 || receipt.price | number:2 }}\n        }\n\n        vm.update_currency = function(receipt){\n            //console.log(\"change currency\", receipt.modified_currency);\n            var obj = {\n                modified_currency: receipt.modified_currency\n            };\n            PlaneService.UpdateReceipt(receipt.id, obj)\n            .then(function(data){\n                //console.log(\"UPDATE ::: \", data);\n\n                //maybe that's where we re-calculate the price?\n                // verify_reimbursement(data);\n                // //console.log(\"receipts\", vm.receipts);\n                vm.verify_reimbursement(receipt);\n\n            });\n        }\n\n        vm.update_invoice_no = function(receipt){\n            //console.log(\"change currency\", receipt.modified_currency);\n            var obj = {\n                invoice_number: receipt.invoice_number\n            };\n            PlaneService.UpdateReceipt(receipt.id, obj)\n            .then(function(data){\n                //console.log(\"UPDATE ::: \", data);\n\n                //maybe that's where we re-calculate the price?\n                // verify_reimbursement(data);\n                // //console.log(\"receipts\", vm.receipts);\n                //vm.verify_reimbursement(receipt);\n\n            });\n        }\n\n        vm.update_qty = function(receipt){\n            //console.log(\"change quantity\", receipt.modified_quantity);\n            var obj = {\n                modified_quantity: receipt.modified_quantity\n            };\n            PlaneService.UpdateReceipt(receipt.id, obj)\n            .then(function(data){\n                //console.log(\"UPDATE ::: \", data);\n                //we don't do anything here...   \n                // verify_reimbursement(data);\n\n            });\n        }\n\n\n\n\n\n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        $scope.save = function(){\n            if(vm.action == \"add\"){\n                //console.log(\"CREATE click\");\n                $scope.create();\n            } else {\n                //console.log(\"EDIT click\");\n                //console.log(vm.club.plane);\n                $scope.update();\n            }\n        }\n\n\n        $scope.create = function(){\n            //console.log(\"CREATE ME NOW\");\n            vm.club.item.club_id = vm.club_id;\n            ItemService.Create(vm.club.item)\n                .then(function(data){\n                    //console.log(data);\n                    $state.go('dashboard.manage_club.items');\n\n                });\n        }\n\n        $scope.delete = function(){\n            //console.log(\"CLICK\");\n            ToastService.warning('Confirm Delete', 'Are you sure you would like to delete this item?');\n            ItemService.Delete(vm.user.id, vm.club.item)\n                .then(function(data){\n                    //console.log(data);\n                });\n        }\n\n        function get_update_docs(){\n            var documents = [];\n\n            for(var i=0;i<update_this_file.length;i++){\n                var id = update_this_file[i];\n                //console.log(\"looking for : \", id);\n                //console.log(\"in: \", vm.plane_documents);\n\n                for(var k=0;k<vm.club.plane.plane_documents.length;k++){\n                    //console.log(\"comparing to : \", vm.club.plane.plane_documents[k].id);\n                    if(vm.club.plane.plane_documents[k].id == id){\n                        documents.push(vm.club.plane.plane_documents[k]);\n                    }\n                }\n\n            }\n\n            // //console.log(\"DOCS TO UPDATE : \", documents);\n\n            return documents;\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n            vm.club.item.club_id = vm.club_id;\n            ItemService.Update(vm.club.item, vm.user.id)\n                .then(function(data){\n                    //console.log(data);\n                    //console.log(\"saved\");\n                    $state.go('dashboard.manage_club.items');\n                });\n        }\n\n\n        function containsObject(obj, list, params) {\n\n            // //console.log(\"obj\", obj);\n            // //console.log(\"list\", list);\n            // //console.log(\"params\", params);\n\n            for(var i=0; i<list.length; i++) {\n                // //console.log(\"list i : \", list[i]);\n                // //console.log(\"obj is: \", obj);\n\n                var count_success = 0;\n                for(var j=0;j<params.length;j++){\n                    if(list[i][params[j]] && obj[params[j]] && list[i][params[j]] == obj[params[j]]){\n                        count_success++;\n                    }\n                }\n\n                if(count_success === params.length) {                    \n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n\n        function check_all(){\n\n            //maybe a nice to have one day... not yet though.\n\n\n            //licences\n            vm.club.plane.requirements.licence.forEach(function(obj){\n\n            });\n\n        }\n\n      \n\n\n        $scope.add_item = function(type){\n            //console.log(\"ADD\");\n            switch(type){\n                case \"licence\":\n                    //console.log(\"licence\");\n                    if(vm.temporary.licence && vm.temporary.licence !== \"\" && vm.temporary.rating && vm.temporary.rating !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_licence = {\n                            licence_id: vm.temporary.licence.id,\n                            licence_title: vm.temporary.licence.abbreviation,\n                            rating_title: vm.temporary.rating.abbreviation,\n                            rating_id: vm.temporary.rating.id\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_licence, vm.club.plane.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n                            vm.club.plane.requirements.licence.push(add_licence);\n                        }\n\n                        delete vm.temporary.licence;\n                        delete vm.temporary.rating;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a licence and rating that is required to book the plane solo!');\n                    }\n\n                break;\n\n\n                case \"medical\":\n                    //console.log(\"medical\");\n                    if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_medical = {\n                            authority_id: vm.temporary.medical_authority.id,\n                            authority_title: vm.temporary.medical_authority.abbreviation,\n                            medical_component_id: vm.temporary.medical_component.id,\n                            medical_component_title: vm.temporary.medical_component.title\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_medical, vm.club.plane.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n                            vm.club.plane.requirements.medical.push(add_medical);\n                        }\n\n                        delete vm.temporary.medical_authority;\n                        delete vm.temporary.medical_component;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a medical that is required to book the plane solo!');\n                    }\n\n                break;\n\n\n                case \"differences\":\n                    //console.log(\"difference\");\n                    if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_difference = {\n                            difference_id: vm.temporary.difference.id,\n                            difference_title: vm.temporary.difference.title\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_difference, vm.club.plane.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n                            vm.club.plane.requirements.differences.push(add_difference);\n                        }\n\n                        delete vm.temporary.difference;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a difference that is required to book the plane solo!');\n                    }\n\n                break;\n\n\n            }\n\n\n\n        }\n\n\n        $scope.remove_item = function(type, index){\n            //console.log(\"REMOVE\");\n\n            vm.club.plane.requirements[type].splice(index, 1);\n\n\n            // switch(type){\n            //     case \"licence\":\n            //             //console.log(\"licence\");\n                   \n            //             //check if it doesnt exist first...\n            //             // if(containsObject(add_licence, vm.club.plane.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n            //             //     vm.club.plane.requirements.licence.push(add_licence);\n            //             // }\n\n            //             vm.club.plane.requirements.licence.splice(index, 1);\n                      \n                   \n\n            //     break;\n\n\n            //     case \"medical\":\n            //         //console.log(\"medical\");\n            //         if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_medical = {\n            //                 authority_id: vm.temporary.medical_authority.id,\n            //                 authority_title: vm.temporary.medical_authority.abbreviation,\n            //                 medical_component_id: vm.temporary.medical_component.id,\n            //                 medical_component_title: vm.temporary.medical_component.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_medical, vm.club.plane.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n            //                 vm.club.plane.requirements.medical.push(add_medical);\n            //             }\n\n            //             delete vm.temporary.medical_authority;\n            //             delete vm.temporary.medical_component;\n\n            //         } else {\n            //             alert(\"Please select a medical that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            //     case \"differences\":\n            //         //console.log(\"difference\");\n            //         if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_difference = {\n            //                 difference_id: vm.temporary.difference.id,\n            //                 difference_title: vm.temporary.difference.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_difference, vm.club.plane.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n            //                 vm.club.plane.requirements.differences.push(add_difference);\n            //             }\n\n            //             delete vm.temporary.difference;\n\n            //         } else {\n            //             alert(\"Please select a difference that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            // }\n\n\n\n        }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        $scope.update_this_file = function(file){\n            //console.log(\"==== update is : \", file.id);\n            if(update_this_file.indexOf(file.id) === -1){\n                update_this_file.push(file.id)\n            } else {\n               ////console.log(\"This item already exists\"); \n            } \n        }\n\n\n         $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.club.plane.plane_documents = $.grep(vm.club.plane.plane_documents, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                PlaneDocumentService.Delete(vm.user.id, file.id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            //console.log(\"REMOVE: \", j);\n            //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            PoidService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n          // $scope.$on('flow::fileAdded', function (event, $flow, flowFile) {\n          //     event.preventDefault();//prevent file from uploading\n          //     //console.log(\"FILE ADDED\");\n          //     //console.log($flow);\n          //   });\n\n            $scope.processFiles = function(files){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    //console.log(\"J is : \",j);\n                    //console.log(\"name is : \", j.files.file.name);\n\n                    files[i].file.temp_path = j.saved_url;\n                    files[i].file.save_name = j.files.file.name;\n                    var ft = j.files.file.name;\n                    ft = ft.split('.').pop();\n                    files[i].file.extension = ft;\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.plane_documents.push(files[i].file);\n                }\n\n\n            }\n\n            $scope.set_title = function(file){\n                //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            $scope.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            $scope.get_icon3 = function(file){\n\n                var ft = file.split(';')[0];\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            vm.approve_receipt_final = function(receipt){\n                //console.log(\"APPROVED THE RECEIPT\");\n                //time to make a call to an API endpoint\n                delete receipt.image;\n                PlaneService.ApproveReceipt(receipt.id, receipt)\n                .then(function(data){\n                    //console.log(\"data\", data);\n                    if(data.success){\n                        //we need to remove that one from the list\n                        vm.receipts.splice(vm.receipts.findIndex(function(i){\n                                            return i.id === receipt.id;\n                                        }), 1);\n\n                        vm.show_popup = false;\n                        vm.current_receipt = {};\n                    } else {\n                        ToastService.error('Approval Error', 'An error occurred: ' + data.message);\n                        vm.show_popup = false;\n                        vm.current_receipt = {};\n                    }\n                });\n            }   \n\n            vm.reject_receipt_final = function(receipt){\n                //console.log(\"REJECT THE RECEIPT\");\n                //time to make a call to an API endpoint\n                \n                delete receipt.image;\n                PlaneService.RejectReceipt(receipt.id, receipt)\n                .then(function(data){\n                    ////console.log(\"data\", data);\n                    if(data.success){\n                        //we need to remove that one from the list\n                        vm.receipts.splice(vm.receipts.findIndex(function(i){\n                                            return i.id === receipt.id;\n                                        }), 1);\n\n                        vm.show_popup = false;\n                        vm.current_receipt = {};\n                    } else {\n                        ToastService.error('Rejection Error', 'An error occurred: ' + data.message);\n                        vm.show_popup = false;\n                        vm.current_receipt = {};\n                    }\n                });\n\n            }    \n\n\n            $scope.approve_receipt = function(receipt){\n                //console.log(\"RECEIPT: \", receipt);\n                vm.current_receipt = receipt;\n\n                if(vm.current_receipt.modified_reimbursed_amount > 0){\n                    vm.show_popup = 'approve';\n\n\n\n                } else {\n\n                    //this is where we bypass the popup\n\n                    vm.approve_receipt_final(receipt);\n\n\n\n                }\n\n\n\n\n            }\n\n            $scope.reject_receipt = function(receipt){\n                //console.log(\"RECEIPT: \", receipt);\n                vm.current_receipt = receipt;\n\n                vm.show_popup = 'reject';\n\n\n\n            }\n\n            $scope.close_popup = function(){\n                vm.show_popup = false;\n                vm.current_receipt = {};\n            }\n\n\n            $scope.delete_poid = function(id){\n\n              \n                var a = prompt(\"Are you sure you wish to delete this poid? \\n\\n This change is irreversible! To confirm please type YES in the box below.\");\n                if(a == \"YES\"){\n\n\n                    //console.log(\"WE DELETE IT\");\n\n\n                    // PoidService.Delete(vm.user_id, id)\n                    //     .then(function (data) {\n                    //         //console.log(data);\n                    //         if(data.success){\n                    //             //console.log(\"HUZZAH\", data);\n                    //             //then we need to remove this from the list of files...\n                    //             vm.user_poids = $.grep(vm.user_poids, function(e){ \n                    //                 return e.id != id; \n                    //             });\n                                \n                    //             //refresh?\n                    //             $state.reload();\n                    //             $state.go('dashboard.my_account.poid');\n\n                    //         } else {\n\n                    //             alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n                    //         }\n\n                    //     });\n\n\n\n                } else {\n                    //console.log(\"ignore123\");\n                }\n\n\n            }\n\n\n\n\n            $scope.save_plane_documents = function(){\n\n               \n              \n\n                //console.log(\"plane_documents: \", vm.plane_documents);\n\n\n                //compile the required elements YAY\n\n                //console.log(\"plane_document \", vm.plane_document);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n                    // for(var i=0;i<vm.plane_document.images.length;i++){\n                    //     delete vm.plane_document.images[i].data_uri;\n                    // }\n\n                    // // vm.plane_document.images = vm.plane_documents;\n                    // vm.plane_document.images = vm.plane_document.images.concat(vm.plane_documents);\n                    // vm.plane_document.user_id = vm.user_id;\n\n\n\n\n            //     if(vm.plane_document.id){\n            //         //then its an udpate\n\n            //         //merge the images left?\n            //         PoidService.Update(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                     $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n            //     } else {\n\n\n                   \n\n\n            //         //then its a create\n            //         //console.log(vm.plane_document);\n\n            //         PoidService.Create(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                    // $state.reload();\n            //                    // $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n\n            //     }\n\n\n\n             };\n\n\n\n\n             $scope.change_file_name = function(file){\n                \n                //this is terribly ineficient... unfortunately... can't \n                //work out how else to do it! (lol)\n\n                // //console.log(\"TO BE CHANGED\", file);\n\n                // //console.log(\"BEFORE BEFORE\", vm.plane_documents);\n\n                vm.plane_documents = $.grep(vm.plane_documents, function(e){ \n                    return e.temp_path != file.temp_path; \n                });\n\n                // //console.log(\"BEFORE\", vm.plane_documents);\n\n                vm.plane_documents.push(file);\n\n                // //console.log(\"AFTER\", vm.plane_documents);\n\n             }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n            var warning_msg = \"By deleting this plane, you will also cancel all reservations that this plane currently has.\"\n\n          $scope.open = function (plane_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return plane_id;\n                },\n                params: function() {\n                  return {id: plane_id};\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (plane_id) {\n              $log.info('PRESSED GO: '+plane_id.id);\n              ItemService.Delete(vm.user.id, plane_id.id)\n              .then(function(){\n                //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.items = $.grep(vm.club.items, function(e){ \n                    return e.id != plane_id.id; \n                });\n              })\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n          };\n\n         \n\n\n    }\n app.controller('DashboardClubReceiptsController', DashboardClubReceiptsController);\n\n    DashboardClubReceiptsController.$inject = ['UserService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'LicenceService', 'MedicalService', 'DifferencesService', 'ItemService', '$sce', 'ToastService'];\n    function DashboardClubReceiptsController(UserService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, LicenceService, MedicalService, DifferencesService, ItemService, $sce, ToastService) {\n        var vm = this;\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {};\n        vm.page_title = \"\";\n        \n        vm.plane_document = {};\n        vm.plane_documents = [];\n\n        var update_this_file = [];\n        \n\n        vm.action = $state.current.data.action;\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n        ////console.log(\"club_id : \"+vm.club_id);\n\n        // //console.log(vm.action);\n        // //console.log($stateParams);\n        // //console.log($stateParams.id);\n        \n        PlaneService.GetCurrencies(vm.club_id)\n         .then(function(data){\n                        vm.currencies = data.currencies;   \n                        vm.club_currency = data.club_currency;\n\n                    });\n\n\n\n        vm.current_offset = 0;\n        vm.loaded_per_batch = 10;\n        vm.all_loaded = false;\n\n        PlaneService.GetReceiptsClub(vm.club_id, vm.current_offset, vm.loaded_per_batc)\n                    .then(function(data){\n                        vm.receipts = data.receipts;   \n                           \n                           //check for modded\n                           vm.receipts.forEach(receipt => {\n                               vm.verify_reimbursement(receipt);\n                           })\n\n                    });\n\n        vm.load_more = function(){\n                vm.current_offset = vm.current_offset + vm.loaded_per_batch;\n                PlaneService.GetReceiptsClub(vm.club_id, vm.current_offset, vm.loaded_per_batch)\n                .then(function (data) {\n                        // //console.log(\"ALL is : \", data);\n                        if(data.receipts.length > 0){\n                            data.receipts.forEach(receipt => vm.receipts.push(receipt));\n                        } else {\n                            vm.all_loaded = true;\n                        }\n                       //vm.logs = data.logs;\n\n\n                    });\n\n            }\n            \n\n        vm.show_receipt_image = function(receipt){\n\n            vm.show_receipt = true;\n            vm.receipt_image = receipt.image;\n\n        }\n\n        $scope.get_currency = function(iso_code){\n\n           return $.grep(vm.currencies, function(e){ \n                        return e.iso_code == iso_code; \n                    })[0];\n\n        }\n        //'9' needs to refer the the user's account set to manage\n       \n\n        vm.update_price = function(receipt){\n            //console.log(\"change price\", receipt.modified_price);\n            var obj = {\n                modified_price: receipt.modified_price\n            };\n            PlaneService.UpdateReceipt(receipt.id, obj)\n            .then(function(data){\n                //console.log(\"UPDATE ::: \", data);\n\n                //maybe that's where we re-calculate the price?\n\n                vm.verify_reimbursement(receipt);\n\n            });\n        }\n\n        vm.verify_reimbursement = function(receipt){\n            //console.log(\"WE GET HERE VERIFY REIMBURSEMENT\");\n            // receipt.reimbursed_amount = 12.5;\n            // //console.log(\"receipt\", receipt);\n            if(receipt.modified_price && !receipt.modified_currency){\n                receipt.modified_reimbursed_amount = receipt.modified_price;\n                receipt.modified_reimbursed_difference = parseFloat(parseFloat(receipt.modified_reimbursed_amount) - parseFloat(receipt.reimbursed_amount));\n            } else if((!receipt.modified_price || !receipt.modified_currency) || receipt.reimbursement == 0){\n                return false;\n            }\n\n            //console.log(\"WE GET THERE\");\n\n            var receipt = $.grep(vm.receipts, function(e){ \n                        return e.id == receipt.id; \n                    })[0];\n\n            var obj = {\n                club_id: receipt.club_id,\n                currency: (receipt.modified_currency)? receipt.modified_currency : receipt.currency,\n                price: (receipt.modified_price) ? receipt.modified_price : receipt.price,\n                requested_at: receipt.created_at\n            }\n            PlaneService.CheckReimbursement(obj)\n            .then(function(data){\n                ////console.log(\"CHANGE ::: \", data.reimburse.reimbursed_amount);\n\n                //maybe that's where we re-calculate the price?\n                receipt.modified_reimbursed_amount = data.reimburse.reimbursed_amount;\n                receipt.modified_reimbursed_rate = data.reimburse.rate;\n\n                //currency is always the same\n                receipt.modified_reimbursed_difference = parseFloat(parseFloat(receipt.modified_reimbursed_amount) - parseFloat(receipt.reimbursed_amount));\n                if(receipt.modified_reimbursed_difference == 0){\n                    receipt.modified_reimbursed_difference = 0;\n                    // //console.log(\"TOTAL CHANGE IS : \", receipt.modified_reimbursed_difference)\n                }\n                    // //console.log(\"TOTAL CHANGE IS : \", receipt.modified_reimbursed_difference)\n\n            });\n\n\n\n\n        }\n\n\n        vm.modified_reimbursement_tooltip = function(receipt){\n\n            var currency = (receipt.modified_currency) ? receipt.modified_currency : receipt.currency;\n            var price = (receipt.modified_price) ? parseFloat(receipt.modified_price).toFixed(2) : parseFloat(receipt.price).toFixed(2);\n\n            var added_currency = currency+\"\"+parseFloat(price).toFixed(2);\n            if((receipt.modified_currency && (receipt.modified_currency !== receipt.reimbursed_currency)) || (receipt.reimbursed_currency !== receipt.currency) && receipt.modified_reimbursed_rate){\n                //currency was modified\n                var datetime = moment(receipt.created_at).format(\"DD MMM YYYY HH:mm\");\n                added_currency = added_currency+\" which on \"+datetime+\" the Transferwise currency conversion of \"+parseFloat(receipt.modified_reimbursed_rate).toFixed(5)+\" gave a value of \"+receipt.reimbursed_currency+\"\"+parseFloat(receipt.modified_reimbursed_amount).toFixed(2);\n            }\n            // if(receipt.)\n            var reimbursing = \"<br /><br /> By approving this receipt, we will automatically adjust the reimbursement by \"+receipt.reimbursed_currency+\"\"+parseFloat(receipt.modified_reimbursed_difference).toFixed(2)+\" for this claim.\";\n            if(receipt.modified_reimbursed_difference == 0){\n                reimbursing = \"<br /><br /> By approving this receipt, there will be no financial charge for this change.\";\n            }\n\n           return $sce.getTrustedHtml(\"<div>This is the amount that should have been removed from the associated invoice. <br /><br /> This is based on the receipt value of \"+added_currency+\". \"+reimbursing+\"</div>\");// {{ receipt.modified_currency || receipt.currency }}{{ receipt.modified_price | number:2 || receipt.price | number:2 }}\n        }\n\n        vm.update_currency = function(receipt){\n            //console.log(\"change currency\", receipt.modified_currency);\n            var obj = {\n                modified_currency: receipt.modified_currency\n            };\n            PlaneService.UpdateReceipt(receipt.id, obj)\n            .then(function(data){\n                //console.log(\"UPDATE ::: \", data);\n\n                //maybe that's where we re-calculate the price?\n                // verify_reimbursement(data);\n                // //console.log(\"receipts\", vm.receipts);\n                vm.verify_reimbursement(receipt);\n\n            });\n        }\n\n        vm.update_invoice_no = function(receipt){\n            //console.log(\"change currency\", receipt.modified_currency);\n            var obj = {\n                invoice_number: receipt.invoice_number\n            };\n            PlaneService.UpdateReceipt(receipt.id, obj)\n            .then(function(data){\n                //console.log(\"UPDATE ::: \", data);\n\n                //maybe that's where we re-calculate the price?\n                // verify_reimbursement(data);\n                // //console.log(\"receipts\", vm.receipts);\n                //vm.verify_reimbursement(receipt);\n\n            });\n        }\n\n        vm.update_qty = function(receipt){\n            //console.log(\"change quantity\", receipt.modified_quantity);\n            var obj = {\n                modified_quantity: receipt.modified_quantity\n            };\n            PlaneService.UpdateReceipt(receipt.id, obj)\n            .then(function(data){\n                //console.log(\"UPDATE ::: \", data);\n                //we don't do anything here...   \n                // verify_reimbursement(data);\n\n            });\n        }\n\n\n\n\n\n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        $scope.save = function(){\n            if(vm.action == \"add\"){\n                //console.log(\"CREATE click\");\n                $scope.create();\n            } else {\n                //console.log(\"EDIT click\");\n                //console.log(vm.club.plane);\n                $scope.update();\n            }\n        }\n\n\n        $scope.create = function(){\n            //console.log(\"CREATE ME NOW\");\n            vm.club.item.club_id = vm.club_id;\n            ItemService.Create(vm.club.item)\n                .then(function(data){\n                    //console.log(data);\n                    $state.go('dashboard.manage_club.items');\n\n                });\n        }\n\n        $scope.delete = function(){\n            //console.log(\"CLICK\");\n            ToastService.warning('Confirm Delete', 'Are you sure you would like to delete this item?');\n            ItemService.Delete(vm.user.id, vm.club.item)\n                .then(function(data){\n                    //console.log(data);\n                });\n        }\n\n        function get_update_docs(){\n            var documents = [];\n\n            for(var i=0;i<update_this_file.length;i++){\n                var id = update_this_file[i];\n                //console.log(\"looking for : \", id);\n                //console.log(\"in: \", vm.plane_documents);\n\n                for(var k=0;k<vm.club.plane.plane_documents.length;k++){\n                    //console.log(\"comparing to : \", vm.club.plane.plane_documents[k].id);\n                    if(vm.club.plane.plane_documents[k].id == id){\n                        documents.push(vm.club.plane.plane_documents[k]);\n                    }\n                }\n\n            }\n\n            // //console.log(\"DOCS TO UPDATE : \", documents);\n\n            return documents;\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n            vm.club.item.club_id = vm.club_id;\n            ItemService.Update(vm.club.item, vm.user.id)\n                .then(function(data){\n                    //console.log(data);\n                    //console.log(\"saved\");\n                    $state.go('dashboard.manage_club.items');\n                });\n        }\n\n\n        function containsObject(obj, list, params) {\n\n            // //console.log(\"obj\", obj);\n            // //console.log(\"list\", list);\n            // //console.log(\"params\", params);\n\n            for(var i=0; i<list.length; i++) {\n                // //console.log(\"list i : \", list[i]);\n                // //console.log(\"obj is: \", obj);\n\n                var count_success = 0;\n                for(var j=0;j<params.length;j++){\n                    if(list[i][params[j]] && obj[params[j]] && list[i][params[j]] == obj[params[j]]){\n                        count_success++;\n                    }\n                }\n\n                if(count_success === params.length) {                    \n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n\n        function check_all(){\n\n            //maybe a nice to have one day... not yet though.\n\n\n            //licences\n            vm.club.plane.requirements.licence.forEach(function(obj){\n\n            });\n\n        }\n\n      \n\n\n        $scope.add_item = function(type){\n            //console.log(\"ADD\");\n            switch(type){\n                case \"licence\":\n                    //console.log(\"licence\");\n                    if(vm.temporary.licence && vm.temporary.licence !== \"\" && vm.temporary.rating && vm.temporary.rating !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_licence = {\n                            licence_id: vm.temporary.licence.id,\n                            licence_title: vm.temporary.licence.abbreviation,\n                            rating_title: vm.temporary.rating.abbreviation,\n                            rating_id: vm.temporary.rating.id\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_licence, vm.club.plane.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n                            vm.club.plane.requirements.licence.push(add_licence);\n                        }\n\n                        delete vm.temporary.licence;\n                        delete vm.temporary.rating;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a licence and rating that is required to book the plane solo!');\n                    }\n\n                break;\n\n\n                case \"medical\":\n                    //console.log(\"medical\");\n                    if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_medical = {\n                            authority_id: vm.temporary.medical_authority.id,\n                            authority_title: vm.temporary.medical_authority.abbreviation,\n                            medical_component_id: vm.temporary.medical_component.id,\n                            medical_component_title: vm.temporary.medical_component.title\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_medical, vm.club.plane.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n                            vm.club.plane.requirements.medical.push(add_medical);\n                        }\n\n                        delete vm.temporary.medical_authority;\n                        delete vm.temporary.medical_component;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a medical that is required to book the plane solo!');\n                    }\n\n                break;\n\n\n                case \"differences\":\n                    //console.log(\"difference\");\n                    if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        var add_difference = {\n                            difference_id: vm.temporary.difference.id,\n                            difference_title: vm.temporary.difference.title\n                        };\n\n                        //check if it doesnt exist first...\n                        if(containsObject(add_difference, vm.club.plane.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n                            vm.club.plane.requirements.differences.push(add_difference);\n                        }\n\n                        delete vm.temporary.difference;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a difference that is required to book the plane solo!');\n                    }\n\n                break;\n\n\n            }\n\n\n\n        }\n\n\n\n\n        $scope.remove_item = function(type, index){\n            //console.log(\"REMOVE\");\n\n            vm.club.plane.requirements[type].splice(index, 1);\n\n\n            // switch(type){\n            //     case \"licence\":\n            //             //console.log(\"licence\");\n                   \n            //             //check if it doesnt exist first...\n            //             // if(containsObject(add_licence, vm.club.plane.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n            //             //     vm.club.plane.requirements.licence.push(add_licence);\n            //             // }\n\n            //             vm.club.plane.requirements.licence.splice(index, 1);\n                      \n                   \n\n            //     break;\n\n\n            //     case \"medical\":\n            //         //console.log(\"medical\");\n            //         if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_medical = {\n            //                 authority_id: vm.temporary.medical_authority.id,\n            //                 authority_title: vm.temporary.medical_authority.abbreviation,\n            //                 medical_component_id: vm.temporary.medical_component.id,\n            //                 medical_component_title: vm.temporary.medical_component.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_medical, vm.club.plane.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n            //                 vm.club.plane.requirements.medical.push(add_medical);\n            //             }\n\n            //             delete vm.temporary.medical_authority;\n            //             delete vm.temporary.medical_component;\n\n            //         } else {\n            //             alert(\"Please select a medical that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            //     case \"differences\":\n            //         //console.log(\"difference\");\n            //         if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_difference = {\n            //                 difference_id: vm.temporary.difference.id,\n            //                 difference_title: vm.temporary.difference.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_difference, vm.club.plane.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n            //                 vm.club.plane.requirements.differences.push(add_difference);\n            //             }\n\n            //             delete vm.temporary.difference;\n\n            //         } else {\n            //             alert(\"Please select a difference that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            // }\n\n\n\n        }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        $scope.update_this_file = function(file){\n            //console.log(\"==== update is : \", file.id);\n            if(update_this_file.indexOf(file.id) === -1){\n                update_this_file.push(file.id)\n            } else {\n               ////console.log(\"This item already exists\"); \n            } \n        }\n\n\n         $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.club.plane.plane_documents = $.grep(vm.club.plane.plane_documents, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                PlaneDocumentService.Delete(vm.user.id, file.id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            //console.log(\"REMOVE: \", j);\n            //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            PoidService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n          // $scope.$on('flow::fileAdded', function (event, $flow, flowFile) {\n          //     event.preventDefault();//prevent file from uploading\n          //     //console.log(\"FILE ADDED\");\n          //     //console.log($flow);\n          //   });\n\n            $scope.processFiles = function(files){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    //console.log(\"J is : \",j);\n                    //console.log(\"name is : \", j.files.file.name);\n\n                    files[i].file.temp_path = j.saved_url;\n                    files[i].file.save_name = j.files.file.name;\n                    var ft = j.files.file.name;\n                    ft = ft.split('.').pop();\n                    files[i].file.extension = ft;\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.plane_documents.push(files[i].file);\n                }\n\n\n            }\n\n            $scope.set_title = function(file){\n                //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            $scope.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            $scope.get_icon3 = function(file){\n\n                var ft = file.split(';')[0];\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            vm.approve_receipt_final = function(receipt){\n                //console.log(\"APPROVED THE RECEIPT\");\n                //time to make a call to an API endpoint\n                delete receipt.image;\n                PlaneService.ApproveReceipt(receipt.id, receipt)\n                .then(function(data){\n                    //console.log(\"data\", data);\n                    if(data.success){\n                        //we need to remove that one from the list\n                        vm.receipts.splice(vm.receipts.findIndex(function(i){\n                                            return i.id === receipt.id;\n                                        }), 1);\n\n                        vm.show_popup = false;\n                        vm.current_receipt = {};\n                    } else {\n                        ToastService.error('Approval Error', 'An error occurred: ' + data.message);\n                        vm.show_popup = false;\n                        vm.current_receipt = {};\n                    }\n                });\n            }   \n\n            vm.reject_receipt_final = function(receipt){\n                //console.log(\"REJECT THE RECEIPT\");\n                //time to make a call to an API endpoint\n                \n                delete receipt.image;\n                PlaneService.RejectReceipt(receipt.id, receipt)\n                .then(function(data){\n                    ////console.log(\"data\", data);\n                    if(data.success){\n                        //we need to remove that one from the list\n                        vm.receipts.splice(vm.receipts.findIndex(function(i){\n                                            return i.id === receipt.id;\n                                        }), 1);\n\n                        vm.show_popup = false;\n                        vm.current_receipt = {};\n                    } else {\n                        ToastService.error('Rejection Error', 'An error occurred: ' + data.message);\n                        vm.show_popup = false;\n                        vm.current_receipt = {};\n                    }\n                });\n\n            }    \n\n\n            $scope.approve_receipt = function(receipt){\n                //console.log(\"RECEIPT: \", receipt);\n                vm.current_receipt = receipt;\n\n                if(vm.current_receipt.modified_reimbursed_amount > 0){\n                    vm.show_popup = 'approve';\n\n\n\n                } else {\n\n                    //this is where we bypass the popup\n\n                    vm.approve_receipt_final(receipt);\n\n\n\n                }\n\n\n\n\n            }\n\n            $scope.reject_receipt = function(receipt){\n                //console.log(\"RECEIPT: \", receipt);\n                vm.current_receipt = receipt;\n\n                vm.show_popup = 'reject';\n\n\n\n            }\n\n            $scope.close_popup = function(){\n                vm.show_popup = false;\n                vm.current_receipt = {};\n            }\n\n\n            $scope.delete_poid = function(id){\n\n              \n                var a = prompt(\"Are you sure you wish to delete this poid? \\n\\n This change is irreversible! To confirm please type YES in the box below.\");\n                if(a == \"YES\"){\n\n\n                    //console.log(\"WE DELETE IT\");\n\n\n                    // PoidService.Delete(vm.user_id, id)\n                    //     .then(function (data) {\n                    //         //console.log(data);\n                    //         if(data.success){\n                    //             //console.log(\"HUZZAH\", data);\n                    //             //then we need to remove this from the list of files...\n                    //             vm.user_poids = $.grep(vm.user_poids, function(e){ \n                    //                 return e.id != id; \n                    //             });\n                                \n                    //             //refresh?\n                    //             $state.reload();\n                    //             $state.go('dashboard.my_account.poid');\n\n                    //         } else {\n\n                    //             alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n                    //         }\n\n                    //     });\n\n\n\n                } else {\n                    //console.log(\"ignore123\");\n                }\n\n\n            }\n\n\n\n\n            $scope.save_plane_documents = function(){\n\n               \n              \n\n                //console.log(\"plane_documents: \", vm.plane_documents);\n\n\n                //compile the required elements YAY\n\n                //console.log(\"plane_document \", vm.plane_document);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n                    // for(var i=0;i<vm.plane_document.images.length;i++){\n                    //     delete vm.plane_document.images[i].data_uri;\n                    // }\n\n                    // // vm.plane_document.images = vm.plane_documents;\n                    // vm.plane_document.images = vm.plane_document.images.concat(vm.plane_documents);\n                    // vm.plane_document.user_id = vm.user_id;\n\n\n\n\n            //     if(vm.plane_document.id){\n            //         //then its an udpate\n\n            //         //merge the images left?\n            //         PoidService.Update(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                     $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n            //     } else {\n\n\n                   \n\n\n            //         //then its a create\n            //         //console.log(vm.plane_document);\n\n            //         PoidService.Create(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                    // $state.reload();\n            //                    // $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n\n            //     }\n\n\n\n             };\n\n\n\n\n             $scope.change_file_name = function(file){\n                \n                //this is terribly ineficient... unfortunately... can't \n                //work out how else to do it! (lol)\n\n                // //console.log(\"TO BE CHANGED\", file);\n\n                // //console.log(\"BEFORE BEFORE\", vm.plane_documents);\n\n                vm.plane_documents = $.grep(vm.plane_documents, function(e){ \n                    return e.temp_path != file.temp_path; \n                });\n\n                // //console.log(\"BEFORE\", vm.plane_documents);\n\n                vm.plane_documents.push(file);\n\n                // //console.log(\"AFTER\", vm.plane_documents);\n\n             }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n            var warning_msg = \"By deleting this plane, you will also cancel all reservations that this plane currently has.\"\n\n          $scope.open = function (plane_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return plane_id;\n                },\n                params: function() {\n                  return {id: plane_id};\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (plane_id) {\n              $log.info('PRESSED GO: '+plane_id.id);\n              ItemService.Delete(vm.user.id, plane_id.id)\n              .then(function(){\n                //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.items = $.grep(vm.club.items, function(e){ \n                    return e.id != plane_id.id; \n                });\n              })\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n          };\n\n         \n\n\n    }\n app.controller('DashboardClubSettingsController', DashboardClubSettingsController);\n\n    DashboardClubSettingsController.$inject = ['UserService', 'ClubService', 'PaymentService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$window', '$http', '$log', 'ToastService'];\n    function DashboardClubSettingsController(UserService, ClubService, PaymentService, $rootScope, $location, $scope, $state, $stateParams, $window, $http, $log, ToastService) {\n        var vm = this;\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {};\n\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n        \n        vm.action = $state.current.data.action;\n\n\n        switch(vm.action){\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                //'9' needs to refer the the user's account set to manage\n                ClubService.GetById(vm.club_id)\n                    .then(function(data){\n                        vm.club.settings = data;\n                        vm.club.settings.vat_registered = (vm.club.settings.vat_registered == 1)? true : false;\n                        vm.club.settings.tpc_aircraft_surchages = (vm.club.settings.tpc_aircraft_surchages == 1)? true : false;\n                        vm.club.settings.vat_rate = parseFloat(vm.club.settings.vat_rate);\n                        //console.log(vm.club);\n                    });\n\n\n            break;\n            case \"stripe_return\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                vm.stripe_id = $stateParams.stripe_id;\n                //generate a link here and do something cool with it!!\n                PaymentService.SaveStripeLink(vm.club_id, vm.stripe_id)\n                .then(function(data){\n                    console.log(data);\n\n                    //$state.go('dashboard.manage_club');\n                });\n\n            break;\n            case \"stripe_refresh\":\n                //need to update this to be part of the authentication\n                vm.stripe_id = $stateParams.stripe_id;\n                //to find out club id\n                PaymentService.RefreshStripeLink(vm.club_id, vm.stripe_id)\n                    .then(function(data){\n                        //vm.club.courses = data.items;   \n                        console.log(data);\n                    });\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n\n       \n\n\n        $scope.processFiles = function(files, image){\n\n            for(var i=0; i<files.length; i++){\n                // //console.log(\"JSON\", files[i].file_return);\n                var j = JSON.parse(files[i].file_return);\n                // //console.log(\"PARSED\", j);\n                files[i].file.temp_path = j.saved_url;\n\n                var update_text = \"update_\"+image;\n                // //console.log(\"file\", files[i].file);\n                vm.club.settings[image] = files[i].file;\n                vm.club.settings[image] = files[i].file.temp_path;\n                vm.club.settings[update_text] = true;\n                // //console.log(vm.club.settings[image]);\n            }\n           \n        }\n\n        vm.clearFieldError = function(event) { ToastService.clearFieldError(event); };\n\n        $scope.save = function(){\n            var checks = [\n                { ok: vm.club.settings.title,   field: 'title',   label: 'Trading As' },\n                { ok: vm.club.settings.email,   field: 'email',   label: 'Email' },\n                { ok: vm.club.settings.address, field: 'address', label: 'Registered Address' }\n            ];\n            if (vm.club.settings.vat_registered) {\n                checks.push({ ok: vm.club.settings.vat_number, field: 'vat_number', label: 'VAT Number' });\n                checks.push({ ok: vm.club.settings.vat_rate != null && vm.club.settings.vat_rate !== '', field: 'vat_rate', label: 'VAT Rate' });\n            }\n            if (!ToastService.validateForm(checks)) return;\n\n            if(!vm.club.settings.update_logo){\n                    delete vm.club.settings.logo;\n            }\n            if(!vm.club.settings.update_invoice_logo){\n                    delete vm.club.settings.invoice_logo;\n            }\n\n            if(vm.privacy_file){\n                vm.club.settings.privacy_terms = vm.privacy_file;\n            } else {\n                delete(vm.club.settings.privacy_terms);\n            }\n\n            if(vm.membership_file){\n                vm.club.settings.membership_terms = vm.membership_file;\n            }else {\n                delete(vm.club.settings.membership_terms);\n            }\n\n            if(vm.passenger_file){\n                vm.club.settings.passenger_terms = vm.passenger_file;\n            }else {\n                delete(vm.club.settings.passenger_terms);\n            }\n\n            delete(vm.club.settings.membership_updated);\n            delete(vm.club.settings.passenger_updated);\n            delete(vm.club.settings.privacy_updated);\n\n            delete(vm.club.settings.updated_at);\n            delete(vm.club.settings.created_at);\n            delete(vm.club.settings.gcl);\n            delete(vm.club.settings.salt);\n            delete(vm.club.settings.pepper);\n\n            vm.club.settings.vat_registered = (vm.club.settings.vat_registered)? 1 : 0;\n            vm.club.settings.tpc_aircraft_surchages = (vm.club.settings.tpc_aircraft_surchages)? 1 : 0;\n            \n\n            ClubService.Update(vm.club.settings)\n                .then(function(data){\n                    //console.log(data);\n                    $state.go('dashboard.manage_club');\n                });\n        }\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n        vm.called_stripe_setup = false;\n        vm.generate_stripe_link = function(){\n\n            vm.called_stripe_setup = true;\n\n            //generate a link here and do something cool with it!!\n            PaymentService.GenerateStripeLink(vm.club.settings)\n                .then(function(data){\n                    console.log(data);\n\n                    if(data.success && data.onboarding_link !== ''){\n                        ToastService.success('Stripe Redirect', 'You will be redirected to Stripe - please complete the setup and you will be returned to ToAviate');\n                        window.location = data.onboarding_link;\n                    } else {\n                        ToastService.error('Stripe Error', \"Please try the link again! Stripe didn't seem to want to connect to ToAviate\");\n                        vm.called_stripe_setup = false;\n                    }\n\n\n                    //$state.go('dashboard.manage_club');\n                });\n\n\n        }\n\n        vm.term_documents = [];\n\n         $scope.processFiles2 = function(files, current_files){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    // //console.log(\"J is : \",j);\n                    // //console.log(\"name is : \", j.files.file.name);\n\n                    files[i].file.temp_path = j.saved_url;\n                    files[i].file.save_name = j.files.file.name;\n                    var ft = j.files.file.name;\n                    ft = ft.split('.').pop();\n                    files[i].file.extension = ft;\n\n                    // //console.log(\"file\", files[i].file);\n                    switch(current_files){\n                        case 'privacy':\n                        vm.privacy_file = files[i].file;\n                        break;\n                        case 'membership':\n                        vm.membership_file = files[i].file;\n                        break;\n                        case 'passenger':\n                        vm.passenger_file = files[i].file;\n                        break;\n                    }\n                    //vm.term_documents[current_files] = files[i].file;\n                }\n\n\n            }\n\n            $scope.delete_file = function(filetype){\n                var to_delete;\n                    switch(filetype){\n                        case 'privacy':\n                        to_delete = vm.club.settings.privacy_terms;\n                        vm.club.settings.privacy_terms = \"\";\n                        break;\n                        case 'membership':\n                        to_delete = vm.club.settings.membership_terms;\n                        vm.club.settings.membership_terms = \"\";\n                        break;\n                        case 'passenger':\n                        to_delete = vm.club.settings.passenger_terms;\n                        vm.club.settings.passenger_terms = \"\";\n                        break;\n                    }\n                    \n                    //think about deleting the actual file API call\n\n\n\n\n\n            }\n\n            $scope.remove_file = function(file, current_files){\n\n                //remove_file\n                var j = JSON.parse(file.file_return);\n                //console.log(\"REMOVE: \", j);\n                //console.log(\"REMOVE: \", j.saved_url);\n\n\n                // PoidService.DeleteTmp(j.saved_url)\n                //     .then(function (data) {\n                //         //console.log(data);\n                //         if(data.success){\n                //             //console.log(\"HUZZAH\", current_files);\n                //             //then we need to remove this from the list of files...\n                //             //clear files\n                //             vm.plane_documents = [];\n                //             //and re-process available files\n                //             $scope.processFiles(current_files);\n\n                //         } else {\n                //             //console.log(\"WOOOPSIES...\");\n                //             //this should be very very rare...\n                //         }\n\n                //     });\n\n              }\n\n            $scope.set_title = function(file){\n                //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n            $scope.back = function(){\n                $window.history.back();\n            }\n\n            $scope.get_icon = function(file){\n\n                var ft;\n                if(file && file.name){\n                     ft = file.name;\n                } else {\n                    ft = file;\n                }\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n\n\n\n\n        $scope.downloadClubDocument = function(doc) {\n            var data = $.param({\n                id: doc\n            });\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/club_documents/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Error', 'There was an error downloading the selected document(s)');\n                })\n        };\n\n        function titlepath(path,name){\n\n        //In this path defined as your pdf url and name (your pdf name)\n            var prntWin = window.open();\n            prntWin.document.write(\"<html><head><title>\"+name+\"</title></head><body>\"\n                + '<embed width=\"100%\" height=\"100%\" name=\"plugin\" src=\"'+ path+ '\" '\n                + 'type=\"application/pdf\" internalinstanceid=\"21\"></body></html>');\n            prntWin.document.close();\n        }\n\n        function processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], \n                    //type: contentType\n                    {type: 'application/pdf'}\n                //}\n                );\n\n\n                var fileURL = URL.createObjectURL(blob);\n                //window.open(fileURL);\n                titlepath(fileURL, \"Secure Documents\");\n                \n                // if (navigator.msSaveBlob)\n                //     navigator.msSaveBlob(blob, filename);\n                // else {\n                //     // Try using other saveBlob implementations, if available\n                //     var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                //     if (saveBlob === undefined) throw \"Not supported\";\n                //     saveBlob(blob, filename);\n                // }\n                success = true;\n            } catch (ex) {\n                $log.info(\"saveBlob method failed with the following exception:\");\n                $log.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            $log.info(\"Download link method with simulated click failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n\n\n    }\n app.controller('DashboardClubShopItemsController', DashboardClubShopItemsController);\n\n    DashboardClubShopItemsController.$inject = ['UserService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'LicenceService', 'MedicalService', 'DifferencesService', 'ShopItemService', 'ToastService'];\n    function DashboardClubShopItemsController(UserService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, LicenceService, MedicalService, DifferencesService, ShopItemService, ToastService) {\n        var vm = this;\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {};\n        vm.page_title = \"\";\n        \n        vm.plane_document = {};\n        vm.plane_documents = [];\n\n        var update_this_file = [];\n        \n\n        vm.action = $state.current.data.action;\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n        ////console.log(\"club_id : \"+vm.club_id);\n\n        // //console.log(vm.action);\n         //console.log($stateParams);\n        // //console.log($stateParams.id);\n        switch(vm.action){\n            case \"add\":\n                //console.log(\"adding a new plane please\");\n                vm.page_title = \"Add a New Plane\";\n            break;\n            case \"edit\":\n                //console.log(\"edit an existing plane\");\n                 //console.log($stateParams);\n                ShopItemService.GetById($stateParams.item_id)\n                    .then(function(data){\n                        vm.club.item = data.item;   \n                        //console.log(vm.club);\n                        vm.page_title = \"Edit an Item - \"+vm.club.item.title;\n                    });\n\n\n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                ShopItemService.GetByClubId(vm.club_id)\n                    .then(function(data){\n                        vm.club.items = data.items;   \n                        //console.log(vm.club.items);\n                    });\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n        //'9' needs to refer the the user's account set to manage\n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        vm.clearFieldError = function(event) { ToastService.clearFieldError(event); };\n\n        $scope.save = function(){\n            if (!vm.club.item) vm.club.item = {};\n            var checks = [\n                { ok: vm.club.item.title,                                      field: 'title', label: 'Title' },\n                { ok: vm.club.item.price != null && vm.club.item.price !== '',  field: 'price', label: 'Price' }\n            ];\n            if (!ToastService.validateForm(checks)) return;\n\n            if(vm.action == \"add\"){\n                $scope.create();\n            } else {\n                $scope.update();\n            }\n        }\n\n\n        $scope.create = function(){\n            //console.log(\"CREATE ME NOW\");\n            vm.club.item.club_id = vm.club_id;\n            ShopItemService.Create(vm.club.item)\n                .then(function(data){\n                    //console.log(data);\n                    $state.go('dashboard.manage_club.shop_items');\n\n                });\n        }\n\n        $scope.delete = function(item){\n            var a = confirm(\"Are you sure you would like to delete this item?\");\n            if(a){\n                ShopItemService.Delete(vm.user.id, item.id)\n                .then(function(data){\n                    \n                    if(data.success){\n\n                         ShopItemService.GetByClubId(vm.club_id)\n                        .then(function(data){\n                            vm.club.items = data.items;   \n                            // //console.log(vm.club.items);\n                        });\n\n                    } else {\n                        ToastService.error('Delete Error', 'An error occurred when trying to delete this item.');\n                    }\n\n                });\n            }\n            \n        }\n\n        function get_update_docs(){\n            var documents = [];\n\n            for(var i=0;i<update_this_file.length;i++){\n                var id = update_this_file[i];\n                //console.log(\"looking for : \", id);\n                //console.log(\"in: \", vm.plane_documents);\n\n                for(var k=0;k<vm.club.plane.plane_documents.length;k++){\n                    //console.log(\"comparing to : \", vm.club.plane.plane_documents[k].id);\n                    if(vm.club.plane.plane_documents[k].id == id){\n                        documents.push(vm.club.plane.plane_documents[k]);\n                    }\n                }\n\n            }\n\n            // //console.log(\"DOCS TO UPDATE : \", documents);\n\n            return documents;\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n            vm.club.item.club_id = vm.club_id;\n            ShopItemService.Update(vm.club.item, vm.user.id)\n                .then(function(data){\n                    //console.log(data);\n                    //console.log(\"saved\");\n                    $state.go('dashboard.manage_club.shop_items');\n                });\n        }\n\n\n        function containsObject(obj, list, params) {\n\n            // //console.log(\"obj\", obj);\n            // //console.log(\"list\", list);\n            // //console.log(\"params\", params);\n\n            for(var i=0; i<list.length; i++) {\n                // //console.log(\"list i : \", list[i]);\n                // //console.log(\"obj is: \", obj);\n\n                var count_success = 0;\n                for(var j=0;j<params.length;j++){\n                    if(list[i][params[j]] && obj[params[j]] && list[i][params[j]] == obj[params[j]]){\n                        count_success++;\n                    }\n                }\n\n                if(count_success === params.length) {                    \n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n\n        function check_all(){\n\n            //maybe a nice to have one day... not yet though.\n\n\n            //licences\n            vm.club.plane.requirements.licence.forEach(function(obj){\n\n            });\n\n        }\n\n      \n\n\n\n        $scope.update_this_file = function(file){\n            //console.log(\"==== update is : \", file.id);\n            if(update_this_file.indexOf(file.id) === -1){\n                update_this_file.push(file.id)\n            } else {\n               ////console.log(\"This item already exists\"); \n            } \n        }\n\n\n         $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.club.plane.plane_documents = $.grep(vm.club.plane.plane_documents, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                PlaneDocumentService.Delete(vm.user.id, file.id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            //console.log(\"REMOVE: \", j);\n            //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            PoidService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n          // $scope.$on('flow::fileAdded', function (event, $flow, flowFile) {\n          //     event.preventDefault();//prevent file from uploading\n          //     //console.log(\"FILE ADDED\");\n          //     //console.log($flow);\n          //   });\n\n            $scope.processFiles = function(files){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    //console.log(\"J is : \",j);\n                    //console.log(\"name is : \", j.files.file.name);\n\n                    files[i].file.temp_path = j.saved_url;\n                    files[i].file.save_name = j.files.file.name;\n                    var ft = j.files.file.name;\n                    ft = ft.split('.').pop();\n                    files[i].file.extension = ft;\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.plane_documents.push(files[i].file);\n                }\n\n\n            }\n\n            $scope.set_title = function(file){\n                //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            $scope.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n\n         \n\n\n\n\n            $scope.save_plane_documents = function(){\n\n               \n              \n\n                //console.log(\"plane_documents: \", vm.plane_documents);\n\n\n                //compile the required elements YAY\n\n                //console.log(\"plane_document \", vm.plane_document);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n                    // for(var i=0;i<vm.plane_document.images.length;i++){\n                    //     delete vm.plane_document.images[i].data_uri;\n                    // }\n\n                    // // vm.plane_document.images = vm.plane_documents;\n                    // vm.plane_document.images = vm.plane_document.images.concat(vm.plane_documents);\n                    // vm.plane_document.user_id = vm.user_id;\n\n\n\n\n            //     if(vm.plane_document.id){\n            //         //then its an udpate\n\n            //         //merge the images left?\n            //         PoidService.Update(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                     $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n            //     } else {\n\n\n                   \n\n\n            //         //then its a create\n            //         //console.log(vm.plane_document);\n\n            //         PoidService.Create(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                    // $state.reload();\n            //                    // $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n\n            //     }\n\n\n\n             };\n\n\n\n\n             $scope.change_file_name = function(file){\n                \n                //this is terribly ineficient... unfortunately... can't \n                //work out how else to do it! (lol)\n\n                // //console.log(\"TO BE CHANGED\", file);\n\n                // //console.log(\"BEFORE BEFORE\", vm.plane_documents);\n\n                vm.plane_documents = $.grep(vm.plane_documents, function(e){ \n                    return e.temp_path != file.temp_path; \n                });\n\n                // //console.log(\"BEFORE\", vm.plane_documents);\n\n                vm.plane_documents.push(file);\n\n                // //console.log(\"AFTER\", vm.plane_documents);\n\n             }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n            var warning_msg = \"By deleting this plane, you will also cancel all reservations that this plane currently has.\"\n\n          $scope.open = function (plane_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return plane_id;\n                },\n                params: function() {\n                  return {id: plane_id};\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (plane_id) {\n              $log.info('PRESSED GO: '+plane_id.id);\n              ItemService.Delete(vm.user.id, plane_id.id)\n              .then(function(){\n                //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.items = $.grep(vm.club.items, function(e){ \n                    return e.id != plane_id.id; \n                });\n              })\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n          };\n\n         \n\n\n    }\n\n\n\n\n\n\n app.controller('DashboardClubShopSaleController', DashboardClubShopSaleController);\n\n    DashboardClubShopSaleController.$inject = ['$timeout', '$sce', 'ExperiencesService', 'PaymentService', '$scope', '$rootScope', 'MemberService', 'ClubService', 'ShopItemService', '$state', 'PackageService'];\n    function DashboardClubShopSaleController($timeout, $sce, ExperiencesService, PaymentService, $scope, $rootScope,   MemberService, ClubService, ShopItemService, $state, PackageService) {         \n\n          var vm = this;\n\n            $scope.to_refund = 0;\n            $scope.reason = \"\";\n            $scope.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n            vm.club_id = $scope.club_id;\n\n            $scope.club_settings = {};\n\n            $scope.new_client = {\n              first_name: \"\",\n              last_name: \"\",\n              email: \"\"\n            };\n\n            $scope.items = [];\n            $scope.item = {\n              title: \"\",\n              quantity: 1,\n              vat: 0,\n              price: 0\n            };\n\n            $scope.selected_client;\n            $scope.selected_card;\n\n            vm.selected_voucher;\n\n\n            $scope.members = [];\n\n            $scope.show_direct_debit_details = false;\n            vm.custom_item = false;\n\n\n            var iconBank = '<svg viewBox=\"0 0 24 24\"><path d=\"M3 10h18M4 10V8l8-5 8 5v2M5 10v8M9 10v8M15 10v8M19 10v8M3 18h18M2 20h20\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n            var iconCard = '<svg viewBox=\"0 0 24 24\"><rect x=\"2\" y=\"4\" width=\"20\" height=\"16\" rx=\"2\" ry=\"2\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><path d=\"M2 9h20M6 14h6\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n            var iconNew  = '<svg viewBox=\"0 0 24 24\"><circle cx=\"12\" cy=\"12\" r=\"9\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><path d=\"M12 8v8M8 12h8\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n            var iconTerm = '<svg viewBox=\"0 0 24 24\"><rect x=\"6\" y=\"2\" width=\"12\" height=\"14\" rx=\"2\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><rect x=\"8\" y=\"5\" width=\"8\" height=\"3\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><rect x=\"9\" y=\"10\" width=\"6\" height=\"3\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n            vm.close_pay_now = function(){\n               vm.show_pay_now = false;\n               vm.show_loading = false;\n            }\n\n              vm.donConfirm = function(methodLabel, paymentIntent){\n                // console.log(\"confirmation is called\", methodLabel);\n                // console.log(\"paymentIntent\", paymentIntent);\n              //alert('Parent received D confirmation: ' + methodLabel);\n                vm.complete_now(methodLabel, paymentIntent);\n              };\n\n              vm.default_payment = 'new-card';\n\n              vm.methods = [\n                { id: 'direct-debit', title: 'Direct Debit', subtitle: 'Use your BACS mandate', type: 'direct-debit', iconSvg: $sce.trustAsHtml(iconBank), visible: true },\n                { id: 'saved-card',   title: 'Saved card',   subtitle: 'Use a card on file',    type: 'saved-card',  iconSvg: $sce.trustAsHtml(iconCard), visible: true },\n                { id: 'new-card',     title: 'New card',     subtitle: 'Add a new debit/credit card', type: 'new-card', iconSvg: $sce.trustAsHtml(iconNew), visible: true },\n                { id: 'card-machine', title: 'Card Machine', subtitle: 'Pay in person',          type: 'card-machine', iconSvg: $sce.trustAsHtml(iconTerm), visible: true }\n              ];\n\n               vm.savedCards = [];\n\n\n\n             ShopItemService.GetByClubId(vm.club_id)\n                    .then(function(data){\n                        vm.shop_items = data.items;   \n                    });\n\n            ClubService.GetById($scope.club_id)\n            .then(function(data){\n                $scope.club_settings = data;\n                $scope.item.vat = parseFloat($scope.club_settings.vat_rate);                            \n                $scope.club_settings.vat_registered = ($scope.club_settings.vat_registered == 1)? true : false;\n                // //console.log(\"settings\", $scope.club_settings);\n            });\n\n           ExperiencesService.GetByClubId($scope.club_id)\n                  .then(function(data){\n                      //console.log(\"planes\", data);\n                      vm.vouchers = data.items;\n                  });\n            ExperiencesService.GetDiscountsByClubId($scope.club_id)\n                .then(function(data){\n                    //console.log(\"discounts\", data);\n                    vm.discounts = data.items;\n                });\n\n\n            PackageService.GetPackagesByClubId($scope.club_id)\n            .then(function(data){\n                vm.packages = data.items;\n\n                // //console.log(\"PACKPACK\", vm.packages);\n            });\n\n            MemberService.GetAllByClub($scope.club_id)\n                    .then(function(data){\n                        $scope.members = data;   \n                        $scope.members.unshift({id: -12, first_name: \"New\", last_name: \"Client\"});\n                        // $scope.item.title = \"hjel\";\n                        // //console.log(\"members\",$scope.members);\n                    });\n\n\n            $scope.delete_receipt = function(number){\n\n                \n              $scope.items.splice(number, 1);\n           \n              calculate_charges();\n\n            }\n\n            $scope.card_selected = function(data){\n              $scope.selected_card = data;\n\n              if(data.id == -12){\n                //  setTimeout(function(){\n                //   setupStripe();\n                // }, 1000);\n              }\n\n            }\n\n            $scope.member_selected = function(data){\n              //console.log(\"selected\", data);\n              \n              $scope.selected_client = data;\n\n              if(data && data.account_ending && data.account_ending !== ''){\n                  $scope.show_direct_debit_details = true;\n                } else {\n                  $scope.show_direct_debit_details = false;\n                  //  setTimeout(function(){\n                  //   setupStripe();\n                  // }, 1000);\n\n\n                }\n\n              if(data && data.id == -12){\n                \n                // setTimeout(function(){\n                //   setupStripe();\n                // }, 1000);\n\n              } \n            }\n\n            $scope.selected_item;\n\n            $scope.item_selected = function(item){\n              // //console.log(item);\n              $scope.selected_item = item;\n            }\n\n            $scope.package_selected = function(item){\n              // //console.log(item);\n              $scope.selected_package = item;\n            }\n\n\n                vm.new_item_qty = 1;\n\n            vm.add_selected_voucher = function(){\n\n              if($scope.items.find(x => x.voucher_id === vm.selected_voucher.id) && vm.selected_voucher.id > 0){\n\n                  // //console.log(\"already exists\");\n                  $scope.items.find(x => x.voucher_id === vm.selected_voucher.id).quantity = $scope.items.find(x => x.voucher_id === vm.selected_voucher.id).quantity + 1;\n\n                } else {\n                  if(vm.selected_voucher.id > 0){\n                    var add_me = vm.selected_voucher;\n                    add_me.quantity = 1;\n                    add_me.item_id = vm.selected_voucher.id;\n                    \n                    add_me.unit_price = vm.selected_voucher.price;\n\n                    add_me.voucher_id = vm.selected_voucher.id;\n                    if(vm.selected_discount && vm.selected_discount.id && vm.selected_discount.id > 0){\n                      add_me.discount_id = vm.selected_discount.id;\n                    } else {\n                      add_me.discount_id = 0;\n                    }\n\n                    if(add_me.vat_rate){\n                      add_me.vat = parseFloat(vm.selected_voucher.vat_rate);\n                      delete(add_me.vat_rate);\n                    }\n                    $scope.items.push(add_me);\n                  }\n                   \n                }\n\n\n                // //console.log(\"OBJ TO SEND: \", $scope.item);\n\n               \n                $scope.item = {\n                            quantity: 1,\n                            price: 0,\n                            vat: parseFloat($scope.club_settings.vat_rate),\n                            title: \"\"\n                          };\n                \n                vm.new_item_qty = 1;\n\n                calculate_charges();\n\n                ExperiencesService.GetDiscountsByClubIdAndExperienceId($scope.club_id, vm.selected_voucher.id)\n                .then(function(data){\n                    ////console.log(\"discounts\", data);\n                    vm.discounts = data.items;\n                });\n\n            }\n\n            vm.add_selected_discount = function(){\n\n                var new_price = 0;\n\n                if(vm.selected_discount.discount_type == 1){\n                    //fixed price\n                    new_price = vm.selected_discount.discount.price;\n                } else {\n                    //percentage...\n                    new_price = vm.selected_voucher.price - (vm.selected_voucher.price * (vm.selected_discount.percentage / 100) );\n\n                }\n\n\n                if($scope.items.find(x => x.voucher_id === vm.selected_voucher.id) && vm.selected_voucher.id > 0){\n\n                  // //console.log(\"already exists\");\n                  $scope.items.find(x => x.voucher_id === vm.selected_voucher.id).price = new_price;\n                  $scope.items.find(x => x.voucher_id === vm.selected_voucher.id).unit_price = new_price;\n                  $scope.items.find(x => x.voucher_id === vm.selected_voucher.id).discount_id = vm.selected_discount.id;\n                  $scope.items.find(x => x.voucher_id === vm.selected_voucher.id).discount_code = vm.selected_discount.discount_code;\n                  // $scope.items.find(x => x.voucher_id === vm.selected_voucher.id).price = new_price;\n                                              // vat: parseFloat($scope.club_settings.vat_rate),\n\n\n                }\n                //$scope.items.push(add_me);\n\n\n                                calculate_charges();\n\n            }\n\n            $scope.add_selected_item = function(){\n\n\n                // //console.log(\"HELLO ADDING\", item_sent);\n                 // //console.log(\"HELLO ADDING\", $scope.items.find(x => x.id === $scope.selected_item.id));\n                \n\n                if($scope.items.find(x => x.item_id === $scope.selected_item.id)){\n\n                  // //console.log(\"already exists\");\n                  $scope.items.find(x => x.item_id === $scope.selected_item.id).quantity = $scope.items.find(x => x.item_id === $scope.selected_item.id).quantity + vm.new_item_qty;\n\n                } else {\n                    var add_me = $scope.selected_item;\n                    add_me.quantity = vm.new_item_qty;\n                    add_me.item_id = $scope.selected_item.id;\n                    if(add_me.vat_rate){\n                      add_me.vat = parseFloat($scope.selected_item.vat_rate);\n                      delete(add_me.vat_rate);\n                    }\n                    $scope.items.push(add_me);\n\n                }\n\n\n\n                // //console.log(\"OBJ TO SEND: \", $scope.item);\n\n               \n                $scope.item = {\n                            quantity: 1,\n                            price: 0,\n                            vat: parseFloat($scope.club_settings.vat_rate),\n                            title: \"\"\n                          };\n                \n                vm.new_item_qty = 1;\n\n                calculate_charges();\n\n            }\n\n\n            $scope.selected_package;             \n\n\n            $scope.add_selected_package = function(){\n\n\n                // //console.log(\"HELLO ADDING\", item_sent);\n                \n\n                if($scope.items.find(x => x.package_id === $scope.selected_package.id)){\n\n                  //console.log(\"already exists\");\n                  $scope.items.find(x => x.package_id === $scope.selected_package.id).quantity++;\n\n                } else {\n                    var add_me = $scope.selected_package;\n                    add_me.quantity = 1;\n                    add_me.package_id = $scope.selected_package.id;\n                    add_me.vat_rate = parseFloat($scope.club_settings.vat_rate)\n                    if(add_me.vat_rate){\n                      add_me.package_id = $scope.selected_package.id;\n                      add_me.vat = $scope.selected_package.vat_rate;\n                      delete(add_me.vat_rate);\n                    }\n                    $scope.items.push(add_me);\n\n                }\n\n\n\n                // //console.log(\"OBJ TO SEND: \", $scope.item);\n\n               \n                $scope.item = {\n                            quantity: 1,\n                            price: 0,\n                            vat: parseFloat($scope.club_settings.vat_rate),\n                            title: \"\"\n                          };\n                \n                vm.new_item_qty = 1;\n\n                calculate_charges();\n            }\n\n            \n\n\n            $scope.add_item = function(item_sent){\n                $scope.item = item_sent;\n\n                // //console.log(\"HELLO ADDING\", item_sent);\n                // //console.log(\"HELLO ADDING\", $scope.items);\n\n                $scope.items.push($scope.item);\n\n                // //console.log(\"OBJ TO SEND: \", $scope.item);\n\n               \n                $scope.item = {\n                            quantity: 1,\n                            price: 0,\n                            vat: parseFloat($scope.club_settings.vat_rate),\n                            title: \"\"\n                          };\n\n                calculate_charges();\n\n            }\n\n\n            function calculate_charges(){\n\n\n              // //console.log(\"Calculate everything now...\");\n              var total = 0;\n              var the_vat = 0;\n              for(var i=0; i < $scope.items.length; i++){\n\n                $scope.items[i].total = ($scope.items[i].quantity * $scope.items[i].price);\n                if($scope.items[i].vat > 0){\n                  this_vat = ( $scope.items[i].total * ($scope.items[i].vat / 100) );\n                  the_vat = the_vat + this_vat;\n                }\n                total = total + $scope.items[i].total;\n\n              }\n\n              $scope.the_vat = the_vat;\n              $scope.the_total = total;\n\n            }\n\n\n          vm.complete_now = function(method, paymentIntent){\n              //user_id\n              //club_id\n              //invoice_id\n              //\n\n              var obj = {\n                user_id: $scope.selected_client.user_id,\n                club_id: $scope.club_id,\n                user: $scope.selected_client,\n                invoice_id: vm.invoice_id,\n                method: method,\n                paymentIntent: paymentIntent\n              }\n\n              PaymentService.CompleteCustom(obj)\n                .then(function (data) {\n                    if(data.success){\n                      console.log(\"complete\", data);\n                      //alert(\"success!\");\n\n                      $timeout(function() {\n                        $state.go('dashboard.manage_club', {}, { reload: true });\n                      }, 2000); // delay in milliseconds (2 seconds here)\n\n                      //$state.go('dashboard.manage_club', {}, { reload: true });\n\n                    }\n              });\n\n          }\n           \n          vm.invoice_id = 0;\n\n          $scope.ok = function () {\n\n\n            //guessing this is where it would all be happening 14/11/2025\n\n            //all we need to do is call the payment with \"amount\"\n            //then we add the payment_id to the request below --> unless this is Direct Debit for existing client\n\n            //some nice ideas about what to offer admins to be able to enter\n\n\n\n            vm.show_loading = true;\n\n            // obj.reason = $scope.reason;\n            // obj.to_refund = $scope.to_refund\n\n\n            //let's create all that is required to issue the invoice.\n            if($scope.selected_client.id == -12){\n\n\n              $scope.selected_client.first_name = $scope.new_client.first_name;\n              $scope.selected_client.last_name = $scope.new_client.last_name;\n              $scope.selected_client.email = $scope.new_client.email;\n\n            } else{\n\n               $scope.selected_client.first_name = $scope.selected_client.first_name;\n               $scope.selected_client.last_name = $scope.selected_client.last_name;\n               $scope.selected_client.email = $scope.selected_client.email;\n            \n            }\n\n\n            var obj_to_send = {\n                items: $scope.items,\n                user: $scope.selected_client,\n                user_id: $scope.selected_client.user_id,\n                club_id: $scope.club_id\n              };\n\n\n              // SAMPLE OF WHERE WE NEED TO SEND THE SHIZZLE....\n              PaymentService.CreateCustom(obj_to_send)\n              .then(function (data) {\n                  if(data.success){\n                    //alert(\"Invoice successfully created!\");\n                      ////console.log(\"CARD: \"+data);\n                      //fill the drop down menu\n\n                      //show payment now\n                      vm.invoice_id = data.invoice_id;\n                      //set payment bits here woo\n                        vm.send = {\n                            club_id: data.club_id,\n                            user_id: data.user_id,\n                            invoice_id: data.invoice_id\n                        }\n                        //console.log(vm.send);\n                        \n                        //get user cards\n                        //get user info\n\n                        MemberService.GetMandate(data.user_id, data.club_id)\n                                .then(function (data) {\n                                       // console.log(\"data is : \", data);\n                                         //return false;\n                                if(data.success){\n                                    vm.info = data.info;\n\n                                    vm.savedCards = data.cards;\n\n                                    if(vm.savedCards.length > 0){\n                                        vm.methods[1].visible = true;\n                                    } else {\n                                        vm.methods[1].visible = false;\n                                    }\n\n                                    if(vm.info == null){\n                                        vm.methods[0].visible = false;\n                                    } else {\n                                        vm.methods[0].visible = true;\n                                    }\n\n                                    vm.machine = data.machine;\n                                    if(vm.machine.success){\n                                        vm.methods[3].visible = true;\n                                    } else {\n                                        vm.methods[3].visible = false;\n                                    }\n\n                                    vm.show_pay_now = true;\n                                    vm.show_loading = false;\n                                }\n\n                            });\n\n                       \n\n                    \n\n\n\n                      //vm.show_loading = false;\n                  } else {\n                      //console.log(\"WOOOPSIES...\", data);\n                      //this should be very very rare...\n                      vm.show_loading = false;\n\n                  }\n\n              });\n\n\n\n\n\n\n\n            // if($scope.selected_client.id == -12 || !$scope.show_direct_debit_details){\n            //   //if there is a custom card entered - then we continue here...\n            //   var obj_to_send = {\n            //     payment: card_obj,\n            //     items: $scope.items,\n            //     user: $scope.selected_client,\n            //     club_id: $scope.club_id\n            //   };\n\n\n            //   // SAMPLE OF WHERE WE NEED TO SEND THE SHIZZLE....\n            //   PaymentService.CreateCustom(obj_to_send)\n            //   .then(function (data) {\n            //       if(data.success){\n            //         alert(\"Invoice successfully created & payment made!\");\n            //           ////console.log(\"CARD: \"+data);\n            //           //fill the drop down menu\n            //           $state.go('dashboard.manage_club', {}, { reload: true });\n            //            vm.show_loading = false;\n            //       } else {\n            //           //console.log(\"WOOOPSIES...\", data);\n            //           //this should be very very rare...\n            //            vm.show_loading = false;\n\n            //       }\n\n            //   });\n\n\n            //   var options = {};\n            //   // stripe.createToken(card, options).then(function(result) {\n            //   //   if (result.error) {\n            //   //     // Inform the user if there was an error\n            //   //     var errorElement = document.getElementById('card-errors');\n            //   //     errorElement.textContent = result.error.message;\n            //   //   } else {\n\n            //   //     //stripeTokenHandler(result.token);\n            //   //     ////console.log(\"RESULT\", result);\n\n            //   //     if(result.token.id){\n            //   //       ////console.log(\"STUFF\", result.token.id);\n\n            //   //       //prepare a basic object...\n            //   //       var card_obj = {\n            //   //           brand: result.token.card.brand,\n            //   //           last4: result.token.card.last4,\n            //   //           hash: result.token.card.id,\n            //   //           token: result.token.id,\n            //   //           funding: result.token.card.funding,\n            //   //           name: result.token.card.name,\n            //   //           client_ip: result.token.client_ip\n            //   //       };\n\n\n            //   //       var obj_to_send = {\n            //   //         payment: card_obj,\n            //   //         items: $scope.items,\n            //   //         user: $scope.selected_client,\n            //   //         club_id: $scope.club_id\n            //   //       };\n\n\n            //   //       // SAMPLE OF WHERE WE NEED TO SEND THE SHIZZLE....\n            //   //       PaymentService.CreateCustom(obj_to_send)\n            //   //       .then(function (data) {\n            //   //           if(data.success){\n            //   //             alert(\"Invoice successfully created & payment made!\");\n            //   //               ////console.log(\"CARD: \"+data);\n            //   //               //fill the drop down menu\n            //   //               $state.go('dashboard.manage_club', {}, { reload: true });\n            //   //                vm.show_loading = false;\n            //   //           } else {\n            //   //               //console.log(\"WOOOPSIES...\", data);\n            //   //               //this should be very very rare...\n            //   //                vm.show_loading = false;\n\n            //   //           }\n\n            //   //       });\n                    \n\n\n            //   //     }\n\n            //   //   }\n            //   // });\n\n            // } else {\n\n            //   //this should now be when we charge a saved card.\n\n            //   //create a new charge request? is that server side?\n\n\n            //   // var obj_to_send = {\n            //   //     payment: {},\n            //   //     items: $scope.items,\n            //   //     user: $scope.selected_client,\n            //   //     club_id: $scope.club_id\n            //   //   };\n\n            //   //   if($scope.selected_client.account_ending !== \"\"){\n            //   //     obj_to_send.payment.direct_debit = true;\n            //   //     obj_to_send.payment.pay_now = vm.direct_debit_pay_now;\n            //   //   }\n\n\n            //   // PaymentService.CreateCustom(obj_to_send)\n            //   //       .then(function (data) {\n            //   //           if(data.success){\n            //   //               alert(\"Invoice successfully created!\");\n\n            //   //               //$state.go('dashboard.my_account.payment_methods', {}, { reload: true });\n            //   //               $state.go('dashboard.manage_club', {}, { reload: true });\n            //   //           } else {\n            //   //               //console.log(\"WOOOPSIES...\", data);\n            //   //               //this should be very very rare...\n\n            //   //           }\n            //   //       });\n\n\n            //   var obj_to_send = {\n            //     payment: card_obj,\n            //     items: $scope.items,\n            //     user: $scope.selected_client,\n            //     club_id: $scope.club_id\n            //   };\n\n\n            //   // SAMPLE OF WHERE WE NEED TO SEND THE SHIZZLE....\n            //   PaymentService.CreateCustom(obj_to_send)\n            //   .then(function (data) {\n            //       if(data.success){\n            //         alert(\"Invoice successfully created & payment made!\");\n            //           ////console.log(\"CARD: \"+data);\n            //           //fill the drop down menu\n            //           $state.go('dashboard.manage_club', {}, { reload: true });\n            //            vm.show_loading = false;\n            //       } else {\n            //           //console.log(\"WOOOPSIES...\", data);\n            //           //this should be very very rare...\n            //            vm.show_loading = false;\n\n            //       }\n\n            //   });\n\n\n\n\n\n\n\n            //   //then we don't need a stripe token...\n\n            //    // SAMPLE OF WHERE WE NEED TO SEND THE SHIZZLE....\n            //   // PaymentService.Create(obj)\n            //   // .then(function (data) {\n            //   //     if(data.success){\n\n            //   //         //console.log(\"CARD: \"+data);\n            //   //         //fill the drop down menu\n            //   //         $state.go('dashboard.my_account.payment_methods', {}, { reload: true });\n            //     //            $uibModalInstance.close(obj);\n\n            //   //     } else {\n            //   //         //console.log(\"WOOOPSIES...\", data);\n            //   //         //this should be very very rare...\n\n            //   //     }\n            //   // });\n\n\n\n\n\n            // }\n            \n\n\n\n\n          };\n\n          $scope.cancel = function () {\n\n                            $state.go('dashboard.manage_club', {}, { reload: true });\n\n          };\n\n         \n\n\n\n\n\n\n\n\n          //STRIPE STUFF HERE PLEASE!!! :-)\n\n\n        // var stripe = Stripe('pk_test_Ers4ZfdIMZ59ac4wKy6FDAH2');\n        // var elements = stripe.elements();\n\n        // var card_options = {\n        //       hidePostalCode: true,\n        //       style: {\n        //         base: {\n        //           iconColor: '#666EE8',\n        //           color: '#31325F',\n        //           lineHeight: '40px',\n        //           fontWeight: 300,\n        //           fontFamily: 'Helvetica Neue',\n        //           fontSize: '15px',\n        //           '::placeholder': {\n        //             color: '#CFD7E0',\n        //           },\n        //         },\n        //       }\n        //     };\n\n        // var card = elements.create('card', card_options);\n\n        // var run = false;\n        // var timeout;\n\n        // function setupStripe(){\n        //     clearTimeout(timeout);\n        //     if(run == false){\n        //         run = true;\n\n        //         card.mount('#card-element');\n            \n        //         form = document.getElementById('payment-form');\n        //         form.addEventListener('submit', function(e) {\n        //           e.preventDefault();\n        //           createToken();\n        //         });\n        //     } \n        // }   \n\n\n        // // $scope.$on('$viewContentLoaded', function(){\n        // //         clearTimeout(timeout);\n        // //         if(run2 == false){\n        // //             run2 = true;\n        // //             timeout = setTimeout(function(){ setupStripe(); }, 1500); \n        // //         }\n        // // });\n\n     \n\n        // function stripeTokenHandler(token) {\n        //   // Insert the token ID into the form so it gets submitted to the server\n        //   var form = document.getElementById('payment-form');\n        //   var hiddenInput = document.createElement('input');\n        //   hiddenInput.setAttribute('type', 'hidden');\n        //   hiddenInput.setAttribute('name', 'stripeToken');\n        //   hiddenInput.setAttribute('value', token.id);\n        //   form.appendChild(hiddenInput);\n\n        //   // Submit the form\n        //   ////console.log(\"TOKEN\", token);\n        //   //form.submit();\n        // }\n\n        // function create_invoice() {\n        //   ////console.log(\"HELLO CREATE TOKEN? 1\");\n        //    var options = {\n        //     // name: document.getElementById('name').value,\n        //     //  address_line1: document.getElementById('address-line1').value,\n        //     // address_line2: document.getElementById('address-line2').value,\n        //     // address_city: document.getElementById('address-city').value,\n        //     // address_zip: document.getElementById('address-postcode').value,\n        //     // address_country: document.getElementById('address-country').value,\n        //   };\n\n        //   stripe.createToken(card, options).then(function(result) {\n        //     if (result.error) {\n        //       // Inform the user if there was an error\n        //       var errorElement = document.getElementById('card-errors');\n        //       errorElement.textContent = result.error.message;\n        //     } else {\n        //       // Send the token to your server\n        //       //stripeTokenHandler(result.token);\n        //       ////console.log(\"RESULT\", result);\n\n        //       if(result.token.id){\n        //       ////console.log(\"STUFF\", result.token.id);\n\n        //         //prepare a basic object...\n        //         var obj = {\n        //             user_id: vm.user.id,\n        //             brand: result.token.card.brand,\n        //             last4: result.token.card.last4,\n        //             hash: result.token.card.id,\n        //             token: result.token.id,\n        //             funding: result.token.card.funding,\n        //             name: result.token.card.name,\n        //             client_ip: result.token.client_ip\n        //         };\n\n\n        //         PaymentService.Create(obj)\n        //         .then(function (data) {\n        //             if(data.success){\n\n        //                 //console.log(\"CARD: \"+data);\n        //                 //fill the drop down menu\n        //                 alert(\"success creating invoice\");\n        //                 //$state.go('dashboard.my_account.payment_methods', {}, { reload: true });\n\n        //             } else {\n        //                 //console.log(\"WOOOPSIES...\", data);\n        //                 //this should be very very rare...\n\n        //             }\n        //         });\n\n\n\n        //       }\n\n        //     }\n        //   });\n        // };\n\n\n\n\n\n\n\n    }\n app.controller('DashboardClubVouchersAddController', DashboardClubVouchersAddController);\n\n    DashboardClubVouchersAddController.$inject = ['UserService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'LicenceService', 'MedicalService', 'DifferencesService', 'ExperiencesService', 'VoucherService', 'EnvConfig', 'ToastService'];\n    function DashboardClubVouchersAddController(UserService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, LicenceService, MedicalService, DifferencesService, ExperiencesService, VoucherService, EnvConfig, ToastService) {\n        var vm = this;\n\n        //console.log(\"HELLOOOO ADD vouchers\");\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {\n            item: {\n            }\n        };\n        vm.page_title = \"\";\n        \n        vm.plane_document = {};\n        vm.plane_documents = [];\n\n        var update_this_file = [];\n        \n\n        vm.action = $state.current.data.action;\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n        vm.charge_type = [\"brakes\", \"session\", \"plane\"];\n\n        vm.discounts = [];\n\n        vm.planes = [];\n        vm.show_paid = false;\n\n        ExperiencesService.GetByClubId(vm.club_id)\n                    .then(function(data){\n                        //console.log(\"planes\", data);\n                        vm.experiences = data.items;\n                    });\n\n\n\n\n    \n                //console.log(\"adding a new plane please\");\n                vm.page_title = \"Add a Voucher\";\n\n                VoucherService.GetUniqueCode(vm.club_id)\n                    .then(function(data){\n                        //console.log(data);\n                        vm.club.item.code = data.code;\n                    });\n\n\n                var stripe = Stripe(EnvConfig.getStripeKeyLegacy());\n                var elements = stripe.elements();\n\n                var card_options = {\n                      hidePostalCode: true,\n                      style: {\n                        base: {\n                          iconColor: '#666EE8',\n                          color: '#31325F',\n                          lineHeight: '40px',\n                          fontWeight: 300,\n                          fontFamily: 'Helvetica Neue',\n                          fontSize: '15px',\n                          '::placeholder': {\n                            color: '#CFD7E0',\n                          },\n                        },\n                      }\n                    };\n\n                var card = elements.create('card', card_options);\n                var form;\n\n                var timeout;\n                var run = false;\n                var run2 = false;\n\n                ExperiencesService.GetDiscountsByClubId(vm.club_id)\n                .then(function(data){\n                    //console.log(\"discounts\", data);\n                    vm.discounts = data.items;\n                });\n\n                function setupStripe(){\n                    clearTimeout(timeout);\n                    if(run == false){\n                        run = true;\n\n                        card.mount('#card-element');\n                    \n                        form = document.getElementById('payment-form2');\n                        form.addEventListener('submit', function(e) {\n                          e.preventDefault();\n                          createToken();\n                        });\n                    } \n                }   \n                $scope.$on('$viewContentLoaded', function(){\n                        clearTimeout(timeout);\n                        if(run2 == false){\n                            run2 = true;\n                            timeout = setTimeout(function(){ setupStripe(); }, 1500); \n                        }\n                });\n\n             \n\n                function stripeTokenHandler(token) {\n                  // Insert the token ID into the form so it gets submitted to the server\n                  var form = document.getElementById('payment-form');\n                  var hiddenInput = document.createElement('input');\n                  hiddenInput.setAttribute('type', 'hidden');\n                  hiddenInput.setAttribute('name', 'stripeToken');\n                  hiddenInput.setAttribute('value', token.id);\n                  form.appendChild(hiddenInput);\n\n                  // Submit the form\n                  //console.log(\"TOKEN\", token);\n                  //form.submit();\n                }\n\n                function createToken() {\n                  \n                };\n\n\n\n\n        //'9' needs to refer the the user's account set to manage\n       \n\n        $scope.check_code = function(){\n            //console.log(\"CHECKING NOW\");\n        }\n\n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        vm.clearFieldError = function(event) { ToastService.clearFieldError(event); };\n\n        $scope.save = function(){\n            var checks = [\n                { ok: vm.club.item.experience && vm.club.item.experience.id, field: 'voucher_experience', label: 'Experience' },\n                { ok: vm.club.item.first_name, field: 'first_name', label: 'First Name' },\n                { ok: vm.club.item.last_name,  field: 'last_name',  label: 'Last Name' },\n                { ok: vm.club.item.email,      field: 'email',      label: 'Email Address' },\n                { ok: vm.club.item.code,       field: 'code',       label: 'Voucher Code' },\n                { ok: vm.club.item.expiry_date, field: 'expiry_date', label: 'Expiry Date' }\n            ];\n            if (vm.already_paid) {\n                checks.push({ ok: vm.club.item.price_paid != null && vm.club.item.price_paid >= 0, field: 'price_paid', label: 'Price Paid' });\n                checks.push({ ok: vm.club.item.payment_method, field: 'payment_method', label: 'Payment Method' });\n            }\n            if (!ToastService.validateForm(checks)) return;\n\n            if(vm.action == \"add\"){\n                $scope.create();\n            } else {\n                $scope.update();\n            }\n        }\n\n        $scope.create = function(){\n            //console.log(\"CREATE ME NOW\");\n\n\n            //first sanity check goes here...\n            if(!vm.club.item.experience || !vm.club.item.experience.id){\n                ToastService.warning('Selection Required', 'You must select an experience to issue this voucher.');\n                return false;\n            }\n            if(!vm.club.item.first_name || !vm.club.item.last_name || !vm.club.item.email){\n                ToastService.warning('Missing Details', \"You must enter the purchasor's first name, last name and email address.\");\n                return false;\n            }\n\n            if(vm.already_paid){\n                if(vm.club.item.price_paid < 0 || !vm.club.item.payment_method){\n                    ToastService.warning('Payment Required', 'Please fill in how much was paid and what payment method was used to complete the payment.');\n                    return false;\n                }\n            }\n\n\n\n\n\n\n            vm.club.item.experience_title = vm.club.item.experience.title;\n            vm.club.item.experience_id = vm.club.item.experience.id;\n            if(vm.club.item.discount && vm.club.item.discount.id >0){\n                vm.club.item.discount_id = vm.club.item.discount.id;\n            }\n\n            //applying a discount?\n            //vm.club.item.price = vm.club.item.experience.price;\n            \n\n           \n            vm.club.item.club_id = vm.club_id;\n\n\n            if(!vm.already_paid){\n\n                   var options = {\n                    name: document.getElementById('name').value,\n                    address_zip: document.getElementById('address-postcode').value,\n                  };\n\n                  stripe.createToken(card, options).then(function(result) {\n                    if (result.error) {\n                      // Inform the user if there was an error\n                      var errorElement = document.getElementById('card-errors');\n                      errorElement.textContent = result.error.message;\n                    } else {\n                      // Send the token to your server\n                      //stripeTokenHandler(result.token);\n                      ////console.log(\"RESULT\", result);\n\n                      if(result.token.id){\n                      ////console.log(\"STUFF\", result.token.id);\n\n                        //prepare a basic object...\n                        var obj = {\n                            user_id: vm.user.id,\n                            brand: result.token.card.brand,\n                            last4: result.token.card.last4,\n                            hash: result.token.card.id,\n                            token: result.token.id,\n                            exp_month: result.token.card.exp_month,\n                            exp_year: result.token.card.exp_year,\n                            funding: result.token.card.funding,\n                            name: result.token.card.name,\n                            address_postcode: result.token.card.address_zip,\n                            client_ip: result.token.client_ip\n                        };\n\n                        vm.club.item.payment = obj;\n\n                        delete vm.club.item.experience;\n                        //delete vm.club.item.discount;\n\n                        //console.log(\"READY WITH : \", vm.club.item);\n                        //return false;\n                        \n                        VoucherService.Create(vm.club.item)\n                        .then(function(data){\n                            //console.log(data);\n                            //$state.reload();\n                            $state.go('dashboard.manage_club.vouchers', {}, {reload: true});\n\n                        });\n\n\n\n                      }\n\n                    }\n                  });\n\n              } else {\n                //then the payment was already taken by other means...\n                var obj = {\n                    payment_method: vm.club.item.payment_method,\n                    amount: vm.club.item.price_paid \n                }\n\n                vm.club.item.price = vm.club.item.price_paid;\n\n                vm.club.item.payment = obj;\n                \n                delete vm.club.item.payment_method;\n                delete vm.club.item.price_paid;\n\n                //console.log(\"READY WITH NO STRIPE : \", vm.club.item);\n\n                        //return false;\n\n                VoucherService.Create(vm.club.item)\n                    .then(function(data){\n                        //console.log(data);\n                        //$state.reload();\n                        $state.go('dashboard.manage_club.vouchers', {}, {reload: true});\n\n                    });\n\n              }\n\n\n\n           \n        }\n\n        $scope.delete = function(){\n            //console.log(\"CLICK\");\n            ToastService.warning('Confirm Delete', 'Are you sure you would like to delete this voucher?');\n            VoucherService.Delete(vm.user.id, vm.club.item)\n                .then(function(data){\n                    //console.log(data);\n                });\n        }\n\n        function get_update_docs(){\n            var documents = [];\n\n            for(var i=0;i<update_this_file.length;i++){\n                var id = update_this_file[i];\n                //console.log(\"looking for : \", id);\n                //console.log(\"in: \", vm.plane_documents);\n\n                for(var k=0;k<vm.club.plane.plane_documents.length;k++){\n                    //console.log(\"comparing to : \", vm.club.plane.plane_documents[k].id);\n                    if(vm.club.plane.plane_documents[k].id == id){\n                        documents.push(vm.club.plane.plane_documents[k]);\n                    }\n                }\n\n            }\n\n            // //console.log(\"DOCS TO UPDATE : \", documents);\n            return documents;\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n            vm.club.item.club_id = vm.club_id;\n            VoucherService.Update(vm.club.item, vm.user.id)\n                .then(function(data){\n                    //console.log(data);\n                    //console.log(\"saved\");\n                    //$state.reload();\n                    $state.go('dashboard.manage_club.vouchers', {}, {reload: true});\n                });\n        }\n\n        $scope.update_experience = function(){\n            //console.log(\"UPDATE EXP\");\n            var days = vm.club.item.experience.valid_for;\n            if(days > 0){\n                 var expiry_date = moment().day(+days);\n                //console.log(\"NEW DATE: \", expiry_date);\n                vm.club.item.expiry_date = new Date(expiry_date);\n            } else {\n                var expiry_date = moment().year(+2100);\n                vm.club.item.expiry_date = new Date(expiry_date);\n            }\n            vm.club.item.price = vm.club.item.experience.price;\n\n            ExperiencesService.GetDiscountsByClubIdAndExperienceId(vm.club_id, vm.club.item.experience.id)\n            .then(function(data){\n                ////console.log(\"discounts\", data);\n                vm.discounts = data.items;\n            });\n\n        }\n\n        $scope.update_discount = function(){\n\n            if(vm.club.item.discount.discount_type == 1){\n                //fixed price\n                vm.club.item.price = vm.club.item.discount.price;\n            } else {\n                //percentage...\n                vm.club.item.price = vm.club.item.experience.price - (vm.club.item.experience.price * (vm.club.item.discount.percentage / 100) );\n\n            }\n\n        }\n\n        function containsObject(obj, list, params) {\n\n            // //console.log(\"obj\", obj);\n            // //console.log(\"list\", list);\n            // //console.log(\"params\", params);\n\n            for(var i=0; i<list.length; i++) {\n                // //console.log(\"list i : \", list[i]);\n                // //console.log(\"obj is: \", obj);\n\n                var count_success = 0;\n                for(var j=0;j<params.length;j++){\n                    if(list[i][params[j]] && obj[params[j]] && list[i][params[j]] == obj[params[j]]){\n                        count_success++;\n                    }\n                }\n\n                if(count_success === params.length) {                    \n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n\n\n\n        function check_all(){\n\n            //maybe a nice to have one day... not yet though.\n\n\n            //licences\n            vm.club.plane.requirements.licence.forEach(function(obj){\n\n            });\n\n        }\n\n      \n\n        initController();\n\n        function initController() {\n\n\n\n\n        }\n\n\n        var warning_msg = \"By deleting this plane, you will also cancel all reservations that this plane currently has.\"\n\n          $scope.open = function (plane_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return plane_id;\n                },\n                params: function() {\n                  return {id: plane_id};\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (plane_id) {\n              $log.info('PRESSED GO: '+plane_id.id);\n              ExperiencesService.Delete(vm.user.id, plane_id.id)\n              .then(function(){\n                //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.items = $.grep(vm.club.items, function(e){ \n                    return e.id != plane_id.id; \n                });\n              })\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n          };\n\n         \n\n\n    }\n app.controller('DashboardClubVouchersController', DashboardClubVouchersController);\n\n    DashboardClubVouchersController.$inject = ['UserService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'LicenceService', 'MedicalService', 'DifferencesService', 'ExperiencesService', 'VoucherService', 'ToastService'];\n    function DashboardClubVouchersController(UserService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, LicenceService, MedicalService, DifferencesService, ExperiencesService, VoucherService, ToastService) {\n        var vm = this;\n\n        //console.log(\"HELLOOOO vouchers\");\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {\n            item: {\n            }\n        };\n        vm.page_title = \"\";\n        \n        vm.plane_document = {};\n        vm.plane_documents = [];\n\n        var update_this_file = [];\n        \n\n        vm.action = $state.current.data.action;\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n        vm.charge_type = [\"brakes\", \"session\", \"plane\"];\n\n        vm.discounts = [];\n\n        vm.planes = [];\n   \n\n        ExperiencesService.GetByClubId(vm.club_id)\n                    .then(function(data){\n                        //console.log(\"planes\", data);\n                        vm.experiences = data.items;\n                    });\n\n\n\n\n        ////console.log(\"club_id : \"+vm.club_id);\n\n        // //console.log(vm.action);\n         //console.log($stateParams);\n        // //console.log($stateParams.id);\n      \n                //need to update this to be part of the authentication\n                //to find out club id\n                VoucherService.GetByClubId(vm.club_id)\n                    .then(function(data){\n                        vm.club.items = data.items;   \n                        //console.log(vm.club.items);\n                    });\n           \n\n        //'9' needs to refer the the user's account set to manage\n       \n\n        $scope.check_code = function(){\n            //console.log(\"CHECKING NOW\");\n        }\n\n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        $scope.save = function(){\n            if(vm.action == \"add\"){\n                //console.log(\"CREATE click\");\n                $scope.create();\n            } else {\n                //console.log(\"EDIT click\");\n                //console.log(vm.club.plane);\n                $scope.update();\n            }\n        }\n\n\n        $scope.create = function(){\n            //console.log(\"CREATE ME NOW\");\n\n\n            //first sanity check goes here...\n            if(!vm.club.item.experience || !vm.club.item.experience.id){\n                ToastService.warning('Missing Experience', 'You must select an experience to issue this voucher');\n                return false;\n            }\n            if(!vm.club.item.first_name || !vm.club.item.last_name || !vm.club.item.email){\n                ToastService.warning('Missing Details', \"You must enter the purchasor's first name, last name and email address.\");\n                return false;\n            }\n\n            if(vm.already_paid){\n                if(!vm.club.item.price_paid || !vm.club.item.payment_method){\n                    ToastService.warning('Payment Details', 'Please fill in how much was paid and what payment method was used to complete the payment');\n                    return false;\n                }\n            }\n\n\n\n\n\n\n\n\n            vm.club.item.experience_title = vm.club.item.experience.title;\n            vm.club.item.experience_id = vm.club.item.experience.id;\n            vm.club.item.discount_id = vm.club.item.discount.id;\n\n            //applying a discount?\n            //vm.club.item.price = vm.club.item.experience.price;\n            \n\n           \n            vm.club.item.club_id = vm.club_id;\n\n\n            if(!vm.already_paid){\n\n                   var options = {\n                    name: document.getElementById('name').value,\n                    address_zip: document.getElementById('address-postcode').value,\n                  };\n\n                  stripe.createToken(card, options).then(function(result) {\n                    if (result.error) {\n                      // Inform the user if there was an error\n                      var errorElement = document.getElementById('card-errors');\n                      errorElement.textContent = result.error.message;\n                    } else {\n                      // Send the token to your server\n                      //stripeTokenHandler(result.token);\n                      ////console.log(\"RESULT\", result);\n\n                      if(result.token.id){\n                      ////console.log(\"STUFF\", result.token.id);\n\n                        //prepare a basic object...\n                        var obj = {\n                            user_id: vm.user.id,\n                            brand: result.token.card.brand,\n                            last4: result.token.card.last4,\n                            hash: result.token.card.id,\n                            token: result.token.id,\n                            exp_month: result.token.card.exp_month,\n                            exp_year: result.token.card.exp_year,\n                            funding: result.token.card.funding,\n                            name: result.token.card.name,\n                            address_postcode: result.token.card.address_zip,\n                            client_ip: result.token.client_ip\n                        };\n\n                        vm.club.item.payment = obj;\n\n                        delete vm.club.item.experience;\n                        //delete vm.club.item.discount;\n\n                        //console.log(\"READY WITH : \", vm.club.item);\n                        //return false;\n                        \n                        VoucherService.Create(vm.club.item)\n                        .then(function(data){\n                            //console.log(data);\n                            //$state.reload();\n                            $state.go('dashboard.manage_club.vouchers', {}, {reload: true});\n\n                        });\n\n\n\n                      }\n\n                    }\n                  });\n\n              } else {\n                //then the payment was already taken by other means...\n                var obj = {\n                    payment_method: vm.club.item.payment_method,\n                    amount: vm.club.item.price_paid \n                }\n\n            \n\n                vm.club.item.payment = obj;\n                \n                delete vm.club.item.payment_method;\n                delete vm.club.item.price_paid;\n\n                //console.log(\"READY WITH NO STRIPE : \", vm.club.item);\n\n                        //return false;\n\n                VoucherService.Create(vm.club.item)\n                    .then(function(data){\n                        //console.log(data);\n                        //$state.reload();\n                        $state.go('dashboard.manage_club.vouchers', {}, {reload: true});\n\n                    });\n\n              }\n\n\n\n           \n        }\n\n        $scope.delete = function(){\n            //console.log(\"CLICK\");\n            ToastService.warning('Confirm Delete', 'Are you sure you would like to delete this plane?');\n            VoucherService.Delete(vm.user.id, vm.club.item)\n                .then(function(data){\n                    //console.log(data);\n                });\n        }\n\n        function get_update_docs(){\n            var documents = [];\n\n            for(var i=0;i<update_this_file.length;i++){\n                var id = update_this_file[i];\n                //console.log(\"looking for : \", id);\n                //console.log(\"in: \", vm.plane_documents);\n\n                for(var k=0;k<vm.club.plane.plane_documents.length;k++){\n                    //console.log(\"comparing to : \", vm.club.plane.plane_documents[k].id);\n                    if(vm.club.plane.plane_documents[k].id == id){\n                        documents.push(vm.club.plane.plane_documents[k]);\n                    }\n                }\n\n            }\n\n            // //console.log(\"DOCS TO UPDATE : \", documents);\n            return documents;\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n            vm.club.item.club_id = vm.club_id;\n            VoucherService.Update(vm.club.item, vm.user.id)\n                .then(function(data){\n                    //console.log(data);\n                    //console.log(\"saved\");\n                    //$state.reload();\n                    $state.go('dashboard.manage_club.vouchers', {}, {reload: true});\n                });\n        }\n\n        $scope.update_experience = function(){\n            //console.log(\"UPDATE EXP\");\n            var days = vm.club.item.experience.valid_for;\n            if(days > 0){\n                 var expiry_date = moment().day(+days);\n                //console.log(\"NEW DATE: \", expiry_date);\n                vm.club.item.expiry_date = new Date(expiry_date);\n            } else {\n                var expiry_date = moment().year(+2100);\n                vm.club.item.expiry_date = new Date(expiry_date);\n            }\n            vm.club.item.price = vm.club.item.experience.price;\n\n            ExperiencesService.GetDiscountsByClubIdAndExperienceId(vm.club_id, vm.club.item.experience.id)\n            .then(function(data){\n                ////console.log(\"discounts\", data);\n                vm.discounts = data.items;\n            });\n\n        }\n\n        $scope.update_discount = function(){\n\n            if(vm.club.item.discount.discount_type == 1){\n                //fixed price\n                vm.club.item.price = vm.club.item.discount.price;\n            } else {\n                //percentage...\n                vm.club.item.price = vm.club.item.experience.price - (vm.club.item.experience.price * (vm.club.item.discount.percentage / 100) );\n\n            }\n\n        }\n\n        function containsObject(obj, list, params) {\n\n            // //console.log(\"obj\", obj);\n            // //console.log(\"list\", list);\n            // //console.log(\"params\", params);\n\n            for(var i=0; i<list.length; i++) {\n                // //console.log(\"list i : \", list[i]);\n                // //console.log(\"obj is: \", obj);\n\n                var count_success = 0;\n                for(var j=0;j<params.length;j++){\n                    if(list[i][params[j]] && obj[params[j]] && list[i][params[j]] == obj[params[j]]){\n                        count_success++;\n                    }\n                }\n\n                if(count_success === params.length) {                    \n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n\n\n\n        function check_all(){\n\n            //maybe a nice to have one day... not yet though.\n\n\n            //licences\n            vm.club.plane.requirements.licence.forEach(function(obj){\n\n            });\n\n        }\n\n      \n\n\n\n        $scope.add_item = function(type){\n            //console.log(\"ADD\");\n            switch(type){\n                case \"plane\":\n                    //console.log(\"plane\");\n                    if(vm.temporary.plane && vm.temporary.plane !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        // var add_plane = {\n                        //     id: vm.temporary.plane.id\n                        // };\n\n                        //check if it doesnt exist first...\n                        //if(vm.club.item.planes && vm.club.item.planes.indexOf(vm.temporary.plane.plane_id) == -1){\n\n\n                        if(!vm.club.item.planes){\n                            vm.club.item.planes = [];\n                        }\n\n                        if(containsObject(vm.temporary.plane, vm.club.item.planes, new Array(\"plane_id\") ) == false){\n                            vm.club.item.planes.push(vm.temporary.plane);\n\n                            // vm.club.item.planes.indexOf(vm.temporary.plane)\n                            // vm.planes.filter(function(el) { return el.plane_id !== vm.temporary.plane.plane_id; });\n                        } \n\n                        delete vm.temporary.plane;\n\n                    } else {\n                        ToastService.warning('Missing Plane', 'Please select a plane that this activity be done on!');\n                    }\n\n                break;\n\n            }\n\n\n\n        }\n\n\n        $scope.remove_item = function(type, index){\n            //console.log(\"REMOVE\");\n\n            vm.club.item.planes.splice(index, 1);\n\n\n            // switch(type){\n            //     case \"plane\":\n            //             //console.log(\"plane\");\n                   \n            //             //check if it doesnt exist first...\n            //             // if(containsObject(add_licence, vm.club.plane.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n            //             //     vm.club.plane.requirements.licence.push(add_licence);\n            //             // }\n\n            //             vm.club.item.planes.splice(index, 1);\n                      \n            //     break;\n            // }\n\n\n            //     case \"medical\":\n            //         //console.log(\"medical\");\n            //         if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_medical = {\n            //                 authority_id: vm.temporary.medical_authority.id,\n            //                 authority_title: vm.temporary.medical_authority.abbreviation,\n            //                 medical_component_id: vm.temporary.medical_component.id,\n            //                 medical_component_title: vm.temporary.medical_component.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_medical, vm.club.plane.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n            //                 vm.club.plane.requirements.medical.push(add_medical);\n            //             }\n\n            //             delete vm.temporary.medical_authority;\n            //             delete vm.temporary.medical_component;\n\n            //         } else {\n            //             alert(\"Please select a medical that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            //     case \"differences\":\n            //         //console.log(\"difference\");\n            //         if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_difference = {\n            //                 difference_id: vm.temporary.difference.id,\n            //                 difference_title: vm.temporary.difference.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_difference, vm.club.plane.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n            //                 vm.club.plane.requirements.differences.push(add_difference);\n            //             }\n\n            //             delete vm.temporary.difference;\n\n            //         } else {\n            //             alert(\"Please select a difference that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            // }\n\n\n\n        }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        $scope.update_this_file = function(file){\n            //console.log(\"==== update is : \", file.id);\n            if(update_this_file.indexOf(file.id) === -1){\n                update_this_file.push(file.id)\n            } else {\n               ////console.log(\"This item already exists\"); \n            } \n        }\n\n\n         $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.club.plane.plane_documents = $.grep(vm.club.plane.plane_documents, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                PlaneDocumentService.Delete(vm.user.id, file.id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            //console.log(\"REMOVE: \", j);\n            //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            PoidService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n          // $scope.$on('flow::fileAdded', function (event, $flow, flowFile) {\n          //     event.preventDefault();//prevent file from uploading\n          //     //console.log(\"FILE ADDED\");\n          //     //console.log($flow);\n          //   });\n\n            $scope.processFiles = function(files){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    //console.log(\"J is : \",j);\n                    //console.log(\"name is : \", j.files.file.name);\n\n                    files[i].file.temp_path = j.saved_url;\n                    files[i].file.save_name = j.files.file.name;\n                    var ft = j.files.file.name;\n                    ft = ft.split('.').pop();\n                    files[i].file.extension = ft;\n\n                    // //console.log(\"file\", files[i].file);\n                    vm.plane_documents.push(files[i].file);\n                }\n\n\n            }\n\n            $scope.set_title = function(file){\n                //console.log(\"return\", file);\n                return file.save_name;\n            }\n\n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            $scope.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n\n            $scope.delete_poid = function(id){\n\n              \n                var a = prompt(\"Are you sure you wish to delete this poid? \\n\\n This change is irreversible! To confirm please type YES in the box below.\");\n                if(a == \"YES\"){\n\n\n                    //console.log(\"WE DELETE IT\");\n\n\n                    // PoidService.Delete(vm.user_id, id)\n                    //     .then(function (data) {\n                    //         //console.log(data);\n                    //         if(data.success){\n                    //             //console.log(\"HUZZAH\", data);\n                    //             //then we need to remove this from the list of files...\n                    //             vm.user_poids = $.grep(vm.user_poids, function(e){ \n                    //                 return e.id != id; \n                    //             });\n                                \n                    //             //refresh?\n                    //             $state.reload();\n                    //             $state.go('dashboard.my_account.poid');\n\n                    //         } else {\n\n                    //             alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n                    //         }\n\n                    //     });\n\n\n\n                } else {\n                    //console.log(\"ignore123\");\n                }\n\n\n            }\n\n\n\n\n            $scope.save_plane_documents = function(){\n\n               \n              \n\n                //console.log(\"plane_documents: \", vm.plane_documents);\n\n\n                //compile the required elements YAY\n\n                //console.log(\"plane_document \", vm.plane_document);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n                    // for(var i=0;i<vm.plane_document.images.length;i++){\n                    //     delete vm.plane_document.images[i].data_uri;\n                    // }\n\n                    // // vm.plane_document.images = vm.plane_documents;\n                    // vm.plane_document.images = vm.plane_document.images.concat(vm.plane_documents);\n                    // vm.plane_document.user_id = vm.user_id;\n\n\n\n\n            //     if(vm.plane_document.id){\n            //         //then its an udpate\n\n            //         //merge the images left?\n            //         PoidService.Update(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                     $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n            //     } else {\n\n\n                   \n\n\n            //         //then its a create\n            //         //console.log(vm.plane_document);\n\n            //         PoidService.Create(vm.plane_document)\n            //             .then(function (data) {\n            //                 //console.log(data);\n            //                 if(data.success){\n            //                     //console.log(\"HUZZAH\", vm.plane_document);\n            //                     //console.log(\"HUZZAH\", data);\n            //                     //then we need to remove this from the list of files...\n                                \n                                \n            //                     //move somewhere?\n            //                    // $state.reload();\n            //                    // $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n            //                 } else {\n\n            //                     alert(\"Something went terribly wrong... \\n\\n \"+data.message);\n\n            //                 }\n\n            //             });\n\n\n            //     }\n\n\n\n             };\n\n\n\n\n             $scope.change_file_name = function(file){\n                \n                //this is terribly ineficient... unfortunately... can't \n                //work out how else to do it! (lol)\n\n                // //console.log(\"TO BE CHANGED\", file);\n\n                // //console.log(\"BEFORE BEFORE\", vm.plane_documents);\n\n                vm.plane_documents = $.grep(vm.plane_documents, function(e){ \n                    return e.temp_path != file.temp_path; \n                });\n\n                // //console.log(\"BEFORE\", vm.plane_documents);\n\n                vm.plane_documents.push(file);\n\n                // //console.log(\"AFTER\", vm.plane_documents);\n\n             }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n            var warning_msg = \"By deleting this plane, you will also cancel all reservations that this plane currently has.\"\n\n          $scope.open = function (plane_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return plane_id;\n                },\n                params: function() {\n                  return {id: plane_id};\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (plane_id) {\n              $log.info('PRESSED GO: '+plane_id.id);\n              ExperiencesService.Delete(vm.user.id, plane_id.id)\n              .then(function(){\n                //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.items = $.grep(vm.club.items, function(e){ \n                    return e.id != plane_id.id; \n                });\n              })\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n          };\n\n         \n\n\n    }\n app.controller('DashboardClubVouchersEditController', DashboardClubVouchersEditController);\n\n    DashboardClubVouchersEditController.$inject = ['UserService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'LicenceService', 'MedicalService', 'DifferencesService', 'ExperiencesService', 'VoucherService', 'ToastService'];\n    function DashboardClubVouchersEditController(UserService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, LicenceService, MedicalService, DifferencesService, ExperiencesService, VoucherService, ToastService) {\n        var vm = this;\n\n        //console.log(\"HELLOOOO vouchers\");\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {\n            item: {\n            }\n        };\n        vm.page_title = \"\";\n        \n        vm.plane_document = {};\n        vm.plane_documents = [];\n\n        var update_this_file = [];\n        \n\n        vm.action = $state.current.data.action;\n        vm.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n        vm.charge_type = [\"brakes\", \"session\", \"plane\"];\n\n        vm.discounts = [];\n\n        vm.planes = [];\n\n        vm.show_paid = true;\n   \n\n        ExperiencesService.GetByClubId(vm.club_id)\n                    .then(function(data){\n                        //console.log(\"planes\", data);\n                        vm.experiences = data.items;\n                    });\n\n  \n\n               \n                VoucherService.GetById($stateParams.id)\n                    .then(function(data){\n\n\n\n                            data.item.expiry_date = new Date(data.item.expiry_date);\n                            vm.club.item = data.item; \n\n                            //console.log(vm.club);\n\n                        \n                        // vm.page_title = \"Edit an Experience - \"+vm.club.item.title;\n                    });\n\n\n        $scope.update_experience = function(){\n            //console.log(\"UPDATE EXP\");\n            var days = vm.club.item.experience.valid_for;\n            if(days > 0){\n                 var expiry_date = moment().day(+days);\n                //console.log(\"NEW DATE: \", expiry_date);\n                vm.club.item.expiry_date = new Date(expiry_date);\n            } else {\n                var expiry_date = moment().year(+2100);\n                vm.club.item.expiry_date = new Date(expiry_date);\n            }\n            vm.club.item.price = vm.club.item.experience.price;\n\n            ExperiencesService.GetDiscountsByClubIdAndExperienceId(vm.club_id, vm.club.item.experience.id)\n            .then(function(data){\n                ////console.log(\"discounts\", data);\n                vm.discounts = data.items;\n            });\n\n        }\n\n        $scope.update_discount = function(){\n\n            if(vm.club.item.discount.discount_type == 1){\n                //fixed price\n                vm.club.item.price = vm.club.item.discount.price;\n            } else {\n                //percentage...\n                vm.club.item.price = vm.club.item.experience.price - (vm.club.item.experience.price * (vm.club.item.discount.percentage / 100) );\n\n            }\n\n        }\n\n        //'9' needs to refer the the user's account set to manage\n       \n\n        $scope.check_code = function(){\n            //console.log(\"CHECKING NOW\");\n        }\n\n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        vm.clearFieldError = function(event) { ToastService.clearFieldError(event); };\n\n        $scope.save = function(){\n            var checks = [\n                { ok: vm.club.item.experience && vm.club.item.experience.id, field: 'voucher_experience', label: 'Experience' },\n                { ok: vm.club.item.first_name, field: 'first_name', label: 'First Name' },\n                { ok: vm.club.item.last_name,  field: 'last_name',  label: 'Last Name' },\n                { ok: vm.club.item.email,      field: 'email',      label: 'Email Address' },\n                { ok: vm.club.item.code,       field: 'code',       label: 'Voucher Code' },\n                { ok: vm.club.item.expiry_date, field: 'expiry_date', label: 'Expiry Date' }\n            ];\n            if (!ToastService.validateForm(checks)) return;\n\n            if(vm.action == \"add\"){\n                $scope.create();\n            } else {\n                $scope.update();\n            }\n        }\n\n\n        $scope.create = function(){\n            //console.log(\"CREATE ME NOW\");\n\n\n            //first sanity check goes here...\n            if(!vm.club.item.experience || !vm.club.item.experience.id){\n                ToastService.warning('Selection Required', 'You must select an experience to issue this voucher.');\n                return false;\n            }\n            if(!vm.club.item.first_name || !vm.club.item.last_name || !vm.club.item.email){\n                ToastService.warning('Missing Details', \"You must enter the purchasor's first name, last name and email address.\");\n                return false;\n            }\n\n            if(vm.already_paid){\n                if(!vm.club.item.price_paid || !vm.club.item.payment_method){\n                    ToastService.warning('Payment Required', 'Please fill in how much was paid and what payment method was used to complete the payment.');\n                    return false;\n                }\n            }\n\n\n\n\n\n\n\n\n            vm.club.item.experience_title = vm.club.item.experience.title;\n            vm.club.item.experience_id = vm.club.item.experience.id;\n            vm.club.item.discount_id = vm.club.item.discount.id;\n\n            //applying a discount?\n            //vm.club.item.price = vm.club.item.experience.price;\n            \n\n           \n            vm.club.item.club_id = vm.club_id;\n\n\n            if(!vm.already_paid){\n\n                   var options = {\n                    name: document.getElementById('name').value,\n                    address_zip: document.getElementById('address-postcode').value,\n                  };\n\n                  stripe.createToken(card, options).then(function(result) {\n                    if (result.error) {\n                      // Inform the user if there was an error\n                      var errorElement = document.getElementById('card-errors');\n                      errorElement.textContent = result.error.message;\n                    } else {\n                      // Send the token to your server\n                      //stripeTokenHandler(result.token);\n                      ////console.log(\"RESULT\", result);\n\n                      if(result.token.id){\n                      ////console.log(\"STUFF\", result.token.id);\n\n                        //prepare a basic object...\n                        var obj = {\n                            user_id: vm.user.id,\n                            brand: result.token.card.brand,\n                            last4: result.token.card.last4,\n                            hash: result.token.card.id,\n                            token: result.token.id,\n                            exp_month: result.token.card.exp_month,\n                            exp_year: result.token.card.exp_year,\n                            funding: result.token.card.funding,\n                            name: result.token.card.name,\n                            address_postcode: result.token.card.address_zip,\n                            client_ip: result.token.client_ip\n                        };\n\n                        vm.club.item.payment = obj;\n\n                        delete vm.club.item.experience;\n                        //delete vm.club.item.discount;\n\n                        //console.log(\"READY WITH : \", vm.club.item);\n                        //return false;\n                        \n                        VoucherService.Create(vm.club.item)\n                        .then(function(data){\n                            //console.log(data);\n                            //$state.reload();\n                            $state.go('dashboard.manage_club.vouchers', {}, {reload: true});\n\n                        });\n\n\n\n                      }\n\n                    }\n                  });\n\n              } else {\n                //then the payment was already taken by other means...\n                var obj = {\n                    payment_method: vm.club.item.payment_method,\n                    amount: vm.club.item.price_paid \n                }\n\n            \n\n                vm.club.item.payment = obj;\n                \n                delete vm.club.item.payment_method;\n                delete vm.club.item.price_paid;\n\n                //console.log(\"READY WITH NO STRIPE : \", vm.club.item);\n\n                        //return false;\n\n                VoucherService.Create(vm.club.item)\n                    .then(function(data){\n                        //console.log(data);\n                        //$state.reload();\n                        $state.go('dashboard.manage_club.vouchers', {}, {reload: true});\n\n                    });\n\n              }\n\n\n\n           \n        }\n\n\n        $scope.cancel = function(){\n\n            VoucherService.CancelVoucher(vm.user.id, vm.club.item.id)\n                .then(function(data){\n                    //console.log(data);\n                    $state.go('dashboard.manage_club.vouchers', {}, {reload: true});\n                });\n\n        }\n\n        $scope.delete = function(){\n            //console.log(\"CLICK\");\n            ToastService.warning('Confirm Delete', 'Are you sure you would like to delete this voucher?');\n            VoucherService.CancelVoucher(vm.user.id, vm.club.item)\n                .then(function(data){\n                    //console.log(data);\n                });\n        }\n\n        function get_update_docs(){\n            var documents = [];\n\n            for(var i=0;i<update_this_file.length;i++){\n                var id = update_this_file[i];\n                //console.log(\"looking for : \", id);\n                //console.log(\"in: \", vm.plane_documents);\n\n                for(var k=0;k<vm.club.plane.plane_documents.length;k++){\n                    //console.log(\"comparing to : \", vm.club.plane.plane_documents[k].id);\n                    if(vm.club.plane.plane_documents[k].id == id){\n                        documents.push(vm.club.plane.plane_documents[k]);\n                    }\n                }\n\n            }\n\n            // //console.log(\"DOCS TO UPDATE : \", documents);\n            return documents;\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n            vm.club.item.club_id = vm.club_id;\n            VoucherService.Update(vm.club.item, vm.user.id)\n                .then(function(data){\n                    //console.log(data);\n                    //console.log(\"saved\");\n                    //$state.reload();\n                    $state.go('dashboard.manage_club.vouchers', {}, {reload: true});\n                });\n        }\n\n        $scope.update_experience = function(){\n            //console.log(\"UPDATE EXP\");\n            var days = vm.club.item.experience.valid_for;\n            if(days > 0){\n                 var expiry_date = moment().day(+days);\n                //console.log(\"NEW DATE: \", expiry_date);\n                vm.club.item.expiry_date = new Date(expiry_date);\n            } else {\n                var expiry_date = moment().year(+2100);\n                vm.club.item.expiry_date = new Date(expiry_date);\n            }\n            vm.club.item.price = vm.club.item.experience.price;\n\n            ExperiencesService.GetDiscountsByClubIdAndExperienceId(vm.club_id, vm.club.item.experience.id)\n            .then(function(data){\n                ////console.log(\"discounts\", data);\n                vm.discounts = data.items;\n            });\n\n        }\n\n        $scope.update_discount = function(){\n\n            if(vm.club.item.discount.discount_type == 1){\n                //fixed price\n                vm.club.item.price = vm.club.item.discount.price;\n            } else {\n                //percentage...\n                vm.club.item.price = vm.club.item.experience.price - (vm.club.item.experience.price * (vm.club.item.discount.percentage / 100) );\n\n            }\n\n        }\n\n        function containsObject(obj, list, params) {\n\n            // //console.log(\"obj\", obj);\n            // //console.log(\"list\", list);\n            // //console.log(\"params\", params);\n\n            for(var i=0; i<list.length; i++) {\n                // //console.log(\"list i : \", list[i]);\n                // //console.log(\"obj is: \", obj);\n\n                var count_success = 0;\n                for(var j=0;j<params.length;j++){\n                    if(list[i][params[j]] && obj[params[j]] && list[i][params[j]] == obj[params[j]]){\n                        count_success++;\n                    }\n                }\n\n                if(count_success === params.length) {                    \n                    return true;\n                }\n            }\n\n            return false;\n        }\n\n\n\n\n        function check_all(){\n\n            //maybe a nice to have one day... not yet though.\n\n\n            //licences\n            vm.club.plane.requirements.licence.forEach(function(obj){\n\n            });\n\n        }\n\n      \n\n\n\n        $scope.add_item = function(type){\n            //console.log(\"ADD\");\n            switch(type){\n                case \"plane\":\n                    //console.log(\"plane\");\n                    if(vm.temporary.plane && vm.temporary.plane !== \"\"){\n                        //then we can add it\n                        //console.log(\"here we go\");\n                        // var add_plane = {\n                        //     id: vm.temporary.plane.id\n                        // };\n\n                        //check if it doesnt exist first...\n                        //if(vm.club.item.planes && vm.club.item.planes.indexOf(vm.temporary.plane.plane_id) == -1){\n\n\n                        if(!vm.club.item.planes){\n                            vm.club.item.planes = [];\n                        }\n\n                        if(containsObject(vm.temporary.plane, vm.club.item.planes, new Array(\"plane_id\") ) == false){\n                            vm.club.item.planes.push(vm.temporary.plane);\n\n                            // vm.club.item.planes.indexOf(vm.temporary.plane)\n                            // vm.planes.filter(function(el) { return el.plane_id !== vm.temporary.plane.plane_id; });\n                        } \n\n                        delete vm.temporary.plane;\n\n                    } else {\n                        ToastService.warning('Selection Required', 'Please select a plane that this activity be done on!');\n                    }\n\n                break;\n\n            }\n\n\n\n        }\n\n\n        $scope.remove_item = function(type, index){\n            //console.log(\"REMOVE\");\n\n            vm.club.item.planes.splice(index, 1);\n\n\n            // switch(type){\n            //     case \"plane\":\n            //             //console.log(\"plane\");\n                   \n            //             //check if it doesnt exist first...\n            //             // if(containsObject(add_licence, vm.club.plane.requirements.licence, new Array(\"licence_id\", \"rating_id\")) == false){\n            //             //     vm.club.plane.requirements.licence.push(add_licence);\n            //             // }\n\n            //             vm.club.item.planes.splice(index, 1);\n                      \n            //     break;\n            // }\n\n\n            //     case \"medical\":\n            //         //console.log(\"medical\");\n            //         if(vm.temporary.medical_authority && vm.temporary.medical_authority !== \"\" && vm.temporary.medical_component && vm.temporary.medical_component !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_medical = {\n            //                 authority_id: vm.temporary.medical_authority.id,\n            //                 authority_title: vm.temporary.medical_authority.abbreviation,\n            //                 medical_component_id: vm.temporary.medical_component.id,\n            //                 medical_component_title: vm.temporary.medical_component.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_medical, vm.club.plane.requirements.medical, new Array(\"authority_id\", \"medical_component_id\")) == false){\n            //                 vm.club.plane.requirements.medical.push(add_medical);\n            //             }\n\n            //             delete vm.temporary.medical_authority;\n            //             delete vm.temporary.medical_component;\n\n            //         } else {\n            //             alert(\"Please select a medical that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            //     case \"differences\":\n            //         //console.log(\"difference\");\n            //         if(vm.temporary.difference && vm.temporary.difference !== \"\"){\n            //             //then we can add it\n            //             //console.log(\"here we go\");\n            //             var add_difference = {\n            //                 difference_id: vm.temporary.difference.id,\n            //                 difference_title: vm.temporary.difference.title\n            //             };\n\n            //             //check if it doesnt exist first...\n            //             if(containsObject(add_difference, vm.club.plane.requirements.differences, new Array(\"difference_id\", \"difference_title\")) == false){\n            //                 vm.club.plane.requirements.differences.push(add_difference);\n            //             }\n\n            //             delete vm.temporary.difference;\n\n            //         } else {\n            //             alert(\"Please select a difference that is required to book the plane solo!\");\n            //         }\n\n            //     break;\n\n\n            // }\n\n\n\n        }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n        $scope.update_this_file = function(file){\n            //console.log(\"==== update is : \", file.id);\n            if(update_this_file.indexOf(file.id) === -1){\n                update_this_file.push(file.id)\n            } else {\n               ////console.log(\"This item already exists\"); \n            } \n        }\n\n\n         $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.club.plane.plane_documents = $.grep(vm.club.plane.plane_documents, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                PlaneDocumentService.Delete(vm.user.id, file.id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            //console.log(\"REMOVE: \", j);\n            //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            PoidService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.plane_documents = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n\n        initController();\n\n        function initController() {\n\n\n        }\n\n\n            var warning_msg = \"By deleting this plane, you will also cancel all reservations that this plane currently has.\"\n\n          $scope.open = function (plane_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return plane_id;\n                },\n                params: function() {\n                  return {id: plane_id};\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (plane_id) {\n              $log.info('PRESSED GO: '+plane_id.id);\n              ExperiencesService.Delete(vm.user.id, plane_id.id)\n              .then(function(){\n                //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.items = $.grep(vm.club.items, function(e){ \n                    return e.id != plane_id.id; \n                });\n              })\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n          };\n\n         \n\n\n    }\n app\n.filter(\"asDate\", function () {\n    return function (input) {\n        if(input && input !== \"\"){\n            return moment(input).toDate();//new Date(input);\n        } else {\n            return \"\";\n        }\n    }\n});\n\n app.controller('DashboardController', DashboardController);\n\n    DashboardController.$inject = ['UserService','$cookieStore', 'BookingService', 'BookoutService', '$rootScope', '$location', 'AuthenticationService', 'ToastService'];\n    function DashboardController(UserService, $cookieStore, BookingService, BookoutService, $rootScope, $location, AuthenticationService, ToastService) {\n        var vm = this;\n\n        if(!$rootScope.globals.currentUser){\n            if(AuthenticationService.CheckLoggedIn() == false){\n                //console.log(\"STOPPING HERE\");\n                $location.path('/login');\n                return false;\n            }\n            // .then(function(data){\n            //     //console.log(\"DATA : \", data);\n            // });\n        }\n\n        vm.user = $rootScope.globals.currentUser;\n        ////console.log(\"ROOTSCOPE\", $rootScope.globals);\n\n         //CheckLoggedIn\n\n        vm.bookings = [];\n        vm.bookouts = [];\n        vm.to_pay = [];\n        vm.to_complete_split = [];\n        \n        // //console.log(\"vmuser\", vm.user);\n        vm.allUsers = [];\n\n        vm.clubs = [];\n\n        vm.force_show_admins = false;\n\n        if(vm.user && vm.user.access && vm.user.access.manager){\n           vm.force_show_admins = true;\n        } else if(vm.user && vm.user.access && vm.user.access.instructor){\n           vm.force_show_admins = true;\n        }\n        \n\n        UserService.GetAdminClubs(vm.user.id)\n        .then(function(data){\n            if(data.success){\n                 vm.clubs = data.clubs;   \n\n                // Try to restore previously selected club from localStorage\n                var savedClubId = null;\n                try {\n                    var stored = localStorage.getItem('toaviate_selected_club_id');\n                    if (stored !== null) {\n                        savedClubId = stored; // keep as string for comparison\n                    }\n                } catch(e) {}\n\n                var selectedClub = null;\n                if (savedClubId !== null) {\n                    for (var i = 0; i < vm.clubs.length; i++) {\n                        // Compare as strings to avoid type mismatch (API may return int or string)\n                        if (String(vm.clubs[i].id) === String(savedClubId)) {\n                            selectedClub = vm.clubs[i];\n                            break;\n                        }\n                    }\n                }\n\n                // Fall back to first club if no saved selection (or saved club no longer valid)\n                if (!selectedClub) {\n                    selectedClub = vm.clubs[0];\n                }\n\n                vm.club = selectedClub;\n                $rootScope.globals.currentUser.current_club_admin = selectedClub;\n                $cookieStore.put('globals', $rootScope.globals);\n\n                // Persist the selection\n                try {\n                    localStorage.setItem('toaviate_selected_club_id', String(selectedClub.id));\n                } catch(e) {}\n\n            } else {\n                //console.log(\"ERROR FAIL / LOGOUT\", data);\n                $location.path('/login');\n            }\n           \n                        \n        });\n\n\n        vm.onClubSelected = function(club) {\n            vm.club = club;\n            $rootScope.globals.currentUser.current_club_admin = club;\n            $cookieStore.put('globals', $rootScope.globals);\n\n            // Persist to localStorage so it survives page reloads\n            try {\n                localStorage.setItem('toaviate_selected_club_id', String(club.id));\n            } catch(e) {}\n\n            console.log('Switched to club:', club.title);\n        };\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n           load_bookings();\n        }\n\n        function load_bookings(){\n\n            BookingService.GetTodayBookingsUser(vm.user.id)\n                        .then(function(data){\n\n                            vm.bookings = data.bookings;   \n                            vm.to_pay = data.to_pay; \n                            vm.to_complete_split = data.to_complete_split;  \n                            //console.log(\"to_pay\", data.to_pay);\n                        });\n\n            \n\n\n            BookoutService.GetBookoutsToComplete(vm.user.id)\n                        .then(function(data){\n\n                            vm.bookouts = data.bookouts;   \n                            \n                        });\n        }\n\n        vm.logout = function(){\n            //alert(\"LOG ME OUT\");\n            AuthenticationService.Logout(function(data){\n\n                           AuthenticationService.ClearCredentials();\n                             \n                            $cookieStore.remove('globals');\n                            $cookieStore.remove('session');\n\n                            // Clear return URL  this is an intentional logout, not a session timeout\n                            try { localStorage.removeItem('toaviate_return_url'); } catch(e) {}\n\n                            $location.path('/login');\n\n\n                         \n                        \n                    });\n        }\n\n\n        vm.cancel_bookout = function(id){\n            // //console.log(\"CANCEL BOOKOUT ID: \", id);\n            var a = confirm(\"Are you sure you wish to cancel the bookout?\");\n            if(a){\n                BookoutService.CancelBookout(id)\n                 .then(function(data){\n\n                     if(data.success){\n\n                       load_bookings();\n\n\n                     } else {\n                         ToastService.error('Error', data.message);\n                     }\n                                                \n                    });\n\n\n                // //console.log(\"CANCEL\");\n\n            } else {\n                return false;\n            }\n        }\n\n        vm.cancel_booking = function(id){\n            // //console.log(\"CANCEL BOOKOUT ID: \", id);\n            var a = confirm(\"Are you sure you wish to cancel the booking?\");\n            if(a){\n                BookoutService.DeleteBooking(vm.user.id, id)\n                 .then(function(data){\n\n                     if(data.success){\n\n                       load_bookings();\n\n\n                     } else {\n                         ToastService.error('Error', data.message);\n                     }\n                                                \n                    });\n\n\n                // //console.log(\"CANCEL\");\n\n            } else {\n                return false;\n            }\n        }\n\n    }\n app.controller('DashboardCourseSyllabusController', DashboardCourseSyllabusController);\n\n    DashboardCourseSyllabusController.$inject = ['UserService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'CourseService'];\n    function DashboardCourseSyllabusController(UserService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, CourseService) {\n        var vm = this;\n\n           //    /* PLEASE DO NOT COPY AND PASTE THIS CODE. */(function(){var w=window,C='___grecaptcha_cfg',cfg=w[C]=w[C]||{},N='grecaptcha';var gr=w[N]=w[N]||{};gr.ready=gr.ready||function(f){(cfg['fns']=cfg['fns']||[]).push(f);};(cfg['render']=cfg['render']||[]).push('explicit');(cfg['onload']=cfg['onload']||[]).push('initRecaptcha');w['__google_recaptcha_client']=true;var d=document,po=d.createElement('script');po.type='text/javascript';po.async=true;po.src='https://www.gstatic.com/recaptcha/releases/JPZ52lNx97aD96bjM7KaA0bo/recaptcha__en.js';var e=d.querySelector('script[nonce]'),n=e&&(e['nonce']||e.getAttribute('nonce'));if(n){po.setAttribute('nonce',n);}var s=d.getElementsByTagName('script')[0];s.parentNode.insertBefore(po, s);})();\n\n           // var initRecaptcha = function () { \n           //     // document.getElementById(\"SearchModule\").scope().vm.parent.isGrecaptchaLoaded = !0, \n           //     // document.getElementById(\"SearchModule\").scope().vm.showRecaptcha();\n           //     vm.showRecaptcha();\n           // };\n              \n\n\n\n\n        vm.user = null;\n        vm.allUsers = [];\n      \n\n        vm.action = $state.current.data.action;\n        vm.user = $rootScope.globals.currentUser;\n         //console.log(\"$rootScope.globals.currentUser : \", $rootScope.globals.currentUser);\n\n        vm.club_id =( $rootScope.globals.currentUser && $rootScope.globals.currentUser.current_club_admin && $rootScope.globals.currentUser.current_club_admin.id) ? $rootScope.globals.currentUser.current_club_admin.id : 0;\n        vm.user_id = vm.user.id;\n\n        vm.exams = [];\n\n        \n        switch(vm.action){\n            case \"add\":\n                //console.log(\"adding a new course please\");\n                vm.page_title = \"Add a New Course\";\n            break;\n            case \"view\":\n\n                //console.log(\"view an existing course\");\n                load_course();\n\n\n            break;\n            case \"view_lesson\":\n\n                //console.log(\"view an existing lesson\");\n                load_lesson();\n\n\n            break;\n            case \"list\":\n                //console.log(\"view list of existing courses\");\n                CourseService.GetCoursesByClubId(vm.club_id)\n                    .then(function(data){\n                        vm.courses = data.items;   \n                    });\n            break;\n            case \"list_member\":\n                //console.log(\"view list of existing courses\");\n                CourseService.GetCoursesByUserId(vm.user.id)\n                    .then(function(data){\n                        vm.clubs = data.items;   \n                    });\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n\n        function load_course(){\n\n\n             //console.log(\"PARAMS\", $state);\n            CourseService.GetCourseById($stateParams.course_id)\n                    .then(function(data){\n                        vm.course = data.item;   \n            \n                    });\n             \n            CourseService.GetExamsByCourseId($stateParams.course_id)\n                    .then(function(data){\n                        vm.course.exams = data.items;   \n                \n                    });\n\n            CourseService.GetLessonsByCourseId($stateParams.course_id)\n                    .then(function(data){\n                        vm.course.lessons = data.items;   \n                    });\n\n\n\n        }\n\n\n        function load_lesson(){\n\n            CourseService.GetLessonById($stateParams.lesson_id)\n                    .then(function(data){\n                        vm.lesson = data.item;   \n            \n                    });\n\n\n            CourseService.GetBulletsByLessonId($stateParams.lesson_id)\n                    .then(function(data){\n\n                        vm.lesson.bullets = data.bullets;\n            \n                    });\n\n            CourseService.GetTemByLessonId($stateParams.lesson_id)\n                .then(function(data){\n                    //console.log(data);\n\n                    vm.lesson.tem = data.items;\n\n                });\n\n            CourseService.GetItemsByLessonId($stateParams.lesson_id)\n                .then(function(data){\n                    //console.log(data);\n\n                    vm.lesson.items = data.items;\n\n                });\n\n        }\n\n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n       \n\n\n    }\n app.controller('DashboardCourseSyllabusViewController', DashboardCourseSyllabusViewController);\n\n    DashboardCourseSyllabusViewController.$inject = ['UserService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'CourseService'];\n    function DashboardCourseSyllabusViewController(UserService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, CourseService) {\n        var vm = this;\n\n           //    /* PLEASE DO NOT COPY AND PASTE THIS CODE. */(function(){var w=window,C='___grecaptcha_cfg',cfg=w[C]=w[C]||{},N='grecaptcha';var gr=w[N]=w[N]||{};gr.ready=gr.ready||function(f){(cfg['fns']=cfg['fns']||[]).push(f);};(cfg['render']=cfg['render']||[]).push('explicit');(cfg['onload']=cfg['onload']||[]).push('initRecaptcha');w['__google_recaptcha_client']=true;var d=document,po=d.createElement('script');po.type='text/javascript';po.async=true;po.src='https://www.gstatic.com/recaptcha/releases/JPZ52lNx97aD96bjM7KaA0bo/recaptcha__en.js';var e=d.querySelector('script[nonce]'),n=e&&(e['nonce']||e.getAttribute('nonce'));if(n){po.setAttribute('nonce',n);}var s=d.getElementsByTagName('script')[0];s.parentNode.insertBefore(po, s);})();\n\n           // var initRecaptcha = function () { \n           //     // document.getElementById(\"SearchModule\").scope().vm.parent.isGrecaptchaLoaded = !0, \n           //     // document.getElementById(\"SearchModule\").scope().vm.showRecaptcha();\n           //     vm.showRecaptcha();\n           // };\n              \n\n\n\n\n        vm.user = null;\n        vm.allUsers = [];\n      \n\n        vm.action = $state.current.data.action;\n        vm.user = $rootScope.globals.currentUser;\n        // //console.log(\"$rootScope.globals.currentUser : \", $rootScope.globals.currentUser);\n\n        vm.club_id =( $rootScope.globals.currentUser && $rootScope.globals.currentUser.current_club_admin && $rootScope.globals.currentUser.current_club_admin.id) ? $rootScope.globals.currentUser.current_club_admin.id : 0;\n        vm.user_id = vm.user.id;\n\n        vm.exams = [];\n\n        vm.course = {\n            exams: [],\n            lessons: []\n        };\n\n        vm.lesson = {\n            tem: [],\n            bullets: {},\n            items: []\n        }\n\n        vm.contentFiles = [];\n        vm.contentFilesLoading = true;\n        vm.activeContentFile = null;\n        \n        switch(vm.action){\n            case \"add\":\n                //console.log(\"adding a new course please\");\n                vm.page_title = \"Add a New Course\";\n            break;\n            case \"view\":\n\n                //console.log(\"view an existing course\");\n                load_course();\n\n\n            break;\n            case \"view_lesson\":\n\n                //console.log(\"view an existing lesson\");\n                load_lesson();\n\n\n            break;\n            case \"list\":\n                //console.log(\"view list of existing courses\");\n                CourseService.GetCoursesByClubId(vm.club_id)\n                    .then(function(data){\n                        vm.courses = data.items;   \n                    });\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n\n        function load_course(){\n\n\n            vm.course_id = $stateParams.course_id;\n\n             //console.log(\"PARAMS\", $state);\n            CourseService.GetCourseById($stateParams.course_id)\n                    .then(function(data){\n                        vm.course = data.item;   \n                            \n\n                         CourseService.GetExamsByCourseId($stateParams.course_id)\n                                .then(function(data){\n                                    vm.course.exams = data.items;   \n                            \n                                });\n\n                        CourseService.GetLessonsByCourseId($stateParams.course_id)\n                                .then(function(data){\n                                    vm.course.lessons = data.items;   \n                                });\n\n\n                    });\n             \n          \n\n\n        }\n\n\n        function load_lesson(){\n\n            vm.course_id = $stateParams.course_id;\n\n            CourseService.GetLessonById($stateParams.lesson_id)\n                    .then(function(data){\n                        vm.lesson = data.item;   \n\n                        CourseService.GetBulletsByLessonId($stateParams.lesson_id)\n                            .then(function(data){\n\n                                    vm.lesson.bullets = data.bullets;\n                        \n                                });\n\n                        CourseService.GetTemByLessonId($stateParams.lesson_id)\n                            .then(function(data){\n                                //console.log(data);\n\n                                vm.lesson.tem = data.items;\n\n                            });\n\n                        CourseService.GetItemsByLessonId($stateParams.lesson_id)\n                            .then(function(data){\n                                //console.log(data);\n\n                                vm.lesson.items = data.items;\n\n                            });\n\n                        // Load content files (images / PDFs)\n                        load_content_files($stateParams.lesson_id);\n            \n                    });\n\n\n            \n\n        }\n\n        // \n        // LESSON CONTENT FILES VIEWER\n        // \n        function load_content_files(lesson_id) {\n            vm.contentFilesLoading = true;\n            vm.contentFiles = [];\n            vm.activeContentFile = null;\n\n            CourseService.GetLessonContentFiles(lesson_id)\n                .then(function(data) {\n                    if (data && data.items && data.items.length > 0) {\n                        vm.contentFiles = data.items;\n                        // Fetch decrypted file data for each file\n                        angular.forEach(vm.contentFiles, function(file) {\n                            file._loading = true;\n                            file.data_uri = null;\n                            CourseService.GetLessonContentFileData(file.id)\n                                .then(function(res) {\n                                    if (res && res.success) {\n                                        file.data_uri = res.data_uri;\n                                        file.file_base64 = res.file;\n                                    }\n                                    file._loading = false;\n                                    // Auto-select the first file when it finishes loading\n                                    if (!vm.activeContentFile && file.data_uri) {\n                                        vm.activeContentFile = file;\n                                    }\n                                })\n                                .catch(function() {\n                                    file._loading = false;\n                                    file._loadError = true;\n                                });\n                        });\n                    } else {\n                        vm.contentFiles = [];\n                    }\n                    vm.contentFilesLoading = false;\n                })\n                .catch(function() {\n                    vm.contentFiles = [];\n                    vm.contentFilesLoading = false;\n                });\n        }\n\n        vm.selectContentFile = function(file) {\n            if (file && file.data_uri) {\n                vm.activeContentFile = file;\n            }\n        };\n\n        vm.hasContentFiles = function() {\n            return vm.contentFiles && vm.contentFiles.length > 0;\n        };\n\n        vm.hasSectionContent = function(section) {\n            if (!vm.lesson) return false;\n            switch(section) {\n                case 'tem':\n                    return vm.lesson.tem && vm.lesson.tem.length > 0;\n                case 'preflight':\n                    return vm.lesson.bullets && vm.lesson.bullets.preflight && vm.lesson.bullets.preflight.length > 0;\n                case 'airex':\n                    return vm.lesson.bullets && vm.lesson.bullets.airex && vm.lesson.bullets.airex.length > 0;\n                case 'debrief':\n                    return vm.lesson.bullets && vm.lesson.bullets.debrief && vm.lesson.bullets.debrief.length > 0;\n                case 'items':\n                    return vm.lesson.items && vm.lesson.items.length > 0;\n                default:\n                    return false;\n            }\n        };\n\n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n       \n\n\n    }\n app.controller('DashboardInstructorBriefController', DashboardInstructorBriefController);\n\n    DashboardInstructorBriefController.$inject = ['UserService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'CourseService', 'BookingService', 'ToastService'];\n    function DashboardInstructorBriefController(UserService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, CourseService, BookingService, ToastService) {\n        var vm = this;\n\n           //    /* PLEASE DO NOT COPY AND PASTE THIS CODE. */(function(){var w=window,C='___grecaptcha_cfg',cfg=w[C]=w[C]||{},N='grecaptcha';var gr=w[N]=w[N]||{};gr.ready=gr.ready||function(f){(cfg['fns']=cfg['fns']||[]).push(f);};(cfg['render']=cfg['render']||[]).push('explicit');(cfg['onload']=cfg['onload']||[]).push('initRecaptcha');w['__google_recaptcha_client']=true;var d=document,po=d.createElement('script');po.type='text/javascript';po.async=true;po.src='https://www.gstatic.com/recaptcha/releases/JPZ52lNx97aD96bjM7KaA0bo/recaptcha__en.js';var e=d.querySelector('script[nonce]'),n=e&&(e['nonce']||e.getAttribute('nonce'));if(n){po.setAttribute('nonce',n);}var s=d.getElementsByTagName('script')[0];s.parentNode.insertBefore(po, s);})();\n\n           // var initRecaptcha = function () { \n           //     // document.getElementById(\"SearchModule\").scope().vm.parent.isGrecaptchaLoaded = !0, \n           //     // document.getElementById(\"SearchModule\").scope().vm.showRecaptcha();\n           //     vm.showRecaptcha();\n           // };\n              \n\n\n\n\n        vm.user = null;\n        vm.allUsers = [];\n      \n\n        vm.action = $state.current.data.action;\n        vm.user = $rootScope.globals.currentUser;\n         ////console.log(\"$rootScope.globals.currentUser : \", $rootScope.globals.currentUser);\n\n        vm.club_id = $rootScope.globals.currentUser.current_club_instructor;\n        vm.user_id = vm.user.id;\n\n        vm.exams = [];\n\n        \n        switch(vm.action){\n            case \"add\":\n                //console.log(\"adding a new course please\");\n                vm.page_title = \"Add a New Course\";\n            break;\n            case \"view\":\n\n                //console.log(\"view an existing course\");\n                load_course();\n\n\n            break;\n            case \"view_lesson\":\n                vm.selected_lesson = $stateParams.lesson_id;\n\n                //console.log(\"view an existing lesson\");\n                load_lesson();\n\n\n            break;\n            case \"list\":\n                //console.log(\"view list of existing courses\");\n                \n                BookingService.GetBookingsToBrief(vm.user.id)\n                    .then(function(data){\n\n                        vm.briefings = data.briefings;   \n                        \n                    });\n\n\n            break;\n            case \"debrief_list\":\n                //console.log(\"view list of existing courses\");\n                \n                BookingService.GetBookingsToDebrief(vm.user.id)\n                    .then(function(data){\n\n                        vm.briefings = data.briefings;   \n                        \n                    });\n\n\n            break;\n            case \"debrief\":\n                //console.log(\"plane_log_sheet\", $stateParams.plane_log_sheet_id);\n                //console.log(\"booking_id\", $stateParams.booking_id);\n                vm.plane_log_sheet_id = $stateParams.plane_log_sheet_id;\n                vm.booking_id = $stateParams.booking_id;\n                \n                console.log(\"STATEPARAMS: \", $stateParams);\n\n                vm.show_split = 0;\n                if($stateParams.split_next_id && $stateParams.split_next_id > 0){\n                    vm.split_next_id = $stateParams.split_next_id;\n                    vm.show_split = 1;\n                    console.log(\"SPLIT NEXT ID!!\", vm.split_next_id);\n                }\n                if($stateParams.split_booking_id && $stateParams.split_booking_id > 0){\n                    vm.split_booking_id = $stateParams.split_booking_id;\n                    vm.show_split = 1;\n                }\n\n                //vm.pls_id = $stateParams.plane_log_sheet_id;\n\n                if(vm.plane_log_sheet_id > 0){\n\n                    //if we claim without a bookout....ugh...\n                    //for_debrief_pls\n                    //get progress for course\n                    BookingService.GetForForDebriefPls(vm.plane_log_sheet_id)\n                        .then(function(data){\n                            if(data.success){\n                                vm.competences = data.competences;   \n                                vm.course_id = data.course_id;   \n                                vm.record_club_id = data.club_id;\n                                vm.lesson = data.lesson;   \n                                vm.all_items = data.all_items;   \n                                vm.my_search = vm.lesson.id;\n                                vm.student = data.student;\n                                vm.instructor = data.instructor;\n                                vm.plane_log_sheet = data.log_sheet;\n\n                                // Load content files for debrief view\n                                if (vm.lesson && vm.lesson.id) {\n                                    load_content_files(vm.lesson.id);\n                                }\n\n                                CourseService.GetLessonsByCourseId(vm.course_id)\n                                .then(function(data){\n                                    vm.all_lessons = data.items;\n                                    // Set selected lesson object for ui-select\n                                    for (var i = 0; i < vm.all_lessons.length; i++) {\n                                        if (String(vm.all_lessons[i].id) === String(vm.lesson.id)) {\n                                            vm.selected_debrief_lesson_obj = vm.all_lessons[i];\n                                            break;\n                                        }\n                                    }\n                                });\n\n                                CourseService.GetTagsByCourseId(vm.course_id)\n                                .then(function(data){\n                                    vm.all_tags = data.items;   \n                                    vm.selected_flight_tags = [];\n                                });\n\n                            } else {\n                                ToastService.error('Load Failed', 'We could not obtain the debriefing information for you...');\n                            }\n                            \n                        });\n\n\n\n                } else {\n                    //get progress for course\n                    BookingService.GetForForDebrief(vm.booking_id)\n                        .then(function(data){\n                            if(data.success){\n                                vm.competences = data.competences;   \n                                vm.course_id = data.course_id;   \n                                vm.record_club_id = data.club_id;\n                                vm.lesson = data.lesson;   \n                                vm.all_items = data.all_items;   \n                                vm.my_search = vm.lesson.id;\n                                vm.student = data.student;\n                                vm.instructor = data.instructor;\n                                vm.plane_log_sheet = data.log_sheet;\n\n                                // Load content files for debrief view\n                                if (vm.lesson && vm.lesson.id) {\n                                    load_content_files(vm.lesson.id);\n                                }\n\n                                CourseService.GetLessonsByCourseId(vm.course_id)\n                                .then(function(data){\n                                    vm.all_lessons = data.items;\n                                    // Set selected lesson object for ui-select\n                                    for (var i = 0; i < vm.all_lessons.length; i++) {\n                                        if (String(vm.all_lessons[i].id) === String(vm.lesson.id)) {\n                                            vm.selected_debrief_lesson_obj = vm.all_lessons[i];\n                                            break;\n                                        }\n                                    }\n                                });\n\n                                CourseService.GetTagsByCourseId(vm.course_id)\n                                .then(function(data){\n                                    vm.all_tags = data.items;   \n                                    vm.selected_flight_tags = [];\n                                });\n\n                            } else {\n                                ToastService.error('Load Failed', 'We could not obtain the debriefing information for you...');\n                            }\n                            \n                        });\n                }\n\n                vm.show_whole_lesson = true;\n\n\n\n                \n\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n        vm.show_all_lessons = false;\n        vm.tag_full_flight = true;\n\n        vm.update_flight_tag = function(){\n            console.log(vm.plane_log_sheet);\n\n            vm.tag_full_flight = true;\n        }\n\n        vm.update_flight_full_flight = function(){\n\n            if((Math.round(vm.tag_flight_time / 5) * 5) > (vm.plane_log_sheet.brakes_times_rounded * 60)){\n                vm.tag_flight_time = (vm.plane_log_sheet.brakes_times_rounded * 60);\n                vm.tag_flight_time = Math.round(vm.tag_flight_time / 5) * 5;\n            }\n\n            if((Math.round(vm.tag_flight_time / 5) * 5) == 0){\n                vm.tag_flight_time = 5;\n            }\n\n            if(vm.tag_full_flight){\n                vm.tag_flight_time = (vm.plane_log_sheet.brakes_times_rounded * 60);\n                vm.tag_flight_time = Math.round(vm.tag_flight_time / 5) * 5;\n            } else {\n                console.log(\"tag full flight\");\n                console.log(vm.plane_log_sheet);\n            }\n            \n        }\n\n        vm.show_whole_course = function(){\n            vm.show_all_lessons = !vm.show_all_lessons;\n            if(vm.show_all_lessons){\n                vm.my_search = \"\";\n                vm.my_search2 = \"\";\n            } else {\n                vm.my_search = vm.lesson.id;\n                vm.my_search2 = \"\";\n            }\n        }\n\n        vm.set_updated_search = function(){\n\n            if(vm.show_all_lessons){\n                vm.my_search = vm.my_search2;\n            } else {\n                    if(vm.my_search2.length > 1){\n                        vm.my_search = vm.my_search2;\n                    } else {\n                        vm.my_search = vm.lesson.id;\n                    }\n            }\n            \n        }\n\n        vm.save_progress = function(){\n\n            var compiled_items = [];\n            for(var i=0;i<vm.all_items.length;i++){\n                if( (vm.all_items[i].result && vm.all_items[i].result > 0) || (vm.all_items[i].remarks && vm.all_items[i].result !== \"\") ){\n                    compiled_items.push(vm.all_items[i]);\n                }\n            }\n\n\n\n            //some rough checks:::\n\n            // //console.log(\"PROGRESS: \", vm.general_remarks);\n            // //console.log(\"PROGRESS: \", compiled_items.length);\n\n            if(compiled_items.length < 1 && (!vm.general_remarks || vm.general_remarks == \"\")){\n                ToastService.warning('Validation', 'To save student records, you need to tick at least one student progress record item OR add a general remark');\n                return false;\n            }\n\n            var next_lesson = vm.lesson.id;\n\n            if(vm.lesson_completed == 1 && vm.next_lesson && vm.next_lesson.id > 0){\n                next_lesson = vm.next_lesson.id;\n            }\n\n            //vm.selected_flight_tags.push(vm.flight_tag);\n\n            vm.compiled_save = {\n                club_id: vm.record_club_id,\n                items: compiled_items,\n                general_remarks: vm.general_remarks,\n                lesson_id: vm.lesson.id,\n                course_id: vm.course_id,\n                user_id: vm.student.id,\n                instructor_id: vm.instructor.id,\n                completed_by: vm.user.id,\n                plane_log_sheet_id: vm.plane_log_sheet.id,\n                next_lesson_id: next_lesson,\n                completed: (vm.lesson_completed) ? 1 : 0,\n                booking_id: vm.booking_id,\n                flight_tags: vm.selected_flight_tags\n            };\n\n            // console.log(vm.compiled_save);\n            // return false;\n\n            //IF EDIT?? NEED TO CHANGE THIS CALL SURELY?\n\n            CourseService.CreateTrainingRecord(vm.compiled_save)\n                .then(function(data){\n                    if(data.success){\n\n                        ToastService.success('Records Saved', 'Thank you!');\n                        if(vm.show_split && vm.split_next_id && vm.split_next_id > 0){\n                            $state.go('dashboard.my_account.book_in', {id: vm.split_next_id});\n                            //dashboard.my_account.book_in({id: log.plane_log_sheet_id})\n                        } else {\n                            $state.go('dashboard.manage_user', {reload: true});\n                        }\n\n\n\n                    } else {\n                        ToastService.error('Save Failed', 'We could not save your training records...');\n                    }\n        \n                });\n\n\n\n\n        }\n        \n        vm.tag_flight_time = 0;\n\n        vm.add_tag = function(){\n            //CHECK IF ADD DOES ALREADY EXIST!!!\n            if(vm.selected_flight_tags.find(tag => tag.id === vm.flight_tag.id)){\n                ToastService.warning('Duplicate Tag', 'You already have this tag on this flight!');\n                return false;\n            }\n\n            if((Math.round(vm.tag_flight_time / 5) * 5) > (vm.plane_log_sheet.brakes_times_rounded * 60)){\n                vm.tag_flight_time = (vm.plane_log_sheet.brakes_times_rounded * 60);\n                vm.tag_flight_time = Math.round(vm.tag_flight_time / 5) * 5;\n            }\n\n            if((Math.round(vm.tag_flight_time / 5) * 5) == 0){\n                vm.tag_flight_time = 5;\n            }\n\n            if(vm.tag_full_flight){\n                vm.tag_flight_time = (vm.plane_log_sheet.brakes_times_rounded * 60);\n                vm.tag_flight_time = Math.round(vm.tag_flight_time / 5) * 5;\n            }\n\n            vm.flight_tag.logging_time = vm.tag_flight_time;\n            // if(!vm.tag_full_flight){\n            //     vm.flight_tag.logging_time = Math.round(vm.tag_flight_time / 5) * 5;\n            // } else {\n            //     vm.flight_tag.logging_time = (vm.plane_log_sheet.brakes_times_rounded * 60);\n            //     vm.tag_flight_time = Math.round(vm.tag_flight_time / 5) * 5;\n            // }\n\n            vm.selected_flight_tags.push(vm.flight_tag);\n            vm.flight_tag = \"\";\n            vm.tag_flight_time = (vm.plane_log_sheet.brakes_times_rounded * 60);\n            vm.tag_flight_time = Math.round(vm.tag_flight_time / 5) * 5;\n            vm.tag_full_flight = true;\n        }\n\n        vm.delete_tag = function(tag, index){\n            vm.selected_flight_tags.splice(index, 1);\n\n        }\n\n        vm.tag_time_to_five = function(){\n            if(vm.tag_flight_time % 5 !== 0){\n                vm.tag_flight_time = Math.round(vm.tag_flight_time / 5) * 5;\n            }            \n        }\n\n        vm.save_edit_record = function(){\n            console.log(\"SAVE THE UPDATE NOW!! WHOOP WHOOP!!\");\n\n            console.log(\"FLIGHT TAGS : \", vm.selected_flight_tags);\n\n            var compiled_items = [];\n            for(var i=0;i<vm.all_items.length;i++){\n                if( (vm.all_items[i].result && vm.all_items[i].result > 0) || (vm.all_items[i].remarks && vm.all_items[i].result !== \"\") ){\n                    compiled_items.push(vm.all_items[i]);\n                }\n            }\n\n            //some rough checks:::\n\n            // //console.log(\"PROGRESS: \", vm.general_remarks);\n            // //console.log(\"PROGRESS: \", compiled_items.length);\n\n            if(compiled_items.length < 1 && (!vm.general_remarks || vm.general_remarks == \"\")){\n                ToastService.warning('Validation', 'To save student records, you need to tick at least one student progress record item OR add a general remark');\n                return false;\n            }\n\n            var next_lesson = vm.lesson.id;\n\n            if(vm.lesson_completed == 1 && vm.next_lesson && vm.next_lesson.id > 0){\n                next_lesson = vm.next_lesson.id;\n            }\n\n\n            vm.compiled_save = {\n                club_id: vm.record_club_id,\n                items: compiled_items,\n                general_remarks: vm.general_remarks,\n                lesson_id: vm.lesson.id,\n                course_id: vm.course_id,\n                user_id: vm.student.id,\n                instructor_id: vm.instructor.id,\n                completed_by: vm.user.id,\n                plane_log_sheet_id: vm.plane_log_sheet.id,\n                next_lesson_id: next_lesson,\n                completed: (vm.lesson_completed) ? 1 : 0,\n                booking_id: vm.booking_id,\n                flight_tags: vm.selected_flight_tags\n            };\n            console.log(\"COMPILED SAVE\");\n            console.log(vm.compiled_save);\n            console.log(\"COMPILED SAVE\");\n\n        }\n\n        function load_course(){\n\n\n             //console.log(\"PARAMS\", $state);\n            CourseService.GetCourseById($stateParams.course_id)\n                    .then(function(data){\n                        vm.course = data.item;   \n\n                        CourseService.GetExamsByCourseId($stateParams.course_id)\n                                .then(function(data){\n                                    vm.course.exams = data.items;   \n                            \n                                });\n\n                        CourseService.GetLessonsByCourseId($stateParams.course_id)\n                                .then(function(data){\n                                    vm.course.lessons = data.items;   \n                                });\n\n                        CourseService.GetTagsByCourseId($stateParams.course_id)\n                        .then(function(data){\n                            vm.all_tags = data.items;   \n\n                        });\n            \n                    });\n             \n            \n\n\n\n        }\n\n        vm.lesson = {};\n        vm.selected_lesson_obj = null;\n        vm.selected_debrief_lesson_obj = null;\n        vm.pending_debrief_lesson_obj = null;\n        vm.show_lesson_switcher = false;\n        vm.contentFiles = [];\n        vm.contentFilesLoading = true;\n        vm.activeContentFile = null;\n\n        vm.change_lesson = function(){\n            if (vm.selected_lesson_obj) {\n                vm.selected_lesson = vm.selected_lesson_obj.id;\n                load_lesson();\n            }\n        }\n\n        vm.confirm_debrief_lesson_change = function(){\n            if (vm.pending_debrief_lesson_obj) {\n                vm.selected_debrief_lesson_obj = vm.pending_debrief_lesson_obj;\n                vm.pending_debrief_lesson_obj = null;\n                vm.show_lesson_switcher = false;\n                vm.change_debrief_lesson();\n            }\n        }\n\n        vm.cancel_debrief_lesson_change = function(){\n            vm.pending_debrief_lesson_obj = null;\n            vm.show_lesson_switcher = false;\n        }\n\n        vm.change_debrief_lesson = function(){\n            if (vm.selected_debrief_lesson_obj) {\n                var lesson_id = vm.selected_debrief_lesson_obj.id;\n\n                CourseService.GetLessonById(lesson_id)\n                    .then(function(data){\n                        if(data.success){\n                            vm.lesson = data.item;\n                            vm.my_search = vm.lesson.id;\n\n                            CourseService.GetBulletsByLessonId(lesson_id)\n                                .then(function(data){\n                                    vm.lesson.bullets = data.bullets;\n                                });\n\n                            CourseService.GetTemByLessonId(lesson_id)\n                                .then(function(data){\n                                    vm.lesson.tem = data.items;\n                                });\n\n                            CourseService.GetItemsByLessonId(lesson_id)\n                                .then(function(data){\n                                    vm.lesson.items = data.items;\n\n                                    // Rebuild all_items to include the new lesson's items for progress tracking\n                                    if (data.items && data.items.length > 0) {\n                                        // Merge new lesson items into all_items if not already present\n                                        angular.forEach(data.items, function(newItem) {\n                                            var exists = vm.all_items.some(function(existing) {\n                                                return String(existing.id) === String(newItem.id);\n                                            });\n                                            if (!exists) {\n                                                vm.all_items.push(newItem);\n                                            }\n                                        });\n                                    }\n                                });\n\n                            load_content_files(lesson_id);\n                        }\n                    });\n            }\n        }\n\n        function load_lesson(){\n\n            vm.booking_id = $stateParams.booking_id;\n\n            CourseService.GetLessonById(vm.selected_lesson)\n                    .then(function(data){\n\n                        if(data.success){\n\n\n\n                             vm.lesson = data.item;   \n\n\n                             CourseService.GetLessonsByCourseId(data.item.course_id)\n                              .then(function(data){\n\n                                        vm.all_lessons = data.items;\n\n                                        // Set the selected lesson object for ui-select\n                                        for (var i = 0; i < vm.all_lessons.length; i++) {\n                                            if (String(vm.all_lessons[i].id) === String(vm.selected_lesson)) {\n                                                vm.selected_lesson_obj = vm.all_lessons[i];\n                                                break;\n                                            }\n                                        }\n                            \n                                    });\n            \n                             CourseService.GetBulletsByLessonId(vm.selected_lesson)\n                                    .then(function(data){\n\n                                        vm.lesson.bullets = data.bullets;\n                            \n                                    });\n\n                            CourseService.GetTemByLessonId(vm.selected_lesson)\n                                .then(function(data){\n                                    //console.log(data);\n\n                                    vm.lesson.tem = data.items;\n\n                                });\n\n                            CourseService.GetItemsByLessonId(vm.selected_lesson)\n                                .then(function(data){\n                                    //console.log(data);\n\n                                    vm.lesson.items = data.items;\n\n                                });\n\n                            // Load content files (images / PDFs)\n                            load_content_files(vm.selected_lesson);\n                        }\n\n                      \n\n\n                    });\n\n\n           \n\n        }\n\n        vm.go_book_out = function(){\n\n            var set_briefed = {booking_id: vm.booking_id, briefed: 1};\n            BookingService.SetBookingToBriefed(vm.booking_id)\n                    .then(function(data){\n\n                        if(data.success){\n\n                            $state.go('dashboard.my_account.bookout_with_booking', {booking_id: vm.booking_id, lesson_id: vm.selected_lesson});\n\n                        } else {\n\n                            ToastService.error('Briefing Error', 'Could not complete the briefing!');\n\n                        }\n                        \n                    });\n        }\n\n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n        // \n        // LESSON CONTENT FILES VIEWER\n        // \n        function load_content_files(lesson_id) {\n            vm.contentFilesLoading = true;\n            vm.contentFiles = [];\n            vm.activeContentFile = null;\n\n            CourseService.GetLessonContentFiles(lesson_id)\n                .then(function(data) {\n                    if (data && data.items && data.items.length > 0) {\n                        vm.contentFiles = data.items;\n                        angular.forEach(vm.contentFiles, function(file) {\n                            file._loading = true;\n                            file.data_uri = null;\n                            CourseService.GetLessonContentFileData(file.id)\n                                .then(function(res) {\n                                    if (res && res.success) {\n                                        file.data_uri = res.data_uri;\n                                        file.file_base64 = res.file;\n                                    }\n                                    file._loading = false;\n                                    if (!vm.activeContentFile && file.data_uri) {\n                                        vm.activeContentFile = file;\n                                    }\n                                })\n                                .catch(function() {\n                                    file._loading = false;\n                                    file._loadError = true;\n                                });\n                        });\n                    } else {\n                        vm.contentFiles = [];\n                    }\n                    vm.contentFilesLoading = false;\n                })\n                .catch(function() {\n                    vm.contentFiles = [];\n                    vm.contentFilesLoading = false;\n                });\n        }\n\n        vm.selectContentFile = function(file) {\n            if (file && file.data_uri) {\n                vm.activeContentFile = file;\n            }\n        };\n\n        vm.hasContentFiles = function() {\n            return vm.contentFiles && vm.contentFiles.length > 0;\n        };\n\n        vm.hasSectionContent = function(section) {\n            if (!vm.lesson) return false;\n            switch(section) {\n                case 'tem':\n                    return vm.lesson.tem && vm.lesson.tem.length > 0;\n                case 'preflight':\n                    return vm.lesson.bullets && vm.lesson.bullets.preflight && vm.lesson.bullets.preflight.length > 0;\n                case 'airex':\n                    return vm.lesson.bullets && vm.lesson.bullets.airex && vm.lesson.bullets.airex.length > 0;\n                case 'debrief':\n                    return vm.lesson.bullets && vm.lesson.bullets.debrief && vm.lesson.bullets.debrief.length > 0;\n                case 'items':\n                    return vm.lesson.items && vm.lesson.items.length > 0;\n                default:\n                    return false;\n            }\n        };\n\n\n       \n\n\n    }\n app.controller('DashboardStudentRecordsController', DashboardStudentRecordsController);\n\n    DashboardStudentRecordsController.$inject = ['ClubService', 'UserService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'CourseService', 'BookingService', 'MemberService', '$sce', 'ToastService'];\n    function DashboardStudentRecordsController(ClubService, UserService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, CourseService, BookingService, MemberService, $sce, ToastService) {\n        var vm = this;\n\n           //    /* PLEASE DO NOT COPY AND PASTE THIS CODE. */(function(){var w=window,C='___grecaptcha_cfg',cfg=w[C]=w[C]||{},N='grecaptcha';var gr=w[N]=w[N]||{};gr.ready=gr.ready||function(f){(cfg['fns']=cfg['fns']||[]).push(f);};(cfg['render']=cfg['render']||[]).push('explicit');(cfg['onload']=cfg['onload']||[]).push('initRecaptcha');w['__google_recaptcha_client']=true;var d=document,po=d.createElement('script');po.type='text/javascript';po.async=true;po.src='https://www.gstatic.com/recaptcha/releases/JPZ52lNx97aD96bjM7KaA0bo/recaptcha__en.js';var e=d.querySelector('script[nonce]'),n=e&&(e['nonce']||e.getAttribute('nonce'));if(n){po.setAttribute('nonce',n);}var s=d.getElementsByTagName('script')[0];s.parentNode.insertBefore(po, s);})();\n\n           // var initRecaptcha = function () { \n           //     // document.getElementById(\"SearchModule\").scope().vm.parent.isGrecaptchaLoaded = !0, \n           //     // document.getElementById(\"SearchModule\").scope().vm.showRecaptcha();\n           //     vm.showRecaptcha();\n           // };\n              \n\n        vm.user = null;\n        vm.allUsers = [];\n      \n\n        vm.action = $state.current.data.action;\n        vm.user = $rootScope.globals.currentUser;\n         ////console.log(\"$rootScope.globals.currentUser : \", $rootScope.globals.currentUser);\n\n        vm.user_id = vm.user.id;\n        vm.club_id = null;\n        vm.instructor_clubs = [];\n        vm.selected_club = null;\n\n        vm.exams = [];\n\n        \n        switch(vm.action){\n            \n            case \"student_records\":\n\n                // Load the clubs this instructor belongs to\n                UserService.GetAdminClubs(vm.user_id)\n                    .then(function(data) {\n                        if (data.success && data.clubs && data.clubs.length > 0) {\n                            vm.instructor_clubs = data.clubs;\n\n                            // Try to restore previously selected club from localStorage\n                            var savedClubId = null;\n                            try {\n                                var stored = localStorage.getItem('toaviate_instructor_selected_club_id');\n                                if (stored !== null) {\n                                    savedClubId = stored;\n                                }\n                            } catch(e) {}\n\n                            var selectedClub = null;\n                            if (savedClubId !== null) {\n                                for (var i = 0; i < vm.instructor_clubs.length; i++) {\n                                    if (String(vm.instructor_clubs[i].id) === String(savedClubId)) {\n                                        selectedClub = vm.instructor_clubs[i];\n                                        break;\n                                    }\n                                }\n                            }\n\n                            if (!selectedClub) {\n                                selectedClub = vm.instructor_clubs[0];\n                            }\n\n                            vm.selected_club = selectedClub;\n                            vm.club_id = selectedClub.id;\n                            load_students_for_club(vm.club_id);\n                        } else {\n                            ToastService.error('Access Error', 'You do not appear to be an instructor at any club.');\n                        }\n                    });\n\n               \n\n\n            break;\n            case \"student_record\":\n                console.log(\"view list of existing courses\", vm.user_id);\n\n                vm.student_id = vm.user_id;\n\n                \n\n\n                    //get clubs\n                    ClubService.GetAllForUser(vm.user_id).then(function(data){\n\n                        vm.clubs = data.clubs;\n                        if(vm.clubs.length < 2 && vm.clubs.length > 0){\n                            vm.club_id = vm.clubs[0].id;\n                            vm.update_club_selector();\n                        }\n                    });\n\n                    // CourseService.GetCoursesByUserId(vm.student_id)\n                    // .then(function(data){\n\n                    //     vm.courses = data.items;\n\n                    // });\n\n                    // CourseService.GetCoursesByClubId(vm.club_id)\n                    // .then(function(data){\n\n                    //     vm.courses = data.items;\n\n                    // });\n                    \n\n              \n\n               \n\n\n            break;\n            default:\n                // //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n        vm.show_record = false;\n        vm.show_add_exam = false;\n\n        // Instructor club selector  called when dropdown changes\n        vm.onInstructorClubSelected = function(club) {\n            vm.selected_club = club;\n            vm.club_id = club.id;\n\n            // Persist selection\n            try {\n                localStorage.setItem('toaviate_instructor_selected_club_id', String(club.id));\n            } catch(e) {}\n\n            // Reset current selections\n            vm.member = null;\n            vm.course = null;\n            vm.show_record = false;\n\n            load_students_for_club(vm.club_id);\n        };\n\n        function load_students_for_club(club_id) {\n            vm.members = [];\n            vm.courses = [];\n\n            MemberService.GetAllByClubStudents(club_id)\n                .then(function(data) {\n                    vm.courses = data.courses;\n                    vm.members = data.members;\n                });\n        }\n\n        vm.update_club_selector = function(){\n\n            // Set club_id from the selected club dropdown before fetching courses\n            if (vm.selected_club && vm.selected_club.id) {\n                vm.club_id = vm.selected_club.id;\n            }\n\n            CourseService.GetCoursesByClubId(vm.club_id)\n                    .then(function(data){\n\n                        vm.courses = data.items;\n\n                    });\n        }\n\n        vm.load_records = function(){\n            if(!vm.member || !vm.course){\n                ToastService.warning('Selection Required', 'You need to select a member and a course to see their training records');\n            } else {\n                vm.student_id = vm.member.user_id;\n                vm.course_id = vm.course.id;\n\n                 CourseService.GetStudentTrainingRecords(vm.student_id, vm.course_id)\n                    .then(function(data){\n                        vm.show_record = true;\n                        vm.all_items = data.all_items;   \n                        vm.student = data.student;\n                        vm.training_records = data.training_records;   \n                        vm.exams = data.exams;\n                        vm.exam_records = data.exam_records;\n                        vm.course_totals = data.course_hours;\n                        vm.log_sheets = data.log_sheets;\n                    });\n\n            }\n        }\n\n        vm.get_initial = function(text){\n                return text.charAt(0);\n            }\n\n            vm.list_pilots = function(row){\n\n            var p1 = \"\";\n            var put = \"\";\n\n            // if(row.instructor_first_name && row.instructor_first_name !== null){\n            //     p1 = \"PIC: \"+row.instructor_first_name+\" \"+row.instructor_last_name;\n            //     put = \"<br />PUT: \"+row.first_name+\" \"+row.last_name;\n            // } else {\n            //     if(row.first_name && row.first_name !== null){\n            //         p1 = \"PIC: \"+row.first_name+\" \"+row.last_name;\n            //     } else {\n            //         p1 = \"PIC not yet set!\";\n            //     }\n            // }\n\n            p1 = \"PIC: \"+ vm.get_pic(row);\n            put = vm.get_put(row);\n            if(put && put !== \"\"){\n                put = \"<br />PUT: \" + put;\n            }\n\n            if(p1 && p1 == \"\"){\n                p1 = \"No PIC set yet!\";\n            }\n\n            return $sce.getTrustedHtml('<div>'+p1+' '+put+'</div>');\n\n        }\n\n        vm.get_pic = function(log){\n\n            var p1 = \"\";\n\n            if(log.pic_first_name && log.pic_first_name !== null){\n                p1 = vm.get_initial(log.pic_first_name) + \". \" + log.pic_last_name;\n            } else if(log.instructor_first_name && log.instructor_first_name !== \"\"){\n                p1 = vm.get_initial(log.instructor_first_name) + \". \" + log.instructor_last_name;\n            } else if(log.instructor_id == 0 && log.first_name && log.first_name !== \"\"){\n                p1 = vm.get_initial(log.first_name) + \". \" + log.last_name;\n            }\n\n            return p1;\n\n        }\n\n        vm.get_put = function(log){\n\n            var put = \"\";\n\n            if(log.put_first_name && log.put_first_name !== null){\n                put = vm.get_initial(log.put_first_name) + \". \" + log.put_last_name;\n            } else if(log.instructor_id > 0 && log.first_name && log.first_name !== \"\"){\n                put = vm.get_initial(log.first_name) + \". \" + log.last_name;\n            } \n\n            return put;\n\n        }\n\n        vm.get_hours_from_decimal = function(time){\n\n            if(time){\n                 var sign = time < 0 ? \"-\" : \"\";\n                 var hour = Math.floor(Math.abs(time));\n                 var min = Math.round((Math.abs(time) * 60) % 60);\n                 if(min == 60){\n                     hour++;\n                     min = 0;\n                 }\n                 return sign + (hour < 10 ? \"0\" : \"\") + hour + \":\" + (min < 10 ? \"0\" : \"\") + min;\n             } else {\n                 return \"N/A\";\n             }\n        }\n\n        vm.clean_times = function(time){\n                return time.substring(0,5);\n            }\n\n\n\n        vm.search3 = function(row){\n            //(angular.lowercase(row.first_name).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)  || (angular.lowercase(row.last_name).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)\n            ////console.log(\"answer\", (angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1));\n            // return ((angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || (angular.lowercase(row.flight_time).indexOf(angular.lowercase($scope.my_search2)) || '') !== -1)));\n            //(angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)\n           \n            // if( (test_date($scope.my_search2, row.flight_date)) || (angular.lowercase(row.destination_airport).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) || (angular.lowercase(row.departure_airport).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) || (angular.lowercase(row.destination_airport_code).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) || (angular.lowercase(row.departure_airport_code).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)){\n            //     return true;\n            // } else {\n            //     return false;\n            // }\n            ////console.log($scope.my_search2);\n            if(!vm.my_search3 || (vm.my_search3 == \"\")){\n                return true;\n            }else if(test_date(vm.my_search3, row.flight_date)){\n                return true;\n            } else if(test_name(row.first_name, row.last_name, vm.my_search3 )){\n                return true;\n            } else if(test_name(row.pic_first_name, row.pic_last_name, vm.my_search3 )){\n                return true;\n            } else if(test_name(row.instructor_first_name, row.instructor_last_name, vm.my_search3 )){\n                return true;\n            } else if(test_aircraft(row.registration, vm.my_search3 )){\n                return true;\n            } else if(test_airfield(vm.my_search3, row.departure_airport, row.departure_airport_code)){\n                return true;\n            } else if(test_airfield(vm.my_search3, row.destination_airport, row.destination_airport_code)){\n                return true;\n            }else {\n                return false;\n            }\n\n            // we are testing for the date, the pilot, the departure and destination.\n\n            // return (angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1); // ? (angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) : (angular.lowercase(row.flight_time).indexOf(angular.lowercase($scope.my_search2) || '') !== -1);\n\n        };\n\n        function test_date(search, date){\n\n\n            if(search.length < 2){\n                return false;\n            }\n\n            if(search && search.length <= 3){\n                if(date.indexOf(search) > -1){\n                    return true;\n                }\n            } else {\n                var parsed_date = \"\";\n                var b = moment(search);\n                if(b.isValid() && b.format(\"YYYY\") != \"2001\"){\n                    parsed_date = b.format(\"YYYY-MM-DD\");\n                } else if(b.isValid()){\n                    parsed_date = b.format(\"MM-DD\");\n                }\n\n\n                var search_type = 0;\n\n                if(parsed_date !== \"\" && date.indexOf(parsed_date) > -1){\n                    // //console.log(\"found\");\n                    return true;\n                } else {\n\n                    //backup in case of wrong parsing data::;\n                    //european method\n\n                    if(search.length <= 5 && search.length >= 4){\n\n                        var c = moment(search, \"DDMM\");\n                        // //console.log(\"C is : \", c);\n                        if(c.isValid()){\n                            var c2 = c.format(\"MM-DD\");\n                            if(date.indexOf(c2) > -1){\n                                return true;\n                            }\n                        }\n\n                    } else if(search.length == 8 || search.length == 10){\n                        \n                        var c = moment(search, \"DDMMYYYY\");\n                        // //console.log(\"C is : \", c);\n                        if(c.isValid()){\n                            var c2 = c.format(\"YYYY-MM-DD\");\n                            if(date.indexOf(c2) > -1){\n                                return true;\n                            }\n                        }\n\n                    }\n\n                    // //console.log(\"not found\");\n                    return false;\n                }\n            }\n\n        }\n\n\n        function test_name(fname, lname, search){\n\n            var search2 = search.toLowerCase();\n            var fullname = fname+\" \"+lname;\n            fullname = fullname.toLowerCase();    \n            // //console.log(\"fullname: \", fullname);\n            // //console.log(\"search: \", search2);\n            // //console.log(\"match: \", (fullname.indexOf(search2) > -1));\n            if(search.length > 2 && (fullname.indexOf(search2) > -1) ){\n                return true;\n            } else {\n                return false;\n            }\n\n        }\n\n        function test_aircraft(registration, search){\n\n            var search2 = search.toLowerCase().replace(\"-\", \"\");\n            var fullname = registration.replace(\"-\", \"\");\n            fullname = fullname.toLowerCase();    \n            //  //console.log(\"fullname: \", fullname);\n            // //console.log(\"search: \", search2);\n            // //console.log(\"match: \", (fullname.indexOf(search2) > -1));\n            if(search.length > 2 && (fullname.indexOf(search2) > -1) ){\n                return true;\n            } else {\n                return false;\n            }\n\n        }\n\n        function test_airfield(search, name, code){\n            var name2 = name.toLowerCase();\n            var code2 = code.toLowerCase();\n            var search2 = search.toLowerCase();\n\n            if(search2.length > 2 && (name2.indexOf(search2) > -1)){\n                return true;\n            } else if(search2.length > 2 && (code2.indexOf(search2) > -1)){\n                return true;\n            } else {\n                return false;\n            }\n\n\n\n        }\n\n        vm.load_records_user = function(){\n            if( !vm.course){\n                ToastService.warning('Selection Required', 'You need to select a course to see your training records');\n            } else {\n\n                vm.course_id = vm.course.id;\n\n                 CourseService.GetStudentTrainingRecords(vm.student_id, vm.course_id)\n                    .then(function(data){\n                        vm.show_record = true;\n                        vm.all_items = data.all_items;   \n                        vm.student = data.student;\n                        vm.training_records = data.training_records;   \n                        vm.exams = data.exams;\n                        vm.exam_records = data.exam_records;\n                        vm.course_totals = data.course_hours;\n                        vm.log_sheets = data.log_sheets;\n                    });\n\n            }\n        }\n\n        vm.load_selected_flight = function(flight_id){\n\n\n        }\n\n        vm.add_exam_record = function(){\n            //console.log(\"NEW EXAM\", vm.new_exam);\n            vm.new_exam.user_id = vm.student_id;\n            vm.new_exam.course_id = vm.course_id;\n            CourseService.CreateExamRecord(vm.new_exam)\n                                .then(function(data){\n                                    if(data.success){\n                                        vm.load_records();\n                                        vm.show_add_exam = false;\n\n                                        //clear the vm.new_exam\n\n                                    } else {\n                                        ToastService.error('Exam Error', 'The exam could not be added');\n                                    }\n                                });\n        }\n\n        vm.get_remarks = function(item_id, record){\n\n             var object = record.items.find(function(item){ return item.lesson_item_id === item_id; });\n             \n\n            return (object) ? object.remarks : \"\";\n\n        }\n\n        vm.get_result = function(item_id, record){\n\n            var object = record.items.find(function(item){ return item.lesson_item_id === item_id; });\n\n            return (object) ? object.grade_name : \"\";\n\n        }\n\n        vm.get_result3 = function(item_id){\n\n            var object = record.items.find(function(item){ return item.lesson_item_id === item_id; });\n\n            return (object) ? object.grade_name : \"\";\n\n        }\n\n        vm.get_competence = function(item_id, record){\n\n            var object = record.items.find(function(item){ return item.lesson_item_id === item_id; });\n            var icons = \"\";\n            var icons2 = \"\";\n            if(object && object.grade_colour && object.grade_name){\n                icons = $sce.getTrustedHtml('<span style=\"color: '+object.grade_colour+'\" ><i class=\"fa fa-'+object.grade_icon+'\" style=\"color: '+object.grade_colour+'\"></i></span>');\n                \n                icons2 = $sce.trustAsHtml('<span style=\"color: '+object.grade_colour+'\" ><i class=\"fa fa-'+object.grade_icon+'\" style=\"color: '+object.grade_colour+'\"></i></span>');\n                // console.log(\"COLOUR: \"+object.grade_colour+\" AND NAME: \"+object.grade_name+\" AND TITLE: \"+object.grade_name);\n            }\n\n\n\n            return (object) ? icons2 : \"\";\n            \n        }\n\n        vm.get_competence2 = function(object){\n\n            //var object = record.items.find(function(item){ return item.lesson_item_id === item_id; });\n            var icons = \"\";\n            var icons2 = \"\";\n            if(object && object.grade_colour && object.grade_name){\n                icons = $sce.getTrustedHtml('<span style=\"color: '+object.grade_colour+'\" ><i class=\"fa fa-'+object.grade_icon+'\" style=\"color: '+object.grade_colour+'\"></i></span>');\n                \n                icons2 = $sce.trustAsHtml('<span style=\"color: '+object.grade_colour+'\" ><i class=\"fa fa-'+object.grade_icon+'\" style=\"color: '+object.grade_colour+'\"></i></span>');\n                // console.log(\"COLOUR: \"+object.grade_colour+\" AND NAME: \"+object.grade_name+\" AND TITLE: \"+object.grade_name);\n            }\n\n\n\n            return (object) ? icons2 : \"\";\n            \n        }\n\n        vm.get_flight_date = function(item_id, record){\n            var item = record.items.find(function(item){ return item.lesson_item_id === item_id; });\n            return (item) ? item.flight_date : \"\";\n        }\n\n        vm.user_can_edit = false;\n\n        vm.get_record_details = function(item_id, record){\n            \n            var item = record.items.find(function(item){ return item.lesson_item_id === item_id; });\n\n            if(item){\n\n\n                var record_details = \"<h4>Training Record Details</h4><table class='inner_overlay_tble'>\";\n\n                if(item.flight_date && item.flight_date !== \"\"){\n                    record_details += \"<tr><td>Flight Date:</td><td>\"+item.flight_date+\"</td></tr>\";\n                }\n\n                if(item.instructor_id > 0 && item.instructor_first_name !== \"\"){\n                    record_details += \"<tr><td><span class='instructor'>Instructor:</span></td><td>\"+vm.get_initial(item.instructor_first_name)+\" \"+item.instructor_last_name+\"</td></tr>\";\n                }\n\n                if(item.completed_by > 0 && item.completed_by_first_name !== \"\" && item.completed_by !== item.instructor_id){\n                    record_details += \"<tr><td><span class='instructor'>Record By:</span></td><td>\"+vm.get_initial(item.completed_by_first_name)+\" \"+item.completed_by_last_name+\"</td></tr>\";\n                }\n\n                if(item.remarks && item.remarks !== \"\"){\n                    record_details += \"<tr><td><span class='instructor'>Remarks:</td><td></td></tr><tr><td colspan='2'>\"+item.remarks+\"</td> </tr>\";\n                }\n\n                if(record_details && record_details !== \"\"){\n                    record_details += \"</table>\";\n                }\n\n\n\n                return $sce.getTrustedHtml(record_details);\n            } else{\n                return \" \";\n            }\n        }\n\n        vm.get_record_details2 = function(item){\n            \n            //var item = record.items.find(function(item){ return item.lesson_item_id === item_id; });\n\n            if(item){\n\n\n                var record_details = \"<h4>Training Record Details</h4><table class='inner_overlay_tble'>\";\n\n                if(item.flight_date && item.flight_date !== \"\"){\n                    record_details += \"<tr><td>Flight Date:</td><td>\"+item.flight_date+\"</td></tr>\";\n                }\n\n                if(item.registration && item.registration !== \"\"){\n                    record_details += \"<tr><td>Aircraft:</td><td>\"+item.registration+\"</td></tr>\";\n                    record_details += \"<tr><td>Type:</td><td>\"+item.plane_type+\"</td></tr>\";\n                }\n\n\n\n                if(item.instructor_id > 0 && item.instructor_first_name !== \"\"){\n                    record_details += \"<tr><td><span class='instructor'>Instructor:</span></td><td>\"+vm.get_initial(item.instructor_first_name)+\" \"+item.instructor_last_name+\"</td></tr>\";\n                }\n\n                if(item.completed_by > 0 && item.completed_by_first_name !== \"\" && item.completed_by !== item.instructor_id){\n                    record_details += \"<tr><td><span class='instructor'>Record By:</span></td><td>\"+vm.get_initial(item.completed_by_first_name)+\" \"+item.completed_by_last_name+\"</td></tr>\";\n                }\n\n                if(item.remarks && item.remarks !== \"\"){\n                    record_details += \"<tr><td><span class='instructor'>Remarks:</td><td></td></tr><tr><td colspan='2'>\"+item.remarks+\"</td> </tr>\";\n                }\n\n                if(record_details && record_details !== \"\"){\n                    record_details += \"</table>\";\n                }\n\n\n\n                return $sce.getTrustedHtml(record_details);\n            } else{\n                return \"This objective has not yet been marked as complete by your instructor\";\n            }\n        }\n\n        vm.get_exam = function(exam_id){\n\n            var object = vm.exam_records.find(function(item){ return item.exam_id === exam_id; });\n            return (object) ? object : \"\";\n        }\n\n        vm.open_training_detail = function(pls_id, plane_log_sheet){\n            vm.show_popup = true;\n            show_edit_training_record = false;\n            vm.show_popup_name = \"see_records\";\n            vm.flight_detail_id = pls_id;\n            vm.user_can_edit = vm.user_can_edit_record();\n\n            vm.selected_flight = plane_log_sheet;\n\n            //fetch the new one here?\n            vm.selected_record = {};\n            vm.selected_record_remarks = \"\";\n\n            CourseService.GetStudentTrainingRecordsForFlight(vm.student_id, vm.course_id, vm.flight_detail_id)\n                    .then(function(data){\n                        \n                        vm.competences = data.competences;   \n                        vm.selected_record = data.all_items;\n                        vm.selected_record_remarks = data.general_remarks;\n                        vm.this_entry = data.this_entry;\n\n                    });\n        }\n\n        vm.close_popup = function(){\n            vm.show_popup = false;\n\n            vm.show_edit_training_record = false;\n\n            vm.selected_record = {};\n            vm.selected_record_remarks = \"\";\n            vm.this_entry = {};\n\n        }\n\n\n        function load_course(){\n\n\n             ////console.log(\"PARAMS\", $state);\n            CourseService.GetCourseById($stateParams.course_id)\n                    .then(function(data){\n                        vm.course = data.item;   \n            \n                    });\n             \n            CourseService.GetExamsByCourseId($stateParams.course_id)\n                    .then(function(data){\n                        vm.course.exams = data.items;   \n                \n                    });\n\n            CourseService.GetLessonsByCourseId($stateParams.course_id)\n                    .then(function(data){\n                        vm.course.lessons = data.items;   \n                    });\n\n\n\n        }\n\n\n       \n\n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n        vm.set_updated_search = function(){\n\n            if(vm.show_all_lessons){\n                vm.my_search = vm.my_search2;\n            } else {\n                    if(vm.my_search2.length > 1){\n                        vm.my_search = vm.my_search2;\n                    } else {\n                        vm.my_search = vm.lesson.id;\n                    }\n            }\n            \n        }\n        vm.all_tags = [];\n        vm.show_edit_training_record = false;\n        vm.show_edit_record = function(){\n\n            //OK let's edit some records!!!\n            vm.show_edit_training_record = true;\n            vm.lesson = vm.selected_record;\n            vm.plane_log_sheet = vm.selected_flight;//vm.lesson.log_sheets;\n\n            console.log(\"PLS : \", vm.plane_log_sheet);\n            console.log(\"TAGS : \", vm.plane_log_sheet.flight_tags);\n\n            CourseService.GetTagsByCourseId(vm.course_id)\n            .then(function(data){\n                for(var i=0;i<data.items.length;i++){\n                    data.items.flight_tag_id = data.items.id;\n                }  \n                vm.all_tags = data.items; \n            });\n\n            //cleaning it??\n            vm.selected_flight_tags = vm.plane_log_sheet.flight_tags;\n            for(var i=0;i<vm.selected_flight_tags.length;i++){\n                vm.selected_flight_tags[i][\"logging_time\"] = Math.round((vm.selected_flight_tags[i].tag_time * 60) / 5) * 5;\n            }\n\n\n            CourseService.GetExamsByCourseId(vm.course_id)\n                                .then(function(data){\n                                    vm.course.exams = data.items;   \n                            \n                                });\n\n            CourseService.GetLessonsByCourseId(vm.course_id)\n                    .then(function(data){\n                        vm.course.lessons = data.items;   \n                    });\n\n            vm.is_lesson_completed = (vm.this_entry.completed == 1)? true : false;\n\n        }\n\n        vm.tag_flight_time = 0;\n\n        vm.add_tag = function(){\n            //CHECK IF ADD DOES ALREADY EXIST!!!\n            if(vm.selected_flight_tags.find(tag => tag.flight_tag_id === vm.flight_tag.id)){\n                ToastService.warning('Duplicate Tag', 'You already have this tag on this flight!');\n                return false;\n            }\n\n            //matching the correct tag IDs\n            vm.flight_tag.flight_tag_id = vm.flight_tag.id;\n\n            if((Math.round(vm.tag_flight_time / 5) * 5) > (vm.plane_log_sheet.brakes_times_rounded * 60)){\n                vm.tag_flight_time = (vm.plane_log_sheet.brakes_times_rounded * 60);\n                vm.tag_flight_time = Math.round(vm.tag_flight_time / 5) * 5;\n            }\n\n            if((Math.round(vm.tag_flight_time / 5) * 5) == 0){\n                vm.tag_flight_time = 5;\n            }\n\n            if(vm.tag_full_flight){\n                vm.tag_flight_time = (vm.plane_log_sheet.brakes_times_rounded * 60);\n                vm.tag_flight_time = Math.round(vm.tag_flight_time / 5) * 5;\n            }\n\n            vm.flight_tag.logging_time = vm.tag_flight_time;\n            // if(!vm.tag_full_flight){\n            //     vm.flight_tag.logging_time = Math.round(vm.tag_flight_time / 5) * 5;\n            // } else {\n            //     vm.flight_tag.logging_time = (vm.plane_log_sheet.brakes_times_rounded * 60);\n            //     vm.tag_flight_time = Math.round(vm.tag_flight_time / 5) * 5;\n            // }\n\n            vm.selected_flight_tags.push(vm.flight_tag);\n            vm.flight_tag = \"\";\n            vm.tag_flight_time = (vm.plane_log_sheet.brakes_times_rounded * 60);\n            vm.tag_flight_time = Math.round(vm.tag_flight_time / 5) * 5;\n            vm.tag_full_flight = true;\n        }\n\n        vm.delete_tag = function(tag, index){\n            vm.selected_flight_tags.splice(index, 1);\n\n        }\n\n        vm.tag_time_to_five = function(){\n            if(vm.tag_flight_time % 5 !== 0){\n                vm.tag_flight_time = Math.round(vm.tag_flight_time / 5) * 5;\n            }            \n        }\n\n\n        /*\n            vm.save_edit_record = function(){\n            console.log(\"SAVE THE UPDATE NOW!! WHOOP WHOOP!!\");\n\n            console.log(\"FLIGHT TAGS : \", vm.selected_flight_tags);\n\n            var compiled_items = [];\n            for(var i=0;i<vm.all_items.length;i++){\n                if( (vm.all_items[i].result && vm.all_items[i].result > 0) || (vm.all_items[i].remarks && vm.all_items[i].result !== \"\") ){\n                    compiled_items.push(vm.all_items[i]);\n                }\n            }\n\n            //some rough checks:::\n\n            // //console.log(\"PROGRESS: \", vm.general_remarks);\n            // //console.log(\"PROGRESS: \", compiled_items.length);\n\n            if(compiled_items.length < 1 && (!vm.general_remarks || vm.general_remarks == \"\")){\n                ToastService.warning('Validation', 'To save student records, you need to tick at least one student progress record item OR add a general remark');\n                return false;\n            }\n\n            var next_lesson = vm.lesson.id;\n\n            if(vm.lesson_completed == 1 && vm.next_lesson && vm.next_lesson.id > 0){\n                next_lesson = vm.next_lesson.id;\n            }\n\n\n            vm.compiled_save = {\n                club_id: vm.record_club_id,\n                items: compiled_items,\n                general_remarks: vm.general_remarks,\n                lesson_id: vm.lesson.id,\n                course_id: vm.course_id,\n                user_id: vm.student.id,\n                instructor_id: vm.instructor.id,\n                completed_by: vm.user.id,\n                plane_log_sheet_id: vm.plane_log_sheet.id,\n                next_lesson_id: next_lesson,\n                completed: (vm.lesson_completed) ? 1 : 0,\n                booking_id: vm.booking_id,\n                flight_tags: vm.selected_flight_tags\n            };\n            console.log(\"COMPILED SAVE\");\n            console.log(vm.compiled_save);\n            console.log(\"COMPILED SAVE\");\n\n        }\n\n        */\n\n        vm.save_edit_record = function(){\n\n            console.log(\"SAVE THE UPDATE NOW!! WHOOP WHOOP!!\");\n\n            console.log(\"THIS ENTRY : \", vm.this_entry);\n            console.log(\"FLIGHT TAGS : \", vm.selected_flight_tags);\n            console.log(\"SELECTED RECORD?? : \", vm.selected_record);\n\n            var compiled_items = [];\n            for(var i=0;i<vm.selected_record.length;i++){\n                if( (vm.selected_record[i].this_entry && (vm.selected_record[i].this_entry.result || vm.selected_record[i].this_entry.remarks) && (vm.selected_record[i].this_entry.result > -1 || vm.selected_record[i].this_entry.remarks !== \"\")) ){\n                    var entry = {\"remarks\": vm.selected_record[i].this_entry.remarks, \"result\": vm.selected_record[i].this_entry.result, \"lesson_item_id\": vm.selected_record[i].id};\n                    compiled_items.push(entry);\n                }\n            }\n// {\"id\":100,\"training_record_id\":6,\"lesson_item_id\":1,\"result\":4,\"completed_by\":2,\"remarks\":\"\",\"updated_at\":\"2024-10-31 18:46:17\",\"created_at\":\"2024-10-31 18:46:17\",\"deleted\":0,\"deleted_at\":\"0000-00-00 00:00:00\",\"grade_name\":\"Competent\",\"grade_icon\":\"star\",\"grade_colour\":\"#4CBB17\",\"plane_log_sheet_id\":138,\"general_remarks\":\"Flew very well almost there\",\"pic_id\":2,\"put_id\":3,\"user_id\":3,\"instructor_id\":2,\"flight_date\":\"2024-09-29\",\"plane_id\":13,\"instructor_first_name\":\"Alex\",\"instructor_last_name\":\"Reynier\",\"pic_first_name\":\"Alex\",\"pic_last_name\":\"Reynier\",\"put_first_name\":\"Camilla\",\"put_last_name\":\"Barber\",\"usr_first_name\":\"Camilla\",\"usr_last_name\":\"Barber\",\"completed_by_first_name\":\"Alex\",\"completed_by_last_name\":\"Reynier\",\"registration\":\"G-NIXIS\",\"plane_type\":\"C182\",\"type_name\":\"SKYLANE\"}}\n            //some rough checks:::\n\n            console.log(\"COMPILED ITEMS: \", compiled_items);\n            // //console.log(\"PROGRESS: \", compiled_items.length);\n\n            if(compiled_items.length < 1 && (!vm.general_remarks || vm.general_remarks == \"\")){\n                ToastService.warning('Validation', 'To save student records, you need to tick at least one student progress record item OR add a general remark');\n                return false;\n            }\n\n            var next_lesson = vm.this_entry.next_lesson_id;\n\n            console.log(\"NEXT LESSON: \", next_lesson);\n\n            if(vm.lesson_completed == 1 && vm.next_lesson && vm.next_lesson.id > 0){\n                next_lesson = vm.next_lesson.id;\n            }\n\n            console.log(\"NEXT LESSON: \", next_lesson);\n            console.log(\"vm.booking_id : \", vm.booking_id);\n\n            vm.compiled_save = {\n                update_record_id: vm.this_entry.id,\n                club_id: vm.this_entry.club_id,\n                items: compiled_items,\n                general_remarks: vm.this_entry.general_remarks,//vm.general_remarks,\n                lesson_id: vm.this_entry.lesson_id,\n                course_id: vm.this_entry.course_id,\n                user_id: vm.this_entry.user_id, // vm.student.id,\n                instructor_id: vm.this_entry.instructor_id,\n                completed_by: vm.this_entry.completed_by,\n                plane_log_sheet_id: vm.selected_flight.id,\n                next_lesson_id: next_lesson,\n                edited_by: vm.user.id,\n                completed: (vm.lesson_completed) ? 1 : 0,\n                //booking_id: vm.booking_id,\n                flight_tags: vm.selected_flight_tags,\n                edit_reason: vm.edit_reason\n            };\n\n            console.log(\"COMPILED SAVE\");\n            console.log(vm.compiled_save);\n            console.log(\"COMPILED SAVE\");\n\n            \n            //SENT THIS COMPILED SAVE TO THE SERVER\n\n\n            CourseService.UpdateTrainingRecord(vm.compiled_save, vm.this_entry.id)\n                .then(function(data){\n                    if(data.success){\n\n                        ToastService.success('Records Saved', 'Thank you!');\n                        //$state.go('dashboard.manage_user', {reload: true});\n                        //vm.show_record = false;\n                        //vm.show_edit_record = false;\n                        \n\n                        CourseService.GetStudentTrainingRecords(vm.student_id, vm.course_id)\n                        .then(function(data){\n                            vm.show_record = true;\n                            vm.all_items = data.all_items;   \n                            vm.student = data.student;\n                            vm.training_records = data.training_records;   \n                            vm.exams = data.exams;\n                            vm.exam_records = data.exam_records;\n                            vm.course_totals = data.course_hours;\n                            vm.log_sheets = data.log_sheets;\n                        });\n\n                        vm.show_edit_training_record = false;\n                        vm.close_popup();\n\n                        //clearing this\n                        vm.lesson = {};\n                        vm.plane_log_sheet = {};\n                        vm.compiled_save = {};\n                        vm.this_entry = {};\n\n                    } else {\n                        ToastService.error('Save Failed', 'We could not save your training records...');\n                    }\n        \n                });\n\n\n            // CLOSE THIS VIEW\n\n            // RELOAD THE BELOW VIEW\n\n\n\n\n            \n        }\n\n\n        vm.tag_full_flight = true;\n\n        vm.update_flight_tag = function(){\n            console.log(vm.plane_log_sheet);\n\n            vm.tag_full_flight = true;\n        }\n\n        vm.update_flight_full_flight = function(){\n\n            if((Math.round(vm.tag_flight_time / 5) * 5) > (vm.plane_log_sheet.brakes_times_rounded * 60)){\n                vm.tag_flight_time = (vm.plane_log_sheet.brakes_times_rounded * 60);\n                vm.tag_flight_time = Math.round(vm.tag_flight_time / 5) * 5;\n            }\n\n            if((Math.round(vm.tag_flight_time / 5) * 5) == 0){\n                vm.tag_flight_time = 5;\n            }\n\n            if(vm.tag_full_flight){\n                vm.tag_flight_time = (vm.plane_log_sheet.brakes_times_rounded * 60);\n                vm.tag_flight_time = Math.round(vm.tag_flight_time / 5) * 5;\n            } else {\n                console.log(\"tag full flight\");\n                console.log(vm.plane_log_sheet);\n            }\n            \n        }\n\n        vm.user_can_edit_record = function(){\n            // vm.training_records.club_id\n            // vm.user.access.manager\n            var is_manager = (vm.user.access.manager.find(function(item){ return item === vm.training_records.club_id; }))? true : false;\n\n            if(vm.training_records.instructor_id == vm.user_id || vm.user_id == vm.training_records.completed_by || is_manager){\n                console.log(\"should have access to edit this record\");\n                return true;\n            }\n\n            console.log(\"should NOT have access to edit this record - tempo return true though\");\n            //this should be false\n            return true;\n        }\n       \n\n\n    }\n app.controller('DashboardUserInstructorController', DashboardUserInstructorController);\n\n    DashboardUserInstructorController.$inject = ['UserService', 'MemberService', 'InstructorService', 'MembershipService', 'PlaneService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'ToastService'];\n    function DashboardUserInstructorController(UserService, MemberService, InstructorService, MembershipService, PlaneService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, ToastService) {\n        var vm = this;\n\n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {};\n        vm.page_title = \"\";\n        vm.club.member = {};\n        \n        vm.imported_new_headers = [];\n\n        // vm.club.member.membership_id = {};\n        \n        vm.action = $state.current.data.action;\n        \n\n        vm.user = $rootScope.globals.currentUser;\n        // vm.club_id = 6;\n        // vm.user_id = 59;\n        vm.user_id = vm.user.id;\n\n\n\n        vm.no_show_cols = [\"membership_start\", \"membership_id\", \"selected\"];\n\n\n        $scope.sortType     = 'Email'; // set the default sort type\n        $scope.sortReverse  = false;  // set the default sort order\n        $scope.searchTool   = '';     // set the default search/filter term\n\n\n\n\n          $scope.mytime = new Date();\n\n          $scope.hstep = 1;\n          $scope.mstep = 15;\n\n         vm.days = [\n            {\n                day: \"Monday\",\n                from_variable: \"monday_from_time\",\n                to_variable: \"monday_to_time\",\n                disabled_variable: \"monday_disabled\"\n            },\n            {\n                day: \"Tuesday\",\n                from_variable: \"tuesday_from_time\",\n                to_variable: \"tuesday_to_time\",\n                disabled_variable: \"tuesday_disabled\"\n            },\n            {\n                day: \"Wednesday\",\n                from_variable: \"wednesday_from_time\",\n                to_variable: \"wednesday_to_time\",\n                disabled_variable: \"wednesday_disabled\"\n            },\n            {\n                day: \"Thursday\",\n                from_variable: \"thursday_from_time\",\n                to_variable: \"thursday_to_time\",\n                disabled_variable: \"thursday_disabled\"\n            },\n            {\n                day: \"Friday\",\n                from_variable: \"friday_from_time\",\n                to_variable: \"friday_to_time\",\n                disabled_variable: \"friday_disabled\"\n            },\n            {\n                day: \"Saturday\",\n                from_variable: \"saturday_from_time\",\n                to_variable: \"saturday_to_time\",\n                disabled_variable: \"saturday_disabled\"\n            },\n            {\n                day: \"Sunday\",\n                from_variable: \"sunday_from_time\",\n                to_variable: \"sunday_to_time\",\n                disabled_variable: \"sunday_disabled\"\n            }\n         ];\n\n\n         var timezone = \"Europe/London\";\n\n        // var from_default = new Date(luxon.DateTime.now().setZone(timezone).toISO());\n        var from_default = new Date();\n        from_default.setHours( 9 );\n        from_default.setMinutes( 0 );\n\n        // var to_default = new Date(luxon.DateTime.now().setZone(timezone).toISO());\n        var to_default = moment.utc(\"2021-01-01T18:15:00Z\").toISOString(); //moment.utc(\"2021-01-01T09:00Z\").format(); //new Date();\n        // to_default.setHours( 18 );\n        // to_default.setMinutes( 0 );\n\n\n\n\n\n        InstructorService.GetAvailability(vm.user.id)\n                    .then(function(data){\n\n\n\n                        vm.available_times = data;\n                        for(var i =0;i<vm.available_times.length;i++){\n                            //resetting all the defaults to 9am to 5pm every single day - prob should be done in the backend...\n                            if(vm.available_times[i][\"monday_from_time\"] == vm.available_times[i][\"monday_to_time\"]){\n                                // alert(\"now monday ==> \", vm.available_times[i][\"monday_from_time\"]);\n                               vm.available_times[i][\"monday_from_time\"] = from_default;\n                               vm.available_times[i][\"monday_to_time\"] = to_default;\n                            }\n                            if(vm.available_times[i][\"tuesday_from_time\"] == vm.available_times[i][\"tuesday_to_time\"]){\n                               vm.available_times[i][\"tuesday_from_time\"] = from_default;\n                               vm.available_times[i][\"tuesday_to_time\"] = to_default;\n                            }\n                            if(vm.available_times[i][\"wednesday_from_time\"] == vm.available_times[i][\"wednesday_to_time\"]){\n                               vm.available_times[i][\"wednesday_from_time\"] = from_default;\n                               vm.available_times[i][\"wednesday_to_time\"] = to_default;\n                            }\n                            if(vm.available_times[i][\"thursday_from_time\"] == vm.available_times[i][\"thursday_to_time\"]){\n                               vm.available_times[i][\"thursday_from_time\"] = from_default;\n                               vm.available_times[i][\"thursday_to_time\"] = to_default;\n                            }\n                            if(vm.available_times[i][\"friday_from_time\"] == vm.available_times[i][\"friday_to_time\"]){\n                               vm.available_times[i][\"friday_from_time\"] = from_default;\n                               vm.available_times[i][\"friday_to_time\"] = to_default;\n                            }\n                            if(vm.available_times[i][\"saturday_from_time\"] == vm.available_times[i][\"saturday_to_time\"]){\n                               vm.available_times[i][\"saturday_from_time\"] = from_default;\n                               vm.available_times[i][\"saturday_to_time\"] = to_default;\n                            }\n                            if(vm.available_times[i][\"sunday_from_time\"] == vm.available_times[i][\"sunday_to_time\"]){\n                               vm.available_times[i][\"sunday_from_time\"] = from_default;\n                               vm.available_times[i][\"sunday_to_time\"] = to_default;\n                            }\n\n\n                            // console.log(\"MONDAY === \");\n                            // console.log(\"DEFAULT: \", vm.available_times[i][\"monday_from_time\"] );\n                            // var a = vm.available_times[i][\"monday_from_time\"];\n                            // var b = a.split(\":\");\n                            // console.log(\"SPLIT: \", b);\n                            // console.log(\"COMPOSED: \"+b[0]+\" and \"+b[1]);\n                            // console.log(\"PARSE\", Date.parse(\"2021-01-01T\"+vm.available_times[i][\"monday_from_time\"]+\"Z\", \"HH:mm:s\")  );\n                            // console.log(\"PARSE2\", Date.parseString(Date.parse(\"2021-01-01T\"+vm.available_times[i][\"monday_from_time\"]+\"Z\").toString(), \"HH:mm:s\")  );\n                            // //console.log('LUXON ', luxon.DateTime().fromFormat(vm.available_times[i][\"monday_from_time\"], \"HH:mm:s\") );\n                            // console.log(\"PARSE3: \", Date.parseString(vm.available_times[i][\"monday_to_time\"], \"HH:mm:s\"));\n                            // console.log(\"PARSE4: \", luxon.DateTime.fromISO(\"2021-01-01T\"+vm.available_times[i][\"monday_from_time\"]+\"Z\").setZone(\"Europe/London\").toLocaleString(luxon.DateTime.DATETIME_FULL)   ); //.toFormat('dd MMM yyyy HH:mm:s')\n\n\n                            vm.available_times[i][\"monday_from_time\"] = new Date(luxon.DateTime.fromISO(\"2021-01-01T\"+vm.available_times[i][\"monday_from_time\"]+\"Z\").setZone(\"UTC\").toHTTP()) ; //Date(luxon.DateTime.now(), \"HH:mm:s\");//Date.parseString(Date.parse(\"2021-01-01T\"+vm.available_times[i][\"monday_from_time\"]+\"Z\"), \"HH:mm:s\") ;//luxon.DateTime().fromFormat(vm.available_times[i][\"monday_from_time\"], \"HH:mm:s\") ;//Date.parseString(vm.available_times[i][\"monday_from_time\"], \"HH:mm:s\");\n                            vm.available_times[i][\"monday_to_time\"] = new Date(luxon.DateTime.fromISO(\"2021-01-01T\"+vm.available_times[i][\"monday_to_time\"]+\"Z\").setZone(\"UTC\").toHTTP());// Date.parseString(vm.available_times[i][\"monday_to_time\"], \"HH:mm:s\");\n                            vm.available_times[i][\"monday_disabled\"] = parseInt(vm.available_times[i][\"monday_disabled\"]);\n\n                            vm.available_times[i][\"tuesday_from_time\"] = new Date(luxon.DateTime.fromISO(\"2021-01-01T\"+vm.available_times[i][\"tuesday_from_time\"]+\"Z\").setZone(\"UTC\").toHTTP()) ; //Date.parseString(vm.available_times[i][\"tuesday_from_time\"], \"HH:mm:s\");\n                            vm.available_times[i][\"tuesday_to_time\"] = new Date(luxon.DateTime.fromISO(\"2021-01-01T\"+vm.available_times[i][\"tuesday_to_time\"]+\"Z\").setZone(\"UTC\").toHTTP()) ; //Date.parseString(vm.available_times[i][\"tuesday_to_time\"], \"HH:mm:s\"); \n                            vm.available_times[i][\"tuesday_disabled\"] = parseInt(vm.available_times[i][\"tuesday_disabled\"]);\n\n                            vm.available_times[i][\"wednesday_from_time\"] = new Date(luxon.DateTime.fromISO(\"2021-01-01T\"+vm.available_times[i][\"wednesday_from_time\"]+\"Z\").setZone(\"UTC\").toHTTP()) ;//Date.parseString(vm.available_times[i][\"wednesday_from_time\"], \"HH:mm:s\");\n                            vm.available_times[i][\"wednesday_to_time\"] = new Date(luxon.DateTime.fromISO(\"2021-01-01T\"+vm.available_times[i][\"wednesday_to_time\"]+\"Z\").setZone(\"UTC\").toHTTP()) ;//Date.parseString(vm.available_times[i][\"wednesday_to_time\"], \"HH:mm:s\");\n                            vm.available_times[i][\"wednesday_disabled\"] = parseInt(vm.available_times[i][\"wednesday_disabled\"]);\n\n                            vm.available_times[i][\"thursday_from_time\"] = new Date(luxon.DateTime.fromISO(\"2021-01-01T\"+vm.available_times[i][\"thursday_from_time\"]+\"Z\").setZone(\"UTC\").toHTTP()) ;//Date.parseString(vm.available_times[i][\"thursday_from_time\"], \"HH:mm:s\");\n                            vm.available_times[i][\"thursday_to_time\"] = new Date(luxon.DateTime.fromISO(\"2021-01-01T\"+vm.available_times[i][\"thursday_to_time\"]+\"Z\").setZone(\"UTC\").toHTTP()) ;//Date.parseString(vm.available_times[i][\"thursday_to_time\"], \"HH:mm:s\");\n                            vm.available_times[i][\"thursday_disabled\"] = parseInt(vm.available_times[i][\"thursday_disabled\"]);\n\n                            vm.available_times[i][\"friday_from_time\"] = new Date(luxon.DateTime.fromISO(\"2021-01-01T\"+vm.available_times[i][\"friday_from_time\"]+\"Z\").setZone(\"UTC\").toHTTP()) ; //Date.parseString(vm.available_times[i][\"friday_from_time\"], \"HH:mm:s\");\n                            vm.available_times[i][\"friday_to_time\"] = new Date(luxon.DateTime.fromISO(\"2021-01-01T\"+vm.available_times[i][\"friday_to_time\"]+\"Z\").setZone(\"UTC\").toHTTP()) ; //Date.parseString(vm.available_times[i][\"friday_to_time\"], \"HH:mm:s\");\n                            vm.available_times[i][\"friday_disabled\"] = parseInt(vm.available_times[i][\"friday_disabled\"]);\n\n                            vm.available_times[i][\"saturday_from_time\"] = new Date(luxon.DateTime.fromISO(\"2021-01-01T\"+vm.available_times[i][\"saturday_from_time\"]+\"Z\").setZone(\"UTC\").toHTTP()) ;///Date.parseString(vm.available_times[i][\"saturday_from_time\"], \"HH:mm:s\");\n                            vm.available_times[i][\"saturday_to_time\"] = new Date(luxon.DateTime.fromISO(\"2021-01-01T\"+vm.available_times[i][\"saturday_to_time\"]+\"Z\").setZone(\"UTC\").toHTTP()) ;///Date.parseString(vm.available_times[i][\"saturday_to_time\"], \"HH:mm:s\");\n                            vm.available_times[i][\"saturday_disabled\"] = parseInt(vm.available_times[i][\"saturday_disabled\"]);\n\n                            vm.available_times[i][\"sunday_from_time\"] = new Date(luxon.DateTime.fromISO(\"2021-01-01T\"+vm.available_times[i][\"sunday_from_time\"]+\"Z\").setZone(\"UTC\").toHTTP()) ;//Date.parseString(vm.available_times[i][\"sunday_from_time\"], \"HH:mm:s\");\n                            vm.available_times[i][\"sunday_to_time\"] = new Date(luxon.DateTime.fromISO(\"2021-01-01T\"+vm.available_times[i][\"sunday_to_time\"]+\"Z\").setZone(\"UTC\").toHTTP()) ;//Date.parseString(vm.available_times[i][\"sunday_to_time\"], \"HH:mm:s\");\n                            vm.available_times[i][\"sunday_disabled\"] = parseInt(vm.available_times[i][\"sunday_disabled\"]);\n\n\n\n\n                        }\n\n                        if(vm.available_times.length == 1){\n\n\n\n\n                            if(vm.available_times[0][\"monday_from_time\"] == vm.available_times[0][\"monday_to_time\"]){\n                                // alert(\"now monday ==> \", vm.available_times[i][\"monday_from_time\"]);\n                               vm.available_times[0][\"monday_from_time\"] = from_default;\n                               vm.available_times[0][\"monday_to_time\"] = to_default;\n                            }\n                            if(vm.available_times[0][\"tuesday_from_time\"] == vm.available_times[0][\"tuesday_to_time\"]){\n                               vm.available_times[0][\"tuesday_from_time\"] = from_default;\n                               vm.available_times[0][\"tuesday_to_time\"] = to_default;\n                            }\n                            if(vm.available_times[0][\"wednesday_from_time\"] == vm.available_times[0][\"wednesday_to_time\"]){\n                               vm.available_times[0][\"wednesday_from_time\"] = from_default;\n                               vm.available_times[0][\"wednesday_to_time\"] = to_default;\n                            }\n                            if(vm.available_times[0][\"thursday_from_time\"] == vm.available_times[0][\"thursday_to_time\"]){\n                               vm.available_times[0][\"thursday_from_time\"] = from_default;\n                               vm.available_times[0][\"thursday_to_time\"] = to_default;\n                            }\n                            if(vm.available_times[0][\"friday_from_time\"] == vm.available_times[0][\"friday_to_time\"]){\n                               vm.available_times[0][\"friday_from_time\"] = from_default;\n                               vm.available_times[0][\"friday_to_time\"] = to_default;\n                            }\n                            if(vm.available_times[0][\"saturday_from_time\"] == vm.available_times[0][\"saturday_to_time\"]){\n                               vm.available_times[0][\"saturday_from_time\"] = from_default;\n                               vm.available_times[0][\"saturday_to_time\"] = to_default;\n                            }\n                            if(vm.available_times[0][\"sunday_from_time\"] == vm.available_times[0][\"sunday_to_time\"]){\n                               vm.available_times[0][\"sunday_from_time\"] = from_default;\n                               vm.available_times[0][\"sunday_to_time\"] = to_default;\n                            }\n\n\n                            //instructor of only one club\n                            //alert(\"only 1\");\n\n                            vm.selected_club = vm.available_times[0];\n\n\n                            //console.log(\"selected is : \"+vm.selected_club);\n                            //console.log(vm.selected_club);\n                            //console.log(vm.selected_club.club_id);\n\n                            vm.selected_now = $.grep(vm.available_times, function(e){ \n                                    return e.club_id == vm.selected_club.club_id; \n                            });\n                            //console.log(vm.selected_now);\n                            vm.available_time = vm.selected_now[0];\n\n\n                        }\n\n\n\n\n\n                    });\n\n\n// Some testing variables\n\n        // vm.available_times = [{\n        //     club_id: 6,\n        //     club_name: \"Alex's Club\",\n            \n        //     monday_from_time: from_default,\n        //     monday_to_time: to_default,\n        //     monday_disabled: false,\n\n        //     tuesday_from_time: from_default,\n        //     tuesday_to_time: to_default,\n        //     tuesday_disabled: false,\n\n        //     wednesday_from_time: from_default,\n        //     wednesday_to_time: to_default,\n        //     wednesday_disabled: false,\n\n        //     thursday_from_time: from_default,\n        //     thursday_to_time: to_default,\n        //     thursday_disabled: false,\n\n        //     friday_from_time: from_default,\n        //     friday_to_time: to_default,\n        //     friday_disabled: false,\n\n        //     saturday_from_time: from_default,\n        //     saturday_to_time: to_default,\n        //     saturday_disabled: false,\n\n        //     sunday_from_time: from_default,\n        //     sunday_to_time: to_default,\n        //     sunday_disabled: false\n\n        // },\n        // {\n\n        //     club_id: 8,\n        //     club_name: \"Alouette Club\",\n\n        //     monday_from_time: from_default,\n        //     monday_to_time: to_default,\n        //     monday_disabled: false,\n\n        //     tuesday_from_time: from_default,\n        //     tuesday_to_time: to_default,\n        //     tuesday_disabled: false,\n\n        //     wednesday_from_time: from_default,\n        //     wednesday_to_time: to_default,\n        //     wednesday_disabled: false,\n\n        //     thursday_from_time: from_default,\n        //     thursday_to_time: to_default,\n        //     thursday_disabled: false,\n\n        //     friday_from_time: from_default,\n        //     friday_to_time: to_default,\n        //     friday_disabled: false,\n\n        //     saturday_from_time: from_default,\n        //     saturday_to_time: to_default,\n        //     saturday_disabled: false,\n\n        //     sunday_from_time: from_default,\n        //     sunday_to_time: to_default,\n        //     sunday_disabled: false\n\n        // }];\n\n\n       \n\n        // if(vm.available_times.length > 1){\n        //     vm.available_time = vm.available_times[0]; //this will be the selected state.\n        //     vm.selected_club = vm.available_times[0]; //this will be the selected state.\n        // } else {\n        //     vm.available_time = vm.available_times[0]; //this will be the selected state.\n        //     vm.selected_club = vm.available_times[0]; //this will be the selected state.\n        // }\n\n        $scope.ismeridian = false;\n        $scope.toggleMode = function() {\n            $scope.ismeridian = ! $scope.ismeridian;\n        };\n\n        $scope.update_time = function(name) {\n            var d = new Date();\n            d.setHours( 14 );\n            d.setMinutes( 0 );\n            vm.available_time[name] = d;\n        };\n\n          $scope.changed_time = function(name) {\n            console.log('Time changed to: ' + vm.available_time[name]);\n          };\n\n          $scope.disable_time = function(day){\n            vm.available_time[day] = (vm.available_time[day]) ? false : true;\n          }\n\n          $scope.change_club = function(){\n            //console.log(\"selected is : \"+vm.selected_club);\n            //console.log(vm.selected_club);\n            //console.log(vm.selected_club.club_id);\n\n            vm.selected_now = $.grep(vm.available_times, function(e){ \n                    return e.club_id == vm.selected_club.club_id; \n            });\n            //console.log(vm.selected_now);\n            vm.available_time = vm.selected_now[0];\n\n            // vm.available_time = vm.selected_club;\n          }\n\n          $scope.save_club_times = function(){\n\n            //vm.available_times\n            //console.log(\"selected club is:\", vm.available_time);\n            //console.log(\"selected club is:\", vm.selected_club);\n            //.toUTCString()\n            //actually update it...\n\n  \n\n\n            InstructorService.SetAvailability(vm.available_time)\n                    .then(function(data){\n                        //console.log(\"CHECK IT HAS BEEN DEALT WITH\");\n                        //console.log(data);\n\n\n\n                    });\n\n                    //console.log(\"LENGTH BEFORE: \"+vm.available_times.length);\n            \n                    vm.available_times = $.grep(vm.available_times, function(e){ \n                                return e.club_id != vm.available_time.club_id; \n                        });\n                    //console.log(\"LENGTH AFTER: \"+vm.available_times.length);\n\n                    //console.log(\"PUSING: \");\n                    //console.log(vm.available_time);\n\n                    vm.available_times.push(vm.available_time);\n\n                    $state.go('dashboard.manage_user.instructor_availability');\n\n            \n\n          }\n\n          // $scope.clear = function() {\n          //   $scope.mytime = null;\n          // };\n\n\n/* ----------------------------------------------------------------------- */\n\n\n\n\n/* ------------------------------------------------------------------------ */\n\n\n\n\n\n\n\n\n\n\n        ////console.log(\"club_id : \"+vm.club_id);\n\n        // //console.log(vm.action);\n        // //console.log($stateParams);\n        // //console.log($stateParams.id);\n\n        switch(vm.action){\n            case \"add\":\n                //console.log(\"adding a new member please\");\n                vm.page_title = \"Add a New member\";\n\n                \n\n            break;\n            case \"edit\":\n                //console.log(\"edit an existing membership\");\n\n                MemberService.GetMemberPlanes($stateParams.member_id, vm.club_id)\n                    .then(function(data){\n                        vm.club.planes = data;   \n                        //console.log(vm.club.planes);\n                    });\n\n                 MemberService.GetById($stateParams.member_id, vm.club_id)\n                    .then(function(data){\n                        vm.club.member = data;   \n                        //console.log(vm.club);\n                        vm.club.member.is_manager = (vm.club.member.is_manager == 1) ? true : false;\n                        vm.club.member.approved = (vm.club.member.approved == 1) ? true : false;\n                        vm.club.member.instructor = (vm.club.member.instructor == 1) ? true : false;\n                        vm.club.member.membership_start = Date.parse(vm.club.member.membership_start);\n                        vm.page_title = \"Edit a Member - \"+vm.club.member.first_name+\" \"+vm.club.member.last_name;\n\n                        vm.club.member.membership_start = new Date(vm.club.member.membership_start);\n\n                        // $(\"#membership_start\").datepicker({\n                        //     format: 'dd-mm-yyyy',\n                        //     startDate: vm.club.member.membership_start,\n                        //     endDate: ''\n                        //   }).on(\"show\", function() {\n                        //     $(this).val(new Date()).datepicker('update');\n                        //   });\n\n                    });\n\n                 MembershipService.GetAllByClub(vm.club_id)\n                    .then(function(data){\n                        vm.club.memberships = data;   \n                        // vm.club.member.membership_id.selected = vm.club.member.membership_id;\n                        // vm.membership = vm.club.member.membership_name;\n                        // vm.club.membership = vm.club.member.membership_name;\n                        //console.log(vm.club.memberships);\n                    });\n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                MemberService.GetAllByClub(vm.club_id)\n                    .then(function(data){\n                        vm.club.members = data;   \n                        //console.log(vm.club.members);\n                    });\n\n                 MembershipService.GetAllByClub(vm.club_id)\n                    .then(function(data){\n                        vm.club.memberships = data;   \n                        // vm.club.member.membership_id.selected = vm.club.member.membership_id;\n                        // vm.membership = vm.club.member.membership_name;\n                        // vm.club.membership = vm.club.member.membership_name;\n                        //console.log(vm.club.memberships);\n                    });\n                $scope.checkAll = function () {\n                    //console.log(\"check all\");\n                    if ($scope.selectedAll) {\n                        $scope.selectedAll = true;\n                    } else {\n                        $scope.selectedAll = false;\n                    }\n                    angular.forEach(vm.club.members, function(member) {\n                        member.selected = $scope.selectedAll;\n                    });\n                };\n\n\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n        //'9' needs to refer the the user's account set to manage\n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        $scope.save = function(){\n            if(vm.action == \"add\"){\n                //console.log(\"CREATE click\");\n                $scope.create();\n            } else {\n                //console.log(\"EDIT click\");\n                //console.log(vm.club.membership);\n                $scope.update();\n            }\n        }\n\n\n\n\n        // $scope.readCSV = function() {\n        //     // http get request to read CSV file content\n        //     $http.get('/angular/sample.csv').success($scope.processData);\n        // };\n\n\n        $scope.csvToJSON = function(content) {\n                var lines=content.csv.split(/\\r\\n|\\n/);\n                var result = [];\n                var start = 0;\n                lines[0] += \",membership_id,membership_start,selected\";\n                for (var j=1; j<lines.length; j++) {\n                    lines[j] += \",membership_id,membership_start,true\";\n                }\n                var columnCount = lines[0].split(content.separator).length;\n\n                var headers = [];\n                if (content.header) {\n                    headers=lines[0].split(content.separator);\n                    vm.imported_headers = headers;\n                    start = 1;\n                }\n\n                for (var i=start; i<lines.length; i++) {\n                    var obj = {};\n                        var currentline=lines[i].split(new RegExp(content.separator+'(?![^\"]*\"(?:(?:[^\"]*\"){2})*[^\"]*$)'));\n                        if ( currentline.length === columnCount ) {\n                            if (content.header) {\n                                for (var j=0; j<headers.length; j++) {\n                                    obj[headers[j]] = currentline[j];\n                                }\n                            } else {\n                                for (var k=0; k<currentline.length; k++) {\n                                    obj[k] = currentline[k];\n                                }\n                            }\n                            result.push(obj);\n                        }\n                   \n                }\n\n                //result = $scope.toPrettyJSON(result, 2);\n                //console.log(result);\n\n                return result;\n            };\n\n       \n\n\n        $scope.processData = function() {\n            //get the stuff\n            allText = vm.import_users;\n            var tobesorter = {\n                csv: vm.import_users,\n                separator: \",\",\n                header: true\n            }\n            vm.imported_users = $scope.csvToJSON(tobesorter);\n\n             for(var b=0;b<vm.imported_users.length;b++){\n                if(vm.imported_users[b].membership_start){\n                    vm.imported_users[b].membership_start = new Date(vm.imported_users[b].membership_start);\n                } else {\n                    vm.imported_users[b].membership_start = new Date();\n                }\n                //below set the default membership perhaps?\n                vm.imported_users[b].membership_id = 4;\n                vm.imported_users[b].membership = { membership_id: 4, membership_name: \"Annual Membership\" };\n            }\n\n            // split content based on new line\n            // var allTextLines = allText.split(/\\r\\n|\\n/);\n            // var headers = allTextLines[0].split(',');\n            // var lines = [];\n\n            // for ( var i = 0; i < allTextLines.length; i++) {\n            //     // split content based on comma\n            //     var data = allTextLines[i].split(',');\n            //     if (data.length == headers.length) {\n            //         var tarr = [];\n            //         for ( var j = 0; j < headers.length; j++) {\n            //             tarr.push(data[j]);\n            //         }\n            //         lines.push(tarr);\n            //     }\n            // }\n            // $scope.data = lines;\n        };\n       \n\n        vm.user_columns = {\n            first_name: \"First Name\", \n            last_name: \"Last Name\", \n            email: \"Email Address\",\n            dob: \"Date of Birth\",\n            membership_number: \"Membership Number\", \n            membership_start: \"Membership Start Date\",\n            membership_id: \"Membership Name\"\n        };\n\n\n        $scope.import_column = function(name){\n            // //console.log(\"update the field\");\n            // for(var i = 0; i < vm.imported_users.length; i++){\n            //     var original_val = vm.imported_users[i][name];\n            //     delete vm.imported_users[i][name];\n            //     vm.imported_users[i][vm.change_col_to] = original_val;\n            //     //console.log(vm.imported_users[i]);\n            // }\n\n        }\n\n\n        $scope.import_users = function(){\n            //console.log(\"import some users now\");\n\n\n            //first let's ignore the ones that weren't in the list\n            vm.imported_users = $.grep(vm.imported_users, function(e){ \n                    return e.selected != \"false\"; \n            });\n\n           \n            // //console.log(vm.imported_users);\n            // //console.log(vm.imported_headers);\n            // //console.log(vm.imported_new_headers);\n\n            //we need to verify that at least first name and last name in addition to email is present in the columns selected.\n            if(vm.imported_new_headers.indexOf(\"first_name\") > -1 && vm.imported_new_headers.indexOf(\"last_name\") > -1 && vm.imported_new_headers.indexOf(\"email\") > -1){\n                //console.log(\"ALL HEADERS HERE ! YAY!\");\n                \n                for(var b=0;b<vm.imported_users.length;b++){\n                    if(vm.imported_users[b].membership){\n                        if(vm.imported_users[b].membership.membership_id){\n                            vm.imported_users[b][\"membership_id\"] = vm.imported_users[b].membership.membership_id;\n                            delete vm.imported_users[b].membership;\n                        }\n                    }\n                }\n\n                //console.log(\"===--->===\");\n                //console.log(vm.imported_users);\n                //console.log(\"===--->===\");\n\n                vm.imported_new_headers.push(\"membership_id\");\n                vm.imported_new_headers.push(\"membership_start\");\n\n                //now we generate the users with the correct headings for our tables\n                var to_import_users = [];\n                for(var d=0; d<vm.imported_users.length;d++){\n                    var obj = {\n                        user: {},\n                        club_id: vm.club_id\n                    };\n                    for(var c=0; c<vm.imported_new_headers.length;c++){\n                        if(vm.imported_new_headers[c]){\n                            //console.log(vm.imported_new_headers[c]);\n                            if(vm.imported_new_headers[c] == \"first_name\" || vm.imported_new_headers[c] == \"last_name\" || vm.imported_new_headers[c] == \"dob\" || vm.imported_new_headers[c] == \"email\"){\n                                obj[\"user\"][vm.imported_new_headers[c]] = vm.imported_users[d][Object.keys(vm.imported_users[d])[c]];\n                            } else {\n                                if(vm.imported_new_headers[c] == \"membership_start\" || vm.imported_new_headers[c] == \"membership_id\"){\n                                    obj[vm.imported_new_headers[c]] = vm.imported_users[d][vm.imported_new_headers[c]];\n                                } else {\n                                    obj[vm.imported_new_headers[c]] = vm.imported_users[d][Object.keys(vm.imported_users[d])[c]];\n                                }\n                            }\n                            //we can push this into a new object with new key!\n                        } else {\n                            //we ignore this one...\n                            //console.log(\"blank\");\n                        }\n                    }\n                    to_import_users.push(obj);\n                }\n                //console.log(\"--==--\");\n                //console.log(to_import_users);\n                //console.log(\"--==--\");\n\n                //now that we have what we want to add to our \n                MemberService.CreateMany(to_import_users)\n                .then(function(data){\n                    //console.log(data);\n                    $state.go('dashboard.manage_club.members');\n                });\n\n            } else {\n                //console.log(\"missing key elements in headers!\");\n                ToastService.warning('Missing Fields', 'You must select the First Name, Last Name and Email Address to be able to add the user to the system!');\n            }\n        \n\n\n        }\n\n\n        $scope.create = function(){\n            //console.log(\"CREATE ME NOW\");\n            vm.club.member.club_id = vm.club_id;\n            MemberService.Create(vm.club.member)\n                .then(function(data){\n                    //console.log(data);\n                    $state.go('dashboard.manage_club.members');\n                });\n        }\n\n        $scope.delete = function(){\n            //console.log(\"CLICK\");\n            ToastService.warning('Confirm Delete', 'Are you sure you would like to delete this membership?');\n            MemberService.Update(vm.club.membership)\n                .then(function(data){\n                    //console.log(data);\n                });\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n            vm.club.member.club_id = vm.club_id;\n           \n            MemberService.Update(vm.club.member)\n                        .then(function(data){\n                            //console.log(data);\n                            //console.log(\"saved\");\n                            $state.go('dashboard.manage_club.members');\n                        });\n                        \n            MemberService.SaveMemberPlanes(vm.club.member.id, vm.club.member.club_id, vm.club.planes)\n                .then(function(data){\n                    //console.log(data);\n                    //console.log(\"saved THE PLANES\");\n                     \n                });\n\n                //         function SaveMemberPlanes(user_id, club_id, planes){\n\n        }\n\n        $scope.selected_members = function(type){\n            //get the selected members\n            //console.log(vm.club.members);\n            vm.selected_members = $.grep(vm.club.members, function(e){ \n                return e.selected == true; \n            });\n            //console.log(vm.selected_members);\n\n            //type is the action required...\n            \n\n            for(var j=0;j < vm.selected_members.length; j++){\n\n                if(type == \"approve\"){\n                    vm.selected_members[j].approved = 1;\n                } else {\n                    vm.selected_members[j].approved = 0;\n                }\n                //console.log(\"here\");\n                MemberService.Update(vm.selected_members[j])\n                    .then(function(data){\n                        //console.log(data);\n                        //console.log(\"saved\");\n                    });\n            }\n\n            $state.go('dashboard.manage_club.members');\n\n        }\n\n        $scope.update_membership = function(item, model){\n            vm.club.member.membership_id = item.membership_id;\n            vm.club.member.membership_name = item.membership_name;\n        }\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n        var warning_msg = \"By deleting this membership, you will also cancel all reservations that this membership currently has.\"\n\n        $scope.open = function (member_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return member_id;\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (member_id) {\n              $log.info('PRESSED GO: '+member_id);\n              MemberService.Delete(member_id)\n              .then(function(){\n                //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.members = $.grep(vm.club.members, function(e){ \n                    return e.id != member_id; \n                });\n              })\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n          };\n\n         \n\n\n    }\n app.controller('DashboardUserInstructorHolidayController', DashboardUserInstructorHolidayController);\n\n    DashboardUserInstructorHolidayController.$inject = ['UserService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'ToastService'];\n    function DashboardUserInstructorHolidayController(UserService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, ToastService) {\n        var vm = this;\n\n        var defaultStartTime = 480;\n        var defaultEndTime = 1080;\n\n        $scope.va1 = '123';\n        \n        vm.user = null;\n        vm.allUsers = [];\n        vm.club = {};\n        vm.page_title = \"\";\n        vm.club.member = {};\n        \n        vm.imported_new_headers = [];\n\n        // vm.club.member.membership_id = {};\n        \n        vm.action = $state.current.data.action;\n\n\n\n        //vm.club_id = 6;\n        //vm.user_id = 59;\n\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n\n        vm.no_show_cols = [\"membership_start\", \"membership_id\", \"selected\"];\n\n        var newDate = new Date();\n        \n        var h_start = Math.floor( defaultStartTime / 60);          \n        var i_start = defaultStartTime % 60;\n        var h_end = Math.floor( defaultEndTime / 60);          \n        var i_end = defaultEndTime % 60;\n\n        var defaultStart = new Date(newDate.getFullYear(), newDate.getMonth(), newDate.getDate(), h_start, i_start, 0);\n        var defaultEnd = new Date(newDate.getFullYear(), newDate.getMonth(), newDate.getDate(), h_end, i_end, 0);\n\n\n        $scope.myDatetimeRange = {\n            date: {\n                from: defaultStart,\n                to: defaultEnd\n            },\n            time: {\n                from: defaultStartTime, // default low value\n                to: defaultEndTime, // default high value\n                step: 15, // step width\n                minRange: 15, // min range\n                hours24: true // true for 24hrs based time | false for PM and AM\n            }\n        };\n\n        $scope.myDatetimeLabels = {\n            date: {\n                from: 'Start date',\n                to: 'End date'\n            }\n        };\n\n    $scope.toggle = true;\n    $scope.toggleDirective = function() {\n        $scope.toggle = !$scope.toggle;\n    };\n\n    $scope.whentimechangedata = {};\n    $scope.overridePicker = true;\n\n\n\n\n    function get_times(data, tofrom){\n        var date = $scope.myDatetimeRange.date[tofrom];\n        var d = date.getDate();\n        var m = date.getMonth();\n        var y = date.getFullYear();\n        \n        //need to combuine both\n        var a = data[tofrom];\n        var h = a.slice(0,2);\n        var i = a.slice(3,5);\n        // i = (i == 00)? 0 : i;\n        \n        i = (i.toString() == \"00\")? 0 : i;\n\n        // $scope.myDatetimeRange.date.from = new Date(y, m, d, h, m, 0);\n        // //console.log(\"vars are: \"+y+\", \"+m+\", \"+d+\", \"+h+\", \"+i+\", \"+0+\" soooo\");\n        var date = new Date(y, m, d, h, i, 0);\n        return date;\n    }\n\n    $scope.whenTimeChange = function (data) {\n        // //console.log('schedule changes', data);\n      \n        var from = get_times(data, \"from\");\n        var to = get_times(data, \"to\");\n\n        $scope.myDatetimeRange.date.from = from;\n        $scope.myDatetimeRange.date.to = to;\n        //from and to are datetimes\n\n\n        $scope.whentimechangedata = data;\n    };\n\n    // show only time slider\n    $scope.timeRangePicker = {\n        time: {\n            from: 480, // default low value\n            to: 1020, // default high value\n            step: 15, // step width\n            minRange: 15, // min range\n            hours24: true // true for 24hrs based time | false for PM and AM\n        }\n    };\n\n    // show only date pickers\n    $scope.dateRangePicker = {\n        date: {\n            from: new Date(),\n            to: new Date()\n        }\n    };\n\n\n\n    // directive with max range in date pickers\n    var\n        _today      = new Date(),\n        _yesterday  = new Date( _today.getTime() - (86400000 * 10) );\n\n    $scope.datePickerWithRange = {\n        date: {\n            from: new Date(),\n            to: new Date(),\n            max: _today,\n            min: _yesterday\n        },\n        time: {\n            from: 420, // default low value\n            to: 1020, // default high value\n            step: 15, // step width\n            minRange: 15, // min range\n            hours24: true // true for 24hrs based time | false for PM and AM\n        }\n    };\n\n\n    // $scope.maxRangeDate = 5; //days\n\n/*\n        $scope.sortType     = 'Email'; // set the default sort type\n        $scope.sortReverse  = false;  // set the default sort order\n        $scope.searchTool   = '';     // set the default search/filter term\n\n        $scope.myDatetimeRange = {\n          \"time\": {\n            \"from\": 480,\n            \"to\": 1215,\n            \"dFrom\": 0,\n            \"dTo\": 1440,\n            \"step\": 15,\n            \"minRange\": 15,\n            \"hours24\": false\n          },\n          \"hasDatePickers\": false,\n          \"hasTimeSliders\": true\n        };\n\n\n   \n    $scope.myDatetimeLabels = {\n        date: {\n            from: 'Start date',\n            to: 'End date'\n        }\n    };\n\n\n    $scope.toggle = true;\n    $scope.toggleDirective = function() {\n        $scope.toggle = !$scope.toggle;\n    };\n\n    $scope.whentimechangedata = {};\n\n    $scope.whenTimeChange = function (data) {\n        //console.log('schedule changes', data);\n        $scope.whentimechangedata = data;\n    };\n\n    // show only time slider\n    $scope.timeRangePicker = {\n        time: {\n            from: 480, // default low value\n            to: 1020, // default high value\n            step: 15, // step width\n            minRange: 15, // min range\n            hours24: false // true for 24hrs based time | false for PM and AM\n        }\n    };\n\n    // show only date pickers\n    $scope.dateRangePicker = {\n        date: {\n            from: new Date(),\n            to: new Date()\n        }\n    };\n\n    // directive with max range in date pickers\n    var\n        _today      = new Date(),\n        _yesterday  = new Date( _today.getTime() - (86400000 * 10) );\n\n    $scope.datePickerWithRange = {\n        date: {\n            from: new Date(),\n            to: new Date(),\n            max: _today,\n            min: _yesterday\n        }\n    };\n    $scope.maxRangeDate = 5; //days\n\n\n          $scope.mytime = new Date();\n\n\nAND THE HTML IS:\n                            <div rg-range-picker=\"myDatetimeRange\" labels=\"myDatetimeLabels\"></div>\n\n\n*/\n\n\n\n\n\n\n\n/* ----------------------------------------------------------------------- */\n\n\n    var date = new Date();\n    var d = date.getDate();\n    var m = date.getMonth();\n    var y = date.getFullYear();\n\n    /* event source that pulls from google.com */\n    // $scope.eventSource = {\n    //         url: \"http://www.google.com/calendar/feeds/usa__en%40holiday.calendar.google.com/public/basic\",\n    //         className: 'gcal-event',           // an option!\n    //         currentTimezone: 'America/Chicago' // an option!\n    // };\n\n    /* event source that contains custom events on the scope */\n     $scope.events = [];\n    //   {title: 'All Day Event',start: new Date(y, m, 1)},\n    //   {title: 'Long Event',start: new Date(y, m, d - 5),end: new Date(y, m, d - 2)},\n    //   {id: 999,title: 'Repeating Event',start: new Date(y, m, d - 3, 16, 0),allDay: false},\n    //   {id: 999,title: 'Repeating Event',start: new Date(y, m, d + 4, 16, 0),allDay: false},\n    //   {title: 'Birthday Party',start: new Date(y, m, d + 1, 19, 0),end: new Date(y, m, d + 1, 22, 30),allDay: false},\n    //   {title: 'Click for Google',start: new Date(y, m, 28),end: new Date(y, m, 29),url: 'http://google.com/'}\n    // ];\n\n     HolidayService.GetAll(vm.user.id)\n        .then(function(data){\n             for(var i=0; i<data.length;i++){\n                 $scope.events.push({\n                     id: data[i].id,\n                     title: data[i].title,\n                     start: new Date(data[i].from_date),\n                     end: new Date(data[i].to_date),\n                     allDay: data[i].allDay,\n                     className: ['customFeed']\n                 });\n             }\n\n             //console.log(\"bits of events = \", $scope.events);\n\n        });\n\n\n    /* event source that calls a function on every view switch */\n    // $scope.eventsF = function (start, end, timezone, callback) {\n    //   var s = new Date(start).getTime() / 1000;\n    //   var e = new Date(end).getTime() / 1000;\n    //   var m = new Date(start).getMonth();\n    //   var events = [{title: 'Feed Me ' + m,start: s + (50000),end: s + (100000),allDay: false, className: ['customFeed']}];\n    //   callback(events);\n    // };\n\n    // $scope.calEventsExt = {\n    //    color: '#f00',\n    //    textColor: 'yellow',\n    //    events: [\n    //       {type:'party',title: 'Lunch',start: new Date(y, m, d, 12, 0),end: new Date(y, m, d, 14, 0),allDay: false},\n    //       {type:'party',title: 'Lunch 2',start: new Date(y, m, d, 12, 0),end: new Date(y, m, d, 14, 0),allDay: false},\n    //       {type:'party',title: 'Click for Google',start: new Date(y, m, 28),end: new Date(y, m, 29),url: 'http://google.com/'}\n    //     ]\n    // };\n\n\n\n    /* alert on eventClick */\n    $scope.alertOnEventClick = function( date, jsEvent, view){\n        $scope.alertMessage = (date.title + ' was clicked ');\n\n        //show event details\n\n    };\n\n    /* alert on Drop */\n     $scope.alertOnDrop = function(event, delta, revertFunc, jsEvent, ui, view){\n  \n        // for(var i = 0; i < $scope.events.length; i++){\n        //     if($scope.events[i]._id == event._id){\n        //         $scope.events[i].start = moment(event.start + delta);\n        //         $scope.events[i].end = moment(event.end + delta);\n        //     }\n        // }\n\n\n        // //console.log(event);\n\n        //event was updated --> please save\n        HolidayService.Update(vm.user.id, event)\n        .then(function(data){\n            //console.log(data);\n        });\n\n       $scope.alertMessage = ('Event Updated');\n    };\n\n    /* alert on Resize */\n    $scope.alertOnResize = function(event, delta, revertFunc, jsEvent, ui, view ){\n        \n        //event was updated --> please save\n        HolidayService.Update(vm.user.id, event)\n        .then(function(data){\n            //console.log(data);\n        });\n\n       $scope.alertMessage = ('Event Updated');\n    };\n\n\n\n    /* add and removes an event source of choice */\n    $scope.addRemoveEventSource = function(sources,source) {\n      var canAdd = 0;\n      angular.forEach(sources,function(value, key){\n        if(sources[key] === source){\n          sources.splice(key,1);\n          canAdd = 1;\n        }\n      });\n      if(canAdd === 0){\n        sources.push(source);\n      }\n    };\n\n\n   \n\n    $scope.whole_day_booking = false;\n    $scope.wholeDay = function(){\n\n       if($scope.whole_day_booking == true){\n            $scope.whole_day_booking = false;\n            $scope.myDatetimeRange.time.from = defaultStartTime;\n            $scope.myDatetimeRange.time.to = defaultEndTime;\n       } else {\n            $scope.whole_day_booking = true;\n            $scope.myDatetimeRange.time.from = 0;\n            $scope.myDatetimeRange.time.to = 1440;\n       }\n       \n\n    }\n\n\n\n    /* add custom event*/\n    $scope.addEvent = function() {\n\n      var myFrom = $scope.myDatetimeRange.date.from; \n      var myTo = $scope.myDatetimeRange.date.to; \n\n      // $scope.date_from = new Date(myFrom.getFullYear(), myFrom.getMonth(), myFrom.getDate(), 0, 0, 0);\n      // $scope.date_to = new Date(myTo.getFullYear(), myTo.getMonth(), myTo.getDate(), 23, 59, 59);\n\n      var new_event = {\n        title: 'Holiday',\n        start: myFrom,\n        end: myTo,\n        className: ['openSesame'],\n        allDay: $scope.whole_day_booking\n      };\n\n      $scope.events.push(new_event);\n\n      //editable: true / false can be added :)\n      //create the event in the DB\n\n      HolidayService.Create(vm.user.id, new_event)\n        .then(function(data){\n            //console.log(data);\n\n            $state.go('dashboard.manage_user.instructor_holidays');\n\n            \n        });\n\n    };\n\n    /* remove event */\n    $scope.remove = function(index) {\n\n        var delete_id = $scope.events[index].id;\n        // //console.log(\"DELETE: \"+delete_id);\n        // //console.log($scope.events[index]);\n\n      HolidayService.Delete(vm.user.id, delete_id)\n        .then(function(data){\n            \n            $scope.events.splice(index,1);\n\n        });\n\n\n    };\n\n    /* Change View */\n    $scope.changeView = function(view,calendar) {\n      uiCalendarConfig.calendars[calendar].fullCalendar('changeView',view);\n    };\n\n    /* Change View */\n    $scope.renderCalender = function(calendar) {\n      $timeout(function() {\n        if(uiCalendarConfig.calendars[calendar]){\n          uiCalendarConfig.calendars[calendar].fullCalendar('render');\n        }\n      });\n    };\n\n    \n\n    /* Render Tooltip */\n    $scope.eventRender = function( event, element, view ) {\n        element.attr({'tooltip': event.title,\n                      'tooltip-append-to-body': true});\n        $compile(element)($scope);\n    };\n\n    /* config object */\n    $scope.uiConfig = {\n      schedulerLicenseKey: 'CC-Attribution-NonCommercial-NoDerivatives',\n      calendar:{\n        height: 650,\n        editable: true,\n        header:{\n          left: 'title',\n          center: '',\n          right: 'today prev,next'\n        },\n        firstDay: 1,\n        slotEventOverlap: false,\n        eventClick: $scope.alertOnEventClick,\n        eventDrop: $scope.alertOnDrop,\n        eventResize: $scope.alertOnResize,\n        eventRender: $scope.eventRender\n      }\n    };\n\n    $scope.changeLang = function() {\n    \n        $scope.uiConfig.calendar.dayNames = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\n        $scope.uiConfig.calendar.dayNamesShort = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n      \n    };\n\n    /* event sources array*/\n    $scope.eventSources = [$scope.events];\n    // $scope.eventSources2 = [$scope.calEventsExt, $scope.eventsF, $scope.events];\n\n\n\n/* ------------------------------------------------------------------------ */\n\n\n\n\n\n\n\n\n\n\n        ////console.log(\"club_id : \"+vm.club_id);\n\n        // //console.log(vm.action);\n        // //console.log($stateParams);\n        // //console.log($stateParams.id);\n\n        switch(vm.action){\n            case \"add\":\n                //console.log(\"adding a new member please\");\n                vm.page_title = \"Add a New member\";\n\n                \n\n            break;\n            case \"edit\":\n                //console.log(\"edit an existing membership\");\n\n                // MemberService.GetMemberPlanes($stateParams.member_id, vm.club_id)\n                //     .then(function(data){\n                //         vm.club.planes = data;   \n                //         //console.log(vm.club.planes);\n                //     });\n\n                //  MemberService.GetById($stateParams.member_id, vm.club_id)\n                //     .then(function(data){\n                //         vm.club.member = data;   \n                //         //console.log(vm.club);\n                //         vm.club.member.is_manager = (vm.club.member.is_manager == 1) ? true : false;\n                //         vm.club.member.approved = (vm.club.member.approved == 1) ? true : false;\n                //         vm.club.member.instructor = (vm.club.member.instructor == 1) ? true : false;\n                //         vm.club.member.membership_start = Date.parse(vm.club.member.membership_start);\n                //         vm.page_title = \"Edit a Member - \"+vm.club.member.first_name+\" \"+vm.club.member.last_name;\n\n                //         vm.club.member.membership_start = new Date(vm.club.member.membership_start);\n\n                //         // $(\"#membership_start\").datepicker({\n                //         //     format: 'dd-mm-yyyy',\n                //         //     startDate: vm.club.member.membership_start,\n                //         //     endDate: ''\n                //         //   }).on(\"show\", function() {\n                //         //     $(this).val(new Date()).datepicker('update');\n                //         //   });\n\n                //     });\n\n                //  MembershipService.GetAllByClub(vm.club_id)\n                //     .then(function(data){\n                //         vm.club.memberships = data;   \n                //         // vm.club.member.membership_id.selected = vm.club.member.membership_id;\n                //         // vm.membership = vm.club.member.membership_name;\n                //         // vm.club.membership = vm.club.member.membership_name;\n                //         //console.log(vm.club.memberships);\n                //     });\n            break;\n            case \"list\":\n                //need to update this to be part of the authentication\n                //to find out club id\n                // MemberService.GetAllByClub('6')\n                //     .then(function(data){\n                //         vm.club.members = data;   \n                //         //console.log(vm.club.members);\n                //     });\n\n                //  MembershipService.GetAllByClub(vm.club_id)\n                //     .then(function(data){\n                //         vm.club.memberships = data;   \n                //         // vm.club.member.membership_id.selected = vm.club.member.membership_id;\n                //         // vm.membership = vm.club.member.membership_name;\n                //         // vm.club.membership = vm.club.member.membership_name;\n                //         //console.log(vm.club.memberships);\n                //     });\n                // $scope.checkAll = function () {\n                //     //console.log(\"check all\");\n                //     if ($scope.selectedAll) {\n                //         $scope.selectedAll = true;\n                //     } else {\n                //         $scope.selectedAll = false;\n                //     }\n                //     angular.forEach(vm.club.members, function(member) {\n                //         member.selected = $scope.selectedAll;\n                //     });\n                // };\n\n\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n        //'9' needs to refer the the user's account set to manage\n       \n        $scope.back = function(){\n            $window.history.back();\n        }\n\n        $scope.save = function(){\n            if(vm.action == \"add\"){\n                //console.log(\"CREATE click\");\n                $scope.create();\n            } else {\n                //console.log(\"EDIT click\");\n                //console.log(vm.club.membership);\n                $scope.update();\n            }\n        }\n\n\n\n\n        // $scope.readCSV = function() {\n        //     // http get request to read CSV file content\n        //     $http.get('/angular/sample.csv').success($scope.processData);\n        // };\n\n\n        $scope.csvToJSON = function(content) {\n                var lines=content.csv.split(/\\r\\n|\\n/);\n                var result = [];\n                var start = 0;\n                lines[0] += \",membership_id,membership_start,selected\";\n                for (var j=1; j<lines.length; j++) {\n                    lines[j] += \",membership_id,membership_start,true\";\n                }\n                var columnCount = lines[0].split(content.separator).length;\n\n                var headers = [];\n                if (content.header) {\n                    headers=lines[0].split(content.separator);\n                    vm.imported_headers = headers;\n                    start = 1;\n                }\n\n                for (var i=start; i<lines.length; i++) {\n                    var obj = {};\n                        var currentline=lines[i].split(new RegExp(content.separator+'(?![^\"]*\"(?:(?:[^\"]*\"){2})*[^\"]*$)'));\n                        if ( currentline.length === columnCount ) {\n                            if (content.header) {\n                                for (var j=0; j<headers.length; j++) {\n                                    obj[headers[j]] = currentline[j];\n                                }\n                            } else {\n                                for (var k=0; k<currentline.length; k++) {\n                                    obj[k] = currentline[k];\n                                }\n                            }\n                            result.push(obj);\n                        }\n                   \n                }\n\n                //result = $scope.toPrettyJSON(result, 2);\n                //console.log(result);\n\n                return result;\n            };\n\n       \n\n\n        $scope.processData = function() {\n            //get the stuff\n            allText = vm.import_users;\n            var tobesorter = {\n                csv: vm.import_users,\n                separator: \",\",\n                header: true\n            }\n            vm.imported_users = $scope.csvToJSON(tobesorter);\n\n             for(var b=0;b<vm.imported_users.length;b++){\n                if(vm.imported_users[b].membership_start){\n                    vm.imported_users[b].membership_start = new Date(vm.imported_users[b].membership_start);\n                } else {\n                    vm.imported_users[b].membership_start = new Date();\n                }\n                //below set the default membership perhaps?\n                vm.imported_users[b].membership_id = 4;\n                vm.imported_users[b].membership = { membership_id: 4, membership_name: \"Annual Membership\" };\n            }\n\n            // split content based on new line\n            // var allTextLines = allText.split(/\\r\\n|\\n/);\n            // var headers = allTextLines[0].split(',');\n            // var lines = [];\n\n            // for ( var i = 0; i < allTextLines.length; i++) {\n            //     // split content based on comma\n            //     var data = allTextLines[i].split(',');\n            //     if (data.length == headers.length) {\n            //         var tarr = [];\n            //         for ( var j = 0; j < headers.length; j++) {\n            //             tarr.push(data[j]);\n            //         }\n            //         lines.push(tarr);\n            //     }\n            // }\n            // $scope.data = lines;\n        };\n       \n\n        vm.user_columns = {\n            first_name: \"First Name\", \n            last_name: \"Last Name\", \n            email: \"Email Address\",\n            dob: \"Date of Birth\",\n            membership_number: \"Membership Number\", \n            membership_start: \"Membership Start Date\",\n            membership_id: \"Membership Name\"\n        };\n\n\n        $scope.import_column = function(name){\n            // //console.log(\"update the field\");\n            // for(var i = 0; i < vm.imported_users.length; i++){\n            //     var original_val = vm.imported_users[i][name];\n            //     delete vm.imported_users[i][name];\n            //     vm.imported_users[i][vm.change_col_to] = original_val;\n            //     //console.log(vm.imported_users[i]);\n            // }\n\n        }\n\n\n        $scope.import_users = function(){\n            //console.log(\"import some users now\");\n\n\n            //first let's ignore the ones that weren't in the list\n            vm.imported_users = $.grep(vm.imported_users, function(e){ \n                    return e.selected != \"false\"; \n            });\n\n           \n            // //console.log(vm.imported_users);\n            // //console.log(vm.imported_headers);\n            // //console.log(vm.imported_new_headers);\n\n            //we need to verify that at least first name and last name in addition to email is present in the columns selected.\n            if(vm.imported_new_headers.indexOf(\"first_name\") > -1 && vm.imported_new_headers.indexOf(\"last_name\") > -1 && vm.imported_new_headers.indexOf(\"email\") > -1){\n                //console.log(\"ALL HEADERS HERE ! YAY!\");\n                \n                for(var b=0;b<vm.imported_users.length;b++){\n                    if(vm.imported_users[b].membership){\n                        if(vm.imported_users[b].membership.membership_id){\n                            vm.imported_users[b][\"membership_id\"] = vm.imported_users[b].membership.membership_id;\n                            delete vm.imported_users[b].membership;\n                        }\n                    }\n                }\n\n                //console.log(\"===--->===\");\n                //console.log(vm.imported_users);\n                //console.log(\"===--->===\");\n\n                vm.imported_new_headers.push(\"membership_id\");\n                vm.imported_new_headers.push(\"membership_start\");\n\n                //now we generate the users with the correct headings for our tables\n                var to_import_users = [];\n                for(var d=0; d<vm.imported_users.length;d++){\n                    var obj = {\n                        user: {},\n                        club_id: 6\n                    };\n                    for(var c=0; c<vm.imported_new_headers.length;c++){\n                        if(vm.imported_new_headers[c]){\n                            //console.log(vm.imported_new_headers[c]);\n                            if(vm.imported_new_headers[c] == \"first_name\" || vm.imported_new_headers[c] == \"last_name\" || vm.imported_new_headers[c] == \"dob\" || vm.imported_new_headers[c] == \"email\"){\n                                obj[\"user\"][vm.imported_new_headers[c]] = vm.imported_users[d][Object.keys(vm.imported_users[d])[c]];\n                            } else {\n                                if(vm.imported_new_headers[c] == \"membership_start\" || vm.imported_new_headers[c] == \"membership_id\"){\n                                    obj[vm.imported_new_headers[c]] = vm.imported_users[d][vm.imported_new_headers[c]];\n                                } else {\n                                    obj[vm.imported_new_headers[c]] = vm.imported_users[d][Object.keys(vm.imported_users[d])[c]];\n                                }\n                            }\n                            //we can push this into a new object with new key!\n                        } else {\n                            //we ignore this one...\n                            //console.log(\"blank\");\n                        }\n                    }\n                    to_import_users.push(obj);\n                }\n                //console.log(\"--==--\");\n                //console.log(to_import_users);\n                //console.log(\"--==--\");\n\n                //now that we have what we want to add to our \n                MemberService.CreateMany(to_import_users)\n                .then(function(data){\n                    //console.log(data);\n                    $state.go('dashboard.manage_club.members');\n                });\n\n            } else {\n                //console.log(\"missing key elements in headers!\");\n                ToastService.warning('Missing Fields', 'You must select the First Name, Last Name and Email Address to be able to add the user to the system!');\n            }\n        \n\n\n        }\n\n\n        $scope.create = function(){\n            //console.log(\"CREATE ME NOW\");\n            vm.club.member.club_id = 6;\n            MemberService.Create(vm.club.member)\n                .then(function(data){\n                    //console.log(data);\n                    $state.go('dashboard.manage_club.members');\n                });\n        }\n\n        $scope.delete = function(){\n            //console.log(\"CLICK\");\n            ToastService.warning('Confirm Delete', 'Are you sure you would like to delete this membership?');\n            MemberService.Update(vm.club.membership)\n                .then(function(data){\n                    //console.log(data);\n                });\n        }\n\n        $scope.update = function(){\n            //console.log(\"CLICK\");\n            vm.club.member.club_id = 6;\n           \n            MemberService.Update(vm.club.member)\n                        .then(function(data){\n                            //console.log(data);\n                            //console.log(\"saved\");\n                            $state.go('dashboard.manage_club.members');\n                        });\n                        \n            MemberService.SaveMemberPlanes(vm.club.member.id, vm.club.member.club_id, vm.club.planes)\n                .then(function(data){\n                    //console.log(data);\n                    //console.log(\"saved THE PLANES\");\n                     \n                });\n\n                //         function SaveMemberPlanes(user_id, club_id, planes){\n\n        }\n\n        $scope.selected_members = function(type){\n            //get the selected members\n            //console.log(vm.club.members);\n            vm.selected_members = $.grep(vm.club.members, function(e){ \n                return e.selected == true; \n            });\n            //console.log(vm.selected_members);\n\n            //type is the action required...\n            \n\n            for(var j=0;j < vm.selected_members.length; j++){\n\n                if(type == \"approve\"){\n                    vm.selected_members[j].approved = 1;\n                } else {\n                    vm.selected_members[j].approved = 0;\n                }\n                //console.log(\"here\");\n                MemberService.Update(vm.selected_members[j])\n                    .then(function(data){\n                        //console.log(data);\n                        //console.log(\"saved\");\n                    });\n            }\n\n            $state.go('dashboard.manage_club.members');\n\n        }\n\n        $scope.update_membership = function(item, model){\n            vm.club.member.membership_id = item.membership_id;\n            vm.club.member.membership_name = item.membership_name;\n        }\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n        var warning_msg = \"By deleting this membership, you will also cancel all reservations that this membership currently has.\"\n\n        $scope.open = function (member_id) {\n            var modalInstance = $uibModal.open({\n              animation: true,\n              templateUrl: 'views/modals/deleteModal.html',\n              controller: 'ModalInstanceCtrl',\n              size: \"lg\",\n              resolve: {\n                id: function () {\n                  return member_id;\n                },\n                warning: function(){\n                    return warning_msg;\n                }\n              }\n            });\n            modalInstance.result.then(function (member_id) {\n              $log.info('PRESSED GO: '+member_id);\n              MemberService.Delete(member_id)\n              .then(function(){\n                //console.log(\"HELLO DELETE\");\n                //update view?\n                 vm.club.members = $.grep(vm.club.members, function(e){ \n                    return e.id != member_id; \n                });\n              })\n            }, function () {\n              $log.info('Modal dismissed at: ' + new Date());\n            });\n          };\n\n         \n\n\n    }\n app.controller('FinishAndPayController', FinishAndPayController);\n\n    FinishAndPayController.$inject = ['$sce', 'UserService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$interval', '$timeout', 'uiCalendarConfig', 'BookingService', 'LicenceService', 'BookoutService', '$filter', 'PlaneService', 'InstructorCharges', 'PaymentService', 'InvoicesService', 'EnvConfig', 'ToastService'];\n    function FinishAndPayController($sce, UserService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $interval, $timeout, uiCalendarConfig, BookingService, LicenceService, BookoutService, $filter, PlaneService, InstructorCharges, PaymentService, InvoicesService, EnvConfig, ToastService) {\n        \n        var vm = this;\n\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n        vm.show_loading = false;\n\n\n        //this club ID needs to reflect the club that has been selected....\n        vm.club_id = 6;\n        vm.booking = {};\n\n        //base location to sort the airfields below\n        vm.wgs_n = \"51.51\";\n        vm.wgs_e = \"0.12\";\n\n        vm.change_booking = {};\n        vm.show_change_plane = false;\n        //we need to get the booking ID to pull as much data as we can!\n\n        vm.bookout = {\n            start: true,\n            passengers: [],\n            pic: {\n                id: vm.user_id\n            },\n            plane: {}\n        };\n      \n        vm.dateFormat = 'date:HH:mm \\'on\\' dd/MM/yyyy';\n        var setting_new_member;\n\n\n        vm.reported_defects = [];\n\n        vm.complete_flight = true;\n\n        vm.previous_invoice;\n\n        vm.defect_severity;\n        vm.defect_severities = [\n            { title: \"No Fly Item - Ground the plane\"},\n            { title: \"Flyable - needs to be checked at next maintenance\"},\n            { title: \"Not urgent - but needs noting\"},\n            { title: \"Unsure of severity\"}\n        ];  \n\n\n\n        // vm.dmethods = [\n        //     { id: 'direct-debit', title: 'Direct Debit', subtitle: 'Use your BACS mandate', type: 'direct-debit', iconSvg: $sce.trustAsHtml(iconBank), visible: true },\n        //     { id: 'saved-card',   title: 'Saved card',   subtitle: 'Use a card on file',    type: 'saved-card',  iconSvg: $sce.trustAsHtml(iconCard), visible: true },\n        //     { id: 'new-card',     title: 'New card',     subtitle: 'Add a new debit/credit card', type: 'new-card', iconSvg: $sce.trustAsHtml(iconNew), visible: true },\n        //     { id: 'card-machine', title: 'Card Machine', subtitle: 'Pay in person',          type: 'card-machine', iconSvg: $sce.trustAsHtml(iconTerm), visible: true }\n        //   ];\n        // vm.dsavedCards = [\n        //   // { id:'card_1', brand:'Visa', last4:'4242', exp:'06/27', isDefault:true, nick:'Personal' },\n        //   // { id:'card_2', brand:'Mastercard', last4:'1881', exp:'11/26', isDefault:false, nick:'Business' }\n        // ];\n        //direct-debit, saved-card, new-card, card-machine\n        \n\n\n\n        //SAMPLE ACCORDION MENU TO SELECT THE PAYMENT METHOD\n        // // Right-side icons (same colour/style)\n        // var iconBank = '<svg viewBox=\"0 0 24 24\"><path d=\"M3 10h18M4 10V8l8-5 8 5v2M5 10v8M9 10v8M15 10v8M19 10v8M3 18h18M2 20h20\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        //   var iconCard = '<svg viewBox=\"0 0 24 24\"><rect x=\"2\" y=\"4\" width=\"20\" height=\"16\" rx=\"2\" ry=\"2\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><path d=\"M2 9h20M6 14h6\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        //   var iconNew  = '<svg viewBox=\"0 0 24 24\"><circle cx=\"12\" cy=\"12\" r=\"9\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><path d=\"M12 8v8M8 12h8\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        //   var iconTerm = '<svg viewBox=\"0 0 24 24\"><rect x=\"6\" y=\"2\" width=\"12\" height=\"14\" rx=\"2\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><rect x=\"8\" y=\"5\" width=\"8\" height=\"3\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><rect x=\"9\" y=\"10\" width=\"6\" height=\"3\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        var iconBank = '<svg viewBox=\"0 0 24 24\"><path d=\"M3 10h18M4 10V8l8-5 8 5v2M5 10v8M9 10v8M15 10v8M19 10v8M3 18h18M2 20h20\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        var iconCard = '<svg viewBox=\"0 0 24 24\"><rect x=\"2\" y=\"4\" width=\"20\" height=\"16\" rx=\"2\" ry=\"2\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><path d=\"M2 9h20M6 14h6\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        var iconNew  = '<svg viewBox=\"0 0 24 24\"><circle cx=\"12\" cy=\"12\" r=\"9\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><path d=\"M12 8v8M8 12h8\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        var iconTerm = '<svg viewBox=\"0 0 24 24\"><rect x=\"6\" y=\"2\" width=\"12\" height=\"14\" rx=\"2\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><rect x=\"8\" y=\"5\" width=\"8\" height=\"3\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/><rect x=\"9\" y=\"10\" width=\"6\" height=\"3\" fill=\"none\" stroke=\"#4f46e5\" stroke-width=\"1.6\"/></svg>';\n        \n          vm.donConfirm = function(methodLabel, paymentIntent){\n            console.log(\"confirmation is called\", methodLabel);\n            console.log(\"paymentIntent\", paymentIntent);\n          //alert('Parent received D confirmation: ' + methodLabel);\n            vm.book_in_flight(methodLabel, paymentIntent);\n          };\n\n          vm.default_payment = 'direct-debit';\n\n          vm.methods = [\n            { id: 'direct-debit', title: 'Direct Debit', subtitle: 'Use your BACS mandate', type: 'direct-debit', iconSvg: $sce.trustAsHtml(iconBank), visible: true },\n            { id: 'saved-card',   title: 'Saved card',   subtitle: 'Use a card on file',    type: 'saved-card',  iconSvg: $sce.trustAsHtml(iconCard), visible: true },\n            { id: 'new-card',     title: 'New card',     subtitle: 'Add a new debit/credit card', type: 'new-card', iconSvg: $sce.trustAsHtml(iconNew), visible: true },\n            { id: 'card-machine', title: 'Card Machine', subtitle: 'Pay in person',          type: 'card-machine', iconSvg: $sce.trustAsHtml(iconTerm), visible: true }\n          ];\n\n           vm.savedCards = [];\n\n\n          // vm.expandedId = 'direct-debit';\n          // vm.selectedId = 'direct-debit';\n         \n\n          // vm.dd   = { name: '', email: '', sortCode: '', account: '' };\n          // vm.card = { name: '', number: '', exp: '', cvc: '' };\n\n          // vm.toggle = function(id){ vm.expandedId = (vm.expandedId === id) ? null : id; vm.selectedId = id; };\n          // vm.isExpanded = function(id){ return vm.expandedId === id; };\n          // vm.keyHeader = function(e,id){ var k=e.which||e.keyCode; if(k===13||k===32){ e.preventDefault(); vm.toggle(id);} };\n          // vm.ddReady   = function(){ return !!(vm.dd.name && vm.dd.email && vm.dd.sortCode && vm.dd.account); };\n          // vm.cardReady = function(){ return !!(vm.card.name && vm.card.number && vm.card.exp && vm.card.cvc); };\n          // vm.confirm   = function(label){ alert('Selected: ' + label); };\n          // vm.selectedTitle = function(){\n          //   for (var i=0;i<vm.methods.length;i++){ if(vm.methods[i].id===vm.selectedId){ return vm.methods[i].title; } }\n          //   return null;\n          // };\n\n          // vm.switchTo = function(type){\n          //     // find by type (no Array.find for ES5)\n          //     for (var i = 0; i < vm.methods.length; i++) {\n          //       if (vm.methods[i].type === type) {\n          //         vm.selectedId = vm.methods[i].id;\n          //         vm.expandedId = vm.methods[i].id;\n          //         return;\n          //       }\n          //     }\n          //   };\n\n          // vm.selectedSavedCardId = (vm.savedCards[0] && vm.savedCards[0].id) || null;\n\n          //   vm.selectSavedCard = function(id){\n          //     vm.selectedSavedCardId = id;\n          //   };\n\n          //   vm.keySelectTile = function(e, id){\n          //     var k = e.which || e.keyCode;\n          //     // Enter(13) or Space(32) selects\n          //     if (k === 13 || k === 32) { e.preventDefault(); vm.selectSavedCard(id); }\n          //     // Optional: ArrowLeft/ArrowRight to move focus\n          //   };\n\n          //   vm.cardBrandIcon = function(brand){\n          //     // Simple inline SVGs; extend as needed\n          //     var visa = '<svg viewBox=\"0 0 36 24\"><rect width=\"36\" height=\"24\" rx=\"4\" fill=\"#0a4595\"/><text x=\"18\" y=\"16\" text-anchor=\"middle\" font-size=\"10\" fill=\"#fff\" font-family=\"Arial, Helvetica, sans-serif\">VISA</text></svg>';\n          //     var mc = '<svg viewBox=\"0 0 36 24\"><rect width=\"36\" height=\"24\" rx=\"4\" fill=\"#1f2937\"/><circle cx=\"15\" cy=\"12\" r=\"6.5\" fill=\"#eb001b\"/><circle cx=\"21\" cy=\"12\" r=\"6.5\" fill=\"#f79e1b\" opacity=\".9\"/></svg>';\n          //     var amex = '<svg viewBox=\"0 0 36 24\"><rect width=\"36\" height=\"24\" rx=\"4\" fill=\"#2e77bb\"/><text x=\"18\" y=\"16\" text-anchor=\"middle\" font-size=\"9\" fill=\"#fff\" font-family=\"Arial, Helvetica, sans-serif\">AMEX</text></svg>';\n\n          //     var b = (brand || '').toLowerCase();\n          //     var svg = /visa/.test(b) ? visa\n          //             : /(master|mc)/.test(b) ? mc\n          //             : /(amex|american)/.test(b) ? amex\n          //             : '<svg viewBox=\"0 0 36 24\"><rect width=\"36\" height=\"24\" rx=\"4\" fill=\"#eef2ff\"/><text x=\"18\" y=\"15\" text-anchor=\"middle\" font-size=\"8\" fill=\"#4f46e5\" font-family=\"Arial, Helvetica, sans-serif\">CARD</text></svg>';\n\n          //     return $sce.trustAsHtml(svg);\n          //   };\n\n            // vm.pay_with_saved_card = function(){\n            //     vm.show_loading = true;\n            //     console.log(\"cardid = \", vm.selectedSavedCardId);\n                \n            //     // .. // .. /// .. /// .. // ... //\n            //     //we need to create a payment intent for the booking rather than a singular invoice\n            //     // PaymentService.CreatePaymentIntentBooking\n            //     var obj = {\n            //         booking_id: vm.bookout.booking_id,\n            //         user_id: vm.user.id,\n            //         card_id: vm.selectedSavedCardId\n            //     }\n\n            //     PaymentService.CreatePaymentIntentBooking(obj)\n            //                 .then(function (data) {\n            //                     //console.log(data);\n            //                     if(data.success){\n                                    \n\n\n\n\n\n\n\n\n            //                         ////console.log(\"CARDS\", vm.cards);\n            //                     } else {\n            //                        console.log(\"WOOOPSIES...\", data);\n            //                         //this should be very very rare...\n            //                     }\n            //     });\n\n\n            // }\n                \n\n\n\n\n\n        vm.complete_flight = false;\n        vm.complete_this_flight = function(){\n\n            if(vm.tacho_error_highlight){\n                ToastService.error('Meter Error', 'You cannot complete a flight where the last meter reading is greater than the start meter reading!');\n                return false;\n            }\n\n            var getShort = {club_id: vm.bookout.club_id,\n                user_id: vm.bookout.user_id};\n\n                // //console.log(\"PASSING\", getShort);\n            //let's fetch some information about the user\n            MemberService.GetMandate(vm.bookout.user_id, vm.bookout.club_id)\n                    .then(function (data) {\n                            ////console.log(\"data is : \", data);\n                           \n                            if(data.success){\n                                vm.info = data.info;\n\n\n                                vm.savedCards = data.cards;\n\n                                if(vm.savedCards.length > 0){\n                                    vm.methods[1].visible = true;\n                                } else {\n                                    vm.methods[1].visible = false;\n                                }\n\n                                vm.machine = data.machine;\n                                if(vm.machine.success){\n                                    vm.methods[3].visible = true;\n                                } else {\n                                    vm.methods[3].visible = false;\n                                }\n                            }\n\n                        });\n\n\n\n\n            vm.complete_flight = true;\n        }\n\n\n        $scope.get_airfields = function(name){\n\n            if(name.length > 2 && name.length < 5){\n\n                 BookoutService.GetAirfieldsByCode(name)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //use GB airfields first...\n                        vm.airfields = data.airfields;\n                       \n                         if(vm.airfields.length == 0){\n                            //console.log(\"SETTINGS HERE\");\n                               vm.airfields = [\n                                    {\n                                        id:0,\n                                        title: \"NOT LISTED : \"+ name,\n                                        code: \"ZZZZ\",\n                                        wgs_n: \"0\",\n                                        wgs_e: \"0\"\n                                    }];\n                        }\n\n                    } else {\n\n\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n            }\n\n            if(name.length > 4){\n                var code = name.replace(/\\s/g, \"_\");\n                BookoutService.GetAirfields(code)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //use GB airfields first...\n                        vm.airfields = data.airfields;\n\n\n                        if(vm.airfields.length == 0){\n                            //console.log(\"SETTINGS HERE\");\n                               vm.airfields = [\n                                    {\n                                        id:0,\n                                        title: \"NOT LISTED : \"+ name,\n                                        code: \"ZZZZ\",\n                                        wgs_n: \"0\",\n                                        wgs_e: \"0\"\n                                    }];\n                        }\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n            }\n        }\n\n\n        $scope.update_pic = function(){\n            //console.log(\"--> \", vm.user.id);\n            //console.log(\"--> \", vm.bookout.instructor_id);\n            //console.log(\"--> \", vm.bookout.pic.user_id);\n\n            if(vm.bookout.pic.user_id == vm.user.id && vm.bookout.instructor_id > 0){\n                //console.log(\"okay... so you want the instructor to be put? interesting...\");\n                //adheres to booking\n\n            } else if(vm.bookout.instructor_id > 0 && vm.bookout.pic.user_id == vm.bookout.instructor_id) {\n                //console.log(\"okay so you now have your booked instructor as the PIC again - nice\");\n                //adheres to booking\n\n            } else {\n                //console.log(\"you've change instructor? what happened?\");\n                //availability has been checked hence we're OK\n\n            }\n        }\n\n\n        // vm.cards = [];\n        // PaymentService.GetByUserId(vm.user.id)\n        //                     .then(function (data) {\n        //                         //console.log(data);\n        //                         if(data.success){\n        //                             vm.cards = data.cards;\n        //                             ////console.log(\"CARDS\", vm.cards);\n        //                         } else {\n        //                            // //console.log(\"WOOOPSIES...\");\n        //                             //this should be very very rare...\n        //                         }\n        //                     });\n\n\n        // the ARRIVAL option should be automatically filled in when there was a departure prior to the flight and home airfield was\n        //entered as the destination\n\n       \n\n        switch($state.current.data.action){\n            case \"add\":\n\n                //console.log(\"bookout\", $stateParams.id);\n                //so now we can load the BOOKING with this ID, and therefore can sort it all out :)\n                // let us preload the content required from the booking - fetch the booking\n                //console.log(\"FETCH THE BOOKING\");\n\n                BookingService.GetForBookout(vm.user.id, $stateParams.id)\n                 .then(function (data) {\n                    ////console.log(\"data is : \", data);\n                    if(data.success){\n                        //console.log(\"success\");\n                        \n\n                        if(data.booking.complete == 1){\n                            ToastService.warning('Already Complete', 'It appears that you have already completed this booking...');\n                            $state.go('dashboard.my_account', {}, { reload: true });\n                        }\n\n                        vm.bookout = data.booking;\n\n                        //temporary bits to overcome the start and end times issues...\n                        vm.bookout.start_date = new Date(\"2100/07/26\");\n                        vm.bookout.end_date = new Date(\"2100/07/26\");\n\n                        MemberService.GetAllByPics(data.booking.club_id, vm.user.id)\n                            .then(function (pics) {\n                                    vm.pics = pics;\n                                    process_bookout_to_bookin(data.booking);\n                            });\n\n\n\n                    }\n                });\n\n                \n            break;\n            case \"edit\":\n\n            \n\n\n\n            break;\n            case \"list\":\n\n             \n\n\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n      \n\n        vm.calculate_invoice_for_flight = function(){\n\n            //vm.flight_units where the units are stored\n\n\n            // //vm.bookout.plane_charges where the fees are stored\n            // var plane_units = 0;\n            // //plane units\n            // if(vm.bookout.plane_charges.charge_type == \"brakes\"){\n            //     //then the units relate to the entered numbers:\n            //     plane_units = vm.flight_units.brakes_to_brakes;\n            // } else {\n            //     //then the units we need to calculate relate to the hours between brakes off and on.\n            //     plane_units = (vm.bookout.end_tacho - vm.bookout.start_tacho);\n            // }\n\n            // var plane_total = (vm.bookout.plane_charges.charge_rate_unit * plane_units);\n\n\n            // //plane surchages::::\n            // var surcharge_units = 0;\n            // if(vm.bookout.plane_charges.surcharge_type == \"flight\"){\n            //     //then the units relate to the entered numbers:\n            //     surcharge_units = 1;\n            // } else if(vm.bookout.plane_charges.surcharge_type !== \"none\") {\n            //     //then the units are based on the plane units\n            //     surcharge_units = plane_units;\n            // }\n\n            // var surcharge_total = (vm.bookout.plane_charges.surcharge_fee * surcharge_units);\n\n\n            // //landings and touch and goes etc...\n            // var landing_units = vm.bookout.landings | 0;\n            // var landings_total = (landing_units * vm.bookout.plane_charges.landing_fee);\n\n\n            // var tg_units = vm.bookout.tng | 0;\n            // var tng_total = (tg_units * vm.bookout.plane_charges.touch_and_go_fee);\n\n\n\n            // //TUITION CHARGES\n            // var tuition_charge_type = \"none\";\n            // var tuition_price = 0;\n            // var tuition_total = 0;\n            // var tuition_units = 0;\n            // if(vm.bookout.instructor_id > 0 && vm.bookout.tuition_id > 0 && vm.bookout.tuition_charges){\n\n            //     tuition_charge_type = vm.bookout.tuition_charges.charge_type;\n            //     tuition_price = vm.bookout.tuition_charges.price;\n\n            //     if(tuition_charge_type == \"brakes\"){\n            //         tuition_units = vm.flight_units.brakes_to_brakes;\n            //         tuition_charge_type = \"brakes off to brakes on hours\";\n            //     } else if(tuition_charge_type == \"plane\"){\n            //         tuition_units = (vm.bookout.end_tacho - vm.bookout.start_tacho);\n            //         tuition_charge_type = \"plane units\";\n            //     } else if(tuition_charge_type == \"session\"){\n            //         tuition_units = 1;\n            //         tuition_charge_type = \"session\";\n            //     }\n\n            //     tuition_total = (tuition_units * tuition_price);\n\n            // }\n\n            // var total_to_remove = 0;\n            // var receipts = [];\n            // //need to process the reductions due to the receipts...\n            // for(var i = 0;i<vm.lubricant_receipts.length;i++){\n\n            //     if(vm.lubricant_receipts[i].reimbursement == 1){\n            //         receipts.push(vm.lubricant_receipts[i]);\n            //         total_to_remove = Number.parseFloat(Number.parseFloat(total_to_remove) + Number.parseFloat(vm.lubricant_receipts[i].price));\n            //     }\n\n            // }\n\n            // //console.log(\"CALC HERE\", total_to_remove);\n\n\n\n\n\n\n            // var total = (plane_total + surcharge_total + landings_total + tng_total + tuition_total - total_to_remove);\n\n            vm.invoice_totals = vm.previous_total;\n\n            vm.plane_charges = {\n                // plane_charge_type: vm.bookout.plane_charges.charge_type,\n                // plane_unit_price: vm.bookout.plane_charges.charge_rate_unit,\n                // plane_units: plane_units,\n                // plane_total: plane_total,\n                // surcharge_charge_type: vm.bookout.plane_charges.surcharge_type,\n                // surcharge_unit_price: vm.bookout.plane_charges.surcharge_fee,\n                // surcharge_units: surcharge_units,\n                // surcharge_total: surcharge_total,\n                // landing_units: landing_units,\n                // landing_unit_price: vm.bookout.plane_charges.landing_fee,\n                // landing_total: landings_total,\n                // tng_units: tg_units,\n                // tng_unit_price: vm.bookout.plane_charges.touch_and_go_fee,\n                // tng_total: tng_total,\n                // tuition_charge_type: tuition_charge_type,\n                // tuition_unit_price: tuition_price,\n                // tuition_units: tuition_units,\n                // tuition_total: tuition_total,\n                //receipts: receipts,\n                total: 0\n            };\n\n            //vm.bookout.tuition_charges\n\n        }\n\n        vm.instructor_charges = []; \n\n\n        // vm.update_book_in_options = function(){\n        //     vm.complete_flight = ( (vm.bookout.flight_type.title !== \"Local\" && vm.bookout.to_airfield.id !== vm.bookout.home_airport_id) || vm.bookout.to_airfield.id !== vm.bookout.home_airport_id) ? false : true;\n        // }\n        vm.complete_flight = true;\n       \n\n\n        // var compile_invoice = function(){\n        //     var items = [];\n        //     // vm.plane_charges\n        //     //add plane costs\n        //     items.push({title: \"Plane \"+vm.plane_charges.plane_charge_type+\" Charge\", unit: vm.plane_charges.plane_units, unit_price: vm.plane_charges.plane_unit_price, total: vm.plane_charges.plane_total, organise: 0});\n        //     if(vm.plane_charges.surcharge_total > 0){\n        //         items.push({title: \"Surcharge per \"+vm.plane_charges.surcharge_charge_type, unit: vm.plane_charges.surcharge_units, unit_price: vm.plane_charges.surcharge_unit_price, total: vm.plane_charges.surcharge_total, organise: 1});\n        //     }\n        //     if(vm.plane_charges.tuition_total > 0){\n        //         items.push({title: \"Tuition Charge - \"+vm.bookout.tuition_required.title, unit: vm.plane_charges.tuition_units, unit_price: vm.plane_charges.tuition_unit_price, total: vm.plane_charges.tuition_total, organise: 2});\n        //     }\n        //     if(vm.plane_charges.landing_total > 0){\n        //         items.push({title: \"Home Landing\", unit: vm.plane_charges.landing_units, unit_price: vm.plane_charges.landing_unit_price, total: vm.plane_charges.landing_total, organise: 4});\n        //     }\n        //     if(vm.plane_charges.tng_total > 0){\n        //         items.push({title: \"Home Touch and Go\", unit: vm.plane_charges.tng_units, unit_price: vm.plane_charges.tng_unit_price, total: vm.plane_charges.tng_total, organise: 3});\n        //     }\n           \n\n        //     //RENTAL ITEMS !? --> make it free for now...\n\n        //     for(var i=0;i<vm.plane_charges.receipts.length;i++){\n        //         var org = parseInt(5 + i)\n        //         items.push({title: \"Reimbursement - \"+vm.plane_charges.receipts[i].item, unit: vm.plane_charges.receipts[i].quantity, unit_price: (vm.plane_charges.receipts[i].price / vm.plane_charges.receipts[i].quantity), total: -vm.plane_charges.receipts[i].price, organise: org});\n        //     }\n\n        //     return items;\n        // }\n\n\n\n\n\n\n        //complete the booking back in\n        vm.book_in_flight = function(method='', paymentIntent=null){\n\n            var obj = {\n                //payer_id: vm.bookout.payer_id, // >>>? is this required here?\n                user_id: vm.bookout.user_id,\n                club_id: vm.bookout.club_id,\n                plane_id: vm.bookout.plane_id,\n                booking_id: vm.bookout.booking_id,\n                paying_now: vm.complete_flight,\n                free_flight: (vm.invoice_totals == 0) ? true : false\n            };\n\n            //methods: bacs, card, new_card, cardmachine - overwritten\n            //direct-debit, saved-card, new-card, card-machine\n            if(method == \"new-card\"){\n                obj.paymentIntent = paymentIntent;\n                obj.method = method;\n            } else if(method == \"saved-card\"){\n                obj.paymentIntent = paymentIntent;\n                obj.method = method;\n            } else if(method == \"direct-debit\"){\n                //nothing to add - it should just work...\n                obj.method = method;\n            } else if(method == \"card-machine\"){\n                //nothing here at the moment?\n                obj.paymentIntent = paymentIntent;\n                obj.method = method;\n            }\n\n            // //console.log(\"TO BE SENDING : \", obj);\n            //return false;\n            BookoutService.PayBooking(vm.bookout.id, obj)\n            .then(function(data){\n                //console.log(\"SENT - \", data);\n                if(data.success){\n                        vm.show_loading = false;\n                        $state.go('dashboard.my_account', {}, { reload: true });                    \n                } else {\n                    ToastService.error('Error', 'An error occurred: ' + data.message);\n                    vm.show_loading = false;\n                    //console.log(data);\n                }\n            });\n\n        }\n\n\n\n\n        vm.start_tacho_orig;\n\n\n\n\n\n        function process_bookout_to_bookin(booking){\n\n\n            //vm.bookout is where we want to fill the content....\n            vm.bookout.booking_id = booking.id;\n            vm.bookout.club_id = booking.club_id;\n            vm.bookout.user_id = booking.user_id;\n            vm.bookout.plane = booking.plane;\n            vm.club_id = booking.club_id;\n            // vm.bookout.return = new Date(booking.end);\n            // vm.bookout.booking_start = new Date(booking.start);\n\n\n              if(((vm.user.access.instructor.indexOf(vm.club_id) > -1) || (vm.user.access.manager.indexOf(vm.club_id) > -1) ) && vm.bookout.user_id !== vm.user.id){\n                //console.log(\"NOT BOOKING FOR SELF?\");\n                vm.can_authorise = true;\n\n            }\n\n\n            vm.invoices = [];\n            vm.previous_total = 0;\n            InvoicesService.GetAllByBooking(booking.id)\n            .then(function (data) {\n                    //console.log(\"invoice data is : \", data);\n                   \n                    if(data.success){\n                        //console.log(\"we already have invoices for this booking\");\n                        vm.previous_invoice = data.invoice;\n\n                        for(var me in data.invoices){\n\n                            for (var key in data.invoices[me].flights) {\n                                //console.log(\"KEY \", key);\n\n                                if(data.invoices[me] && data.invoices[me].status && data.invoices[me].status.toLowerCase() !== \"paid\"){\n                                   vm.invoices.push(data.invoices[me].flights[key]);\n                                    vm.previous_total = (Number.parseFloat(vm.previous_total) + Number.parseFloat(data.invoices[me].flights[key][\"total\"]));\n                                }\n                                  \n\n                                //vm.calculate_invoice_for_flight();\n                                // for(var i=0;i<data.invoice.flights[key].length;i++){\n                                // }\n                            }\n\n                        }\n                        \n\n\n                        // for (var key in data.invoice.flights) {\n                        //     //console.log(\"KEY \", key);\n\n                        //     if(data.invoice && data.invoice.status && data.invoice.status.toLowerCase() !== \"paid\"){\n                        //        vm.invoices.push(data.invoice.flights[key]);\n                        //         vm.previous_total = (Number.parseFloat(vm.previous_total) + Number.parseFloat(data.invoice.flights[key][\"total\"]));\n                        //     }\n                              \n\n                        //     //vm.calculate_invoice_for_flight();\n                        //     // for(var i=0;i<data.invoice.flights[key].length;i++){\n                        //     // }\n                        // }\n                        \n                        vm.complete_this_flight();\n                        vm.invoice_totals = vm.previous_total;\n\n                        //was var send before...\n                        vm.send = {\n                            club_id: vm.bookout.club_id,\n                            user_id: vm.user.id,\n                            booking_id: booking.id\n                        }\n\n                        /*\n                        VM.SEND --> TO THE PAYMENT MODAL\n                            if invoice --> remove booking_id add invoice_id \n                            if no invoice / booking --> remove both and add amount * 100\n                            ie: amount: vm.invoice_totals * 100,\n                            user must be the user for that invoice / PAYER ID --> careful on admin functions\n                        */\n\n                        vm.show_add_card = true;\n\n                        //SETUP THE VM TO SEE THE MENU HERE???\n                        //AND INCLUDE THE SEND OBJ?\n\n                        if(vm.previous_total == 0 || vm.invoices.length == 0){\n\n                            ToastService.warning('Already Complete', 'It appears that you have already completed this flight!');\n                            $state.go('dashboard.my_account', {}, { reload: true });                    \n\n                        }\n\n\n\n\n\n                        /*\n        --> ORIGINAL CODE HERE\n                        PaymentService.CreatePaymentIntentNewCard(send)\n                        .then(function (data) {\n                            console.log(\"DATA HERE\", data);\n                            // Initialize Stripe.js\n                            var stripe = Stripe('pk_test_51QttFFG8WiGSRCORyxkdZTO8oajcqz9OUsvcDJFpr9FB2PAdbzJc0tS7WNnfzKYsTiqHN1YDZi5UtXk4K52SeD4h00YWXuChNd');\n\n                            const options = {\n                              clientSecret: data.client_secret,\n                              // Fully customizable with appearance API.\n                              appearance: {},\n                              paymentMethodOrder: ['card', 'apple_pay', 'google_pay']\n\n                            };\n\n                            // Set up Stripe.js and Elements using the SetupIntent's client secret\n                            const elements = stripe.elements(options);\n\n                            // Create and mount the Payment Element\n                            const paymentElementOptions = { layout: 'tabs'};\n                            const paymentElement = elements.create('payment', paymentElementOptions);\n                            paymentElement.mount('#payment-element');\n\n\n                            const submitButton = document.getElementById('submit-stripe');\n                            if (submitButton) {\n                              submitButton.addEventListener('click', async (event) => {\n\n                                $scope.$apply(() => {\n                                    vm.show_loading = true;\n                                });\n                                event.preventDefault();\n                                //console.log('Submit button clicked!');\n                                \n                                // Process the payment manually\n                                const {error, paymentIntent} = await stripe.confirmPayment({\n                                  elements,\n                                  confirmParams: {\n                                   // return_url: 'https://example.com/order/confirmation',\n                                  },\n                                  redirect: 'if_required', // Only redirect if absolutely necessary\n                                });\n                                \n                                if (error) {\n                                  console.error(error);\n\n                                  $scope.$apply(() => {\n                                        vm.show_loading = false;\n                                    });\n\n                                } else if(paymentIntent){\n                                    //console.log(\"SUCCESS??\");\n                                        if (paymentIntent.status === 'succeeded') {\n                                            //console.log(\"PAYMENT SUCCEEDED!!\");\n\n                                            //this is where I will now look at confirming that this is paid etc...paymentIntent\n\n                                            $scope.$apply(() => {\n                                                vm.book_in_flight('new_card', paymentIntent);\n                                            });\n                                            \n\n                                        } else {\n                                             //console.log(\"There was an error processing your payment\");\n                                            $scope.$apply(() => {\n                                                vm.show_loading = true;\n                                            });\n                                        }\n                                }\n                              });\n                            }\n\n\n\n\n                        });\n */\n\n\n\n\n\n\n\n                //SAMPLE ACCORDION MENU TO SELECT THE PAYMENT METHOD\n\n                        //console.log(\"FLIGHTS\", vm.invoices);\n                        //console.log(\"FLIGHTS TOTAL\", vm.previous_total);\n                        // vm.invoices = data.invoice.flights;\n                    } else {\n                        //console.log(\"no invoices have yet been issued for this flight\");\n                    }\n\n\n                });\n\n\n\n            // PlaneService.GetOpenIssues(booking.plane_id)\n            // .then(function (data) {\n            //         ////console.log(\"data is : \", data);\n            //        vm.reported_defects = data;\n            //     });\n\n            //   PlaneService.GetAllSheetReceipts(vm.bookout.id)\n            //     .then(function (data) {\n            //         ////console.log(\"data is : \", data);\n            //         vm.lubricant_receipts = data;\n            //     });\n\n\n            //     InstructorCharges.GetByClubId(booking.club_id)\n            //     .then(function(data){\n            //         vm.instructor_charges = data.items;  \n            //     });\n            //we need to update the PICS now...\n\n           \n            //we need to know where the plane was last booked-in at \n            //(ie: if last flight bookout was completed - where the plane landed at last)\n            //if the last booking was not yet completed, then we can assume that this last flight was returning to base.\n\n\n            \n            // var selected_pic = vm.pics.find(item => item.user_id === booking.pic_id);\n            // vm.bookout.pic = selected_pic;\n\n            // //console.log(\"booking.detail_type_id\", booking.detail_type_id);\n\n            // // var selected_detail_type = vm.flight_types.find(item => item.id === booking.detail_type_id);\n            // // vm.bookout.flight_type = selected_detail_type;\n\n            // if(booking.instructor && booking.instructor !== \"\" && booking.instructor.id == booking.pic_id){\n            //     vm.bookout.put = vm.bookout.user;\n            // }\n\n           \n\n            // vm.bookout.from_airfield = booking.from_airport;\n            // vm.bookout.to_airfield = booking.to_airport;\n\n            // vm.bookout.start_tacho = Number.parseFloat(booking.last_tacho);\n            \n            // vm.start_tacho_orig = booking.last_tacho;\n\n\n\n           \n             //this is where we sort out some of the last bits....\n\n\n\n            // if(booking.instructor && booking.instructor !== \"\" && booking.instructor.id > 0){\n            //     // then we need to set the PIC as the instructor\n            //     //select from pics where user_id = booking.user_id;\n            //     var selected_pic = vm.pics.find(item => item.user_id === booking.instructor.id);\n            //     //set the PIC now...\n            //     vm.bookout.pic = selected_pic;\n            //     vm.bookout.instructor_id = booking.instructor.id;\n            //     vm.bookout.instructor = booking.instructor;\n\n\n            //     var selected_put = vm.pics.find(item => item.user_id === booking.user_id);\n            //     vm.bookout.put = selected_put;\n\n            // } else {\n            //     //then the user is the PIC\n            //     var selected_pic = vm.pics.find(item => item.user_id === booking.user_id);\n            //     vm.bookout.pic = selected_pic;\n\n            // }\n\n       \n\n            // if(booking && booking.plane_details && booking.plane_details.location && booking.plane_details.location.wgs_n){\n            //     vm.wgs_n = booking.plane_details.location.wgs_n\n            //     vm.wgs_e = booking.plane_details.location.wgs_e;\n            // }\n            // var location_default = \"\";\n\n            // if(booking && booking.plane_details && booking.plane_details.location && booking.plane_details.location.code){\n            //     location_default = booking.plane_details.location.code.slice(0, -1);\n            // } else {\n            //     location_default = \"EG\";\n            // }\n\n            // //vm.update_book_in_options();\n\n            // BookoutService.GetAirfieldsByCode(location_default)\n            //     .then(function (data) {\n            //         if(data.success){\n            //             //use GB airfields first...\n            //             vm.airfields = data.airfields;\n            //             // var selected_location = vm.airfields.find(item => item.id === booking.plane_details.location.id);\n            //             // //console.log(\"selected_location\", selected_location);\n            //             // vm.bookout.from_airfield = selected_location;\n            //            }\n            //         });\n\n\n\n            //booking.plane_details.location.id\n            // vm.bookout.pic = selected_pic;\n\n\n        }\n\n\n            //nice looking date pickers\n\n\n            $scope.popup = [];\n\n            $scope.open = function(id, $event) {\n                //console.log(\"THIS\", id);\n                //this comment would allow the event not to be affect by clicking it again... not sure this is a good idea\n                if($scope.popup[id] && $scope.popup[id].opened == true){\n                    $event.preventDefault();\n                    $event.stopPropagation();\n                } else {\n                    $scope.popup[id] = {opened: true};\n                }\n            };\n\n            $scope.formats = ['dd/MM/yyyy', 'yyyy/MM/dd', 'dd.MM.yyyy', 'shortDate'];\n            $scope.format = $scope.formats[0];\n\n            $scope.datePickerOptions = {\n                                        format: 'dd/MM/yyyy',\n                                        showWeeks: false\n                                    };\n\n           \n\n         \n        \n\n\n    }\napp.controller('GalleriesController', GalleriesController);\n \n    GalleriesController.$inject = ['UserService', 'ArtpiecesService', 'ImagesService', 'KeywordsService', 'CategoryService', '$location', '$rootScope', 'FlashService', '$routeParams', '$scope', 'LocalDataService', 'GalleryService', 'ToastService'];\n    function GalleriesController(UserService, ArtpiecesService, ImagesService, KeywordsService, CategoryService, $location, $rootScope, FlashService, $routeParams, $scope, LocalDataService, GalleryService, ToastService) {\n        var vm = this;\n\n      \n\n        //get all galleries to check if name is already in use...\n        GalleryService.GetAll()\n                .then(function(data){\n                     vm.galleries = data;\n                     LocalDataService.SetAllGalleries(data);\n                     if(LocalDataService.data.selecting_for > 0){\n                        vm.galleries.forEach(function(data){\n                            if(data.id == LocalDataService.data.selecting_for){\n                                data.images = LocalDataService.data.selected_images;\n                            }\n                        });\n                        $(\"#organise_images\").fadeIn();\n                        //maybe we need to update the state of the SAVE button as it hasn't been saved yet?\n                     } else {\n                        //nothin to do?\n                     }\n                });\n\n\n\n        vm.images = LocalDataService.data.selected_images;\n\n        //this is where we do the selection of images\n        $scope.remove_image = function(image){\n            //check if set selected\n            //well its selected - so we deselect right?\n            vm.images = $.grep(vm.images, function(e){ \n                return e.id != image.id; \n            });\n            //console.log(vm.images);\n            LocalDataService.SetSelectedImages(vm.images);\n        }\n\n        $scope.check_link_unique = function(){\n            for(var i = 0; i < vm.all_galleries.length; i++){\n                if(vm.all_galleries[i].link===vm.gallery.link){\n                    return false;\n                }\n            }\n        }\n\n        $scope.edit_gallery_images = function(index){\n             var gallery = vm.galleries[index];\n             for(var i=0; i < gallery.images.length; i++){\n                gallery.images[i].selected = true;\n             }\n            LocalDataService.SetSelectedImages(gallery.images);\n            LocalDataService.SetSelectingFor(gallery.id);\n            //console.log(gallery.images);\n            //SetSelectingFor\n            $location.path(\"/select_images\");\n        }\n\n        $scope.save_images = function(){\n            //save images for \n            var images_to_save = [];\n            vm.galleries.forEach(function(data){\n                if(data.id == LocalDataService.data.selecting_for){\n                    data.images = LocalDataService.data.selected_images;\n                    for(var i = 0; i < data.images.length; i++){\n                        data.images[i].organise = i;\n                    }\n                    images_to_save = data.images;\n                }\n            }); \n\n            //vm.galleries[LocalDataService.data.selecting_for]\n            GalleryService.Update({id: LocalDataService.data.selecting_for, images: images_to_save})\n                .then(function(data){\n                    //console.log(data);\n                    LocalDataService.SetSelectingFor(0);\n                    $(\"#organise_images\").fadeOut();\n                });\n           \n        }\n\n\n        $scope.save_gallery = function(index){\n           \n            var gallery = vm.galleries[index];\n            LocalDataService.SetSelectedImages(gallery.images);\n            //we need to set the ORDER as organise in the vm.images\n            var organise = 0;\n            for(var i = 0; i < gallery.images.length; i++){\n                gallery.images[i].organise = i;\n            }\n\n\n            GalleryService.Update(vm.galleries[index])\n                .then(function(data){\n                    //console.log(data);\n                    ToastService.success('Saved', 'Gallery saved successfully.');\n                    //$location.path(\"/\");\n                });\n        }\n\n        var check_gallery_link = function(link){\n            vm.galleries.forEach(function(data){\n                if(data.gallery_link == link){\n                    return false;\n                }\n            });\n            return true;\n        }\n\n        var generate_gallery_link = function(link){\n            var link2 = link + \"-COPY\";\n            if(check_gallery_link(link2)){\n                return link2;\n            } else {\n                return generate_gallery_link(link2+\"1\");\n            }\n        }\n\n        $scope.duplicate_gallery = function(index){\n            //console.log(\"INDEX : \"+index);\n            //HERE BE DRAGONS HORRIBLE HACKY SHIT TO DUPLICATE OBJ\n            var new_gallery = JSON.parse(JSON.stringify(vm.galleries[index]));\n            //console.log(new_gallery);\n            //unset the id to create a new one...\n            delete new_gallery.id;\n            new_gallery.opened = 0;\n            new_gallery.downloaded = 0;\n            //console.log(new_gallery);\n\n            new_gallery.gallery_link = generate_gallery_link(new_gallery.gallery_link);\n\n             GalleryService.Create(new_gallery)\n                .then(function(data){\n                    //console.log(data);\n                    vm.galleries.push(data);\n                });\n\n        }\n\n        $scope.delete_gallery = function(index){\n            //console.log(\"INDEX : \"+index);\n            var gallery = vm.galleries[index];\n            //console.log(gallery);\n            //unset the id to create a new one...\n            //console.log(gallery.id);\n\n            GalleryService.Delete(gallery.id)\n                .then(function(data){\n                    //console.log(data);\n                    \n                    vm.galleries = $.grep(vm.galleries, function(e){ \n                         return e.id != gallery.id; \n                    });\n\n                });\n\n        }\n\n       \n\n\n\n    }\n app.controller('HomeController', HomeController);\n\n    HomeController.$inject = ['UserService', '$rootScope', '$location'];\n    function HomeController(UserService, $rootScope, $location) {\n        var vm = this;\n\n        vm.user = $rootScope.globals.currentUser;\n        \n        vm.allUsers = [];\n        vm.deleteUser = deleteUser;\n\n        initController();\n\n        function initController() {\n            loadCurrentUser();\n            loadAllUsers();\n        }\n\n        function loadCurrentUser() {\n            UserService.GetById($rootScope.globals.currentUser.id)\n                .then(function (data) {\n                    vm.user = data.user;\n                });\n        }\n\n        function loadAllUsers() {\n            UserService.GetAll()\n                .then(function (data) {\n                    vm.allUsers = data.users;\n                });\n        }\n\n       \n        function deleteUser(id) {\n            UserService.Delete(id)\n            .then(function(data) {\n                if(data.success){\n\t                $location.path('/');\n                }\n            });\n        }\n    }\napp.controller('ImagesController', ImagesController);\n \n    ImagesController.$inject = ['UserService', 'ArtpiecesService', 'ImagesService', 'KeywordsService', 'CategoryService', '$location', '$rootScope', 'FlashService', '$routeParams', '$scope', 'LocalDataService'];\n    function ImagesController(UserService, ArtpiecesService, ImagesService, KeywordsService, CategoryService, $location, $rootScope, FlashService, $routeParams, $scope, LocalDataService) {\n        var vm = this;\n        $scope.filters = \"\";\n        vm.selected_images = [];\n\n\n         ImagesService.GetAll()\n                .then(function (data) {\n                    vm.images = data;\n                });\n\n          ArtpiecesService.GetAll()\n                .then(function(data){\n                    vm.all_artpieces = data;\n                    vm.artpieces = data;\n                });\n\n         CategoryService.GetAll()\n                .then(function(data){\n                    vm.categories = data;\n                });\n\n\n        //get one?\n        if($routeParams.imageId){\n            ImagesService.GetOne($routeParams.imageId)\n                    .then(function (data) {\n                        vm.one_image = data;\n                        //console.log(vm.one_image);\n\n                        //console.log(vm.one_image.keywords);\n                        //console.log(vm.one_image.keywords[0]);\n                        //console.log(vm.one_image.keywords[0].id);\n\n                        //converting the keywords to the appropriate format for the front-end\n                        var tags = [];\n                        vm.one_image.keywords.forEach(function(data){\n                            tags.push({id: data.id, text: data.keyword});\n                        });\n                        //console.log(tags);\n                        $scope.tags = tags;      \n\n                    });\n        }\n\n\n         KeywordsService.GetAll()\n                .then(function (data) {\n                    vm.all_keywords = data;\n                    //console.log(vm.all_keywords);\n                    vm.all_tags = [];\n                    vm.all_keywords.forEach(function(data){\n                        vm.all_tags.push({id: data.id, text: data.keyword});\n                    });\n                });\n\n\n        var init = function(){\n            setTimeout(function(){\n                vm.selected_images = LocalDataService.data.selected_images;\n                //console.log(\"RUN ME\");\n                var select\n                if(vm.selected_images.length > 0){\n                    //console.log(\"checking\");\n                    vm.selected_images.forEach(function(image){\n                        //console.log(\"foreach\");\n                        if(image.selected == 1){\n                            //well its selected - so we deselect right?\n\n                             //vm.selected_images.push(image);\n                            update_selected_state(image.id, true);\n\n                           \n                        } else {\n                            update_selected_state(image.id, false);\n                            vm.selected_images = $.grep(vm.selected_images, function(e){ \n                                return e.id != image.id; \n                            });\n                        }\n                    });\n                }\n            }, 500);\n        }\n\n\n        //action on the isotope bit\n        var update_image_list = function(){\n            var get_tags = $scope.tags;\n            var filtering = $scope.filters;\n            //console.log(\"FILTERING BIT\");\n            //console.log(filtering);\n            if(filtering && filtering.indexOf(\", \")){\n                var filter_array = filtering.split(\", \");\n                filtering = \"\";\n                var multi_level_filter = [];\n                filter_array.forEach(function(data){\n                    var loop_content = data;\n                    if(get_tags){\n                         get_tags.forEach(function(data){\n                            loop_content += \".\"+data.text;\n                        });\n                    }\n                    multi_level_filter.push(loop_content);\n                });\n                //console.log(multi_level_filter);\n                //console.log(\"ABOVE\");\n                filtering = multi_level_filter.join(\", \");\n            } else {\n                if(get_tags){\n                     get_tags.forEach(function(data){\n                        filtering += \".\"+data.text;\n                    });\n                }\n            }\n            //console.log(filtering);\n            $scope.$emit('iso-option', {filter: filtering});\n        }\n\n        var current_category = 0;\n\n        $scope.change_category = function(index){\n            //console.log(\"LOADING INDEX : \"+index);\n            current_category = index;\n            if(index == \"all\"){\n                //console.log(\"SHOW ALL HERE PLEASE\");\n                vm.artpieces = vm.all_artpieces;\n                $scope.filters = \"\";\n                update_image_list();\n            } else {\n                vm.artpieces = (vm.categories[index].artpieces) ? vm.categories[index].artpieces : [];\n                if(vm.categories[index].artpieces && vm.categories[index].artpieces.length > 0){\n                    var all = vm.categories[index].artpieces;\n                    var artpieces_array = [];\n                    all.forEach(function(data){\n                        artpieces_array.push(\".artpiece\"+data.id);\n                    });\n                    $scope.filters = artpieces_array.join(\", \");\n                    update_image_list();\n                    return $scope.filters;\n                } else {\n                    $scope.filters = \".hideAllPossibleItems\";\n                    update_image_list();\n                }\n            }\n        }\n\n        // filter by actpiece here :)\n        $scope.artpiece_filter = function(filter){\n            $scope.filters = (filter == \"all\") ? ( (current_category == 0) ? \"\" : $scope.change_category(current_category) ) : \".artpiece\"+filter;\n            update_image_list();\n        }        \n\n        //filter by image keyword\n        $scope.update_list = function(){\n            // 500ms delay due to not ready state called occasionally...\n            setTimeout(function(){\n                //console.log($scope.tags);\n                //this is when isotope should be called\n                //filter tag WITH all in tags \n                update_image_list();\n            }, 500);\n        }\n\n\n\n        //testing the requirements bit\n        // $scope.shuffle = function(){\n        //     var get_tags = $scope.tags;\n        //     var filtering = \"\";\n        //     get_tags.forEach(function(data){\n        //         filtering += \".\"+data.text;\n        //     });\n        //     $scope.$emit('iso-option', {filter: filtering});\n        // }\n\n        var update_selected_state = function(id, state){\n            for(var i = 0; i < vm.images.length; i++) {\n                if (vm.images[i].id === id) {\n                    vm.images[i].selected = state;\n                }\n            }\n        }\n\n\n        //this is where we do the selection of images\n        $scope.add_image = function(image){\n            //check if set selected\n            if(image.selected == 1){\n                //well its selected - so we deselect right?\n                update_selected_state(image.id, false);\n                vm.selected_images = $.grep(vm.selected_images, function(e){ \n                    return e.id != image.id; \n                });\n            } else {\n                vm.selected_images.push(image);\n                update_selected_state(image.id, true);\n            }\n            //console.log(vm.selected_images);\n            LocalDataService.SetSelectedImages(vm.selected_images);\n        }\n\n        vm.save_btn_text = (LocalDataService.data.selecting_for > 0) ? \"UPDATE GALLERY\" : \"GENERATE GALLERY\";\n\n        $scope.save = function(){\n            //console.log(LocalDataService.data.selected_images);\n            var url_save = (LocalDataService.data.selecting_for > 0) ? \"/galleries\" : \"/create_gallery\";\n            $location.path(url_save);\n        }\n\n       \n\n        $scope.editImage = function(){\n            //compile all content :::\n            vm.one_image.keywords = $scope.tags;\n            ImagesService.Update(vm.one_image)\n                .then(function (data) {\n                     $location.path(\"/images\");\n                     vm.one_image = {};\n                });\n        }\n\n        $scope.loadClasses = function(classes){\n            // var arr = [];\n            //console.log(classes);\n            return \"one two three\";\n\n        }\n\n        $scope.loadTags = function(query) {\n\n            var first = $.grep(vm.all_keywords, function(e){ var ab = e.keyword; var ab = ab.toLowerCase(); if(ab.startsWith(query.toLowerCase())){ return true; } });\n            var second = [];\n            for(var i = 0; i < first.length; i++){\n                var text_to_lower = first[i].keyword;\n                text_to_lower = text_to_lower.toLowerCase();\n                second.push({id: first[i].id, text: text_to_lower});\n            }\n            return second;\n\n        };\n\n\n\t\t$scope.deleteImage = function(id){\n\t\t\tImagesService.Delete(id)\n                .then(function (data) {\n                    vm.images = $.grep(vm.images, function(e){ \n\t\t\t\t\t     return e.id != id; \n\t\t\t\t\t});\n                });\n\t\t}\n\n        init();\n\n    }\n app.controller('InvitationsSignupController', InvitationsSignupController);\n\n    InvitationsSignupController.$inject = ['UserService', 'MemberService', 'GoCardService', '$http', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$cookies', '$log', 'ToastService'];\n    function InvitationsSignupController(UserService, MemberService, GoCardService, $http, $rootScope, $location, $scope, $state, $stateParams, $cookies, $log, ToastService) {\n        \t\n        \tvar vm = this;\n\n        \t$scope.formData = {};\n\n\nvm.selected_phone;\n\n vm.countries = [\n {\n   \"CountryCode\": \"+247\",\n   \"CountryCodeISO\": \"SH\",\n   \"Country\": \"Ascension\"\n },\n {\n   \"CountryCode\": \"+246\",\n   \"CountryCodeISO\": \"DG\",\n   \"Country\": \"Diego Garcia\"\n },\n {\n   \"CountryCode\": \"+291\",\n   \"CountryCodeISO\": \"ER\",\n   \"Country\": \"Eritrea\"\n },\n {\n   \"CountryCode\": \"+500\",\n   \"CountryCodeISO\": \"FK\",\n   \"Country\": \"Falkland (Malvinas) Islands\"\n },\n {\n   \"CountryCode\": \"+692\",\n   \"CountryCodeISO\": \"MH\",\n   \"Country\": \"Marshall Islands\"\n },\n {\n   \"CountryCode\": \"+691\",\n   \"CountryCodeISO\": \"FM\",\n   \"Country\": \"Micronesia\"\n },\n {\n   \"CountryCode\": \"+683\",\n   \"CountryCodeISO\": \"NU\",\n   \"Country\": \"Niue Island\"\n },\n {\n   \"CountryCode\": \"+290\",\n   \"CountryCodeISO\": \"SH\",\n   \"Country\": \"Saint Helena\"\n },\n {\n   \"CountryCode\": \"+508\",\n   \"CountryCodeISO\": \"PM\",\n   \"Country\": \"Saint Pierre and Miquelon\"\n },\n {\n   \"CountryCode\": \"+690\",\n   \"CountryCodeISO\": \"TK\",\n   \"Country\": \"Tokelau\"\n },\n {\n   \"CountryCode\": \"+688\",\n   \"CountryCodeISO\": \"TV\",\n   \"Country\": \"Tuvalu\"\n },\n {\n   \"CountryCode\": \"+379\",\n   \"CountryCodeISO\": \"VA\",\n   \"Country\": \"Vatican City\"\n },\n {\n   \"CountryCode\": \"+681\",\n   \"CountryCodeISO\": \"WF\",\n   \"Country\": \"Wallis and Futuna\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"AS\",\n   \"Country\": \"American Samoa\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"CA\",\n   \"Country\": \"Canada\"\n },\n {\n   \"CountryCode\": \"+61\",\n   \"CountryCodeISO\": \"AU\",\n   \"Country\": \"Australia\"\n },\n {\n   \"CountryCode\": \"+93\",\n   \"CountryCodeISO\": \"AF\",\n   \"Country\": \"Afghanistan\"\n },\n {\n   \"CountryCode\": \"+355\",\n   \"CountryCodeISO\": \"AL\",\n   \"Country\": \"Albania\"\n },\n {\n   \"CountryCode\": \"+213\",\n   \"CountryCodeISO\": \"DZ\",\n   \"Country\": \"Algeria\"\n },\n {\n   \"CountryCode\": \"+376\",\n   \"CountryCodeISO\": \"AD\",\n   \"Country\": \"Andorra\"\n },\n {\n   \"CountryCode\": \"+244\",\n   \"CountryCodeISO\": \"AO\",\n   \"Country\": \"Angola\"\n },\n {\n   \"CountryCode\": \"+54\",\n   \"CountryCodeISO\": \"AR\",\n   \"Country\": \"Argentina\"\n },\n {\n   \"CountryCode\": \"+374\",\n   \"CountryCodeISO\": \"AM\",\n   \"Country\": \"Armenia\"\n },\n {\n   \"CountryCode\": \"+297\",\n   \"CountryCodeISO\": \"AW\",\n   \"Country\": \"Aruba\"\n },\n {\n   \"CountryCode\": \"+43\",\n   \"CountryCodeISO\": \"AT\",\n   \"Country\": \"Austria\"\n },\n {\n   \"CountryCode\": \"+994\",\n   \"CountryCodeISO\": \"AZ\",\n   \"Country\": \"Azerbaijan\"\n },\n {\n   \"CountryCode\": \"+973\",\n   \"CountryCodeISO\": \"BH\",\n   \"Country\": \"Bahrain\"\n },\n {\n   \"CountryCode\": \"+880\",\n   \"CountryCodeISO\": \"BD\",\n   \"Country\": \"Bangladesh\"\n },\n {\n   \"CountryCode\": \"+375\",\n   \"CountryCodeISO\": \"BY\",\n   \"Country\": \"Belarus\"\n },\n {\n   \"CountryCode\": \"+32\",\n   \"CountryCodeISO\": \"BE\",\n   \"Country\": \"Belgium\"\n },\n {\n   \"CountryCode\": \"+501\",\n   \"CountryCodeISO\": \"BZ\",\n   \"Country\": \"Belize\"\n },\n {\n   \"CountryCode\": \"+229\",\n   \"CountryCodeISO\": \"BJ\",\n   \"Country\": \"Benin\"\n },\n {\n   \"CountryCode\": \"+975\",\n   \"CountryCodeISO\": \"BT\",\n   \"Country\": \"Bhutan\"\n },\n {\n   \"CountryCode\": \"+591\",\n   \"CountryCodeISO\": \"BO\",\n   \"Country\": \"Bolivia\"\n },\n {\n   \"CountryCode\": \"+387\",\n   \"CountryCodeISO\": \"BA\",\n   \"Country\": \"Bosnia and Herzegovina\"\n },\n {\n   \"CountryCode\": \"+267\",\n   \"CountryCodeISO\": \"BW\",\n   \"Country\": \"Botswana\"\n },\n {\n   \"CountryCode\": \"+55\",\n   \"CountryCodeISO\": \"BR\",\n   \"Country\": \"Brazil\"\n },\n {\n   \"CountryCode\": \"+673\",\n   \"CountryCodeISO\": \"BN\",\n   \"Country\": \"Brunei\"\n },\n {\n   \"CountryCode\": \"+359\",\n   \"CountryCodeISO\": \"BG\",\n   \"Country\": \"Bulgaria\"\n },\n {\n   \"CountryCode\": \"+226\",\n   \"CountryCodeISO\": \"BF\",\n   \"Country\": \"Burkina Faso\"\n },\n {\n   \"CountryCode\": \"+257\",\n   \"CountryCodeISO\": \"BI\",\n   \"Country\": \"Burundi\"\n },\n {\n   \"CountryCode\": \"+855\",\n   \"CountryCodeISO\": \"KH\",\n   \"Country\": \"Cambodia\"\n },\n {\n   \"CountryCode\": \"+237\",\n   \"CountryCodeISO\": \"CM\",\n   \"Country\": \"Cameroon\"\n },\n {\n   \"CountryCode\": \"+238\",\n   \"CountryCodeISO\": \"CV\",\n   \"Country\": \"Cape Verde\"\n },\n {\n   \"CountryCode\": \"+236\",\n   \"CountryCodeISO\": \"CF\",\n   \"Country\": \"Central African Republic\"\n },\n {\n   \"CountryCode\": \"+235\",\n   \"CountryCodeISO\": \"TD\",\n   \"Country\": \"Chad\"\n },\n {\n   \"CountryCode\": \"+56\",\n   \"CountryCodeISO\": \"CL\",\n   \"Country\": \"Chile\"\n },\n {\n   \"CountryCode\": \"+86\",\n   \"CountryCodeISO\": \"CN\",\n   \"Country\": \"China\"\n },\n {\n   \"CountryCode\": \"+57\",\n   \"CountryCodeISO\": \"CO\",\n   \"Country\": \"Colombia\"\n },\n {\n   \"CountryCode\": \"+269\",\n   \"CountryCodeISO\": \"KM\",\n   \"Country\": \"Comoros\"\n },\n {\n   \"CountryCode\": \"+242\",\n   \"CountryCodeISO\": \"CG\",\n   \"Country\": \"Congo\"\n },\n {\n   \"CountryCode\": \"+682\",\n   \"CountryCodeISO\": \"CK\",\n   \"Country\": \"Cook Islands\"\n },\n {\n   \"CountryCode\": \"+506\",\n   \"CountryCodeISO\": \"CR\",\n   \"Country\": \"Costa Rica\"\n },\n {\n   \"CountryCode\": \"+385\",\n   \"CountryCodeISO\": \"HR\",\n   \"Country\": \"Croatia\"\n },\n {\n   \"CountryCode\": \"+53\",\n   \"CountryCodeISO\": \"CU\",\n   \"Country\": \"Cuba\"\n },\n {\n   \"CountryCode\": \"+357\",\n   \"CountryCodeISO\": \"CY\",\n   \"Country\": \"Cyprus\"\n },\n {\n   \"CountryCode\": \"+420\",\n   \"CountryCodeISO\": \"CZ\",\n   \"Country\": \"Czech Republic\"\n },\n {\n   \"CountryCode\": \"+243\",\n   \"CountryCodeISO\": \"CD\",\n   \"Country\": \"Democratic Republic of Congo\"\n },\n {\n   \"CountryCode\": \"+45\",\n   \"CountryCodeISO\": \"DK\",\n   \"Country\": \"Denmark\"\n },\n {\n   \"CountryCode\": \"+253\",\n   \"CountryCodeISO\": \"DJ\",\n   \"Country\": \"Djibouti\"\n },\n {\n   \"CountryCode\": \"+670\",\n   \"CountryCodeISO\": \"TL\",\n   \"Country\": \"East Timor\"\n },\n {\n   \"CountryCode\": \"+593\",\n   \"CountryCodeISO\": \"EC\",\n   \"Country\": \"Ecuador\"\n },\n {\n   \"CountryCode\": \"+20\",\n   \"CountryCodeISO\": \"EG\",\n   \"Country\": \"Egypt\"\n },\n {\n   \"CountryCode\": \"+503\",\n   \"CountryCodeISO\": \"SV\",\n   \"Country\": \"El Salvador\"\n },\n {\n   \"CountryCode\": \"+240\",\n   \"CountryCodeISO\": \"GQ\",\n   \"Country\": \"Equatorial Guinea\"\n },\n {\n   \"CountryCode\": \"+372\",\n   \"CountryCodeISO\": \"EE\",\n   \"Country\": \"Estonia\"\n },\n {\n   \"CountryCode\": \"+251\",\n   \"CountryCodeISO\": \"ET\",\n   \"Country\": \"Ethiopia\"\n },\n {\n   \"CountryCode\": \"+298\",\n   \"CountryCodeISO\": \"FO\",\n   \"Country\": \"Faroe Islands\"\n },\n {\n   \"CountryCode\": \"+679\",\n   \"CountryCodeISO\": \"FJ\",\n   \"Country\": \"Fiji\"\n },\n {\n   \"CountryCode\": \"+358\",\n   \"CountryCodeISO\": \"FI\",\n   \"Country\": \"Finland\"\n },\n {\n   \"CountryCode\": \"+33\",\n   \"CountryCodeISO\": \"FR\",\n   \"Country\": \"France\"\n },\n {\n   \"CountryCode\": \"+594\",\n   \"CountryCodeISO\": \"GF\",\n   \"Country\": \"French Guiana\"\n },\n {\n   \"CountryCode\": \"+689\",\n   \"CountryCodeISO\": \"PF\",\n   \"Country\": \"French Polynesia\"\n },\n {\n   \"CountryCode\": \"+241\",\n   \"CountryCodeISO\": \"GA\",\n   \"Country\": \"Gabon\"\n },\n {\n   \"CountryCode\": \"+220\",\n   \"CountryCodeISO\": \"GM\",\n   \"Country\": \"Gambia\"\n },\n {\n   \"CountryCode\": \"+995\",\n   \"CountryCodeISO\": \"GE\",\n   \"Country\": \"Georgia\"\n },\n {\n   \"CountryCode\": \"+49\",\n   \"CountryCodeISO\": \"DE\",\n   \"Country\": \"Germany\"\n },\n {\n   \"CountryCode\": \"+233\",\n   \"CountryCodeISO\": \"GH\",\n   \"Country\": \"Ghana\"\n },\n {\n   \"CountryCode\": \"+350\",\n   \"CountryCodeISO\": \"GI\",\n   \"Country\": \"Gibraltar\"\n },\n {\n   \"CountryCode\": \"+30\",\n   \"CountryCodeISO\": \"GR\",\n   \"Country\": \"Greece\"\n },\n {\n   \"CountryCode\": \"+299\",\n   \"CountryCodeISO\": \"GL\",\n   \"Country\": \"Greenland\"\n },\n {\n   \"CountryCode\": \"+590\",\n   \"CountryCodeISO\": \"GP\",\n   \"Country\": \"Guadeloupe\"\n },\n {\n   \"CountryCode\": \"+502\",\n   \"CountryCodeISO\": \"GT\",\n   \"Country\": \"Guatemala\"\n },\n {\n   \"CountryCode\": \"+224\",\n   \"CountryCodeISO\": \"GN\",\n   \"Country\": \"Guinea\"\n },\n {\n   \"CountryCode\": \"+245\",\n   \"CountryCodeISO\": \"GW\",\n   \"Country\": \"Guinea-Bissau\"\n },\n {\n   \"CountryCode\": \"+592\",\n   \"CountryCodeISO\": \"GY\",\n   \"Country\": \"Guyana\"\n },\n {\n   \"CountryCode\": \"+509\",\n   \"CountryCodeISO\": \"HT\",\n   \"Country\": \"Haiti\"\n },\n {\n   \"CountryCode\": \"+504\",\n   \"CountryCodeISO\": \"HN\",\n   \"Country\": \"Honduras\"\n },\n {\n   \"CountryCode\": \"+852\",\n   \"CountryCodeISO\": \"HK\",\n   \"Country\": \"Hong Kong\"\n },\n {\n   \"CountryCode\": \"+36\",\n   \"CountryCodeISO\": \"HU\",\n   \"Country\": \"Hungary\"\n },\n {\n   \"CountryCode\": \"+354\",\n   \"CountryCodeISO\": \"IS\",\n   \"Country\": \"Iceland\"\n },\n {\n   \"CountryCode\": \"+91\",\n   \"CountryCodeISO\": \"IN\",\n   \"Country\": \"India\"\n },\n {\n   \"CountryCode\": \"+62\",\n   \"CountryCodeISO\": \"ID\",\n   \"Country\": \"Indonesia\"\n },\n {\n   \"CountryCode\": \"+98\",\n   \"CountryCodeISO\": \"IR\",\n   \"Country\": \"Iran\"\n },\n {\n   \"CountryCode\": \"+964\",\n   \"CountryCodeISO\": \"IQ\",\n   \"Country\": \"Iraq\"\n },\n {\n   \"CountryCode\": \"+353\",\n   \"CountryCodeISO\": \"IE\",\n   \"Country\": \"Ireland\"\n },\n {\n   \"CountryCode\": \"+972\",\n   \"CountryCodeISO\": \"IL\",\n   \"Country\": \"Israel\"\n },\n {\n   \"CountryCode\": \"+39\",\n   \"CountryCodeISO\": \"IT\",\n   \"Country\": \"Italy\"\n },\n {\n   \"CountryCode\": \"+225\",\n   \"CountryCodeISO\": \"CI\",\n   \"Country\": \"Ivory Coast\"\n },\n {\n   \"CountryCode\": \"+81\",\n   \"CountryCodeISO\": \"JP\",\n   \"Country\": \"Japan\"\n },\n {\n   \"CountryCode\": \"+962\",\n   \"CountryCodeISO\": \"JO\",\n   \"Country\": \"Jordan\"\n },\n {\n   \"CountryCode\": \"+254\",\n   \"CountryCodeISO\": \"KE\",\n   \"Country\": \"Kenya\"\n },\n {\n   \"CountryCode\": \"+686\",\n   \"CountryCodeISO\": \"KI\",\n   \"Country\": \"Kiribati\"\n },\n {\n   \"CountryCode\": \"+965\",\n   \"CountryCodeISO\": \"KW\",\n   \"Country\": \"Kuwait\"\n },\n {\n   \"CountryCode\": \"+996\",\n   \"CountryCodeISO\": \"KG\",\n   \"Country\": \"Kyrgyzstan\"\n },\n {\n   \"CountryCode\": \"+856\",\n   \"CountryCodeISO\": \"LA\",\n   \"Country\": \"Laos\"\n },\n {\n   \"CountryCode\": \"+371\",\n   \"CountryCodeISO\": \"LV\",\n   \"Country\": \"Latvia\"\n },\n {\n   \"CountryCode\": \"+961\",\n   \"CountryCodeISO\": \"LB\",\n   \"Country\": \"Lebanon\"\n },\n {\n   \"CountryCode\": \"+266\",\n   \"CountryCodeISO\": \"LS\",\n   \"Country\": \"Lesotho\"\n },\n {\n   \"CountryCode\": \"+231\",\n   \"CountryCodeISO\": \"LR\",\n   \"Country\": \"Liberia\"\n },\n {\n   \"CountryCode\": \"+218\",\n   \"CountryCodeISO\": \"LY\",\n   \"Country\": \"Libya\"\n },\n {\n   \"CountryCode\": \"+423\",\n   \"CountryCodeISO\": \"LI\",\n   \"Country\": \"Liechtenstein\"\n },\n {\n   \"CountryCode\": \"+370\",\n   \"CountryCodeISO\": \"LT\",\n   \"Country\": \"Lithuania\"\n },\n {\n   \"CountryCode\": \"+352\",\n   \"CountryCodeISO\": \"LU\",\n   \"Country\": \"Luxembourg\"\n },\n {\n   \"CountryCode\": \"+853\",\n   \"CountryCodeISO\": \"MO\",\n   \"Country\": \"Macau\"\n },\n {\n   \"CountryCode\": \"+389\",\n   \"CountryCodeISO\": \"MK\",\n   \"Country\": \"Macedonia\"\n },\n {\n   \"CountryCode\": \"+261\",\n   \"CountryCodeISO\": \"MG\",\n   \"Country\": \"Madagascar\"\n },\n {\n   \"CountryCode\": \"+265\",\n   \"CountryCodeISO\": \"MW\",\n   \"Country\": \"Malawi\"\n },\n {\n   \"CountryCode\": \"+60\",\n   \"CountryCodeISO\": \"MY\",\n   \"Country\": \"Malaysia\"\n },\n {\n   \"CountryCode\": \"+960\",\n   \"CountryCodeISO\": \"MV\",\n   \"Country\": \"Maldives\"\n },\n {\n   \"CountryCode\": \"+223\",\n   \"CountryCodeISO\": \"ML\",\n   \"Country\": \"Mali\"\n },\n {\n   \"CountryCode\": \"+356\",\n   \"CountryCodeISO\": \"MT\",\n   \"Country\": \"Malta\"\n },\n {\n   \"CountryCode\": \"+596\",\n   \"CountryCodeISO\": \"MQ\",\n   \"Country\": \"Martinique\"\n },\n {\n   \"CountryCode\": \"+222\",\n   \"CountryCodeISO\": \"MR\",\n   \"Country\": \"Mauritania\"\n },\n {\n   \"CountryCode\": \"+230\",\n   \"CountryCodeISO\": \"MU\",\n   \"Country\": \"Mauritius\"\n },\n {\n   \"CountryCode\": \"+262\",\n   \"CountryCodeISO\": \"RE\",\n   \"Country\": \"Reunion\"\n },\n {\n   \"CountryCode\": \"+52\",\n   \"CountryCodeISO\": \"MX\",\n   \"Country\": \"Mexico\"\n },\n {\n   \"CountryCode\": \"+373\",\n   \"CountryCodeISO\": \"MD\",\n   \"Country\": \"Moldova\"\n },\n {\n   \"CountryCode\": \"+377\",\n   \"CountryCodeISO\": \"MC\",\n   \"Country\": \"Monaco\"\n },\n {\n   \"CountryCode\": \"+976\",\n   \"CountryCodeISO\": \"MN\",\n   \"Country\": \"Mongolia\"\n },\n {\n   \"CountryCode\": \"+382\",\n   \"CountryCodeISO\": \"ME\",\n   \"Country\": \"Montenegro\"\n },\n {\n   \"CountryCode\": \"+212\",\n   \"CountryCodeISO\": \"MA\",\n   \"Country\": \"Morocco\"\n },\n {\n   \"CountryCode\": \"+258\",\n   \"CountryCodeISO\": \"MZ\",\n   \"Country\": \"Mozambique\"\n },\n {\n   \"CountryCode\": \"+95\",\n   \"CountryCodeISO\": \"MM\",\n   \"Country\": \"Myanmar\"\n },\n {\n   \"CountryCode\": \"+264\",\n   \"CountryCodeISO\": \"NA\",\n   \"Country\": \"Namibia\"\n },\n {\n   \"CountryCode\": \"+674\",\n   \"CountryCodeISO\": \"NR\",\n   \"Country\": \"Nauru\"\n },\n {\n   \"CountryCode\": \"+977\",\n   \"CountryCodeISO\": \"NP\",\n   \"Country\": \"Nepal\"\n },\n {\n   \"CountryCode\": \"+31\",\n   \"CountryCodeISO\": \"NL\",\n   \"Country\": \"Netherlands\"\n },\n {\n   \"CountryCode\": \"+599\",\n   \"CountryCodeISO\": \"AN\",\n   \"Country\": \"Netherlands Antilles\"\n },\n {\n   \"CountryCode\": \"+687\",\n   \"CountryCodeISO\": \"NC\",\n   \"Country\": \"New Caledonia\"\n },\n {\n   \"CountryCode\": \"+64\",\n   \"CountryCodeISO\": \"NZ\",\n   \"Country\": \"New Zealand\"\n },\n {\n   \"CountryCode\": \"+505\",\n   \"CountryCodeISO\": \"NI\",\n   \"Country\": \"Nicaragua\"\n },\n {\n   \"CountryCode\": \"+227\",\n   \"CountryCodeISO\": \"NE\",\n   \"Country\": \"Niger\"\n },\n {\n   \"CountryCode\": \"+234\",\n   \"CountryCodeISO\": \"NG\",\n   \"Country\": \"Nigeria\"\n },\n {\n   \"CountryCode\": \"+850\",\n   \"CountryCodeISO\": \"KP\",\n   \"Country\": \"North Korea\"\n },\n {\n   \"CountryCode\": \"+47\",\n   \"CountryCodeISO\": \"NO\",\n   \"Country\": \"Norway\"\n },\n {\n   \"CountryCode\": \"+968\",\n   \"CountryCodeISO\": \"OM\",\n   \"Country\": \"Oman\"\n },\n {\n   \"CountryCode\": \"+92\",\n   \"CountryCodeISO\": \"PK\",\n   \"Country\": \"Pakistan\"\n },\n {\n   \"CountryCode\": \"+680\",\n   \"CountryCodeISO\": \"PW\",\n   \"Country\": \"Palau\"\n },\n {\n   \"CountryCode\": \"+507\",\n   \"CountryCodeISO\": \"PA\",\n   \"Country\": \"Panama\"\n },\n {\n   \"CountryCode\": \"+675\",\n   \"CountryCodeISO\": \"PG\",\n   \"Country\": \"Papua New Guinea\"\n },\n {\n   \"CountryCode\": \"+595\",\n   \"CountryCodeISO\": \"PY\",\n   \"Country\": \"Paraguay\"\n },\n {\n   \"CountryCode\": \"+51\",\n   \"CountryCodeISO\": \"PE\",\n   \"Country\": \"Peru\"\n },\n {\n   \"CountryCode\": \"+63\",\n   \"CountryCodeISO\": \"PH\",\n   \"Country\": \"Philippines\"\n },\n {\n   \"CountryCode\": \"+48\",\n   \"CountryCodeISO\": \"PL\",\n   \"Country\": \"Poland\"\n },\n {\n   \"CountryCode\": \"+351\",\n   \"CountryCodeISO\": \"PT\",\n   \"Country\": \"Portugal\"\n },\n {\n   \"CountryCode\": \"+974\",\n   \"CountryCodeISO\": \"QA\",\n   \"Country\": \"Qatar\"\n },\n {\n   \"CountryCode\": \"+40\",\n   \"CountryCodeISO\": \"RO\",\n   \"Country\": \"Romania\"\n },\n {\n   \"CountryCode\": \"+7\",\n   \"CountryCodeISO\": \"KZ\",\n   \"Country\": \"Kazakhstan\"\n },\n {\n   \"CountryCode\": \"+250\",\n   \"CountryCodeISO\": \"RW\",\n   \"Country\": \"Rwanda\"\n },\n {\n   \"CountryCode\": \"+685\",\n   \"CountryCodeISO\": \"WS\",\n   \"Country\": \"Samoa\"\n },\n {\n   \"CountryCode\": \"+378\",\n   \"CountryCodeISO\": \"SM\",\n   \"Country\": \"San Marino\"\n },\n {\n   \"CountryCode\": \"+239\",\n   \"CountryCodeISO\": \"ST\",\n   \"Country\": \"Sao Tome and Principe\"\n },\n {\n   \"CountryCode\": \"+966\",\n   \"CountryCodeISO\": \"SA\",\n   \"Country\": \"Saudi Arabia\"\n },\n {\n   \"CountryCode\": \"+221\",\n   \"CountryCodeISO\": \"SN\",\n   \"Country\": \"Senegal\"\n },\n {\n   \"CountryCode\": \"+381\",\n   \"CountryCodeISO\": \"RS\",\n   \"Country\": \"Serbia\"\n },\n {\n   \"CountryCode\": \"+248\",\n   \"CountryCodeISO\": \"SC\",\n   \"Country\": \"Seychelles\"\n },\n {\n   \"CountryCode\": \"+232\",\n   \"CountryCodeISO\": \"SL\",\n   \"Country\": \"Sierra Leone\"\n },\n {\n   \"CountryCode\": \"+65\",\n   \"CountryCodeISO\": \"SG\",\n   \"Country\": \"Singapore\"\n },\n {\n   \"CountryCode\": \"+421\",\n   \"CountryCodeISO\": \"SK\",\n   \"Country\": \"Slovakia\"\n },\n {\n   \"CountryCode\": \"+386\",\n   \"CountryCodeISO\": \"SI\",\n   \"Country\": \"Slovenia\"\n },\n {\n   \"CountryCode\": \"+677\",\n   \"CountryCodeISO\": \"SB\",\n   \"Country\": \"Solomon Islands\"\n },\n {\n   \"CountryCode\": \"+252\",\n   \"CountryCodeISO\": \"SO\",\n   \"Country\": \"Somalia\"\n },\n {\n   \"CountryCode\": \"+27\",\n   \"CountryCodeISO\": \"ZA\",\n   \"Country\": \"South Africa\"\n },\n {\n   \"CountryCode\": \"+82\",\n   \"CountryCodeISO\": \"KR\",\n   \"Country\": \"South Korea\"\n },\n {\n   \"CountryCode\": \"+34\",\n   \"CountryCodeISO\": \"ES\",\n   \"Country\": \"Spain\"\n },\n {\n   \"CountryCode\": \"+94\",\n   \"CountryCodeISO\": \"LK\",\n   \"Country\": \"Sri Lanka\"\n },\n {\n   \"CountryCode\": \"+249\",\n   \"CountryCodeISO\": \"SD\",\n   \"Country\": \"Sudan\"\n },\n {\n   \"CountryCode\": \"+597\",\n   \"CountryCodeISO\": \"SR\",\n   \"Country\": \"Suriname\"\n },\n {\n   \"CountryCode\": \"+268\",\n   \"CountryCodeISO\": \"SZ\",\n   \"Country\": \"Swaziland\"\n },\n {\n   \"CountryCode\": \"+46\",\n   \"CountryCodeISO\": \"SE\",\n   \"Country\": \"Sweden\"\n },\n {\n   \"CountryCode\": \"+41\",\n   \"CountryCodeISO\": \"CH\",\n   \"Country\": \"Switzerland\"\n },\n {\n   \"CountryCode\": \"+963\",\n   \"CountryCodeISO\": \"SY\",\n   \"Country\": \"Syria\"\n },\n {\n   \"CountryCode\": \"+886\",\n   \"CountryCodeISO\": \"TW\",\n   \"Country\": \"Taiwan\"\n },\n {\n   \"CountryCode\": \"+992\",\n   \"CountryCodeISO\": \"TJ\",\n   \"Country\": \"Tajikistan\"\n },\n {\n   \"CountryCode\": \"+255\",\n   \"CountryCodeISO\": \"TZ\",\n   \"Country\": \"Tanzania\"\n },\n {\n   \"CountryCode\": \"+66\",\n   \"CountryCodeISO\": \"TH\",\n   \"Country\": \"Thailand\"\n },\n {\n   \"CountryCode\": \"+228\",\n   \"CountryCodeISO\": \"TG\",\n   \"Country\": \"Togo\"\n },\n {\n   \"CountryCode\": \"+216\",\n   \"CountryCodeISO\": \"TN\",\n   \"Country\": \"Tunisia\"\n },\n {\n   \"CountryCode\": \"+90\",\n   \"CountryCodeISO\": \"TR\",\n   \"Country\": \"Turkey\"\n },\n {\n   \"CountryCode\": \"+993\",\n   \"CountryCodeISO\": \"TM\",\n   \"Country\": \"Turkmenistan\"\n },\n {\n   \"CountryCode\": \"+256\",\n   \"CountryCodeISO\": \"UG\",\n   \"Country\": \"Uganda\"\n },\n {\n   \"CountryCode\": \"+380\",\n   \"CountryCodeISO\": \"UA\",\n   \"Country\": \"Ukraine\"\n },\n {\n   \"CountryCode\": \"+971\",\n   \"CountryCodeISO\": \"AE\",\n   \"Country\": \"United Arab Emirates\"\n },\n {\n   \"CountryCode\": \"+44\",\n   \"CountryCodeISO\": \"GB\",\n   \"Country\": \"United Kingdom\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"VI\",\n   \"Country\": \"U.S. Virgin Islands\"\n },\n {\n   \"CountryCode\": \"+598\",\n   \"CountryCodeISO\": \"UY\",\n   \"Country\": \"Uruguay\"\n },\n {\n   \"CountryCode\": \"+998\",\n   \"CountryCodeISO\": \"UZ\",\n   \"Country\": \"Uzbekistan\"\n },\n {\n   \"CountryCode\": \"+678\",\n   \"CountryCodeISO\": \"VU\",\n   \"Country\": \"Vanuatu\"\n },\n {\n   \"CountryCode\": \"+58\",\n   \"CountryCodeISO\": \"VE\",\n   \"Country\": \"Venezuela\"\n },\n {\n   \"CountryCode\": \"+84\",\n   \"CountryCodeISO\": \"VN\",\n   \"Country\": \"Vietnam\"\n },\n {\n   \"CountryCode\": \"+967\",\n   \"CountryCodeISO\": \"YE\",\n   \"Country\": \"Yemen\"\n },\n {\n   \"CountryCode\": \"+260\",\n   \"CountryCodeISO\": \"ZM\",\n   \"Country\": \"Zambia\"\n },\n {\n   \"CountryCode\": \"+263\",\n   \"CountryCodeISO\": \"ZW\",\n   \"Country\": \"Zimbabwe\"\n },\n {\n   \"CountryCode\": \"+262\",\n   \"CountryCodeISO\": \"YT\",\n   \"Country\": \"Mayotte\"\n },\n {\n   \"CountryCode\": \"+7\",\n   \"CountryCodeISO\": \"RU\",\n   \"Country\": \"Russian Federation\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"AI\",\n   \"Country\": \"Anguilla\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"AG\",\n   \"Country\": \"Antigua and Barbuda\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"BS\",\n   \"Country\": \"Bahamas\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"BB\",\n   \"Country\": \"Barbados\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"BM\",\n   \"Country\": \"Bermuda\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"VG\",\n   \"Country\": \"British Virgin Islands\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"KY\",\n   \"Country\": \"Cayman Islands\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"DM\",\n   \"Country\": \"Dominica\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"DO\",\n   \"Country\": \"Dominican Republic\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"GD\",\n   \"Country\": \"Grenada\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"GU\",\n   \"Country\": \"Guam\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"JM\",\n   \"Country\": \"Jamaica\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"MS\",\n   \"Country\": \"Montserrat\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"MP\",\n   \"Country\": \"Northern Marianas\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"PR\",\n   \"Country\": \"Puerto Rico\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"KN\",\n   \"Country\": \"Saint Kitts and Nevis\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"LC\",\n   \"Country\": \"Saint Lucia\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"VC\",\n   \"Country\": \"Saint Vincent and the Grenadines\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"TT\",\n   \"Country\": \"Trinidad and Tobago\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"TC\",\n   \"Country\": \"Turks and Caicos Islands\"\n },\n {\n   \"CountryCode\": \"+676\",\n   \"CountryCodeISO\": \"TO\",\n   \"Country\": \"Tonga\"\n },\n {\n   \"CountryCode\": \"+1\",\n   \"CountryCodeISO\": \"US\",\n   \"Country\": \"United States of America\"\n },\n {\n   \"CountryCode\": \"+970\",\n   \"CountryCodeISO\": \"PS\",\n   \"Country\": \"Palestine\"\n },\n {\n   \"CountryCode\": \"+211\",\n   \"CountryCodeISO\": \"SS\",\n   \"Country\": \"South Sudan\"\n },\n {\n   \"CountryCode\": \"+44\",\n   \"CountryCodeISO\": \"IM\",\n   \"Country\": \"Isle of Man\"\n }\n];\n\n\t\t\t\t\n\t\t\t\t\n\n\n\n\n    \t\t\n    \t\t//automatically sort stuff out! :)\n    \t\tif($state.params.verify){\n    \t\t\tToastService.warning('Verification', 'VERIFY?');\n    \t\t\t////console.log(\"SEND VERIFICATION\");\n    \t\t\tUserService.Verify($state.params.user_id, $state.params.verify)\n                .then(function (data) {\n\t    \t\t\t// //console.log(\"SENT VERIFICATION\");\n        //         \t//console.log(data);\n                    if(data.success){\n                    \t$state.go(\"verified\");\n                    } else {\n                    \tToastService.error('Error', data.message);\n                    \t$state.go(\"login\");\n                    }\n                });\n    \t\t}\n\n    \t\tvar loc = $location.path().split(\"/\");\n    \t\tif(loc[loc.length -1] == \"verified\"){\n\n    \t\t\t//alert(\"testing the sent\");\n\n    \t\t\tsendVerification();\n\n    \t\t}\n\n\n    \t\tif($stateParams.token){\n\n    \t\t\t\n    \t\t\tUserService.GetInvite($stateParams.token)\n                .then(function (data) {\n\t    \t\t\t////console.log(\"GETTING TOKEN\", data);\n\n\n                    if(data){\n\n                    \t$scope.total_invite = data;\n                    \t\n                    \t$scope.formData.first_name = data.first_name;\n\t\t    \t\t\t$scope.formData.last_name = data.last_name;\n\t\t    \t\t\t$scope.formData.email = data.email;\n\t\t    \t\t\t$scope.formData.membership_id = data.membership_id;\n\t\t    \t\t\t$scope.formData.club_id = data.club_id;\n\t\t    \t\t\t$scope.formData.to_pay = data.to_pay;\n\t\t    \t\t\t$scope.formData.token = data.invitation_token;\n\n\t\t    \t\t\t//maybe?\n\t\t    \t\t\t$scope.formData.invited_by = data.invited_by;\n\n\t\t    \t\t\tif(data.user_id > 0){\n\t\t    \t\t\t\t// //console.log(\"UID set\", data.user_id);\n\t\t    \t\t\t\t$cookies.put(\"uid\", data.user_id);\n\t\t    \t\t\t}\n\n\t\t    \t\t\t//$cookies.set(\"rid\", data.membership.request.membership_request_id);\n\t\t    \t\t\t//other data::\n\t\t    \t\t\t$scope.payment_now = data.payment_now;\n\t\t    \t\t\t$scope.first_payment = data.first_payment;\n\t\t    \t\t\t$scope.club = data.club;\n\t\t    \t\t\t$scope.membership = data.membership;\n\n\t\t    \t\t\t$scope.all = data;\n\n                    \t////console.log(\"success\");\n                    } else {\n                    \tToastService.error('Invitation Not Found', 'Sorry we were unable to find this invitation. Please try clicking the link again.')\n                    \t$state.go(\"login\");\n                    }\n                });\n\n    \t\t} else {\n    \t\t\t$state.go(\"login\");\n    \t\t}\n\t    \n\t\t    if($cookies.get(\"session\") !== \"\" && $location.search().redirect_flow_id){\n\t\t    \t//console.log(\"let's sort this shizzle out eh?\");\n\n\t\t    \tvar object = {\n                    mandate: $location.search().redirect_flow_id,\n                    session: $cookies.get(\"session\"),\n                    member_accepted: true\n                };\n\n                GoCardService.SetupMandate(object).then(function (data) {\n                    if(data.success){\n                        //vm.requests = data.requests;\n\t\t\t\t\t\t// $cookies.set(\"uid\");\n                        //vm.club = data.club;\n                        // //console.log(\"memberships\", vm.memberships);\n                        //vm.success = true;\n\n                    } else {\n                        // //console.log(\"WOOOPSIES...\");\n                        //vm.success = false;\n                        //this should be very very rare...\n                    }\n\n                });\n\n\t\t    }\n\n\n\t\t    //may need to alter this one to reflect most common one depending on\n\t\t    //the license type\n\t\t    \n\n\t\t    $scope.add_element = function(bit_type){\n\n\t\t    \t//remove from first array\n\t\t    \t$scope[bit_type][bit_type] = $.grep($scope[bit_type][bit_type], function(e){ \n\t\t\t\t\treturn e.id != $scope.formData.license.add_to[bit_type].id; \n\t\t\t\t});\n\n\t\t    \tif(bit_type == \"differences\"){\n\t\t    \t\t$scope.formData.license.add_to[bit_type].day = true;\n\t\t    \t\t$scope.formData.license.add_to[bit_type].vfr = true;\n\t\t    \t}\n\t\t    \t//console.log($scope.formData.license.add_to[bit_type]);\n\n\t\t    \t$scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n\t\t    \t\n\t\t    \t//clean the array to show what we want to show :)\n\t\t    \tdelete $scope.formData.license.add_to[bit_type];\n\n\t\t    }\n\n\t\t    $scope.downloadClubDocument = function(doc) {\n\t            var data = $.param({\n\t                id: doc\n\t            });\n\n\t            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\t            $http.defaults.headers.common['Api-Key'] = \"eW91a25vd25vdGhpbmdqb25zbm93\";\n\n\t            $http.get('api/v1/term_documents/show_file/'+ddd, {\n\t                    responseType: 'arraybuffer'\n\t                })\n\t                .success(function(data, status, headers) {\n\t                    var zipName = processArrayBufferToBlob(data, headers);\n\n\t                    //Delete file from temp folder in server - file needs to remain open until blob is created\n\t                    //deleteFileFromServerTemp(zipName);\n\t                }).error(function(data, status) {\n\t                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n\t                })\n\t        };\n\n\n\t\t    $scope.remove_element = function(bit_type, index){\n\n\t\t \n \t\t\t\t//add to dropdown\n\t\t\t\t$scope[bit_type][bit_type].push($scope.formData.license[bit_type][index]);\n\n\t\t    \n\t\t\t\t$scope.formData.license[bit_type].splice(index,1)\n\n\t\t    \t$scope.formData.license[bit_type] = $scope.formData.license[bit_type].filter(Boolean);\n\t\t    \t//console.log($scope.formData.license[bit_type]);\n\t\t    \t//$scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n\n\t\t    }\n\n\n\n\t\t    function check_user_is_valid(){\n\n\t\t    \tif(\t\t!$scope.formData.first_name \n\t\t    \t\t|| !$scope.formData.last_name \n\t\t    \t\t|| !$scope.formData.email\n\t\t    \t\t|| !$scope.formData.dob\n\t\t    \t\t|| !$scope.formData.password\n\t\t    \t\t|| !$scope.formData.password2){\n\t\t    \t\tToastService.warning('Missing Fields', 'All form fields are required.');\n\n\t\t    \t\t//not all fields are filled in\n\t\t    \t\treturn false;\n\t\t    \t}\n\n\t\t    \tif($scope.formData.password.length < 7){\n\t\t    \t\t//not long enough\n\t\t    \t\tToastService.warning('Password Too Short', 'Password must be more than 7 characters long');\n\t\t    \t\treturn false;\n\t\t    \t}\n\n\t\t    \tif($scope.formData.password !== $scope.formData.password2){\n\t\t    \t\t//passwords do not match\n\t\t    \t\tToastService.warning('Password Mismatch', 'Your passwords do not match.');\n\t\t    \t\treturn false;\n\t\t    \t}\n\n\t\t    \treturn true;\n\t\t    }\n\t\t    \n\n\t\t    $scope.setup_direct_debit = function(){\n\n\n\t\t    \t// //console.log(\"CHECK IS L \", $scope.checkValid(\"verify_account\", 1));\n\n\t\t    \tif($scope.checkValid(\"verify_account\", 1)){\n\n\t\t\t    \tvar to_send = $scope.formData;\n\t\t\t    \tto_send.request_id = $scope.all.membership_request_id;\n\t\t\t    \tto_send.invitation = $stateParams.token;\n\n\t\t\t    \tto_send.payment_now = $scope.payment_now;\n\t\t\t    \tto_send.first_payment = $scope.first_payment;\n\t\t\t    \t// //console.log(\"OBJ = \", to_send);\n\n\t\t\t    \t//return false;\n\t\t\t    \t//send the create user to the invitation\n\t\t\t    \t//create_user\n\t\t\t    \t//expect the gocardless link back\n\t\t\t    \tUserService.InviteSignup(to_send)\n\t\t                .then(function (data) {\n\t\t\t    \t\t\t// //console.log(\"INVITATION BEING SENT NOW...\", data);\n\t\t                    if(data.success){\n\t\t                    \t// //console.log(\"YAY we created stuff\");\n\n\t\t                    \t//store the session::::::\n\t\t                    \t$cookies.put(\"session\", data.mandate.session);\n\n\t\t                    \t////console.log(\"GO TO \"+data.mandate.link);\n\n\t\t                    \twindow.location = data.mandate.link;\n\n\n\t\t                    } else {\n\t\t                    \tToastService.error('Signup Error', 'An error occurred: ' + data.error);\n\t\t                    \treturn false;\n\t\t                    }\n\t\t            });\n\n\t            } else {\n\t            \tToastService.warning('Incomplete Form', 'Please ensure that all fields are complete');\n\t            }\n\n\n\n\n\n\t\t    }\n\n\t\t    $scope.checkValid = function(uisref, gonext=0){\n\t\t    \tif(!uisref || uisref == \"\"){\n\t\t    \t\t//console.log(\"here\");\n\t\t    \t\tuisref = $(\".btn-info\").attr(\"one-ui-sref\");\n\t\t    \t}\n\t\t    \t//console.log($('#signup-form')[0].checkValidity());\n\t\t    \tif(! $('#signup-form')[0].checkValidity()){\n\t\t    \t\t$(\".ng-pristine\").not(\".ng-valid\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n\t\t    \t\t$(\"input:checkbox:not(:checked):required\").addClass(\"ng-checkbox-unchecked\");\n\t\t    \t\t//console.log(\"STOP\");\n\t\t    \t\treturn false;\n\t\t    \t} else {\n\n\t\t    \t\t//console.log(\"HERE\");\n\t\t    \t\t\n\t\t    \t\tif(!check_user_is_valid()){\n\t\t    \t\t\t//console.log(\"missing first bit...\");\n\t\t\t\t    \t$state.go(\"invitations.your_details\");\n\t\t    \t\t\treturn false;\n\t\t    \t\t}\n\t\t    \t\tif(!$scope.formData.nok){\n\t\t    \t\t\t//console.log(\"missing second bit...\");\n\t\t\t\t    \t$state.go(\"invitations.next_of_kin\");\n\t\t    \t\t\treturn false;\n\t\t    \t\t}\n\t\t    \t\t// if(!$scope.formData.club){\n\t\t    \t\t// \t//console.log(\"missing second bit...\");\n\t\t\t\t    // \t$state.go(\"invitations.your_club\");\n\t\t    \t\t// \treturn false;\n\t\t    \t\t// }\n\t\t    \t\tif(!$scope.formData.tnc){\n\t\t\t    \t\t$(\"input:checkbox:not(:checked)\").addClass(\"ng-checkbox-unchecked\");\n\t\t    \t\t} else {\n\t\t    \t\t\t$(\"input:checkbox:not(:checked)\").removeClass(\"ng-checkbox-unchecked\");\n\t\t    \t\t}\n\t\t    \t\tif($scope.formData.password == $scope.formData.password2){\n\t\t\t    \t\tvar next = uisref;\n\t\t\t    \t\tif(gonext == 0){\n\t\t\t    \t\t\tif(next == \"verify_account\"){\n\t\t\t\t    \t\t\t//console.log(\"verifying account\");\n\t\t\t\t    \t\t\t$scope.processForm();\n\t\t\t\t    \t\t} else {\n\t\t\t\t\t    \t\t$state.go(next);\n\t\t\t\t    \t\t}\n\t\t\t    \t\t} else {\n\t\t\t    \t\t\treturn true;\n\t\t\t    \t\t}\n\t\t    \t\t} else {\n\t\t\t    \t\t$(\"input[type='password']\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n\t\t    \t\t\treturn false;\n\t\t    \t\t}\n\n\t\t    \t\t// if(!$scope.formData.user){\n\t\t\t\t    // \t\t$state.go(\"user_signup.your_details\");\n\t\t    \t\t// }\n\t\t    \t\t// if($scope.formData.user.password == $scope.formData.user.password2){\n\t\t    \t\t// \t//console.log(uisref);\n\t\t\t    \t// \t$state.go(uisref);\n\t\t    \t\t// } else {\n\t\t\t    \t// \t$(\"input[type='password']\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n\t\t    \t\t// \treturn false;\n\t\t    \t\t// }\n\t\t    \t}\n\t\t    }\n\n\t\t    $scope.sendVerification = function(){\n\t\t    \tvar user_id = $cookies.get(\"uid\");\n\n\t\t    \tMemberService.VerifyInvitedUser(user_id)\n\t\t                .then(function (data) {\n\t\t                    // //console.log(data);\n\t\t                    if(data.success){\n\t\t                        //use GB airfields first...\n\t\t                        //$scope.verified_mobile = true;\n\n\t\t                        // $scope.link = data.link.url;\n\t\t                    \t// $cookies.put('mid', last);\n\t\t                    \t// $cookies.put('bid', data.bid);\n\n\t\t                    \t$state.go(\"invitations.verified\");\n\n\n\n\t\t                    } else {\n\t\t                    \tToastService.error('Verification Failed', 'Your verification code is incorrect.');\n\t\t                    }\n\n\t\t                });\n\t\t    }\n\n\n\t\t    function sendVerification(){\n\n\t\t    \tvar user_id = $cookies.get(\"uid\");\n\n\t\t    \tMemberService.VerifyInvitedUser(user_id)\n\t\t                .then(function (data) {\n\t\t                    // //console.log(data);\n\t\t                    if(data.success){\n\t\t                        //use GB airfields first...\n\t\t                        //$scope.verified_mobile = true;\n\n\t\t                        // $scope.link = data.link.url;\n\t\t                    \t// $cookies.put('mid', last);\n\t\t                    \t// $cookies.put('bid', data.bid);\n\n\t\t                    \t$state.go(\"invitations.verified\");\n\n\n\n\t\t                    } else {\n\t\t                    \tToastService.error('Verification Failed', 'Your verification code is incorrect.');\n    \t\t\t\t\t\t\t//$scope.verified_mobile = false;\n\t\t                    }\n\n\t\t                });\n\n\t\t    }\n\n\n\t\t    $scope.verify_mobile = function(value){\n\t\t    \tvar val = value.text_verification;\n    \t\t\t////console.log(\"called\", value.text_verification);\n    \t\t\t////console.log(\"called\", $scope.text_verification);\n\n    \t\t\tif(val.length == 6){\n    \t\t\t\t//then we check\n\n    \t\t\t\t// //console.log(\"4 chars\", vm.text_verification);\n    \t\t\t\t// //console.log(\"4 chars\", last);\n\n    \t\t\t\t//VerifyInvitedUser\n\n    \t\t\t\tMemberService.VerifyPhoneInvite(val, $cookies.get(\"uid\"))\n\t\t                .then(function (data) {\n\t\t                    // //console.log(data);\n\t\t                    if(data && data.success){\n\t\t                        //use GB airfields first...\n\t\t                        $scope.verified_mobile = true;\n\n\t\t                        //$scope.link = data.link.url;\n\t\t                    \t// $cookies.put('mid', last);\n\t\t                    \t// $cookies.put('bid', data.bid);\n\n\n\n\n\t\t                    } else {\n\t\t                    \tToastService.error('Verification Failed', 'Your verification code is incorrect.');\n\t\t                    }\n\n\t\t                });\n\n    \t\t\t\t// if(text_verification == \"1234\"){\n\n    \t\t\t\t// \t$scope.verified_mobile = true;\n    \t\t\t\t// }\n\n    \t\t\t} else {\n    \t\t\t\t//do nothing\n    \t\t\t}\n\n    \t\t}\n\n    \t\tfunction titlepath(path,name){\n\n        //In this path defined as your pdf url and name (your pdf name)\n            var prntWin = window.open();\n            prntWin.document.write(\"<html><head><title>\"+name+\"</title></head><body>\"\n                + '<embed width=\"100%\" height=\"100%\" name=\"plugin\" src=\"'+ path+ '\" '\n                + 'type=\"application/pdf\" internalinstanceid=\"21\"></body></html>');\n            prntWin.document.close();\n        }\n\n    \t\tfunction processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], {\n                    //type: contentType\n                    type: 'application/pdf'\n                });\n\n                var fileURL = URL.createObjectURL(blob);\n                titlepath(fileURL, \"Secure Documents\");\n\n                // if (navigator.msSaveBlob)\n                //     navigator.msSaveBlob(blob, filename);\n                // else {\n                //     // Try using other saveBlob implementations, if available\n                //     var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                //     if (saveBlob === undefined) throw \"Not supported\";\n                //     saveBlob(blob, filename);\n                // }\n                success = true;\n            } catch (ex) {\n                console.info(\"saveBlob method failed with the following exception:\");\n                console.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            console.info(\"Download link method with simulated click failed with the following exception:\");\n                            console.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n\n\n\t\t    // function to process the form\n\t\t    $scope.processForm = function() {\n\t\t        \n\t\t    \t//basic checks of what is being sent should be added here....\n\t\t        UserService.InviteSignup($scope.formData)\n\t                .then(function (data) {\n\t\t    \t\t\t//console.log(\"INVITATION BEING SENT NOW...\", data);\n\n\n\t                    if(data){\n\t                    \t//console.log(\"success\");\n\t                    \tToastService.success('Success', 'All good to go!');\n\t                    \t$state.go(\"invitations.verified\");\n\t                    } else {\n\t                    \tToastService.error('Invitation Not Found', 'Sorry we were unable to find this invitation. Please try clicking the link again.')\n\t                    \t$state.go(\"login\");\n\t                    }\n\t                });\n\n\n\n\n\n\n\n\n\t\t    };\n\n    }\napp.controller('KeywordController', KeywordController);\n \n    KeywordController.$inject = ['KeywordsService', 'UserService', 'JSTagsCollection', '$scope'];\n    function KeywordController(KeywordsService, UserService, JSTagsCollection, $scope) {\n            \n\n        var vm = this;\n\n          // Export jsTags options, inlcuding our own tags object\n          \n\n          // **** Typeahead code **** //\n\n          // Build suggestions array\n\n          // var suggestions = [];\n\n            \n          \n\n                    $scope.tags = new JSTagsCollection();\n\n                    $scope.jsTagOptions = {\n                        'tags': $scope.tags \n                      };\n\n\n                    //var suggestions = [{\"id\":1,\"keyword\":\"hello\",\"updated_at\":\"2015-10-19 16:23:04\",\"created_at\":\"0000-00-00 00:00:00\"},{\"id\":2,\"keyword\":\"alex\",\"updated_at\":\"2015-10-19 16:23:04\",\"created_at\":\"0000-00-00 00:00:00\"}];\n                     // var suggestions = ['jsTag', 'c#', 'java', 'javascript', 'jquery', 'android' , 'php', 'c++', 'python', 'ios', 'mysql', 'iphone', 'sql', 'html', 'css', 'objective-c', 'ruby-on-rails', 'c', 'sql-server', 'ajax', 'xml', '.net', 'ruby', 'regex', 'database', 'vb.net', 'arrays', 'eclipse', 'json', 'django', 'linux', 'xcode', 'windows', 'html5', 'winforms', 'r', 'wcf', 'visual-studio-2010', 'forms', 'performance', 'excel', 'spring', 'node.js', 'git', 'apache', 'entity-framework', 'asp.net', 'web-services', 'linq', 'perl', 'oracle', 'action-script', 'wordpress', 'delphi', 'jquery-ui', 'tsql', 'mongodb', 'neo4j', 'angularJS', 'unit-testing', 'postgresql', 'scala', 'xaml', 'http', 'validation', 'rest', 'bash', 'django', 'silverlight', 'cake-php', 'elgg', 'oracle', 'cocoa', 'swing', 'mocha', 'amazon-web-services'];\n                     // suggestions = suggestions.map(function(item) { //console.log(item);  return { \"suggestion\": item } });\n                   \n                    //   //console.log(\"HELO\");\n                    // //console.log(suggestions);\n\n\n                      // Instantiate the bloodhound suggestion engine\n                       var suggestions = new Bloodhound({\n                        datumTokenizer: function(obj) { return Bloodhound.tokenizers.whitespace(obj.keyword); },\n                        identify: function(obj) { return obj.keyword; },\n                        queryTokenizer: Bloodhound.tokenizers.whitespace,\n                        prefetch: '/api/v1/keywords'\n                      });\n\n                      // Initialize the bloodhound suggestion engine\n                      suggestions.initialize();\n\n                      \n\n\n                      // Single dataset example\n                      $scope.exampleData = {\n                        displayKey: 'keyword',\n                        source: suggestions.ttAdapter()\n                      };\n\n                      // Typeahead options object\n                      $scope.exampleOptions = {\n                        hint: false,\n                        highlight: true\n                      };\n           \n                      $scope.CheckContent = function(){\n                        //console.log(\"CLICK\");\n                        //console.log($scope.tags.tags);\n                      }\n                   \n         \n       \n\n    }\napp.controller('KeywordsController', KeywordsController);\n \n    KeywordsController.$inject = ['UserService', 'KeywordsService', '$location', '$rootScope', 'FlashService', '$routeParams', '$scope'];\n    function KeywordsController(UserService, KeywordsService, $location, $rootScope, FlashService, $routeParams, $scope) {\n        var vm = this;\n\n         KeywordsService.GetAll()\n                .then(function (data) {\n                    vm.keywords = data;\n                });\n\n       \tvm.id = 1;\n       \tvm.myModel = 'Click here and delete me';\n\t\t$scope.myUpdateHandler = function(id, keyword){\n\t\t  // check your console\n\t\t  //console.log('value of '+id+' your model is now: ' + keyword);\n\t\t  var update = {\"id\": id, \"keyword\": keyword};\n\t\t  KeywordsService.Update(update)\n                .then(function (data) {\n                    //console.log(\"SAVED :)\");\n                });\n\t\t};\n\n\t\t$scope.addKeyword = function(){\n\t\t\t//console.log(\"ADD ONE \"+vm.new_keyword);\n\t\t\t//need to call the outside world here and now :0\n\t\t\tvar add_one = {\"keyword\": vm.new_keyword};\n\t\t\tKeywordsService.Create(add_one)\n                .then(function (data) {\n                    vm.keywords.push(data);\n                    //reset\n\t\t\t\t\tvm.new_keyword = \"\";\n                });\n\t\t}\n\n\t\t$scope.deleteKeyword = function(id){\n\n\t\t\tKeywordsService.Delete(id)\n                .then(function (data) {\n\n                    vm.keywords = $.grep(vm.keywords, function(e){ \n\t\t\t\t\t     return e.id != id; \n\t\t\t\t\t});\n\n                });\n\t\t}\n\n    }\napp.controller('LoginController', LoginController);\n \n    LoginController.$inject = ['$location', 'AuthenticationService', 'FlashService', '$timeout', 'ToastService'];\n    function LoginController($location, AuthenticationService, FlashService, $timeout, ToastService) {\n        var vm = this;\n \n        vm.login = login;\n\n        vm.login_session;\n        vm.login_key;\n \n        (function initController() {\n            // reset login status\n            //AuthenticationService.ClearCredentials();\n            var check = AuthenticationService.CheckLoggedIn();\n            if(check){\n                $location.path('/dashboard');\n            } else {\n                AuthenticationService.ClearCredentials();\n            }\n\n\n            AuthenticationService.Login0( function (response) {\n                if (response.success) {\n                    // //console.log(\"HELLO success\", response.login_session);\n                    // AuthenticationService.SetCredentials(vm.email, vm.password, response.user, response.session);\n                    // setTimeout(function(){\n                    //     $location.path('/dashboard');\n                    // }, 20);\n\n                    vm.login_session = response.login_session;\n\n                } else {\n                    vm.error = response.error || 'Unable to initialise login. Please refresh the page.';\n                    vm.dataLoading = false;\n                }\n            });\n\n\n            // AuthenticationService.Login1(\"thisisuser\", \"session\", function (response) {\n            //     if (response.success) {\n            //         //console.log(\"HELLO success\", response);\n            //         // AuthenticationService.SetCredentials(vm.email, vm.password, response.user, response.session);\n            //         // setTimeout(function(){\n            //         //     $location.path('/dashboard');\n            //         // }, 20);\n            //     } else {\n            //         //console.log(\"HELLO FAIL\", response);\n            //         //FlashService.Error(response.error);\n            //         // vm.error = response.error;\n            //         // vm.dataLoading = false;\n            //     }\n            // });\n\n\n\n\n\n\n        })();\n\n\n\n       \n \n        function login() {\n\n            //  Pre-submit validation with highlight + scroll \n            if (!vm.email || vm.email.trim() === '') {\n                ToastService.highlightField('email');\n                ToastService.warning('Email Required', 'Please enter your email address.');\n                return;\n            }\n            if (!vm.password || vm.password === '') {\n                ToastService.highlightField('password');\n                ToastService.warning('Password Required', 'Please enter your password.');\n                return;\n            }\n\n            vm.dataLoading = true;\n            vm.error = null;\n\n            AuthenticationService.Login1(vm.email, vm.login_session, function (response) {\n                if (response.success) {\n                    // //console.log(\"HELLO success\", response);\n                    // AuthenticationService.SetCredentials(vm.email, vm.password, response.user, response.session);\n                    // setTimeout(function(){\n                    //     $location.path('/dashboard');\n                    // }, 20);\n\n                    var login_key = response.login_key;\n\n\n                    //if success --> THEN we do the next bit\n                    AuthenticationService.Login2(vm.password, login_key, function (response) {\n                    if (response.success) {\n                        // //console.log(\"HELLO success\", response);\n                        // AuthenticationService.SetCredentials(vm.email, vm.password, response.user, response.session);\n                        // setTimeout(function(){\n                        //     $location.path('/dashboard');\n                        // }, 20);\n\n\n                        //if success --> THEN we do the next bit\n\n                        // Timeout fallback: if SetCredentials2 takes too long (e.g., API hanging),\n                        // redirect to dashboard anyway after 10 seconds\n                        var loginTimeoutFired = false;\n                        var loginTimeout = $timeout(function() {\n                            if (!loginTimeoutFired) {\n                                loginTimeoutFired = true;\n                                console.warn('Login timeout - proceeding to dashboard');\n                                $location.path('/dashboard');\n                            }\n                        }, 10000);\n\n                        AuthenticationService.SetCredentials2(vm.email, vm.password, response.user, response.session, function(response){\n                            // Cancel the timeout since callback completed\n                            if (loginTimeout) {\n                                $timeout.cancel(loginTimeout);\n                            }\n                            if (loginTimeoutFired) {\n                                // Timeout already fired, don't redirect again\n                                return;\n                            }\n                            loginTimeoutFired = true;\n\n                            // //console.log(\"TWO :: \", response);\n                             // setTimeout(function(){\n\n                                 // Check for a stored return URL from a prior auto-logout\n                                 var returnUrl = null;\n                                 try { returnUrl = localStorage.getItem('toaviate_return_url'); } catch(e) {}\n                                 if (returnUrl) {\n                                     try { localStorage.removeItem('toaviate_return_url'); } catch(e) {}\n                                     // Wait for credentials/session to fully propagate before navigating\n                                     $timeout(function(){\n                                         $location.path(returnUrl);\n                                     }, 1000);\n                                 } else if(response && response.access && (response.access.instructor.length > 0 || response.access.manager.length > 0)){\n                                     $location.path('/dashboard');\n                                 } else if(response) {\n                                     $location.path('/dashboard/my_account');\n                                 } else {\n                                     vm.error = 'Login succeeded but we could not load your access level. Please try again.';\n                                     vm.dataLoading = false;\n                                 }\n\n                                \n                            // }, 20);\n                        });\n                       \n\n\n\n\n\n\n\n                    } else {\n                        ToastService.highlightField('password');\n                        ToastService.error('Login Failed', response.error || 'Invalid password. Please try again.');\n                        vm.error = response.error;\n                        vm.dataLoading = false;\n                    }\n                });\n\n\n\n\n\n\n\n\n                } else if (response.error === \"The login session has expired - please try again\") {\n                    // Session expired  refresh login0 and retry automatically\n                    AuthenticationService.Login0(function (login0Response) {\n                        if (login0Response.success) {\n                            vm.login_session = login0Response.login_session;\n                            // Retry login1 with the fresh session\n                            login();\n                        } else {\n                            vm.error = login0Response.error || 'Unable to refresh login session. Please refresh the page.';\n                            vm.dataLoading = false;\n                        }\n                    });\n                } else {\n                    ToastService.highlightField('email');\n                    ToastService.error('Login Failed', response.error || 'Email not recognised. Please check and try again.');\n                    vm.error = response.error;\n                    vm.dataLoading = false;\n                }\n            });\n\n\n\n\n\n\n\n\n            // vm.dataLoading = true;\n            // AuthenticationService.Login(vm.email, vm.password, function (response) {\n            //     if (response.success) {\n            //         AuthenticationService.SetCredentials(vm.email, vm.password, response.user, response.session);\n            //         setTimeout(function(){\n            //             $location.path('/dashboard');\n            //         }, 20);\n            //     } else {\n            //         //FlashService.Error(response.error);\n            //         vm.error = response.error;\n            //         vm.dataLoading = false;\n            //     }\n            // });\n        };\n\n        function logout(){\n            // reset login status\n            AuthenticationService.ClearCredentials();\n        }\n\n\n    }\n app.controller('ManageAccountController', ManageAccountController);\n\n    ManageAccountController.$inject = ['UserService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'BookingService', 'PaymentService', 'ToastService'];\n    function ManageAccountController(UserService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, BookingService, PaymentService, ToastService) {\n        \n        var vm = this;\n        vm.user = $rootScope.globals.currentUser;\n        //vm.user_id = vm.user.id;\n        vm.avatar = \"\";\n        vm.address = \"Please choose address...\";\n        vm.user.address_line1 = \"Please choose\";\n        vm.addresses = {};\n        vm.show_addresses = false;\n        vm.show_address = false;\n        vm.show_search = false;\n\n\n        UserService.GetById(vm.user.id)\n                .then(function (data) {\n                    if(data.success){\n                        data.user.dob = new Date(data.user.dob);\n                        vm.user = data.user;\n\n                        if(vm.user.address_line1 !== \"\"){\n                            vm.show_address = true;\n                            vm.show_search = false;\n                            vm.show_addresses = false;\n                        }\n\n                        // //console.log(\"NOK\", vm.user);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n                });\n\n\n        $scope.processFiles = function(files){\n\n            for(var i=0; i<files.length; i++){\n                // //console.log(\"JSON\", files[i].file_return);\n                var j = JSON.parse(files[i].file_return);\n                // //console.log(\"PARSED\", j);\n                files[i].file.temp_path = j.saved_url;\n                // //console.log(\"file\", files[i].file);\n                vm.avatar = files[i].file;\n                vm.user.avatar = vm.avatar.temp_path;\n                vm.user.update_avatar = true;\n                // //console.log(vm.avatar);\n            }\n           \n        }\n\n\n        $scope.show_form = function(){\n            // //console.log(\"show form\");\n            vm.show_address = true;\n        }\n\n        $scope.set_address = function(){\n            // //console.log(\"set address\");\n\n            vm.user.address_line1 = vm.address.line1;\n            vm.user.address_line2 = vm.address.line2;\n            vm.user.address_line3 = vm.address.line3;\n            vm.user.address_line4 = vm.address.line4;\n            vm.user.address_postcode = vm.address.postcode;\n            vm.user.address_locality = vm.address.locality;\n            vm.user.address_city = vm.address.city;\n            vm.user.address_county = vm.address.county;\n            vm.user.address_country = vm.address.country;\n\n            vm.show_address = true;\n\n        }\n\n        $scope.get_addresses = function(){\n\n            vm.address = {};\n\n            //  trial key\n            //  auth: api-key: BP-8KOdw8ka3F2eDU-Zz-g5865   \n            //  https://api.getAddress.io/v2/uk/{postcode}\n            // PaymentService.getAddress()\n\n            PaymentService.GetAddresses(vm.postcode)\n                .then(function (data) {\n                    if(data.success){\n\n                        // //console.log(\"addresses: \"+data.addresses);\n                        vm.addresses = data.addresses;\n\n                        if(vm.addresses && vm.addresses.length > 0){\n                            vm.show_addresses = true;\n                        } else {\n                            ToastService.warning('Address Lookup', \"We couldn't find your address from your postcode, please enter it manually\");\n                            vm.show_addresses = false;\n                            vm.show_address = true;\n                        }\n                        //fill the drop down menu\n\n                    } else {\n                        // //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                        ToastService.warning('Address Lookup', \"We couldn't find your address from your postcode, please enter it manually\");\n                        vm.show_addresses = false;\n                        vm.show_address = true;\n\n                    }\n                });\n\n\n\n        }\n\n\n\n        \n        $scope.save_user = function(valid){\n\n            // //console.log(\"VALID\", valid);\n\n            if(valid){\n                //now let's double check the content of the form\n\n\n                //avatar - not required --> check if updated\n                //above not required i don't think\n                if(!vm.user.update_avatar){\n                    delete vm.user.avatar;\n                }\n\n                //phone number\n                if(!vm.user.phone_number || vm.user.phone_number == \"\"){\n                    ToastService.highlightField('phone_number');\n                    ToastService.warning('Validation Error', 'Please enter a mobile phone number');\n                    return false;\n                }\n\n                //updated_password\n                if(vm.user.new_password){\n                    if(vm.user.new_password !== vm.user.new_password2){\n                        ToastService.highlightField('new_password2');\n                        ToastService.warning('Password Mismatch', 'Please ensure your updated passwords match');\n                        return false;\n                    } else {\n\n\n                          //lets add complexity here :-)\n                           var strongPassword = new RegExp('(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[^A-Za-z0-9])(?=.{8,})')\n                            if(strongPassword.test(vm.user.new_password)) {\n                              //console.log(\"password strength OK\");\n                            } else {\n                              vm.show_error = true;\n                              ToastService.highlightField('new_password');\n                              ToastService.warning('Weak Password', 'Your password must be at least 8 characters in length, contain 1 uppercase, 1 lowercase, 1 number, and 1 special character');\n                              return false;\n                            }\n\n\n                       // if(vm.user.new_password.length > 7){\n                       //      //at the moment this will suffice!\n                       //      // //console.log(\"Password basic tests are OK to send!\")\n\n\n                       // } else {\n                       //      alert(\"Password must be at least 8 characters\");\n                       //      return false;\n                       // }\n\n                    }\n                }\n\n\n\n\n\n                //current password to save changes\n                if(!vm.user.password){\n                    ToastService.highlightField('password');\n                    ToastService.warning('Password Required', 'Please enter your current password to ensure that these changes are made by you.');\n                    return false;\n                }\n\n\n                //if we get here then at least we know to a certain degree that everything is working as we expect.\n                 UserService.Update(vm.user)\n                    .then(function (data) {\n                        if(data.success){\n                            ToastService.success('Account Updated', 'Changes updated successfully.');\n                            $state.go('dashboard.my_account', {}, { reload: true });\n\n                        } else {\n                            if(data.message == \"Password entered failed\"){\n                                ToastService.error('Incorrect Password', 'The password entered was incorrect');\n                            } else {\n                                ToastService.error('Update Failed', 'Something horrible happened!');\n                            }\n                            //this should be very very rare...\n                        }\n                    });\n\n\n\n            } else {\n\n                // //console.log(\"something went wrong here...\");\n\n            }\n\n\n        }\n        \n        \n\n\n    }\n app.controller('ManageDifferencesController', ManageDifferencesController);\n\n    ManageDifferencesController.$inject = ['UserService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'BookingService', 'DifferencesService', 'ToastService'];\n    function ManageDifferencesController(UserService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, BookingService, DifferencesService, ToastService) {\n        \n        var vm = this;\n\n         DifferencesService.GetDifferences()\n                .then(function (data) {\n                    // //console.log(data);\n                        vm.all_differences = data;\n                });\n\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n          DifferencesService.GetByUserId(vm.user.id)\n                .then(function (data) {\n                        var diff = data.differences.differences;\n                        for(var i=0;i<diff.length;i++){\n                            if(diff[i].sign_off_date == \"0000-00-00\"){\n                               delete diff[i].sign_off_date;\n                            }\n                            diff[i].sign_off_date = new Date(diff[i].sign_off_date);\n                            diff[i].day = (diff[i].day == 1)? true : false;\n                            diff[i].night = (diff[i].night == 1)? true : false;\n                            diff[i].vfr = (diff[i].vfr == 1)? true : false;\n                            diff[i].ifr = (diff[i].ifr == 1)? true : false;\n                        }\n                        data.differences.differences = diff;\n                        vm.differences = data.differences;\n                        // //console.log(\"GET DIFFS\", vm.differences);\n                        clean_differences_list();\n\n                });\n\n        vm.differences = {\n            images: [],\n            differences: [],\n            user_id: vm.user.id\n        };\n\n        vm.differences_images = [];\n        \n\n        function clean_differences_list(){\n            // //console.log(\"HIT\");\n            if(vm.differences.differences.length > 0){\n                // //console.log(\"got > 0 diffs\");\n                 for(var i=0;i<vm.differences.differences.length;i++){\n                    // //console.log(\"i : \", i);\n                    vm.all_differences = $.grep(vm.all_differences, function(el){ \n                        return el.id != vm.differences.differences[i].differences_id; \n                    });\n\n                 }\n                 \n            }\n\n           \n        }\n\n\n\n         $scope.add_differences = function(){\n\n                //remove from first array\n                if(vm.selected_differences){\n                    vm.all_differences = $.grep(vm.all_differences, function(el){ \n                        return el.id != vm.selected_differences.id; \n                    });\n\n                    vm.selected_differences.day = true;\n                    vm.selected_differences.vfr = true;\n\n\n                    vm.differences.differences.push(vm.selected_differences);\n\n                    //clear selected\n                    delete vm.selected_differences;\n                }\n                \n                \n                //clean the array to show what we want to show :)\n                //delete $scope.formData.license.add_to[bit_type];\n\n            }\n\n            $scope.remove_differences = function(index){\n\n                //add to dropdown\n                vm.all_differences.push(vm.differences.differences[index]);\n                vm.differences.differences.splice(index,1)\n\n                //$scope.formData.license[bit_type] = $scope.formData.license[bit_type].filter(Boolean);\n\n                //  //console.log($scope.formData.license[bit_type]);\n                //  $scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n            }\n\n\n\n            $scope.popup = [];\n\n            $scope.open = function(id, $event) {\n                // //console.log(\"THIS\", id);\n                //this comment would allow the event not to be affect by clicking it again... not sure this is a good idea\n                if($scope.popup[id] && $scope.popup[id].opened == true){\n                    $event.preventDefault();\n                    $event.stopPropagation();\n                } else {\n                    $scope.popup[id] = {opened: true};\n                }\n            };\n\n            $scope.formats = ['dd/MM/yyyy', 'yyyy/MM/dd', 'dd.MM.yyyy', 'shortDate'];\n            $scope.format = $scope.formats[0];\n\n            $scope.datePickerOptions = {\n                                        format: 'dd/MM/yyyy',\n                                        showWeeks: false\n                                    };\n\n           \n\n           $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.differences.images = $.grep(vm.differences.images, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                \n\n          }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            // //console.log(\"REMOVE: \", j);\n            // //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            LicenceService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        // //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.licence_images = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        // //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n            $scope.processFiles = function(files){\n                 // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    files[i].file.temp_path = j.saved_url;\n                    // //console.log(\"file\", files[i].file);\n                    vm.differences_images.push(files[i].file);\n                }\n\n                //    for(var i=0; i<files.length; i++){\n                //     // //console.log(\"JSON\", files[i].file_return);\n                //     var j = JSON.parse(files[i].file_return);\n                //     // //console.log(\"PARSED\", j);\n                //     files[i].file.temp_path = j.saved_url;\n                //     // //console.log(\"file\", files[i].file);\n                //     vm.poid_images.push(files[i].file);\n                // }\n\n               \n            }\n\n        \n        $scope.save_differences = function(){\n\n\n                if(vm.differences_images.length < 1 && vm.differences.images.length < 1){\n\n                    ToastService.highlightField('.drop');\n                    ToastService.warning('Image Required', 'You must at least have 1 image of the differences page of your log book!');\n\n                    return false;   \n                }\n\n\n                if(vm.differences.differences.length < 1){\n\n                    ToastService.highlightField('differences');\n                    ToastService.warning('Differences Required', 'You must at least have 1 differences to be able to save the image(s) above!');\n                    \n                    return false;   \n                }\n\n\n\n\n                //compile the required elements YAY\n\n                // //console.log(\"differences GOOD TO GO \", vm.differences);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n\n                    for(var i=0;i<vm.differences.images.length;i++){\n                        delete vm.differences.images[i].data_uri;\n                    }\n                    vm.differences.user_id = vm.user.id;\n                    vm.differences.images = vm.differences.images.concat(vm.differences_images);\n\n                    // vm.licence.images = vm.licence_images;\n                   \n\n                    \n                    //then its an udpate\n                    //merge the images left?\n                    DifferencesService.Update(vm.differences)\n                        .then(function (data) {\n                            // //console.log(data);\n                            if(data.success){\n                               \n                                ToastService.success('Differences Saved', 'Differences saved successfully!');\n                                $state.go('dashboard.my_account', {}, { reload: true });\n\n\n                            } else {\n\n                                ToastService.error('Save Failed', 'Something went terribly wrong: ' + data.message);\n\n                            }\n                        });\n\n\n            };\n\n    }\n app.controller('ManageLicenceController', ManageLicenceController);\n\n    ManageLicenceController.$inject = ['UserService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'BookingService', 'LicenceService', 'AuthenticationService', 'ToastService'];\n    function ManageLicenceController(UserService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, BookingService, LicenceService, AuthenticationService, ToastService) {\n        \n        var vm = this;\n        vm.licence_images = [];\n        vm.licence = {\n                images: [],\n                ratings: []\n        };\n\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n        LicenceService.GetLicenceTypes()\n                .then(function (data) {\n                    vm.licence_types = data;\n                    // //console.log(\"licence_types: \", vm.licence_types);\n                });\n\n        LicenceService.GetRatings()\n            .then(function (data) {\n                vm.ratings = data;\n                // //console.log(\"ratings: \", vm.ratings);\n\n                if($state.current.data.action == \"add\"){\n\n                    vm.selected_rating = $.grep(vm.ratings, function(e){ return e.id == 7; })[0];\n                    $scope.add_rating();\n\n                    // for(var i=0;i<vm.ratings.length; i++){\n                    //     //console.log(\"LOOP\", vm.ratings[i]);\n                    //     if(vm.ratings[i].id == 7){\n                    //         vm.selected_rating = vm.ratings[i];\n                    //         //console.log(\"FOUND\", vm.selected_rating);\n                    //         $scope.add_rating();\n                    //         break;\n                    //     }\n                    // }\n                }\n               \n\n\n            });\n\n        LicenceService.GetAuthority()\n            .then(function (data) {\n                vm.authority = data;\n                // //console.log(\"authority: \", vm.authority);\n            });\n\n\n        switch($state.current.data.action){\n            case \"add\":\n\n                    //vm.selected_rating = vm.ratings[0];\n                    //vm.selected_rating = \n                    \n\n                    // //console.log(\"AA\", vm.selected_rating);\n\n            \n\n            break;\n            case \"edit\":\n\n            // //console.log(\"EDIT ONE\");\n            // //console.log(\"PARAMS: \", $stateParams);\n\n             LicenceService.GetById($stateParams.licence_id, 1, 0)\n                .then(function (data) {\n                    if(data.success){\n                        vm.licence = data.licence;\n                        vm.licence.licence_issue_date = new Date(vm.licence.licence_issue_date);\n                        vm.licence.licence_expiry_date = new Date(vm.licence.licence_expiry_date);\n                        // //console.log(\"licence\", vm.licence);\n\n                        vm.licence.licence_type = $.grep(vm.licence_types, function(e){ return e.id == vm.licence.licence_id; })[0];\n                        vm.licence.state_of_issue = $.grep(vm.authority, function(e){ return e.id == vm.licence.authority_id; })[0];\n                        // //console.log(\"SET\", vm.licence.state_of_issue);\n\n                        //pre-selection bits?\n                        // //console.log(\"NEW RATINGS\", vm.licence.ratings);\n                        for(var i=0;i<vm.licence.ratings.length;i++){\n                            delete vm.licence.ratings[i].id;\n                            vm.licence.ratings[i].id = vm.licence.ratings[i].rating_id;\n                            delete vm.licence.ratings[i].rating_id;\n                            vm.licence.ratings[i].test_date = new Date(vm.licence.ratings[i].test_date);\n                            vm.licence.ratings[i].expiry_date = new Date(vm.licence.ratings[i].expiry_date);\n\n                            //need to remove the rating from the ratings lists too :)\n                            vm.ratings = $.grep(vm.ratings, function(e){ \n                                return e.id != vm.licence.ratings[i].id; \n                            });\n\n                        }\n\n\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n\n            break;\n            case \"list\":\n\n                // //console.log(\"LIST ALL\");\n\n                 //1 get the user's licence...\n                 //list stuff\n\n                LicenceService.GetByUserId(vm.user.id)\n                .then(function (data) {\n                    // //console.log(data);\n                    if(data.success){\n                        vm.user_licences = data.licences;\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n\n\n            $scope.add_rating = function(){\n\n                //remove from first array\n                vm.ratings = $.grep(vm.ratings, function(e){ \n                    return e.id != vm.selected_rating.id; \n                });\n\n                vm.licence.ratings.push(vm.selected_rating);\n\n                //clear selected\n                delete vm.selected_rating;\n                \n                //clean the array to show what we want to show :)\n                //delete $scope.formData.license.add_to[bit_type];\n\n            }\n\n            $scope.remove_rating = function(index){\n\n                //add to dropdown\n                vm.ratings.push(vm.licence.ratings[index]);\n                vm.licence.ratings.splice(index,1)\n\n                //$scope.formData.license[bit_type] = $scope.formData.license[bit_type].filter(Boolean);\n\n                //  //console.log($scope.formData.license[bit_type]);\n                //  $scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n            }\n\n            //default add the first rating required...\n            \n\n\n\n/*\n\nOLD VERSION FOR LEGACY PURPOSES\n\n  $scope.add_element = function(bit_type){\n\n                //remove from first array\n                $scope[bit_type][bit_type] = $.grep($scope[bit_type][bit_type], function(e){ \n                    return e.id != $scope.formData.license.add_to[bit_type].id; \n                });\n\n                if(bit_type == \"differences\"){\n                    $scope.formData.license.add_to[bit_type].day = true;\n                    $scope.formData.license.add_to[bit_type].vfr = true;\n                }\n                //console.log($scope.formData.license.add_to[bit_type]);\n\n                $scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n                \n                //clean the array to show what we want to show :)\n                delete $scope.formData.license.add_to[bit_type];\n\n            }\n\n\n            $scope.remove_element = function(bit_type, index){\n\n                //add to dropdown\n                $scope[bit_type][bit_type].push($scope.formData.license[bit_type][index]);\n            \n                $scope.formData.license[bit_type].splice(index,1)\n\n                $scope.formData.license[bit_type] = $scope.formData.license[bit_type].filter(Boolean);\n                //console.log($scope.formData.license[bit_type]);\n                //$scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n            }\n\n\n*/\n\n\n            //nice looking date pickers\n\n\n            $scope.popup = [];\n\n            $scope.open = function(id, $event) {\n                // //console.log(\"THIS\", id);\n                //this comment would allow the event not to be affect by clicking it again... not sure this is a good idea\n                if($scope.popup[id] && $scope.popup[id].opened == true){\n                    $event.preventDefault();\n                    $event.stopPropagation();\n                } else {\n                    $scope.popup[id] = {opened: true};\n                }\n            };\n\n            $scope.formats = ['dd/MM/yyyy', 'yyyy/MM/dd', 'dd.MM.yyyy', 'shortDate'];\n            $scope.format = $scope.formats[0];\n\n            $scope.datePickerOptions = {\n                                        format: 'dd/MM/yyyy',\n                                        showWeeks: false\n                                    };\n\n           \n\n           $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.licence.images = $.grep(vm.licence.images, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                \n\n          }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            // //console.log(\"REMOVE: \", j);\n            // //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            LicenceService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    // //console.log(data);\n                    if(data.success){\n                        // //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.licence_images = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        // //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n            $scope.processFiles = function(files){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    files[i].file.temp_path = j.saved_url;\n                    // //console.log(\"file\", files[i].file);\n                    vm.licence_images.push(files[i].file);\n                }\n               \n            }\n\n\n\n            $scope.delete_licence = function(id){\n\n\n                var a = prompt(\"Are you sure you wish to delete this licence? \\n\\n This change is irreversible! To confirm please type YES in the box below.\");\n                if(a == \"YES\"){\n                    // //console.log(\"WE DELETE IT\");\n\n\n                    LicenceService.Delete(vm.user.id, id)\n                        .then(function (data) {\n                            // //console.log(data);\n                            if(data.success){\n                                // //console.log(\"HUZZAH\", data);\n                                //then we need to remove this from the list of files...\n                                vm.user_licences = $.grep(vm.user_licences, function(e){ \n                                    return e.id != id; \n                                });\n                                \n                                //refresh?\n                                $state.reload();\n                                $state.go('dashboard.my_account.licence');\n\n                            } else {\n\n                                ToastService.error('Delete Failed', 'Something went terribly wrong: ' + data.message);\n\n                            }\n\n                        });\n\n\n\n                } else {\n                    //console.log(\"ignore\");\n                }\n\n\n            }\n\n\n\n\n            vm.show_loading = false;\n            vm.blurred = true;\n            vm.show_temp_login = false;\n\n              $scope.getDecrypted = function(){\n                  vm.show_loading = true;\n                  // LicenceService.GetById($stateParams.licence_id, 1, 1)\n                  //   .then(function (data) {\n\n                  //       if(data.success){\n                  //           vm.medical = data.medical;\n                  //           vm.medical.examination_date = new Date(vm.medical.examination_date);\n\n                  //           vm.medical.state_of_issue = $.grep(vm.authority, function(e){ return e.id == vm.medical.authority_id; })[0];\n                  //           ////console.log(\"SET\", vm.medical.state_of_issue);\n\n                  //           //pre-selection bits?\n                  //           ////console.log(\"NEW RATINGS\", vm.medical.components);\n                  //           for(var i=0;i<vm.medical.components.length;i++){\n                  //               delete vm.medical.components[i].id;\n                  //               vm.medical.components[i].id = vm.medical.components[i].component_id;\n                  //               delete vm.medical.components[i].component_id;\n                  //               vm.medical.components[i].expiry_date = new Date(vm.medical.components[i].expiry_date);\n\n                  //               //need to remove the component from the components lists too :)\n                  //               vm.components = $.grep(vm.components, function(e){ \n                  //                   return e.id != vm.medical.components[i].id; \n                  //               });\n\n                  //           }\n\n                  //           vm.blurred = false;\n                  //           vm.show_loading = false;\n                  //       } else {\n                  //           //console.log(\"WOOOPSIES...\");\n                  //           vm.show_loading = false;\n                  //           //this should be very very rare...\n                  //       }\n\n                  //   });\n\n\n\n\n                  LicenceService.GetById($stateParams.licence_id, 1, 1)\n                    .then(function (data) {\n                        if(data.success){\n                            vm.licence = data.licence;\n                            vm.licence.licence_issue_date = new Date(vm.licence.licence_issue_date);\n                            vm.licence.licence_expiry_date = new Date(vm.licence.licence_expiry_date);\n                            // //console.log(\"licence\", vm.licence);\n\n                            vm.licence.licence_type = $.grep(vm.licence_types, function(e){ return e.id == vm.licence.licence_id; })[0];\n                            vm.licence.state_of_issue = $.grep(vm.authority, function(e){ return e.id == vm.licence.authority_id; })[0];\n                            // //console.log(\"SET\", vm.licence.state_of_issue);\n\n                            //pre-selection bits?\n                            // //console.log(\"NEW RATINGS\", vm.licence.ratings);\n                            for(var i=0;i<vm.licence.ratings.length;i++){\n                                delete vm.licence.ratings[i].id;\n                                vm.licence.ratings[i].id = vm.licence.ratings[i].rating_id;\n                                delete vm.licence.ratings[i].rating_id;\n                                vm.licence.ratings[i].test_date = new Date(vm.licence.ratings[i].test_date);\n                                vm.licence.ratings[i].expiry_date = new Date(vm.licence.ratings[i].expiry_date);\n\n                                //need to remove the rating from the ratings lists too :)\n                                vm.ratings = $.grep(vm.ratings, function(e){ \n                                    return e.id != vm.licence.ratings[i].id; \n                                });\n\n                            }\n\n                            vm.show_loading = false;\n                            vm.blurred = false;\n\n                        } else {\n\n                                if(data.fail == \"templogin\"){\n                                    // //console.log(\"WOOOPSIES...\", data);\n                                    vm.show_temp_login = true;\n\n                                }\n\n                            vm.show_loading = false;\n                            //this should be very very rare...\n                        }\n\n                    });\n\n\n\n              }\n\n              function create_sample(length) {\n                   var result           = '';\n                   var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n                   var charactersLength = characters.length;\n                   for ( var i = 0; i < length; i++ ) {\n                      result += characters.charAt(Math.floor(Math.random() * charactersLength));\n                   }\n                   return result;\n                }\n\n\n                $scope.re_login = function(){\n\n\n                      ////console.log(\"CLICKED\", vm.re_login_pass);\n\n                      //now we use the token that has been assigned already to verify the login password\n\n                        AuthenticationService.Login3(vm.re_login_pass, create_sample(120), function (response) {\n                            //console.log(\"resp\", response);\n                            if (response.success) {\n\n\n                                //we now need to call the query that was called before (decryption)\n\n                                $scope.getDecrypted();\n\n\n\n\n                                vm.show_temp_login = false;\n                            } else {\n                                ToastService.error('Wrong Password', 'This is the wrong password - please try again...');\n                            }\n                        });\n\n\n\n                      //vm.show_temp_login = true;\n\n                  }\n\n\n\n            $scope.save_licence = function(isValid){\n                vm.show_loading = true;\n\n                if(vm.licence_images.length < 1 && vm.licence.images.length < 1){\n\n                    ToastService.highlightField('.drop');\n                    ToastService.warning('Image Required', 'You must at least have 1 image of your licence!');\n                    vm.show_loading = false;\n                    return false;   \n                }\n\n\n                if(!vm.licence.licence_type){\n                    ToastService.highlightField('licence_type');\n                    ToastService.warning('Licence Type Required', 'You must select a licence type');\n                    vm.show_loading = false;\n                    return false;\n                }\n\n\n                if(!vm.licence.state_of_issue){\n                    ToastService.highlightField('state_of_issue');\n                    ToastService.warning('State Required', 'You must select a licence state of issue');\n                    vm.show_loading = false;\n                    return false;\n                }\n\n\n                if(vm.licence.ratings.length < 1){\n\n                    ToastService.highlightField('ratings');\n                    ToastService.warning('Rating Required', 'You must at least have 1 rating!');\n                    vm.show_loading = false;\n                    return false;   \n                }\n\n                // //console.log(\"FLOW: \", vm.licence_images);\n\n\n\n                //compile the required elements YAY\n\n                // //console.log(\"LICENCE GOOD TO GO \", vm.licence);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n                    for(var i=0;i<vm.licence.images.length;i++){\n                        delete vm.licence.images[i].data_uri;\n                    }\n\n                    // vm.licence.images = vm.licence_images;\n                    vm.licence.images = vm.licence.images.concat(vm.licence_images);\n\n                    vm.licence.licence_id = vm.licence.licence_type.id;\n                    vm.licence.authority_id = vm.licence.state_of_issue.id;\n                    vm.licence.user_id = vm.user.id;\n\n                    delete vm.licence.licence_type;\n                    delete vm.licence.state_of_issue;\n\n\n                if(vm.licence.id){\n                    //then its an udpate\n\n                    //merge the images left?\n                    LicenceService.Update(vm.licence)\n                        .then(function (data) {\n                            // //console.log(data);\n                            if(data.success){\n                                // //console.log(\"HUZZAH\", vm.licence);\n                                // //console.log(\"HUZZAH\", data);\n                                //then we need to remove this from the list of files...\n                                \n                                \n                                //move somewhere?\n                                $state.go('dashboard.my_account.licence', {}, { reload: true });\n\n                                vm.show_loading = false;\n\n\n\n\n                            } else {\n\n                                ToastService.error('Update Failed', 'Something went terribly wrong: ' + data.message);\n                                vm.show_loading = false;\n\n                            }\n\n                        });\n\n                } else {\n\n\n                   \n\n\n                    //then its a create\n                    // //console.log(vm.licence);\n\n                    LicenceService.Create(vm.licence)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                // //console.log(\"HUZZAH\", vm.licence);\n                                // //console.log(\"HUZZAH\", data);\n                                //then we need to remove this from the list of files...\n                                \n                                \n                                //move somewhere?\n                                $state.reload();\n                                vm.show_loading = false;\n                                $state.go('dashboard.my_account.licence', {}, { reload: true });\n\n\n                            } else {\n\n                                ToastService.error('Create Failed', 'Something went terribly wrong: ' + data.message);\n                                vm.show_loading = false;\n\n                            }\n\n                        });\n\n\n                }\n\n\n\n            };\n\n\n        \n        \n\n\n    }\n app.controller('ManageMedicalController', ManageMedicalController);\n\n    ManageMedicalController.$inject = ['UserService', 'MemberService', 'AuthenticationService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'LicenceService', 'MedicalService', 'ToastService'];\n    function ManageMedicalController(UserService, MemberService, AuthenticationService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, LicenceService, MedicalService, ToastService) {\n        \n        var vm = this;        \n\n        vm.medical_images = [];\n        vm.medical = {\n                images: [],\n                components: []\n        };\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n\n        MedicalService.GetMedicalTypes()\n                .then(function (data) {\n                    vm.medical_types = data;\n                    // //console.log(\"medical_types: \", vm.medical_types);\n                });\n\n\n        MedicalService.GetAuthority()\n            .then(function (data) {\n                vm.authority = data;\n                // //console.log(\"authority: \", vm.authority);\n            });\n\n        MedicalService.GetComponents()\n            .then(function (data) {\n                vm.components = data;\n                // //console.log(\"authority: \", vm.authority);\n            });\n\n\n        switch($state.current.data.action){\n            case \"add\":\n\n                    //vm.selected_component = vm.components[0];\n                    //vm.selected_component = \n                    \n\n                    // //console.log(\"AA\", vm.selected_component);\n\n            \n\n            break;\n            case \"edit\":\n\n            // //console.log(\"EDIT ONE\");\n            // //console.log(\"PARAMS: \", $stateParams);\n\n             MedicalService.GetById($stateParams.medical_id, 1, 0)\n                .then(function (data) {\n                    if(data.success){\n                        vm.medical = data.medical;\n                        vm.medical.examination_date = new Date(vm.medical.examination_date);\n\n                        vm.medical.state_of_issue = $.grep(vm.authority, function(e){ return e.id == vm.medical.authority_id; })[0];\n                        // //console.log(\"SET\", vm.medical.state_of_issue);\n\n                        //pre-selection bits?\n                        // //console.log(\"NEW RATINGS\", vm.medical.components);\n                        for(var i=0;i<vm.medical.components.length;i++){\n                            delete vm.medical.components[i].id;\n                            vm.medical.components[i].id = vm.medical.components[i].component_id;\n                            delete vm.medical.components[i].component_id;\n                            vm.medical.components[i].expiry_date = new Date(vm.medical.components[i].expiry_date);\n\n                            //need to remove the component from the components lists too :)\n                            vm.components = $.grep(vm.components, function(e){ \n                                return e.id != vm.medical.components[i].id; \n                            });\n\n                        }\n\n\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n\n            break;\n            case \"list\":\n\n                //console.log(\"LIST ALL\");\n\n                 //1 get the user's medical...\n                 //list stuff\n\n                MedicalService.GetByUserId(vm.user.id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        vm.user_medicals = data.medicals;\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n\n\n            $scope.add_component = function(){\n\n                //remove from first array\n                vm.components = $.grep(vm.components, function(e){ \n                    return e.id != vm.selected_component.id; \n                });\n\n                vm.medical.components.push(vm.selected_component);\n\n                //clear selected\n                delete vm.selected_component;\n                \n                //clean the array to show what we want to show :)\n                //delete $scope.formData.license.add_to[bit_type];\n\n            }\n\n            $scope.remove_component = function(index){\n\n                //add to dropdown\n                vm.components.push(vm.medical.components[index]);\n                vm.medical.components.splice(index,1)\n\n                //$scope.formData.license[bit_type] = $scope.formData.license[bit_type].filter(Boolean);\n\n                //  //console.log($scope.formData.license[bit_type]);\n                //  $scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n            }\n\n            //default add the first component required...\n            \n\n\n\n/*\n\nOLD VERSION FOR LEGACY PURPOSES\n\n  $scope.add_element = function(bit_type){\n\n                //remove from first array\n                $scope[bit_type][bit_type] = $.grep($scope[bit_type][bit_type], function(e){ \n                    return e.id != $scope.formData.license.add_to[bit_type].id; \n                });\n\n                if(bit_type == \"differences\"){\n                    $scope.formData.license.add_to[bit_type].day = true;\n                    $scope.formData.license.add_to[bit_type].vfr = true;\n                }\n                //console.log($scope.formData.license.add_to[bit_type]);\n\n                $scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n                \n                //clean the array to show what we want to show :)\n                delete $scope.formData.license.add_to[bit_type];\n\n            }\n\n\n            $scope.remove_element = function(bit_type, index){\n\n                //add to dropdown\n                $scope[bit_type][bit_type].push($scope.formData.license[bit_type][index]);\n            \n                $scope.formData.license[bit_type].splice(index,1)\n\n                $scope.formData.license[bit_type] = $scope.formData.license[bit_type].filter(Boolean);\n                //console.log($scope.formData.license[bit_type]);\n                //$scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n            }\n\n\n*/\n\n\n            //nice looking date pickers\n\n\n            $scope.popup = [];\n\n            $scope.open = function(id, $event) {\n                // //console.log(\"THIS\", id);\n                //this comment would allow the event not to be affect by clicking it again... not sure this is a good idea\n                if($scope.popup[id] && $scope.popup[id].opened == true){\n                    $event.preventDefault();\n                    $event.stopPropagation();\n                } else {\n                    $scope.popup[id] = {opened: true};\n                }\n            };\n\n            $scope.formats = ['dd/MM/yyyy', 'yyyy/MM/dd', 'dd.MM.yyyy', 'shortDate'];\n            $scope.format = $scope.formats[0];\n\n            $scope.datePickerOptions = {\n                                        format: 'dd/MM/yyyy',\n                                        showWeeks: false\n                                    };\n\n           \n\n           $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.medical.images = $.grep(vm.medical.images, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                \n\n          }\n\n\n\n          vm.show_loading = false;\n          vm.blurred = true;\n          vm.show_temp_login = false;\n\n          $scope.getDecrypted = function(){\n              vm.show_loading = true;\n              MedicalService.GetById($stateParams.medical_id, 1, 1)\n                .then(function (data) {\n\n                    if(data.success){\n                        vm.medical = data.medical;\n                        vm.medical.examination_date = new Date(vm.medical.examination_date);\n\n                        vm.medical.state_of_issue = $.grep(vm.authority, function(e){ return e.id == vm.medical.authority_id; })[0];\n                        ////console.log(\"SET\", vm.medical.state_of_issue);\n\n                        //pre-selection bits?\n                        ////console.log(\"NEW RATINGS\", vm.medical.components);\n                        for(var i=0;i<vm.medical.components.length;i++){\n                            delete vm.medical.components[i].id;\n                            vm.medical.components[i].id = vm.medical.components[i].component_id;\n                            delete vm.medical.components[i].component_id;\n                            vm.medical.components[i].expiry_date = new Date(vm.medical.components[i].expiry_date);\n\n                            //need to remove the component from the components lists too :)\n                            vm.components = $.grep(vm.components, function(e){ \n                                return e.id != vm.medical.components[i].id; \n                            });\n\n                        }\n\n                        vm.blurred = false;\n                        vm.show_loading = false;\n                    } else {\n\n                        if(data.fail == \"templogin\"){\n                            //console.log(\"WOOOPSIES...\", data);\n                            vm.show_temp_login = true;\n\n                        }\n\n\n\n                        vm.show_loading = false;\n                        //this should be very very rare...\n                    }\n\n                });\n          }\n\n        function create_sample(length) {\n           var result           = '';\n           var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n           var charactersLength = characters.length;\n           for ( var i = 0; i < length; i++ ) {\n              result += characters.charAt(Math.floor(Math.random() * charactersLength));\n           }\n           return result;\n        }\n\n\n          $scope.re_login = function(){\n\n\n              //console.log(\"CLICKED\", vm.re_login_pass);\n\n              //now we use the token that has been assigned already to verify the login password\n\n                AuthenticationService.Login3(vm.re_login_pass, create_sample(120), function (response) {\n                    //console.log(\"resp\", response);\n                    if (response.success) {\n\n\n                        //we now need to call the query that was called before (decryption)\n\n                        $scope.getDecrypted();\n\n\n\n\n                        vm.show_temp_login = false;\n                    } else {\n                        ToastService.error('Wrong Password', 'This is the wrong password - please try again...');\n                    }\n                });\n\n\n\n              //vm.show_temp_login = true;\n\n          }\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            // //console.log(\"REMOVE: \", j);\n            // //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            MedicalService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        // //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.medical_images = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n            $scope.processFiles = function(files){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    files[i].file.temp_path = j.saved_url;\n                    // //console.log(\"file\", files[i].file);\n                    vm.medical_images.push(files[i].file);\n                }\n               \n            }\n\n\n\n            $scope.delete_medical = function(id){\n\n              \n                var a = prompt(\"Are you sure you wish to delete this medical? \\n\\n This change is irreversible! To confirm please type YES in the box below.\");\n                if(a == \"YES\"){\n\n\n                    //console.log(\"WE DELETE IT\");\n\n\n                    MedicalService.Delete(vm.user.id, id)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                //console.log(\"HUZZAH\", data);\n                                //then we need to remove this from the list of files...\n                                vm.user_medicals = $.grep(vm.user_medicals, function(e){ \n                                    return e.id != id; \n                                });\n                                \n                                //refresh?\n                                $state.reload();\n                                $state.go('dashboard.my_account.medical');\n\n                            } else {\n\n                                ToastService.error('Delete Failed', 'Something went terribly wrong: ' + data.message);\n\n                            }\n\n                        });\n\n\n\n                } else {\n                    //console.log(\"ignore123\");\n                }\n\n\n            }\n\n\n\n\n            $scope.save_medical = function(isValid){\n\n                vm.show_loading = true;\n\n                if(vm.medical_images.length < 1 && vm.medical.images.length < 1){\n\n                    ToastService.highlightField('.drop');\n                    ToastService.warning('Image Required', 'You must at least have 1 image of your medical!');\n\n                    vm.show_loading = false;\n                    return false;   \n                }\n\n\n                if(!vm.medical.state_of_issue){\n                    ToastService.highlightField('state_of_issue');\n                    ToastService.warning('State Required', 'You must select a medical state of issue');\n                    vm.show_loading = false;\n                    return false;\n                }\n\n\n                if(vm.medical.components.length < 1){\n\n                    ToastService.highlightField('components');\n                    ToastService.warning('Component Required', 'You must at least have 1 component!');\n                    vm.show_loading = false;\n                    return false;   \n                }\n\n                //console.log(\"FLOW: \", vm.medical_images);\n\n\n\n                //compile the required elements YAY\n\n                //console.log(\"LICENCE GOOD TO GO \", vm.medical);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n                    for(var i=0;i<vm.medical.images.length;i++){\n                        delete vm.medical.images[i].data_uri;\n                    }\n\n                    // vm.medical.images = vm.medical_images;\n                    vm.medical.images = vm.medical.images.concat(vm.medical_images);\n                    vm.medical.authority_id = vm.medical.state_of_issue.id;\n                    vm.medical.user_id = vm.user.id;\n\n                    delete vm.medical.medical_type;\n                    delete vm.medical.state_of_issue;\n\n\n                if(vm.medical.id){\n                    //then its an udpate\n\n                    //merge the images left?\n                    MedicalService.Update(vm.medical)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                //console.log(\"HUZZAH\", vm.medical);\n                                //console.log(\"HUZZAH\", data);\n                                //then we need to remove this from the list of files...\n                                \n                                \n                                //move somewhere?\n                                $state.go('dashboard.my_account.medical', {}, { reload: true });\n\n                                vm.show_loading = false;\n\n\n\n\n                            } else {\n\n                                ToastService.error('Update Failed', 'Something went terribly wrong: ' + data.message);\n                                vm.show_loading = false;\n\n                            }\n\n                        });\n\n                } else {\n\n\n                   \n\n\n                    //then its a create\n                    //console.log(vm.medical);\n\n                    MedicalService.Create(vm.medical)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                //console.log(\"HUZZAH\", vm.medical);\n                                //console.log(\"HUZZAH\", data);\n                                vm.show_loading = false;\n                                //then we need to remove this from the list of files...\n                                $state.go('dashboard.my_account.medical', {}, { reload: true });\n                                \n                                //move somewhere?\n                               // $state.reload();\n                               // $state.go('dashboard.my_account.medical', {}, { reload: true });\n\n\n                            } else {\n\n                                ToastService.error('Create Failed', 'Something went terribly wrong: ' + data.message);\n                                vm.show_loading = false;\n\n                            }\n\n                        });\n\n\n                }\n\n\n\n            };\n\n\n\n        \n        \n\n\n    }\n app.controller('ManageMyMembershipsController', ManageMyMembershipsController);\n\n    ManageMyMembershipsController.$inject = ['UserService', 'MemberService', 'MembershipService', 'PaymentService', 'InstructorService', 'HolidayService', 'ClubService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'LicenceService', 'NokService', '$cookies', 'GoCardService', '$http', 'EnvConfig', 'ToastService'];\n    function ManageMyMembershipsController(UserService, MemberService, MembershipService, PaymentService, InstructorService, HolidayService, ClubService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, LicenceService, NokService, $cookies, GoCardService, $http, EnvConfig, ToastService) {\n        \n        var vm = this;        \n\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;        \n        vm.noks = [];\n        vm.requests = [];\n        vm.auto_renew = false;\n\n        \n    \n\n\n        switch($state.current.data.action){\n            case \"add\":\n\n                    //vm.selected_component = vm.components[0];\n                    //vm.selected_component = \n\n                    // //console.log(\"AA\", vm.selected_component);\n                ClubService.GetAll()\n                .then(function (data) {\n                    \n                    vm.clubs = data;\n\n                });\n            \n\n            break;\n            case \"edit\":\n\n            // //console.log(\"EDIT ONE\");\n             //console.log(\"PARAMS: \", $stateParams);\n\n            // PaymentService.GetByUserId(vm.user.id)\n            //     .then(function (data) {\n            //         //console.log(\"DATA HERE\", data);\n            //         vm.cards = data.cards;\n\n\n                    MemberService.GetOneForUser($stateParams.membership_id)\n                    .then(function (data) {\n                            //console.log(\"DATA HERE\", data);\n                            if(data.success){\n                                vm.membership_now = data.membership;\n                                vm.auto_renew = (data.membership.auto_renew == 1) ? true : false;\n\n                                //get_member_cards\n                                 var send = {\n                                   user_id: vm.user.id,\n                                   club_id: vm.membership_now.club_id,\n                                   membership_id: $stateParams.membership_id\n                               }\n                                PaymentService.GetMemberCards(send)\n                                .then(function (data) {\n\n                                    console.log(data);\n                                    vm.membership_now.cards = data.cards;\n                                    vm.membership_now.default_card = data.default_card;\n\n                                });\n\n\n\n                                //vm.payment_card = vm.cards.find(item => item.id === vm.membership_now.card_id);\n                            } else {\n                                //console.log(\"woops\");\n                            }\n                            \n                            \n\n\n                        });\n\n                // });\n\n\n\n\n\n            break;\n\n            case \"accept\":\n\n                // //console.log(\"EDIT ONE\");\n                //console.log(\"PARAMS: \", $stateParams);\n                //$stateParams.request_id\n                MembershipService.GetRequestsById($stateParams.request_id)\n                    .then(function (data) {\n                        if(data.success){\n                            vm.this_req = data.request;\n                            //console.log(\"REQ\", vm.this_req);\n\n\n\n\n\n                        } else {\n                            //console.log(\"WOOOPSIES...\");\n                            //this should be very very rare...\n                        }\n                    });\n\n\n                // PaymentService.GetByUserId(vm.user.id)\n                //     .then(function (data) {\n                //         //console.log(\"DATA HERE\", data);\n                //         vm.cards = data.cards;\n                //     });\n\n\n\n            break;\n            case \"list\":\n\n                //console.log(\"LIST ALL\");\n\n                 //1 get the user's nok...\n                 //list stuff\n\n                 MemberService.GetUserMemberships(vm.user.id)\n                .then(function (data) {\n                    if(data.success){\n                        vm.memberships = data.memberships;\n                        //console.log(\"memberships\", vm.memberships);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n                update_requests();\n\n                //  MembershipService.GetRequestsByUser(vm.user.id)\n                // .then(function (data) {\n                //     if(data.success){\n                //         vm.requests = data.requests;\n                //         //console.log(\"memberships\", vm.memberships);\n\n                //     } else {\n                //         //console.log(\"WOOOPSIES...\");\n                //         //this should be very very rare...\n                //     }\n\n                // });\n\n\n            break;\n           \n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n\n\n        function update_requests(){\n            MembershipService.GetRequestsByUser(vm.user.id)\n                .then(function (data) {\n                    if(data.success){\n                        vm.requests = data.requests;\n                        //console.log(\"memberships\", vm.memberships);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n        }\n\n\n            $scope.popup = [];\n\n            $scope.open = function(id, $event) {\n                //console.log(\"THIS\", id);\n                //this comment would allow the event not to be affect by clicking it again... not sure this is a good idea\n                if($scope.popup[id] && $scope.popup[id].opened == true){\n                    $event.preventDefault();\n                    $event.stopPropagation();\n                } else {\n                    $scope.popup[id] = {opened: true};\n                }\n            };\n\n            $scope.formats = ['dd/MM/yyyy', 'yyyy/MM/dd', 'dd.MM.yyyy', 'shortDate'];\n            $scope.format = $scope.formats[0];\n\n            $scope.datePickerOptions = {\n                                        format: 'dd/MM/yyyy',\n                                        showWeeks: false\n                                    };\n\n           \n\n            vm.show_memberships = false;\n\n            $scope.set_club = function(){\n\n                vm.show_memberships = true;\n                \n                MembershipService.GetAllByClubAvailable(vm.club.id)\n                .then(function (data) {\n                    //console.log(\"DATA HERE\", data);\n                    vm.memberships = data;\n                  \n                });\n\n            }\n\n            $scope.set_default_payment_method = function(name){\n\n                var obj = {\n                    default_payment_method: name\n                };\n\n                MemberService.UpdateOneByUser($stateParams.membership_id, obj)\n                .then(function (data) {\n                    //console.log(\"ACCEPT HERE\", data);\n\n\n                    MemberService.GetOneForUser($stateParams.membership_id)\n                    .then(function (data) {\n                            //console.log(\"DATA HERE\", data);\n                            if(data.success){\n                                vm.membership_now = data.membership;\n                                vm.auto_renew = (data.membership.auto_renew == 1) ? true : false;\n\n                                //get_member_cards\n                                 var send = {\n                                   user_id: vm.user.id,\n                                   club_id: vm.membership_now.club_id,\n                                   membership_id: $stateParams.membership_id\n                               }\n                                PaymentService.GetMemberCards(send)\n                                .then(function (data) {\n\n                                    console.log(data);\n                                    vm.membership_now.cards = data.cards;\n                                    vm.membership_now.default_card = data.default_card;\n\n                                });\n\n\n\n                                //vm.payment_card = vm.cards.find(item => item.id === vm.membership_now.card_id);\n                            } else {\n                                //console.log(\"woops\");\n                            }\n                            \n                            \n\n\n                        });\n\n\n\n                    //$state.go('dashboard.my_account.memberships', {}, {reload: true});\n                });\n\n            }\n\n            $scope.make_default_card = function(card){\n                var a = confirm(\"Are you sure you wish to make this card the default card?\");\n\n                if(a){\n                    var send = {user_id: vm.user.id, club_id: vm.membership_now.club_id, card_id: card.stripe_id};\n                    PaymentService.UpdateDefaultCard(send)\n                    .then(function (data) {\n                        console.log(\"DATA HERE\", data);\n                        if(data.success){\n                            //update the card list!\n                            vm.membership_now.cards = data.cards;\n                            vm.membership_now.default_card = data.default_card;\n                        }\n                      \n                    });\n                }\n            }\n\n            $scope.delete_member_card = function(card){\n\n                var a = confirm(\"Are you sure you wish to delete this card?\");\n\n                if(a){\n                    var send = {user_id: vm.user.id, club_id: vm.membership_now.club_id, card_id: card.stripe_id};\n                    PaymentService.DeleteMemberCard(send)\n                    .then(function (data) {\n                        console.log(\"DATA HERE\", data);\n                        if(data.success){\n                            //update the card list!\n                            PaymentService.GetMemberCards(send)\n                                    .then(function (data) {\n                                        // console.log(data);\n                                        vm.membership_now.cards = data.cards;\n\n                                    });\n                        }\n                      \n                    });\n                }\n\n                \n            }\n\n            $scope.delete_request = function(id){\n                MembershipService.DeleteRequest(id)\n                .then(function (data) {\n                    //console.log(\"DELETE HERE\", data);\n                    //vm.memberships = data;\n                    update_requests();\n                }); \n            }\n\n\n            $scope.set_membership = function(){\n\n                vm.show_confirmation = true;\n                \n                PaymentService.GetByUserId(vm.user.id)\n                .then(function (data) {\n                    //console.log(\"DATA HERE\", data);\n                    vm.cards = data.cards;\n                  \n                });\n\n            }\n\n\n            $scope.set_card = function(){\n\n              \n                \n\n            }\n\n\n            $scope.accept_it = function(){\n\n                if(!vm.club_tnc){\n                    ToastService.warning('Terms Required', 'You need to access the terms of the flight organisation prior to continuing!');\n                    return false;\n                }\n\n                //basic checks...\n                var obj = {\n                    club_id: vm.this_req.club_id,\n                    user_id: vm.user_id,\n                    request_id: vm.this_req.id\n                };\n\n                MembershipService.AcceptRequest(vm.this_req.id, obj)\n                .then(function (data) {\n                    ////console.log(\"ACCEPT HERE\", data);\n\n                    $cookies.put('gcl_sess', data.mandate.session);\n                    $cookies.put('gcl_member_accepted', true);\n\n                    window.location = data.mandate.link;\n\n                    //vm.memberships = data;\n                    // update_requests();\n                    //     $state.go('dashboard.my_account.memberships', {}, {reload: true});\n                }); \n\n            }\n\n            $scope.update_it = function(){\n\n                var obj = {\n                    auto_renew: (vm.auto_renew == true)? 1 : 0\n                };\n\n                MemberService.UpdateOneByUser($stateParams.membership_id, obj)\n                .then(function (data) {\n                    //console.log(\"ACCEPT HERE\", data);\n                    //vm.aut\n                    //$state.go('dashboard.my_account.memberships', {}, {reload: true});\n                });\n\n            }\n\n\n            $scope.edit_membership = function(id){\n\n                //console.log(\"update membership\");\n                $state.go('dashboard.my_account.memberships.edit', {membership_id: id});\n\n            }\n\n\n            $scope.create_direct_debit = function(){\n\n                \n\n\n            }\n\n            var update_request = false;\n            vm.change_direct_debit = function(){\n                if(!update_request){\n\n                   ////console.log(\"UPDATE\");\n\n                   var update_mandate_details = {\n                       user_id: vm.user.id,\n                       club_id: vm.membership_now.club_id,\n                       membership_id: $stateParams.membership_id\n                   }\n\n                   ////console.log(\"to send\", update_mandate_details);\n\n                   GoCardService.GenerateUpdateLink(update_mandate_details)\n                   .then(function (data) {\n                    ////console.log(\"ACCEPT HERE\", data);\n                    if(data.success){\n                        $cookies.put('gcl_sess', data.session);\n                        $cookies.put('gcl_member_accepted', true);\n\n                        window.location = data.link;\n                        \n                    } else {\n                        ToastService.error('Direct Debit Error', 'An error occurred when generating the link to update your direct debit instructions - please contact support@toaviate.com');\n                    }\n                   \n\n                    //vm.memberships = data;\n                    // update_requests();\n                    //     $state.go('dashboard.my_account.memberships', {}, {reload: true});\n                }); \n\n\n\n\n                } else {\n                    //console.log(\"putting the request on hold\");\n                }\n\n\n            }\n\n          \n            vm.show_add_card = false;\n\n            $scope.add_card = function(){\n\n                console.log(\"ADD A CARD HERE!!\");\n                var send = {\n                    club_id: vm.membership_now.club_id,\n                    user_id: vm.user.id\n                }\n\n                vm.show_add_card = true;\n\n                PaymentService.CreateNewCustomer(send)\n                .then(function (data) {\n                    console.log(\"DATA HERE\", data);\n                    // Initialize Stripe.js\n                    var stripe = Stripe(EnvConfig.getStripeKey());\n\n                    const options = {\n                      clientSecret: data.secret,\n                      // Fully customizable with appearance API.\n                      appearance: {/*...*/},\n                    };\n\n                    // Set up Stripe.js and Elements using the SetupIntent's client secret\n                    const elements = stripe.elements(options);\n\n                    // Create and mount the Payment Element\n                    const paymentElementOptions = { layout: 'tabs'};\n                    const paymentElement = elements.create('payment', paymentElementOptions);\n                    paymentElement.mount('#payment-element');\n\n\n\n                    const form = document.getElementById('payment-form');\n\n                    form.addEventListener('submit', async (event) => {\n                      event.preventDefault();\n\n                      const {error} = await stripe.confirmSetup({\n                        //`Elements` instance that was used to create the Payment Element\n                        elements,\n                        confirmParams: {\n                          return_url: window.location.href,\n                        }\n                      });\n\n                      if (error) {\n                        // This point will only be reached if there is an immediate error when\n                        // confirming the payment. Show error to your customer (for example, payment\n                        // details incomplete)\n                        const messageContainer = document.querySelector('#error-message');\n                        messageContainer.textContent = error.message;\n                      } else {\n                        // Your customer will be redirected to your `return_url`. For some payment\n                        // methods like iDEAL, your customer will be redirected to an intermediate\n                        // site first to authorize the payment, then redirected to the `return_url`.\n                      }\n                    });\n\n\n\n\n                });\n\n               //  //setup the js to show the card addition form\n               // PaymentService.CreatePaymentIntent(send)\n               //  .then(function (data) {\n               //      console.log(\"DATA HERE\", data);\n               //      vm.show_add_card = true;\n\n               //      var fetched_secret = data.clientSecret;\n               //      // Initialize Stripe.js\n               //      var stripe = Stripe('pk_test_51QttFFG8WiGSRCORyxkdZTO8oajcqz9OUsvcDJFpr9FB2PAdbzJc0tS7WNnfzKYsTiqHN1YDZi5UtXk4K52SeD4h00YWXuChNd');\n\n               //      // Initialize Checkout\n                     \n\n                    \n\n               //          var checkout = stripe.initEmbeddedCheckout({\n               //              clientSecret: fetched_secret,\n               //          }).then(function(checkout){\n               //                checkout.mount('#checkout');\n               //              //   const options = { layout: 'accordion', clientSecret: fetched_secret /* options */ };\n\n               //              //   const appearance = {\n               //              //       theme: 'flat',\n               //              //       variables: { colorPrimaryText: '#262626' },\n               //              //       clientSecret: fetched_secret\n               //              //     };\n               //              //   const elements = stripe.elements(appearance, {clientSecret: fetched_secret});\n               //              // const paymentElement = elements.create('payment', options);\n               //              // paymentElement.mount('#checkout');\n               //          });\n\n                         \n                            \n                         \n\n\n                   \n               //        // Mount Checkout\n               //        //checkout.mount('#checkout');\n\n               //      ///vm.cards = data.cards;\n                  \n               //  });\n                \n\n\n\n\n\n            }\n\n            vm.try_charge_default_card = function(){\n                ToastService.success('Processing', 'Initiating card charge.');\n                var invoice_id = 55;\n                var send_me = {\n                    invoice_id: 55,\n                    card_id: vm.membership_now.cards[1].stripe_id,\n                    last4: vm.membership_now.cards[1].last4\n                }\n                PaymentService.CreatePaymentIntent(send_me).then(function (data) {\n                    console.log(\"DATA IS : \", data);\n\n                });\n\n            }\n\n            $scope.save_added_card = function(){\n\n                 var update_mandate_details = {\n                       user_id: vm.user.id,\n                       club_id: vm.membership_now.club_id,\n                       membership_id: $stateParams.membership_id\n                }\n\n                vm.show_add_card = false;\n\n            }\n\n\n             $scope.get_icon = function(file){\n\n                var ft;\n                if(file && file.name){\n                     ft = file.name;\n                } else {\n                    ft = file;\n                }\n\n                if(!ft){\n                    ft = \"other.other\";\n                }\n\n\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n\n\n\n\n        $scope.downloadClubDocument = function(doc) {\n            var data = $.param({\n                id: doc\n            });\n            if(!doc){\n                ToastService.warning('Document Unavailable', \"Sorry - it looks like this flight organisation hasn't yet uploaded their document - please contact them to upload it to ToAviate.\");\n                return false;\n            }\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.defaults.headers.common['Api-Key'] = \"eW91a25vd25vdGhpbmdqb25zbm93\";\n\n            $http.get('api/v1/term_documents/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'This file is not available at the moment - please contact the flight organisation.');\n                })\n        };\n\n        function titlepath(path,name){\n\n        //In this path defined as your pdf url and name (your pdf name)\n            var prntWin = window.open();\n            prntWin.document.write(\"<html><head><title>\"+name+\"</title></head><body>\"\n                + '<embed width=\"100%\" height=\"100%\" name=\"plugin\" src=\"'+ path+ '\" '\n                + 'type=\"application/pdf\" internalinstanceid=\"21\"></body></html>');\n            prntWin.document.close();\n        }\n\n        function processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], \n                    //type: contentType\n                    {type: 'application/pdf'}\n                //}\n                );\n\n\n                var fileURL = URL.createObjectURL(blob);\n                //window.open(fileURL);\n                titlepath(fileURL, \"Secure Documents\");\n\n                // if (navigator.msSaveBlob)\n                //     navigator.msSaveBlob(blob, filename);\n                // else {\n                //     // Try using other saveBlob implementations, if available\n                //     var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                //     if (saveBlob === undefined) throw \"Not supported\";\n                //     saveBlob(blob, filename);\n                // }\n                success = true;\n            } catch (ex) {\n                $log.info(\"saveBlob method failed with the following exception:\");\n                $log.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            $log.info(\"Download link method with simulated click failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n\n\n\n\n\n\n\n\n\n\n            $scope.request = function(){\n\n                //basic checks...\n          \n\n\n              if(vm.club_tnc && vm.card_tnc && vm.club.id && vm.membership.id){\n                ToastService.success('Thank You', 'Your request has been submitted.');\n\n                var obj = {\n                    user_id: vm.user.id,\n                    club_id: vm.club.id,\n                    membership_id: vm.membership.id,\n                    requested_by: \"user\",\n                    paid: 0\n                    //,card_id: vm.payment_card.id\n                };\n\n                MembershipService.SendRequest(obj)\n                .then(function (data) {\n                    // //console.log(\"SENT HERE\", data);\n                    if(data.success){\n                        //$state.go('dashboard.my_account.memberships');\n\n                        // //console.log(\"DATA\", data);\n                        // //console.log(data.mandate.link);\n                        $cookies.put('gcl_sess', data.mandate.session);\n\n\n                        window.location = data.mandate.link;\n\n\n                    }\n\n                });\n\n\n\n\n              } else {\n                ToastService.warning('Missing Fields', 'Please fill all fields.');\n              }\n\n            }\n\n\n\n\n\n        \n        \n\n\n    }\n app.controller('ManageMyMembershipsDirectDebitController', ManageMyMembershipsDirectDebitController);\n\n    ManageMyMembershipsDirectDebitController.$inject = ['UserService', 'MemberService', 'MembershipService', 'PaymentService', 'InstructorService', 'HolidayService', 'ClubService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'LicenceService', 'NokService', 'GoCardService', '$cookies'];\n    function ManageMyMembershipsDirectDebitController(UserService, MemberService, MembershipService, PaymentService, InstructorService, HolidayService, ClubService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, LicenceService, NokService, GoCardService, $cookies) {\n        \n        var vm = this;        \n\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;        \n      \n        vm.success = true;\n  \n\n        switch($state.current.data.action){\n          \n            case \"direct_debit\":\n\n                var mandate = $location.search().redirect_flow_id;\n                ////console.log(\"DIRECT DEBIT SORTING 444\", mandate);\n                //RE0002NPM29SQ1F4B57R8E3AT4YJAPZG\n                var session = $cookies.get('gcl_sess');\n\n                var object = {\n                    mandate: mandate,\n                    session: session,\n                    member_accepted: false\n\n                };\n\n                if($cookies.get(\"gcl_member_accepted\")){\n                    object[\"member_accepted\"] = true;\n                }\n\n\n\n                GoCardService.SetupMandate(object).then(function (data) {\n                    if(data.success){\n                        //vm.requests = data.requests;\n\n                        vm.club = data.club;\n                        // //console.log(\"memberships\", vm.memberships);\n                        vm.success = true;\n\n                    } else {\n                        // //console.log(\"WOOOPSIES...\");\n                        vm.success = false;\n                        //this should be very very rare...\n                    }\n\n                });\n                \n\n\n\n               \n\n\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n\n\n\n\n        \n        \n        \n\n\n    }\n app.controller('ManageNokController', ManageNokController);\n\n    ManageNokController.$inject = ['UserService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'LicenceService', 'NokService', 'ToastService'];\n    function ManageNokController(UserService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, LicenceService, NokService, ToastService) {\n        \n        var vm = this;        \n\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;        \n        vm.noks = [];\n        vm.clearFieldError = ToastService.clearFieldError;\n\n        \n    \n\n\n        switch($state.current.data.action){\n            case \"add\":\n\n                    //vm.selected_component = vm.components[0];\n                    //vm.selected_component = \n                    \n\n                    // //console.log(\"AA\", vm.selected_component);\n\n            \n\n            break;\n            case \"edit\":\n\n            // //console.log(\"EDIT ONE\");\n             //console.log(\"PARAMS: \", $stateParams);\n\n             NokService.GetById($stateParams.nok_id)\n                .then(function (data) {\n                    if(data.success){\n                        vm.nok = data.nok;\n                        //console.log(\"NOK\", vm.nok);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n\n            break;\n            case \"list\":\n\n                //console.log(\"LIST ALL\");\n\n                 //1 get the user's nok...\n                 //list stuff\n\n                NokService.GetByUserId(vm.user.id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        vm.noks = data.noks;\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n\n\n            $scope.popup = [];\n\n            $scope.open = function(id, $event) {\n                //console.log(\"THIS\", id);\n                //this comment would allow the event not to be affect by clicking it again... not sure this is a good idea\n                if($scope.popup[id] && $scope.popup[id].opened == true){\n                    $event.preventDefault();\n                    $event.stopPropagation();\n                } else {\n                    $scope.popup[id] = {opened: true};\n                }\n            };\n\n            $scope.formats = ['dd/MM/yyyy', 'yyyy/MM/dd', 'dd.MM.yyyy', 'shortDate'];\n            $scope.format = $scope.formats[0];\n\n            $scope.datePickerOptions = {\n                                        format: 'dd/MM/yyyy',\n                                        showWeeks: false\n                                    };\n\n           \n\n      \n\n          \n\n\n\n            $scope.delete_nok = function(id){\n\n              \n                var a = prompt(\"Are you sure you wish to delete this nok? \\n\\n This change is irreversible! To confirm please type YES in the box below.\");\n                if(a == \"YES\"){\n\n                    //console.log(\"WE DELETE IT\");\n\n                    NokService.Delete(vm.user.id, id)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                //console.log(\"HUZZAH\", data);\n                                //then we need to remove this from the list of files...\n                                \n                                //refresh?\n                                $state.go('dashboard.my_account.nok', {}, { reload: true });\n\n                            } else {\n\n                                ToastService.error('Delete Failed', 'Something went terribly wrong: ' + data.message);\n\n                            }\n\n                        });\n\n\n                } else {\n                    //console.log(\"ignore123\");\n                }\n\n\n            }\n\n\n\n\n            $scope.save_nok = function(isValid){\n\n                //  Pre-submit validation with highlight + scroll \n                var checks = [\n                    { ok: vm.nok.first_name,    field: 'first_name',   label: 'First Name' },\n                    { ok: vm.nok.last_name,     field: 'last_name',    label: 'Last Name' },\n                    { ok: vm.nok.phone_number,  field: 'phone_number', label: 'Phone Number' },\n                    { ok: vm.nok.relationship,  field: 'relationship', label: 'Relationship' },\n                    { ok: vm.nok.address,       field: 'address',      label: 'Address' }\n                ];\n                if (!ToastService.validateForm(checks)) return false;\n\n                vm.nok.user_id = vm.user.id;\n\n                if(vm.nok.id){\n                    \n                    //then its an udpate\n                    //merge the images left?\n\n                    NokService.Update(vm.nok)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                ToastService.success('Saved', 'Next of kin updated successfully.');\n                                $state.go('dashboard.my_account.nok', {}, { reload: true });\n\n\n                            } else {\n\n                                ToastService.error('Update Failed', 'Something went terribly wrong: ' + data.message);\n\n                            }\n\n                        });\n\n                } else {\n\n\n                \n\n                    NokService.Create(vm.nok)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                ToastService.success('Saved', 'Next of kin created successfully.');\n                                $state.go('dashboard.my_account.nok', {}, { reload: true });\n\n\n                            } else {\n\n                                ToastService.error('Create Failed', 'Something went terribly wrong: ' + data.message);\n\n                            }\n\n                        });\n\n\n                }\n\n\n\n            };\n\n\n\n        \n        \n\n\n    }\n app.controller('ManagePaymentsAddController', ManagePaymentsAddController);\n\n    ManagePaymentsAddController.$inject = ['UserService', '$sce', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'PaymentService', 'PoidService', 'ToastService'];\n    function ManagePaymentsAddController(UserService, $sce, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, PaymentService, PoidService, ToastService) {\n        \n        var vm = this;        \n\n        vm.poid_images = [];\n        vm.poid = {\n                images: []\n        };\n\n\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n        vm.customer_token = \"\";\n        $scope.iframe_url = \"\";\n\n\n        // Create a token when the form is submitted.\n        \n        $scope.get_addresses = function(){\n\n            //  trial key\n            //  auth: api-key: BP-8KOdw8ka3F2eDU-Zz-g5865   \n            //  https://api.getAddress.io/v2/uk/{postcode}\n            // PaymentService.getAddress()\n\n            PaymentService.GetAddresses(vm.postcode)\n                .then(function (data) {\n                    if(data.success){\n\n                        //console.log(\"addresses: \"+data.addresses);\n                        vm.addresses = data.addresses;\n                        //fill the drop down menu\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n\n                    }\n                });\n\n        }\n\n\n        function prefill_details(){\n\n            // UserService\n\n            document.getElementById('name').value = \"\";\n            document.getElementById('address-line1').value = \"\";\n            document.getElementById('address-line2').value = \"\";\n            document.getElementById('address-city').value = \"\";\n            document.getElementById('address-postcode').value = \"\";\n            document.getElementById('address-country').value = \"\";\n        }\n\n\n        $scope.add_card = function () {\n            \n\n            createToken();\n\n\n            // //console.log(\"CLICK\");   \n\n            //     var $form = $('#payment-form');\n            //     $form.submit(function(event) {\n            //     // Disable the submit button to prevent repeated clicks:\n            //     $form.find('.submit').prop('disabled', true);\n\n            //     // Request a token from Stripe:\n            //     //stripe.card.createToken($form, stripeResponseHandler);\n            //     //pk_test_Ers4ZfdIMZ59ac4wKy6FDAH2\n\n\n            //     stripe.createToken($form).then(function(result) {\n            //       // Handle result.error or result.token\n            //       //console.log(result);\n            //     });\n\n            //     // Prevent the form from being submitted:\n            //     return false;\n            //   });\n\n\n        };\n\n\n        $scope.delete_card = function(id){\n            //console.log(\"ID\", id);\n            var b = prompt(\"Please write YES to confirm you wish to delete the card\");\n            if(b == \"YES\"){\n                ////console.log(\"yes\");\n                PaymentService.Delete(id, vm.user.id)\n                .then(function (data) {\n\n                        ////console.log(\"delete: \", data);\n                        //fill the drop down menu\n                        PaymentService.GetByUserId(vm.user.id)\n                            .then(function (data) {\n                                //console.log(data);\n                                if(data.success){\n                                    vm.cards = data.cards;\n                                    ////console.log(\"CARDS\", vm.cards);\n                                } else {\n                                   // //console.log(\"WOOOPSIES...\");\n                                    //this should be very very rare...\n                                }\n                            });\n                  \n                });\n            }\n            \n        }\n\n\n\n\n\n\n                    //vm.selected_component = vm.components[0];\n                    //vm.selected_component = \n        function get_paybase_token(){\n\n\n                \n                    // //console.log(\"AA\", vm.selected_component);\n                PaymentService.GetUserForPayment(vm.user.id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"CAT DATA\", data);\n                        vm.cards = data.cards;\n                        vm.customer_token = data.token;\n\n                        $scope.iframe_url = $sce.trustAsResourceUrl(\"https://hosted.sandbox.paybase.io/card?t=\"+vm.customer_token);\n                        var i = 0;\n\n                        // alert(\"URL ADDED\");\n                        // $scope.$apply();\n\n                        //console.log(\"URL\", vm.iframe_url);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n            }\n\n\n            //paybase integration\n\n              var errors = document.querySelector('.errors');\n              var success = document.querySelector('.success');\n\n              window.addEventListener('message', function(ev) {\n                var data = ev.data;\n                //console.log(\"received data\", data);\n\n                //angular.element(paybase_response(data));\n                switch (data.type) {\n                  case 'success': {\n                    ////console.log(\"received data\", data);\n                    //success.innerText = data.id;\n\n                    //add card into our own system....\n\n\n                    //the response is no longer the full card object that I require - so I will send the card_id and the customer_id to the backend for it to do its magic\n                    //and when it has querried Paybase, and added the card on our system, THEN we can throw them back onto the ALL CARDS page.\n\n                    PaymentService.Create2(vm.user.id, data.id)\n                    .then(function (data2) {\n\n                        if(data2.success){\n\n                            //card was successfully added to the system... Time to boot them back to the previous page...\n\n                            $state.go('dashboard.my_account.payment_methods', {}, { reload: true });\n\n\n\n\n\n                        } else {\n                            //console.log(\"There was a ToAviate error in adding your card into our system. Please try again later.\");\n                        }\n                           \n                      \n                    });\n\n\n\n\n\n                  }\n                  break;\n                  case 'error': {\n                    //errors.innerText = data.message;  \n                    //alert(data.message);\n\n\n                    // if(data.code == \"5002\"){\n                    //     alert(\"Please check your card details are correct and match your billing address.\");\n                    //     $scope.iframe_url = $sce.trustAsResourceUrl(\"https://hosted.sandbox.paybase.io/card?t=\"+vm.customer_token);\n                    // } else {\n                    // }\n\n\n                    switch(data.code){\n\n                        case \"5002\":\n                            //card declined / incorrect details\n                            ToastService.error('Card Declined', 'Your card was declined, please verify your details or contact your card provider. Should this problem persist, please contact: info@toaviate.com');\n\n                        break;\n                        case \"4060\":\n                            //card used to exist....?\n                            ToastService.warning('Duplicate Card', 'It appears that you are adding a card that has already been added to your account');\n\n                        break;\n                        default:\n                            ToastService.error('Card Error', 'Please check your card details are correct and match your billing address.');\n\n                        break;\n\n\n\n                    }\n\n\n\n\n\n\n\n\n                    get_paybase_token();\n\n\n                    //location.reload();\n                  }\n                  break;\n                        }\n            });\n\n\n                            \n                \n          \n\n\n            get_paybase_token();\n\n\n    }\n app.controller('ManagePaymentsController', ManagePaymentsController);\n\n    ManagePaymentsController.$inject = ['UserService', '$sce', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'PaymentService', 'PoidService', 'ToastService'];\n    function ManagePaymentsController(UserService, $sce, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, PaymentService, PoidService, ToastService) {\n        \n        var vm = this;        \n\n        vm.poid_images = [];\n        vm.poid = {\n                images: []\n        };\n\n\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n        vm.customer_token = \"\";\n        $scope.iframe_url = \"\";\n\n        vm.change_address = false;\n\n\n        vm.billing_address = {\n            flatNumber: \"\",\n            houseNameNumber: \"\",\n            townCity: \"\",\n            region: \"\",\n            postalCode: \"\",\n            countryISO: \"\"\n        }\n\n\n\n\n\n        // var stripe = Stripe('pk_test_Ers4ZfdIMZ59ac4wKy6FDAH2');\n        // var elements = stripe.elements();\n\n        // var card_options = {\n        //       hidePostalCode: true,\n        //       style: {\n        //         base: {\n        //           iconColor: '#666EE8',\n        //           color: '#31325F',\n        //           lineHeight: '40px',\n        //           fontWeight: 300,\n        //           fontFamily: 'Helvetica Neue',\n        //           fontSize: '15px',\n        //           '::placeholder': {\n        //             color: '#CFD7E0',\n        //           },\n        //         },\n        //       }\n        //     };\n\n        // var card = elements.create('card', card_options);\n        // var form;\n\n\n        // var timeout;\n        // var run = false;\n        // var run2 = false;\n\n\n        // function setupStripe(){\n        //     clearTimeout(timeout);\n        //     if(run == false){\n        //         run = true;\n\n        //         card.mount('#card-element');\n            \n        //         form = document.getElementById('payment-form');\n        //         form.addEventListener('submit', function(e) {\n        //           e.preventDefault();\n        //           createToken();\n        //         });\n        //     } \n        // }   \n\n\n        // $scope.$on('$viewContentLoaded', function(){\n        //         clearTimeout(timeout);\n        //         if(run2 == false){\n        //             run2 = true;\n        //             timeout = setTimeout(function(){ setupStripe(); }, 1500); \n        //         }\n        // });\n\n     \n\n        // function stripeTokenHandler(token) {\n        //   // Insert the token ID into the form so it gets submitted to the server\n        //   var form = document.getElementById('payment-form');\n        //   var hiddenInput = document.createElement('input');\n        //   hiddenInput.setAttribute('type', 'hidden');\n        //   hiddenInput.setAttribute('name', 'stripeToken');\n        //   hiddenInput.setAttribute('value', token.id);\n        //   form.appendChild(hiddenInput);\n\n        //   // Submit the form\n        //   //console.log(\"TOKEN\", token);\n        //   //form.submit();\n        // }\n\n        // function createToken() {\n        //   //console.log(\"HELLO CREATE TOKEN? 1\");\n        //    var options = {\n        //     name: document.getElementById('name').value,\n        //      address_line1: document.getElementById('address-line1').value,\n        //     address_line2: document.getElementById('address-line2').value,\n        //     address_city: document.getElementById('address-city').value,\n        //     address_zip: document.getElementById('address-postcode').value,\n        //     address_country: document.getElementById('address-country').value,\n        //   };\n\n        //   stripe.createToken(card, options).then(function(result) {\n        //     if (result.error) {\n        //       // Inform the user if there was an error\n        //       var errorElement = document.getElementById('card-errors');\n        //       errorElement.textContent = result.error.message;\n        //     } else {\n        //       // Send the token to your server\n        //       //stripeTokenHandler(result.token);\n        //       ////console.log(\"RESULT\", result);\n\n        //       if(result.token.id){\n        //       ////console.log(\"STUFF\", result.token.id);\n\n        //         //prepare a basic object...\n        //         var obj = {\n        //             user_id: vm.user.id,\n        //             brand: result.token.card.brand,\n        //             last4: result.token.card.last4,\n        //             hash: result.token.card.id,\n        //             token: result.token.id,\n        //             exp_month: result.token.card.exp_month,\n        //             exp_year: result.token.card.exp_year,\n        //             funding: result.token.card.funding,\n        //             name: result.token.card.name,\n        //             address_postcode: result.token.card.address_zip,\n        //             client_ip: result.token.client_ip\n        //         };\n\n\n        //         PaymentService.Create(obj)\n        //         .then(function (data) {\n        //             if(data.success){\n\n        //                 //console.log(\"CARD: \"+data);\n        //                 //fill the drop down menu\n        //                 $state.go('dashboard.my_account.payment_methods', {}, { reload: true });\n\n        //             } else {\n        //                 //console.log(\"WOOOPSIES...\", data);\n        //                 //this should be very very rare...\n\n        //             }\n        //         });\n\n\n\n        //       }\n\n        //     }\n        //   });\n        // };\n\n        vm.change_address_for = \"\";\n\n\n        $scope.change_address = function(card_id){\n\n            vm.change_address_for = card_id;\n\n            PaymentService.GetCardDetails(card_id)\n                .then(function (data) {\n                    if(data){\n\n                        //console.log(\"addresses: \"+data.billingAddress);\n                        vm.billing_address = data.billingAddress;\n                        //fill the drop down menu\n                        vm.change_address = true;\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n\n                    }\n                });\n\n            // const card_deets = await response.json();\n\n\n\n        }\n\n\n        $scope.save_address = function(){\n            //vm.change_address_for\n\n            //vm.billing_address\n\n\n            //update_address here to PHP which will do the rest :-D \n             PaymentService.UpdateCard(vm.change_address_for, vm.billing_address)\n                .then(function (data) {\n                    if(data){\n\n                        //console.log(\"addresses: \"+data);\n                        vm.billing_address = {\n                            flatNumber: \"\",\n                            houseNameNumber: \"\",\n                            townCity: \"\",\n                            region: \"\",\n                            postalCode: \"\",\n                            countryISO: \"\"\n                        }\n\n                        ToastService.success('Address Saved', 'Address saved successfully.');\n\n                        //fill the drop down menu\n                        vm.change_address = false;\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n\n                    }\n                });\n\n\n        }\n\n\n        $scope.decline_change = function(){\n            vm.change_address = false;\n        }\n\n\n\n\n        // Create a token when the form is submitted.\n        \n        $scope.get_addresses = function(){\n\n            //  trial key\n            //  auth: api-key: BP-8KOdw8ka3F2eDU-Zz-g5865   \n            //  https://api.getAddress.io/v2/uk/{postcode}\n            // PaymentService.getAddress()\n\n            // PaymentService.GetAddresses(vm.postcode)\n            //     .then(function (data) {\n            //         if(data.success){\n\n            //             //console.log(\"addresses: \"+data.addresses);\n            //             vm.addresses = data.addresses;\n            //             //fill the drop down menu\n\n            //         } else {\n            //             //console.log(\"WOOOPSIES...\");\n            //             //this should be very very rare...\n\n            //         }\n            //     });GetCardDetails\n\n        }\n\n\n        function prefill_details(){\n\n            // UserService\n\n            document.getElementById('name').value = \"\";\n            document.getElementById('address-line1').value = \"\";\n            document.getElementById('address-line2').value = \"\";\n            document.getElementById('address-city').value = \"\";\n            document.getElementById('address-postcode').value = \"\";\n            document.getElementById('address-country').value = \"\";\n        }\n\n\n        $scope.changePrimary = function(card_id){\n\n\n            PaymentService.ChangePrimary(vm.user.id, card_id)\n                            .then(function (data) {\n                                //console.log(data);\n                                if(data.success){            \n\n                                    ToastService.success('Card Updated', 'Changed primary card!');\n                                    \n                                    //vm.cards = data.cards;\n                                    ////console.log(\"CARDS\", vm.cards);\n                                } else {\n                                   // //console.log(\"WOOOPSIES...\");\n                                    //this should be very very rare...\n                                }\n                            });\n\n\n\n\n        }\n\n\n        $scope.add_card = function () {\n            \n\n            createToken();\n\n\n            // //console.log(\"CLICK\");   \n\n            //     var $form = $('#payment-form');\n            //     $form.submit(function(event) {\n            //     // Disable the submit button to prevent repeated clicks:\n            //     $form.find('.submit').prop('disabled', true);\n\n            //     // Request a token from Stripe:\n            //     //stripe.card.createToken($form, stripeResponseHandler);\n            //     //pk_test_Ers4ZfdIMZ59ac4wKy6FDAH2\n\n\n            //     stripe.createToken($form).then(function(result) {\n            //       // Handle result.error or result.token\n            //       //console.log(result);\n            //     });\n\n            //     // Prevent the form from being submitted:\n            //     return false;\n            //   });\n\n\n        };\n\n\n        $scope.delete_card = function(id){\n            //console.log(\"ID\", id);\n            var b = prompt(\"Please write YES to confirm you wish to delete the card\");\n            if(b == \"YES\"){\n                ////console.log(\"yes\");\n                PaymentService.Delete(id, vm.user.id)\n                .then(function (data) {\n\n                        ////console.log(\"delete: \", data);\n                        //fill the drop down menu\n                        PaymentService.GetByUserId(vm.user.id)\n                            .then(function (data) {\n                                //console.log(data);\n                                if(data.success){\n                                    vm.cards = data.cards;\n                                    ////console.log(\"CARDS\", vm.cards);\n                                } else {\n                                   // //console.log(\"WOOOPSIES...\");\n                                    //this should be very very rare...\n                                }\n                            });\n                  \n                });\n            }\n            \n        }\n\n      \n\n\n                PaymentService.GetByUserId(vm.user.id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        vm.cards = data.cards;\n                        //console.log(\"CARDS\", vm.cards);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n        \n\n\n    }\n app.controller('ManagePoidController', ManagePoidController);\n\n    ManagePoidController.$inject = ['UserService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'LicenceService', 'PoidService', 'AuthenticationService', 'ToastService'];\n    function ManagePoidController(UserService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, LicenceService, PoidService, AuthenticationService, ToastService) {\n        \n        var vm = this;        \n\n        vm.poid_images = [];\n        vm.poid = {\n                images: []\n        };\n\n\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n        //THIS MAY BE USED LATER WHEN WE SET REAL ID TYPES\n        // PoidService.GetPoidTypes()\n        //         .then(function (data) {\n        //             vm.poid_types = data;\n        //             //console.log(\"poid_types: \", vm.poid_types);\n        //         });\n\n    \n\n\n        switch($state.current.data.action){\n            case \"add\":\n\n                    //vm.selected_component = vm.components[0];\n                    //vm.selected_component = \n                    \n\n                    // //console.log(\"AA\", vm.selected_component);\n\n            \n\n            break;\n            case \"edit\":\n\n            // //console.log(\"EDIT ONE\");\n            // //console.log(\"PARAMS: \", $stateParams);\n\n             PoidService.GetById($stateParams.poid_id, 1, 0)\n                .then(function (data) {\n                    if(data.success){\n                        vm.poid = data.poid;\n                        vm.poid.expiry_date = new Date(vm.poid.expiry_date);\n\n                        \n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n\n            break;\n            case \"list\":\n\n                //console.log(\"LIST ALL\");\n\n                 //1 get the user's poid...\n                 //list stuff\n\n                PoidService.GetByUserId(vm.user.id)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        vm.user_poids = data.poids;\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n\n\n            // $scope.add_component = function(){\n\n            //     //remove from first array\n            //     vm.components = $.grep(vm.components, function(e){ \n            //         return e.id != vm.selected_component.id; \n            //     });\n\n            //     vm.poid.components.push(vm.selected_component);\n\n            //     //clear selected\n            //     delete vm.selected_component;\n                \n            //     //clean the array to show what we want to show :)\n            //     //delete $scope.formData.license.add_to[bit_type];\n\n            // }\n\n            // $scope.remove_component = function(index){\n\n            //     //add to dropdown\n            //     vm.components.push(vm.poid.components[index]);\n            //     vm.poid.components.splice(index,1)\n\n            //     //$scope.formData.license[bit_type] = $scope.formData.license[bit_type].filter(Boolean);\n\n            //     //  //console.log($scope.formData.license[bit_type]);\n            //     //  $scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n            // }\n\n            //default add the first component required...\n            \n\n\n\n/*\n\nOLD VERSION FOR LEGACY PURPOSES\n\n  $scope.add_element = function(bit_type){\n\n                //remove from first array\n                $scope[bit_type][bit_type] = $.grep($scope[bit_type][bit_type], function(e){ \n                    return e.id != $scope.formData.license.add_to[bit_type].id; \n                });\n\n                if(bit_type == \"differences\"){\n                    $scope.formData.license.add_to[bit_type].day = true;\n                    $scope.formData.license.add_to[bit_type].vfr = true;\n                }\n                //console.log($scope.formData.license.add_to[bit_type]);\n\n                $scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n                \n                //clean the array to show what we want to show :)\n                delete $scope.formData.license.add_to[bit_type];\n\n            }\n\n\n            $scope.remove_element = function(bit_type, index){\n\n                //add to dropdown\n                $scope[bit_type][bit_type].push($scope.formData.license[bit_type][index]);\n            \n                $scope.formData.license[bit_type].splice(index,1)\n\n                $scope.formData.license[bit_type] = $scope.formData.license[bit_type].filter(Boolean);\n                //console.log($scope.formData.license[bit_type]);\n                //$scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n            }\n\n\n*/\n\n\n            //nice looking date pickers\n\n\n            $scope.popup = [];\n\n            $scope.open = function(id, $event) {\n                //console.log(\"THIS\", id);\n                //this comment would allow the event not to be affect by clicking it again... not sure this is a good idea\n                if($scope.popup[id] && $scope.popup[id].opened == true){\n                    $event.preventDefault();\n                    $event.stopPropagation();\n                } else {\n                    $scope.popup[id] = {opened: true};\n                }\n            };\n\n            $scope.formats = ['dd/MM/yyyy', 'yyyy/MM/dd', 'dd.MM.yyyy', 'shortDate'];\n            $scope.format = $scope.formats[0];\n\n            $scope.datePickerOptions = {\n                                        format: 'dd/MM/yyyy',\n                                        showWeeks: false\n                                    };\n\n           \n\n           $scope.remove_real_file = function(file){\n\n                //remove_file\n\n                vm.poid.images = $.grep(vm.poid.images, function(e){ \n                        return e.id != file.id; \n                    });\n\n                //no need to actually remove the file as it will be archived accordingly on the backend whilst it is missing! :)\n                \n\n          }\n\n\n          \n          $scope.remove_file = function(file, current_files){\n\n            //remove_file\n            var j = JSON.parse(file.file_return);\n            //console.log(\"REMOVE: \", j);\n            //console.log(\"REMOVE: \", j.saved_url);\n\n            //to delete the temp file created: j.saved_url\n            //tmp_rm.php POST tmp = filename\n            \n            PoidService.DeleteTmp(j.saved_url)\n                .then(function (data) {\n                    //console.log(data);\n                    if(data.success){\n                        //console.log(\"HUZZAH\", current_files);\n                        //then we need to remove this from the list of files...\n                        //clear files\n                        vm.poid_images = [];\n                        //and re-process available files\n                        $scope.processFiles(current_files);\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        //this should be very very rare...\n                    }\n\n                });\n\n          }\n          \n\n            $scope.processFiles = function(files){\n                // //console.log(\"files\", files);\n\n                for(var i=0; i<files.length; i++){\n                    // //console.log(\"JSON\", files[i].file_return);\n                    var j = JSON.parse(files[i].file_return);\n                    // //console.log(\"PARSED\", j);\n                    files[i].file.temp_path = j.saved_url;\n                    // //console.log(\"file\", files[i].file);\n                    vm.poid_images.push(files[i].file);\n                }\n\n\n            }\n\n\n            vm.show_loading = false;\n            vm.blurred = true;\n            vm.show_temp_login = false;\n\n              $scope.getDecrypted = function(){\n                  vm.show_loading = true;\n                  // PoidService.GetById($stateParams.medical_id, 1, 1)\n                  //   .then(function (data) {\n\n                  //       if(data.success){\n                  //           vm.medical = data.medical;\n                  //           vm.medical.examination_date = new Date(vm.medical.examination_date);\n\n                  //           vm.medical.state_of_issue = $.grep(vm.authority, function(e){ return e.id == vm.medical.authority_id; })[0];\n                  //           ////console.log(\"SET\", vm.medical.state_of_issue);\n\n                  //           //pre-selection bits?\n                  //           ////console.log(\"NEW RATINGS\", vm.medical.components);\n                  //           for(var i=0;i<vm.medical.components.length;i++){\n                  //               delete vm.medical.components[i].id;\n                  //               vm.medical.components[i].id = vm.medical.components[i].component_id;\n                  //               delete vm.medical.components[i].component_id;\n                  //               vm.medical.components[i].expiry_date = new Date(vm.medical.components[i].expiry_date);\n\n                  //               //need to remove the component from the components lists too :)\n                  //               vm.components = $.grep(vm.components, function(e){ \n                  //                   return e.id != vm.medical.components[i].id; \n                  //               });\n\n                  //           }\n\n                  //           vm.blurred = false;\n                  //           vm.show_loading = false;\n                  //       } else {\n                  //           //console.log(\"WOOOPSIES...\");\n                  //           vm.show_loading = false;\n                  //           //this should be very very rare...\n                  //       }\n\n                  //   });\n\n                 PoidService.GetById($stateParams.poid_id, 1, 1)\n                .then(function (data) {\n                    if(data.success){\n                        vm.poid = data.poid;\n                        vm.poid.expiry_date = new Date(vm.poid.expiry_date);\n\n                        vm.blurred = false;\n                        vm.show_loading = false;\n                    } else {\n                        //console.log(\"WOOOPSIES...\");\n                        if(data.fail == \"templogin\"){\n                                    //console.log(\"WOOOPSIES...\", data);\n                                    vm.show_temp_login = true;\n\n                                }\n\n                        vm.show_loading = false;\n                        //this should be very very rare...\n                    }\n\n                });\n\n              }\n\n\n              function create_sample(length) {\n                   var result           = '';\n                   var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n                   var charactersLength = characters.length;\n                   for ( var i = 0; i < length; i++ ) {\n                      result += characters.charAt(Math.floor(Math.random() * charactersLength));\n                   }\n                   return result;\n                }\n\n\n                $scope.re_login = function(){\n\n\n                      ////console.log(\"CLICKED\", vm.re_login_pass);\n\n                      //now we use the token that has been assigned already to verify the login password\n\n                        AuthenticationService.Login3(vm.re_login_pass, create_sample(120), function (response) {\n                            //console.log(\"resp\", response);\n                            if (response.success) {\n\n\n                                //we now need to call the query that was called before (decryption)\n\n                                $scope.getDecrypted();\n\n\n\n\n                                vm.show_temp_login = false;\n                            } else {\n                                ToastService.error('Wrong Password', 'This is the wrong password - please try again.');\n                            }\n                        });\n\n\n\n                      //vm.show_temp_login = true;\n\n                  }\n\n\n\n            $scope.delete_poid = function(id){\n\n              \n                var a = prompt(\"Are you sure you wish to delete this poid? \\n\\n This change is irreversible! To confirm please type YES in the box below.\");\n                if(a == \"YES\"){\n\n\n                    //console.log(\"WE DELETE IT\");\n\n\n                    PoidService.Delete(vm.user.id, id)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                                //console.log(\"HUZZAH\", data);\n                                //then we need to remove this from the list of files...\n                                vm.user_poids = $.grep(vm.user_poids, function(e){ \n                                    return e.id != id; \n                                });\n                                \n                                //refresh?\n                                $state.reload();\n                                $state.go('dashboard.my_account.poid');\n\n                            } else {\n\n                                ToastService.error('Error', data.message);\n\n                            }\n\n                        });\n\n\n\n                } else {\n                    //console.log(\"ignore123\");\n                }\n\n\n            }\n\n\n\n\n            $scope.save_poid = function(){\n                \n                vm.show_loading = true;\n\n                if(vm.poid_images.length < 1 && vm.poid.images.length < 1){\n\n                    ToastService.highlightField('.drop');\n                    ToastService.warning('Image Required', 'You must at least have 1 image of your poid!');\n                    vm.show_loading = false;\n                    return false;   \n                }\n\n\n                if(!vm.poid.expiry_date){\n                    ToastService.highlightField('expiry_date');\n                    ToastService.warning('Expiry Required', 'You must enter an expiry date for your ID.');\n                    vm.show_loading = false;\n                    return false;\n                }\n\n                 if(!vm.poid.title){\n                    ToastService.highlightField('title');\n                    ToastService.warning('ID Type Required', 'You must enter an ID Type.');\n                    vm.show_loading = false;\n                    return false;\n                }\n\n\n              \n\n                // //console.log(\"FLOW: \", vm.poid_images);\n\n\n\n                //compile the required elements YAY\n\n                // //console.log(\"LICENCE GOOD TO GO \", vm.poid);\n\n\n                 //clean shizzle before sending\n                 //why keep sending back heavy data?\n\n                    for(var i=0;i<vm.poid.images.length;i++){\n                        delete vm.poid.images[i].data_uri;\n                    }\n\n                    // vm.poid.images = vm.poid_images;\n                    vm.poid.images = vm.poid.images.concat(vm.poid_images);\n                    vm.poid.user_id = vm.user.id;\n\n\n                if(vm.poid.id){\n                    //then its an udpate\n\n                    //merge the images left?\n                    PoidService.Update(vm.poid)\n                        .then(function (data) {\n                            // //console.log(data);\n                            if(data.success){\n                                // //console.log(\"HUZZAH\", vm.poid);\n                                // //console.log(\"HUZZAH\", data);\n                                //then we need to remove this from the list of files...\n                                \n                            vm.show_loading = false;\n                                //move somewhere?\n\n                                ToastService.success('Saved', 'Your changes have been saved.');\n                                $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n\n\n\n                            } else {\n\n                                ToastService.error('Error', data.message);\n                            vm.show_loading = false;\n\n                            }\n\n                        });\n\n                } else {\n\n\n                   \n\n\n                    //then its a create\n                    // //console.log(vm.poid);\n\n                    PoidService.Create(vm.poid)\n                        .then(function (data) {\n                            // //console.log(data);\n                            if(data.success){\n                                // //console.log(\"HUZZAH\", vm.poid);\n                                // //console.log(\"HUZZAH\", data);\n                                //then we need to remove this from the list of files...\n                                vm.show_loading = false;\n    \n                                $state.go('dashboard.my_account.poid', {}, { reload: true });\n                                //move somewhere?\n                               // $state.reload();\n                               // $state.go('dashboard.my_account.poid', {}, { reload: true });\n\n\n                            } else {\n\n                                ToastService.error('Error', data.message);\n                                vm.show_loading = false;\n\n                            }\n\n                        });\n\n\n                }\n\n\n\n            };\n\n\n\n        \n        \n\n\n    }\n app.controller('ModalInstanceCtrl', ModalInstanceCtrl);\n\n    ModalInstanceCtrl.$inject = ['$scope', '$uibModalInstance', 'id', 'warning', 'params'];\n    function ModalInstanceCtrl($scope, $uibModalInstance, id, warning, params=null) {         \n\n            $scope.warning = warning;\n            $scope.params = params;\n            $scope.images = params.images;\n            //console.log(\"APARAMS\", params);\n\n          $scope.ok = function () {\n            $uibModalInstance.close(params);\n          };\n\n          $scope.cancel = function () {\n            $uibModalInstance.dismiss('cancel');\n          };\n\n          $scope.params = function(params){\n            return params;\n          }\n\n\n    }\n app.controller('MyAccountController', MyAccountController);\n\n    MyAccountController.$inject = ['UserService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'BookingService'];\n    function MyAccountController(UserService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, BookingService) {\n        \n        var vm = this;\n       \n\n        vm.user = $rootScope.globals.currentUser;\n        //console.log(\"USER HERE IS : \", vm.user);\n\n        \n        \n\n\n    }\n app.controller('MyJourneyLogsController', MyJourneyLogsController);\n\n    MyJourneyLogsController.$inject = ['UserService', 'MemberService', 'InstructorService', 'MembershipService', 'HolidayService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'BookingService', 'LicenceService', 'ClubDocumentService', 'PlaneDocumentService', '$http', 'PlaneService', '$sce', 'ToastService'];\n    function MyJourneyLogsController(UserService, MemberService, InstructorService, MembershipService, HolidayService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, BookingService, LicenceService, ClubDocumentService, PlaneDocumentService, $http, PlaneService, $sce, ToastService) {\n        \n        var vm = this;\n\n        vm.clubs = [];\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;\n\n\n        vm.looking_for = $stateParams.registration;\n        if(vm.looking_for){\n            $scope.my_search2 = vm.looking_for;\n        }\n\n\n        vm.defect_severity;\n        vm.defect_severities = [\n            { title: \"No Fly Item - Ground the plane\"},\n            { title: \"Flyable - needs to be checked at next maintenance\"},\n            { title: \"Not urgent - but needs noting\"},\n            { title: \"Unsure of severity\"}\n        ]; \n\n\n        // //console.log(\"MAIN PLANE id: \", $stateParams.plane_id);\n\n\n        ////console.log(\"REG: \"+$stateParams.registration);\n\n\n         PlaneService.GetMyJourneyLogs($stateParams.plane_id, 0, 25)\n            .then(function (data) {\n                    //console.log(\"ALL is : \", data);\n                   vm.logs = data.logs;\n                   vm.user_totals = data.user_totals;\n                   vm.aircraft = data.aircraft;\n\n\n                });\n\n            vm.current_offset = 0;\n            vm.loaded_per_batch = 25;\n            vm.all_loaded = false;\n\n            vm.load_more = function(){\n                vm.current_offset = vm.current_offset + vm.loaded_per_batch;\n                PlaneService.GetMyJourneyLogs($stateParams.plane_id, vm.current_offset, vm.loaded_per_batch)\n                .then(function (data) {\n                        //console.log(\"ALL is : \", data);\n                        if(data.logs.length > 0){\n                            data.logs.forEach(log => vm.logs.push(log));\n                        } else {\n                            vm.all_loaded = true;\n                        }\n                       //vm.logs = data.logs;\n\n\n                    });\n\n            }\n\n            vm.get_initial = function(text){\n                return text.charAt(0);\n            }\n\n\n            vm.clean_times = function(time){\n                if(time == \"00:00:00\"){\n                    return \" - \";\n                }\n                return time.substring(0,5);\n            }\n\n            vm.list_pilots = function(row){\n\n                var p1 = \"\";\n                var put = \"\";\n\n                // if(row.instructor_first_name && row.instructor_first_name !== null){\n                //     p1 = \"PIC: \"+row.instructor_first_name+\" \"+row.instructor_last_name;\n                //     put = \"<br />PUT: \"+row.first_name+\" \"+row.last_name;\n                // } else {\n                //     if(row.first_name && row.first_name !== null){\n                //         p1 = \"PIC: \"+row.first_name+\" \"+row.last_name;\n                //     } else {\n                //         p1 = \"PIC not yet set!\";\n                //     }\n                // }\n\n                p1 = \"PIC: \"+ vm.get_pic(row);\n                put = vm.get_put(row);\n                if(put && put !== \"\"){\n                    put = \"<br />PUT: \" + put;\n                }\n\n                if(p1 && p1 == \"\"){\n                    p1 = \"No PIC set yet!\";\n                }\n\n                return $sce.getTrustedHtml('<div>'+p1+' '+put+'</div>');\n\n            }\n\n            vm.get_pic = function(log){\n\n                var p1 = \"\";\n\n                if(log.pic_first_name && log.pic_first_name !== null){\n                    p1 = vm.get_initial(log.pic_first_name) + \". \" + log.pic_last_name;\n                } else if(log.instructor_first_name && log.instructor_first_name !== \"\"){\n                    p1 = vm.get_initial(log.instructor_first_name) + \". \" + log.instructor_last_name;\n                } else if(log.instructor_id == 0 && log.first_name && log.first_name !== \"\"){\n                    p1 = vm.get_initial(log.first_name) + \". \" + log.last_name;\n                }\n\n                return p1;\n\n            }\n\n            vm.get_put = function(log){\n\n                var put = \"\";\n\n                if(log.put_first_name && log.put_first_name !== null){\n                    put = vm.get_initial(log.put_first_name) + \". \" + log.put_last_name;\n                } else if(log.instructor_id > 0 && log.first_name && log.first_name !== \"\"){\n                    put = vm.get_initial(log.first_name) + \". \" + log.last_name;\n                } \n\n                return put;\n\n            }\n\n\n\n            $scope.filter_detail = function(show_all = 0){\n                return (show_all == 0) ? {status: \"open\"} : {};\n            }\n\n           \n          \n            $scope.get_icon = function(file){\n\n                var ft = file.name;\n                ft = ft.split('.').pop();\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n\n            vm.get_icon2 = function(file){\n\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n\n        \n        $scope.search = function(row){\n            ////console.log(\"hi\", (angular.lowercase(row.title).indexOf(angular.lowercase($scope.my_search) || '') !== -1));\n            return (angular.lowercase(row.title).indexOf(angular.lowercase($scope.my_search) || '') !== -1);\n        };\n\n        function convert_string_to_date(date){\n            if(date && date.indexOf(\"/\") > -1){\n                //then we prob have a date:::\n                    var d = date.split(\"/\");\n                    var rtn = d[2]+\"-\"+d[1]+\"-\"+d[0];\n                    //console.log(\"D\", rtn);\n                    return rtn;\n            }\n        }\n\n        // function check_if_month(input) {\n        //     var months = [\"jan\", \"feb\", \"mar\", \"apr\", \"may\", \"jun\", \"jul\", \"aug\", \"sep\", \"oct\", \"nov\", \"dec\"];\n\n        //     var monthPartOfInput = input.substring(0, 3).toLowerCase();                         \n\n        //     // if (months.indexOf(monthPartOfInput) == -1){\n        //     //     // TODO: Show validation error\n        //     // }\n        // }\n\n        function test_date(search, date){\n\n\n            if(search.length < 2){\n                return false;\n            }\n\n            if(search && search.length <= 3){\n                if(date.indexOf(search) > -1){\n                    return true;\n                }\n            } else {\n                var parsed_date = \"\";\n                var b = moment(search);\n                if(b.isValid() && b.format(\"YYYY\") != \"2001\"){\n                    parsed_date = b.format(\"YYYY-MM-DD\");\n                } else if(b.isValid()){\n                    parsed_date = b.format(\"MM-DD\");\n                }\n\n\n                var search_type = 0;\n\n                if(parsed_date !== \"\" && date.indexOf(parsed_date) > -1){\n                    // //console.log(\"found\");\n                    return true;\n                } else {\n\n                    //backup in case of wrong parsing data::;\n                    //european method\n\n                    if(search.length <= 5 && search.length >= 4){\n\n                        var c = moment(search, \"DDMM\");\n                        // //console.log(\"C is : \", c);\n                        if(c.isValid()){\n                            var c2 = c.format(\"MM-DD\");\n                            if(date.indexOf(c2) > -1){\n                                return true;\n                            }\n                        }\n\n                    } else if(search.length == 8 || search.length == 10){\n                        \n                        var c = moment(search, \"DDMMYYYY\");\n                        // //console.log(\"C is : \", c);\n                        if(c.isValid()){\n                            var c2 = c.format(\"YYYY-MM-DD\");\n                            if(date.indexOf(c2) > -1){\n                                return true;\n                            }\n                        }\n\n                    }\n\n                    // //console.log(\"not found\");\n                    return false;\n                }\n            }\n\n        }\n\n\n        function test_name(fname, lname, search){\n\n            var search2 = search.toLowerCase();\n            var fullname = fname+\" \"+lname;\n            fullname = fullname.toLowerCase();    \n            // //console.log(\"fullname: \", fullname);\n            // //console.log(\"search: \", search2);\n            // //console.log(\"match: \", (fullname.indexOf(search2) > -1));\n            if(search.length > 2 && (fullname.indexOf(search2) > -1) ){\n                return true;\n            } else {\n                return false;\n            }\n\n        }\n\n        function test_aircraft(registration, search){\n\n            var search2 = search.toLowerCase().replace(\"-\", \"\");\n            var fullname = registration.replace(\"-\", \"\");\n            fullname = fullname.toLowerCase();    \n            //  //console.log(\"fullname: \", fullname);\n            // //console.log(\"search: \", search2);\n            // //console.log(\"match: \", (fullname.indexOf(search2) > -1));\n            if(search.length > 2 && (fullname.indexOf(search2) > -1) ){\n                return true;\n            } else {\n                return false;\n            }\n\n        }\n\n        function test_airfield(search, name, code){\n            var name2 = name.toLowerCase();\n            var code2 = code.toLowerCase();\n            var search2 = search.toLowerCase();\n\n            if(search2.length > 2 && (name2.indexOf(search2) > -1)){\n                return true;\n            } else if(search2.length > 2 && (code2.indexOf(search2) > -1)){\n                return true;\n            } else {\n                return false;\n            }\n\n\n\n        }\n\n        $scope.search2 = function(row){\n            //(angular.lowercase(row.first_name).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)  || (angular.lowercase(row.last_name).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)\n            ////console.log(\"answer\", (angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1));\n            // return ((angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || (angular.lowercase(row.flight_time).indexOf(angular.lowercase($scope.my_search2)) || '') !== -1)));\n            //(angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)\n           \n            // if( (test_date($scope.my_search2, row.flight_date)) || (angular.lowercase(row.destination_airport).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) || (angular.lowercase(row.departure_airport).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) || (angular.lowercase(row.destination_airport_code).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) || (angular.lowercase(row.departure_airport_code).indexOf(angular.lowercase($scope.my_search2) || '') !== -1)){\n            //     return true;\n            // } else {\n            //     return false;\n            // }\n            ////console.log($scope.my_search2);\n            if(!$scope.my_search2 || ($scope.my_search2 == \"\")){\n                return true;\n            }else if(test_date($scope.my_search2, row.flight_date)){\n                return true;\n            } else if(test_name(row.first_name, row.last_name, $scope.my_search2 )){\n                return true;\n            } else if(test_aircraft(row.aircraft.registration, $scope.my_search2 )){\n                return true;\n            } else if(test_airfield($scope.my_search2, row.departure_airport, row.departure_airport_code)){\n                return true;\n            } else if(test_airfield($scope.my_search2, row.destination_airport, row.destination_airport_code)){\n                return true;\n            }else {\n                return false;\n            }\n\n            // we are testing for the date, the pilot, the departure and destination.\n\n            // return (angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1); // ? (angular.lowercase(row.flight_date).indexOf(angular.lowercase($scope.my_search2) || '') !== -1) : (angular.lowercase(row.flight_time).indexOf(angular.lowercase($scope.my_search2) || '') !== -1);\n\n        };\n\n        $scope.getMySearchCount = function(str){\n            var docs = str.documents;\n            var total = 0;\n            for(var i=0;i<docs.length;i++){\n                if($scope.search(docs[i])){\n                    total++;\n                }\n            }\n            return total;\n        }\n\n        $scope.getMySearchCount2 = function(str){\n            var charges = str.charges;\n            var total = 0;\n            for(var i=0;i<charges.length;i++){\n                if($scope.search(charges[i])){\n                    total++;\n                }\n            }\n            return total;\n        }\n\n        //  $scope.get_hours_from_decimal = function(time){\n\n        //     if(time){\n        //         var n = new Date(0,0);\n        //         n.setMinutes(+time * 60);\n        //         return n.toTimeString().slice(0,5);\n        //     } else {\n        //         return \"N/A\";\n        //     }\n\n        // }\n\n        $scope.get_hours_from_decimal = function(time){\n\n            if(time){\n                 var sign = time < 0 ? \"-\" : \"\";\n                 var hour = Math.floor(Math.abs(time));\n                 var min = Math.round((Math.abs(time) * 60) % 60);\n                 if(min == 60){\n                     hour++;\n                     min = 0;\n                 }\n                 return sign + (hour < 10 ? \"0\" : \"\") + hour + \":\" + (min < 10 ? \"0\" : \"\") + min;\n             } else {\n                 return \"N/A\";\n             }\n        }\n\n\n\n\n\n        $scope.downloadDocument = function(doc, type) {\n            var data = $.param({\n                id: doc\n            });\n\n            //alert(\"type\", type);\n\n            var controller = \"plane_documents\";\n\n            switch(type){\n                 case \"radio\": \n                    controller = \"plane_radio_licence\";\n                break;\n                 case \"insurance\": \n                    controller = \"plane_insurance\";\n                break;\n                 case \"certificate\": \n                    controller = \"plane_certificate\";\n                break;\n                case \"noise\": \n                    controller = \"plane_documents\";\n                break;\n                case \"docs\": \n                    controller = \"plane_documents\";\n                break;\n                default:\n                    controller = \"plane_documents\";\n                break;\n            }\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/'+controller+'/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        $scope.downloadClubDocument = function(doc) {\n            var data = $.param({\n                id: doc\n            });\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n\n            $http.get('api/v1/club_documents/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n        // vm.list_pilots = function(row){\n\n        //     var p1 = \"\";\n        //     var put = \"\";\n\n        //     if(row.instructor_first_name && row.instructor_first_name !== null){\n        //         p1 = \"PIC: \"+row.instructor_first_name+\" \"+row.instructor_last_name;\n        //         put = \"<br />PUT: \"+row.first_name+\" \"+row.last_name;\n        //     } else {\n        //         p1 = \"PIC: \"+row.first_name+\" \"+row.last_name;\n        //     }\n\n        //     return $sce.getTrustedHtml('<div>'+p1+' '+put+'</div>');\n\n        // }\n\n        function processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], {\n                    type: contentType\n                });\n                if (navigator.msSaveBlob)\n                    navigator.msSaveBlob(blob, filename);\n                else {\n                    // Try using other saveBlob implementations, if available\n                    var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                    if (saveBlob === undefined) throw \"Not supported\";\n                    saveBlob(blob, filename);\n                }\n                success = true;\n            } catch (ex) {\n                $log.info(\"saveBlob method failed with the following exception:\");\n                $log.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            $log.info(\"Download link method with simulated click failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n\n\n        $scope.get_icon2 = function(file){\n                //console.log(\"FILE\", file);\n                if(!file || file == \"\"){\n                    return \"\";\n                }\n                var ft = file.split('.').pop();\n                // //console.log(\"ICON 2 : \", ft);\n                var icon_name = \"\";\n\n                // //console.log(\"FILE:\", ft);\n                // //console.log(\"index : \", ft.indexOf(\"pdf\"));\n                switch(true){\n                    case (ft.indexOf(\"pdf\") > -1):\n                        icon_name = \"pdf.png\";\n                    break;\n                    case (ft.indexOf(\"doc\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"docx\") > -1):\n                        icon_name = \"doc.png\";\n                    break;\n                    case (ft.indexOf(\"xls\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"xlsx\") > -1):\n                        icon_name = \"xls.png\";\n                    break;\n                    case (ft.indexOf(\"ppt\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"pptx\") > -1):\n                        icon_name = \"ppt.png\";\n                    break;\n                    case (ft.indexOf(\"jpg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"jpeg\") > -1):\n                        icon_name = \"jpg.png\";\n                    break;\n                    case (ft.indexOf(\"png\") > -1):\n                        icon_name = \"png.png\";\n                    break;\n                    case (ft.indexOf(\"gif\") > -1):\n                        icon_name = \"gif.png\";\n                    break;\n                    case (ft.indexOf(\"zip\") > -1):\n                        icon_name = \"zip.png\";\n                    break;\n                    case (ft.indexOf(\"avi\") > -1):\n                        icon_name = \"avi.png\";\n                    break;\n                    case (ft.indexOf(\"mp4\") > -1):\n                        icon_name = \"mp4.png\";\n                    break;\n                    default:\n                        icon_name = \"file.png\";\n                    break;\n                }\n\n                // //console.log(\"FILE:\", icon_name);\n\n                return \"images/file_icons/\"+icon_name;\n            }\n      \n\n\n\n    }\n app.controller('NewChargeModalInstanceCtrl', NewChargeModalInstanceCtrl);\n\n    NewChargeModalInstanceCtrl.$inject = ['$scope', '$uibModalInstance', 'id', 'warning', 'MemberService', 'ClubService', '$rootScope', 'PaymentService', 'params', 'EnvConfig', 'ToastService'];\n    function NewChargeModalInstanceCtrl($scope, $uibModalInstance, id, warning, MemberService, ClubService, $rootScope, PaymentService, params=null, EnvConfig, ToastService) {         \n\n            $scope.warning = warning;\n            $scope.params = params;\n            //console.log(\"APARAMS\", params);\n\n            $scope.to_refund = 0;\n            $scope.reason = \"\";\n            $scope.club_id = $rootScope.globals.currentUser.current_club_admin.id;\n\n            $scope.club_settings = {};\n\n            $scope.new_client = {\n              first_name: \"\",\n              last_name: \"\",\n              email: \"\"\n            };\n\n            $scope.items = [];\n            $scope.item = {\n              title: \"\",\n              quantity: 0,\n              vat: 0,\n              price: 0\n            };\n\n            $scope.selected_client;\n            $scope.selected_card;\n\n            $scope.members = [];\n\n            $scope.show_direct_debit_details = false;\n\n            ClubService.GetById($scope.club_id)\n            .then(function(data){\n                $scope.club_settings = data;\n                $scope.item.vat = $scope.club_settings.vat_rate;\n                $scope.club_settings.vat_registered = ($scope.club_settings.vat_registered == 1)? true : false;\n                //console.log(\"settings\", $scope.club_settings);\n            });\n\n            MemberService.GetAllByClub($scope.club_id)\n                    .then(function(data){\n                        $scope.members = data;   \n                        $scope.members.unshift({id: -12, first_name: \"New\", last_name: \"Client\"});\n                        // $scope.item.title = \"hjel\";\n                        //console.log(\"members\",$scope.members);\n                    });\n\n\n            $scope.delete_receipt = function(number){\n\n                \n              $scope.items.splice(number, 1);\n           \n              calculate_charges();\n\n            }\n\n            $scope.card_selected = function(data){\n              $scope.selected_card = data;\n\n              if(data.id == -12){\n                 setTimeout(function(){\n                  setupStripe();\n                }, 1000);\n              }\n\n            }\n\n            $scope.member_selected = function(data){\n              //console.log(\"selected\", data);\n              \n              $scope.selected_client = data;\n\n              if(data && data.account_ending && data.account_ending !== ''){\n                  $scope.show_direct_debit_details = true;\n                } else {\n                  $scope.show_direct_debit_details = false;\n                   setTimeout(function(){\n                    setupStripe();\n                  }, 1000);\n\n\n                }\n\n              if(data && data.id == -12){\n                \n                setTimeout(function(){\n                  setupStripe();\n                }, 1000);\n\n              } \n            }\n\n            $scope.add_item = function(item_sent){\n                $scope.item = item_sent;\n\n                // //console.log(\"HELLO ADDING\", item_sent);\n                // //console.log(\"HELLO ADDING\", $scope.items);\n\n                $scope.items.push($scope.item);\n\n                // //console.log(\"OBJ TO SEND: \", $scope.item);\n\n               \n                $scope.item = {\n                            quantity: 0,\n                            price: 0,\n                            vat: $scope.club_settings.vat_rate,\n                            title: \"\"\n                          };\n\n                calculate_charges();\n\n            }\n\n\n            function calculate_charges(){\n\n\n              // //console.log(\"Calculate everything now...\");\n              var total = 0;\n              var the_vat = 0;\n              for(var i=0; i < $scope.items.length; i++){\n\n                $scope.items[i].total = ($scope.items[i].quantity * $scope.items[i].price);\n                if($scope.items[i].vat > 0){\n                  this_vat = ( $scope.items[i].total * ($scope.items[i].vat / 100) );\n                  the_vat = the_vat + this_vat;\n                }\n                total = total + $scope.items[i].total;\n\n              }\n\n              $scope.the_vat = the_vat;\n              $scope.the_total = total;\n\n            }\n\n\n\n\n\n\n          $scope.ok = function () {\n            // Validation\n            if (!$scope.items || $scope.items.length < 1) {\n                ToastService.error('No Items', 'Please add at least one item to the invoice.');\n                return;\n            }\n            if (!$scope.selected_client || !$scope.selected_client.id) {\n                ToastService.error('Missing: Client', 'Please select a client to charge.');\n                return;\n            }\n            if ($scope.selected_client.id == -12) {\n                if (!$scope.new_client.first_name || !$scope.new_client.first_name.trim()) {\n                    ToastService.error('Missing: First Name', 'Please enter the new client\\'s first name.');\n                    return;\n                }\n                if (!$scope.new_client.last_name || !$scope.new_client.last_name.trim()) {\n                    ToastService.error('Missing: Last Name', 'Please enter the new client\\'s last name.');\n                    return;\n                }\n                if (!$scope.new_client.email || !$scope.new_client.email.trim()) {\n                    ToastService.error('Missing: Email', 'Please enter the new client\\'s email address.');\n                    return;\n                }\n            }\n            var obj = params;\n\n\n            //let's create all that is required to issue the invoice.\n            if($scope.selected_client.id == -12){\n\n\n              $scope.selected_client.first_name = $scope.new_client.first_name;\n              $scope.selected_client.last_name = $scope.new_client.last_name;\n              $scope.selected_client.email = $scope.new_client.email;\n\n            } else{\n\n               $scope.selected_client.first_name = $scope.selected_client.first_name;\n               $scope.selected_client.last_name = $scope.selected_client.last_name;\n               $scope.selected_client.email = $scope.selected_client.email;\n            \n            }\n\n            if($scope.selected_client.id == -12 || !$scope.show_direct_debit_details){\n              //if there is a custom card entered - then we continue here...\n\n              var options = {};\n              stripe.createToken(card, options).then(function(result) {\n                if (result.error) {\n                  // Inform the user if there was an error\n                  var errorElement = document.getElementById('card-errors');\n                  errorElement.textContent = result.error.message;\n                } else {\n\n                  //stripeTokenHandler(result.token);\n                  ////console.log(\"RESULT\", result);\n\n                  if(result.token.id){\n                    ////console.log(\"STUFF\", result.token.id);\n\n                    //prepare a basic object...\n                    var card_obj = {\n                        brand: result.token.card.brand,\n                        last4: result.token.card.last4,\n                        hash: result.token.card.id,\n                        token: result.token.id,\n                        funding: result.token.card.funding,\n                        name: result.token.card.name,\n                        client_ip: result.token.client_ip\n                    };\n\n\n                    var obj_to_send = {\n                      payment: card_obj,\n                      items: $scope.items,\n                      user: $scope.selected_client,\n                      club_id: $scope.club_id\n                    };\n\n\n                    // SAMPLE OF WHERE WE NEED TO SEND THE SHIZZLE....\n                    PaymentService.CreateCustom(obj_to_send)\n                    .then(function (data) {\n                        if(data.success){\n\n                            ////console.log(\"CARD: \"+data);\n                            //fill the drop down menu\n                            //$state.go('dashboard.my_account.payment_methods', {}, { reload: true });\n                            $uibModalInstance.close(data);\n                        } else {\n                            //console.log(\"WOOOPSIES...\", data);\n                            //this should be very very rare...\n\n                        }\n                    });\n                    \n\n\n                  }\n\n                }\n              });\n\n            } else {\n\n              //this should now be when we charge a saved card.\n\n              //create a new charge request? is that server side?\n\n\n              var obj_to_send = {\n                  payment: {},\n                  items: $scope.items,\n                  user: $scope.selected_client,\n                  club_id: $scope.club_id\n                };\n\n                if($scope.selected_client.account_ending !== \"\"){\n                  obj_to_send.payment.direct_debit = true;\n                }\n\n\n              PaymentService.CreateCustom(obj_to_send)\n                    .then(function (data) {\n                        if(data.success){\n\n                            ////console.log(\"CARD: \"+data);\n                            //fill the drop down menu\n                            //$state.go('dashboard.my_account.payment_methods', {}, { reload: true });\n                            $uibModalInstance.close(data);\n                        } else {\n                            //console.log(\"WOOOPSIES...\", data);\n                            //this should be very very rare...\n\n                        }\n                    });\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n              //then we don't need a stripe token...\n\n               // SAMPLE OF WHERE WE NEED TO SEND THE SHIZZLE....\n              // PaymentService.Create(obj)\n              // .then(function (data) {\n              //     if(data.success){\n\n              //         //console.log(\"CARD: \"+data);\n              //         //fill the drop down menu\n              //         $state.go('dashboard.my_account.payment_methods', {}, { reload: true });\n                //            $uibModalInstance.close(obj);\n\n              //     } else {\n              //         //console.log(\"WOOOPSIES...\", data);\n              //         //this should be very very rare...\n\n              //     }\n              // });\n\n\n\n\n\n            }\n            \n\n\n\n\n          };\n\n          $scope.cancel = function () {\n            $uibModalInstance.dismiss('cancel');\n          };\n\n          $scope.params = function(params){\n            return params;\n          }\n\n\n\n\n\n\n\n\n\n          //STRIPE STUFF HERE PLEASE!!! :-)\n\n\n        var stripe = Stripe(EnvConfig.getStripeKeyLegacy());\n        var elements = stripe.elements();\n\n        var card_options = {\n              hidePostalCode: true,\n              style: {\n                base: {\n                  iconColor: '#666EE8',\n                  color: '#31325F',\n                  lineHeight: '40px',\n                  fontWeight: 300,\n                  fontFamily: 'Helvetica Neue',\n                  fontSize: '15px',\n                  '::placeholder': {\n                    color: '#CFD7E0',\n                  },\n                },\n              }\n            };\n\n        var card = elements.create('card', card_options);\n\n        var run = false;\n        var timeout;\n\n        function setupStripe(){\n            clearTimeout(timeout);\n            if(run == false){\n                run = true;\n\n                card.mount('#card-element');\n            \n                form = document.getElementById('payment-form');\n                form.addEventListener('submit', function(e) {\n                  e.preventDefault();\n                  createToken();\n                });\n            } \n        }   \n\n\n        // $scope.$on('$viewContentLoaded', function(){\n        //         clearTimeout(timeout);\n        //         if(run2 == false){\n        //             run2 = true;\n        //             timeout = setTimeout(function(){ setupStripe(); }, 1500); \n        //         }\n        // });\n\n     \n\n        function stripeTokenHandler(token) {\n          // Insert the token ID into the form so it gets submitted to the server\n          var form = document.getElementById('payment-form');\n          var hiddenInput = document.createElement('input');\n          hiddenInput.setAttribute('type', 'hidden');\n          hiddenInput.setAttribute('name', 'stripeToken');\n          hiddenInput.setAttribute('value', token.id);\n          form.appendChild(hiddenInput);\n\n          // Submit the form\n          //console.log(\"TOKEN\", token);\n          //form.submit();\n        }\n\n        function create_invoice() {\n          //console.log(\"HELLO CREATE TOKEN? 1\");\n           var options = {\n            // name: document.getElementById('name').value,\n            //  address_line1: document.getElementById('address-line1').value,\n            // address_line2: document.getElementById('address-line2').value,\n            // address_city: document.getElementById('address-city').value,\n            // address_zip: document.getElementById('address-postcode').value,\n            // address_country: document.getElementById('address-country').value,\n          };\n\n          stripe.createToken(card, options).then(function(result) {\n            if (result.error) {\n              // Inform the user if there was an error\n              var errorElement = document.getElementById('card-errors');\n              errorElement.textContent = result.error.message;\n            } else {\n              // Send the token to your server\n              //stripeTokenHandler(result.token);\n              ////console.log(\"RESULT\", result);\n\n              if(result.token.id){\n              ////console.log(\"STUFF\", result.token.id);\n\n                //prepare a basic object...\n                var obj = {\n                    user_id: vm.user.id,\n                    brand: result.token.card.brand,\n                    last4: result.token.card.last4,\n                    hash: result.token.card.id,\n                    token: result.token.id,\n                    funding: result.token.card.funding,\n                    name: result.token.card.name,\n                    client_ip: result.token.client_ip\n                };\n\n\n                PaymentService.Create(obj)\n                .then(function (data) {\n                    if(data.success){\n\n                        //console.log(\"CARD: \"+data);\n                        //fill the drop down menu\n                        $state.go('dashboard.my_account.payment_methods', {}, { reload: true });\n\n                    } else {\n                        //console.log(\"WOOOPSIES...\", data);\n                        //this should be very very rare...\n\n                    }\n                });\n\n\n\n              }\n\n            }\n          });\n        };\n\n\n\n\n\n\n\n    }\n app.controller('PassengerSignupCompleteController', PassengerSignupCompleteController);\n\n    PassengerSignupCompleteController.$inject = ['UserService', '$rootScope', '$location', '$scope', '$state', '$stateParams', 'ToastService'];\n    function PassengerSignupCompleteController(UserService, $rootScope, $location, $scope, $state, $stateParams, ToastService) {\n        \t\n\n\t    \t ////console.log(\"HELLO\");\n\t\t    ////console.log($scope.membership);\n\n\n\t\t    var vm = this;\n\n\t\t    $scope.checked_identity = false;\n\t\t    $scope.is_already_user = false;\n\n\t\t    $scope.submit_button = \"SUBMIT INFORMATION\";\n\n\n        \t$scope.formData = {};\n\n\n        \tif($scope.formData.password && $scope.formData.password !== \"\" && $scope.formData.password == $scope.formData.password2){\n\n        \t\t$scope.submit_button = \"SUBMIT INFORMATION & CREATE YOUR ACCOUNT\";\n        \t\n        \t}\n\n\n\n\n         \t// we will store all of our form data in this object\n\t\t    if($stateParams.token){\n\n    \t\t\t\t////console.log(\"STATE\", $state.current.url);\n\n    \t\t\t\tif(!$scope.checked_identity && $state.current.url !== \"/check\"){\n    \t\t\t\t\t$state.go(\"passenger_signup_complete.check\");\n    \t\t\t\t}\n\n    \t\t\t// UserService.GetInvite($stateParams.token)\n       //          .then(function (data) {\n\t    \t\t// \t////console.log(\"GETTING TOKEN\", data);\n\n\n       //              if(data){\n\n       //              \t$scope.total_invite = data;\n                    \t\n       //              \t$scope.formData.first_name = data.first_name;\n\t\t    \t// \t\t$scope.formData.last_name = data.last_name;\n\t\t    \t// \t\t$scope.formData.email = data.email;\n\t\t    \t// \t\t$scope.formData.membership_id = data.membership_id;\n\t\t    \t// \t\t$scope.formData.club_id = data.club_id;\n\t\t    \t// \t\t$scope.formData.to_pay = data.to_pay;\n\t\t    \t// \t\t$scope.formData.token = data.invitation_token;\n\n\t\t    \t// \t\t//maybe?\n\t\t    \t// \t\t$scope.formData.invited_by = data.invited_by;\n\n\t\t    \t// \t\tif(data.user_id > 0){\n\t\t    \t// \t\t\t//console.log(\"UID set\", data.user_id);\n\t\t    \t// \t\t\t$cookies.put(\"uid\", data.user_id);\n\t\t    \t// \t\t}\n\n\t\t    \t// \t\t//$cookies.set(\"rid\", data.membership.request.membership_request_id);\n\t\t    \t// \t\t//other data::\n\n\t\t    \t// \t\t$scope.club = data.club;\n\t\t    \t// \t\t$scope.membership = data.membership;\n\n\t\t    \t// \t\t$scope.all = data;\n\n       //              \t////console.log(\"success\");\n       //              } else {\n       //              \talert(\"Sorry we were unable to find this invitation... Please try clicking the link again.\")\n       //              \t$state.go(\"login\");\n       //              }\n       //          });\n\n    \t\t} else {\n\n    \t\t\t$state.go(\"login\");\n    \t\t}\n\n\n\n    \t\t$scope.gotologin = function(){\n    \t\t\t$state.go(\"login\");\n    \t\t}\n\t\t    \n\t\t    // $scope.checkValid = function(uisref){\n\t\t    // \tif(!uisref){\n\t\t    // \t\tuisref = $(\".btn-info\").attr(\"one-ui-sref\");\n\t\t    // \t}\n\t\t    // \t//if less than 18 show the guardian form\n\t\t    // \tif(checking_validity()){\n\t\t\t   //  \tif($scope.formData.password == $scope.formData.password2){\n\t\t\t   //  \t\t$state.go(uisref);\n\t\t    // \t\t} else {\n\t\t\t   //  \t\t$(\"input[type='password']\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n\t\t    // \t\t\treturn false;\n\t\t    // \t\t}\n\t\t\t   //  \t//console.log($('#signup-form')[0].checkValidity());\n\t\t\t   //  } else {\n\t\t\t   //  \treturn false;\n\t\t\t   //  }\n\t\t    \t\n\t\t    // }\n\n\n\n\t\t    $scope.formcode = [];\n\t\t   $scope.checkedcode = 0;\n\t\t   $scope.goToNextInput = function(event, number) {\n\t\t   \t // //console.log(event.keyCode);\n\t\t   \t // //console.log(number);\n\t\t   \t var no_len = document.getElementById(\"index\"+(number - 1) ).value;\n\t\t   \t // //console.log(no_len.toString().length);\n\n\t\t   \t // //console.log(document.getElementById(\"index\"+(number - 1) ).value);\n\t\t   \t\n\n\n\t\t   \t if(number == 1 && (event.keyCode == 91 || event.keyCode == 17) && no_len.toString().length == 6){\n\t\t   \t \t// //console.log(\"MATCHINGS\", );\n\t\t   \t \tvar thecode = Array.from(no_len.toString());\n\t\t   \t \tfor(var i=0; i<6; i++){\n\t\t   \t \t\t$scope.formcode.push(parseInt(thecode[i]));\n\t\t   \t \t}\n\n\t\t   \t \tdocument.getElementById(\"index5\").focus();\n\t\t   \t \tnumber =6;\n\t\t   \t\t//return false;\n\t\t   \t } else {\n\t\t   \t \t\t//event.keyCode\n\t\t\t\t   \tif(event.keyCode == 37 && number > 0){\n\t\t\t\t   \t\tdocument.getElementById(\"index\"+(number - 2)).focus();\n\t\t\t\t   \t\treturn false;\n\t\t\t\t   \t}\n\t\t\t\t   \tif(event.keyCode == 39 && number < 6){\n\t\t\t\t   \t\tdocument.getElementById(\"index\"+(number)).focus();\n\t\t\t\t   \t\treturn false;\n\t\t\t\t   \t}\n\t\t\t\t   \tif(event.keyCode == 8 && number > 1 && document.getElementById(\"index\"+(number - 1) ).value == \"\"){\n\t\t\t\t   \t\t// //console.log(\"match\");\n\t\t\t\t   \t\t// //console.log(\"index\"+(number - 2));\n\t\t\t\t   \t\tdocument.getElementById(\"index\"+(number - 2)).focus();\n\t\t\t\t   \t\treturn false;\n\t\t\t\t   \t}\n\t\t   \t }\n\n\n\t\t   \n\n\n\t\t   \tif(number == 6 && $scope.formcode.length == 6){\n\t\t   \t\tvar combine = $scope.formcode.join(\"\");\n\t\t   \t\t// //console.log(\"COMPLETE\", combine);\n\t\t   \t\t$scope.checkedcode++;\n\t\t   \t\t// //console.log(\"tries\", $scope.checkedcode);\n\n\t\t   \t\tif($scope.checkedcode > 4){\n\t\t   \t\t\tToastService.error('Too Many Attempts', 'Sorry - you have tried too many times, this code is now invalid and a new invitation will be sent to you.');\n\n\t\t   \t\t\t//send another invitation code to the recipient \n\n\n\n\t\t   \t\t\treturn false;\n\t\t   \t\t} else {\n\n\t\t   \t\t\t//let's send this out for verification!!\n\t\t   \t\t\tUserService.GetPaxSecureInvite2($stateParams.token, combine)\n\t                .then(function (data) {\n\t                \t// //console.log(\"GET SECURE INVITE\", data);\n\t                \tif(data.success){\n\n\t                \t\tif(data.invitation.is_already_user){\n\n\t                \t\t\t$scope.formData.user_id = data.invitation.user_id;\n\t                \t\t\t$scope.formData.token = $stateParams.token;\n\t                \t\t\t$scope.checked_identity = true;\n\t                \t\t\t$state.go(\"passenger_signup_complete.your_profile\");\n\t                \t\t} else {\n\n\t                \t\t\t\n\t                \t\t\tToastService.error('Invitation Not Found', 'We couldn\\'t match your invitation with our records - if you think you have an account, please go to the login screen and click the forgotten password link.');\n\t                \t\t\treturn false;\n\t                \t\t}\n\n\t                \t\t\n\n\t                \t} else {\n\t                \t\tToastService.error('Error', data.message);\n\t                \t\treturn false;\n\t                \t}\n\n\t                });\n\n\n\t\t   \t\t}\n\n\n\t\t   \t\treturn false;\n\t\t   \t}\n\n\n\t\t    var entry = document.getElementById(\"index\"+(number - 1) ).value;\n\t\t    if(entry > -1 && entry < 10 && entry !== \"\"){\n\t\t    \tdocument.getElementById(\"index\"+number).focus();\n\t\t    } else {\n\t\t    \tdocument.getElementById(\"index\"+(number - 1) ).value = \"\";\n\t\t    \tdocument.getElementById(\"index\"+(number - 1)).focus();\n\t\t    \treturn false;\n\t\t    }\n\n\t\t  }\n\n\t\t    $scope.submit_user_for_signup = function(){\n\n\n\t\t    \tif($scope.formData.password !== $scope.formData.password2 || $scope.formData.password.length < 8){\n\t\t    \t\tToastService.warning('Password Mismatch', 'Please ensure your password is at least 8 characters and both of these match');\n\t\t    \t\treturn false;\n\t\t    \t}\n\n\t\t    \t//prepare the items!!\n\t\t    \t////console.log($scope.formData);\n\n\t\t    \t//if we get here we have a fully completed form and are ready to send it to create a user.\n\t\t    \n\t\t    \tvar to_send = {\n\t\t    \t\tuser_id: $scope.formData.user_id,\n\t\t    \t\ttoken: $scope.formData.token,\n\t\t    \t\tpassword: $scope.formData.password\n\t\t    \t}\n\n\t\t    \t////console.log(\"SENDING\", to_send);\n\n\n\t    \t\tUserService.SignupUserFromPassenger($stateParams.token, to_send)\n                .then(function (data) {\n                \t// //console.log(\"GET SECURE INVITE\", data);\n                \tif(data.success){\n\t\t\t\t    \t\n                \t\t//this is successful - now let's clear the contents:\n                \t\t$scope.formData = {};\n                \t\t//and let's remove the top links\n                \t\t$scope.checked_identity = false;\n                \t\t$state.go(\"passenger_signup_complete.thank_you\");\n                \t\t\n                \t} else {\n                \t\tToastService.error('Error', data.message);\n                \t}\n                });\n\n\t\t    }\n\n}\n\n\n\n app.controller('PassengerSignupController', PassengerSignupController);\n\n    PassengerSignupController.$inject = ['UserService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$http', 'ToastService'];\n    function PassengerSignupController(UserService, $rootScope, $location, $scope, $state, $stateParams, $http, ToastService) {\n        \t\n\n\t    \t //console.log(\"HELLO\");\n\t\t    ////console.log($scope.membership);\n\n\n\t\t    var vm = this;\n\n\t\t    $scope.checked_identity = false;\n\t\t    $scope.is_already_user = false;\n\n\t\t    $scope.submit_button = \"SUBMIT INFORMATION\";\n\n\n        \t$scope.formData = {};\n\n\n        \tif($scope.formData.password && $scope.formData.password !== \"\" && $scope.formData.password == $scope.formData.password2){\n\n        \t\t$scope.submit_button = \"SUBMIT INFORMATION & CREATE YOUR ACCOUNT\";\n        \t\n        \t}\n\n\n\n\n         \t// we will store all of our form data in this object\n\t\t    if($stateParams.token){\n\n    \t\t\t\t////console.log(\"STATE\", $state.current.url);\n\n    \t\t\t\tif(!$scope.checked_identity && $state.current.url !== \"/check\"){\n    \t\t\t\t\t$state.go(\"passenger_signup.check\");\n    \t\t\t\t}\n\n    \t\t\t// UserService.GetInvite($stateParams.token)\n       //          .then(function (data) {\n\t    \t\t// \t////console.log(\"GETTING TOKEN\", data);\n\n\n       //              if(data){\n\n       //              \t$scope.total_invite = data;\n                    \t\n       //              \t$scope.formData.first_name = data.first_name;\n\t\t    \t// \t\t$scope.formData.last_name = data.last_name;\n\t\t    \t// \t\t$scope.formData.email = data.email;\n\t\t    \t// \t\t$scope.formData.membership_id = data.membership_id;\n\t\t    \t// \t\t$scope.formData.club_id = data.club_id;\n\t\t    \t// \t\t$scope.formData.to_pay = data.to_pay;\n\t\t    \t// \t\t$scope.formData.token = data.invitation_token;\n\n\t\t    \t// \t\t//maybe?\n\t\t    \t// \t\t$scope.formData.invited_by = data.invited_by;\n\n\t\t    \t// \t\tif(data.user_id > 0){\n\t\t    \t// \t\t\t//console.log(\"UID set\", data.user_id);\n\t\t    \t// \t\t\t$cookies.put(\"uid\", data.user_id);\n\t\t    \t// \t\t}\n\n\t\t    \t// \t\t//$cookies.set(\"rid\", data.membership.request.membership_request_id);\n\t\t    \t// \t\t//other data::\n\n\t\t    \t// \t\t$scope.club = data.club;\n\t\t    \t// \t\t$scope.membership = data.membership;\n\n\t\t    \t// \t\t$scope.all = data;\n\n       //              \t////console.log(\"success\");\n       //              } else {\n       //              \talert(\"Sorry we were unable to find this invitation... Please try clicking the link again.\")\n       //              \t$state.go(\"login\");\n       //              }\n       //          });\n\n    \t\t} else {\n\n    \t\t\t$state.go(\"login\");\n    \t\t}\n\n\n\n\n\t\t    var calculate_age = function(birthday) { // birthday is a date\n\t\t    \t//console.log(birthday);\n\t\t\t    var ageDifMs = Date.now() - birthday.getTime();\n\t\t\t    var ageDate = new Date(ageDifMs); // miliseconds from epoch\n\t\t\t    return Math.abs(ageDate.getUTCFullYear() - 1970);\n\t\t\t}\n\n\t\t\t$scope.guardian = false;\n\n\t\t\t$scope.validate_age = function(){\n\t\t\t\tif(checking_validity()){\n\t\t\t\t\t//console.log($scope.formData.passenger);\n\t\t\t\t\tvar age = calculate_age($scope.formData.dob);\n\t\t\t\t\t//console.log(\"age is : \"+age);\n\t\t\t\t\tif(age < 18){\n\t\t\t\t\t\t//$state.go(under);\n\t\t\t\t\t\t$scope.guardian = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//$state.go(over);\n\t\t\t\t\t\t$scope.guardian = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\n\n\n\t\t\t$scope.next_of_kin = function(){\n\t\t    \t if(! $('#signup-form')[0].checkValidity()){\n\t\t    \t\t$(\".ng-pristine\").not(\".ng-valid\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n\t\t    \t\t//console.log(\"STOP\");\n\t\t    \t\treturn false;\n\t\t    \t}\n\t\t\t\t$state.go('passenger_signup.next_of_kin');\n\t\t\t}\n\n\t\t\tvar checking_validity = function(){\n\t\t    \t// if(! $('#signup-form')[0].checkValidity()){\n\t\t    \t// \t$(\".ng-pristine\").not(\".ng-valid\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n\t\t    \t// \t//console.log(\"STOP\");\n\t\t    \t// \treturn false;\n\t\t    \t// } else {\n\t\t    \t// \tif(!$scope.formData.passenger){\n\t\t\t\t   //  \t\t$state.go(\"user_signup.your_profile\");\n\t\t    \t// \t}\n\t\t    \t// \t// if($scope.formData.user.password == $scope.formData.user.password2){\n\t\t\t    // \t// \t$state.go(uisref);\n\t\t    \t// \t// } else {\n\t\t\t    // \t// \t$(\"input[type='password']\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n\t\t    \t// \t// \treturn false;\n\t\t    \t// \t// }\n\t\t    \t// }\n\t\t    \treturn true;\n\t\t    }\n\n\t\t    $scope.check_nok = function(){\n\t\t    \tif(! $('#signup-form')[0].checkValidity()){\n\t\t    \t\t$(\".ng-pristine\").not(\".ng-valid\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n\t\t    \t\t//console.log(\"STOP\");\n\t\t    \t\treturn false;\n\t\t    \t}\n\t\t    \t$state.go(\"passenger_signup.tnc\");\n\t\t    }\n\t\t    \n\t\t    $scope.checkValid = function(uisref){\n\t\t    \tif(!uisref){\n\t\t    \t\tuisref = $(\".btn-info\").attr(\"one-ui-sref\");\n\t\t    \t}\n\t\t    \t//if less than 18 show the guardian form\n\t\t    \tif(checking_validity()){\n\t\t\t    \tif($scope.formData.password == $scope.formData.password2){\n\t\t\t    \t\t$state.go(uisref);\n\t\t    \t\t} else {\n\t\t\t    \t\t$(\"input[type='password']\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n\t\t    \t\t\treturn false;\n\t\t    \t\t}\n\t\t\t    \t//console.log($('#signup-form')[0].checkValidity());\n\t\t\t    } else {\n\t\t\t    \treturn false;\n\t\t\t    }\n\t\t    \t\n\t\t    }\n\n\t\t    $scope.submit_passenger = function(){\n\n\t\t    \t//prepare the items!!\n\t\t    \t//console.log($scope.formData);\n\n\n\t\t    \t//verification of the profile page\n\t\t    \tif(! $scope.formData.first_name || ! $scope.formData.last_name || ! $scope.formData.email || ! $scope.formData.dob){\n\t\t    \t\tToastService.warning('Incomplete Details', 'Please complete your personal details');\n\t\t    \t\t$state.go(\"passenger_signup.your_profile\");\n\t\t    \t\treturn false;\n\t\t    \t}\n\n\t\t    \tif(calculate_age($scope.formData.dob) < 18){\n\t\t    \t\t//need to confirm guardian information was filled out\n\t\t    \t\tif( !$scope.formData.guardian || ! $scope.formData.guardian.first_name || ! $scope.formData.guardian.last_name || ! $scope.formData.guardian.dob || ! $scope.formData.guardian.guardianship ){\n\t\t    \t\t\tToastService.warning('Guardian Required', 'As you are under the age of 18, your guardian needs to complete their details.');\n\t\t\t    \t\t$state.go(\"passenger_signup.your_profile\");\n\t\t\t    \t\treturn false;\n\t\t    \t\t}\n\n\t\t    \t\tif(calculate_age($scope.formData.guardian.dob) < 18){\n\t\t    \t\t\tToastService.warning('Invalid Guardian', 'Your guardian needs to be over the age of 18 to legally enable you to go flying.');\n\t\t    \t\t\t$state.go(\"passenger_signup.your_profile\");\n\t\t\t    \t\treturn false;\n\t\t    \t\t}\n\n\t\t    \t}\n\n\t\t    \t//this is the first page of verifications complete - now we need to do the NOK checks, and the TnC checks then we're good to go and create this.create\n\t\t    \tif(! $scope.formData.nok || ! $scope.formData.nok.first_name || ! $scope.formData.nok.last_name || ! $scope.formData.nok.email_address || ! $scope.formData.nok.relationship || ! $scope.formData.nok.phone_number  || ! $scope.formData.nok.address){\n\t\t    \t\t\tToastService.warning('Missing Next of Kin', 'Your next of kin information needs to be complete - in case of an emergency, or an accident, we must be able to contact them.');\n\t\t    \t\t\t$state.go(\"passenger_signup.next_of_kin\");\n\t\t\t    \t\treturn false;\n\t\t    \t}\n\n\t\t    \t//and now we verify the terms and conditions that have been agreed\n\n\t\t    \tif(! $scope.formData.tnc || ! $scope.formData.club_tnc){\n\t\t    \t\tToastService.warning('Terms Required', 'Please tick to confirm that you have read, understood and agreed to the terms and conditions of both the software and the flight organisation.');\n\t\t\t    \treturn false;\n\t\t    \t}\n\n\n\t\t    \t//if we get here we have a fully completed form and are ready to send it to create a user.\n\n\n\n\t\t    \t//let us prepare the content that needs to be sent back here:::\n\t\t    \tvar self_dob = new Date($scope.formData.dob);\n\n\t\t    \tif($scope.formData.guardian){\n\t\t\t    \t$scope.formData.guardian.dob = $scope.formData.guardian.dob.format(\"yyyy-MM-dd\")\n\t\t    \t}\n\n\t\t    \tvar to_send = {\n\t\t    \t\tuser_id: $scope.formData.user_id,\n\t\t    \t\tfirst_name: $scope.formData.first_name,\n\t\t    \t\tlast_name: $scope.formData.last_name,\n\t\t    \t\temail: $scope.formData.email,\n\t\t    \t\tdob: $scope.formData.dob.format(\"yyyy-MM-dd\"),\n\t\t    \t\tclub_id: $scope.formData.club_id,\n\t\t    \t\tclub_tnc: $scope.formData.club_tnc,\n\t\t    \t\ttnc: $scope.formData.tnc,\n\t\t    \t\tnok: $scope.formData.nok,\n\t\t    \t\tguardian: $scope.formData.guardian,\n\t\t    \t\tbooking_id: $scope.formData.booking_id,\n\t\t    \t\ttoken: $scope.formData.token,\n\t\t    \t\tmembership_id: 0,\n\t\t    \t\tinvited_by: $scope.formData.invited_by\n\t\t    \t}\n\n\t\t    \t////console.log(\"SENDING\", to_send);\n\n\n\t    \t\tUserService.ConfirmPaxInvite($stateParams.token, to_send)\n                .then(function (data) {\n                \t// //console.log(\"GET SECURE INVITE\", data);\n                \tif(data.success){\n\t\t\t\t    \t\n                \t\t//this is successful - now let's clear the contents:\n                \t\t$scope.formData = {};\n                \t\t//and let's remove the top links\n                \t\t$scope.checked_identity = false;\n\n\n                \t} else {\n                \t\tToastService.error('Error', data.message);\n                \t\treturn false;\n                \t}\n\n                });\n\n\n\n\n\t\t    \t$state.go(\"passenger_signup.thank_you\");\n\n\n\n\n\n\n\n\t\t    }\n\n\n\n\n\n\t\t    $scope.downloadClubDocument = function(doc) {\n            var data = $.param({\n                id: doc\n            });\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n            $http.defaults.headers.common['Api-Key'] = \"eW91a25vd25vdGhpbmdqb25zbm93\";\n\n            $http.get('api/v1/term_documents/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n\n        function titlepath(path,name){\n\n        //In this path defined as your pdf url and name (your pdf name)\n            var prntWin = window.open();\n            prntWin.document.write(\"<html><head><title>\"+name+\"</title></head><body>\"\n                + '<embed width=\"100%\" height=\"100%\" name=\"plugin\" src=\"'+ path+ '\" '\n                + 'type=\"application/pdf\" internalinstanceid=\"21\"></body></html>');\n            prntWin.document.close();\n        }\n\n        function processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], {\n                    //type: contentType\n                    type: 'application/pdf'\n                });\n\n                var fileURL = URL.createObjectURL(blob);\n                titlepath(fileURL, \"Secure Documents\");\n\n                // if (navigator.msSaveBlob)\n                //     navigator.msSaveBlob(blob, filename);\n                // else {\n                //     // Try using other saveBlob implementations, if available\n                //     var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                //     if (saveBlob === undefined) throw \"Not supported\";\n                //     saveBlob(blob, filename);\n                // }\n                success = true;\n            } catch (ex) {\n                $log.info(\"saveBlob method failed with the following exception:\");\n                $log.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            $log.info(\"Download link method with simulated click failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n\n\n\n\n\n\n\n\n\n\n\t\t   $scope.formcode = [];\n\t\t   $scope.checkedcode = 0;\n\t\t   $scope.goToNextInput = function(event, number) {\n\t\t   \t // //console.log(event.keyCode);\n\t\t   \t // //console.log(number);\n\t\t   \t var no_len = document.getElementById(\"index\"+(number - 1) ).value;\n\t\t   \t // //console.log(no_len.toString().length);\n\n\t\t   \t // //console.log(document.getElementById(\"index\"+(number - 1) ).value);\n\t\t   \t\n\n\n\t\t   \t if(number == 1 && (event.keyCode == 91 || event.keyCode == 17) && no_len.toString().length == 6){\n\t\t   \t \t// //console.log(\"MATCHINGS\", );\n\t\t   \t \tvar thecode = Array.from(no_len.toString());\n\t\t   \t \tfor(var i=0; i<6; i++){\n\t\t   \t \t\t$scope.formcode.push(parseInt(thecode[i]));\n\t\t   \t \t}\n\n\t\t   \t \tdocument.getElementById(\"index5\").focus();\n\t\t   \t \tnumber =6;\n\t\t   \t\t//return false;\n\t\t   \t } else {\n\t\t   \t \t\t//event.keyCode\n\t\t\t\t   \tif(event.keyCode == 37 && number > 0){\n\t\t\t\t   \t\tdocument.getElementById(\"index\"+(number - 2)).focus();\n\t\t\t\t   \t\treturn false;\n\t\t\t\t   \t}\n\t\t\t\t   \tif(event.keyCode == 39 && number < 6){\n\t\t\t\t   \t\tdocument.getElementById(\"index\"+(number)).focus();\n\t\t\t\t   \t\treturn false;\n\t\t\t\t   \t}\n\t\t\t\t   \tif(event.keyCode == 8 && number > 1 && document.getElementById(\"index\"+(number - 1) ).value == \"\"){\n\t\t\t\t   \t\t// //console.log(\"match\");\n\t\t\t\t   \t\t// //console.log(\"index\"+(number - 2));\n\t\t\t\t   \t\tdocument.getElementById(\"index\"+(number - 2)).focus();\n\t\t\t\t   \t\treturn false;\n\t\t\t\t   \t}\n\t\t   \t }\n\n\n\t\t   \n\n\n\t\t   \tif(number == 6 && $scope.formcode.length == 6){\n\t\t   \t\tvar combine = $scope.formcode.join(\"\");\n\t\t   \t\t// //console.log(\"COMPLETE\", combine);\n\t\t   \t\t$scope.checkedcode++;\n\t\t   \t\t// //console.log(\"tries\", $scope.checkedcode);\n\n\t\t   \t\tif($scope.checkedcode > 4){\n\t\t   \t\t\tToastService.error('Too Many Attempts', 'Sorry - you have tried too many times, this code is now invalid and a new invitation will be sent to you.');\n\n\t\t   \t\t\t//send another invitation code to the recipient \n\n\n\n\t\t   \t\t\treturn false;\n\t\t   \t\t} else {\n\n\t\t   \t\t\t//let's send this out for verification!!\n\t\t   \t\t\tUserService.GetPaxSecureInvite($stateParams.token, combine)\n\t                .then(function (data) {\n\t                \t// //console.log(\"GET SECURE INVITE\", data);\n\t                \tif(data.success){\n\n\t                \t\tif(data.invitation.is_already_user){\n\n\t                \t\t\t$scope.is_already_user = true;\n\n\t\t\t\t\t\t\t\t$scope.formData.user_id = data.invitation.user_id;\n\t\t\t\t\t\t\t\t// //console.log(\"UID\", $scope.formData.user_id);\n\t\t\t\t\t\t\t\t$scope.formData.first_name = data.invitation.user.first_name;\n\t                \t\t\t$scope.formData.last_name = data.invitation.user.last_name;\n\t                \t\t\t$scope.formData.email = data.invitation.user.email;\n\t                \t\t\t$scope.formData.dob = new Date(data.invitation.user.dob);\n\t                \t\t\t$scope.formData.club = data.invitation.club;\n\t                \t\t\t$scope.formData.guardian = data.invitation.user.guardian;\n\t                \t\t\t$scope.formData.nok = data.invitation.user.nok;\n\t                \t\t\t$scope.formData.membership_id = data.invitation.membership_id;\n\t                \t\t\t$scope.formData.club_id = data.invitation.club_id;\n\t                \t\t\t$scope.formData.token = data.invitation.invitation_token;\n\t                \t\t\t$scope.formData.status = data.invitation.status;\n\t                \t\t\t$scope.formData.invited_by = data.invitation.invited_by;\n\t                \t\t\t$scope.formData.booking_id = data.invitation.booking_id;\n\n\t                \t\t\tif(data.invitation.user.guardian && data.invitation.user.guardian.first_name !== \"\"){\n\t                \t\t\t\t$scope.guardian = true;\n\t                \t\t\t}\n\n\t                \t\t} else {\n\n\t                \t\t\t$scope.formData.first_name = data.invitation.first_name;\n\t                \t\t\t$scope.formData.last_name = data.invitation.last_name;\n\t                \t\t\t$scope.formData.email = data.invitation.email;\n\t                \t\t\t$scope.formData.membership_id = data.invitation.membership_id;\n\t                \t\t\t$scope.formData.club_id = data.invitation.club_id;\n\t                \t\t\t$scope.formData.token = data.invitation.invitation_token;\n\t                \t\t\t$scope.formData.status = data.invitation.status;\n\t                \t\t\t$scope.formData.invited_by = data.invitation.invited_by;\n\t                \t\t\t$scope.formData.booking_id = data.invitation.booking_id;\n\t                \t\t\t$scope.formData.club = data.invitation.club;\n\n\t                \t\t}\n\n\t                \t\t$scope.checked_identity = true;\n\t                \t\t$state.go(\"passenger_signup.your_profile\");\n\n\t                \t} else {\n\t                \t\tToastService.error('Error', data.message);\n\t                \t\treturn false;\n\t                \t}\n\n\t                });\n\n\n\t\t   \t\t}\n\n\n\t\t   \t\treturn false;\n\t\t   \t}\n\n\n\t\t    var entry = document.getElementById(\"index\"+(number - 1) ).value;\n\t\t    if(entry > -1 && entry < 10 && entry !== \"\"){\n\t\t    \tdocument.getElementById(\"index\"+number).focus();\n\t\t    } else {\n\t\t    \tdocument.getElementById(\"index\"+(number - 1) ).value = \"\";\n\t\t    \tdocument.getElementById(\"index\"+(number - 1)).focus();\n\t\t    \treturn false;\n\t\t    }\n\n\t\t  }\n\n\t\t\n\n\n\n\n\n\t\t    // $scope.submit_button_data = function(){\n\t\t    // \tif($scope.formData.password && $scope.formData.password !== \"\" && $scope.formData.password == $scope.formData.password2){\n\n\t     //    \t\t$scope.submit_button = \"SUBMIT INFORMATION & CREATE YOUR ACCOUNT\";\n\t        \t\n\t     //    \t} else {\n\t     //    \t\t$scope.submit_button = \"SUBMIT INFORMATION & GO FLYING\";\n\t     //    \t}\n\t\t    // }\n\n\n\n\n\n\n\n\n\n\n\n   //       \t$scope.clubs = { clubs: [\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 1,\n\t\t\t//     \t\ttitle: \"Alouette Flying Club\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 2,\n\t\t\t//     \t\ttitle: \"EFG Flying Club\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 3,\n\t\t\t//     \t\ttitle: \"Surrey & Kent Flying Club\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 4,\n\t\t\t//     \t\ttitle: \"Arrow Flight Club\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 5,\n\t\t\t//     \t\ttitle: \"Cirrus Flying Club\"\n\t\t\t//     \t}\n\t\t //    \t]\t\t    \t\n\t\t //    };\n\n\n\t\t //    $scope.memberships = { memberships: [\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 1,\n\t\t\t//     \t\ttitle: \"honory membership\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 2,\n\t\t\t//     \t\ttitle: \"day membership\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 3,\n\t\t\t//     \t\ttitle: \"social membership\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 4,\n\t\t\t//     \t\ttitle: \"full flying membership\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 5,\n\t\t\t//     \t\ttitle: \"temporary flying membership\"\n\t\t\t//     \t}\n\t\t //    \t]\t\t    \t\n\t\t //    };\n\n\t\t //    $scope.state = { state: [\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 2,\n\t\t\t//     \t\ttitle: \"France\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 3,\n\t\t\t//     \t\ttitle: \"Netherlands\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 4,\n\t\t\t//     \t\ttitle: \"Germany\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 5,\n\t\t\t//     \t\ttitle: \"Spain\"\n\t\t\t//     \t}\n\t\t //    \t]\t\t    \t\n\t\t //    };\n\n\t\t //    $scope.licenses = { licenses: [\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 1,\n\t\t\t//     \t\ttitle: \"EASA PPL\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 2,\n\t\t\t//     \t\ttitle: \"EASA CPL\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 3,\n\t\t\t//     \t\ttitle: \"EASA ATPL\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 4,\n\t\t\t//     \t\ttitle: \"UK NPPL\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 5,\n\t\t\t//     \t\ttitle: \"FAA SPL\"\n\t\t\t//     \t}\n\t\t //    \t]\t\t    \t\n\t\t //    };\n\n\t\t //    $scope.medicals = { medicals: [\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 1,\n\t\t\t//     \t\ttitle: \"EASA MEDICAL\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 2,\n\t\t\t//     \t\ttitle: \"UK MEDICAL EXAMINATION\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 3,\n\t\t\t//     \t\ttitle: \"FAA MEDICAL\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 4,\n\t\t\t//     \t\ttitle: \"NZ CAA MEDICAL\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 5,\n\t\t\t//     \t\ttitle: \"FAA SPL MEDICAL\"\n\t\t\t//     \t}\n\t\t //    \t]\t\t    \t\n\t\t //    };\n\n\t\t //    $scope.person = {};\n\n\t\t //    $scope.person.selectedSingle = 'Samantha';\n\t\t //  \t$scope.person.selectedSingleKey = '5';\n\n\t\t //  \t$scope.people = [\n\t\t\t//     { name: 'Adam',      email: 'adam@email.com',      age: 12, country: 'United States' },\n\t\t\t//     { name: 'Amalie',    email: 'amalie@email.com',    age: 12, country: 'Argentina' },\n\t\t\t//     { name: 'Estefana', email: 'estefania@email.com', age: 21, country: 'Argentina' },\n\t\t\t//     { name: 'Adrian',    email: 'adrian@email.com',    age: 21, country: 'Ecuador' },\n\t\t\t//     { name: 'Wladimir',  email: 'wladimir@email.com',  age: 30, country: 'Ecuador' },\n\t\t\t//     { name: 'Samantha',  email: 'samantha@email.com',  age: 30, country: 'United States' },\n\t\t\t//     { name: 'Nicole',    email: 'nicole@email.com',    age: 43, country: 'Colombia' },\n\t\t\t//     { name: 'Natasha',   email: 'natasha@email.com',   age: 54, country: 'Ecuador' },\n\t\t\t//     { name: 'Michael',   email: 'michael@email.com',   age: 15, country: 'Colombia' },\n\t\t\t//     { name: 'Nicols',   email: 'nicolas@email.com',    age: 43, country: 'Colombia' }\n\t\t //  \t];\n\n\n\n\n\n\t\t //    $scope.ratings = { ratings: [\n\t\t\t    \t\n\t\t\t// \t\t{\n\t\t\t//     \t\tid: 1,\n\t\t\t//     \t\ttitle: \"SEP (land)\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 2,\n\t\t\t//     \t\ttitle: \"SEP (sea)\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 3,\n\t\t\t//     \t\ttitle: \"MEP (land)\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 4,\n\t\t\t//     \t\ttitle: \"MEP (sea)\"\n\t\t\t//     \t},\n\t\t\t    \t\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 1,\n\t\t\t//     \t\ttitle: \"Night Rating\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 2,\n\t\t\t//     \t\ttitle: \"Instrument Rating Restricted IR(r)\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 3,\n\t\t\t//     \t\ttitle: \"Instrument Rating\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 4,\n\t\t\t//     \t\ttitle: \"Aerobatics Rating\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 5,\n\t\t\t//     \t\ttitle: \"High Performance Aircraft Rating\"\n\t\t\t//     \t}\n\t\t //    \t]\t\t    \t\n\t\t //    };\n\n\t\t //    $scope.differences = { differences: [\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 1,\n\t\t\t//     \t\ttitle: \"Variable Pitch\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 2,\n\t\t\t//     \t\ttitle: \"Retractable Gear\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 3,\n\t\t\t//     \t\ttitle: \"Turbo Differences Training\"\n\t\t\t//     \t},\n\t\t\t//     \t{\n\t\t\t//     \t\tid: 4,\n\t\t\t//     \t\ttitle: \"EFIS Differences Training\"\n\t\t\t//     \t}\n\t\t //    \t]\t\t    \t\n\t\t //    };\n\n\n\t\t //    //may need to alter this one to reflect most common one depending on\n\t\t //    //the license type\n\t\t //    $scope.formData = {\n\t\t //    \tpassenger: {}\n\t\t //    };\n\n\t\t //    var calculate_age = function(birthday) { // birthday is a date\n\t\t //    \t//console.log(birthday);\n\t\t\t//     var ageDifMs = Date.now() - birthday.getTime();\n\t\t\t//     var ageDate = new Date(ageDifMs); // miliseconds from epoch\n\t\t\t//     return Math.abs(ageDate.getUTCFullYear() - 1970);\n\t\t\t// }\n\n\t\t\t// $scope.validate_age = function(under, over){\n\t\t\t// \tif(checking_validity()){\n\t\t\t// \t\t//console.log($scope.formData.passenger);\n\t\t\t// \t\tvar age = calculate_age($scope.formData.passenger.dob);\n\t\t\t// \t\t//console.log(\"age is : \"+age);\n\t\t\t// \t\tif(age < 18){\n\t\t\t// \t\t\t$state.go(under);\n\t\t\t// \t\t} else {\n\t\t\t// \t\t\t$state.go(over);\n\t\t\t// \t\t}\n\t\t\t// \t}\n\t\t\t// }\n\n\t\t //    $scope.add_element = function(bit_type){\n\n\t\t //    \t//remove from first array\n\t\t //    \t$scope[bit_type][bit_type] = $.grep($scope[bit_type][bit_type], function(e){ \n\t\t\t// \t\treturn e.id != $scope.formData.license.add_to[bit_type].id; \n\t\t\t// \t});\n\n\t\t //    \tif(bit_type == \"differences\"){\n\t\t //    \t\t$scope.formData.license.add_to[bit_type].day = true;\n\t\t //    \t\t$scope.formData.license.add_to[bit_type].vfr = true;\n\t\t //    \t}\n\t\t //    \t//console.log($scope.formData.license.add_to[bit_type]);\n\n\t\t //    \t$scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n\t\t    \t\n\t\t //    \t//clean the array to show what we want to show :)\n\t\t //    \tdelete $scope.formData.license.add_to[bit_type];\n\n\t\t //    }\n\n\n\t\t //    $scope.remove_element = function(bit_type, index){\n\n\t\t \n \t\t// \t\t//add to dropdown\n\t\t\t// \t$scope[bit_type][bit_type].push($scope.formData.license[bit_type][index]);\n\n\t\t    \n\t\t\t// \t$scope.formData.license[bit_type].splice(index,1)\n\n\t\t //    \t$scope.formData.license[bit_type] = $scope.formData.license[bit_type].filter(Boolean);\n\t\t //    \t//console.log($scope.formData.license[bit_type]);\n\t\t //    \t//$scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n\n\t\t //    }\n\n\t\t //    var checking_validity = function(){\n\t\t //    \tif(! $('#signup-form')[0].checkValidity()){\n\t\t //    \t\t$(\".ng-pristine\").not(\".ng-valid\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n\t\t //    \t\t//console.log(\"STOP\");\n\t\t //    \t\treturn false;\n\t\t //    \t} else {\n\t\t //    \t\tif(!$scope.formData.passenger){\n\t\t\t// \t    \t\t$state.go(\"user_signup.your_profile\");\n\t\t //    \t\t}\n\t\t //    \t\t// if($scope.formData.user.password == $scope.formData.user.password2){\n\t\t\t//     \t// \t$state.go(uisref);\n\t\t //    \t\t// } else {\n\t\t\t//     \t// \t$(\"input[type='password']\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n\t\t //    \t\t// \treturn false;\n\t\t //    \t\t// }\n\t\t //    \t}\n\t\t //    \treturn true;\n\t\t //    }\n\t\t    \n\t\t //    $scope.checkValid = function(uisref){\n\t\t //    \tif(!uisref){\n\t\t //    \t\tuisref = $(\".btn-info\").attr(\"one-ui-sref\");\n\t\t //    \t}\n\t\t //    \t//if less than 18 show the guardian form\n\t\t //    \tif(checking_validity()){\n\t\t\t//     \tif($scope.formData.passenger.password == $scope.formData.passenger.password2){\n\t\t\t//     \t\t$state.go(uisref);\n\t\t //    \t\t} else {\n\t\t\t//     \t\t$(\"input[type='password']\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n\t\t //    \t\t\treturn false;\n\t\t //    \t\t}\n\t\t\t//     \t//console.log($('#signup-form')[0].checkValidity());\n\t\t\t//     } else {\n\t\t\t//     \treturn false;\n\t\t\t//     }\n\t\t    \t\n\t\t //    }\n\n\n\t\t //    // function to process the form\n\t\t //    $scope.processForm = function() {\n\t\t //         if ($scope.formData.$valid) {\n\t  //               alert('our form is amazing');\n\t  //           } \n\t\t //    };\n\n    }\n\n\n\n\n\n\n\n app.controller('PasswordResetController', PasswordResetController);\n\n    PasswordResetController.$inject = ['UserService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', 'PoidService',  'LicenceService', 'MedicalService', 'DifferencesService', 'AuthenticationService', 'ToastService'];\n    function PasswordResetController(UserService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, PoidService,  LicenceService, MedicalService, DifferencesService, AuthenticationService, ToastService) {\n        var vm = this;\n\n       \n        vm.show_error = false;\n        vm.show_error2 = false;\n\n        vm.show_thankyou = false;\n\n        $scope.password_reset = function(){\n\n            if (!vm.email || vm.email.trim() === '') {\n                ToastService.highlightField('reset_email');\n                ToastService.warning('Email Required', 'Please enter your email address.');\n                return false;\n            }\n\n            if (/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/.test(vm.email)){\n\n                  AuthenticationService.ResetPassword(vm.email, function(data){\n                        ////console.log(data);\n                        vm.show_thankyou = true;\n                        vm.show_error = false;\n\n                    });\n\n            } else {\n\n                ToastService.highlightField('reset_email');\n                ToastService.warning('Invalid Email', 'Please enter a valid email address.');\n                vm.show_error = true;\n\n            }\n\n          \n        }\n\n        $scope.go_login = function(){\n            $location.path(\"/login\");\n        }\n\n        $scope.password_reset2 = function(){\n\n            if(!vm.password || vm.password === \"\"){\n                ToastService.highlightField('new_password');\n                ToastService.warning('Password Required', 'Please enter a new password.');\n                vm.show_error = true;\n                return false;\n            }\n\n            if(vm.password.length < 8){\n                ToastService.highlightField('new_password');\n                ToastService.warning('Password Too Short', 'Your password must be at least 8 characters.');\n                vm.show_error2 = true;\n                return false;\n            }\n\n            var strongPassword = new RegExp('(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[^A-Za-z0-9])(?=.{8,})')\n            if(strongPassword.test(vm.password)) {\n              //console.log(\"password strength OK\");\n            } else {\n              ToastService.highlightField('new_password');\n              vm.show_error = true;\n              ToastService.warning('Weak Password', 'Your password must be at least 8 characters in length, contain 1 uppercase, 1 lowercase, 1 number, and 1 special character');\n              return false;\n            }\n\n                AuthenticationService.ResetPassword2(vm.password, $stateParams.token, function(data){\n                        ////console.log(data);\n                        vm.show_thankyou = true;\n                        vm.show_error = false;\n                        vm.show_error2 = false;\n\n                        vm.thank_you = data.message;\n\n\n                    });\n\n        }\n\n    \n\n         \n\n\n    }\n app.controller('RefundModalInstanceCtrl', RefundModalInstanceCtrl);\n\n    RefundModalInstanceCtrl.$inject = ['$scope', '$uibModalInstance', 'id', 'warning', 'params', 'ToastService'];\n    function RefundModalInstanceCtrl($scope, $uibModalInstance, id, warning, params=null, ToastService) {         \n\n            $scope.warning = warning;\n            $scope.params = params;\n            //console.log(\"APARAMS\", params);\n\n            $scope.to_refund = 0;\n            $scope.reason = \"\";\n            $scope.remaining = (params.amount - params.amount_refunded);\n\n\n\n          $scope.ok = function () {\n            if (!$scope.to_refund || $scope.to_refund <= 0) {\n                ToastService.error('Missing: Refund Amount', 'Please enter an amount greater than zero to refund.');\n                var el = document.querySelector('input[name=\"refund_amount\"]');\n                if (el) { el.classList.add('field-error-highlight'); el.scrollIntoView({ behavior: 'smooth', block: 'center' }); el.focus(); }\n                return;\n            }\n            if ($scope.to_refund > $scope.remaining) {\n                ToastService.error('Invalid Amount', 'The refund amount cannot exceed ' + $scope.remaining + '.');\n                return;\n            }\n            if (!$scope.reason || !$scope.reason.trim()) {\n                ToastService.error('Missing: Reason', 'Please provide a reason for this refund.');\n                return;\n            }\n            var obj = params;\n            obj.reason = $scope.reason;\n            obj.to_refund = $scope.to_refund\n            $uibModalInstance.close(obj);\n          };\n\n          $scope.cancel = function () {\n            $uibModalInstance.dismiss('cancel');\n          };\n\n          $scope.params = function(params){\n            return params;\n          }\n\n\n    }\napp.controller('RegisterController', RegisterController);\n \n    RegisterController.$inject = ['UserService', '$location', '$rootScope', 'FlashService', '$stateParams', 'ToastService'];\n    function RegisterController(UserService, $location, $rootScope, FlashService, $stateParams, ToastService) {\n        var vm = this;\n        vm.verify_status = \"\";\n \n        vm.register = register;\n \n        function register() {\n            //  Pre-submit validation with highlight + scroll \n            if (!vm.user || !vm.user.first_name || vm.user.first_name.trim() === '') {\n                ToastService.highlightField('first_name');\n                ToastService.warning('First Name Required', 'Please enter your first name.');\n                return;\n            }\n            if (!vm.user.last_name || vm.user.last_name.trim() === '') {\n                ToastService.highlightField('last_name');\n                ToastService.warning('Last Name Required', 'Please enter your last name.');\n                return;\n            }\n            if (!vm.user.email || vm.user.email.trim() === '') {\n                ToastService.highlightField('email');\n                ToastService.warning('Email Required', 'Please enter your email address.');\n                return;\n            }\n            if (!vm.user.password || vm.user.password === '') {\n                ToastService.highlightField('password');\n                ToastService.warning('Password Required', 'Please enter a password.');\n                return;\n            }\n            var strongPassword = new RegExp('(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[^A-Za-z0-9])(?=.{8,})');\n            if (!strongPassword.test(vm.user.password)) {\n                ToastService.highlightField('password');\n                ToastService.warning('Weak Password', 'Your password must be at least 8 characters, containing 1 uppercase, 1 lowercase, 1 number, and 1 special character.');\n                return;\n            }\n\n            vm.dataLoading = true;\n            UserService.Create(vm.user)\n                .then(function (response) {\n                    if (response.success) {\n                        ToastService.success('Registration Successful', 'Please check your email to verify your account.');\n                        $location.path('/registration_success');\n                    } else {\n                        ToastService.error('Registration Failed', response.error || 'Something went wrong. Please try again.');\n                        vm.dataLoading = false;\n                    }\n                });\n        }\n\n\n        if($stateParams.token && $stateParams.userId){\n\n            //console.log(\"THIS IS A VERIFY TOKEN\");\n\n             UserService.Verify($stateParams.userId, $stateParams.token)\n                .then(function (response) {\n                    if (response.success) {\n                        vm.title = \"Thank You!\";\n                        vm.verify_status = \"Your email address has been verified.\";\n                    } else {\n                        vm.title = \"Sorry!\";\n                        vm.verify_status = \"Sorry - something went wrong here! Please try clicking the link your email again. Should this still be a problem, please contact support.\";\n                    }\n                });\n\n        }            \n\n\n           \n\n\n    \n\n\n\n\n\n\n\n    }\n\n app.controller('ReviewBookingsController', ReviewBookingsController);\n\n    ReviewBookingsController.$inject = ['UserService','$cookieStore', 'BookingService', 'BookoutService', '$rootScope','$scope',  '$location', 'AuthenticationService', 'ToastService'];\n    function ReviewBookingsController(UserService, $cookieStore, BookingService, BookoutService, $rootScope, $scope, $location, AuthenticationService, ToastService) {\n        var vm = this;\n\n        if(!$rootScope.globals.currentUser){\n            AuthenticationService.CheckLoggedIn()\n            .then(function(data){\n                //console.log(\"DATA : \", data);\n            });\n        }\n\n        vm.user = $rootScope.globals.currentUser;\n        // //console.log(\"ROOTSCOPE\", $rootScope.globals);\n\n         //CheckLoggedIn\n\n        vm.bookings = [];\n        \n        // //console.log(\"vmuser\", vm.user);\n        vm.allUsers = [];\n\n        vm.clubs = [];\n\n        var defaultStartTime = 480;\n        var defaultEndTime = 1080;\n        //calendar dates setup\n        var newDate = new Date();\n        var h_start = Math.floor( defaultStartTime / 60 );          \n        var i_start = defaultStartTime % 60;\n        var h_end = Math.floor( defaultEndTime / 60 );          \n        var i_end = defaultEndTime % 60;\n        var defaultStart = new Date(newDate.getFullYear(), newDate.getMonth(), newDate.getDate(), h_start, i_start, 0);\n        var defaultEnd = new Date(newDate.getFullYear(), newDate.getMonth(), newDate.getDate(), h_end, i_end, 0);\n        vm.default_date =  new Date();\n\n        initController();\n\n        function initController() {\n           //console.log(\"check if access is okay\");\n        }\n\n\n\n\n        //vm.default_date\n\n        function get_the_approval_list(){\n            BookingService.GetBookingsToReview(vm.user.id)\n                    .then(function(data){\n\n                        vm.bookings = data.bookings;   \n                        \n                    });\n        }\n        get_the_approval_list();\n\n        $scope.all_events = [];\n        $scope.all_resources = [];\n\n        // BookingService.GetAllInstructor(vm.user.id, moment().format(\"Y-M-D\"), \"\")\n        //     .then(function(data){\n        //         $scope.all_events = data.events;\n        //         $scope.all_resources = data.resources;\n\n        //         $('#calendar').fullCalendar('refetchEvents');\n        //         $('#calendar').fullCalendar('removeEvents');\n        //         $('#calendar').fullCalendar('addEventSource', $scope.all_events);\n\n        //     });\n\n\n\n\n        $scope.approve_booking = function(id){\n\n            //approve me pleaseeeee\n            BookingService.AcceptBooking(id, vm.user.id)\n            .then(function(data){\n                // //console.log(data);\n                // //console.log(\"This has been approved...\");\n                get_the_approval_list();\n\n            });\n        }\n\n        $scope.decline_booking = function(id){\n\n            //decline me pleaseeeee\n            BookingService.DeclineBooking(id, vm.user.id, {})\n            .then(function(data){\n                // //console.log(data);\n                // //console.log(\"This has been decline...\");\n                get_the_approval_list();\n                \n            });\n\n        }\n\n        $scope.view_booking = function(id, start){\n\n            //decline me pleaseeeee\n            BookingService.GetAllInstructor(vm.user.id, start, \"\")\n            .then(function(data){\n                //console.log(data);\n\n                // vm.default_date = new Date(start);\n                // //console.log(\"DATE\", vm.default_date);\n                $(\"#calendar\").fullCalendar(\"gotoDate\", vm.default_date);\n\n\n                //VERY hacky... not good - but it scrolls to the right place... maybe add a \n\n                var w = parseInt($('a.fc-timeline-event.booking'+id).css(\"left\"));\n                var b = parseInt($('a.fc-timeline-event.booking'+id).width());\n                 let offsetEvent = w + (b/2) - ($('tbody .fc-time-area .fc-scroller').width()  / 2);\n\n                $('tbody .fc-time-area .fc-scroller').animate({\n                    scrollLeft:  offsetEvent\n                }, 600);\n\n\n                $scope.all_events = data.events;\n                $scope.all_resources = data.resources;\n\n                //animate the colour change\n                $('a.fc-timeline-event.booking'+id).removeClass(\"highlight_item\");\n                setTimeout(function(){\n                    $('a.fc-timeline-event.booking'+id).addClass(\"highlight_item\");\n                }, 200);\n\n                // //console.log(\"hello\", $scope.all_events);\n                // //console.log(\"hello\", $scope.all_resources);\n\n                return data;\n\n            });\n\n        }\n\n\n\n        //copy from the bookignsController\n        $scope.updateEvents = function(start, end){\n        ////console.log(\"start\", start, \"end\", end);\n\n        BookingService.GetAllInstructor(vm.user.id, start, end)\n        .then(function(data){\n            //console.log(data);\n\n            $scope.all_events = data.events;\n            $scope.all_resources = data.resources;\n\n            // //console.log(\"hello\", $scope.all_events);\n            // //console.log(\"hello\", $scope.all_resources);\n\n            return data;\n\n        });\n    }\n\n    /* Render Tooltip */\n    $scope.eventRender = function( event, element, view ) {\n        element.attr({'tooltip': event.title,\n                      'tooltip-append-to-body': true});\n        $compile(element)($scope);\n    };\n\n    \n    $scope.alertOnClicked = function(calEvent, jsEvent, view){\n            \n            vm.see_booking = calEvent;\n\n            vm.see_booking.start_date = moment(vm.see_booking.start).format(\"DD/MM/YYYY\");\n            vm.see_booking.end_date = moment(vm.see_booking.end).format(\"DD/MM/YYYY\");\n            vm.see_booking.start_time = moment(vm.see_booking.start).format(\"HH:mm\");\n            vm.see_booking.end_time = moment(vm.see_booking.end).format(\"HH:mm\");\n\n            vm.see_booking.start_datetime = new Date(new Date(vm.see_booking.start).toUTCString());\n            vm.see_booking.end_datetime = new Date(vm.see_booking.end);\n            vm.see_booking.visible = 1;\n            vm.see_booking.can_be_edited = moment().isAfter(moment(vm.see_booking.end));\n\n            $scope.$apply();\n    };\n\n    $scope.changeLang = function() {\n    \n        $scope.uiConfig.calendar.dayNames = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\n        $scope.uiConfig.calendar.dayNamesShort = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n      \n    };\n\n    $scope.changed = function () {\n        $log.log('Time changed to: ' + $scope.mytime);\n        $scope.check_plane_availability();\n    };\n\n    $scope.check_plane_availability = function(){\n       \n        generate_datetimes();\n\n        //getALL?\n        var getA = (vm.new_booking.edit_booking == 1)? 1 : 0;\n        var plane_id = (vm.new_booking.plane_id > 0)? vm.new_booking.plane_id : 0;\n        if(vm.new_booking.plane && vm.new_booking.plane.id){\n            plane_id = vm.new_booking.plane.id;\n        }\n\n        // //console.log(\"START\", vm.new_booking.start_datetime);\n        console.log(\"START REVIEWBOOKINGS\", new Date(vm.new_booking.start_datetime).toIsoString());\n        // //console.log(\"END\", vm.new_booking.end_datetime);\n\n        BookingService.GetAllPlanes(vm.user.id, vm.new_booking.start_datetime, vm.new_booking.end_datetime, 0, plane_id)\n        .then(function(data){\n           \n            //this gets the events and bookings for the period checked here...\n            // var events = data.events;\n            vm.planes = data;\n            \n\n            if(getA == 1){\n                //then I just want to iterate through these and return the plane already selected as \"available...\"\n\n                ////console.log(\"PLANE\", vm.new_booking.plane);\n\n                for(var i = 0; i<vm.planes.length; i++){\n                    if(vm.planes[i].id == vm.new_booking.plane.id){\n                        reset_chosen = 0;\n                        vm.new_booking.plane = vm.planes[i];\n                        //chosen is still available WOOOO\n                        $scope.check_rental_items();\n                    }\n                }\n\n\n\n            } else {\n\n                 //check if anything was already selected...\n                var reset_chosen = 1;\n                if(vm.new_booking.plane){\n                    for(var i = 0; i<vm.planes.length; i++){\n                        if(vm.planes[i].id == vm.new_booking.plane.id){\n                            reset_chosen = 0;\n                            //chosen is still available WOOOO\n                            $scope.check_rental_items();\n                        }\n                    }\n                    if(reset_chosen == 1){\n                        //then we just need to clear currently selected plane\n                        vm.new_booking.plane = {};\n                        delete(vm.new_booking.plane);\n                    }\n                    //otherwise we can leave that we've already done! :)\n                }\n\n\n            }\n\n        });\n\n    }\n\n    $scope.events = [];\n\n    function getDayClass(data) {\n        var date = data.date,\n          mode = data.mode;\n        if (mode === 'day') {\n          var dayToCheck = new Date(date).setHours(0,0,0,0);\n\n          for (var i = 0; i < $scope.events.length; i++) {\n            var currentDay = new Date($scope.events[i].date).setHours(0,0,0,0);\n\n            if (dayToCheck === currentDay) {\n              return $scope.events[i].status;\n            }\n          }\n        }\n\n        return '';\n      }\n\n\n    $scope.addOne = function(){\n        $state.go('dashboard.bookings.add');\n    }\n\n    $scope.cancel_changes = function(){\n        //$state.go('dashboard.bookings');\n    }\n\n    $scope.check_rental_items = function(){\n        generate_datetimes();\n\n        vm.rental_items = [];\n\n        if(vm.new_booking.plane){\n\n            var club_id = (vm.new_booking.edit_booking == 1) ? vm.new_booking.club_id : vm.new_booking.plane.club_id;\n\n            BookingService.GetRentalItems(club_id, moment(vm.new_booking.start_datetime).format(\"Y-M-D HH:mm\"), moment(vm.new_booking.end_datetime).format(\"Y-M-D HH:mm\"), 0)\n            .then(function(data){\n           \n                vm.rental_items = data;\n\n                if(vm.new_booking.rental_items){\n                    //then we may have shizzle to check / update\n                    for(var i=0;i<vm.new_booking.rental_items;i++){\n                        //first and foremost we need to check the available bits....\n                        var found = 0;\n                        for(var j=0;j<vm.rental_items.length;j++){\n                            if(vm.rental_items[j][\"id\"] == vm.new_booking.rental_items[i][\"id\"]){\n                                //then we need to check that the current numbers available are still the same as before...\n                                if(parseInt(vm.new_booking.rental_items[i][\"number_to_book\"]) > parseInt(vm.rental_items[j][\"number_available\"])){\n                                    vm.new_booking.rental_items[i][\"number_to_book\"] = parseInt(vm.rental_items[j][\"number_available\"]);\n                                }\n                                vm.new_booking.rental_items[i][\"number_available\"] = parseInt(vm.rental_items[j][\"number_available\"]);\n                                found = 1;\n                                break;\n                            }\n                        }\n                        if(found == 0){\n                            //then we need to remove it...\n                            delete vm.new_booking.rental_items[i];\n                        }\n\n                    }\n\n                }\n\n\n                for(var k=0; k<vm.rental_items.length;k++){\n                    vm.rental_items[k].number = 0;\n                }\n\n                //if there is one already selected?\n                //check if anything was already selected...\n                if(vm.new_booking.rental_items){\n                    for(var j=0; j<vm.new_booking.rental_items; j++){\n                        var reset_chosen = 1;\n                        for(var i = 0; i<vm.rental_items.length; i++){\n                            if(vm.rental_items[i].id == vm.new_booking.rental_items[j].id){\n                                reset_chosen = 0;\n                                //chosen is still available WOOOO\n                            }\n                        }\n                        if(reset_chosen == 1){\n                            //then we just need to clear currently selected plane\n                            delete vm.new_booking.rental_items[j];\n                        }\n                    }\n                    //otherwise we can leave that we've already done! :)\n                }\n\n\n\n\n            });\n\n        }\n    }\n\n\n    $scope.update_booking = function(valid){\n        generate_datetimes();\n\n        if(valid){\n\n                // //console.log(\"VALID SUBMISSION\");\n                // //console.log(\"START\", vm.new_booking.start_datetime);\n                // //console.log(\"END\", vm.new_booking.end_datetime);\n\n                var booking = {};\n                var booking = jQuery.extend(true, {}, vm.new_booking); \n                // //console.log(booking);\n                delete booking.options;\n                delete booking.instructor;\n                delete booking.plane;\n                delete booking.start_date;\n                delete booking.start_time;\n                delete booking.end_date;\n                delete booking.end_time;\n                delete booking.start_datetime;\n                delete booking.end_datetime;\n                delete booking.tuition_required;\n                // //console.log(booking);\n                // //console.log(vm.new_booking);\n                booking.free_seats = (vm.new_booking.free_seats.constructor === Array) ? 0 : vm.new_booking.free_seats;\n                booking.start = vm.new_booking.start_datetime;\n                booking.end = vm.new_booking.end_datetime;\n                booking.tuition_id = vm.new_booking.tuition_required.id;\n\n                // //console.log(\"START\", booking.start);\n                // //console.log(\"END\", booking.end);\n\n                booking.user_id = vm.user.id;\n                booking.instructor_id = (vm.new_booking.instructor) ? vm.new_booking.instructor.id : 0;\n                booking.plane_id = vm.new_booking.plane.id;\n                booking.override = (vm.new_booking.override) ? vm.new_booking.override : 0;\n                booking.club_id = vm.new_booking.plane.club_id;\n\n                // //console.log(\"====> booking to be sent = \", booking);\n\n                check_before_changing_event(booking);\n\n        }\n\n    }\n\n    $scope.update_club = function(){\n            // //console.log(\"we changed club here\");\n            vm.club_id = vm.change_club.id;\n            //now we need to update the planes the user can see on the calendar! \n            update_bookings();\n\n    }\n\n    function update_bookings(){\n         BookingService.GetAllUserClub(vm.user.id,vm.club_id, moment().format(\"Y-M-D\"), \"\")\n                .then(function(data){\n                   \n                    $scope.all_events = data.events;\n                    $scope.all_resources = data.resources;\n\n                });\n    }\n\n    /* alert on eventClick */\n    $scope.alertOnEventClick = function( date, jsEvent, view){\n        $scope.alertMessage = (date.title + ' was clicked ');\n        // //console.log(event);\n        //show event details\n\n    };\n\n    /* alert on Drop */\n     $scope.alertOnDrop = function(event, delta, revertFunc, jsEvent, ui, view){\n  \n\n        check_before_changing_event(event);\n       \n    };\n\n\n    /* alert on Resize */\n    $scope.alertOnResize = function(event, delta, revertFunc, jsEvent, ui, view ){\n        \n        check_before_changing_event(event);\n\n    };\n\n\n\n    $scope.override_booking_change = function(override){\n\n        vm.error_event[override] = true;\n        check_before_changing_event(vm.error_event);\n\n\n    }\n\n    $scope.decline_booking_change = function(){\n\n        vm.booking_errors = {};\n        vm.error_event = {};\n        $('#calendar').fullCalendar('removeEvents');\n        $('#calendar').fullCalendar('addEventSource', all_events);\n\n    }\n\n\n    function check_before_changing_event(event){\n        //the important bit is the eventID \n\n\n        var evnt = jQuery.extend({}, event);\n\n\n        \n\n        // evnt.start = moment(evnt.start).format(\"YYYY-MM-DD HH:mm\");\n        // evnt.end = moment(evnt.end).format(\"YYYY-MM-DD HH:mm\");\n        \n        //this covers the change of plane for the booking...\n        evnt.plane_id = event.resourceId;\n        if(event.instructor_id !== \"\"){\n            evnt.instructor_id = event.instructor_id;\n                    if(event.tuition_required){\n                        evnt.tuition_id = event.tuition_required.id;\n                    }\n\n        } else {\n            evnt.instructor_id = \"0\";\n        }\n\n\n        // //console.log(\"evnt : \", evnt);\n        // return false;\n\n        //updatable bits:\n\n        delete evnt._start;\n        delete evnt._end;\n        delete evnt._id;\n        delete evnt.source;\n        delete evnt._allDay;\n        delete evnt.allDay;\n        delete evnt.className;\n        delete evnt.plane;\n        delete evnt.title;\n        delete evnt.editable;\n        delete evnt.resourceIds;\n        evnt.update_rental_items = true;\n\n        // //console.log(\"UPDATE CONTENT BEFORE\", evnt);\n\n        BookingService.updateBooking(evnt, vm.user.id)\n        .then(function(data){\n            //console.log(data);\n\n            if(data.success == true){\n                //console.log(\"the booking did not need to be altered = and has been updated successfully.\", evnt);\n\n                //only if the edition is being made from the \"edit\" otherwise the changes are already reflected appropriately.\n                if(evnt.edit_booking == 1){\n                    $scope.$parent.updateEvents(evnt.start, evnt.end);\n                }\n                \n                ToastService.success('Changes Saved', 'Your changes were saved successfully');\n                \n                // if(vm.return_to == \"bookout\") {\n                //     //console.log(\"WE ARE AT THE BOOKOUT BIT - SO RETURN THERE!!!\");\n                //     $state.go('dashboard.my_account.bookout_with_booking', { \"booking_id\": event.id });\n                // } else {\n                //     //console.log(\"NORMAL booking\");\n                //     $state.go('dashboard.bookings');\n                // }\n\n\n\n            } else {\n                //display the error\n                //console.log(\"The booking cannot remain the same due to : \"+data.message);\n\n                //hollow :::     $(\"#calendar\").fullCalendar('refetchEvents');\n\n\n                //I have decided to do this as a sequential check / accept / decline as opposed to combined\n                //this can be altered at a later date to be combined, with accept / decline on each error\n                //but this is more work than i can do right now!\n\n                var errors = [];\n                if(data.instructor !== true){\n                    errors.push({\n                        type: \"instructor\",\n                        message: \"It looks like your instructor is not available on the updated date and time\",\n                        api: data.instructor,\n                        override: \"instructor_override\" \n                    });\n                } else if(data.check_user !== true){\n                    errors.push({\n                        type: \"check_user\",\n                        message: \"It looks like your user account does not allow this booking to happen\",\n                        api: data.check_user,\n                        override: \"currency_override\" \n                    });\n                } else if(data.rental_items !== true){\n                    errors.push({\n                        type: \"rental_items\",\n                        message: \"It looks like some of the rental items are not available\",\n                        api: data.rental_items,\n                        override: \"update_rental_items\" \n                    });\n                }\n\n\n                //show the errors:::\n\n                //console.log(\"ERRORS ARE : \", errors);\n                ToastService.error('Booking Error', 'Error found in altering the booking');\n\n                vm.booking_errors = errors;\n                vm.error_event = evnt;\n\n                //on GO--> check_before_changing_event(evnt)    \n\n\n                //if CANCEL?\n                //this would reset the change... do we want this?\n                //$(\"#calendar\").fullCalendar('refetchEvents');\n\n\n\n            }\n\n            return data;\n\n        });\n\n    }\n\n    $scope.wholeDay = function(){\n\n       if($scope.whole_day_booking == true){\n            $scope.whole_day_booking = false;\n            $scope.myDatetimeRange.time.from = defaultStartTime;\n            $scope.myDatetimeRange.time.to = defaultEndTime;\n       } else {\n            $scope.whole_day_booking = true;\n            $scope.myDatetimeRange.time.from = 0;\n            $scope.myDatetimeRange.time.to = 1440;\n       }\n       \n\n    }\n\n    //Changing the view of the calendar\n    $scope.changeView = function(view,calendar) {\n      uiCalendarConfig.calendars[calendar].fullCalendar('changeView',view);\n    };\n\n    /* Change View */\n    $scope.renderCalender = function(calendar) {\n      $timeout(function() {\n        if(uiCalendarConfig.calendars[calendar]){\n          uiCalendarConfig.calendars[calendar].fullCalendar('render');\n        }\n      });\n    };\n\n\n        // BookoutService.GetBookoutsToComplete(vm.user.id)\n        //             .then(function(data){\n\n        //                 vm.bookouts = data.bookouts;   \n                        \n        //             });\n\n\n\n    }\napp.controller('ShowGalleryController', ShowGalleryController);\n \n    ShowGalleryController.$inject = ['UserService', 'ArtpiecesService', 'ImagesService', 'KeywordsService', 'CategoryService', '$location', '$rootScope', 'FlashService', '$routeParams', '$scope', 'LocalDataService', 'GalleryService'];\n    function ShowGalleryController(UserService, ArtpiecesService, ImagesService, KeywordsService, CategoryService, $location, $rootScope, FlashService, $routeParams, $scope, LocalDataService, GalleryService) {\n        var vm = this;\n\n        vm.gallery = {\n            is_protected: \"false\",\n            download_low: \"false\",\n            download_medium: \"false\",\n            download_high: \"false\",\n            gallery_link: \"\",\n            fullscreen: \"false\"\n        };\n\n        vm.current = {\n            image: {\n                link: \"\",\n                description: \"hi\"\n            },\n            artpiece: {\n                title: \"\",\n                description: \"\"\n            },\n            index: 0\n        };\n\n        //get all galleries to check if name is already in use...\n        GalleryService.GetByUrl({gallery_link: $routeParams.gallery_link})\n                .then(function(data){\n                    //console.log(data);\n                     vm.gallery = data;\n                     //routeParams\n                     if(data.images.length > 0){\n                        if(data.is_disabled == \"true\"){\n                            //console.log(\"ERROR disabled\");\n                            $location.path(\"/disabled\");\n                        }\n\n                        //console.log(\"HELLO\");\n                        //console.log(vm.gallery.is_disabled);\n                        vm.current.image.link = vm.gallery.images[0].link;\n                        vm.current.image.description = vm.gallery.images[0].description;\n                        vm.current.artpiece.title = vm.gallery.images[0].artpiece.title;\n                        vm.current.artpiece.description = vm.gallery.images[0].artpiece.description;\n                        vm.current.index = 0;\n                    } else {\n                            //console.log(\"Couldn't find the page\");\n                            $location.path(\"/disabled\");\n                    }\n\n\n                });\n\n\n\n        $scope.login = function(){\n            if(vm.password_protected == vm.gallery.password){\n                //console.log(\"YAY\");\n                vm.gallery.is_protected = \"false\";\n            } else {\n                //console.log(\"FAIL\");\n                return false;\n            }\n        }\n\n        var load_image = function(index){\n            // $(\".show_gallery_big_image img\").removeClass(\"ng-hide-add\");\n            // $(\".show_gallery_big_image img\").addClass(\"ng-hide-remove\");\n            vm.current.image.link = vm.gallery.images[index].link;\n            vm.current.image.description = vm.gallery.images[index].description;\n            vm.current.artpiece.title = vm.gallery.images[index].artpiece.title;\n            vm.current.artpiece.description = vm.gallery.images[index].artpiece.description;\n            vm.current.index = index;\n           \n        }\n\n        $scope.change_image = function(index){\n            load_image(index);\n        }\n\n        $scope.show_fullscreen = function(){\n            $(\"#fullscreen\").fadeIn();\n            $(\"p.viewport\").hide();\n        }\n\n        $scope.hide_fullscreen = function(){\n            $(\"#fullscreen\").fadeOut();\n            $(\"p.viewport\").show();\n\n        }\n\n        $scope.fullscreen_next = function(){\n            var next = vm.current.index + 1;\n            if(next > (vm.gallery.images.length - 1)){ next = 0; } \n            //load the next one\n            load_image(next);\n        }\n\n        $scope.fullscreen_previous = function(){\n            var prev = vm.current.index - 1;\n            if(prev < 0){ prev = (vm.gallery.images.length - 1); } \n            //load the next one\n            load_image(prev);\n        }\n\n        $scope.download = function(value){\n            //download low / medium / high definition image ZIP\n            GalleryService.DownloadZip({gallery_id: vm.gallery.id, quality: value})\n                            .then(function(data){\n                                //console.log(data);\n                                    var link = document.createElement(\"a\");\n                                    link.download = data.zip_url;\n                                    link.href = data.zip_url;\n                                    link.click();\n                            });\n\n            //window.saveAs(blob, filename) ? WTF?\n        }\n\n        //this is where we do the selection of images\n        $scope.remove_image = function(image){\n            //check if set selected\n            //well its selected - so we deselect right?\n            vm.images = $.grep(vm.images, function(e){ \n                return e.id != image.id; \n            });\n            //console.log(vm.images);\n            LocalDataService.SetSelectedImages(vm.images);\n        }\n\n        $scope.check_link_unique = function(){\n            for(var i = 0; i < vm.all_galleries.length; i++){\n                if(vm.all_galleries[i].link===vm.gallery.link){\n                    return false;\n                }\n            }\n        }\n\n\n        $scope.generate_gallery = function(){\n            //console.log(\"CLICKED GALLERY BIT\");\n            //console.log(LocalDataService.data.selected_images);\n            //we need to set the ORDER as organise in the vm.images\n            var organise = 0;\n            for(var i = 0; i < vm.images.length; i++){\n                vm.images[i].organise = i;\n            }\n            //console.log(\"ORGANISE BELOW?\");\n            //console.log(vm.images);\n\n            vm.gallery.images = vm.images;\n            //console.log(vm.gallery);\n            GalleryService.Create(vm.gallery)\n                .then(function(data){\n                    //console.log(data);\n                    //$location.path(\"/gallery/\"+data.link);\n                });\n        }\n\n       \n\n\n\n    }\n app.controller('UpdateMyMembershipDirectDebitController', UpdateMyMembershipDirectDebitController);\n\n    UpdateMyMembershipDirectDebitController.$inject = ['UserService', 'MemberService', 'MembershipService', 'PaymentService', 'InstructorService', 'HolidayService', 'ClubService', '$rootScope', '$location', '$scope', '$state', '$stateParams', '$uibModal', '$log', '$window', '$compile', '$timeout', 'uiCalendarConfig', 'LicenceService', 'NokService', 'GoCardService', '$cookies'];\n    function UpdateMyMembershipDirectDebitController(UserService, MemberService, MembershipService, PaymentService, InstructorService, HolidayService, ClubService, $rootScope, $location, $scope, $state, $stateParams, $uibModal, $log, $window, $compile, $timeout, uiCalendarConfig, LicenceService, NokService, GoCardService, $cookies) {\n        \n        var vm = this;        \n\n        vm.user = $rootScope.globals.currentUser;\n        vm.user_id = vm.user.id;        \n      \n        vm.success = true;\n\n        vm.return_id = $stateParams.membership_id;\n  \n\n        switch($state.current.data.action){\n          \n            case \"direct_debit2\":\n\n                var mandate = $location.search().redirect_flow_id;\n                ////console.log(\"DIRECT DEBIT SORTING 444\", mandate);\n                //RE0002NPM29SQ1F4B57R8E3AT4YJAPZG\n                var session = $cookies.get('gcl_sess');\n\n                var object = {\n                    mandate: mandate,\n                    session: session,\n                    membership_id: $stateParams.membership_id\n                };\n                //console.log(\"THE TOTALS:::\", object);\n\n                if($cookies.get(\"gcl_member_accepted\")){\n                    object[\"member_accepted\"] = true;\n                }\n\n\n\n                GoCardService.UpdateMandate(object).then(function (data) {\n                    if(data.error){\n                        //vm.requests = data.requests;\n                        //vm.club = data.club;\n                        // //console.log(\"memberships\", vm.memberships);\n                        // vm.success = true;\n                        vm.success = false;\n                        //console.log(\"There was an error: \", data);\n                        //now that this is saved... we should do something about it?\n                        //window.location = \"\";\n\n                    } else {\n\n                        //console.log(\"HAPPY RESPONSE: \", data);\n                        vm.success = true;\n\n                        //window.location = \"\";\n                        $state.go('dashboard.my_account.memberships.edit', {membership_id: vm.return_id}, {reload: true});\n\n                        // //console.log(\"WOOOPSIES...\");\n                        // vm.success = false;\n                        //this should be very very rare...\n                    }\n\n                });\n                \n\n\n\n               \n\n\n            break;\n            default:\n                //console.log(\"none of the above... redirect somewhere?\");\n            break;\n        }  \n\n\n\n\n\n\n        \n        \n\n\n    }\napp.controller('UploadController', UploadController);\n \n    UploadController.$inject = ['KeywordsService', 'ArtpiecesService', 'ImageUploadService', '$scope', '$http', '$location'];\n    function UploadController(KeywordsService, ArtpiecesService, ImageUploadService, $scope, $http, $location) {\n            \n\n\n        var vm = this;\n        \n        //current tags\n        $scope.tags = [];\n\n        KeywordsService.GetAll()\n                .then(function (data) {\n                    vm.all_keywords = data;\n                    //console.log(vm.all_keywords);\n                });\n\n        ArtpiecesService.GetAll()\n                .then(function(data){\n                    vm.artpieces = data;\n                });\n        \n        $scope.loadTags = function(query) {\n        \n            var first = $.grep(vm.all_keywords, function(e){ var ab = e.keyword; var ab = ab.toLowerCase(); if(ab.startsWith(query.toLowerCase())){ return true; } });\n            var second = [];\n            for(var i = 0; i < first.length; i++){\n                var text_to_lower = first[i].keyword;\n                text_to_lower = text_to_lower.toLowerCase();\n                second.push({id: first[i].id, text: text_to_lower});\n            }\n            return second;\n\n        };\n\n          $scope.CheckData = function(content){\n            // //console.log(\"BELOW\");\n            // //console.log(content);\n            var images_array = [];\n            var images = content; //JSON.parse(content.file_return);\n            for(var i = 0; i < images.length; i++){\n                //var image = JSON.parse(images[i].f);\n                // //console.log(\"file_return\"+images[i].file_return);\n                var image = images[i].file_return;\n                var image = JSON.parse(image);\n                // //console.log(image.files.file.tmp_name);\n                images_array.push(image.files.file.tmp_name);\n            }\n            // //console.log(content.file_return);\n            // //console.log(images_array); // all the images\n            // //console.log($scope.tags); //all the tags objects\n            // //console.log(vm.artme); //this is the artpiece id\n            var compiled_send = {\n                images: images_array,\n                keywords: $scope.tags,\n                artpiece_id: vm.artme\n            };\n\n            //console.log(compiled_send);\n\n            ImageUploadService.Create(compiled_send)\n                .then(function(data){\n                    //console.log(data);\n                    $location.path(\"/\");\n                });\n\n\n          }\n         \n       \n\n    }\napp.controller('UsersController', UsersController);\n \n    UsersController.$inject = ['UserService', '$location', '$rootScope', 'FlashService', '$routeParams', 'ToastService'];\n    function UsersController(UserService, $location, $rootScope, FlashService, $routeParams, ToastService) {\n        var vm = this;\n        var this_user;\n        vm.update = update;\n \t\tvm.dataLoading = false;\n\n \t\tvm.default_pwd = \"password\";\n\n        UserService.GetById($routeParams.userId)\n                .then(function (data) {\n                    vm.user = data.user;\n                });\n\n        function update(id){\n            //vm.dataLoading = true;\n            if(vm.user.password == \"password\"){\n                vm.user.password = \"\";\n            }\n            //console.log(vm.user)\n            UserService.Update(vm.user)\n                .then(function (response) {\n                    if (response.success) {\n                        FlashService.Success('Update successful', true);\n                        $location.path('/');\n                    } else {\n                        console.log(\"response\");\n                        console.log(response);\n                        if(response.message == \"Password entered failed\") {\n                            ToastService.error('Login Failed', 'The password entered was incorrect');\n                            vm.dataLoading = false;\n                        } else {\n                            FlashService.Error(response.error);\n                            vm.dataLoading = false;\n                        }\n                        \n                    }\n                });\n        }\n    }\n app.controller('UserSignupController', UserSignupController);\n\n    UserSignupController.$inject = ['UserService', '$http', '$rootScope', '$location', '$scope', '$state', '$stateParams', 'ToastService'];\n    function UserSignupController(UserService, $http, $rootScope, $location, $scope, $state, $stateParams, ToastService) {\n        \t\n    \t\t\n    \t\t//automatically sort stuff out! :)\n    \t\tif($state.params.verify){\n    \t\t\t// //console.log(\"SEND VERIFICATION\");\n    \t\t\tUserService.Verify($state.params.user_id, $state.params.verify)\n                .then(function (data) {\n\t    \t\t\t// //console.log(\"SENT VERIFICATION\");\n                \t// //console.log(data);\n                    if(data.success){\n                    \t$state.go(\"verified\");\n                    } else {\n                    \tToastService.error('Error', data.message);\n                    \t$state.go(\"login\");\n                    }\n                });\n    \t\t}\n\n\n\n\t    \t// //console.log(\"HELLO\");\n\t\t    ////console.log($scope.membership);\n\n         \t// we will store all of our form data in this object\n\t\t    \n\n         \t$scope.clubs = { clubs: [\n\t\t\t    \t{\n\t\t\t    \t\tid: 1,\n\t\t\t    \t\ttitle: \"Alouette Flying Club\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 2,\n\t\t\t    \t\ttitle: \"EFG Flying Club\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 3,\n\t\t\t    \t\ttitle: \"Surrey & Kent Flying Club\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 4,\n\t\t\t    \t\ttitle: \"Arrow Flight Club\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 5,\n\t\t\t    \t\ttitle: \"Cirrus Flying Club\"\n\t\t\t    \t}\n\t\t    \t]\t\t    \t\n\t\t    };\n\n\n\t\t    $scope.memberships = { memberships: [\n\t\t\t    \t{\n\t\t\t    \t\tid: 1,\n\t\t\t    \t\ttitle: \"honory membership\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 2,\n\t\t\t    \t\ttitle: \"day membership\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 3,\n\t\t\t    \t\ttitle: \"social membership\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 4,\n\t\t\t    \t\ttitle: \"full flying membership\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 5,\n\t\t\t    \t\ttitle: \"temporary flying membership\"\n\t\t\t    \t}\n\t\t    \t]\t\t    \t\n\t\t    };\n\n\t\t    $scope.state = { state: [\n\t\t\t    \t{\n\t\t\t    \t\tid: 2,\n\t\t\t    \t\ttitle: \"France\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 3,\n\t\t\t    \t\ttitle: \"Netherlands\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 4,\n\t\t\t    \t\ttitle: \"Germany\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 5,\n\t\t\t    \t\ttitle: \"Spain\"\n\t\t\t    \t}\n\t\t    \t]\t\t    \t\n\t\t    };\n\n\t\t    $scope.licenses = { licenses: [\n\t\t\t    \t{\n\t\t\t    \t\tid: 1,\n\t\t\t    \t\ttitle: \"EASA PPL\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 2,\n\t\t\t    \t\ttitle: \"EASA CPL\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 3,\n\t\t\t    \t\ttitle: \"EASA ATPL\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 4,\n\t\t\t    \t\ttitle: \"UK NPPL\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 5,\n\t\t\t    \t\ttitle: \"FAA SPL\"\n\t\t\t    \t}\n\t\t    \t]\t\t    \t\n\t\t    };\n\n\t\t    $scope.medicals = { medicals: [\n\t\t\t    \t{\n\t\t\t    \t\tid: 1,\n\t\t\t    \t\ttitle: \"EASA MEDICAL\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 2,\n\t\t\t    \t\ttitle: \"UK MEDICAL EXAMINATION\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 3,\n\t\t\t    \t\ttitle: \"FAA MEDICAL\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 4,\n\t\t\t    \t\ttitle: \"NZ CAA MEDICAL\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 5,\n\t\t\t    \t\ttitle: \"FAA SPL MEDICAL\"\n\t\t\t    \t}\n\t\t    \t]\t\t    \t\n\t\t    };\n\n\t\t    $scope.person = {};\n\n\t\t    $scope.person.selectedSingle = 'Samantha';\n\t\t  \t$scope.person.selectedSingleKey = '5';\n\n\t\t  \t$scope.people = [\n\t\t\t    { name: 'Adam',      email: 'adam@email.com',      age: 12, country: 'United States' },\n\t\t\t    { name: 'Amalie',    email: 'amalie@email.com',    age: 12, country: 'Argentina' },\n\t\t\t    { name: 'Estefana', email: 'estefania@email.com', age: 21, country: 'Argentina' },\n\t\t\t    { name: 'Adrian',    email: 'adrian@email.com',    age: 21, country: 'Ecuador' },\n\t\t\t    { name: 'Wladimir',  email: 'wladimir@email.com',  age: 30, country: 'Ecuador' },\n\t\t\t    { name: 'Samantha',  email: 'samantha@email.com',  age: 30, country: 'United States' },\n\t\t\t    { name: 'Nicole',    email: 'nicole@email.com',    age: 43, country: 'Colombia' },\n\t\t\t    { name: 'Natasha',   email: 'natasha@email.com',   age: 54, country: 'Ecuador' },\n\t\t\t    { name: 'Michael',   email: 'michael@email.com',   age: 15, country: 'Colombia' },\n\t\t\t    { name: 'Nicols',   email: 'nicolas@email.com',    age: 43, country: 'Colombia' }\n\t\t  \t];\n\n\n\n\n\n\t\t    $scope.ratings = { ratings: [\n\t\t\t    \t\n\t\t\t\t\t{\n\t\t\t    \t\tid: 1,\n\t\t\t    \t\ttitle: \"SEP (land)\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 2,\n\t\t\t    \t\ttitle: \"SEP (sea)\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 3,\n\t\t\t    \t\ttitle: \"MEP (land)\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 4,\n\t\t\t    \t\ttitle: \"MEP (sea)\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 1,\n\t\t\t    \t\ttitle: \"Night Rating\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 2,\n\t\t\t    \t\ttitle: \"Instrument Rating Restricted IR(r)\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 3,\n\t\t\t    \t\ttitle: \"Instrument Rating\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 4,\n\t\t\t    \t\ttitle: \"Aerobatics Rating\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 5,\n\t\t\t    \t\ttitle: \"High Performance Aircraft Rating\"\n\t\t\t    \t}\n\t\t    \t]\t\t    \t\n\t\t    };\n\n\t\t    $scope.differences = { differences: [\n\t\t\t    \t{\n\t\t\t    \t\tid: 1,\n\t\t\t    \t\ttitle: \"Variable Pitch\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 2,\n\t\t\t    \t\ttitle: \"Retractable Gear\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 3,\n\t\t\t    \t\ttitle: \"Turbo Differences Training\"\n\t\t\t    \t},\n\t\t\t    \t{\n\t\t\t    \t\tid: 4,\n\t\t\t    \t\ttitle: \"EFIS Differences Training\"\n\t\t\t    \t}\n\t\t    \t]\t\t    \t\n\t\t    };\n\n\n\t\t    //may need to alter this one to reflect most common one depending on\n\t\t    //the license type\n\t\t    $scope.formData = {\n\t\t    \tlicense: {\n\t\t    \t\tdifferences: [],\n\t\t    \t\tratings: [$scope.ratings.ratings[0]],\n\t\t    \t\tadd_to: {\n\t\t\t    \t}\n\t\t    \t},\n\t\t    \tmedical: {}\n\t\t    \t\n\t\t    };\n\n\t\t    $scope.add_element = function(bit_type){\n\n\t\t    \t//remove from first array\n\t\t    \t$scope[bit_type][bit_type] = $.grep($scope[bit_type][bit_type], function(e){ \n\t\t\t\t\treturn e.id != $scope.formData.license.add_to[bit_type].id; \n\t\t\t\t});\n\n\t\t    \tif(bit_type == \"differences\"){\n\t\t    \t\t$scope.formData.license.add_to[bit_type].day = true;\n\t\t    \t\t$scope.formData.license.add_to[bit_type].vfr = true;\n\t\t    \t}\n\t\t    \t//console.log($scope.formData.license.add_to[bit_type]);\n\n\t\t    \t$scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n\t\t    \t\n\t\t    \t//clean the array to show what we want to show :)\n\t\t    \tdelete $scope.formData.license.add_to[bit_type];\n\n\t\t    }\n\n\n\t\t    $scope.remove_element = function(bit_type, index){\n\n\t\t \n \t\t\t\t//add to dropdown\n\t\t\t\t$scope[bit_type][bit_type].push($scope.formData.license[bit_type][index]);\n\n\t\t    \n\t\t\t\t$scope.formData.license[bit_type].splice(index,1)\n\n\t\t    \t$scope.formData.license[bit_type] = $scope.formData.license[bit_type].filter(Boolean);\n\t\t    \t//console.log($scope.formData.license[bit_type]);\n\t\t    \t//$scope.formData.license[bit_type].push($scope.formData.license.add_to[bit_type]);\n\n\t\t    }\n\n\t\t    \n\t\t    $scope.checkValid = function(uisref){\n\t\t    \tif(!uisref || uisref == \"\"){\n\t\t    \t\t//console.log(\"here\");\n\t\t    \t\tuisref = $(\".btn-info\").attr(\"one-ui-sref\");\n\t\t    \t}\n\n\n\t\t    \t//let's check the passwords match first...\n\t            if($scope.formData.user.password !== $scope.formData.user.password2){\n\t              $(\"input[type='password']\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n\t              ToastService.warning('Password Mismatch', 'Your passwords do not match');\n\t              return false;\n\t            }\n\n\t            //check the password length > 8 characters\n\t            var strongPassword = new RegExp('(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[^A-Za-z0-9])(?=.{8,})')\n\t            if(strongPassword.test($scope.formData.user.password)) {\n\t              //console.log(\"password strength OK\");\n\t            } else {\n\t              $(\"input[type='password']\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n\t              ToastService.warning('Weak Password', 'Your password must be at least 8 characters in length, contain 1 uppercase, 1 lowercase, 1 number, and 1 special character');\n\t              return false;\n\t            }\n\n\n\n\t\t    \t//console.log($('#signup-form')[0].checkValidity());\n\t\t    \tif(! $('#signup-form')[0].checkValidity()){\n\t\t    \t\t$(\".ng-pristine\").not(\".ng-valid\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n\t\t    \t\t$(\"input:checkbox:not(:checked):required\").addClass(\"ng-checkbox-unchecked\");\n\t\t    \t\t//console.log(\"STOP\");\n\t\t    \t\treturn false;\n\t\t    \t} else {\n\n\t\t    \t\t//console.log(\"HERE\");\n\t\t    \t\t\n\t\t    \t\tif(!$scope.formData.user){\n\t\t    \t\t\t//console.log(\"missing first bit...\");\n\t\t\t\t    \t$state.go(\"user_signup.your_details\");\n\t\t    \t\t\treturn false;\n\t\t    \t\t}\n\t\t    \t\tif(!$scope.formData.user.nok){\n\t\t    \t\t\t//console.log(\"missing second bit...\");\n\t\t\t\t    \t$state.go(\"user_signup.next_of_kin\");\n\t\t    \t\t\treturn false;\n\t\t    \t\t}\n\t\t    \t\tif(!$scope.formData.club){\n\t\t    \t\t\t//console.log(\"missing second bit...\");\n\t\t\t\t    \t$state.go(\"user_signup.your_club\");\n\t\t    \t\t\treturn false;\n\t\t    \t\t}\n\t\t    \t\tif(!$scope.formData.tnc){\n\t\t\t    \t\t$(\"input:checkbox:not(:checked)\").addClass(\"ng-checkbox-unchecked\");\n\t\t    \t\t} else {\n\t\t    \t\t\t$(\"input:checkbox:not(:checked)\").removeClass(\"ng-checkbox-unchecked\");\n\t\t    \t\t}\n\t\t    \t\tif($scope.formData.user.password == $scope.formData.user.password2){\n\t\t\t    \t\tvar next = uisref;\n\t\t\t    \t\tif(next == \"verify_account\"){\n\t\t\t    \t\t\t//console.log(\"verifying account\");\n\t\t\t    \t\t\t$scope.processForm();\n\t\t\t    \t\t} else {\n\t\t\t\t    \t\t$state.go(next);\n\t\t\t    \t\t}\n\t\t    \t\t} else {\n\t\t\t    \t\t$(\"input[type='password']\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n\t\t    \t\t\treturn false;\n\t\t    \t\t}\n\n\t\t    \t\t// if(!$scope.formData.user){\n\t\t\t\t    // \t\t$state.go(\"user_signup.your_details\");\n\t\t    \t\t// }\n\t\t    \t\t// if($scope.formData.user.password == $scope.formData.user.password2){\n\t\t    \t\t// \t//console.log(uisref);\n\t\t\t    \t// \t$state.go(uisref);\n\t\t    \t\t// } else {\n\t\t\t    \t// \t$(\"input[type='password']\").removeClass(\"ng-pristine\").addClass(\"ng-invalid\");\n\t\t    \t\t// \treturn false;\n\t\t    \t\t// }\n\t\t    \t}\n\t\t    }\n\n\n\t\t    // function to process the form\n\t\t    $scope.processForm = function() {\n\t\t         if ($scope.formData.$valid) {\n\t                ToastService.success('Form Valid', 'Your form is valid.');\n\t            } \n\t\t    };\n\n\n\n\n\n\n\t\t$scope.downloadClubDocument = function(doc) {\n            var data = $.param({\n                id: doc\n            });\n\n            var ddd = doc.replace(/^.*[\\\\\\/]/, '');\n            $http.defaults.headers.common['Api-Key'] = \"eW91a25vd25vdGhpbmdqb25zbm93\";\n\n            $http.get('api/v1/term_documents/show_file/'+ddd, {\n                    responseType: 'arraybuffer'\n                })\n                .success(function(data, status, headers) {\n                    var zipName = processArrayBufferToBlob(data, headers);\n\n                    //Delete file from temp folder in server - file needs to remain open until blob is created\n                    //deleteFileFromServerTemp(zipName);\n                }).error(function(data, status) {\n                    ToastService.error('Download Failed', 'There was an error downloading the selected document(s).');\n                })\n        };\n\n\n        function titlepath(path,name){\n\n        //In this path defined as your pdf url and name (your pdf name)\n            var prntWin = window.open();\n            prntWin.document.write(\"<html><head><title>\"+name+\"</title></head><body>\"\n                + '<embed width=\"100%\" height=\"100%\" name=\"plugin\" src=\"'+ path+ '\" '\n                + 'type=\"application/pdf\" internalinstanceid=\"21\"></body></html>');\n            prntWin.document.close();\n        }\n\n        function processArrayBufferToBlob(data, headers) {\n            var octetStreamMime = 'application/octet-stream';\n            var success = false;\n\n            // Get the headers\n            headers = headers();\n            //var ttt = title.toLowerCase().replace(/\\W/g, '_');\n            // Get the filename from the x-filename header or default to \"download.bin\"\n            var filename = headers['x-filename'] || 'download.zip';\n\n            // Determine the content type from the header or default to \"application/octet-stream\"\n            var contentType = headers['content-type'] || octetStreamMime;\n\n            try {\n                // Try using msSaveBlob if supported\n                var blob = new Blob([data], {\n                    //type: contentType\n                    type: 'application/pdf'\n                });\n\n                var fileURL = URL.createObjectURL(blob);\n                titlepath(fileURL, \"Secure Documents\");\n\n                // if (navigator.msSaveBlob)\n                //     navigator.msSaveBlob(blob, filename);\n                // else {\n                //     // Try using other saveBlob implementations, if available\n                //     var saveBlob = navigator.webkitSaveBlob || navigator.mozSaveBlob || navigator.saveBlob;\n                //     if (saveBlob === undefined) throw \"Not supported\";\n                //     saveBlob(blob, filename);\n                // }\n                success = true;\n            } catch (ex) {\n                $log.info(\"saveBlob method failed with the following exception:\");\n                $log.info(ex);\n            }\n\n            if (!success) {\n                // Get the blob url creator\n                var urlCreator = window.URL || window.webkitURL || window.mozURL || window.msURL;\n                if (urlCreator) {\n                    // Try to use a download link\n                    var link = document.createElement('a');\n                    if ('download' in link) {\n                        // Try to simulate a click\n                        try {\n                            // Prepare a blob URL\n                            var blob = new Blob([data], {\n                                type: contentType\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            link.setAttribute('href', url);\n\n                            // Set the download attribute (Supported in Chrome 14+ / Firefox 20+)\n                            link.setAttribute(\"download\", filename);\n\n                            // Simulate clicking the download link\n                            var event = document.createEvent('MouseEvents');\n                            event.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\n                            link.dispatchEvent(event);\n                            success = true;\n\n                        } catch (ex) {\n                            $log.info(\"Download link method with simulated click failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n\n                    if (!success) {\n                        // Fallback to window.location method\n                        try {\n                            // Prepare a blob URL\n                            // Use application/octet-stream when using window.location to force download\n                            var blob = new Blob([data], {\n                                type: octetStreamMime\n                            });\n                            var url = urlCreator.createObjectURL(blob);\n                            window.location = url;\n                            success = true;\n                        } catch (ex) {\n                            $log.info(\"Download link method with window.location failed with the following exception:\");\n                            $log.info(ex);\n                        }\n                    }\n                }\n            }\n\n            if (!success) {\n                // Fallback to window.open method\n                $log.info(\"No methods worked for saving the arraybuffer, using last resort window.open\");\n                window.open(httpPath, '_blank', '');\n            }\n            return filename;\n        };\n\n    }"],"file":"controllers.ann.js"}