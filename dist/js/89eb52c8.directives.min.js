"use strict";function asyncGeneratorStep(e,t,n,a,r,i,o){try{var d=e[i](o),s=d.value}catch(e){return void n(e)}d.done?t(s):Promise.resolve(s).then(a,r)}function _asyncToGenerator(d){return function(){var e=this,o=arguments;return new Promise(function(t,n){var a=d.apply(e,o);function r(e){asyncGeneratorStep(a,t,n,r,i,"next",e)}function i(e){asyncGeneratorStep(a,t,n,r,i,"throw",e)}r(void 0)})}}function buildSuccessDOM(e){var t=document.createElement("div");t.className="payok-root",t.setAttribute("role","status"),t.setAttribute("aria-live","polite");var n=document.createElement("div");n.className="payok-confetti";for(var a=0;a<24;a++){var r=document.createElement("div");r.className="payok-piece",r.style.left=100*Math.random()+"vw",r.style.animationDelay=150*Math.random()+"ms",r.style.animationDuration=900+600*Math.random()+"ms",n.appendChild(r)}var i=document.createElement("div");i.className="payok-toast";var o=document.createElement("div");o.className="payok-ico";var d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttribute("class","payok-check"),d.setAttribute("viewBox","0 0 24 24");var s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d","M5 13l4 4L19 7"),d.appendChild(s),o.appendChild(d);s=document.createElement("div");s.className="payok-text";d=document.createElement("div");d.className="payok-title",d.textContent=e||"Payment successful";e=document.createElement("div");return e.className="payok-sub",e.textContent="Your payment has been processed.",s.appendChild(d),s.appendChild(e),i.appendChild(o),i.appendChild(s),t.appendChild(n),t.appendChild(i),{root:t,toast:i}}function buildFailureDOM(e){var t=document.createElement("div");t.className="payfail-root",t.setAttribute("role","alert"),t.setAttribute("aria-live","assertive");var n=document.createElement("div");n.className="payfail-toast";var a=document.createElement("div");a.className="payfail-ico";var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("class","payfail-x"),r.setAttribute("viewBox","0 0 24 24");var i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M6 6L18 18");var o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d","M18 6L6 18"),r.appendChild(i),r.appendChild(o),a.appendChild(r);o=document.createElement("div");o.className="payfail-text";r=document.createElement("div");r.className="payfail-title",r.textContent=e||"Payment failed";e=document.createElement("div");return e.className="payfail-sub",e.textContent="Your payment method wasn't charged. Please try again.",o.appendChild(r),o.appendChild(e),n.appendChild(a),n.appendChild(o),t.appendChild(n),{root:t,toast:n}}app.directive("fileread",[function(){return{scope:{fileread:"="},link:function(n,e,t){e.bind("change",function(e){var t=new FileReader;t.onload=function(e){n.$apply(function(){n.fileread=e.target.result.replace(/\r\n|\r/g,"\n")})},t.readAsText(e.target.files[0])})}}}]),app.filter("capitalise",function(){return function(e){return e?e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():""}}),app.filter("myDateTime",function(){return function(e){return e?moment(e).format("DD/MM/YYYY HH:mm"):""}}),app.filter("myToUpperCase",function(){return function(e){return e?e.toUpperCase():""}}),app.filter("brakesTime",function(){return function(e){if(e){var t=e.split(":");return e?t[0]+":"+t[1]:""}return""}}),app.directive("datetimez",function(){return{restrict:"A",require:"ngModel",link:function(t,e,n,a){e.datetimepicker({dateFormat:"dd/MM/yyyy 00:00:00",language:"EN",pickSeconds:!1}).on("changeDate",function(e){a.$setViewValue(e.date),t.$apply(),$(this).parent().find("input").focus()})}}}),app.filter("roundFive",function(){return function(e){if(e){if(-1<e.indexOf(":")){var t=e.split(":"),n=t[1],n=2.5<=n%5?5*parseInt(n/5)+5:5*parseInt(n/5);return n<10?n="0"+n:60==n&&(t[0]++,n="00"),t[0]+":"+n}return e}return""}}),app.filter("myTimeUTC",function(){return function(e){return e?moment.utc(e).format("HH:mm"):""}}),app.filter("numberFixedLen",function(){return function(e,t){return(1e4+""+e).slice(-t)}}),app.directive("collapsible",["$timeout",function(r){return{restrict:"A",scope:{collapsible:"="},link:function(e,t){var n=t[0];function a(){n.classList.add("open"),n.style.height=n.scrollHeight+"px";function t(e){"height"===e.propertyName&&(n.style.height="auto",n.removeEventListener("transitionend",t))}n.addEventListener("transitionend",t)}e.$watch("collapsible",function(t){r(function(){var e;t?a():(e=n.getBoundingClientRect().height,n.style.height=e+"px",n.offsetHeight,n.classList.remove("open"),n.style.height="0px")})})}}}]),app.directive("paymentSuccessToast",["$timeout",function(d){return{restrict:"A",scope:{paymentSuccessToast:"=",message:"@?",durationMs:"=?",onDone:"&?"},link:function(e){var t,n,a,r=angular.isNumber(e.durationMs)?e.durationMs:2200;function i(){t&&d.cancel(t),n&&d.cancel(n),t=n=null,a&&a.root&&a.root.parentNode&&a.root.parentNode.removeChild(a.root),a=null}function o(){i(),a=buildSuccessDOM(e.message),document.body.appendChild(a.root),t=d(function(){a&&(a.toast.classList.add("payok-hide"),n=d(function(){i(),e.onDone&&e.onDone()},380))},r)}e.$watch("paymentSuccessToast",function(e){e&&d(o)}),e.$on("$destroy",i)}}}]),app.directive("paymentFailureToast",["$timeout",function(d){return{restrict:"A",scope:{paymentFailureToast:"=",message:"@?",durationMs:"=?",onDone:"&?"},link:function(e){var t,n,a,r=angular.isNumber(e.durationMs)?e.durationMs:2600;function i(){t&&d.cancel(t),n&&d.cancel(n),t=n=null,a&&a.root&&a.root.parentNode&&a.root.parentNode.removeChild(a.root),a=null}function o(){i(),a=buildFailureDOM(e.message),document.body.appendChild(a.root),t=d(function(){a&&(a.toast.classList.add("payfail-hide"),n=d(function(){i(),e.onDone&&e.onDone()},380))},r)}e.$watch("paymentFailureToast",function(e){e&&d(o)}),e.$on("$destroy",i)}}}]),app.directive("paymentAccordion",function(){return{restrict:"E",scope:{methods:"=",savedCards:"=",send:"=",open:"=",info:"=",user:"=",bookout:"=",invoice:"=",onConfirm:"&"},controllerAs:"vm",bindToController:!0,templateUrl:"/js/directives/payment-form.html",controller:["$sce","PaymentService","$scope","BookoutService",function(t,e,o,n){var d=this;function a(e,a,r){var i=0;!function n(){d.stop_polling||s(e,function(e,t){i++,e?r(!0,t):a<=i||d.stop_polling?r(!1,""):t&&t.add_info&&""!==t.add_info?(e={payment_id:d.payment_id,charge_id:t.add_info.charge},d.payment_errors.some(function(e){return e.charge_id===t.add_info.charge&&e.payment_id===d.payment_id})?setTimeout(n,1e4):(d.payment_errors.push(e),d.paymentNo=!0,d.payment_status_message="There was an error with the payment: "+t.add_info.code+"\n"+t.add_info.message,d.stop_polling=!0,r(!1,""))):(console.log("Retrying in 5sec..."),setTimeout(n,5e3))})}()}function s(e,t){n.CheckPayment(e).then(function(e){e.success?e.status?t(!0,e):t(!1,e):t(!1,e.add_info)})}d.show_loading=!1,d.show_cardmachine=!1,e.CreatePaymentIntentNewCard(d.send).then(function(e){console.log("DATA HERE",e);var r=Stripe("pk_test_51QttFFG8WiGSRCORyxkdZTO8oajcqz9OUsvcDJFpr9FB2PAdbzJc0tS7WNnfzKYsTiqHN1YDZi5UtXk4K52SeD4h00YWXuChNd"),e={clientSecret:e.client_secret,appearance:{rules:{".ModalContent":{zIndex:1e18},".ModalOverlay":{zIndex:1e18}}},wallets:{link:"never"},paymentMethodOrder:["card","apple_pay","google_pay"]},i=r.elements(e);i.create("payment",{layout:"tabs"}).mount("#payment-element");e=document.getElementById("submit-stripe");e&&e.addEventListener("click",function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.$apply(function(){d.show_loading=!0}),t.preventDefault(),e.next=4,r.confirmPayment({elements:i,confirmParams:{},redirect:"if_required"});case 4:a=e.sent,n=a.error,a=a.paymentIntent,n?("payment_intent_authentication_failure"==n.code?(d.paymentNo=!0,d.payment_status_message="You have failed to pass your card issuer's authentication - please try again or pay with another payment method."):(d.paymentNo=!0,d.payment_status_message=n.message),o.$apply(function(){d.show_loading=!1})):a&&("succeeded"===a.status?(d.paymentOk=!0,d.onConfirm({methodLabel:"new-card",paymentIntent:a})):(console.log("ERROR",a),d.paymentNo=!0,d.payment_status_message="There was an error processing your payment",o.$apply(function(){d.show_loading=!0})));case 8:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}())}),d.expandedId=d.open,d.selectedId=d.open,d.selectedSavedCardId=null,d.dd={name:"",email:"",sortCode:"",account:""},d.card={name:"",number:"",exp:"",cvc:""},d.$onInit=function(){d.methods&&d.methods.length&&(d.expandedId=d.methods[0].id,d.selectedId=d.methods[0].id),d.savedCards&&d.savedCards.length&&(d.selectedSavedCardId=d.savedCards[0].id)},d.toggle=function(e){d.expandedId=d.expandedId===e?null:e,d.selectedId=e},d.isExpanded=function(e){return d.expandedId===e},d.keyHeader=function(e,t){var n=e.which||e.keyCode;13!==n&&32!==n||(e.preventDefault(),d.toggle(t))},d.switchTo=function(e){for(var t=0;t<d.methods.length;t++)if(d.methods[t].type===e){d.selectedId=d.methods[t].id,d.expandedId=d.methods[t].id;break}},d.ddReady=function(){return!!(d.dd.name&&d.dd.email&&d.dd.sortCode&&d.dd.account)},d.cardReady=function(){return!!(d.card.name&&d.card.number&&d.card.exp&&d.card.cvc)},d.confirm=function(e){d.onConfirm({methodLabel:e,paymentIntent:1<arguments.length&&void 0!==arguments[1]?arguments[1]:null})},d.selectedTitle=function(){for(var e=0;e<d.methods.length;e++)if(d.methods[e].id===d.selectedId)return d.methods[e].title;return null},d.selectSavedCard=function(e){d.selectedSavedCardId=e},d.keySelectTile=function(e,t){var n=e.which||e.keyCode;13!==n&&32!==n||(e.preventDefault(),d.selectSavedCard(t))},d.cardBrandIcon=function(e){e=(e||"").toLowerCase(),e=/visa/.test(e)?'<svg viewBox="0 0 36 24"><rect width="36" height="24" rx="4" fill="#0a4595"/><text x="18" y="16" text-anchor="middle" font-size="10" fill="#fff">VISA</text></svg>':/(master|mc)/.test(e)?'<svg viewBox="0 0 36 24"><rect width="36" height="24" rx="4" fill="#1f2937"/><circle cx="15" cy="12" r="6.5" fill="#eb001b"/><circle cx="21" cy="12" r="6.5" fill="#f79e1b" opacity=".9"/></svg>':/(amex|american)/.test(e)?'<svg viewBox="0 0 36 24"><rect width="36" height="24" rx="4" fill="#2e77bb"/><text x="18" y="16" text-anchor="middle" font-size="9" fill="#fff">AMEX</text></svg>':'<svg viewBox="0 0 36 24"><rect width="36" height="24" rx="4" fill="#eef2ff"/><text x="18" y="15" text-anchor="middle" font-size="8" fill="#4f46e5">CARD</text></svg>';return t.trustAsHtml(e)},d.close_machine_popup=function(){n.ClearMachine(d.payment_id,d.club_id).then(function(e){e.success?console.log("machine should be clear now?",e):console.log("No success on card machine clear"),d.show_cardmachine=!1,d.show_after_bookedin=!0})},d.cancel_machine=function(){n.ClearMachine(d.payment_id,d.club_id).then(function(e){e.success?(console.log("machine should be clear now?",e),d.show_cardmachine=!1,d.show_after_bookedin=!0,d.stop_polling=!0):(console.log("No success on card machine clear"),d.show_after_bookedin=!0)})},d.close_bookedin=function(){n.ClearMachine(d.payment_id,d.club_id).then(function(e){console.log("regardless of clear - should now be cleared?"),d.show_cardmachine=!1,d.show_after_bookedin=!1,d.stop_polling=!0})},d.reset_card_machine=function(){n.RetryPaymentMachine(d.payment_id,d.club_id).then(function(e){console.log(e),e.success?(d.stop_polling=!1,a(d.payment_id,30,function(e,t){e?(d.stop_polling=!0,d.paymentOk=!0,d.onConfirm({methodLabel:"card-machine",paymentIntent:t.paymentIntent})):(d.paymentNo=!0,d.payment_status_message="Payment was not confirmed - please try again")})):(0==e.success&&"The payment has already been successfully made."==e.message&&(d.stop_polling=!0,d.onConfirm({methodLabel:"card-machine",paymentIntent:e.paymentIntent})),console.log(e.message))}),d.show_cardmachine=!0},d.payment_errors=[],d.pay_with_cardmachine=function(){d.show_loading=!0,e.CreateCardMachinePaymentIntent(d.send).then(function(e){e.success?(d.stop_polling=!1,d.show_loading=!1,d.show_cardmachine=!0,d.payment_id=e.paymentID,a(e.paymentID,30,function(e,t){e?(d.stop_polling=!0,d.paymentOk=!0,d.show_loading=!1,d.onConfirm({methodLabel:"card-machine",paymentIntent:t.paymentIntent})):(d.paymentNo=!0,d.payment_status_message="Payment not confirmed - please try again",d.show_loading=!1)})):(alert("We had an issue talking to the card machine - please try again by using the buttons below"),d.show_loading=!1,d.show_cardmachine=!0)})},d.pay_with_saved_card=function(){d.show_loading=!0,d.send.card_id=d.selectedSavedCardId,e.CreateSavedPaymentIntent(d.send).then(function(e){e.success?(d.paymentOk=!0,d.onConfirm({methodLabel:"saved-card",paymentIntent:e.payment})):(console.log("WOOOPSIES...",e),Stripe("pk_test_51QttFFG8WiGSRCORyxkdZTO8oajcqz9OUsvcDJFpr9FB2PAdbzJc0tS7WNnfzKYsTiqHN1YDZi5UtXk4K52SeD4h00YWXuChNd").confirmCardPayment(e.client_secret,{payment_method:e.payment_method,return_url:e.card_url.return_url}).then(function(t){t.error?(console.log(t.error),"payment_intent_authentication_failure"==t.error.code?(d.paymentNo=!0,d.payment_status_message="You have failed to pass your card issuer's authentication - please try again or pay with another payment method."):(d.paymentNo=!0,d.payment_status_message=t.error.message),d.show_loading=!1):"succeeded"===t.paymentIntent.status?n.CheckPayment(e.paymentID).then(function(e){e.success?(d.show_loading=!1,d.paymentOk=!0,d.onConfirm({methodLabel:"saved-card",paymentIntent:t.paymentIntent})):(d.paymentNo=!0,d.payment_status_message=t.error.message,d.show_loading=!1)}):(console.log("not sure what happened - payment bit"),d.show_loading=!1),d.show_loading=!1}))})}}]}}),app.factory("smoothScroll",["$window","$document","$timeout",function(d,t,e){function n(e,a){a=a||600;var r=d.pageYOffset,i=e-r,o=null;d.requestAnimationFrame(function e(t){var n=(t-(o=o||t))/a,t=(t=n=1<n?1:n)<.5?2*t*t:(4-2*t)*t-1;d.scrollTo(0,r+i*t),n<1&&d.requestAnimationFrame(e)})}return{toElement:function(e,t){e&&n(e.getBoundingClientRect().top+d.pageYOffset,t)},toTop:function(e){n(0,e)},toBottom:function(e){n(t[0].body.scrollHeight-d.innerHeight,e)}}}]),app.directive("mobileSlideMenu",["$document","$window",function(r,i){return{restrict:"A",link:function(t,e){t.menuOpen=!1,t.openMenu=function(){t.menuOpen=!0},t.closeMenu=function(){t.menuOpen=!1},t.toggleMenu=function(){t.menuOpen=!t.menuOpen};function n(e){"Escape"!==e.key&&27!==e.keyCode||t.$applyAsync(function(){t.closeMenu()})}r.on("keydown",n);function a(){860<i.innerWidth&&t.menuOpen&&t.$applyAsync(function(){t.closeMenu()})}angular.element(i).on("resize",a),t.onMenuItemClick=function(e){e&&e.preventDefault&&e.preventDefault(),t.closeMenu()},t.$on("$destroy",function(){r.off("keydown",n),angular.element(i).off("resize",a)})}}}]),angular.module("app").directive("uibTimepicker",["uibDateParser",function(r){return{require:"ngModel",link:function(e,t,n,a){a.$formatters.push(function(e){return e&&r.fromTimezone(e,"UTC")}),a.$parsers.push(function(e){return e&&r.toTimezone(e,"UTC")})}}}]),app.filter("range",function(){return function(e,t,n){t=parseInt(t),n=parseInt(n);for(var a=t;a<=n;a++)e.push(a);return e}}),app.directive("numberSelector",function(){function o(e,t,n){console.log("ATTR",n.available),function(){n.available;for(var e="",t=0;t<n.available;t++)e+="<option value='"+t+"'>"+t+"</option>";console.log("TBD",e)}()}return{compile:function(e,t,n){if(t.available){t.available;var a=t.model+"["+t.iteration+"].number";console.log("TBD MODEL",a);for(var r="",i=1;i<=t.available;i++)r+="<option value='"+i+"'>"+i+"</option>";return e.html("<select class='form-control' ng-model='"+a+"'>"+r+"</select>"),o}},restrict:"AE"}}),app.directive("fadeIn",function(){function a(e,t,n){var a=t.find("img.fader"),r=t.find("img.image");function i(){a.width(),a.addClass("fadeOut"),setTimeout(o,250)}function o(){a.removeClass("show fadeOut")}e.$watch("vm.current.image.link",function(e,t){e!==t&&(a.hasClass("show")||a.hasClass("fadeOut")||(t=t,a.prop("src",t).addClass("show").css("margin-left",$(".imagemain1").css("margin-left")),r.one("load",i)))})}return{compile:function(e,t,n){return e.prepend("<img class='fader' />"),a},restrict:"A"}}),app.directive("fullCalendar",function(){return{restrict:"E",scope:{options:"="},link:function(n,e){var a,r=e[0];n.$watch("options",function(e,t){e&&(a&&a.destroy(),(a=new FullCalendar.Calendar(r,n.options)).render())},!0)}}}),app.directive("uniquelink",["$q","$timeout","GalleryService",function(r,e,i){return{require:"ngModel",link:function(e,t,n,a){a.$asyncValidators.uniquelink=function(e,t){if(a.$isEmpty(e))return r.when();var n=r.defer();return i.CheckLink(e).then(function(e){1==e.available?n.resolve():n.reject()}),n.promise}}}}]),app.directive("newuniquelink",["$q","$timeout","GalleryService","LocalDataService",function(d,e,t,s){return{require:"ngModel",link:function(e,t,n,o){o.$asyncValidators.newuniquelink=function(e,t){if(o.$isEmpty(e))return d.when();for(var n=d.defer(),a=s.data.all_galleries,r=0,i=0;i<a.length;i++)a[i].gallery_link==e&&r++;return 1<r?n.reject():n.resolve(),n.promise}}}}]),app.directive("datepicker",function(){return{restrict:"A",link:function(e,t,n){n=e.$eval(n.dateoptions);n.format="d/m/yyyy",n.autoclose="true",n.todayHighlight="true",n.defaultDate=(new Date).format("d/M/yyyy"),n.setDate=(new Date).format("d/M/yyyy"),t.datepicker(n)}}}),app.directive("timePicker",["$timeout",function(a){return{restrict:"AC",scope:{ngModel:"="},link:function(e,n,t){t=e.$eval(t.timeoptions);console.log("BOOOOO ",t),n.on("change",function(){n.hasClass("start")&&a(function(){var e=n.closest("[date-pair]").find("input.end"),t=angular.element(e).isolateScope();t.$apply(function(){t.ngModel=e.val()})},0)}),n.timepicker(t)}}}]),app.directive("datePair",function(){return{restrict:"AC",scope:{dateoptions:"="},link:function(e,t,n){n=e.$eval(n.dateoptions);console.log("BOOOOO ",n),t.datepair({scrollDefault:"now",showDuration:!0})}}}),angular.module("rgkevin.datetimeRangePicker",["vr.directives.slider"]).filter("rgTime",[function(){return function(e,t){var n=parseInt(e/60,10);return(!t&&12<n?24===n?"00":(n-12<10?"0":"")+(n-12):(n<10?"0":"")+n)+":"+(e-60*n<10?"0"+(e-60*n):e-60*n)+(12<=n&&24!==n?" pm":" am")}}]).directive("rgRangePicker",["$compile","$timeout","$filter",function(f,h,g){return{restrict:"A",scope:{data:"=rgRangePicker",labels:"=",onTimeChange:"&",maxRangeDate:"=",vertical:"="},template:function(){return'<div class="rg-range-picker" ng-class="{\'rg-range-picker-vertical\':vertical}"><div class="rg-range-picker-box well" ng-class="{ \'only-calendars\': !data.hasTimeSliders, \'only-slider\': !data.hasDatePickers }"><div class="rg-range-picker-calendars" ng-show="data.hasDatePickers"><div class="rg-range-picker-calendar-box"><h5 class="rg-range-picker-calendar-label" ng-bind-template="{{datepickerTitles.from}}"></h5><div uib-datepicker ng-model="data.date.from" max-date="data.date.to" min-date="data.date.min" show-weeks="false" class="clean-calendar" datepicker-options="{minDate: data.date.min, showWeeks: false, startingDay: 1}"></div></div><div class="rg-range-picker-calendar-box right"><h5 class="rg-range-picker-calendar-label" ng-bind-template="{{datepickerTitles.to}}"></h5><div uib-datepicker ng-model="data.date.to" min-date="data.date.from" max-date="data.date.max" show-weeks="false" class="clean-calendar" datepicker-options="{minDate: data.date.from, maxDate: data.date.max, showWeeks: false, startingDay: 1}"></div></div></div><div class="rg-range-picker-slider" id="rgRangePickerSliderContainer" ng-show="data.hasTimeSliders"><div class="rg-range-picker-slider-labels"><div class="row"><div class="rg-range-picker-divider xs-hidden"><span class="label">to</span></div><div class="col-xs-6 text-center"><span class="label label-range-picker">{{data.time.from | rgTime:data.time.hours24}}</span></div><div class="col-xs-6 text-center"><span class="label label-range-picker">{{data.time.to | rgTime:data.time.hours24}}</span></div></div></div></div></div></div>'},link:function(i,e,t){var n,a=angular.element("#rgRangePickerSliderContainer",e[0]),r=angular.element('<div slider class="clean-slider" ng-model="data.time.from" ng-model-range="data.time.to" floor="{{data.time.dFrom}}" ceiling="{{data.time.dTo}}" buffer="{{data.time.minRange || 1}}" step="{{data.time.step || 1}}" step-width="{{data.time.step || 1}}" precision="0" stretch="3"></div>'),o=!1,d={from:new Date,to:new Date,min:null,max:null};function s(){!o&&i.data.hasTimeSliders&&(a.append(r),f(r)(i),o=!0,e.width()<=400&&angular.element(".rg-range-picker",e[0]).addClass("rg-range-picker-responsive"))}function c(e,t){angular.isUndefined(n)||(console.log("update the datetime field I guess? : "+i.data.time.from),h.cancel(n)),e!==t&&(n=h(function(){console.log("update the datetime field I guess? : "+i.data.time.from),i.onTimeChange()({from:g("rgTime")(i.data.time.from,!0),to:g("rgTime")(i.data.time.to,!0),range:g("rgTime")(i.data.time.to-i.data.time.from,!0)})},500))}i.data.hasDatePickers=angular.isObject(i.data.date),i.data.hasTimeSliders=angular.isObject(i.data.time),i.datepickerTitles=angular.extend({from:"START_DATE",to:"END_DATE"},i.labels&&i.labels.date),i.data.hasDatePickers&&(i.data.date=angular.extend(d,i.data.date)),i.data.hasTimeSliders&&(i.data.time=angular.extend({from:480,to:1020,dFrom:0,dTo:1440,step:15,minRange:15,hours24:!0},i.data.time)),t.collapse?i.$watch(function(){return e[0].className},function(){e.hasClass("in")&&s()}):s(),!angular.isUndefined(i.onTimeChange())&&i.data.hasTimeSliders&&(i.$watch("data.time.from",c),i.$watch("data.time.to",c));var l=864e5*(i.maxRangeDate&&i.maxRangeDate-1||0),u=i.data.date&&i.data.date.max&&i.data.date.max.getTime(),m=i.data.date&&i.data.date.min&&i.data.date.min.getTime();function p(){var e=i.data.date.to.getTime()-i.data.date.from.getTime(),t=l-e,e=i.data.date.from.getTime()-t<m?m:i.data.date.from.getTime()-t,t=i.data.date.to.getTime()+t>u?u:i.data.date.to.getTime()+t;i.data.date.min=new Date(e),i.data.date.max=new Date(t)}i.$watch("data.date.from",function(){var e,t,n,a,r;i.data.date.from>i.data.date.to&&(e=i.data.date.from.getFullYear(),t=i.data.date.from.getMonth(),n=i.data.date.from.getDate(),a=Math.floor(i.data.time.to/60),r=i.data.time.to%60,i.data.date.to=new Date(e,t,n,a,r,0))}),i.maxRangeDate&&i.data.hasDatePickers&&(i.$watch("data.date.from",p),i.$watch("data.date.to",p))},controller:["$scope","$element","$attrs",function(e,t,n){}]}}]),angular.module("ui.calendar",[]).constant("uiCalendarConfig",{calendars:{}}).controller("uiCalendarCtrl",["$scope","$locale",function(r,n){var d=r.eventSources,t=r.calendarWatchEvent||angular.noop,a=1;this.eventFingerprint=function(e){return e._id||(e._id=a++),""+e._id+(e.id||"")+(e.title||"")+(e.url||"")+(+e.start||"")+(+e.end||"")+(e.allDay||"")+(e.className||"")+t({event:e})||""};var i=1,o=1;this.sourceFingerprint=function(e){var t=""+(e.__id||(e.__id=i++)),e=angular.isObject(e)&&e.events;return t=e?t+"-"+(e.__id||(e.__id=o++)):t},this.allEvents=function(){for(var e=[],t=0,n=d.length;t<n;t++){var a=d[t];if(angular.isArray(a))e.push(a);else if(angular.isObject(a)&&angular.isArray(a.events)){var r,i={};for(r in a)"_id"!==r&&"events"!==r&&(i[r]=a[r]);for(var o=0;o<a.events.length;o++)angular.extend(a.events[o],i);e.push(a.events)}}return Array.prototype.concat.apply([],e)},this.changeWatcher=function(o,u){function t(){for(var e,t,n=angular.isFunction(o)?o():o,a=[],r=0,i=n.length;r<i;r++)t=n[r],e=u(t),f[e]=t,a.push(e);return a}function m(e,t){for(var n=[],a={},r=0,i=t.length;r<i;r++)a[t[r]]=!0;for(r=0,i=e.length;r<i;r++)a[e[r]]||n.push(e[r]);return n}var p,f={};return p={subscribe:function(e,n){e.$watch(t,function(e,t){n&&!1===n(e,t)||function(e,t){for(var n,a={},r=m(t,e),i=0,o=r.length;i<o;i++){var d=r[i],s=f[d];delete f[d];var c=u(s);c===d?p.onRemoved(s):(a[c]=d,p.onChanged(s))}var l=m(e,t);for(i=0,o=l.length;i<o;i++)n=l[i],s=f[n],a[n]||p.onAdded(s)}(e,t)},!0)},onAdded:angular.noop,onChanged:angular.noop,onRemoved:angular.noop}},this.getFullCalendarConfig=function(e,t){var a={};return angular.extend(a,t),angular.extend(a,e),angular.forEach(a,function(e,t){var n;"function"==typeof e&&(a[t]=(n=a[t],function(){if(r.$root.$$phase)return n.apply(this,arguments);var e=arguments,t=this;return r.$root.$apply(function(){return n.apply(t,e)})}))}),a},this.getLocaleConfig=function(e){if(e.lang&&!e.useNgLocale)return{};function t(e){var t,n=[];for(t in e)n[t]=e[t];return n}e=n.DATETIME_FORMATS;return{monthNames:t(e.MONTH),monthNamesShort:t(e.SHORTMONTH),dayNames:t(e.DAY),dayNamesShort:t(e.SHORTDAY)}}}]).directive("uiCalendar",["uiCalendarConfig",function(l){return{restrict:"A",scope:{eventSources:"=ngModel",calendarWatchEvent:"&"},controller:"uiCalendarCtrl",link:function(r,e,i,o){var d,s=r.eventSources,t=!1,n=o.changeWatcher(s,o.sourceFingerprint),a=o.changeWatcher(o.allEvents,o.eventFingerprint),c=null;r.destroy=function(){d&&d.fullCalendar&&d.fullCalendar("destroy"),d=i.calendar?l.calendars[i.calendar]=$(e).html(""):$(e).html("")},r.init=function(){d.fullCalendar(c),i.calendar&&(l.calendars[i.calendar]=d)},n.onAdded=function(e){d.fullCalendar("addEventSource",e),t=!0},n.onRemoved=function(e){d.fullCalendar("removeEventSource",e),t=!0},n.onChanged=function(e){d.fullCalendar("refetchEvents"),t=!0},a.onAdded=function(e){d.fullCalendar("renderEvent",e,!!e.stick)},a.onRemoved=function(e){d.fullCalendar("removeEvents",e._id)},a.onChanged=function(e){for(var t=d.fullCalendar("clientEvents",e._id),n=0;n<t.length;n++){var a=t[n],a=angular.extend(a,e);d.fullCalendar("updateEvent",a)}},n.subscribe(r),a.subscribe(r,function(){if(!0===t)return t=!1}),r.$watch(function(){var e=i.uiCalendar?r.$parent.$eval(i.uiCalendar):{},t=o.getFullCalendarConfig(e,l),e=o.getLocaleConfig(t);angular.extend(e,t),c={eventSources:s},angular.extend(c,e),c.calendars=null;var n,a={};for(n in c)"eventSources"!==n&&(a[n]=c[n]);return JSON.stringify(a)},function(e,t){r.destroy(),r.init()})}}}]);