{"version":3,"sources":["directives.js"],"names":["app","directive","scope","fileread","link","element","attributes","bind","changeEvent","reader","FileReader","onload","loadEvent","$apply","target","result","replace","readAsText","files","filter","input","charAt","toUpperCase","substr","toLowerCase","moment","format","split","restrict","require","attrs","ngModelCtrl","datetimepicker","dateFormat","language","pickSeconds","on","e","$setViewValue","date","$","parent","find","focus","indexOf","x","min_nearest_five","parseInt","utc","a","b","slice","$timeout","collapsible","el","node","open","classList","add","style","height","scrollHeight","onEnd","propertyName","removeEventListener","addEventListener","close","current","getBoundingClientRect","offsetHeight","remove","$watch","isOpen","buildSuccessDOM","msg","wrapper","document","createElement","className","setAttribute","confetti","i","piece","left","Math","random","animationDelay","animationDuration","appendChild","toast","ico","svg","createElementNS","path","text","title","textContent","sub","root","buildFailureDOM","p1","p2","paymentSuccessToast","message","durationMs","onDone","showMs","angular","isNumber","hideTimer","doneTimer","nodes","cleanup","cancel","parentNode","removeChild","show","body","fire","$on","paymentFailureToast","methods","savedCards","send","info","user","bookout","invoice","onConfirm","controllerAs","bindToController","templateUrl","controller","$sce","PaymentService","$scope","BookoutService","EnvConfig","vm","show_loading","show_cardmachine","CreatePaymentIntentNewCard","then","data","console","log","stripe","Stripe","getStripeKey","options","clientSecret","client_secret","appearance","rules","zIndex","wallets","paymentMethodOrder","elements","paymentElementOptions","layout","paymentElement","create","mount","submitButton","getElementById","event","preventDefault","confirmPayment","confirmParams","redirect","error","paymentIntent","code","paymentNo","payment_status_message","status","paymentOk","methodLabel","expandedId","selectedId","selectedSavedCardId","dd","name","email","sortCode","account","card","number","exp","cvc","$onInit","length","id","toggle","isExpanded","keyHeader","k","which","keyCode","switchTo","type","ddReady","cardReady","confirm","selectedTitle","selectSavedCard","keySelectTile","cardBrandIcon","brand","visa","mc","amex","test","trustAsHtml","close_machine_popup","ClearMachine","payment_id","club_id","success","show_after_bookedin","cancel_machine","stop_polling","close_bookedin","reset_card_machine","RetryPaymentMachine","poll_check_payment","details","payment_errors","maxAttempts","finalCallback","attempts","attempt","check_payment","add_info","new_error","charge_id","charge","check","some","setTimeout","push","get_update_on_cardmachine","retry","limit","callback2","callback","CheckPayment","pay_with_cardmachine","CreateCardMachinePaymentIntent","paymentID","alert","pay_with_saved_card","card_id","CreateSavedPaymentIntent","payment","confirmCardPayment","payment_method","return_url","card_url","factory","$window","$document","scrollTo","targetY","duration","startY","pageYOffset","distanceY","startTime","easeInOutQuad","t","step","timestamp","progress","eased","requestAnimationFrame","toElement","rect","top","toTop","toBottom","innerHeight","menuOpen","openMenu","closeMenu","toggleMenu","onKeyDown","key","$applyAsync","onResize","innerWidth","onMenuItemClick","$event","off","module","uibDateParser","ngModel","$formatters","value","fromTimezone","$parsers","toTimezone","min","max","compile","transclude","available","model","iteration","tbd","html","getOptions","prepend","fader","primary","newValue","oldValue","isFading","initFade","fadeSource","prop","addClass","css","one","startFade","hasClass","width","teardownFade","removeClass","lcfOnDrop","lcfOnDragState","dragCounter","setDragState","isDragging","stopPropagation","dt","dataTransfer","originalEvent","lcfFileSelect","calendarEl","calendar","renderCalendar","destroy","FullCalendar","Calendar","render","newOptions","oldOptions","$q","GalleryService","elm","ctrl","$asyncValidators","uniquelink","modelValue","viewValue","$isEmpty","when","def","defer","CheckLink","resolve","reject","promise","LocalDataService","newuniquelink","galleries","all_galleries","counter","gallery_link","attr","obj","$eval","dateoptions","autoclose","todayHighlight","defaultDate","Date","setDate","datepicker","timeoptions","$el","closest","endScope","isolateScope","val","timepicker","datepair","scrollDefault","showDuration","hours","minutes","meridian","$compile","$filter","labels","onTimeChange","maxRangeDate","vertical","template","sliderMinWidth","sliderContainer","slider","sliderAlreadyRender","defaultLabels","from","to","timeDefaults","dFrom","dTo","minRange","hours24","dateDefaults","timeChangePromise","hasDatePickers","isObject","hasTimeSliders","time","datepickerTitles","extend","renderSlider","append","collapse","timeChanges","isUndefined","range","maxRange","superMaxDate","getTime","superMinDate","updateMinAndMaxDate","currentRange","offset","_min","_max","updateEndDate","y","getFullYear","m","getMonth","d","getDate","h","floor","$element","$attrs","constant","calendars","$locale","sources","eventSources","extraEventSignature","calendarWatchEvent","noop","wrapFunctionWithScopeApply","functionToWrap","$root","$$phase","apply","arguments","args","self","eventSerialId","eventFingerprint","_id","url","start","end","allDay","sourceSerialId","sourceEventsSerialId","sourceFingerprint","source","fp","__id","events","allEvents","arraySources","srcLen","isArray","extEvent","eI","Array","prototype","concat","changeWatcher","arraySource","tokenFn","getTokens","array","isFunction","token","n","map","subtractAsSets","inB","applyChanges","newTokens","oldTokens","replacedTokens","removedTokens","removedToken","newToken","onRemoved","onChanged","addedTokens","onAdded","subscribe","onArrayChanged","notify","getFullCalendarConfig","calendarSettings","uiCalendarConfig","config","forEach","getLocaleConfig","fullCalendarConfig","lang","useNgLocale","tValues","r","dtf","DATETIME_FORMATS","monthNames","MONTH","monthNamesShort","SHORTMONTH","dayNames","DAY","dayNamesShort","SHORTDAY","sourcesChanged","eventSourcesWatcher","eventsWatcher","uiCalendar","$parent","localeFullCalendarConfig","options2","o","JSON","stringify","fullCalendar","init","stick","clientEvents","clientEvent","newO","oldO"],"mappings":";;;;;;AAAA;AAAqC;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEAA,GAAG,CAACC,SAAJ,CAAc,UAAd,EAA0B,CAAC,YAAY;AACnC,SAAO;AACHC,IAAAA,KAAK,EAAE;AACHC,MAAAA,QAAQ,EAAE;AADP,KADJ;AAIHC,IAAAA,IAAI,EAAE,cAAUF,KAAV,EAAiBG,OAAjB,EAA0BC,UAA1B,EAAsC;AACxCD,MAAAA,OAAO,CAACE,IAAR,CAAa,QAAb,EAAuB,UAAUC,WAAV,EAAuB;AAC1C,YAAIC,MAAM,GAAG,IAAIC,UAAJ,EAAb;;AACAD,QAAAA,MAAM,CAACE,MAAP,GAAgB,UAAUC,SAAV,EAAqB;AACjCV,UAAAA,KAAK,CAACW,MAAN,CAAa,YAAY;AACrB;AACAX,YAAAA,KAAK,CAACC,QAAN,GAAiBS,SAAS,CAACE,MAAV,CAAiBC,MAAjB,CAAwBC,OAAxB,CAAgC,UAAhC,EAA2C,IAA3C,CAAjB;AACH,WAHD;AAIH,SALD;;AAMAP,QAAAA,MAAM,CAACQ,UAAP,CAAkBT,WAAW,CAACM,MAAZ,CAAmBI,KAAnB,CAAyB,CAAzB,CAAlB;AACH,OATD;AAUH;AAfE,GAAP;AAiBH,CAlByB,CAA1B;AAwBAlB,GAAG,CAACmB,MAAJ,CAAW,YAAX,EAAyB,YAAW;AAChC,SAAO,UAASC,KAAT,EAAgB;AACrB,WAAQ,CAAC,CAACA,KAAH,GAAYA,KAAK,CAACC,MAAN,CAAa,CAAb,EAAgBC,WAAhB,KAAgCF,KAAK,CAACG,MAAN,CAAa,CAAb,EAAgBC,WAAhB,EAA5C,GAA4E,EAAnF;AACD,GAFD;AAGH,CAJD;AAMAxB,GAAG,CAACmB,MAAJ,CAAW,YAAX,EAAyB,YAAW;AAChC,SAAO,UAASC,KAAT,EAAgB;AACrB,WAAQ,CAAC,CAACA,KAAH,GAAYK,MAAM,CAACL,KAAD,CAAN,CAAcM,MAAd,CAAqB,kBAArB,CAAZ,GAAuD,EAA9D;AACD,GAFD;AAGH,CAJD;AAMA1B,GAAG,CAACmB,MAAJ,CAAW,eAAX,EAA4B,YAAU;AACpC,SAAO,UAASC,KAAT,EAAe;AACpB,WAAQ,CAAC,CAACA,KAAH,GAAYA,KAAK,CAACE,WAAN,EAAZ,GAAkC,EAAzC;AACD,GAFD;AAGD,CAJD;AAMAtB,GAAG,CAACmB,MAAJ,CAAW,YAAX,EAAyB,YAAW;AAChC,SAAO,UAASC,KAAT,EAAgB;AACrB,QAAGA,KAAH,EAAS;AACP,UAAIO,KAAK,GAAGP,KAAK,CAACO,KAAN,CAAY,GAAZ,CAAZ;AACA,aAAQ,CAAC,CAACP,KAAH,GAAYO,KAAK,CAAC,CAAD,CAAL,GAAS,GAAT,GAAaA,KAAK,CAAC,CAAD,CAA9B,GAAoC,EAA3C;AACD,KAHD,MAGO;AACL,aAAO,EAAP;AACD;AACF,GAPD;AAQH,CATD;AAWA3B,GAAG,CAACC,SAAJ,CAAc,WAAd,EAA2B,YAAW;AAClC,SAAO;AACH2B,IAAAA,QAAQ,EAAE,GADP;AAEHC,IAAAA,OAAO,EAAG,SAFP;AAGHzB,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyByB,KAAzB,EAAgCC,WAAhC,EAA6C;AACjD1B,MAAAA,OAAO,CAAC2B,cAAR,CAAuB;AACrBC,QAAAA,UAAU,EAAC,qBADU;AAErBC,QAAAA,QAAQ,EAAE,IAFW;AAGrB;AACAC,QAAAA,WAAW,EAAE;AAJQ,OAAvB,EAKGC,EALH,CAKM,YALN,EAKoB,UAASC,CAAT,EAAY;AAC9BN,QAAAA,WAAW,CAACO,aAAZ,CAA0BD,CAAC,CAACE,IAA5B;AACArC,QAAAA,KAAK,CAACW,MAAN;AACA2B,QAAAA,CAAC,CAAC,IAAD,CAAD,CAAQC,MAAR,GAAiBC,IAAjB,CAAsB,OAAtB,EAA+BC,KAA/B;AACD,OATD;AAUD;AAdE,GAAP;AAgBH,CAjBD;AAmBA3C,GAAG,CAACmB,MAAJ,CAAW,WAAX,EAAwB,YAAU;AAChC,SAAO,UAASC,KAAT,EAAe;AACZ,QAAGA,KAAH,EAAS;AACP,UAAGA,KAAK,CAACwB,OAAN,CAAc,GAAd,IAAqB,CAAC,CAAzB,EAA2B;AACzB,YAAIjB,KAAK,GAAGP,KAAK,CAACO,KAAN,CAAY,GAAZ,CAAZ;AACA,YAAIkB,CAAC,GAAGlB,KAAK,CAAC,CAAD,CAAb;AACA,YAAImB,gBAAgB,GAAKD,CAAC,GAAG,CAAL,IAAW,GAAX,GAAiBE,QAAQ,CAACF,CAAC,GAAG,CAAL,CAAR,GAAkB,CAAlB,GAAsB,CAAvC,GAA2CE,QAAQ,CAACF,CAAC,GAAG,CAAL,CAAR,GAAkB,CAArF;;AACA,YAAGC,gBAAgB,GAAG,EAAtB,EAAyB;AACvBA,UAAAA,gBAAgB,GAAG,MAAIA,gBAAvB;AACD,SAFD,MAEO,IAAGA,gBAAgB,IAAI,EAAvB,EAA0B;AAC/BnB,UAAAA,KAAK,CAAC,CAAD,CAAL;AACAmB,UAAAA,gBAAgB,GAAG,IAAnB;AACD;;AACD,eAAOnB,KAAK,CAAC,CAAD,CAAL,GAAW,GAAX,GAAiBmB,gBAAxB;AACD,OAXD,MAWO;AACL,eAAO1B,KAAP;AACD;AACF,KAfD,MAeO;AACL,aAAO,EAAP;AACD;AACF,GAnBT;AAoBD,CArBD;AAwBApB,GAAG,CAACmB,MAAJ,CAAW,WAAX,EAAwB,YAAW;AAC/B,SAAO,UAASC,KAAT,EAAgB;AACrB,WAAQ,CAAC,CAACA,KAAH,GAAYK,MAAM,CAACuB,GAAP,CAAW5B,KAAX,EAAkBM,MAAlB,CAAyB,OAAzB,CAAZ,GAAgD,EAAvD;AACD,GAFD;AAGH,CAJD,E,CAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA1B,GAAG,CAACmB,MAAJ,CAAW,gBAAX,EAA6B,YAAY;AACrC,SAAO,UAAS8B,CAAT,EAAWC,CAAX,EAAa;AAChB,WAAM,CAAC,MAAI,EAAJ,GAAOD,CAAR,EAAWE,KAAX,CAAiB,CAACD,CAAlB,CAAN;AACH,GAFD;AAGH,CAJD;AAMAlD,GAAG,CAACC,SAAJ,CAAc,aAAd,EAA6B,CAAC,UAAD,EAAa,UAASmD,QAAT,EAAkB;AACtD,SAAO;AACLxB,IAAAA,QAAQ,EAAE,GADL;AAEL1B,IAAAA,KAAK,EAAE;AAAEmD,MAAAA,WAAW,EAAE;AAAf,KAFF;AAGLjD,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBoD,EAAhB,EAAoB;AACxB,UAAIC,IAAI,GAAGD,EAAE,CAAC,CAAD,CAAb;;AACA,eAASE,IAAT,GAAe;AACbD,QAAAA,IAAI,CAACE,SAAL,CAAeC,GAAf,CAAmB,MAAnB;AACAH,QAAAA,IAAI,CAACI,KAAL,CAAWC,MAAX,GAAoBL,IAAI,CAACM,YAAL,GAAoB,IAAxC;;AACA,YAAIC,KAAK,GAAG,SAARA,KAAQ,CAASzB,CAAT,EAAW;AACrB,cAAGA,CAAC,CAAC0B,YAAF,KAAiB,QAApB,EAA6B;AAC3BR,YAAAA,IAAI,CAACI,KAAL,CAAWC,MAAX,GAAoB,MAApB;AACAL,YAAAA,IAAI,CAACS,mBAAL,CAAyB,eAAzB,EAA0CF,KAA1C;AACD;AACF,SALD;;AAMAP,QAAAA,IAAI,CAACU,gBAAL,CAAsB,eAAtB,EAAuCH,KAAvC;AACD;;AACD,eAASI,KAAT,GAAgB;AACd,YAAIC,OAAO,GAAGZ,IAAI,CAACa,qBAAL,GAA6BR,MAA3C;AACAL,QAAAA,IAAI,CAACI,KAAL,CAAWC,MAAX,GAAoBO,OAAO,GAAG,IAA9B;AACAZ,QAAAA,IAAI,CAACc,YAAL;AACAd,QAAAA,IAAI,CAACE,SAAL,CAAea,MAAf,CAAsB,MAAtB;AACAf,QAAAA,IAAI,CAACI,KAAL,CAAWC,MAAX,GAAoB,KAApB;AACD;;AACD1D,MAAAA,KAAK,CAACqE,MAAN,CAAa,aAAb,EAA4B,UAASC,MAAT,EAAgB;AAC1CpB,QAAAA,QAAQ,CAAC,YAAU;AAAEoB,UAAAA,MAAM,GAAGhB,IAAI,EAAP,GAAYU,KAAK,EAAvB;AAA4B,SAAzC,CAAR;AACD,OAFD;AAGD;AA1BI,GAAP;AA4BD,CA7BwB,CAA7B,E,CAkCE;;AACA,SAASO,eAAT,CAAyBC,GAAzB,EAA8B;AAC5B,MAAIC,OAAO,GAAGC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAd;AACAF,EAAAA,OAAO,CAACG,SAAR,GAAoB,YAApB;AACAH,EAAAA,OAAO,CAACI,YAAR,CAAqB,MAArB,EAA6B,QAA7B;AACAJ,EAAAA,OAAO,CAACI,YAAR,CAAqB,WAArB,EAAkC,QAAlC;AAEA,MAAIC,QAAQ,GAAGJ,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAf;AACAG,EAAAA,QAAQ,CAACF,SAAT,GAAqB,gBAArB;;AACA,OAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,EAApB,EAAwBA,CAAC,EAAzB,EAA6B;AAC3B,QAAIC,KAAK,GAAGN,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAZ;AACAK,IAAAA,KAAK,CAACJ,SAAN,GAAkB,aAAlB;AACAI,IAAAA,KAAK,CAACvB,KAAN,CAAYwB,IAAZ,GAAoBC,IAAI,CAACC,MAAL,KAAgB,GAAjB,GAAwB,IAA3C;AACAH,IAAAA,KAAK,CAACvB,KAAN,CAAY2B,cAAZ,GAA8BF,IAAI,CAACC,MAAL,KAAgB,GAAjB,GAAwB,IAArD;AACAH,IAAAA,KAAK,CAACvB,KAAN,CAAY4B,iBAAZ,GAAiC,MAAMH,IAAI,CAACC,MAAL,KAAgB,GAAvB,GAA8B,IAA9D;AACAL,IAAAA,QAAQ,CAACQ,WAAT,CAAqBN,KAArB;AACD;;AAED,MAAIO,KAAK,GAAGb,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAZ;AACAY,EAAAA,KAAK,CAACX,SAAN,GAAkB,aAAlB;AAEA,MAAIY,GAAG,GAAGd,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAV;AACAa,EAAAA,GAAG,CAACZ,SAAJ,GAAgB,WAAhB;AAEA,MAAIa,GAAG,GAAGf,QAAQ,CAACgB,eAAT,CAAyB,4BAAzB,EAAuD,KAAvD,CAAV;AACAD,EAAAA,GAAG,CAACZ,YAAJ,CAAiB,OAAjB,EAA0B,aAA1B;AACAY,EAAAA,GAAG,CAACZ,YAAJ,CAAiB,SAAjB,EAA4B,WAA5B;AACA,MAAIc,IAAI,GAAGjB,QAAQ,CAACgB,eAAT,CAAyB,4BAAzB,EAAuD,MAAvD,CAAX;AACAC,EAAAA,IAAI,CAACd,YAAL,CAAkB,GAAlB,EAAuB,gBAAvB;AACAY,EAAAA,GAAG,CAACH,WAAJ,CAAgBK,IAAhB;AACAH,EAAAA,GAAG,CAACF,WAAJ,CAAgBG,GAAhB;AAEA,MAAIG,IAAI,GAAGlB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAX;AAA0CiB,EAAAA,IAAI,CAAChB,SAAL,GAAiB,YAAjB;AAC1C,MAAIiB,KAAK,GAAGnB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAZ;AAA2CkB,EAAAA,KAAK,CAACjB,SAAN,GAAkB,aAAlB;AAAiCiB,EAAAA,KAAK,CAACC,WAAN,GAAoBtB,GAAG,IAAI,oBAA3B;AAC5E,MAAIuB,GAAG,GAAGrB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAV;AAA2CoB,EAAAA,GAAG,CAACnB,SAAJ,GAAkB,WAAlB;AAAiCmB,EAAAA,GAAG,CAACD,WAAJ,GAAoB,kCAApB;AAC5EF,EAAAA,IAAI,CAACN,WAAL,CAAiBO,KAAjB;AAAyBD,EAAAA,IAAI,CAACN,WAAL,CAAiBS,GAAjB;AAEzBR,EAAAA,KAAK,CAACD,WAAN,CAAkBE,GAAlB;AAAwBD,EAAAA,KAAK,CAACD,WAAN,CAAkBM,IAAlB;AAExBnB,EAAAA,OAAO,CAACa,WAAR,CAAoBR,QAApB;AACAL,EAAAA,OAAO,CAACa,WAAR,CAAoBC,KAApB;AACA,SAAO;AAAES,IAAAA,IAAI,EAAEvB,OAAR;AAAiBc,IAAAA,KAAK,EAAEA;AAAxB,GAAP;AACD;;AAED,SAASU,eAAT,CAAyBzB,GAAzB,EAA8B;AAC5B,MAAIC,OAAO,GAAGC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAd;AACAF,EAAAA,OAAO,CAACG,SAAR,GAAoB,cAApB;AACAH,EAAAA,OAAO,CAACI,YAAR,CAAqB,MAArB,EAA6B,OAA7B;AACAJ,EAAAA,OAAO,CAACI,YAAR,CAAqB,WAArB,EAAkC,WAAlC;AAEA,MAAIU,KAAK,GAAGb,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAZ;AACAY,EAAAA,KAAK,CAACX,SAAN,GAAkB,eAAlB;AAEA,MAAIY,GAAG,GAAGd,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAV;AACAa,EAAAA,GAAG,CAACZ,SAAJ,GAAgB,aAAhB;AAEA,MAAIa,GAAG,GAAGf,QAAQ,CAACgB,eAAT,CAAyB,4BAAzB,EAAuD,KAAvD,CAAV;AACAD,EAAAA,GAAG,CAACZ,YAAJ,CAAiB,OAAjB,EAA0B,WAA1B;AACAY,EAAAA,GAAG,CAACZ,YAAJ,CAAiB,SAAjB,EAA4B,WAA5B;AACA,MAAIqB,EAAE,GAAGxB,QAAQ,CAACgB,eAAT,CAAyB,4BAAzB,EAAuD,MAAvD,CAAT;AACAQ,EAAAA,EAAE,CAACrB,YAAH,CAAgB,GAAhB,EAAqB,YAArB;AACA,MAAIsB,EAAE,GAAGzB,QAAQ,CAACgB,eAAT,CAAyB,4BAAzB,EAAuD,MAAvD,CAAT;AACAS,EAAAA,EAAE,CAACtB,YAAH,CAAgB,GAAhB,EAAqB,YAArB;AACAY,EAAAA,GAAG,CAACH,WAAJ,CAAgBY,EAAhB;AAAqBT,EAAAA,GAAG,CAACH,WAAJ,CAAgBa,EAAhB;AACrBX,EAAAA,GAAG,CAACF,WAAJ,CAAgBG,GAAhB;AAEA,MAAIG,IAAI,GAAGlB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAX;AAA0CiB,EAAAA,IAAI,CAAChB,SAAL,GAAiB,cAAjB;AAC1C,MAAIiB,KAAK,GAAGnB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAZ;AAA2CkB,EAAAA,KAAK,CAACjB,SAAN,GAAkB,eAAlB;AAAmCiB,EAAAA,KAAK,CAACC,WAAN,GAAoBtB,GAAG,IAAI,gBAA3B;AAC9E,MAAIuB,GAAG,GAAGrB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAV;AAA2CoB,EAAAA,GAAG,CAACnB,SAAJ,GAAkB,aAAlB;AAAmCmB,EAAAA,GAAG,CAACD,WAAJ,GAAoB,uDAApB;AAC9EF,EAAAA,IAAI,CAACN,WAAL,CAAiBO,KAAjB;AAAyBD,EAAAA,IAAI,CAACN,WAAL,CAAiBS,GAAjB;AAEzBR,EAAAA,KAAK,CAACD,WAAN,CAAkBE,GAAlB;AAAwBD,EAAAA,KAAK,CAACD,WAAN,CAAkBM,IAAlB;AACxBnB,EAAAA,OAAO,CAACa,WAAR,CAAoBC,KAApB;AACA,SAAO;AAAES,IAAAA,IAAI,EAAEvB,OAAR;AAAiBc,IAAAA,KAAK,EAAEA;AAAxB,GAAP;AACD;;AAIAzF,GAAG,CAACC,SAAJ,CAAc,qBAAd,EAAqC,CAAC,UAAD,EAAa,UAAUmD,QAAV,EAAoB;AACnE,SAAO;AACLxB,IAAAA,QAAQ,EAAE,GADL;AAEL1B,IAAAA,KAAK,EAAE;AACLoG,MAAAA,mBAAmB,EAAE,GADhB;AACqB;AAC1BC,MAAAA,OAAO,EAAE,IAFJ;AAEqB;AAC1BC,MAAAA,UAAU,EAAE,IAHP;AAGqB;AAC1BC,MAAAA,MAAM,EAAE,IAJH,CAIqB;;AAJrB,KAFF;AAQLrG,IAAAA,IAAI,EAAE,cAAUF,KAAV,EAAiB;AACrB,UAAIwG,MAAM,GAAGC,OAAO,CAACC,QAAR,CAAiB1G,KAAK,CAACsG,UAAvB,IAAqCtG,KAAK,CAACsG,UAA3C,GAAwD,IAArE;AACA,UAAIK,SAAJ,EAAeC,SAAf,EAA0BC,KAA1B;;AAEA,eAASC,OAAT,GAAmB;AACjB,YAAIH,SAAJ,EAAezD,QAAQ,CAAC6D,MAAT,CAAgBJ,SAAhB;AACf,YAAIC,SAAJ,EAAe1D,QAAQ,CAAC6D,MAAT,CAAgBH,SAAhB;AACfD,QAAAA,SAAS,GAAGC,SAAS,GAAG,IAAxB;;AACA,YAAIC,KAAK,IAAIA,KAAK,CAACb,IAAf,IAAuBa,KAAK,CAACb,IAAN,CAAWgB,UAAtC,EAAkD;AAChDH,UAAAA,KAAK,CAACb,IAAN,CAAWgB,UAAX,CAAsBC,WAAtB,CAAkCJ,KAAK,CAACb,IAAxC;AACD;;AACDa,QAAAA,KAAK,GAAG,IAAR;AACD;;AAED,eAASK,IAAT,GAAgB;AACdJ,QAAAA,OAAO;AACPD,QAAAA,KAAK,GAAGtC,eAAe,CAACvE,KAAK,CAACqG,OAAP,CAAvB;AACA3B,QAAAA,QAAQ,CAACyC,IAAT,CAAc7B,WAAd,CAA0BuB,KAAK,CAACb,IAAhC;AACAW,QAAAA,SAAS,GAAGzD,QAAQ,CAAC,YAAY;AAC/B,cAAI,CAAC2D,KAAL,EAAY;AACZA,UAAAA,KAAK,CAACtB,KAAN,CAAYhC,SAAZ,CAAsBC,GAAtB,CAA0B,YAA1B;AACAoD,UAAAA,SAAS,GAAG1D,QAAQ,CAAC,YAAY;AAC/B4D,YAAAA,OAAO;AACP,gBAAI9G,KAAK,CAACuG,MAAV,EAAkBvG,KAAK,CAACuG,MAAN;AACnB,WAHmB,EAGjB,GAHiB,CAApB;AAID,SAPmB,EAOjBC,MAPiB,CAApB;AAQD;;AAEDxG,MAAAA,KAAK,CAACqE,MAAN,CAAa,qBAAb,EAAoC,UAAU+C,IAAV,EAAgB;AAClD,YAAIA,IAAJ,EAAUlE,QAAQ,CAACgE,IAAD,CAAR;AACX,OAFD;AAIAlH,MAAAA,KAAK,CAACqH,GAAN,CAAU,UAAV,EAAsBP,OAAtB;AACD;AAzCI,GAAP;AA2CD,CA5CmC,CAArC,E,CA8CC;;AACAhH,GAAG,CAACC,SAAJ,CAAc,qBAAd,EAAqC,CAAC,UAAD,EAAa,UAAUmD,QAAV,EAAoB;AACpE,SAAO;AACLxB,IAAAA,QAAQ,EAAE,GADL;AAEL1B,IAAAA,KAAK,EAAE;AACLsH,MAAAA,mBAAmB,EAAE,GADhB;AACqB;AAC1BjB,MAAAA,OAAO,EAAE,IAFJ;AAGLC,MAAAA,UAAU,EAAE,IAHP;AAILC,MAAAA,MAAM,EAAE;AAJH,KAFF;AAQLrG,IAAAA,IAAI,EAAE,cAAUF,KAAV,EAAiB;AACrB,UAAIwG,MAAM,GAAGC,OAAO,CAACC,QAAR,CAAiB1G,KAAK,CAACsG,UAAvB,IAAqCtG,KAAK,CAACsG,UAA3C,GAAwD,IAArE;AACA,UAAIK,SAAJ,EAAeC,SAAf,EAA0BC,KAA1B;;AAEA,eAASC,OAAT,GAAmB;AACjB,YAAIH,SAAJ,EAAezD,QAAQ,CAAC6D,MAAT,CAAgBJ,SAAhB;AACf,YAAIC,SAAJ,EAAe1D,QAAQ,CAAC6D,MAAT,CAAgBH,SAAhB;AACfD,QAAAA,SAAS,GAAGC,SAAS,GAAG,IAAxB;;AACA,YAAIC,KAAK,IAAIA,KAAK,CAACb,IAAf,IAAuBa,KAAK,CAACb,IAAN,CAAWgB,UAAtC,EAAkD;AAChDH,UAAAA,KAAK,CAACb,IAAN,CAAWgB,UAAX,CAAsBC,WAAtB,CAAkCJ,KAAK,CAACb,IAAxC;AACD;;AACDa,QAAAA,KAAK,GAAG,IAAR;AACD;;AAED,eAASK,IAAT,GAAgB;AACdJ,QAAAA,OAAO;AACPD,QAAAA,KAAK,GAAGZ,eAAe,CAACjG,KAAK,CAACqG,OAAP,CAAvB;AACA3B,QAAAA,QAAQ,CAACyC,IAAT,CAAc7B,WAAd,CAA0BuB,KAAK,CAACb,IAAhC;AACAW,QAAAA,SAAS,GAAGzD,QAAQ,CAAC,YAAY;AAC/B,cAAI,CAAC2D,KAAL,EAAY;AACZA,UAAAA,KAAK,CAACtB,KAAN,CAAYhC,SAAZ,CAAsBC,GAAtB,CAA0B,cAA1B;AACAoD,UAAAA,SAAS,GAAG1D,QAAQ,CAAC,YAAY;AAC/B4D,YAAAA,OAAO;AACP,gBAAI9G,KAAK,CAACuG,MAAV,EAAkBvG,KAAK,CAACuG,MAAN;AACnB,WAHmB,EAGjB,GAHiB,CAApB;AAID,SAPmB,EAOjBC,MAPiB,CAApB;AAQD;;AAEDxG,MAAAA,KAAK,CAACqE,MAAN,CAAa,qBAAb,EAAoC,UAAU+C,IAAV,EAAgB;AAClD,YAAIA,IAAJ,EAAUlE,QAAQ,CAACgE,IAAD,CAAR;AACX,OAFD;AAIAlH,MAAAA,KAAK,CAACqH,GAAN,CAAU,UAAV,EAAsBP,OAAtB;AACD;AAzCI,GAAP;AA2CD,CA5CoC,CAArC;AAgDFhH,GAAG,CAACC,SAAJ,CAAc,kBAAd,EAAkC,YAAU;AAC1C,SAAO;AACL2B,IAAAA,QAAQ,EAAE,GADL;AAEL1B,IAAAA,KAAK,EAAE;AACLuH,MAAAA,OAAO,EAAE,GADJ;AAELC,MAAAA,UAAU,EAAE,GAFP;AAGLC,MAAAA,IAAI,EAAE,GAHD;AAILnE,MAAAA,IAAI,EAAE,GAJD;AAKLoE,MAAAA,IAAI,EAAE,GALD;AAMLC,MAAAA,IAAI,EAAE,GAND;AAOLC,MAAAA,OAAO,EAAE,GAPJ;AAQLC,MAAAA,OAAO,EAAE,GARJ;AASLC,MAAAA,SAAS,EAAE;AATN,KAFF;AAaLC,IAAAA,YAAY,EAAE,IAbT;AAcLC,IAAAA,gBAAgB,EAAE,IAdb;AAeLC,IAAAA,WAAW,EAAE,kCAfR;AAe8C;AACnDC,IAAAA,UAAU,EAAE,CAAC,MAAD,EAAS,gBAAT,EAA2B,QAA3B,EAAqC,gBAArC,EAAuD,WAAvD,EAAoE,UAASC,IAAT,EAAeC,cAAf,EAA+BC,MAA/B,EAAuCC,cAAvC,EAAuDC,SAAvD,EAAiE;AAC/I,UAAIC,EAAE,GAAG,IAAT;AAEAA,MAAAA,EAAE,CAACC,YAAH,GAAkB,KAAlB;AACAD,MAAAA,EAAE,CAACE,gBAAH,GAAsB,KAAtB;AAEA;AACR;AACA;AACA;AACA;AACA;AAGQ;;AAEAN,MAAAA,cAAc,CAACO,0BAAf,CAA0CH,EAAE,CAACf,IAA7C,EACKmB,IADL,CACU,UAAUC,IAAV,EAAgB;AAClBC,QAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyBF,IAAzB,EADkB,CAElB;;AACA,YAAIG,MAAM,GAAGC,MAAM,CAACV,SAAS,CAACW,YAAV,EAAD,CAAnB;AAEA,YAAMC,OAAO,GAAG;AACdC,UAAAA,YAAY,EAAEP,IAAI,CAACQ,aADL;AAEd;AACAC,UAAAA,UAAU,EAAE;AACVC,YAAAA,KAAK,EAAE;AACL,+BAAiB;AACfC,gBAAAA,MAAM,EAAE,kBADO,CACY;;AADZ,eADZ;AAIL,+BAAiB;AACfA,gBAAAA,MAAM,EAAE,kBADO,CACY;;AADZ;AAJZ;AADG,WAHE;AAabC,UAAAA,OAAO,EAAE;AACRvJ,YAAAA,IAAI,EAAE,OADE,CACM;;AADN,WAbI;AAgBdwJ,UAAAA,kBAAkB,EAAE,CAAC,MAAD,EAAS,WAAT,EAAsB,YAAtB;AAhBN,SAAhB,CALkB,CAyBlB;;AACA,YAAMC,QAAQ,GAAGX,MAAM,CAACW,QAAP,CAAgBR,OAAhB,CAAjB,CA1BkB,CA4BlB;;AACA,YAAMS,qBAAqB,GAAG;AAAEC,UAAAA,MAAM,EAAE;AAAV,SAA9B;AACA,YAAMC,cAAc,GAAGH,QAAQ,CAACI,MAAT,CAAgB,SAAhB,EAA2BH,qBAA3B,CAAvB;AACAE,QAAAA,cAAc,CAACE,KAAf,CAAqB,kBAArB;AAGA,YAAMC,YAAY,GAAGvF,QAAQ,CAACwF,cAAT,CAAwB,eAAxB,CAArB;;AACA,YAAID,YAAJ,EAAkB;AAChBA,UAAAA,YAAY,CAAClG,gBAAb,CAA8B,OAA9B;AAAA,+EAAuC,iBAAOoG,KAAP;AAAA;;AAAA;AAAA;AAAA;AAAA;AAErC9B,sBAAAA,MAAM,CAAC1H,MAAP,CAAc,YAAM;AAChB6H,wBAAAA,EAAE,CAACC,YAAH,GAAkB,IAAlB;AACH,uBAFD;AAGA0B,sBAAAA,KAAK,CAACC,cAAN,GALqC,CAMrC;AAEA;;AARqC;AAAA,6BASApB,MAAM,CAACqB,cAAP,CAAsB;AACzDV,wBAAAA,QAAQ,EAARA,QADyD;AAEzDW,wBAAAA,aAAa,EAAE,CACd;AADc,yBAF0C;AAKzDC,wBAAAA,QAAQ,EAAE,aAL+C,CAKhC;;AALgC,uBAAtB,CATA;;AAAA;AAAA;AAS9BC,sBAAAA,KAT8B,yBAS9BA,KAT8B;AASvBC,sBAAAA,aATuB,yBASvBA,aATuB;;AAiBrC,0BAAID,KAAJ,EAAW;AACT,4BAAGA,KAAK,CAACE,IAAN,IAAc,uCAAjB,EAAyD;AACrD;AACAlC,0BAAAA,EAAE,CAACmC,SAAH,GAAe,IAAf;AACAnC,0BAAAA,EAAE,CAACoC,sBAAH,GAA4B,kHAA5B,CAHqD,CAIrD;AACA;AACA;AACH,yBAPD,MAOO;AACL;AACA;AACApC,0BAAAA,EAAE,CAACmC,SAAH,GAAe,IAAf;AACAnC,0BAAAA,EAAE,CAACoC,sBAAH,GAA4BJ,KAAK,CAACnE,OAAlC,CAJK,CAKL;AACD;;AAEDgC,wBAAAA,MAAM,CAAC1H,MAAP,CAAc,YAAM;AACd6H,0BAAAA,EAAE,CAACC,YAAH,GAAkB,KAAlB;AACH,yBAFH;AAID,uBApBD,MAoBO,IAAGgC,aAAH,EAAiB;AACpB;AACI,4BAAIA,aAAa,CAACI,MAAd,KAAyB,WAA7B,EAA0C;AACtC;AACA;AACArC,0BAAAA,EAAE,CAACsC,SAAH,GAAe,IAAf,CAHsC,CAItC;;AACAtC,0BAAAA,EAAE,CAACV,SAAH,CAAa;AAAEiD,4BAAAA,WAAW,EAAE,UAAf;AAA2BN,4BAAAA,aAAa,EAAEA;AAA1C,2BAAb,EALsC,CAMtC;AACA;AACA;AAGH,yBAXD,MAWO;AACH;AACA3B,0BAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqB0B,aAArB,EAFG,CAGF;;AACAjC,0BAAAA,EAAE,CAACmC,SAAH,GAAe,IAAf;AACDnC,0BAAAA,EAAE,CAACoC,sBAAH,GAA4B,4CAA5B;AAEAvC,0BAAAA,MAAM,CAAC1H,MAAP,CAAc,YAAM;AAChB6H,4BAAAA,EAAE,CAACC,YAAH,GAAkB,IAAlB;AACH,2BAFD;AAGH;AACR;;AA7DoC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAAvC;;AAAA;AAAA;AAAA;AAAA;AA+DD;AAKJ,OAzGL,EAhB+I,CA4H/I;;AAEAD,MAAAA,EAAE,CAACwC,UAAH,GAAgBxC,EAAE,CAAClF,IAAnB;AACAkF,MAAAA,EAAE,CAACyC,UAAH,GAAgBzC,EAAE,CAAClF,IAAnB;AACAkF,MAAAA,EAAE,CAAC0C,mBAAH,GAAyB,IAAzB;AAEA1C,MAAAA,EAAE,CAAC2C,EAAH,GAAU;AAAEC,QAAAA,IAAI,EAAE,EAAR;AAAYC,QAAAA,KAAK,EAAE,EAAnB;AAAuBC,QAAAA,QAAQ,EAAE,EAAjC;AAAqCC,QAAAA,OAAO,EAAE;AAA9C,OAAV;AACA/C,MAAAA,EAAE,CAACgD,IAAH,GAAU;AAAEJ,QAAAA,IAAI,EAAE,EAAR;AAAYK,QAAAA,MAAM,EAAE,EAApB;AAAwBC,QAAAA,GAAG,EAAE,EAA7B;AAAiCC,QAAAA,GAAG,EAAE;AAAtC,OAAV;;AAEAnD,MAAAA,EAAE,CAACoD,OAAH,GAAa,YAAU;AACrB,YAAIpD,EAAE,CAACjB,OAAH,IAAciB,EAAE,CAACjB,OAAH,CAAWsE,MAA7B,EAAqC;AACnCrD,UAAAA,EAAE,CAACwC,UAAH,GAAgBxC,EAAE,CAACjB,OAAH,CAAW,CAAX,EAAcuE,EAA9B;AACAtD,UAAAA,EAAE,CAACyC,UAAH,GAAgBzC,EAAE,CAACjB,OAAH,CAAW,CAAX,EAAcuE,EAA9B;AACD;;AACD,YAAItD,EAAE,CAAChB,UAAH,IAAiBgB,EAAE,CAAChB,UAAH,CAAcqE,MAAnC,EAA2C;AACzCrD,UAAAA,EAAE,CAAC0C,mBAAH,GAAyB1C,EAAE,CAAChB,UAAH,CAAc,CAAd,EAAiBsE,EAA1C;AACD;AACF,OARD;;AAUAtD,MAAAA,EAAE,CAACuD,MAAH,GAAY,UAASD,EAAT,EAAY;AACtBtD,QAAAA,EAAE,CAACwC,UAAH,GAAiBxC,EAAE,CAACwC,UAAH,KAAkBc,EAAnB,GAAyB,IAAzB,GAAgCA,EAAhD;AACAtD,QAAAA,EAAE,CAACyC,UAAH,GAAgBa,EAAhB;AACD,OAHD;;AAIAtD,MAAAA,EAAE,CAACwD,UAAH,GAAgB,UAASF,EAAT,EAAY;AAAE,eAAOtD,EAAE,CAACwC,UAAH,KAAkBc,EAAzB;AAA8B,OAA5D;;AACAtD,MAAAA,EAAE,CAACyD,SAAH,GAAe,UAAS9J,CAAT,EAAY2J,EAAZ,EAAe;AAC5B,YAAII,CAAC,GAAG/J,CAAC,CAACgK,KAAF,IAAWhK,CAAC,CAACiK,OAArB;;AACA,YAAIF,CAAC,KAAK,EAAN,IAAYA,CAAC,KAAK,EAAtB,EAA0B;AAAE/J,UAAAA,CAAC,CAACiI,cAAF;AAAoB5B,UAAAA,EAAE,CAACuD,MAAH,CAAUD,EAAV;AAAgB;AACjE,OAHD;;AAIAtD,MAAAA,EAAE,CAAC6D,QAAH,GAAc,UAASC,IAAT,EAAc;AAC1B,aAAK,IAAIvH,CAAC,GAAC,CAAX,EAAcA,CAAC,GAACyD,EAAE,CAACjB,OAAH,CAAWsE,MAA3B,EAAmC9G,CAAC,EAApC,EAAuC;AACrC,cAAIyD,EAAE,CAACjB,OAAH,CAAWxC,CAAX,EAAcuH,IAAd,KAAuBA,IAA3B,EAAiC;AAC/B9D,YAAAA,EAAE,CAACyC,UAAH,GAAgBzC,EAAE,CAACjB,OAAH,CAAWxC,CAAX,EAAc+G,EAA9B;AACAtD,YAAAA,EAAE,CAACwC,UAAH,GAAgBxC,EAAE,CAACjB,OAAH,CAAWxC,CAAX,EAAc+G,EAA9B;AACA;AACD;AACF;AACF,OARD;;AASAtD,MAAAA,EAAE,CAAC+D,OAAH,GAAa,YAAU;AACrB,eAAO,CAAC,EAAE/D,EAAE,CAAC2C,EAAH,CAAMC,IAAN,IAAc5C,EAAE,CAAC2C,EAAH,CAAME,KAApB,IAA6B7C,EAAE,CAAC2C,EAAH,CAAMG,QAAnC,IAA+C9C,EAAE,CAAC2C,EAAH,CAAMI,OAAvD,CAAR;AACD,OAFD;;AAGA/C,MAAAA,EAAE,CAACgE,SAAH,GAAe,YAAU;AACvB,eAAO,CAAC,EAAEhE,EAAE,CAACgD,IAAH,CAAQJ,IAAR,IAAgB5C,EAAE,CAACgD,IAAH,CAAQC,MAAxB,IAAkCjD,EAAE,CAACgD,IAAH,CAAQE,GAA1C,IAAiDlD,EAAE,CAACgD,IAAH,CAAQG,GAA3D,CAAR;AACD,OAFD;;AAGAnD,MAAAA,EAAE,CAACiE,OAAH,GAAa,UAAS1B,WAAT,EAAyC;AAAA,YAAnBN,aAAmB,uEAAL,IAAK;AACpDjC,QAAAA,EAAE,CAACV,SAAH,CAAa;AAAEiD,UAAAA,WAAW,EAAEA,WAAf;AAA4BN,UAAAA,aAAa,EAAEA;AAA3C,SAAb;AACD,OAFD;;AAGAjC,MAAAA,EAAE,CAACkE,aAAH,GAAmB,YAAU;AAC3B,aAAK,IAAI3H,CAAC,GAAC,CAAX,EAAcA,CAAC,GAACyD,EAAE,CAACjB,OAAH,CAAWsE,MAA3B,EAAmC9G,CAAC,EAApC,EAAuC;AACrC,cAAIyD,EAAE,CAACjB,OAAH,CAAWxC,CAAX,EAAc+G,EAAd,KAAqBtD,EAAE,CAACyC,UAA5B,EAAwC;AAAE,mBAAOzC,EAAE,CAACjB,OAAH,CAAWxC,CAAX,EAAcc,KAArB;AAA6B;AACxE;;AACD,eAAO,IAAP;AACD,OALD;;AAOA2C,MAAAA,EAAE,CAACmE,eAAH,GAAqB,UAASb,EAAT,EAAY;AAAEtD,QAAAA,EAAE,CAAC0C,mBAAH,GAAyBY,EAAzB;AAA8B,OAAjE;;AAEAtD,MAAAA,EAAE,CAACoE,aAAH,GAAmB,UAASzK,CAAT,EAAY2J,EAAZ,EAAe;AAChC,YAAII,CAAC,GAAG/J,CAAC,CAACgK,KAAF,IAAWhK,CAAC,CAACiK,OAArB;;AACA,YAAIF,CAAC,KAAK,EAAN,IAAYA,CAAC,KAAK,EAAtB,EAA0B;AAAE/J,UAAAA,CAAC,CAACiI,cAAF;AAAoB5B,UAAAA,EAAE,CAACmE,eAAH,CAAmBb,EAAnB;AAAyB;AAC1E,OAHD;;AAIAtD,MAAAA,EAAE,CAACqE,aAAH,GAAmB,UAASC,KAAT,EAAe;AAChC,YAAIC,IAAI,GAAG,oKAAX;AACA,YAAIC,EAAE,GAAK,kMAAX;AACA,YAAIC,IAAI,GAAG,mKAAX;AACA,YAAIjK,CAAC,GAAG,CAAC8J,KAAK,IAAI,EAAV,EAAcxL,WAAd,EAAR;AACA,YAAImE,GAAG,GAAG,OAAOyH,IAAP,CAAYlK,CAAZ,IAAiB+J,IAAjB,GACA,cAAcG,IAAd,CAAmBlK,CAAnB,IAAwBgK,EAAxB,GACA,kBAAkBE,IAAlB,CAAuBlK,CAAvB,IAA4BiK,IAA5B,GACA,sKAHV;AAIA,eAAO9E,IAAI,CAACgF,WAAL,CAAiB1H,GAAjB,CAAP;AACD,OAVD;;AAYA+C,MAAAA,EAAE,CAAC4E,mBAAH,GAAyB,YAAU;AAE/B;AAEA;AACC9E,QAAAA,cAAc,CAAC+E,YAAf,CAA4B7E,EAAE,CAAC8E,UAA/B,EAA2C9E,EAAE,CAAC+E,OAA9C,EACA3E,IADA,CACK,UAASC,IAAT,EAAc;AAChB,cAAGA,IAAI,CAAC2E,OAAR,EAAgB;AACZ1E,YAAAA,OAAO,CAACC,GAAR,CAAY,8BAAZ,EAA4CF,IAA5C;AACAL,YAAAA,EAAE,CAACE,gBAAH,GAAsB,KAAtB;AACAF,YAAAA,EAAE,CAACiF,mBAAH,GAAyB,IAAzB;AAEH,WALD,MAKO;AACH3E,YAAAA,OAAO,CAACC,GAAR,CAAY,kCAAZ,EADG,CAEH;;AACAP,YAAAA,EAAE,CAACE,gBAAH,GAAsB,KAAtB;AACAF,YAAAA,EAAE,CAACiF,mBAAH,GAAyB,IAAzB;AACH;AACJ,SAbA,EAL8B,CAsB/B;AACA;AAEH,OAzBD;;AA2BAjF,MAAAA,EAAE,CAACkF,cAAH,GAAoB,YAAU;AAE1B;AACApF,QAAAA,cAAc,CAAC+E,YAAf,CAA4B7E,EAAE,CAAC8E,UAA/B,EAA2C9E,EAAE,CAAC+E,OAA9C,EACC3E,IADD,CACM,UAASC,IAAT,EAAc;AAChB,cAAGA,IAAI,CAAC2E,OAAR,EAAgB;AACZ1E,YAAAA,OAAO,CAACC,GAAR,CAAY,8BAAZ,EAA4CF,IAA5C;AACAL,YAAAA,EAAE,CAACE,gBAAH,GAAsB,KAAtB,CAFY,CAGZ;;AACAF,YAAAA,EAAE,CAACiF,mBAAH,GAAyB,IAAzB;AACAjF,YAAAA,EAAE,CAACmF,YAAH,GAAkB,IAAlB;AAEH,WAPD,MAOO;AACH7E,YAAAA,OAAO,CAACC,GAAR,CAAY,kCAAZ,EADG,CAEH;;AACAP,YAAAA,EAAE,CAACiF,mBAAH,GAAyB,IAAzB;AAEH;AACJ,SAfD;AAmBH,OAtBD;;AAwBAjF,MAAAA,EAAE,CAACoF,cAAH,GAAoB,YAAU;AAE1BtF,QAAAA,cAAc,CAAC+E,YAAf,CAA4B7E,EAAE,CAAC8E,UAA/B,EAA2C9E,EAAE,CAAC+E,OAA9C,EACC3E,IADD,CACM,UAASC,IAAT,EAAc;AACf;AACAC,UAAAA,OAAO,CAACC,GAAR,CAAY,8CAAZ;AACAP,UAAAA,EAAE,CAACE,gBAAH,GAAsB,KAAtB;AACAF,UAAAA,EAAE,CAACiF,mBAAH,GAAyB,KAAzB;AACAjF,UAAAA,EAAE,CAACmF,YAAH,GAAkB,IAAlB,CALe,CAMf;AAEA;AAEJ,SAXD;AAaH,OAfD;;AAkBAnF,MAAAA,EAAE,CAACqF,kBAAH,GAAwB,YAAU;AAE9B;AACA;AACAvF,QAAAA,cAAc,CAACwF,mBAAf,CAAmCtF,EAAE,CAAC8E,UAAtC,EAAkD9E,EAAE,CAAC+E,OAArD,EACC3E,IADD,CACM,UAASC,IAAT,EAAc;AAChBC,UAAAA,OAAO,CAACC,GAAR,CAAYF,IAAZ;;AACA,cAAGA,IAAI,CAAC2E,OAAR,EAAgB;AACZ;AACA;AACAhF,YAAAA,EAAE,CAACmF,YAAH,GAAkB,KAAlB;AACAI,YAAAA,kBAAkB,CAACvF,EAAE,CAAC8E,UAAJ,EAAgB,EAAhB,EAAoB,UAASzM,MAAT,EAAiBmN,OAAjB,EAA0B;AAC5D,kBAAInN,MAAJ,EAAY;AACR2H,gBAAAA,EAAE,CAACmF,YAAH,GAAkB,IAAlB,CADQ,CAER;;AACAnF,gBAAAA,EAAE,CAACsC,SAAH,GAAe,IAAf;AACAtC,gBAAAA,EAAE,CAACV,SAAH,CAAa;AAAEiD,kBAAAA,WAAW,EAAE,cAAf;AAA+BN,kBAAAA,aAAa,EAAEuD,OAAO,CAACvD;AAAtD,iBAAb;AAEH,eAND,MAMO;AACH;AACAjC,gBAAAA,EAAE,CAACmC,SAAH,GAAe,IAAf;AACAnC,gBAAAA,EAAE,CAACoC,sBAAH,GAA4B,8CAA5B;AACH;AACJ,aAZiB,CAAlB;AAaH,WAjBD,MAiBO;AACH,gBAAG/B,IAAI,CAAC2E,OAAL,IAAgB,KAAhB,IAAyB3E,IAAI,CAACxC,OAAL,IAAgB,iDAA5C,EAA8F;AAC1FmC,cAAAA,EAAE,CAACmF,YAAH,GAAkB,IAAlB;AACAnF,cAAAA,EAAE,CAACV,SAAH,CAAa;AAAEiD,gBAAAA,WAAW,EAAE,cAAf;AAA+BN,gBAAAA,aAAa,EAAE5B,IAAI,CAAC4B;AAAnD,eAAb;AACH;;AACD3B,YAAAA,OAAO,CAACC,GAAR,CAAYF,IAAI,CAACxC,OAAjB;AACH;AAEJ,SA5BD;AA+BAmC,QAAAA,EAAE,CAACE,gBAAH,GAAsB,IAAtB;AAEH,OArCD;;AAuCAF,MAAAA,EAAE,CAACyF,cAAH,GAAoB,EAApB;;AAEA,eAASF,kBAAT,CAA4BjC,EAA5B,EAAgCoC,WAAhC,EAA6CC,aAA7C,EAA4D;AACxD,YAAIC,QAAQ,GAAG,CAAf;;AAEI,iBAASC,OAAT,GAAmB;AACjB,cAAG7F,EAAE,CAACmF,YAAN,EAAmB;AACjB;AACD;;AACCW,UAAAA,aAAa,CAACxC,EAAD,EAAK,UAAS0B,OAAT,EAAkBQ,OAAlB,EAA2B;AACzCI,YAAAA,QAAQ;;AACR,gBAAIZ,OAAJ,EAAa;AACT;AACAW,cAAAA,aAAa,CAAC,IAAD,EAAOH,OAAP,CAAb;AACH,aAHD,MAGO,IAAII,QAAQ,IAAIF,WAAhB,EAA6B;AAChC;AACAC,cAAAA,aAAa,CAAC,KAAD,EAAQ,EAAR,CAAb;AACH,aAHM,MAGA,IAAI3F,EAAE,CAACmF,YAAP,EAAqB;AACxB;AACAQ,cAAAA,aAAa,CAAC,KAAD,EAAQ,EAAR,CAAb;AACA;AACH,aAJM,MAIA;AACH;AACA,kBAAGH,OAAO,IAAIA,OAAO,CAACO,QAAnB,IAA+BP,OAAO,CAACO,QAAR,KAAqB,EAAvD,EAA0D;AACxD,oBAAIC,SAAS,GAAG;AAAClB,kBAAAA,UAAU,EAAE9E,EAAE,CAAC8E,UAAhB;AAA4BmB,kBAAAA,SAAS,EAAET,OAAO,CAACO,QAAR,CAAiBG;AAAxD,iBAAhB,CADwD,CAExD;AACA;;AACA,oBAAIC,KAAK,GAAGnG,EAAE,CAACyF,cAAH,CAAkBW,IAAlB,CAAuB,UAAAxL,EAAE;AAAA,yBAAKA,EAAE,CAACqL,SAAH,KAAiBT,OAAO,CAACO,QAAR,CAAiBG,MAAlC,IAA4CtL,EAAE,CAACkK,UAAH,KAAkB9E,EAAE,CAAC8E,UAAtE;AAAA,iBAAzB,CAAZ,CAJwD,CAKxD;;AACA,oBAAGqB,KAAH,EAAS;AACP;AACA;AACAE,kBAAAA,UAAU,CAACR,OAAD,EAAU,KAAV,CAAV;AACD,iBAJD,MAIO;AACL7F,kBAAAA,EAAE,CAACyF,cAAH,CAAkBa,IAAlB,CAAuBN,SAAvB,EADK,CAEL;AACA;;AACAhG,kBAAAA,EAAE,CAACmC,SAAH,GAAe,IAAf;AACAnC,kBAAAA,EAAE,CAACoC,sBAAH,GAA4B,0CAAwCoD,OAAO,CAACO,QAAR,CAAiB7D,IAAzD,GAA8D,IAA9D,GAAmEsD,OAAO,CAACO,QAAR,CAAiBlI,OAAhH;AACAmC,kBAAAA,EAAE,CAACmF,YAAH,GAAkB,IAAlB;AACAQ,kBAAAA,aAAa,CAAC,KAAD,EAAQ,EAAR,CAAb;AACA;AACD;AAEF,eArBD,MAqBO;AACLrF,gBAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;AACA8F,gBAAAA,UAAU,CAACR,OAAD,EAAU,IAAV,CAAV;AACD;AAEJ;AACJ,WAzCY,CAAb;AA0CH;;AAEDA,QAAAA,OAAO,GAnD6C,CAmDzC;AAClB;;AAED,eAASU,yBAAT,CAAmCzB,UAAnC,EAA+C0B,KAA/C,EAAsDC,KAAtD,EAA6DC,SAA7D,EAAuE;AACnE,YAAGF,KAAK,IAAIC,KAAZ,EAAkB;AAEdX,UAAAA,aAAa,CAAChB,UAAD,EAAa,UAASzM,MAAT,EAAiBmN,OAAjB,EAA0B;AAClD;AACE,gBAAInN,MAAJ,EAAY;AACR;AACA;AACAqO,cAAAA,SAAS,CAAC,IAAD,CAAT,CAHQ,CAGQ;AACnB,aAJD,MAIO;AACH;AACC;AAEDL,cAAAA,UAAU,CAAC,YAAM;AACf;AACA;AACAG,gBAAAA,KAAK;AACLE,gBAAAA,SAAS,CAACH,yBAAyB,CAACzB,UAAD,EAAa0B,KAAb,EAAoBC,KAApB,EAA2BE,QAA3B,CAA1B,CAAT;AACD,eALS,EAKP,KALO,CAAV;AAMH;AACJ,WAjBY,CAAb;AAoBH,SAtBD,MAsBO;AACHrG,UAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ;AACAmG,UAAAA,SAAS,CAAC,KAAD,CAAT,CAFG,CAEc;AACpB;AACJ;;AAED,eAASZ,aAAT,CAAuBxC,EAAvB,EAA2BqD,QAA3B,EAAoC;AAEhC7G,QAAAA,cAAc,CAAC8G,YAAf,CAA4BtD,EAA5B,EACClD,IADD,CACM,UAASC,IAAT,EAAc;AAChB,cAAGA,IAAI,CAAC2E,OAAR,EAAgB;AACZ;AACA,gBAAG3E,IAAI,CAACgC,MAAR,EAAe;AACX;AACCsE,cAAAA,QAAQ,CAAC,IAAD,EAAOtG,IAAP,CAAR;AACJ,aAHD,MAGO;AACH;AACCsG,cAAAA,QAAQ,CAAC,KAAD,EAAQtG,IAAR,CAAR;AACJ;AAEJ,WAVD,MAUO;AACC;AACCsG,YAAAA,QAAQ,CAAC,KAAD,EAAQtG,IAAI,CAAC0F,QAAb,CAAR;AACR;AACJ,SAhBD,EAFgC,CAoBjC;AAEF,OA1Z8I,CA4Z/I;AACA;AACA;AAEA;AACA;AACA;;;AAEA/F,MAAAA,EAAE,CAAC6G,oBAAH,GAA0B,YAAU;AAChC7G,QAAAA,EAAE,CAACC,YAAH,GAAkB,IAAlB,CADgC,CAEhC;AACA;AACA;AACA;AACA;AAEA;;AAEAL,QAAAA,cAAc,CAACkH,8BAAf,CAA8C9G,EAAE,CAACf,IAAjD,EACImB,IADJ,CACS,UAAUC,IAAV,EAAgB;AACT;AACA,cAAGA,IAAI,CAAC2E,OAAR,EAAgB;AACdhF,YAAAA,EAAE,CAACmF,YAAH,GAAkB,KAAlB,CADc,CAEd;AACA;;AACAnF,YAAAA,EAAE,CAACC,YAAH,GAAkB,KAAlB;AACAD,YAAAA,EAAE,CAACE,gBAAH,GAAsB,IAAtB;AAEAF,YAAAA,EAAE,CAAC8E,UAAH,GAAgBzE,IAAI,CAAC0G,SAArB,CAPc,CASd;;AACAxB,YAAAA,kBAAkB,CAAClF,IAAI,CAAC0G,SAAN,EAAiB,EAAjB,EAAqB,UAAS1O,MAAT,EAAiBmN,OAAjB,EAA0B;AAC7D,kBAAInN,MAAJ,EAAY;AACR2H,gBAAAA,EAAE,CAACmF,YAAH,GAAkB,IAAlB,CADQ,CAER;;AACAnF,gBAAAA,EAAE,CAACsC,SAAH,GAAe,IAAf;AACAtC,gBAAAA,EAAE,CAACC,YAAH,GAAkB,KAAlB,CAJQ,CAKR;;AACAD,gBAAAA,EAAE,CAACV,SAAH,CAAa;AAAEiD,kBAAAA,WAAW,EAAE,cAAf;AAA+BN,kBAAAA,aAAa,EAAEuD,OAAO,CAACvD;AAAtD,iBAAb;AAEH,eARD,MAQO;AACH;AACAjC,gBAAAA,EAAE,CAACmC,SAAH,GAAe,IAAf;AACAnC,gBAAAA,EAAE,CAACoC,sBAAH,GAA4B,0CAA5B;AACApC,gBAAAA,EAAE,CAACC,YAAH,GAAkB,KAAlB;AACH;AACJ,aAfiB,CAAlB;AAoBD,WA9BD,MA8BO;AAEL+G,YAAAA,KAAK,CAAC,2FAAD,CAAL;AACAhH,YAAAA,EAAE,CAACC,YAAH,GAAkB,KAAlB;AACAD,YAAAA,EAAE,CAACE,gBAAH,GAAsB,IAAtB,CAJK,CAML;AAGD;AACZ,SA3CL;AA6CH,OAvDD;;AA0DAF,MAAAA,EAAE,CAACiH,mBAAH,GAAyB,YAAU;AAC/BjH,QAAAA,EAAE,CAACC,YAAH,GAAkB,IAAlB,CAD+B,CAE/B;AAEA;AACA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEAD,QAAAA,EAAE,CAACf,IAAH,CAAQiI,OAAR,GAAkBlH,EAAE,CAAC0C,mBAArB,CAlB+B,CAoB/B;AAEA;AACA;;AAEA9C,QAAAA,cAAc,CAACuH,wBAAf,CAAwCnH,EAAE,CAACf,IAA3C,EACamB,IADb,CACkB,UAAUC,IAAV,EAAgB;AAClB;AACA,cAAGA,IAAI,CAAC2E,OAAR,EAAgB;AAEd;AAEA;AACAhF,YAAAA,EAAE,CAACsC,SAAH,GAAe,IAAf;AAEAtC,YAAAA,EAAE,CAACV,SAAH,CAAa;AAAEiD,cAAAA,WAAW,EAAE,YAAf;AAA6BN,cAAAA,aAAa,EAAE5B,IAAI,CAAC+G;AAAjD,aAAb,EAPc,CASZ;AACH,WAVD,MAUO;AACJ9G,YAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA4BF,IAA5B,EADI,CAEH;;AAEA,gBAAIG,MAAM,GAAGC,MAAM,CAACV,SAAS,CAACW,YAAV,EAAD,CAAnB;AACAF,YAAAA,MAAM,CAAC6G,kBAAP,CACEhH,IAAI,CAACQ,aADP,EAEE;AACEyG,cAAAA,cAAc,EAAEjH,IAAI,CAACiH,cADvB;AAEEC,cAAAA,UAAU,EAAElH,IAAI,CAACmH,QAAL,CAAcD;AAF5B,aAFF,CAME;AACA;AAPF,cAQEnH,IARF,CAQO,UAAS/H,MAAT,EAAiB;AACtB;AACA;AACA;AAEA,kBAAGA,MAAM,CAAC2J,KAAV,EAAiB;AACf1B,gBAAAA,OAAO,CAACC,GAAR,CAAYlI,MAAM,CAAC2J,KAAnB;;AACA,oBAAG3J,MAAM,CAAC2J,KAAP,CAAaE,IAAb,IAAqB,uCAAxB,EAAgE;AAC5D;AACAlC,kBAAAA,EAAE,CAACmC,SAAH,GAAe,IAAf;AACAnC,kBAAAA,EAAE,CAACoC,sBAAH,GAA4B,kHAA5B;AACApC,kBAAAA,EAAE,CAACC,YAAH,GAAkB,KAAlB;AACH,iBALD,MAKO;AACL;AACAD,kBAAAA,EAAE,CAACmC,SAAH,GAAe,IAAf;AACAnC,kBAAAA,EAAE,CAACoC,sBAAH,GAA4B/J,MAAM,CAAC2J,KAAP,CAAanE,OAAzC;AACAmC,kBAAAA,EAAE,CAACC,YAAH,GAAkB,KAAlB;AACD;AACF,eAbD,MAaO,IAAG5H,MAAM,CAAC4J,aAAP,CAAqBI,MAArB,KAAgC,WAAnC,EAAgD;AACrD;AACA;AACAvC,gBAAAA,cAAc,CAAC8G,YAAf,CAA4BvG,IAAI,CAAC0G,SAAjC,EACK3G,IADL,CACU,UAASC,IAAT,EAAc;AAChB,sBAAGA,IAAI,CAAC2E,OAAR,EAAgB;AACZhF,oBAAAA,EAAE,CAACC,YAAH,GAAkB,KAAlB,CADY,CAEZ;;AACAD,oBAAAA,EAAE,CAACsC,SAAH,GAAe,IAAf,CAHY,CAIZ;AACA;;AACAtC,oBAAAA,EAAE,CAACV,SAAH,CAAa;AAAEiD,sBAAAA,WAAW,EAAE,YAAf;AAA6BN,sBAAAA,aAAa,EAAE5J,MAAM,CAAC4J;AAAnD,qBAAb;AACH,mBAPD,MAOO;AACH;AACAjC,oBAAAA,EAAE,CAACmC,SAAH,GAAe,IAAf;AACAnC,oBAAAA,EAAE,CAACoC,sBAAH,GAA4B/J,MAAM,CAAC2J,KAAP,CAAanE,OAAzC,CAHG,CAIH;;AACAmC,oBAAAA,EAAE,CAACC,YAAH,GAAkB,KAAlB;AACH;AACJ,iBAhBL;AAoBD,eAvBM,MAuBA;AACLK,gBAAAA,OAAO,CAACC,GAAR,CAAY,sCAAZ;AACAP,gBAAAA,EAAE,CAACC,YAAH,GAAkB,KAAlB;AACD;;AAEDD,cAAAA,EAAE,CAACC,YAAH,GAAkB,KAAlB;AACD,aAvDD;AA0DH;AAChB,SA7ED;AAgFH,OAzGD;AA6GD,KA3kBW;AAhBP,GAAP;AA6lBD,CA9lBD;AAimBF3I,GAAG,CAACmQ,OAAJ,CAAY,cAAZ,uCAA4B,UAASC,OAAT,EAAkBC,SAAlB,EAA6BjN,QAA7B,EAAuC;AAC7D,WAASkN,QAAT,CAAkBC,OAAlB,EAA2BC,QAA3B,EAAqC;AACnCA,IAAAA,QAAQ,GAAGA,QAAQ,IAAI,GAAvB;AACA,QAAIC,MAAM,GAAGL,OAAO,CAACM,WAArB;AAAA,QACIC,SAAS,GAAGJ,OAAO,GAAGE,MAD1B;AAAA,QAEIG,SAAS,GAAG,IAFhB;;AAIA,aAASC,aAAT,CAAuBC,CAAvB,EAA0B;AACxB,aAAOA,CAAC,GAAG,GAAJ,GAAU,IAAIA,CAAJ,GAAQA,CAAlB,GAAsB,CAAC,CAAD,GAAK,CAAC,IAAI,IAAIA,CAAT,IAAcA,CAAhD;AACD;;AAED,aAASC,IAAT,CAAcC,SAAd,EAAyB;AACvB,UAAI,CAACJ,SAAL,EAAgBA,SAAS,GAAGI,SAAZ;AAChB,UAAIC,QAAQ,GAAG,CAACD,SAAS,GAAGJ,SAAb,IAA0BJ,QAAzC;AACA,UAAIS,QAAQ,GAAG,CAAf,EAAkBA,QAAQ,GAAG,CAAX;AAClB,UAAIC,KAAK,GAAGL,aAAa,CAACI,QAAD,CAAzB;AACAb,MAAAA,OAAO,CAACE,QAAR,CAAiB,CAAjB,EAAoBG,MAAM,GAAGE,SAAS,GAAGO,KAAzC;;AACA,UAAID,QAAQ,GAAG,CAAf,EAAkB;AAChBb,QAAAA,OAAO,CAACe,qBAAR,CAA8BJ,IAA9B;AACD;AACF;;AAEDX,IAAAA,OAAO,CAACe,qBAAR,CAA8BJ,IAA9B;AACD;;AAED,SAAO;AACLK,IAAAA,SAAS,EAAE,mBAAS9N,EAAT,EAAakN,QAAb,EAAuB;AAChC,UAAI,CAAClN,EAAL,EAAS;AACT,UAAI+N,IAAI,GAAG/N,EAAE,CAACc,qBAAH,EAAX;AACA,UAAImM,OAAO,GAAGc,IAAI,CAACC,GAAL,GAAWlB,OAAO,CAACM,WAAjC;AACAJ,MAAAA,QAAQ,CAACC,OAAD,EAAUC,QAAV,CAAR;AACD,KANI;AAOLe,IAAAA,KAAK,EAAE,eAASf,QAAT,EAAmB;AACxBF,MAAAA,QAAQ,CAAC,CAAD,EAAIE,QAAJ,CAAR;AACD,KATI;AAULgB,IAAAA,QAAQ,EAAE,kBAAShB,QAAT,EAAmB;AAC3B,UAAID,OAAO,GAAGF,SAAS,CAAC,CAAD,CAAT,CAAahJ,IAAb,CAAkBxD,YAAlB,GAAiCuM,OAAO,CAACqB,WAAvD;AACAnB,MAAAA,QAAQ,CAACC,OAAD,EAAUC,QAAV,CAAR;AACD;AAbI,GAAP;AAeD,CAxCL;AA4CAxQ,GAAG,CAACC,SAAJ,CAAc,iBAAd,EAAiC,CAAC,WAAD,EAAc,SAAd,EAAyB,UAASoQ,SAAT,EAAoBD,OAApB,EAA4B;AACpF,SAAO;AACLxO,IAAAA,QAAQ,EAAE,GADL;AAELxB,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBoD,EAAhB,EAAmB;AAEvBpD,MAAAA,KAAK,CAACwR,QAAN,GAAiB,KAAjB;;AAEAxR,MAAAA,KAAK,CAACyR,QAAN,GAAiB,YAAU;AACzBzR,QAAAA,KAAK,CAACwR,QAAN,GAAiB,IAAjB;AACD,OAFD;;AAIAxR,MAAAA,KAAK,CAAC0R,SAAN,GAAkB,YAAU;AAC1B1R,QAAAA,KAAK,CAACwR,QAAN,GAAiB,KAAjB;AACD,OAFD;;AAIAxR,MAAAA,KAAK,CAAC2R,UAAN,GAAmB,YAAU;AAC3B3R,QAAAA,KAAK,CAACwR,QAAN,GAAiB,CAACxR,KAAK,CAACwR,QAAxB;AACD,OAFD,CAZuB,CAgBvB;;;AACA,UAAII,SAAS,GAAG,SAAZA,SAAY,CAASzP,CAAT,EAAW;AACzB,YAAIA,CAAC,CAAC0P,GAAF,KAAU,QAAV,IAAsB1P,CAAC,CAACiK,OAAF,KAAc,EAAxC,EAA2C;AACzCpM,UAAAA,KAAK,CAAC8R,WAAN,CAAkB,YAAU;AAC1B9R,YAAAA,KAAK,CAAC0R,SAAN;AACD,WAFD;AAGD;AACF,OAND;;AAOAvB,MAAAA,SAAS,CAACjO,EAAV,CAAa,SAAb,EAAwB0P,SAAxB,EAxBuB,CA0BvB;;AACA,UAAIG,QAAQ,GAAG,SAAXA,QAAW,GAAU;AACvB;AACA,YAAI7B,OAAO,CAAC8B,UAAR,GAAqB,GAArB,IAA4BhS,KAAK,CAACwR,QAAtC,EAA+C;AAC7CxR,UAAAA,KAAK,CAAC8R,WAAN,CAAkB,YAAU;AAC1B9R,YAAAA,KAAK,CAAC0R,SAAN;AACD,WAFD;AAGD;AACF,OAPD;;AAQAjL,MAAAA,OAAO,CAACtG,OAAR,CAAgB+P,OAAhB,EAAyBhO,EAAzB,CAA4B,QAA5B,EAAsC6P,QAAtC,EAnCuB,CAqCvB;;AACA/R,MAAAA,KAAK,CAACiS,eAAN,GAAwB,UAASC,MAAT,EAAgB;AACtC;AACA,YAAIA,MAAM,IAAIA,MAAM,CAAC9H,cAArB,EAAqC8H,MAAM,CAAC9H,cAAP;AACrCpK,QAAAA,KAAK,CAAC0R,SAAN;AACD,OAJD,CAtCuB,CA4CvB;;;AACA1R,MAAAA,KAAK,CAACqH,GAAN,CAAU,UAAV,EAAsB,YAAU;AAC9B8I,QAAAA,SAAS,CAACgC,GAAV,CAAc,SAAd,EAAyBP,SAAzB;AACAnL,QAAAA,OAAO,CAACtG,OAAR,CAAgB+P,OAAhB,EAAyBiC,GAAzB,CAA6B,QAA7B,EAAuCJ,QAAvC;AACD,OAHD;AAID;AAnDI,GAAP;AAqDD,CAtDgC,CAAjC;AAyDAtL,OAAO,CAAC2L,MAAR,CAAe,KAAf,EAAsBrS,SAAtB,CAAgC,eAAhC,oBAAiD,UAASsS,aAAT,EAAwB;AACvE,SAAO;AACL1Q,IAAAA,OAAO,EAAE,SADJ;AAELzB,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyByB,KAAzB,EAAgC0Q,OAAhC,EAAyC;AAE7CA,MAAAA,OAAO,CAACC,WAAR,CAAoBzD,IAApB,CAAyB,UAAS0D,KAAT,EAAgB;AAAE;AACzC,YAAG,CAACA,KAAJ,EAAW;AAAE,iBAAOA,KAAP;AAAe;;AAE5B,eAAOH,aAAa,CAACI,YAAd,CAA2BD,KAA3B,EAAkC,KAAlC,CAAP;AACD,OAJD;AAMAF,MAAAA,OAAO,CAACI,QAAR,CAAiB5D,IAAjB,CAAsB,UAAS0D,KAAT,EAAgB;AAAE;AACtC,YAAG,CAACA,KAAJ,EAAW;AAAE,iBAAOA,KAAP;AAAe;;AAE5B,eAAOH,aAAa,CAACM,UAAd,CAAyBH,KAAzB,EAAgC,KAAhC,CAAP;AACD,OAJD;AAMD;AAhBI,GAAP;AAkBD,CAnBD;AAoBA1S,GAAG,CAACmB,MAAJ,CAAW,OAAX,EAAoB,YAAW;AAC7B,SAAO,UAASC,KAAT,EAAgB0R,GAAhB,EAAqBC,GAArB,EAA0B;AAC/BD,IAAAA,GAAG,GAAG/P,QAAQ,CAAC+P,GAAD,CAAd,CAD+B,CACV;;AACrBC,IAAAA,GAAG,GAAGhQ,QAAQ,CAACgQ,GAAD,CAAd;;AACA,SAAK,IAAI9N,CAAC,GAAC6N,GAAX,EAAgB7N,CAAC,IAAE8N,GAAnB,EAAwB9N,CAAC,EAAzB;AACE7D,MAAAA,KAAK,CAAC4N,IAAN,CAAW/J,CAAX;AADF;;AAEA,WAAO7D,KAAP;AACD,GAND;AAOD,CARD;AAWApB,GAAG,CAACC,SAAJ,CACY,gBADZ,EAEY,YAAW;AACP;AACA,WAAS+S,OAAT,CAAkB3S,OAAlB,EAA2BC,UAA3B,EAAuC2S,UAAvC,EAAoD;AAChD,QAAG3S,UAAU,CAAC4S,SAAd,EAAwB;AAEpB,UAAIvH,MAAM,GAAGrL,UAAU,CAAC4S,SAAxB;AACA,UAAIC,KAAK,GAAG7S,UAAU,CAAC6S,KAAX,GAAiB,GAAjB,GAAqB7S,UAAU,CAAC8S,SAAhC,GAA0C,UAAtD;AACApK,MAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyBkK,KAAzB;AACA,UAAIE,GAAG,GAAG,EAAV;;AACA,WAAI,IAAIpO,CAAC,GAAC,CAAV,EAAYA,CAAC,IAAE3E,UAAU,CAAC4S,SAA1B,EAAoCjO,CAAC,EAArC,EAAwC;AACpCoO,QAAAA,GAAG,IAAI,oBAAkBpO,CAAlB,GAAoB,IAApB,GAAyBA,CAAzB,GAA2B,WAAlC;AACH;;AAED5E,MAAAA,OAAO,CAACiT,IAAR,CAAc,4CAA0CH,KAA1C,GAAgD,IAAhD,GAAqDE,GAArD,GAAyD,WAAvE;AACA,aAAQjT,IAAR;AACH;AAEJ,GAjBM,CAkBP;;;AACA,WAASA,IAAT,CAAemI,MAAf,EAAuBlI,OAAvB,EAAgCC,UAAhC,EAA6C;AACzC0I,IAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ,EAAoB3I,UAAU,CAAC4S,SAA/B;;AAEA,aAASK,UAAT,GAAqB;AACjB,UAAI5H,MAAM,GAAGrL,UAAU,CAAC4S,SAAxB;AACA,UAAIG,GAAG,GAAG,EAAV;;AACA,WAAI,IAAIpO,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC3E,UAAU,CAAC4S,SAAzB,EAAmCjO,CAAC,EAApC,EAAuC;AACnCoO,QAAAA,GAAG,IAAI,oBAAkBpO,CAAlB,GAAoB,IAApB,GAAyBA,CAAzB,GAA2B,WAAlC;AACH;;AAED+D,MAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ,EAAmBoK,GAAnB;AACH;;AAEDE,IAAAA,UAAU,GAb+B,CAgBzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,GA1FM,CA2FP;;;AACA,SAAO;AACHP,IAAAA,OAAO,EAAEA,OADN;AAEHpR,IAAAA,QAAQ,EAAE;AAFP,GAAP;AAIH,CAlGb,E,CAuGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AAEC5B,GAAG,CAACC,SAAJ,CACW,QADX,EAEW,YAAW;AACP;AACA,WAAS+S,OAAT,CAAkB3S,OAAlB,EAA2BC,UAA3B,EAAuC2S,UAAvC,EAAoD;AAChD5S,IAAAA,OAAO,CAACmT,OAAR,CAAiB,uBAAjB;AACA,WAAQpT,IAAR;AACH,GALM,CAMP;;;AACA,WAASA,IAAT,CAAemI,MAAf,EAAuBlI,OAAvB,EAAgCC,UAAhC,EAA6C;AACzC,QAAImT,KAAK,GAAGpT,OAAO,CAACqC,IAAR,CAAc,WAAd,CAAZ;AACA,QAAIgR,OAAO,GAAGrT,OAAO,CAACqC,IAAR,CAAc,WAAd,CAAd,CAFyC,CAGzC;AACA;AACA;;AACA6F,IAAAA,MAAM,CAAChE,MAAP,CACI,uBADJ,EAEI,UAAUoP,QAAV,EAAoBC,QAApB,EAA+B;AAC3B;AACA,UAAKD,QAAQ,KAAKC,QAAlB,EAA6B;AACzB;AACH,OAJ0B,CAK3B;AACA;AACA;AACA;;;AACA,UAAKC,QAAQ,EAAb,EAAkB;AACd;AACH;;AACDC,MAAAA,QAAQ,CAAEF,QAAF,CAAR;AACH,KAfL,EANyC,CAuBzC;AACA;;AACA,aAASE,QAAT,CAAmBC,UAAnB,EAAgC;AAC5BN,MAAAA,KAAK,CACAO,IADL,CACW,KADX,EACkBD,UADlB,EAEKE,QAFL,CAEe,MAFf,EAGKC,GAHL,CAGS,aAHT,EAGwB1R,CAAC,CAAC,aAAD,CAAD,CAAiB0R,GAAjB,CAAqB,aAArB,CAHxB,EAD4B,CAM5B;AACA;;AACAR,MAAAA,OAAO,CAACS,GAAR,CAAa,MAAb,EAAqBC,SAArB;AACH,KAlCwC,CAmCzC;AACA;;;AACA,aAASP,QAAT,GAAoB;AAChB,aACIJ,KAAK,CAACY,QAAN,CAAgB,MAAhB,KACAZ,KAAK,CAACY,QAAN,CAAgB,SAAhB,CAFJ;AAIH,KA1CwC,CA2CzC;;;AACA,aAASD,SAAT,GAAqB;AACjB;AACA;AACA;AACA;AACAX,MAAAA,KAAK,CAACa,KAAN;AACAb,MAAAA,KAAK,CAACQ,QAAN,CAAgB,SAAhB;AACAlF,MAAAA,UAAU,CAAEwF,YAAF,EAAgB,GAAhB,CAAV;AACH,KApDwC,CAqDzC;AACA;;;AACA,aAASA,YAAT,GAAwB;AACpBd,MAAAA,KAAK,CAACe,WAAN,CAAmB,cAAnB;AACH;AACJ,GAjEM,CAkEP;;;AACA,SAAO;AACHxB,IAAAA,OAAO,EAAEA,OADN;AAEHpR,IAAAA,QAAQ,EAAE;AAFP,GAAP;AAIH,CAzEZ,E,CA4ED;AACA;AACA;;AAEA5B,GAAG,CAACC,SAAJ,CAAc,aAAd,EAA6B,YAAW;AACpC,SAAO;AACH2B,IAAAA,QAAQ,EAAE,GADP;AAEH1B,IAAAA,KAAK,EAAE;AACHuU,MAAAA,SAAS,EAAE,GADR;AAEHC,MAAAA,cAAc,EAAE;AAFb,KAFJ;AAMHtU,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyB;AAC3B,UAAIsU,WAAW,GAAG,CAAlB;;AAEA,eAASC,YAAT,CAAsBC,UAAtB,EAAkC;AAC9B3U,QAAAA,KAAK,CAACW,MAAN,CAAa,YAAW;AACpBX,UAAAA,KAAK,CAACwU,cAAN,CAAqB;AAAEG,YAAAA,UAAU,EAAEA;AAAd,WAArB;AACH,SAFD;AAGH;;AAEDxU,MAAAA,OAAO,CAAC+B,EAAR,CAAW,WAAX,EAAwB,UAASC,CAAT,EAAY;AAChCA,QAAAA,CAAC,CAACiI,cAAF;AACAjI,QAAAA,CAAC,CAACyS,eAAF;AACAH,QAAAA,WAAW;;AACX,YAAIA,WAAW,KAAK,CAApB,EAAuB;AACnBC,UAAAA,YAAY,CAAC,IAAD,CAAZ;AACH;AACJ,OAPD;AASAvU,MAAAA,OAAO,CAAC+B,EAAR,CAAW,UAAX,EAAuB,UAASC,CAAT,EAAY;AAC/BA,QAAAA,CAAC,CAACiI,cAAF;AACAjI,QAAAA,CAAC,CAACyS,eAAF;AACH,OAHD;AAKAzU,MAAAA,OAAO,CAAC+B,EAAR,CAAW,WAAX,EAAwB,UAASC,CAAT,EAAY;AAChCA,QAAAA,CAAC,CAACiI,cAAF;AACAjI,QAAAA,CAAC,CAACyS,eAAF;AACAH,QAAAA,WAAW;;AACX,YAAIA,WAAW,KAAK,CAApB,EAAuB;AACnBC,UAAAA,YAAY,CAAC,KAAD,CAAZ;AACH;AACJ,OAPD;AASAvU,MAAAA,OAAO,CAAC+B,EAAR,CAAW,MAAX,EAAmB,UAASC,CAAT,EAAY;AAC3BA,QAAAA,CAAC,CAACiI,cAAF;AACAjI,QAAAA,CAAC,CAACyS,eAAF;AACAH,QAAAA,WAAW,GAAG,CAAd;AACAC,QAAAA,YAAY,CAAC,KAAD,CAAZ;AAEA,YAAIG,EAAE,GAAG1S,CAAC,CAAC2S,YAAF,IAAmB3S,CAAC,CAAC4S,aAAF,IAAmB5S,CAAC,CAAC4S,aAAF,CAAgBD,YAA/D;;AACA,YAAID,EAAE,IAAIA,EAAE,CAAC7T,KAAT,IAAkB6T,EAAE,CAAC7T,KAAH,CAAS6K,MAAT,GAAkB,CAAxC,EAA2C;AACvC7L,UAAAA,KAAK,CAACW,MAAN,CAAa,YAAW;AACpBX,YAAAA,KAAK,CAACuU,SAAN,CAAgB;AAAEvT,cAAAA,KAAK,EAAE6T,EAAE,CAAC7T;AAAZ,aAAhB;AACH,WAFD;AAGH;AACJ,OAZD;AAcAhB,MAAAA,KAAK,CAACqH,GAAN,CAAU,UAAV,EAAsB,YAAW;AAC7BlH,QAAAA,OAAO,CAACgS,GAAR,CAAY,mCAAZ;AACH,OAFD;AAGH;AAvDE,GAAP;AAyDH,CA1DD,E,CA6DA;AACA;AACA;;AAEArS,GAAG,CAACC,SAAJ,CAAc,eAAd,EAA+B,YAAW;AACtC,SAAO;AACH2B,IAAAA,QAAQ,EAAE,GADP;AAEH1B,IAAAA,KAAK,EAAE;AACHgV,MAAAA,aAAa,EAAE;AADZ,KAFJ;AAKH9U,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyB;AAC3BA,MAAAA,OAAO,CAAC+B,EAAR,CAAW,QAAX,EAAqB,YAAW;AAC5B,YAAIlB,KAAK,GAAGb,OAAO,CAAC,CAAD,CAAP,CAAWa,KAAvB;;AACA,YAAIA,KAAK,IAAIA,KAAK,CAAC6K,MAAN,GAAe,CAA5B,EAA+B;AAC3B7L,UAAAA,KAAK,CAACW,MAAN,CAAa,YAAW;AACpBX,YAAAA,KAAK,CAACgV,aAAN,CAAoB;AAAEhU,cAAAA,KAAK,EAAEA;AAAT,aAApB;AACH,WAFD;AAGH,SAN2B,CAO5B;;;AACAb,QAAAA,OAAO,CAAC,CAAD,CAAP,CAAWqS,KAAX,GAAmB,EAAnB;AACH,OATD;AAWAxS,MAAAA,KAAK,CAACqH,GAAN,CAAU,UAAV,EAAsB,YAAW;AAC7BlH,QAAAA,OAAO,CAACgS,GAAR,CAAY,QAAZ;AACH,OAFD;AAGH;AApBE,GAAP;AAsBH,CAvBD;AAyBArS,GAAG,CAACC,SAAJ,CAAc,cAAd,EAA8B,YAAW;AACrC,SAAO;AACH2B,IAAAA,QAAQ,EAAE,GADP;AAEH1B,IAAAA,KAAK,EAAE;AACHmJ,MAAAA,OAAO,EAAE,GADN,CACU;;AADV,KAFJ;AAKHjJ,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyB;AAC3B,UAAI8U,UAAU,GAAG9U,OAAO,CAAC,CAAD,CAAxB;AACA,UAAI+U,QAAJ;;AAEA,eAASC,cAAT,GAA0B;AACtB,YAAID,QAAJ,EAAc;AACVA,UAAAA,QAAQ,CAACE,OAAT,GADU,CACU;AACvB;;AACDF,QAAAA,QAAQ,GAAG,IAAIG,YAAY,CAACC,QAAjB,CAA0BL,UAA1B,EAAsCjV,KAAK,CAACmJ,OAA5C,CAAX;AACA+L,QAAAA,QAAQ,CAACK,MAAT;AACH,OAV0B,CAY3B;;;AACAvV,MAAAA,KAAK,CAACqE,MAAN,CAAa,SAAb,EAAwB,UAASmR,UAAT,EAAqBC,UAArB,EAAiC;AACrD,YAAID,UAAJ,EAAgB;AACZL,UAAAA,cAAc;AACjB;AACJ,OAJD,EAIG,IAJH;AAKH;AAvBE,GAAP;AAyBH,CA1BD;AA4BArV,GAAG,CAACC,SAAJ,CAAc,YAAd,EAA4B,CAAC,IAAD,EAAO,UAAP,EAAmB,gBAAnB,EAAqC,UAAS2V,EAAT,EAAaxS,QAAb,EAAuByS,cAAvB,EAAuC;AACtG,SAAO;AACLhU,IAAAA,OAAO,EAAE,SADJ;AAELzB,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgB4V,GAAhB,EAAqBhU,KAArB,EAA4BiU,IAA5B,EAAkC;AAEtCA,MAAAA,IAAI,CAACC,gBAAL,CAAsBC,UAAtB,GAAmC,UAASC,UAAT,EAAqBC,SAArB,EAAgC;AAEjE,YAAIJ,IAAI,CAACK,QAAL,CAAcF,UAAd,CAAJ,EAA+B;AAC7B;AACA,iBAAON,EAAE,CAACS,IAAH,EAAP;AACD;;AAED,YAAIC,GAAG,GAAGV,EAAE,CAACW,KAAH,EAAV;AAGAV,QAAAA,cAAc,CAACW,SAAf,CAAyBN,UAAzB,EACGpN,IADH,CACQ,UAASC,IAAT,EAAc;AAClB;AACA;AACA,cAAGA,IAAI,CAACmK,SAAL,IAAkB,IAArB,EAA0B;AACxBoD,YAAAA,GAAG,CAACG,OAAJ;AACD,WAFD,MAEO;AACLH,YAAAA,GAAG,CAACI,MAAJ;AACD;AACF,SATH;AAYA,eAAOJ,GAAG,CAACK,OAAX;AACD,OAvBD;AAwBD;AA5BI,GAAP;AA8BD,CA/B2B,CAA5B;AAiCA3W,GAAG,CAACC,SAAJ,CAAc,eAAd,EAA+B,CAAC,IAAD,EAAO,UAAP,EAAmB,gBAAnB,EAAqC,kBAArC,EAAyD,UAAS2V,EAAT,EAAaxS,QAAb,EAAuByS,cAAvB,EAAuCe,gBAAvC,EAAyD;AAC/I,SAAO;AACL/U,IAAAA,OAAO,EAAE,SADJ;AAELzB,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgB4V,GAAhB,EAAqBhU,KAArB,EAA4BiU,IAA5B,EAAkC;AAEtCA,MAAAA,IAAI,CAACC,gBAAL,CAAsBa,aAAtB,GAAsC,UAASX,UAAT,EAAqBC,SAArB,EAAgC;AAEpE,YAAIJ,IAAI,CAACK,QAAL,CAAcF,UAAd,CAAJ,EAA+B;AAC7B;AACA,iBAAON,EAAE,CAACS,IAAH,EAAP;AACD;;AAED,YAAIC,GAAG,GAAGV,EAAE,CAACW,KAAH,EAAV;AAEA,YAAIO,SAAS,GAAGF,gBAAgB,CAAC7N,IAAjB,CAAsBgO,aAAtC;AACA,YAAIC,OAAO,GAAG,CAAd;;AACA,aAAI,IAAI/R,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAG6R,SAAS,CAAC/K,MAA3B,EAAmC9G,CAAC,EAApC,EAAuC;AACrC,cAAG6R,SAAS,CAAC7R,CAAD,CAAT,CAAagS,YAAb,IAA6Bf,UAAhC,EAA2C;AACzCc,YAAAA,OAAO;AACR;AACF;;AAED,YAAGA,OAAO,GAAG,CAAb,EAAe;AACbV,UAAAA,GAAG,CAACI,MAAJ;AACD,SAFD,MAEO;AACLJ,UAAAA,GAAG,CAACG,OAAJ;AACD,SArBmE,CAuBpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA,eAAOH,GAAG,CAACK,OAAX;AACD,OApCD;AAqCD;AAzCI,GAAP;AA2CD,CA5C8B,CAA/B,E,CA6CA;;AAEA3W,GAAG,CAACC,SAAJ,CAAc,YAAd,EAA4B,YAAU;AACpC,SAAO;AACL2B,IAAAA,QAAQ,EAAE,GADL;AAELxB,IAAAA,IAAI,EAAE,cAAUF,KAAV,EAAiBG,OAAjB,EAA0B6W,IAA1B,EAAgC;AAElC,UAAIC,GAAG,GAAGjX,KAAK,CAACkX,KAAN,CAAYF,IAAI,CAACG,WAAjB,CAAV,CAFkC,CAI9B;;AACAF,MAAAA,GAAG,CAACzV,MAAJ,GAAa,UAAb;AACAyV,MAAAA,GAAG,CAACG,SAAJ,GAAgB,MAAhB;AACAH,MAAAA,GAAG,CAACI,cAAJ,GAAqB,MAArB;AACAJ,MAAAA,GAAG,CAACK,WAAJ,GAAkB,IAAIC,IAAJ,GAAW/V,MAAX,CAAkB,UAAlB,CAAlB;AACAyV,MAAAA,GAAG,CAACO,OAAJ,GAAc,IAAID,IAAJ,GAAW/V,MAAX,CAAkB,UAAlB,CAAd,CAT8B,CAW9B;;AAGArB,MAAAA,OAAO,CAACsX,UAAR,CAAmBR,GAAnB;AAEP;AAlBI,GAAP;AAoBD,CArBD;AAwBAnX,GAAG,CAACC,SAAJ,CAAc,YAAd,EAA4B,CAAC,UAAD,EAAa,UAAUmD,QAAV,EAAoB;AACzD,SAAO;AACHxB,IAAAA,QAAQ,EAAE,IADP;AAEH1B,IAAAA,KAAK,EAAE;AACHsS,MAAAA,OAAO,EAAE;AADN,KAFJ;AAKHpS,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyB6W,IAAzB,EAA+B;AAEjC,UAAIC,GAAG,GAAGjX,KAAK,CAACkX,KAAN,CAAYF,IAAI,CAACU,WAAjB,CAAV;AACA5O,MAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuBkO,GAAvB;AAEA9W,MAAAA,OAAO,CAAC+B,EAAR,CAAW,QAAX,EAAqB,YAAY;AAC7B,YAAI/B,OAAO,CAACgU,QAAR,CAAiB,OAAjB,CAAJ,EAA+B;AAC3BjR,UAAAA,QAAQ,CAAC,YAAY;AACjB,gBAAIyU,GAAG,GAAGxX,OAAO,CAACyX,OAAR,CAAgB,aAAhB,EAA+BpV,IAA/B,CAAoC,WAApC,CAAV;AAAA,gBACIqV,QAAQ,GAAGpR,OAAO,CAACtG,OAAR,CAAgBwX,GAAhB,EAAqBG,YAArB,EADf;AAGAD,YAAAA,QAAQ,CAAClX,MAAT,CAAgB,YAAY;AACxBkX,cAAAA,QAAQ,CAACvF,OAAT,GAAmBqF,GAAG,CAACI,GAAJ,EAAnB;AACH,aAFD;AAGH,WAPO,EAOL,CAPK,CAAR;AAQH;AACJ,OAXD,EALiC,CAiBjC;AACA;AACA;AACA;;AACA5X,MAAAA,OAAO,CAAC6X,UAAR,CAAmBf,GAAnB;AACH;AA3BE,GAAP;AA6BH,CA9B2B,CAA5B;AAkCAnX,GAAG,CAACC,SAAJ,CAAc,UAAd,EAA0B,YAAU;AAChC,SAAO;AACH2B,IAAAA,QAAQ,EAAE,IADP;AAEH1B,IAAAA,KAAK,EAAE;AACHmX,MAAAA,WAAW,EAAE;AADV,KAFJ;AAKHjX,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyB6W,IAAzB,EAA8B;AAEhC,UAAIC,GAAG,GAAGjX,KAAK,CAACkX,KAAN,CAAYF,IAAI,CAACG,WAAjB,CAAV;AACArO,MAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuBkO,GAAvB,EAHgC,CAKhC;;AACA9W,MAAAA,OAAO,CAAC8X,QAAR,CAAiB;AACbC,QAAAA,aAAa,EAAE,KADF;AAEbC,QAAAA,YAAY,EAAE;AAFD,OAAjB,EANgC,CAUhC;AAEH;AAjBE,GAAP;AAmBH,CApBD;AAuBA;;AAEA1R,OAAO,CAAC2L,MAAR,CAAe,6BAAf,EAA8C,CAAC,sBAAD,CAA9C,EACKnR,MADL,CACY,QADZ,EACsB,CAAC,YAAY;AAC3B;AACR;AACA;AACA;AACA;AACQ,SAAO,UAAUC,KAAV,EAAiBoL,IAAjB,EAAuB;AAC1B,QACI8L,KAAK,GAAGvV,QAAQ,CAAE3B,KAAK,GAAG,EAAV,EAAc,EAAd,CADpB;AAAA,QAEImX,OAAO,GAAInX,KAAK,GAAIkX,KAAK,GAAG,EAAlB,GAAyB,EAAzB,GAA8B,OAAOlX,KAAK,GAAIkX,KAAK,GAAG,EAAxB,CAA9B,GAA6DlX,KAAK,GAAIkX,KAAK,GAAG,EAF5F;AAAA,QAGI;AACAE,IAAAA,QAAQ,GAAKF,KAAK,IAAI,EAAT,IAAeA,KAAK,KAAK,EAAzB,GAA8B,KAA9B,GAAsC,KAJvD;AAMA,WAAO,CAAC,CAAC9L,IAAD,IAAS8L,KAAK,GAAG,EAAjB,GAAuBA,KAAK,KAAK,EAAV,GAAe,IAAf,GAAsB,CAACA,KAAK,GAAG,EAAR,GAAa,EAAb,GAAkB,GAAlB,GAAuB,EAAxB,KAAgCA,KAAK,GAAG,EAAxC,CAA7C,GAA6F,CAACA,KAAK,GAAG,EAAR,GAAa,GAAb,GAAmB,EAApB,IAA0BA,KAAxH,IAAiI,GAAjI,GAAuIC,OAAvI,GAAiJC,QAAxJ;AACH,GARD;AASH,CAfiB,CADtB,EAiBKvY,SAjBL,CAiBe,eAjBf,EAiBgC,CAAE,UAAF,EAAc,UAAd,EAA0B,SAA1B,EAAqC,UAAUwY,QAAV,EAAoBrV,QAApB,EAA8BsV,OAA9B,EAAuC;AAExG,SAAO;AACH9W,IAAAA,QAAQ,EAAE,GADP;AAEH1B,IAAAA,KAAK,EAAE;AACH6I,MAAAA,IAAI,EAAE,gBADH;AAEH4P,MAAAA,MAAM,EAAE,GAFL;AAGHC,MAAAA,YAAY,EAAE,GAHX;AAIHC,MAAAA,YAAY,EAAE,GAJX;AAIgB;AACnBC,MAAAA,QAAQ,EAAG;AALR,KAFJ;AAUH;AACAC,IAAAA,QAAQ,EAAE;AAAS;AAAoB;AACnC;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIY,aAAO,qFACK,uIADL,GAES,uEAFT,GAGa,4CAHb,GAIiB,+FAJjB,GAKiB,iOALjB,GAMa,QANb,GAOa,kDAPb,GAQiB,6FARjB,GASiB,0PATjB,GAUa,QAVb,GAWS,QAXT,GAYS,sGAZT,GAaa,6CAbb,GAciB,mBAdjB,GAeqB,oFAfrB,GAgBqB,qIAhBrB,GAiBqB,mIAjBrB,GAkBiB,QAlBjB,GAmBa,QAnBb,GAoBS,QApBT,GAqBK,QArBL,GAsBC,QAtBR;AAuBH,KAlFE;AAoFH3Y,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgBG,OAAhB,EAAyByB,KAAzB,EAAgC;AAClC;AACA,UACIkX,cAAc,GAAQ,GAD1B;AAAA,UAC8B;AAC1BC,MAAAA,eAAe,GAAOtS,OAAO,CAACtG,OAAR,CAAgB,+BAAhB,EAAiDA,OAAO,CAAC,CAAD,CAAxD,CAF1B;AAAA,UAGI6Y,MAAM,GAAgBvS,OAAO,CAACtG,OAAR,CAAiB,4RAAjB,CAH1B;AAAA,UAII8Y,mBAAmB,GAAG,KAJ1B;AAAA,UAKIC,aAAa,GAAG;AACZ7W,QAAAA,IAAI,EAAE;AACF8W,UAAAA,IAAI,EAAE,YADJ;AAEFC,UAAAA,EAAE,EAAE;AAFF;AADM,OALpB;AAAA,UAWIC,YAAY,GAAG;AACXF,QAAAA,IAAI,EAAE,GADK;AACA;AACXC,QAAAA,EAAE,EAAE,IAFO;AAED;AACVE,QAAAA,KAAK,EAAE,CAHI;AAGD;AACVC,QAAAA,GAAG,EAAE,IAJM;AAIA;AACX1I,QAAAA,IAAI,EAAE,EALK;AAKD;AACV2I,QAAAA,QAAQ,EAAE,EANC;AAMG;AACdC,QAAAA,OAAO,EAAE,IAPE,CAOG;;AAPH,OAXnB;AAAA,UAoBIC,YAAY,GAAG;AACXP,QAAAA,IAAI,EAAE,IAAI5B,IAAJ,EADK;AAEX6B,QAAAA,EAAE,EAAE,IAAI7B,IAAJ,EAFO;AAGX3E,QAAAA,GAAG,EAAE,IAHM;AAIXC,QAAAA,GAAG,EAAE;AAJM,OApBnB;AAAA,UA0BI8G,iBA1BJ;AA4BA3Z,MAAAA,KAAK,CAAC6I,IAAN,CAAW+Q,cAAX,GAA4BnT,OAAO,CAACoT,QAAR,CAAiB7Z,KAAK,CAAC6I,IAAN,CAAWxG,IAA5B,CAA5B;AACArC,MAAAA,KAAK,CAAC6I,IAAN,CAAWiR,cAAX,GAA4BrT,OAAO,CAACoT,QAAR,CAAiB7Z,KAAK,CAAC6I,IAAN,CAAWkR,IAA5B,CAA5B;AACA/Z,MAAAA,KAAK,CAACga,gBAAN,GAAyBvT,OAAO,CAACwT,MAAR,CAAef,aAAa,CAAC7W,IAA7B,EAAmCrC,KAAK,CAACyY,MAAN,IAAgBzY,KAAK,CAACyY,MAAN,CAAapW,IAAhE,CAAzB,CAhCkC,CAgC+D;;AAEjG,UAAIrC,KAAK,CAAC6I,IAAN,CAAW+Q,cAAf,EAA+B;AAC3B5Z,QAAAA,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,GAAkBoE,OAAO,CAACwT,MAAR,CAAeP,YAAf,EAA6B1Z,KAAK,CAAC6I,IAAN,CAAWxG,IAAxC,CAAlB;AACH;;AACD,UAAIrC,KAAK,CAAC6I,IAAN,CAAWiR,cAAf,EAA+B;AAC3B9Z,QAAAA,KAAK,CAAC6I,IAAN,CAAWkR,IAAX,GAAkBtT,OAAO,CAACwT,MAAR,CAAeZ,YAAf,EAA6BrZ,KAAK,CAAC6I,IAAN,CAAWkR,IAAxC,CAAlB;AACH;;AAED,eAASG,YAAT,GAAyB;AACrB,YAAG,CAACjB,mBAAD,IAAwBjZ,KAAK,CAAC6I,IAAN,CAAWiR,cAAtC,EAAsD;AAClDf,UAAAA,eAAe,CAACoB,MAAhB,CAAwBnB,MAAxB;AACAT,UAAAA,QAAQ,CAAES,MAAF,CAAR,CAAoBhZ,KAApB;AACAiZ,UAAAA,mBAAmB,GAAG,IAAtB;AAEA;AACpB;AACA;;AACoB,cAAK9Y,OAAO,CAACiU,KAAR,MAAmB0E,cAAxB,EAAyC;AACrCrS,YAAAA,OAAO,CAACtG,OAAR,CAAiB,kBAAjB,EAAqCA,OAAO,CAAC,CAAD,CAA5C,EAAiD4T,QAAjD,CAA0D,4BAA1D;AACH;AACJ;AACJ;;AAED,UAAKnS,KAAK,CAACwY,QAAX,EAAsB;AAClBpa,QAAAA,KAAK,CAACqE,MAAN,CAAc,YAAW;AACrB,iBAAOlE,OAAO,CAAC,CAAD,CAAP,CAAWyE,SAAlB;AACH,SAFD,EAEG,YAAW;AACV,cAAGzE,OAAO,CAACgU,QAAR,CAAiB,IAAjB,CAAH,EAA2B;AACvB;AACA+F,YAAAA,YAAY;AACf;AACJ,SAPD;AAQH,OATD,MASO;AACHA,QAAAA,YAAY;AACf;AAED;AACZ;AACA;;;AACY,eAASG,WAAT,CAAsB5G,QAAtB,EAAgCC,QAAhC,EAA0C;AACtC,YAAK,CAACjN,OAAO,CAAC6T,WAAR,CAAoBX,iBAApB,CAAN,EAA+C;AACnB7Q,UAAAA,OAAO,CAACC,GAAR,CAAY,0CAAwC/I,KAAK,CAAC6I,IAAN,CAAWkR,IAAX,CAAgBZ,IAApE;AAExBjW,UAAAA,QAAQ,CAAC6D,MAAT,CAAgB4S,iBAAhB;AAEH;;AACD,YAAKlG,QAAQ,KAAKC,QAAlB,EAA6B;AACzBiG,UAAAA,iBAAiB,GAAGzW,QAAQ,CAAE,YAAU;AAEpC4F,YAAAA,OAAO,CAACC,GAAR,CAAY,0CAAwC/I,KAAK,CAAC6I,IAAN,CAAWkR,IAAX,CAAgBZ,IAApE;AAEAnZ,YAAAA,KAAK,CAAC0Y,YAAN,GAAqB;AACjBS,cAAAA,IAAI,EAAEX,OAAO,CAAC,QAAD,CAAP,CAAkBxY,KAAK,CAAC6I,IAAN,CAAWkR,IAAX,CAAgBZ,IAAlC,EAAwC,IAAxC,CADW;AAEjBC,cAAAA,EAAE,EAAEZ,OAAO,CAAC,QAAD,CAAP,CAAkBxY,KAAK,CAAC6I,IAAN,CAAWkR,IAAX,CAAgBX,EAAlC,EAAsC,IAAtC,CAFa;AAGjBmB,cAAAA,KAAK,EAAE/B,OAAO,CAAC,QAAD,CAAP,CAAmBxY,KAAK,CAAC6I,IAAN,CAAWkR,IAAX,CAAgBX,EAAhB,GAAqBpZ,KAAK,CAAC6I,IAAN,CAAWkR,IAAX,CAAgBZ,IAAxD,EAA+D,IAA/D;AAHU,aAArB;AAMH,WAV2B,EAUzB,GAVyB,CAA5B;AAWH;AACJ;;AACD,UAAK,CAAC1S,OAAO,CAAC6T,WAAR,CAAoBta,KAAK,CAAC0Y,YAAN,EAApB,CAAD,IAA8C1Y,KAAK,CAAC6I,IAAN,CAAWiR,cAA9D,EAA+E;AAC3E9Z,QAAAA,KAAK,CAACqE,MAAN,CAAa,gBAAb,EAA+BgW,WAA/B;AACAra,QAAAA,KAAK,CAACqE,MAAN,CAAa,cAAb,EAA6BgW,WAA7B;AACH;AACD;AACZ;AACA;;;AACY,UACIG,QAAQ,GAAG,CAAExa,KAAK,CAAC2Y,YAAN,IAAsB3Y,KAAK,CAAC2Y,YAAN,GAAqB,CAA5C,IAAkD,CAAnD,IAAwD,QADvE;AAAA,UACiF;AAC7E8B,MAAAA,YAAY,GAAGza,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,IAAmBrC,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,CAAgBwQ,GAAnC,IAA0C7S,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,CAAgBwQ,GAAhB,CAAoB6H,OAApB,EAF7D;AAAA,UAE4F;AACxFC,MAAAA,YAAY,GAAG3a,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,IAAmBrC,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,CAAgBuQ,GAAnC,IAA0C5S,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,CAAgBuQ,GAAhB,CAAoB8H,OAApB,EAH7D,CApGkC,CAuG0D;;AAE5F,eAASE,mBAAT,GAA+B;AAC3B,YACIC,YAAY,GAAG7a,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,CAAgB+W,EAAhB,CAAmBsB,OAAnB,KAA+B1a,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,CAAgB8W,IAAhB,CAAqBuB,OAArB,EADlD;AAAA,YAEII,MAAM,GAAGN,QAAQ,GAAGK,YAFxB;AAAA,YAGIE,IAAI,GAAI/a,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,CAAgB8W,IAAhB,CAAqBuB,OAArB,KAAiCI,MAAlC,GAA4CH,YAA5C,GAA2DA,YAA3D,GAA0E3a,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,CAAgB8W,IAAhB,CAAqBuB,OAArB,KAAiCI,MAHtH;AAAA,YAG8H;AAC1HE,QAAAA,IAAI,GAAIhb,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,CAAgB+W,EAAhB,CAAmBsB,OAAnB,KAA+BI,MAAhC,GAA0CL,YAA1C,GAAyDA,YAAzD,GAAyEza,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,CAAgB+W,EAAhB,CAAmBsB,OAAnB,KAA+BI,MAJnH,CAD2B,CAKiG;AAG5H;;;AACA9a,QAAAA,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,CAAgBuQ,GAAhB,GAAsB,IAAI2E,IAAJ,CAASwD,IAAT,CAAtB,CAT2B,CAU3B;;AACA/a,QAAAA,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,CAAgBwQ,GAAhB,GAAsB,IAAI0E,IAAJ,CAASyD,IAAT,CAAtB;AACH;;AAED,eAASC,aAAT,GAAwB;AACpB;AACA,YAAGjb,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,CAAgB8W,IAAhB,GAAuBnZ,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,CAAgB+W,EAA1C,EAA6C;AACzC;AACA,cAAI8B,CAAC,GAAGlb,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,CAAgB8W,IAAhB,CAAqBgC,WAArB,EAAR;AACA,cAAIC,CAAC,GAAGpb,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,CAAgB8W,IAAhB,CAAqBkC,QAArB,EAAR;AACA,cAAIC,CAAC,GAAGtb,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,CAAgB8W,IAAhB,CAAqBoC,OAArB,EAAR;AACA,cAAIC,CAAC,GAAGtW,IAAI,CAACuW,KAAL,CAAYzb,KAAK,CAAC6I,IAAN,CAAWkR,IAAX,CAAgBX,EAAhB,GAAqB,EAAjC,CAAR;AACA,cAAIrU,CAAC,GAAG/E,KAAK,CAAC6I,IAAN,CAAWkR,IAAX,CAAgBX,EAAhB,GAAqB,EAA7B,CANyC,CAOzC;AACA;AAEA;AACA;;AAEApZ,UAAAA,KAAK,CAAC6I,IAAN,CAAWxG,IAAX,CAAgB+W,EAAhB,GAAqB,IAAI7B,IAAJ,CAAS2D,CAAT,EAAYE,CAAZ,EAAeE,CAAf,EAAkBE,CAAlB,EAAqBzW,CAArB,EAAwB,CAAxB,CAArB;AACH;AACJ,OAxIiC,CA0IlC;AACI;;;AACA/E,MAAAA,KAAK,CAACqE,MAAN,CAAa,gBAAb,EAA+B4W,aAA/B,EA5I8B,CA6IlC;;AAEA,UAAKjb,KAAK,CAAC2Y,YAAN,IAAsB3Y,KAAK,CAAC6I,IAAN,CAAW+Q,cAAtC,EAAuD;AACnD5Z,QAAAA,KAAK,CAACqE,MAAN,CAAa,gBAAb,EAA+BuW,mBAA/B;AACA5a,QAAAA,KAAK,CAACqE,MAAN,CAAa,cAAb,EAA6BuW,mBAA7B;AACH;AACJ,KAvOE;AAyOH1S,IAAAA,UAAU,mCAAE,oBAASG,MAAT,EAAiBqT,QAAjB,EAA2BC,MAA3B,EAAmC,CAC9C,CADS;AAzOP,GAAP;AA4OH,CA9O+B,CAjBhC,E,CAgQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAMAlV,OAAO,CAAC2L,MAAR,CAAe,aAAf,EAA8B,EAA9B,EACGwJ,QADH,CACY,kBADZ,EACgC;AAACC,EAAAA,SAAS,EAAE;AAAZ,CADhC,EAEG3T,UAFH,CAEc,gBAFd,EAEgC,CAAC,QAAD,EACC,SADD,EACY,UACVG,MADU,EAEVyT,OAFU,EAEF;AAGpC,MAAIC,OAAO,GAAG1T,MAAM,CAAC2T,YAArB;AAAA,MACIC,mBAAmB,GAAG5T,MAAM,CAAC6T,kBAAP,GAA4B7T,MAAM,CAAC6T,kBAAnC,GAAwDzV,OAAO,CAAC0V,IAD1F;AAAA,MAGIC,0BAA0B,GAAG,SAA7BA,0BAA6B,CAASC,cAAT,EAAwB;AACjD,WAAO,YAAU;AACb;AAEA,UAAIhU,MAAM,CAACiU,KAAP,CAAaC,OAAjB,EAA0B;AACtB,eAAOF,cAAc,CAACG,KAAf,CAAqB,IAArB,EAA2BC,SAA3B,CAAP;AACH,OAFD,MAEO;AACH,YAAIC,IAAI,GAAGD,SAAX;AACA,YAAIE,IAAI,GAAG,IAAX;AACA,eAAOtU,MAAM,CAACiU,KAAP,CAAa3b,MAAb,CAAoB,YAAU;AACjC,iBAAO0b,cAAc,CAACG,KAAf,CAAqBG,IAArB,EAA2BD,IAA3B,CAAP;AACH,SAFM,CAAP;AAGH;AACJ,KAZD;AAaH,GAjBL;;AAmBA,MAAIE,aAAa,GAAG,CAApB,CAtBoC,CAuBpC;;AACA,OAAKC,gBAAL,GAAwB,UAAS1a,CAAT,EAAY;AAClC,QAAI,CAACA,CAAC,CAAC2a,GAAP,EAAY;AACV3a,MAAAA,CAAC,CAAC2a,GAAF,GAAQF,aAAa,EAArB;AACD,KAHiC,CAIlC;;;AACA,WAAO,KAAKza,CAAC,CAAC2a,GAAP,IAAc3a,CAAC,CAAC2J,EAAF,IAAQ,EAAtB,KAA6B3J,CAAC,CAAC0D,KAAF,IAAW,EAAxC,KAA+C1D,CAAC,CAAC4a,GAAF,IAAS,EAAxD,KAA+D,CAAC5a,CAAC,CAAC6a,KAAH,IAAY,EAA3E,KAAkF,CAAC7a,CAAC,CAAC8a,GAAH,IAAU,EAA5F,KACJ9a,CAAC,CAAC+a,MAAF,IAAY,EADR,KACe/a,CAAC,CAACyC,SAAF,IAAe,EAD9B,IACoCqX,mBAAmB,CAAC;AAAC9R,MAAAA,KAAK,EAAEhI;AAAR,KAAD,CADvD,IACuE,EAD9E;AAED,GAPD;;AASA,MAAIgb,cAAc,GAAG,CAArB;AAAA,MAAwBC,oBAAoB,GAAG,CAA/C,CAjCoC,CAkCpC;;AACA,OAAKC,iBAAL,GAAyB,UAASC,MAAT,EAAiB;AACtC,QAAIC,EAAE,GAAG,MAAMD,MAAM,CAACE,IAAP,KAAgBF,MAAM,CAACE,IAAP,GAAcL,cAAc,EAA5C,CAAN,CAAT;AAAA,QACIM,MAAM,GAAGhX,OAAO,CAACoT,QAAR,CAAiByD,MAAjB,KAA4BA,MAAM,CAACG,MADhD;;AAEA,QAAIA,MAAJ,EAAY;AACRF,MAAAA,EAAE,GAAGA,EAAE,GAAG,GAAL,IAAYE,MAAM,CAACD,IAAP,KAAgBC,MAAM,CAACD,IAAP,GAAcJ,oBAAoB,EAAlD,CAAZ,CAAL;AACH;;AACD,WAAOG,EAAP;AACH,GAPD,CAnCoC,CA4CpC;;;AACA,OAAKG,SAAL,GAAiB,YAAW;AAC1B;AACA,QAAIC,YAAY,GAAG,EAAnB;;AACA,SAAK,IAAI5Y,CAAC,GAAG,CAAR,EAAW6Y,MAAM,GAAG7B,OAAO,CAAClQ,MAAjC,EAAyC9G,CAAC,GAAG6Y,MAA7C,EAAqD7Y,CAAC,EAAtD,EAA0D;AACxD,UAAIuY,MAAM,GAAGvB,OAAO,CAAChX,CAAD,CAApB;;AACA,UAAI0B,OAAO,CAACoX,OAAR,CAAgBP,MAAhB,CAAJ,EAA6B;AAC3B;AACAK,QAAAA,YAAY,CAAC7O,IAAb,CAAkBwO,MAAlB;AACD,OAHD,MAGO,IAAG7W,OAAO,CAACoT,QAAR,CAAiByD,MAAjB,KAA4B7W,OAAO,CAACoX,OAAR,CAAgBP,MAAM,CAACG,MAAvB,CAA/B,EAA8D;AACnE;AACA,YAAIK,QAAQ,GAAG,EAAf;;AACA,aAAI,IAAIjM,GAAR,IAAeyL,MAAf,EAAsB;AACpB,cAAGzL,GAAG,KAAK,KAAR,IAAiBA,GAAG,KAAK,QAA5B,EAAqC;AAClCiM,YAAAA,QAAQ,CAACjM,GAAD,CAAR,GAAgByL,MAAM,CAACzL,GAAD,CAAtB;AACF;AACF;;AACD,aAAI,IAAIkM,EAAE,GAAG,CAAb,EAAeA,EAAE,GAAGT,MAAM,CAACG,MAAP,CAAc5R,MAAlC,EAAyCkS,EAAE,EAA3C,EAA8C;AAC5CtX,UAAAA,OAAO,CAACwT,MAAR,CAAeqD,MAAM,CAACG,MAAP,CAAcM,EAAd,CAAf,EAAiCD,QAAjC;AACD;;AACDH,QAAAA,YAAY,CAAC7O,IAAb,CAAkBwO,MAAM,CAACG,MAAzB;AACD;AACF;;AACD,WAAOO,KAAK,CAACC,SAAN,CAAgBC,MAAhB,CAAuB1B,KAAvB,CAA6B,EAA7B,EAAiCmB,YAAjC,CAAP;AACD,GAvBD,CA7CoC,CAsEpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,OAAKQ,aAAL,GAAqB,UAASC,WAAT,EAAsBC,OAAtB,EAA+B;AAClD,QAAI1B,IAAJ;;AACA,QAAI2B,SAAS,GAAG,SAAZA,SAAY,GAAW;AACzB,UAAIC,KAAK,GAAG9X,OAAO,CAAC+X,UAAR,CAAmBJ,WAAnB,IAAkCA,WAAW,EAA7C,GAAkDA,WAA9D;AACA,UAAIvd,MAAM,GAAG,EAAb;AAAA,UAAiB4d,KAAjB;AAAA,UAAwBrb,EAAxB;;AACA,WAAK,IAAI2B,CAAC,GAAG,CAAR,EAAW2Z,CAAC,GAAGH,KAAK,CAAC1S,MAA1B,EAAkC9G,CAAC,GAAG2Z,CAAtC,EAAyC3Z,CAAC,EAA1C,EAA8C;AAC5C3B,QAAAA,EAAE,GAAGmb,KAAK,CAACxZ,CAAD,CAAV;AACA0Z,QAAAA,KAAK,GAAGJ,OAAO,CAACjb,EAAD,CAAf;AACAub,QAAAA,GAAG,CAACF,KAAD,CAAH,GAAarb,EAAb;AACAvC,QAAAA,MAAM,CAACiO,IAAP,CAAY2P,KAAZ;AACD;;AACD,aAAO5d,MAAP;AACD,KAVD,CAFkD,CAclD;AACA;AACA;AACA;AACA;;;AACA,QAAI+d,cAAc,GAAG,SAAjBA,cAAiB,CAAS7b,CAAT,EAAYC,CAAZ,EAAe;AAClC,UAAInC,MAAM,GAAG,EAAb;AAAA,UAAiBge,GAAG,GAAG,EAAvB;AAAA,UAA2B9Z,CAA3B;AAAA,UAA8B2Z,CAA9B;;AACA,WAAK3Z,CAAC,GAAG,CAAJ,EAAO2Z,CAAC,GAAG1b,CAAC,CAAC6I,MAAlB,EAA0B9G,CAAC,GAAG2Z,CAA9B,EAAiC3Z,CAAC,EAAlC,EAAsC;AACpC8Z,QAAAA,GAAG,CAAC7b,CAAC,CAAC+B,CAAD,CAAF,CAAH,GAAY,IAAZ;AACD;;AACD,WAAKA,CAAC,GAAG,CAAJ,EAAO2Z,CAAC,GAAG3b,CAAC,CAAC8I,MAAlB,EAA0B9G,CAAC,GAAG2Z,CAA9B,EAAiC3Z,CAAC,EAAlC,EAAsC;AACpC,YAAI,CAAC8Z,GAAG,CAAC9b,CAAC,CAACgC,CAAD,CAAF,CAAR,EAAgB;AACdlE,UAAAA,MAAM,CAACiO,IAAP,CAAY/L,CAAC,CAACgC,CAAD,CAAb;AACD;AACF;;AACD,aAAOlE,MAAP;AACD,KAXD,CAnBkD,CAgClD;;;AACA,QAAI8d,GAAG,GAAG,EAAV,CAjCkD,CAmClD;;AACA,QAAIG,YAAY,GAAG,SAAfA,YAAe,CAASC,SAAT,EAAoBC,SAApB,EAA+B;AAChD,UAAIja,CAAJ,EAAO2Z,CAAP,EAAUtb,EAAV,EAAcqb,KAAd;AACA,UAAIQ,cAAc,GAAG,EAArB;AACA,UAAIC,aAAa,GAAGN,cAAc,CAACI,SAAD,EAAYD,SAAZ,CAAlC;;AACA,WAAKha,CAAC,GAAG,CAAJ,EAAO2Z,CAAC,GAAGQ,aAAa,CAACrT,MAA9B,EAAsC9G,CAAC,GAAG2Z,CAA1C,EAA6C3Z,CAAC,EAA9C,EAAkD;AAChD,YAAIoa,YAAY,GAAGD,aAAa,CAACna,CAAD,CAAhC;AACA3B,QAAAA,EAAE,GAAGub,GAAG,CAACQ,YAAD,CAAR;AACA,eAAOR,GAAG,CAACQ,YAAD,CAAV;AACA,YAAIC,QAAQ,GAAGf,OAAO,CAACjb,EAAD,CAAtB,CAJgD,CAKhD;;AACA,YAAIgc,QAAQ,KAAKD,YAAjB,EAA+B;AAC7BxC,UAAAA,IAAI,CAAC0C,SAAL,CAAejc,EAAf;AACD,SAFD,MAEO;AACL6b,UAAAA,cAAc,CAACG,QAAD,CAAd,GAA2BD,YAA3B;AACAxC,UAAAA,IAAI,CAAC2C,SAAL,CAAelc,EAAf;AACD;AACF;;AAED,UAAImc,WAAW,GAAGX,cAAc,CAACG,SAAD,EAAYC,SAAZ,CAAhC;;AACA,WAAKja,CAAC,GAAG,CAAJ,EAAO2Z,CAAC,GAAGa,WAAW,CAAC1T,MAA5B,EAAoC9G,CAAC,GAAG2Z,CAAxC,EAA2C3Z,CAAC,EAA5C,EAAgD;AAC9C0Z,QAAAA,KAAK,GAAGc,WAAW,CAACxa,CAAD,CAAnB;AACA3B,QAAAA,EAAE,GAAGub,GAAG,CAACF,KAAD,CAAR;;AACA,YAAI,CAACQ,cAAc,CAACR,KAAD,CAAnB,EAA4B;AAC1B9B,UAAAA,IAAI,CAAC6C,OAAL,CAAapc,EAAb;AACD;AACF;AACF,KA1BD;;AA2BA,WAAOuZ,IAAI,GAAG;AACZ8C,MAAAA,SAAS,EAAE,mBAASzf,KAAT,EAAgB0f,cAAhB,EAAgC;AACzC1f,QAAAA,KAAK,CAACqE,MAAN,CAAaia,SAAb,EAAwB,UAASS,SAAT,EAAoBC,SAApB,EAA+B;AACrD,cAAIW,MAAM,GAAG,EAAED,cAAc,IAAIA,cAAc,CAACX,SAAD,EAAYC,SAAZ,CAAd,KAAyC,KAA7D,CAAb;;AACA,cAAIW,MAAJ,EAAY;AACVb,YAAAA,YAAY,CAACC,SAAD,EAAYC,SAAZ,CAAZ;AACD;AACF,SALD,EAKG,IALH;AAMD,OARW;AASZQ,MAAAA,OAAO,EAAE/Y,OAAO,CAAC0V,IATL;AAUZmD,MAAAA,SAAS,EAAE7Y,OAAO,CAAC0V,IAVP;AAWZkD,MAAAA,SAAS,EAAE5Y,OAAO,CAAC0V;AAXP,KAAd;AAaD,GA5ED;;AA8EA,OAAKyD,qBAAL,GAA6B,UAASC,gBAAT,EAA2BC,gBAA3B,EAA4C;AACrE,QAAIC,MAAM,GAAG,EAAb;AAEAtZ,IAAAA,OAAO,CAACwT,MAAR,CAAe8F,MAAf,EAAuBD,gBAAvB;AACArZ,IAAAA,OAAO,CAACwT,MAAR,CAAe8F,MAAf,EAAuBF,gBAAvB;AAEApZ,IAAAA,OAAO,CAACuZ,OAAR,CAAgBD,MAAhB,EAAwB,UAASvN,KAAT,EAAeX,GAAf,EAAmB;AACzC,UAAI,OAAOW,KAAP,KAAiB,UAArB,EAAgC;AAC9BuN,QAAAA,MAAM,CAAClO,GAAD,CAAN,GAAcuK,0BAA0B,CAAC2D,MAAM,CAAClO,GAAD,CAAP,CAAxC;AACD;AACF,KAJD;AAMA,WAAOkO,MAAP;AACH,GAbD;;AAeF,OAAKE,eAAL,GAAuB,UAASC,kBAAT,EAA6B;AAClD,QAAI,CAACA,kBAAkB,CAACC,IAApB,IAA4BD,kBAAkB,CAACE,WAAnD,EAAgE;AAC9D;AACA,UAAIC,OAAO,GAAG,SAAVA,OAAU,CAASxX,IAAT,EAAe;AAC3B;AACA,YAAIyX,CAAJ,EAAOpU,CAAP;AACAoU,QAAAA,CAAC,GAAG,EAAJ;;AACA,aAAKpU,CAAL,IAAUrD,IAAV,EAAgB;AACdyX,UAAAA,CAAC,CAACpU,CAAD,CAAD,GAAOrD,IAAI,CAACqD,CAAD,CAAX;AACD;;AACD,eAAOoU,CAAP;AACD,OARD;;AASA,UAAIC,GAAG,GAAGzE,OAAO,CAAC0E,gBAAlB;AACA,aAAO;AACLC,QAAAA,UAAU,EAAEJ,OAAO,CAACE,GAAG,CAACG,KAAL,CADd;AAELC,QAAAA,eAAe,EAAEN,OAAO,CAACE,GAAG,CAACK,UAAL,CAFnB;AAGLC,QAAAA,QAAQ,EAAER,OAAO,CAACE,GAAG,CAACO,GAAL,CAHZ;AAILC,QAAAA,aAAa,EAAEV,OAAO,CAACE,GAAG,CAACS,QAAL;AAJjB,OAAP;AAMD;;AACD,WAAO,EAAP;AACD,GArBD;AAsBD,CApM6B,CAFhC,EAuMGjhB,SAvMH,CAuMa,YAvMb,EAuM2B,CAAC,kBAAD,EAAqB,UAAS+f,gBAAT,EAA2B;AACvE,SAAO;AACLpe,IAAAA,QAAQ,EAAE,GADL;AAEL1B,IAAAA,KAAK,EAAE;AAACgc,MAAAA,YAAY,EAAC,UAAd;AAAyBE,MAAAA,kBAAkB,EAAE;AAA7C,KAFF;AAGLhU,IAAAA,UAAU,EAAE,gBAHP;AAILhI,IAAAA,IAAI,EAAE,cAASF,KAAT,EAAgB4V,GAAhB,EAAqBhU,KAArB,EAA4BsG,UAA5B,EAAwC;AAE5C,UAAI6T,OAAO,GAAG/b,KAAK,CAACgc,YAApB;AAAA,UACIiF,cAAc,GAAG,KADrB;AAAA,UAEI/L,QAFJ;AAAA,UAGIgM,mBAAmB,GAAGhZ,UAAU,CAACiW,aAAX,CAAyBpC,OAAzB,EAAkC7T,UAAU,CAACmV,iBAA7C,CAH1B;AAAA,UAII8D,aAAa,GAAGjZ,UAAU,CAACiW,aAAX,CAAyBjW,UAAU,CAACwV,SAApC,EAA+CxV,UAAU,CAAC2U,gBAA1D,CAJpB;AAAA,UAKI1T,OAAO,GAAG,IALd;;AAOA,eAASkK,UAAT,GAAqB;AACnB,YAAIwM,gBAAgB,GAAGje,KAAK,CAACwf,UAAN,GAAmBphB,KAAK,CAACqhB,OAAN,CAAcnK,KAAd,CAAoBtV,KAAK,CAACwf,UAA1B,CAAnB,GAA2D,EAAlF;AAAA,YACIlB,kBADJ;AAGAA,QAAAA,kBAAkB,GAAGhY,UAAU,CAAC0X,qBAAX,CAAiCC,gBAAjC,EAAmDC,gBAAnD,CAArB;AAEA,YAAIwB,wBAAwB,GAAGpZ,UAAU,CAAC+X,eAAX,CAA2BC,kBAA3B,CAA/B;AACAzZ,QAAAA,OAAO,CAACwT,MAAR,CAAeqH,wBAAf,EAAyCpB,kBAAzC;AACA/W,QAAAA,OAAO,GAAG;AAAE6S,UAAAA,YAAY,EAAED;AAAhB,SAAV;AACAtV,QAAAA,OAAO,CAACwT,MAAR,CAAe9Q,OAAf,EAAwBmY,wBAAxB,EATmB,CAUnB;;AACAnY,QAAAA,OAAO,CAAC0S,SAAR,GAAoB,IAApB;AAEA,YAAI0F,QAAQ,GAAG,EAAf;;AACA,aAAI,IAAIC,CAAR,IAAarY,OAAb,EAAqB;AACnB,cAAGqY,CAAC,KAAK,cAAT,EAAwB;AACtBD,YAAAA,QAAQ,CAACC,CAAD,CAAR,GAAcrY,OAAO,CAACqY,CAAD,CAArB;AACD;AACF;;AACD,eAAOC,IAAI,CAACC,SAAL,CAAeH,QAAf,CAAP;AACD;;AAEDvhB,MAAAA,KAAK,CAACoV,OAAN,GAAgB,YAAU;AACxB,YAAGF,QAAQ,IAAIA,QAAQ,CAACyM,YAAxB,EAAqC;AACnCzM,UAAAA,QAAQ,CAACyM,YAAT,CAAsB,SAAtB;AACD;;AACD,YAAG/f,KAAK,CAACsT,QAAT,EAAmB;AACjBA,UAAAA,QAAQ,GAAG4K,gBAAgB,CAACjE,SAAjB,CAA2Bja,KAAK,CAACsT,QAAjC,IAA6C5S,CAAC,CAACsT,GAAD,CAAD,CAAOxC,IAAP,CAAY,EAAZ,CAAxD;AACD,SAFD,MAEO;AACL8B,UAAAA,QAAQ,GAAG5S,CAAC,CAACsT,GAAD,CAAD,CAAOxC,IAAP,CAAY,EAAZ,CAAX;AACD;AACF,OATD;;AAWApT,MAAAA,KAAK,CAAC4hB,IAAN,GAAa,YAAU;AACrB1M,QAAAA,QAAQ,CAACyM,YAAT,CAAsBxY,OAAtB;;AACA,YAAGvH,KAAK,CAACsT,QAAT,EAAmB;AACjB4K,UAAAA,gBAAgB,CAACjE,SAAjB,CAA2Bja,KAAK,CAACsT,QAAjC,IAA6CA,QAA7C;AACD;AACF,OALD;;AAOAgM,MAAAA,mBAAmB,CAAC1B,OAApB,GAA8B,UAASlC,MAAT,EAAiB;AAC7CpI,QAAAA,QAAQ,CAACyM,YAAT,CAAsB,gBAAtB,EAAwCrE,MAAxC;AACA2D,QAAAA,cAAc,GAAG,IAAjB;AACD,OAHD;;AAKAC,MAAAA,mBAAmB,CAAC7B,SAApB,GAAgC,UAAS/B,MAAT,EAAiB;AAC/CpI,QAAAA,QAAQ,CAACyM,YAAT,CAAsB,mBAAtB,EAA2CrE,MAA3C;AACA2D,QAAAA,cAAc,GAAG,IAAjB;AACD,OAHD;;AAKAC,MAAAA,mBAAmB,CAAC5B,SAApB,GAAgC,UAAShC,MAAT,EAAiB;AAC/CpI,QAAAA,QAAQ,CAACyM,YAAT,CAAsB,eAAtB;AACAV,QAAAA,cAAc,GAAG,IAAjB;AACD,OAHD;;AAKAE,MAAAA,aAAa,CAAC3B,OAAd,GAAwB,UAASrV,KAAT,EAAgB;AACtC+K,QAAAA,QAAQ,CAACyM,YAAT,CAAsB,aAAtB,EAAqCxX,KAArC,EAA6CA,KAAK,CAAC0X,KAAN,GAAc,IAAd,GAAqB,KAAlE;AACD,OAFD;;AAIAV,MAAAA,aAAa,CAAC9B,SAAd,GAA0B,UAASlV,KAAT,EAAgB;AACxC+K,QAAAA,QAAQ,CAACyM,YAAT,CAAsB,cAAtB,EAAsCxX,KAAK,CAAC2S,GAA5C;AACD,OAFD;;AAIAqE,MAAAA,aAAa,CAAC7B,SAAd,GAA0B,UAASnV,KAAT,EAAgB;AACxC,YAAI2X,YAAY,GAAG5M,QAAQ,CAACyM,YAAT,CAAsB,cAAtB,EAAsCxX,KAAK,CAAC2S,GAA5C,CAAnB;;AACA,aAAK,IAAI/X,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+c,YAAY,CAACjW,MAAjC,EAAyC9G,CAAC,EAA1C,EAA8C;AAC5C,cAAIgd,WAAW,GAAGD,YAAY,CAAC/c,CAAD,CAA9B;AACAgd,UAAAA,WAAW,GAAGtb,OAAO,CAACwT,MAAR,CAAe8H,WAAf,EAA4B5X,KAA5B,CAAd;AACA+K,UAAAA,QAAQ,CAACyM,YAAT,CAAsB,aAAtB,EAAqCI,WAArC;AACD;AACF,OAPD;;AASAb,MAAAA,mBAAmB,CAACzB,SAApB,CAA8Bzf,KAA9B;AACAmhB,MAAAA,aAAa,CAAC1B,SAAd,CAAwBzf,KAAxB,EAA+B,YAAW;AACxC,YAAIihB,cAAc,KAAK,IAAvB,EAA6B;AAC3BA,UAAAA,cAAc,GAAG,KAAjB,CAD2B,CAE3B;;AACA,iBAAO,KAAP;AACD;AACF,OAND;AAQAjhB,MAAAA,KAAK,CAACqE,MAAN,CAAagP,UAAb,EAAyB,UAAS2O,IAAT,EAAcC,IAAd,EAAmB;AACxCjiB,QAAAA,KAAK,CAACoV,OAAN;AACApV,QAAAA,KAAK,CAAC4hB,IAAN;AACH,OAHD;AAID;AAlGI,GAAP;AAoGH,CArG0B,CAvM3B;AAgTE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourcesContent":["/*! ToAviate - v4.0.1 - 2026-02-13 */// // app.directive('fadeIn', function($timeout){\n// //     return {\n// //         restrict: 'A',\n// //         link: function($scope, $element, attrs){\n// //             $element.removeClass(\"ng-hide-add\");\n// //             $element.addClass(\"ng-hide-remove\");\n// //             // $element.on('load', function() {\n// //             //       $element.addClass(\"ng-hide-add\");\n// //             // });\n// //             setTimeout(function(){\n// //               console.log(\"TIMEOUT DONE\");\n// //                 $element.addClass(\"ng-hide-add\");\n// //             }, 800);\n\n// //         }\n// //     }\n// // });\n\n// //fade-in\n\n//  app.directive(\n//             \"fadeIn\",\n//             function() {\n//                 // I alter the DOM to add the fader image.\n//                 function compile( element, attributes, transclude ) {\n//                     element.prepend( \"<img class='fader' />\" );\n//                     return( link );\n//                 }\n//                 // I bind the UI events to the $scope.\n//                 function link( $scope, element, attributes ) {\n//                     var fader = element.find( \"img.fader\" );\n//                     var primary = element.find( \"img.image\" );\n//                     // Watch for changes in the source of the primary\n//                     // image. Whenever it changes, we want to show it\n//                     // fade into the new source.\n//                     $scope.$watch(\n//                         \"vm.current.image.link\",\n//                         function( newValue, oldValue ) {\n//                             // If the $watch() is initializing, ignore.\n//                             if ( newValue === oldValue ) {\n//                                 return;\n//                             }\n//                             // If the fader is still fading out, don't\n//                             // bother changing the source of the fader;\n//                             // just let the previous image continue to\n//                             // fade out.\n//                             if ( isFading() ) {\n//                                 return;\n//                             }\n//                             initFade( oldValue );\n//                         }\n//                     );\n//                     // I prepare the fader to show the previous image\n//                     // while fading out of view.\n//                     function initFade( fadeSource ) {\n//                         fader\n//                             .prop( \"src\", fadeSource )\n//                             .addClass( \"show\" )\n//                             .css(\"margin-left\", $(\".imagemain1\").css(\"margin-left\"))\n//                         ;\n//                         // Don't actually start the fade until the\n//                         // primary image has loaded the new source.\n//                         primary.one( \"load\", startFade );\n//                     }\n//                     // I determine if the fader is currently fading\n//                     // out of view (that is currently animated).\n//                     function isFading() {\n//                         return(\n//                             fader.hasClass( \"show\" ) ||\n//                             fader.hasClass( \"fadeOut\" )\n//                         );\n//                     }\n//                     // I start the fade-out process.\n//                     function startFade() {\n//                         // The .width() call is here to ensure that\n//                         // the browser repaints before applying the\n//                         // fade-out class (so as to make sure the\n//                         // opacity doesn't kick in immediately).\n//                         fader.width();\n//                         fader.addClass( \"fadeOut\" );\n//                         setTimeout( teardownFade, 250 );\n//                     }\n//                     // I clean up the fader after the fade-out has\n//                     // completed its animation.\n//                     function teardownFade() {\n//                         fader.removeClass( \"show fadeOut\" );\n//                     }\n//                 }\n//                 // Return the directive configuration.\n//                 return({\n//                     compile: compile,\n//                     restrict: \"A\"\n//                 });\n//             }\n//         );\n\napp.directive(\"fileread\", [function () {\n    return {\n        scope: {\n            fileread: \"=\"\n        },\n        link: function (scope, element, attributes) {\n            element.bind(\"change\", function (changeEvent) {\n                var reader = new FileReader();\n                reader.onload = function (loadEvent) {\n                    scope.$apply(function () {\n                        //content = reader.readAsText(file);\n                        scope.fileread = loadEvent.target.result.replace(/\\r\\n|\\r/g,'\\n');\n                    });\n                }\n                reader.readAsText(changeEvent.target.files[0]);\n            });\n        }\n    }\n}]);\n\n\n\n\n\napp.filter('capitalise', function() {\n    return function(input) {\n      return (!!input) ? input.charAt(0).toUpperCase() + input.substr(1).toLowerCase() : '';\n    }\n});\n\napp.filter('myDateTime', function() {\n    return function(input) {\n      return (!!input) ? moment(input).format(\"DD/MM/YYYY HH:mm\") : '';\n    }\n});\n\napp.filter('myToUpperCase', function(){\n  return function(input){\n    return (!!input) ? input.toUpperCase() : '';\n  }\n});\n\napp.filter('brakesTime', function() {\n    return function(input) {\n      if(input){\n        var split = input.split(\":\");\n        return (!!input) ? split[0]+\":\"+split[1] : '';\n      } else {\n        return '';\n      }\n    }\n});\n\napp.directive('datetimez', function() {\n    return {\n        restrict: 'A',\n        require : 'ngModel',\n        link: function(scope, element, attrs, ngModelCtrl) {\n          element.datetimepicker({\n            dateFormat:'dd/MM/yyyy 00:00:00',\n            language: 'EN',\n            // pickTime: false,\n            pickSeconds: false    \n          }).on('changeDate', function(e) {\n            ngModelCtrl.$setViewValue(e.date);\n            scope.$apply();\n            $(this).parent().find(\"input\").focus();\n          });\n        }\n    };\n});\n\napp.filter('roundFive', function(){\n  return function(input){\n            if(input){\n              if(input.indexOf(\":\") > -1){\n                var split = input.split(\":\");\n                var x = split[1];\n                var min_nearest_five = ((x % 5) >= 2.5 ? parseInt(x / 5) * 5 + 5 : parseInt(x / 5) * 5);\n                if(min_nearest_five < 10){\n                  min_nearest_five = \"0\"+min_nearest_five;\n                } else if(min_nearest_five == 60){\n                  split[0]++;\n                  min_nearest_five = \"00\";\n                }\n                return split[0] + \":\" + min_nearest_five;\n              } else {\n                return input;\n              }\n            } else {\n              return '';\n            }\n          }\n});\n\n\napp.filter('myTimeUTC', function() {\n    return function(input) {\n      return (!!input) ? moment.utc(input).format(\"HH:mm\") : '';\n    }\n});\n\n\n// app.directive('collapsible', ['$timeout', function($timeout){\n//         return {\n//           restrict: 'A',\n//           scope: { collapsible: '=' },\n//           link: function(scope, el) {\n//             var node = el[0];\n//             node.style.height = scope.collapsible ? node.scrollHeight + 'px' : '0px';\n//             if (scope.collapsible) node.classList.add('open');\n\n//             scope.$watch('collapsible', function(isOpen) {\n//               // Ensure layout is ready\n//               $timeout(function(){\n//                 if (isOpen) {\n//                   // measure to target height\n//                   node.classList.add('open');\n//                   var target = node.scrollHeight;\n//                   node.style.height = target + 'px';\n\n//                   // after transition ends, set to auto for flexible content\n//                   var onEnd = function(e){\n//                     if (e.propertyName === 'height') {\n//                       node.style.height = 'auto';\n//                       node.removeEventListener('transitionend', onEnd);\n//                     }\n//                   };\n//                   node.addEventListener('transitionend', onEnd);\n//                 } else {\n//                   // collapse from current height (may be auto): set explicit height first\n//                   var current = node.getBoundingClientRect().height;\n//                   node.style.height = current + 'px';\n//                   // force reflow for transition kick-off\n//                   node.offsetHeight; // eslint-disable-line no-unused-expressions\n//                   node.classList.remove('open');\n//                   node.style.height = '0px';\n//                 }\n//               });\n//             });\n\n//             // If inner content resizes while open, keep height in sync (optional, lightweight)\n//             var ro = null;\n//             if ('ResizeObserver' in window) {\n//               ro = new ResizeObserver(function(){\n//                 if (scope.collapsible && node.style.height === 'auto') return;\n//                 if (scope.collapsible) node.style.height = node.scrollHeight + 'px';\n//               });\n//               ro.observe(node);\n//               scope.$on('$destroy', function(){ ro && ro.disconnect(); });\n//             }\n//           }\n//         };\n//       }]);\n\n// app.directive('collapsible', ['$timeout', function($timeout){\n//         return {\n//           restrict: 'A',\n//           scope: { collapsible: '=' }, // 1.4.x doesn't support '<'\n//           link: function(scope, el) {\n//             var node = el[0];\n\n//             function open() {\n//               node.classList.add('open');\n//               // Set to measured height, then to auto after transition\n//               node.style.height = node.scrollHeight + 'px';\n//               var onEnd = function(e){\n//                 if (e.propertyName === 'height') {\n//                   node.style.height = 'auto';\n//                   node.removeEventListener('transitionend', onEnd);\n//                 }\n//               };\n//               node.addEventListener('transitionend', onEnd);\n//             }\n\n//             function close() {\n//               // If height is 'auto', set explicit current height first\n//               var current = node.getBoundingClientRect().height;\n//               node.style.height = current + 'px';\n//               // Force reflow\n//               /* eslint-disable no-unused-expressions */\n//               node.offsetHeight;\n//                eslint-enable no-unused-expressions \n//               node.classList.remove('open');\n//               node.style.height = '0px';\n//             }\n\n//             // Init\n//             $timeout(function(){\n//               if (scope.collapsible) {\n//                 node.classList.add('open');\n//                 node.style.height = 'auto';\n//               } else {\n//                 node.classList.remove('open');\n//                 node.style.height = '0px';\n//               }\n//             });\n\n//             scope.$watch('collapsible', function(isOpen){\n//               $timeout(function(){\n//                 if (isOpen) { open(); } else { close(); }\n//               });\n//             });\n\n//             // Optional: keep in sync on content resize\n//             var ro = null;\n//             if ('ResizeObserver' in window) {\n//               ro = new ResizeObserver(function(){\n//                 if (scope.collapsible && node.style.height !== 'auto') {\n//                   node.style.height = node.scrollHeight + 'px';\n//                 }\n//               });\n//               ro.observe(node);\n//               scope.$on('$destroy', function(){ if (ro) ro.disconnect(); });\n//             }\n//           }\n//         };\n//       }]);\n\napp.filter('numberFixedLen', function () {\n    return function(a,b){\n        return(1e4+\"\"+a).slice(-b);\n    };\n});\n\napp.directive('collapsible', ['$timeout', function($timeout){\n      return {\n        restrict: 'A',\n        scope: { collapsible: '=' },\n        link: function(scope, el) {\n          var node = el[0];\n          function open(){\n            node.classList.add('open');\n            node.style.height = node.scrollHeight + 'px';\n            var onEnd = function(e){\n              if(e.propertyName==='height'){\n                node.style.height = 'auto';\n                node.removeEventListener('transitionend', onEnd);\n              }\n            };\n            node.addEventListener('transitionend', onEnd);\n          }\n          function close(){\n            var current = node.getBoundingClientRect().height;\n            node.style.height = current + 'px';\n            node.offsetHeight;\n            node.classList.remove('open');\n            node.style.height = '0px';\n          }\n          scope.$watch('collapsible', function(isOpen){\n            $timeout(function(){ isOpen ? open() : close(); });\n          });\n        }\n      };\n    }]);\n\n\n\n\n  // Minimal DOM builders (no inline styles beyond positioning)\n  function buildSuccessDOM(msg) {\n    var wrapper = document.createElement('div');\n    wrapper.className = 'payok-root';\n    wrapper.setAttribute('role', 'status');\n    wrapper.setAttribute('aria-live', 'polite');\n\n    var confetti = document.createElement('div');\n    confetti.className = 'payok-confetti';\n    for (var i = 0; i < 24; i++) {\n      var piece = document.createElement('div');\n      piece.className = 'payok-piece';\n      piece.style.left = (Math.random() * 100) + 'vw';\n      piece.style.animationDelay = (Math.random() * 150) + 'ms';\n      piece.style.animationDuration = (900 + Math.random() * 600) + 'ms';\n      confetti.appendChild(piece);\n    }\n\n    var toast = document.createElement('div');\n    toast.className = 'payok-toast';\n\n    var ico = document.createElement('div');\n    ico.className = 'payok-ico';\n\n    var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    svg.setAttribute('class', 'payok-check');\n    svg.setAttribute('viewBox', '0 0 24 24');\n    var path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n    path.setAttribute('d', 'M5 13l4 4L19 7');\n    svg.appendChild(path);\n    ico.appendChild(svg);\n\n    var text = document.createElement('div'); text.className = 'payok-text';\n    var title = document.createElement('div'); title.className = 'payok-title'; title.textContent = msg || 'Payment successful';\n    var sub = document.createElement('div');   sub.className   = 'payok-sub';   sub.textContent   = 'Your payment has been processed.';\n    text.appendChild(title); text.appendChild(sub);\n\n    toast.appendChild(ico); toast.appendChild(text);\n\n    wrapper.appendChild(confetti);\n    wrapper.appendChild(toast);\n    return { root: wrapper, toast: toast };\n  }\n\n  function buildFailureDOM(msg) {\n    var wrapper = document.createElement('div');\n    wrapper.className = 'payfail-root';\n    wrapper.setAttribute('role', 'alert');\n    wrapper.setAttribute('aria-live', 'assertive');\n\n    var toast = document.createElement('div');\n    toast.className = 'payfail-toast';\n\n    var ico = document.createElement('div');\n    ico.className = 'payfail-ico';\n\n    var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    svg.setAttribute('class', 'payfail-x');\n    svg.setAttribute('viewBox', '0 0 24 24');\n    var p1 = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n    p1.setAttribute('d', 'M6 6L18 18');\n    var p2 = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n    p2.setAttribute('d', 'M18 6L6 18');\n    svg.appendChild(p1); svg.appendChild(p2);\n    ico.appendChild(svg);\n\n    var text = document.createElement('div'); text.className = 'payfail-text';\n    var title = document.createElement('div'); title.className = 'payfail-title'; title.textContent = msg || 'Payment failed';\n    var sub = document.createElement('div');   sub.className   = 'payfail-sub';   sub.textContent   = \"Your payment method wasn't charged. Please try again.\";\n    text.appendChild(title); text.appendChild(sub);\n\n    toast.appendChild(ico); toast.appendChild(text);\n    wrapper.appendChild(toast);\n    return { root: wrapper, toast: toast };\n  }\n\n\n  \n   app.directive('paymentSuccessToast', ['$timeout', function ($timeout) {\n      return {\n        restrict: 'A',\n        scope: {\n          paymentSuccessToast: '=', // boolean trigger\n          message: '@?',            // optional title\n          durationMs: '=?',         // optional duration\n          onDone: '&?'              // optional callback\n        },\n        link: function (scope) {\n          var showMs = angular.isNumber(scope.durationMs) ? scope.durationMs : 2200;\n          var hideTimer, doneTimer, nodes;\n\n          function cleanup() {\n            if (hideTimer) $timeout.cancel(hideTimer);\n            if (doneTimer) $timeout.cancel(doneTimer);\n            hideTimer = doneTimer = null;\n            if (nodes && nodes.root && nodes.root.parentNode) {\n              nodes.root.parentNode.removeChild(nodes.root);\n            }\n            nodes = null;\n          }\n\n          function show() {\n            cleanup();\n            nodes = buildSuccessDOM(scope.message);\n            document.body.appendChild(nodes.root);\n            hideTimer = $timeout(function () {\n              if (!nodes) return;\n              nodes.toast.classList.add('payok-hide');\n              doneTimer = $timeout(function () {\n                cleanup();\n                if (scope.onDone) scope.onDone();\n              }, 380);\n            }, showMs);\n          }\n\n          scope.$watch('paymentSuccessToast', function (fire) {\n            if (fire) $timeout(show);\n          });\n\n          scope.$on('$destroy', cleanup);\n        }\n      };\n    }])\n\n    // FAILURE  attribute directive (same format, no confetti)\n    app.directive('paymentFailureToast', ['$timeout', function ($timeout) {\n      return {\n        restrict: 'A',\n        scope: {\n          paymentFailureToast: '=', // boolean trigger\n          message: '@?',\n          durationMs: '=?',\n          onDone: '&?'\n        },\n        link: function (scope) {\n          var showMs = angular.isNumber(scope.durationMs) ? scope.durationMs : 2600;\n          var hideTimer, doneTimer, nodes;\n\n          function cleanup() {\n            if (hideTimer) $timeout.cancel(hideTimer);\n            if (doneTimer) $timeout.cancel(doneTimer);\n            hideTimer = doneTimer = null;\n            if (nodes && nodes.root && nodes.root.parentNode) {\n              nodes.root.parentNode.removeChild(nodes.root);\n            }\n            nodes = null;\n          }\n\n          function show() {\n            cleanup();\n            nodes = buildFailureDOM(scope.message);\n            document.body.appendChild(nodes.root);\n            hideTimer = $timeout(function () {\n              if (!nodes) return;\n              nodes.toast.classList.add('payfail-hide');\n              doneTimer = $timeout(function () {\n                cleanup();\n                if (scope.onDone) scope.onDone();\n              }, 380);\n            }, showMs);\n          }\n\n          scope.$watch('paymentFailureToast', function (fire) {\n            if (fire) $timeout(show);\n          });\n\n          scope.$on('$destroy', cleanup);\n        }\n      };\n    }]);\n  \n\n\n  app.directive('paymentAccordion', function(){\n    return {\n      restrict: 'E',\n      scope: {\n        methods: '=',\n        savedCards: '=',\n        send: '=',\n        open: '=',\n        info: '=',\n        user: '=',\n        bookout: '=',\n        invoice: '=',\n        onConfirm: '&'\n      },\n      controllerAs: 'vm',\n      bindToController: true,\n      templateUrl: '/js/directives/payment-form.html',   // <-- use external template\n      controller: ['$sce', 'PaymentService', '$scope', 'BookoutService', 'EnvConfig', function($sce, PaymentService, $scope, BookoutService, EnvConfig){\n        var vm = this;\n\n        vm.show_loading = false;\n        vm.show_cardmachine = false;\n\n        /*\n          Create New Card Intent:::: \n          1. invoice_id, club_id, user_id\n          2. booking_id, club_id, user_id\n          3. amount, club_id, user_id(opt)\n\n        */\n\n        //console.log(vm.send);\n\n        PaymentService.CreatePaymentIntentNewCard(vm.send)\n            .then(function (data) {\n                console.log(\"DATA HERE\", data);\n                // Initialize Stripe.js\n                var stripe = Stripe(EnvConfig.getStripeKey());\n\n                const options = {\n                  clientSecret: data.client_secret,\n                  // Fully customizable with appearance API.\n                  appearance: {\n                    rules: {\n                      '.ModalContent': {\n                        zIndex: 999999999999999991 // Set this higher than your popup's z-index\n                      },\n                      '.ModalOverlay': {\n                        zIndex: 999999999999999991 // Set this higher than your popup's z-index\n                      }\n                    }\n                  },\n                   wallets: {\n                    link: 'never' // Never show Link\n                  },\n                  paymentMethodOrder: ['card', 'apple_pay', 'google_pay']\n\n                };\n\n                // Set up Stripe.js and Elements using the SetupIntent's client secret\n                const elements = stripe.elements(options);\n\n                // Create and mount the Payment Element\n                const paymentElementOptions = { layout: 'tabs'};\n                const paymentElement = elements.create('payment', paymentElementOptions);\n                paymentElement.mount('#payment-element');\n\n\n                const submitButton = document.getElementById('submit-stripe');\n                if (submitButton) {\n                  submitButton.addEventListener('click', async (event) => {\n\n                    $scope.$apply(() => {\n                        vm.show_loading = true;\n                    });\n                    event.preventDefault();\n                    //console.log('Submit button clicked!');\n                    \n                    // Process the payment manually\n                    const {error, paymentIntent} = await stripe.confirmPayment({\n                      elements,\n                      confirmParams: {\n                       // return_url: 'https://example.com/order/confirmation',\n                      },\n                      redirect: 'if_required', // Only redirect if absolutely necessary\n                    });\n                    \n                    if (error) {\n                      if(error.code == \"payment_intent_authentication_failure\"){\n                          //vm.paymentOk = true\n                          vm.paymentNo = true;\n                          vm.payment_status_message = \"You have failed to pass your card issuer's authentication - please try again or pay with another payment method.\";\n                          //alert(\"You have failed to pass your card issuer's authentication - please try again or pay with another payment method.\");\n                          // vm.show_loading = false;\n                          //after_success_bookin(where_to, data);\n                      } else {\n                        //alert(error.message);\n                        //vm.paymentOk = true;\n                        vm.paymentNo = true;\n                        vm.payment_status_message = error.message;\n                        // vm.show_loading = false;\n                      }\n\n                      $scope.$apply(() => {\n                            vm.show_loading = false;\n                        });\n\n                    } else if(paymentIntent){\n                        //console.log(\"SUCCESS??\");\n                            if (paymentIntent.status === 'succeeded') {\n                                //console.log(\"PAYMENT SUCCEEDED!!\");\n                                //alert(\"SUCCEEDED\");\n                                vm.paymentOk = true;\n                                //this is where I will now look at confirming that this is paid etc...paymentIntent\n                                vm.onConfirm({ methodLabel: 'new-card', paymentIntent: paymentIntent });\n                                // $scope.$apply(() => {\n                                //     vm.book_in_flight('new_card', paymentIntent);\n                                // });\n                                \n\n                            } else {\n                                //alert(\"FAILED??\");\n                                console.log(\"ERROR\", paymentIntent);\n                                 //console.log(\"There was an error processing your payment\");\n                                 vm.paymentNo = true;\n                                vm.payment_status_message = \"There was an error processing your payment\";\n\n                                $scope.$apply(() => {\n                                    vm.show_loading = true;\n                                });\n                            }\n                    }\n                  });\n                }\n\n\n\n\n            });\n\n\n        //vm.confirm('Card Machine') --> this is the completion of whatever is going on.\n\n        vm.expandedId = vm.open;\n        vm.selectedId = vm.open;\n        vm.selectedSavedCardId = null;\n\n        vm.dd   = { name: '', email: '', sortCode: '', account: '' };\n        vm.card = { name: '', number: '', exp: '', cvc: '' };\n\n        vm.$onInit = function(){\n          if (vm.methods && vm.methods.length) {\n            vm.expandedId = vm.methods[0].id;\n            vm.selectedId = vm.methods[0].id;\n          }\n          if (vm.savedCards && vm.savedCards.length) {\n            vm.selectedSavedCardId = vm.savedCards[0].id;\n          }\n        };\n\n        vm.toggle = function(id){\n          vm.expandedId = (vm.expandedId === id) ? null : id;\n          vm.selectedId = id;\n        };\n        vm.isExpanded = function(id){ return vm.expandedId === id; };\n        vm.keyHeader = function(e, id){\n          var k = e.which || e.keyCode;\n          if (k === 13 || k === 32) { e.preventDefault(); vm.toggle(id); }\n        };\n        vm.switchTo = function(type){\n          for (var i=0; i<vm.methods.length; i++){\n            if (vm.methods[i].type === type) {\n              vm.selectedId = vm.methods[i].id;\n              vm.expandedId = vm.methods[i].id;\n              break;\n            }\n          }\n        };\n        vm.ddReady = function(){\n          return !!(vm.dd.name && vm.dd.email && vm.dd.sortCode && vm.dd.account);\n        };\n        vm.cardReady = function(){\n          return !!(vm.card.name && vm.card.number && vm.card.exp && vm.card.cvc);\n        };\n        vm.confirm = function(methodLabel, paymentIntent=null){\n          vm.onConfirm({ methodLabel: methodLabel, paymentIntent: paymentIntent });\n        };\n        vm.selectedTitle = function(){\n          for (var i=0; i<vm.methods.length; i++){\n            if (vm.methods[i].id === vm.selectedId) { return vm.methods[i].title; }\n          }\n          return null;\n        };\n\n        vm.selectSavedCard = function(id){ vm.selectedSavedCardId = id; };\n\n        vm.keySelectTile = function(e, id){\n          var k = e.which || e.keyCode;\n          if (k === 13 || k === 32) { e.preventDefault(); vm.selectSavedCard(id); }\n        };\n        vm.cardBrandIcon = function(brand){\n          var visa = '<svg viewBox=\"0 0 36 24\"><rect width=\"36\" height=\"24\" rx=\"4\" fill=\"#0a4595\"/><text x=\"18\" y=\"16\" text-anchor=\"middle\" font-size=\"10\" fill=\"#fff\">VISA</text></svg>';\n          var mc   = '<svg viewBox=\"0 0 36 24\"><rect width=\"36\" height=\"24\" rx=\"4\" fill=\"#1f2937\"/><circle cx=\"15\" cy=\"12\" r=\"6.5\" fill=\"#eb001b\"/><circle cx=\"21\" cy=\"12\" r=\"6.5\" fill=\"#f79e1b\" opacity=\".9\"/></svg>';\n          var amex = '<svg viewBox=\"0 0 36 24\"><rect width=\"36\" height=\"24\" rx=\"4\" fill=\"#2e77bb\"/><text x=\"18\" y=\"16\" text-anchor=\"middle\" font-size=\"9\" fill=\"#fff\">AMEX</text></svg>';\n          var b = (brand || '').toLowerCase();\n          var svg = /visa/.test(b) ? visa\n                  : /(master|mc)/.test(b) ? mc\n                  : /(amex|american)/.test(b) ? amex\n                  : '<svg viewBox=\"0 0 36 24\"><rect width=\"36\" height=\"24\" rx=\"4\" fill=\"#eef2ff\"/><text x=\"18\" y=\"15\" text-anchor=\"middle\" font-size=\"8\" fill=\"#4f46e5\">CARD</text></svg>';\n          return $sce.trustAsHtml(svg);\n        };\n\n        vm.close_machine_popup = function(){\n\n            //clear the card machine and close the popup??\n\n            //at this point the flight probably has already been booked back in... lets consider how to give options for payment\n             BookoutService.ClearMachine(vm.payment_id, vm.club_id)\n            .then(function(data){\n                if(data.success){\n                    console.log(\"machine should be clear now?\", data);\n                    vm.show_cardmachine = false;\n                    vm.show_after_bookedin = true;\n\n                } else {\n                    console.log(\"No success on card machine clear\");\n                    //at this point the flight probably has already been booked back in... lets consider how to give options for payment\n                    vm.show_cardmachine = false;\n                    vm.show_after_bookedin = true;\n                }\n            });\n\n\n\n            // vm.show_cardmachine = false;\n            // vm.show_after_bookedin = true;\n\n        }\n\n        vm.cancel_machine = function(){\n\n            //cancel the payment request?\n            BookoutService.ClearMachine(vm.payment_id, vm.club_id)\n            .then(function(data){\n                if(data.success){\n                    console.log(\"machine should be clear now?\", data);\n                    vm.show_cardmachine = false;\n                    //at this point the flight probably has already been booked back in... lets consider how to give options for payment\n                    vm.show_after_bookedin = true;\n                    vm.stop_polling = true;\n\n                } else {\n                    console.log(\"No success on card machine clear\");\n                    //at this point the flight probably has already been booked back in... lets consider how to give options for payment\n                    vm.show_after_bookedin = true;\n\n                }\n            });\n\n\n\n        }\n\n        vm.close_bookedin = function(){\n\n            BookoutService.ClearMachine(vm.payment_id, vm.club_id)\n            .then(function(data){\n                 //once cleared - we continue?\n                 console.log(\"regardless of clear - should now be cleared?\");\n                 vm.show_cardmachine = false;\n                 vm.show_after_bookedin = false;\n                 vm.stop_polling = true;\n                 //after_success_bookin(vm.after_where_to, vm.after_data);\n\n                 //return complete FALSE\n\n            });\n\n        }\n\n\n        vm.reset_card_machine = function(){\n\n            //console.log(\"retry\", vm.payment_id);\n            //try to send the request a second time to the machine?\n            BookoutService.RetryPaymentMachine(vm.payment_id, vm.club_id)\n            .then(function(data){\n                console.log(data);\n                if(data.success){\n                    //alert(\"The card machine should hopefully be displaying the payment now\");\n                    //create new poll??\n                    vm.stop_polling = false;\n                    poll_check_payment(vm.payment_id, 30, function(result, details) {\n                        if (result) {\n                            vm.stop_polling = true;\n                            //alert(\"Payment confirmed!\");\n                            vm.paymentOk = true;\n                            vm.onConfirm({ methodLabel: 'card-machine', paymentIntent: details.paymentIntent });\n\n                        } else {\n                            //alert(\"Payment not confirmed - please try again\");\n                            vm.paymentNo = true;\n                            vm.payment_status_message = \"Payment was not confirmed - please try again\";\n                        }\n                    });\n                } else {\n                    if(data.success == false && data.message == \"The payment has already been successfully made.\"){\n                        vm.stop_polling = true;\n                        vm.onConfirm({ methodLabel: 'card-machine', paymentIntent: data.paymentIntent });\n                    }\n                    console.log(data.message);\n                }\n\n            });\n\n\n            vm.show_cardmachine = true;\n\n        }\n\n        vm.payment_errors = [];\n\n        function poll_check_payment(id, maxAttempts, finalCallback) {\n            var attempts = 0;\n\n                function attempt() {\n                  if(vm.stop_polling){\n                    return;\n                  }\n                    check_payment(id, function(success, details) {\n                        attempts++;\n                        if (success) {\n                            // console.log(\"Payment confirmed!\");\n                            finalCallback(true, details);\n                        } else if (attempts >= maxAttempts) {\n                            // console.log(\"Max attempts reached, giving up.\");\n                            finalCallback(false, \"\");\n                        } else if (vm.stop_polling) {\n                            // console.log(\"called to stop polling\");\n                            finalCallback(false, \"\");\n                            return;\n                        } else {\n                            // console.log(details);\n                            if(details && details.add_info && details.add_info !== \"\"){\n                              var new_error = {payment_id: vm.payment_id, charge_id: details.add_info.charge};\n                              // console.log(\"errors are: \", vm.payment_errors);\n                              // console.log(\"new error is: \", new_error);\n                              var check = vm.payment_errors.some(el => (el.charge_id === details.add_info.charge && el.payment_id === vm.payment_id));\n                              // console.log(\"did new error exist?? \", check);\n                              if(check){\n                                // console.log(\"there was a previous error - but we keep going\");\n                                // console.log(\"Retrying in 10000 ms...\");\n                                setTimeout(attempt, 10000);\n                              } else {\n                                vm.payment_errors.push(new_error);\n                                //alert(\"There was an error with the payment: \"+details.add_info.code+\"\\n\"+details.add_info.message);\n                                // console.log(details.add_info); \n                                vm.paymentNo = true;\n                                vm.payment_status_message = \"There was an error with the payment: \"+details.add_info.code+\"\\n\"+details.add_info.message;\n                                vm.stop_polling = true;\n                                finalCallback(false, \"\");\n                                return;\n                              }\n\n                            } else {\n                              console.log(\"Retrying in 5sec...\");\n                              setTimeout(attempt, 5000);\n                            }\n                            \n                        }\n                    });\n                }\n\n                attempt(); // Start polling\n        }\n\n        function get_update_on_cardmachine(payment_id, retry, limit, callback2){\n            if(retry <= limit){\n\n                check_payment(payment_id, function(result, details) {\n                  // console.log(\"DEETS\",details);\n                    if (result) {\n                        // do something if true\n                        // console.log(\"RESPONSE FROM CHECK PAYMENT IS TRUE\");\n                        callback2(true);//{success: true, message: \"payment checked & done\"};\n                    } else {\n                        // do something if false\n                         // console.log(\"delay and try again?\");\n                    \n                        setTimeout(() => {\n                          // console.log(\"Delayed for 5 second.\", payment_id);\n                          // console.log(\"Delayed for 5 second.\", vm.payment_id);\n                          retry++;\n                          callback2(get_update_on_cardmachine(payment_id, retry, limit, callback));\n                        }, 10000);\n                    }\n                });\n\n                \n            } else {\n                console.log(\"over limit?\");\n                callback2(false);// false;//{success: false, message: \"too many attempts\"};\n            }\n        }\n\n        function check_payment(id, callback){\n\n            BookoutService.CheckPayment(id)\n            .then(function(data){\n                if(data.success){\n                    // console.log(\"check payment\", data);\n                    if(data.status){\n                        // console.log(\"status = true\");\n                         callback(true, data);\n                    } else {\n                        // console.log(\"status = false\");\n                         callback(false, data);\n                    }\n                    \n                } else {\n                        // console.log(\"NOTHING SENT?\");\n                         callback(false, data.add_info);\n                }\n            });\n\n           // return false;\n\n        }\n\n        //create_saved_card_intent\n        //create_payment_intent_new_card\n        //create_cardmachine_intent\n\n        // service.CreatePaymentIntentNewCard = CreatePaymentIntentNewCard; //ok\n        // service.CreateSavedPaymentIntent = CreateSavedPaymentIntent; //ok\n        // service.CreateCardMachinePaymentIntent = CreateCardMachinePaymentIntent; //ok\n\n        vm.pay_with_cardmachine = function(){\n            vm.show_loading = true;\n            //booking_id: vm.bookout.booking_id,\n            // var obj = {\n            //     user_id: vm.user.id,\n            //     club_id: vm.bookout.club_id\n            // }\n\n            //console.log(\"OBJ --> \", vm.send);\n\n            PaymentService.CreateCardMachinePaymentIntent(vm.send)\n               .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                              vm.stop_polling = false;\n                              //success means the paymentIntent was created and the cardmachine was setup\n                              //NOT that it has successfully been done... soooo we show the cardmachine overlay\n                              vm.show_loading = false;\n                              vm.show_cardmachine = true;\n\n                              vm.payment_id = data.paymentID;\n\n                              //and we start polling I think??\n                              poll_check_payment(data.paymentID, 30, function(result, details) {\n                                  if (result) {\n                                      vm.stop_polling = true;\n                                      //alert(\"Payment confirmed!\");\n                                      vm.paymentOk = true;\n                                      vm.show_loading = false;\n                                      //after_success_bookin(where_to, data);\n                                      vm.onConfirm({ methodLabel: 'card-machine', paymentIntent: details.paymentIntent });\n\n                                  } else {\n                                      //alert(\"Payment not confirmed - please try again\");\n                                      vm.paymentNo = true;\n                                      vm.payment_status_message = \"Payment not confirmed - please try again\";\n                                      vm.show_loading = false;\n                                  }\n                              });\n\n\n\n\n                            } else {\n\n                              alert(\"We had an issue talking to the card machine - please try again by using the buttons below\");\n                              vm.show_loading = false;\n                              vm.show_cardmachine = true;\n\n                              //and do nothing else for now!\n\n\n                            }\n                });\n\n        }\n\n\n        vm.pay_with_saved_card = function(){\n            vm.show_loading = true;\n            //console.log(\"cardid = \", vm.selectedSavedCardId);\n            \n            // .. // .. /// .. /// .. // ... //\n            //we need to create a payment intent for the booking rather than a singular invoice\n            // PaymentService.CreatePaymentIntentBooking\n\n\n            //at the moment this only does the bookout - will need to adjust.... for individual invoice payment\n\n            // var obj = {\n            //     booking_id: vm.bookout.booking_id,\n            //     user_id: vm.user.id,\n            //     card_id: vm.selectedSavedCardId,\n            //     club_id: vm.bookout.club_id\n            // }\n\n            vm.send.card_id = vm.selectedSavedCardId;\n\n            //console.log(\"OBJ --> \", vm.send);\n\n            //for the cardmachine... this is what we're after\n            //PaymentService.CreateCardMachinePaymentIntentBooking(OBJ)\n            \n            PaymentService.CreateSavedPaymentIntent(vm.send)\n                        .then(function (data) {\n                            //console.log(data);\n                            if(data.success){\n                               \n                              //this is where we can do the callback??\n\n                              //alert(\"SUCCESS!\");\n                              vm.paymentOk = true;\n\n                              vm.onConfirm({ methodLabel: 'saved-card', paymentIntent: data.payment });\n\n                                ////console.log(\"CARDS\", vm.cards);\n                            } else {\n                               console.log(\"WOOOPSIES...\", data);\n                                //this shows the user the 3DS confirmation\n\n                                var stripe = Stripe(EnvConfig.getStripeKey());\n                                stripe.confirmCardPayment(\n                                  data.client_secret,\n                                  {\n                                    payment_method: data.payment_method,\n                                    return_url: data.card_url.return_url\n                                  },\n                                  // Disable the default next action handling.\n                                  // {handleActions: false}\n                                ).then(function(result) {\n                                  // Handle result.error or result.paymentIntent\n                                  // More details in Step 2.\n                                  //console.log(result);\n                                 \n                                  if(result.error) {\n                                    console.log(result.error);\n                                    if(result.error.code == \"payment_intent_authentication_failure\"){\n                                        //alert(\"You have failed to pass your card issuer's authentication - please try again or pay with another payment method.\");\n                                        vm.paymentNo = true;\n                                        vm.payment_status_message = \"You have failed to pass your card issuer's authentication - please try again or pay with another payment method.\";\n                                        vm.show_loading = false;\n                                    } else {\n                                      // alert(result.error.message);\n                                      vm.paymentNo = true;\n                                      vm.payment_status_message = result.error.message;\n                                      vm.show_loading = false;\n                                    }\n                                  } else if(result.paymentIntent.status === 'succeeded') {\n                                    // console.log('Payment successful!');\n                                    //we need to let the server know the payment was successful so it can be entered into the transaction list\n                                    BookoutService.CheckPayment(data.paymentID)\n                                        .then(function(data){\n                                            if(data.success){\n                                                vm.show_loading = false;\n                                                //alert(\"SUCCESS\");\n                                                vm.paymentOk = true;\n                                                // console.log(\"About to send back to controller: \");\n                                                // console.log(result.paymentIntent);\n                                                vm.onConfirm({ methodLabel: 'saved-card', paymentIntent: result.paymentIntent });\n                                            } else {\n                                                //alert(\"We encountered an error - please try again\");\n                                                vm.paymentNo = true;\n                                                vm.payment_status_message = result.error.message;\n                                                // console.log(\"NOTHING SENT?\");\n                                                vm.show_loading = false;\n                                            }\n                                        });\n\n                                    \n\n                                  } else {\n                                    console.log(\"not sure what happened - payment bit\");\n                                    vm.show_loading = false;\n                                  }\n\n                                  vm.show_loading = false;\n                                });\n\n\n                            }\n            });\n\n\n        }\n\n\n\n      }]\n    };\n  });\n\n\napp.factory('smoothScroll', function($window, $document, $timeout) {\n      function scrollTo(targetY, duration) {\n        duration = duration || 600;\n        var startY = $window.pageYOffset,\n            distanceY = targetY - startY,\n            startTime = null;\n\n        function easeInOutQuad(t) {\n          return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n        }\n\n        function step(timestamp) {\n          if (!startTime) startTime = timestamp;\n          var progress = (timestamp - startTime) / duration;\n          if (progress > 1) progress = 1;\n          var eased = easeInOutQuad(progress);\n          $window.scrollTo(0, startY + distanceY * eased);\n          if (progress < 1) {\n            $window.requestAnimationFrame(step);\n          }\n        }\n\n        $window.requestAnimationFrame(step);\n      }\n\n      return {\n        toElement: function(el, duration) {\n          if (!el) return;\n          var rect = el.getBoundingClientRect();\n          var targetY = rect.top + $window.pageYOffset;\n          scrollTo(targetY, duration);\n        },\n        toTop: function(duration) {\n          scrollTo(0, duration);\n        },\n        toBottom: function(duration) {\n          var targetY = $document[0].body.scrollHeight - $window.innerHeight;\n          scrollTo(targetY, duration);\n        }\n      };\n    });\n\n\n\napp.directive('mobileSlideMenu', ['$document', '$window', function($document, $window){\n  return {\n    restrict: 'A',\n    link: function(scope, el){\n\n      scope.menuOpen = false;\n\n      scope.openMenu = function(){\n        scope.menuOpen = true;\n      };\n\n      scope.closeMenu = function(){\n        scope.menuOpen = false;\n      };\n\n      scope.toggleMenu = function(){\n        scope.menuOpen = !scope.menuOpen;\n      };\n\n      // Close when pressing ESC\n      var onKeyDown = function(e){\n        if (e.key === 'Escape' || e.keyCode === 27){\n          scope.$applyAsync(function(){\n            scope.closeMenu();\n          });\n        }\n      };\n      $document.on('keydown', onKeyDown);\n\n      // Optional: close when resizing to desktop\n      var onResize = function(){\n        // If you want: close menu when leaving mobile breakpoint\n        if ($window.innerWidth > 860 && scope.menuOpen){\n          scope.$applyAsync(function(){\n            scope.closeMenu();\n          });\n        }\n      };\n      angular.element($window).on('resize', onResize);\n\n      // Optional: close after tapping a menu item\n      scope.onMenuItemClick = function($event){\n        // if you're using href=\"\", prevent jump\n        if ($event && $event.preventDefault) $event.preventDefault();\n        scope.closeMenu();\n      };\n\n      // Cleanup listeners\n      scope.$on('$destroy', function(){\n        $document.off('keydown', onKeyDown);\n        angular.element($window).off('resize', onResize);\n      });\n    }\n  };\n}]);\n\n\nangular.module('app').directive('uibTimepicker', function(uibDateParser) {\n  return {\n    require: 'ngModel',\n    link: function(scope, element, attrs, ngModel) {\n\n      ngModel.$formatters.push(function(value) { // view\n        if(!value) { return value; }\n\n        return uibDateParser.fromTimezone(value, 'UTC');\n      });\n\n      ngModel.$parsers.push(function(value) { // model\n        if(!value) { return value; }\n\n        return uibDateParser.toTimezone(value, 'UTC');\n      });\n\n    }\n  };\n});\napp.filter('range', function() {\n  return function(input, min, max) {\n    min = parseInt(min); //Make string input int\n    max = parseInt(max);\n    for (var i=min; i<=max; i++)\n      input.push(i);\n    return input;\n  };\n});\n\n\napp.directive(\n            \"numberSelector\",\n            function() {\n                // I alter the DOM to add the fader image.\n                function compile( element, attributes, transclude ) {\n                    if(attributes.available){\n\n                        var number = attributes.available;\n                        var model = attributes.model+\"[\"+attributes.iteration+\"].number\";\n                        console.log(\"TBD MODEL\", model);\n                        var tbd = \"\";\n                        for(var i=1;i<=attributes.available;i++){\n                            tbd += \"<option value='\"+i+\"'>\"+i+\"</option>\";\n                        }\n\n                        element.html( \"<select class='form-control' ng-model='\"+model+\"'>\"+tbd+\"</select>\" );\n                        return( link );\n                    }\n                    \n                }\n                // I bind the UI events to the $scope.\n                function link( $scope, element, attributes ) {\n                    console.log(\"ATTR\", attributes.available);\n                   \n                    function getOptions(){\n                        var number = attributes.available;\n                        var tbd = \"\";\n                        for(var i=0;i<attributes.available;i++){\n                            tbd += \"<option value='\"+i+\"'>\"+i+\"</option>\";\n                        }\n\n                        console.log(\"TBD\", tbd);\n                    }\n\n                    getOptions();\n\n\n                    // Watch for changes in the source of the primary\n                    // image. Whenever it changes, we want to show it\n                    // fade into the new source.\n                    // $scope.$watch(\n                    //     \"vm.current.image.link\",\n                    //     function( newValue, oldValue ) {\n                    //         // If the $watch() is initializing, ignore.\n                    //         if ( newValue === oldValue ) {\n                    //             return;\n                    //         }\n                    //         // If the fader is still fading out, don't\n                    //         // bother changing the source of the fader;\n                    //         // just let the previous image continue to\n                    //         // fade out.\n                    //         if ( isFading() ) {\n                    //             return;\n                    //         }\n                    //         initFade( oldValue );\n                    //     }\n                    // );\n                    // I prepare the fader to show the previous image\n                    // while fading out of view.\n                    // function initFade( fadeSource ) {\n                    //     fader\n                    //         .prop( \"src\", fadeSource )\n                    //         .addClass( \"show\" )\n                    //         .css(\"margin-left\", $(\".imagemain1\").css(\"margin-left\"))\n                    //     ;\n                    //     // Don't actually start the fade until the\n                    //     // primary image has loaded the new source.\n                    //     primary.one( \"load\", startFade );\n                    // }\n                    // // I determine if the fader is currently fading\n                    // // out of view (that is currently animated).\n                    // function isFading() {\n                    //     return(\n                    //         fader.hasClass( \"show\" ) ||\n                    //         fader.hasClass( \"fadeOut\" )\n                    //     );\n                    // }\n                    // // I start the fade-out process.\n                    // function startFade() {\n                    //     // The .width() call is here to ensure that\n                    //     // the browser repaints before applying the\n                    //     // fade-out class (so as to make sure the\n                    //     // opacity doesn't kick in immediately).\n                    //     fader.width();\n                    //     fader.addClass( \"fadeOut\" );\n                    //     setTimeout( teardownFade, 250 );\n                    // }\n                    // // I clean up the fader after the fade-out has\n                    // // completed its animation.\n                    // function teardownFade() {\n                    //     fader.removeClass( \"show fadeOut\" );\n                    // }\n                }\n                // Return the directive configuration.\n                return({\n                    compile: compile,\n                    restrict: \"AE\"\n                });\n            }\n        );\n\n\n\n// app.directive('fadeIn', function($timeout){\n//     return {\n//         restrict: 'A',\n//         link: function($scope, $element, attrs){\n//             $element.removeClass(\"ng-hide-add\");\n//             $element.addClass(\"ng-hide-remove\");\n//             // $element.on('load', function() {\n//             //       $element.addClass(\"ng-hide-add\");\n//             // });\n//             setTimeout(function(){\n//               console.log(\"TIMEOUT DONE\");\n//                 $element.addClass(\"ng-hide-add\");\n//             }, 800);\n\n//         }\n//     }\n// });\n\n//fade-in\n\n app.directive(\n            \"fadeIn\",\n            function() {\n                // I alter the DOM to add the fader image.\n                function compile( element, attributes, transclude ) {\n                    element.prepend( \"<img class='fader' />\" );\n                    return( link );\n                }\n                // I bind the UI events to the $scope.\n                function link( $scope, element, attributes ) {\n                    var fader = element.find( \"img.fader\" );\n                    var primary = element.find( \"img.image\" );\n                    // Watch for changes in the source of the primary\n                    // image. Whenever it changes, we want to show it\n                    // fade into the new source.\n                    $scope.$watch(\n                        \"vm.current.image.link\",\n                        function( newValue, oldValue ) {\n                            // If the $watch() is initializing, ignore.\n                            if ( newValue === oldValue ) {\n                                return;\n                            }\n                            // If the fader is still fading out, don't\n                            // bother changing the source of the fader;\n                            // just let the previous image continue to\n                            // fade out.\n                            if ( isFading() ) {\n                                return;\n                            }\n                            initFade( oldValue );\n                        }\n                    );\n                    // I prepare the fader to show the previous image\n                    // while fading out of view.\n                    function initFade( fadeSource ) {\n                        fader\n                            .prop( \"src\", fadeSource )\n                            .addClass( \"show\" )\n                            .css(\"margin-left\", $(\".imagemain1\").css(\"margin-left\"))\n                        ;\n                        // Don't actually start the fade until the\n                        // primary image has loaded the new source.\n                        primary.one( \"load\", startFade );\n                    }\n                    // I determine if the fader is currently fading\n                    // out of view (that is currently animated).\n                    function isFading() {\n                        return(\n                            fader.hasClass( \"show\" ) ||\n                            fader.hasClass( \"fadeOut\" )\n                        );\n                    }\n                    // I start the fade-out process.\n                    function startFade() {\n                        // The .width() call is here to ensure that\n                        // the browser repaints before applying the\n                        // fade-out class (so as to make sure the\n                        // opacity doesn't kick in immediately).\n                        fader.width();\n                        fader.addClass( \"fadeOut\" );\n                        setTimeout( teardownFade, 250 );\n                    }\n                    // I clean up the fader after the fade-out has\n                    // completed its animation.\n                    function teardownFade() {\n                        fader.removeClass( \"show fadeOut\" );\n                    }\n                }\n                // Return the directive configuration.\n                return({\n                    compile: compile,\n                    restrict: \"A\"\n                });\n            }\n        );\n\n// Directive: lcfDropzone\n// Provides drag-and-drop file handling for the lesson content file upload zone.\n// Usage: <div lcf-dropzone lcf-on-drop=\"vm.handleSelectedFiles(files)\" lcf-on-drag-state=\"vm.dragOver = isDragging\">\n\napp.directive('lcfDropzone', function() {\n    return {\n        restrict: 'A',\n        scope: {\n            lcfOnDrop: '&',\n            lcfOnDragState: '&'\n        },\n        link: function(scope, element) {\n            var dragCounter = 0;\n\n            function setDragState(isDragging) {\n                scope.$apply(function() {\n                    scope.lcfOnDragState({ isDragging: isDragging });\n                });\n            }\n\n            element.on('dragenter', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                dragCounter++;\n                if (dragCounter === 1) {\n                    setDragState(true);\n                }\n            });\n\n            element.on('dragover', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n            });\n\n            element.on('dragleave', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                dragCounter--;\n                if (dragCounter === 0) {\n                    setDragState(false);\n                }\n            });\n\n            element.on('drop', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                dragCounter = 0;\n                setDragState(false);\n\n                var dt = e.dataTransfer || (e.originalEvent && e.originalEvent.dataTransfer);\n                if (dt && dt.files && dt.files.length > 0) {\n                    scope.$apply(function() {\n                        scope.lcfOnDrop({ files: dt.files });\n                    });\n                }\n            });\n\n            scope.$on('$destroy', function() {\n                element.off('dragenter dragover dragleave drop');\n            });\n        }\n    };\n});\n\n\n// Directive: lcfFileSelect\n// Wraps a native file input to bind selected files into Angular scope.\n// Usage: <input type=\"file\" lcf-file-select=\"vm.onFileInputChange(files)\" />\n\napp.directive('lcfFileSelect', function() {\n    return {\n        restrict: 'A',\n        scope: {\n            lcfFileSelect: '&'\n        },\n        link: function(scope, element) {\n            element.on('change', function() {\n                var files = element[0].files;\n                if (files && files.length > 0) {\n                    scope.$apply(function() {\n                        scope.lcfFileSelect({ files: files });\n                    });\n                }\n                // Reset so same file can be re-selected\n                element[0].value = '';\n            });\n\n            scope.$on('$destroy', function() {\n                element.off('change');\n            });\n        }\n    };\n});\n\napp.directive('fullCalendar', function() {\n    return {\n        restrict: 'E',\n        scope: {\n            options: '=' // Pass configuration options from the controller\n        },\n        link: function(scope, element) {\n            var calendarEl = element[0];\n            var calendar;\n\n            function renderCalendar() {\n                if (calendar) {\n                    calendar.destroy(); // Destroy existing instance before re-rendering\n                }\n                calendar = new FullCalendar.Calendar(calendarEl, scope.options);\n                calendar.render();\n            }\n\n            // Watch for changes in options and re-render the calendar\n            scope.$watch('options', function(newOptions, oldOptions) {\n                if (newOptions) {\n                    renderCalendar();\n                }\n            }, true);\n        }\n    };\n});\n\napp.directive('uniquelink', [\"$q\", \"$timeout\", \"GalleryService\", function($q, $timeout, GalleryService) {\n  return {\n    require: 'ngModel',\n    link: function(scope, elm, attrs, ctrl) {\n\n      ctrl.$asyncValidators.uniquelink = function(modelValue, viewValue) {\n\n        if (ctrl.$isEmpty(modelValue)) {\n          // consider empty model valid\n          return $q.when();\n        }\n\n        var def = $q.defer();\n\n      \n        GalleryService.CheckLink(modelValue)\n          .then(function(data){\n            // console.log(\"RETURNED IS : \");\n            // console.log(data);\n            if(data.available == true){\n              def.resolve();\n            } else {\n              def.reject();\n            }\n          })\n\n\n        return def.promise;\n      };\n    }\n  };\n}]);\n\napp.directive('newuniquelink', [\"$q\", \"$timeout\", \"GalleryService\", \"LocalDataService\", function($q, $timeout, GalleryService, LocalDataService) {\n  return {\n    require: 'ngModel',\n    link: function(scope, elm, attrs, ctrl) {\n\n      ctrl.$asyncValidators.newuniquelink = function(modelValue, viewValue) {\n\n        if (ctrl.$isEmpty(modelValue)) {\n          // consider empty model valid\n          return $q.when();\n        }\n\n        var def = $q.defer();\n\n        var galleries = LocalDataService.data.all_galleries;\n        var counter = 0;\n        for(var i=0; i < galleries.length; i++){\n          if(galleries[i].gallery_link == modelValue){\n            counter++;\n          }\n        }\n\n        if(counter > 1){\n          def.reject();\n        } else {\n          def.resolve();\n        }\n        \n        // GalleryService.CheckLink(modelValue)\n        //   .then(function(data){\n        //     // console.log(\"RETURNED IS : \");\n        //     // console.log(data);\n        //     if(data.available == true){\n        //       def.resolve();\n        //     } else {\n        //       def.reject();\n        //     }\n        //   })\n\n\n        return def.promise;\n      };\n    }\n  };\n}]);\n//var m=angular.module(\"ui.timepicker\",[]);m.value(\"uiTimepickerConfig\",{step:15}),m.directive(\"uiTimepicker\",[\"uiTimepickerConfig\",\"$parse\",\"$window\",function(a,b,c){var d=c.moment,e=function(a){return void 0!==d&&d.isMoment(a)&&a.isValid()},f=function(a){return null!==a&&(angular.isDate(a)||e(a))};return{restrict:\"A\",require:\"ngModel\",scope:{ngModel:\"=\",baseDate:\"=\",uiTimepicker:\"=\"},priority:1,link:function(b,c,g,h){\"use strict\";var i=angular.copy(a),j=i.asMoment||!1;delete i.asMoment,h.$render=function(){var a=h.$modelValue;if(angular.isDefined(a)){if(null!==a&&\"\"!==a&&!f(a))throw new Error(\"ng-Model value must be a Date or Moment object - currently it is a \"+typeof a+\".\");e(a)&&(a=a.toDate()),c.is(\":focus\")||m()||c.timepicker(\"setTime\",a),null===a&&k()}},b.$watch(\"ngModel\",function(){h.$render()},!0),i.appendTo=i.appendTo||c.parent(),c.timepicker(angular.extend(i,b.uiTimepicker?b.uiTimepicker:{}));var k=function(){c.timepicker(\"setTime\",null)},l=function(){return c.val().trim()},m=function(){return l()&&null===h.$modelValue};c.on(\"$destroy\",function(){c.timepicker(\"remove\")});var n=function(){var a=h.$modelValue?h.$modelValue:b.baseDate;return e(a)?a.toDate():a},o=function(a){return j?d(a):a};c.is(\"input\")?(h.$parsers.unshift(function(a){var b=c.timepicker(\"getTime\",n());return b?o(b):b}),h.$validators.time=function(a){return g.required||l()?f(a):!0}):c.on(\"changeTime\",function(){b.$evalAsync(function(){var a=c.timepicker(\"getTime\",n());h.$setViewValue(a)})})}}}]);\n\napp.directive('datepicker', function(){\n  return {\n    restrict: 'A',\n    link: function (scope, element, attr) {\n\n        var obj = scope.$eval(attr.dateoptions);\n\n            //temp::\n            obj.format = \"d/m/yyyy\";\n            obj.autoclose = \"true\";\n            obj.todayHighlight = \"true\";\n            obj.defaultDate = new Date().format(\"d/M/yyyy\");\n            obj.setDate = new Date().format(\"d/M/yyyy\");\n\n            // console.log(\"DATE \", obj.setDate);\n\n\n            element.datepicker(obj);\n           \n    }\n  }\n});\n\n\napp.directive('timePicker', ['$timeout', function ($timeout) {\n    return {\n        restrict: 'AC',\n        scope: {\n            ngModel: '='\n        },\n        link: function(scope, element, attr) {\n\n            var obj = scope.$eval(attr.timeoptions);\n            console.log(\"BOOOOO \", obj);\n\n            element.on('change', function () {\n                if (element.hasClass('start')) {\n                    $timeout(function () {\n                        var $el = element.closest('[date-pair]').find('input.end'),\n                            endScope = angular.element($el).isolateScope();\n\n                        endScope.$apply(function () {\n                            endScope.ngModel = $el.val();\n                        });\n                    }, 0);\n                }\n            });\n            // element.timepicker({\n            //     timeFormat: 'H:i',\n            //     forceRoundTime: true\n            // });\n            element.timepicker(obj);\n        }\n    };\n}]);\n\n\n\napp.directive('datePair', function(){\n    return {\n        restrict: 'AC',\n        scope: {\n            dateoptions: \"=\"\n        },\n        link: function(scope, element, attr){\n        \n            var obj = scope.$eval(attr.dateoptions);\n            console.log(\"BOOOOO \", obj);\n\n            //element.datepair(obj);\n            element.datepair({\n                scrollDefault: 'now',\n                showDuration: true\n            });\n            // var hi = new Datepair(element, obj);\n\n        } \n    }\n});\n\n\n'use strict';\n\nangular.module('rgkevin.datetimeRangePicker', ['vr.directives.slider'])\n    .filter('rgTime', [function () {\n        /**\n         * input should be a number of minutes to be parsed\n         * @param {input} number of minutes\n         * @param {type} true = 00:00:00 | false = 00:00 am or pm\n         */\n        return function (input, type) {\n            var\n                hours = parseInt( input / 60, 10 ),\n                minutes = (input - (hours * 60)) < 10 ? '0' + (input - (hours * 60)) : input - (hours * 60),\n                // meridian = type ? ':00' : ( hours >= 12 && hours !== 24 ? ' pm' : ' am' );\n                meridian = ( hours >= 12 && hours !== 24 ? ' pm' : ' am' );\n\n            return (!type && hours > 12 ? (hours === 24 ? '00' : (hours - 12 < 10 ? '0': '' ) + (hours - 12) ) : (hours < 10 ? '0' : '') + hours) + ':' + minutes + meridian;\n        };\n    }])\n    .directive('rgRangePicker', [ '$compile', '$timeout', '$filter', function ($compile, $timeout, $filter) {\n\n    return {\n        restrict: 'A',\n        scope: {\n            data: '=rgRangePicker',\n            labels: '=',\n            onTimeChange: '&',\n            maxRangeDate: '=', // in days\n            vertical : '='\n        },\n\n        // replace: true,\n        template: function(/*element, attrs*/) {\n            /*var defaultsAttrs ={\n                data: {\n                    date: {\n                        from: new Date(),\n                        to: new Date()\n                    },\n                    time: {\n                        from: 0,\n                        to: 1440 // minutes in a day\n                    }\n                }\n            };\n            for(var xx in defaultsAttrs) {\n                if(attrs[xx] ===undefined) {\n                    attrs[xx] =defaultsAttrs[xx];\n                }\n            }*/\n\n\n            /* return '<div class=\"rg-range-picker\" ng-class=\"{\\'rg-range-picker-vertical\\':vertical}\">' +\n                        '<div class=\"rg-range-picker-box well\" ng-class=\"{ \\'only-calendars\\': !data.hasTimeSliders, \\'only-slider\\': !data.hasDatePickers }\">' +\n                            '<div class=\"rg-range-picker-calendars\" ng-show=\"data.hasDatePickers\">' +\n                                '<div class=\"rg-range-picker-calendar-box\">' +\n                                    '<h5 class=\"rg-range-picker-calendar-label\" ng-bind-template=\"{{datepickerTitles.from}}\"></h5>' +\n                                    '<div uib-datepicker ng-model=\"data.date.from\" max-date=\"data.date.to\" min-date=\"data.date.min\" show-weeks=\"false\" class=\"clean-calendar\" datepicker-options=\"{minDate: data.date.min, maxDate: data.date.to, showWeeks: false, startingDay: 1}\"></div>' +\n                                '</div>' +\n                                '<div class=\"rg-range-picker-calendar-box right\">' +\n                                    '<h5 class=\"rg-range-picker-calendar-label\" ng-bind-template=\"{{datepickerTitles.to}}\"></h5>' +\n                                    '<div uib-datepicker ng-model=\"data.date.to\" min-date=\"data.date.from\" max-date=\"data.date.max\" show-weeks=\"false\" class=\"clean-calendar\" datepicker-options=\"{minDate: data.date.from, maxDate: data.date.max, showWeeks: false, startingDay: 1}\"></div>' +\n                                '</div>' +\n                            '</div>' +\n                            '<div class=\"rg-range-picker-slider\" id=\"rgRangePickerSliderContainer\" ng-show=\"data.hasTimeSliders\">' +\n                                '<div class=\"rg-range-picker-slider-labels\">' +\n                                    '<div class=\"row\">' +\n                                        '<div class=\"rg-range-picker-divider xs-hidden\"><span class=\"label\">to</span></div>' +\n                                        '<div class=\"col-xs-6 text-center\"><span class=\"label label-range-picker\">{{data.time.from | rgTime:data.time.hours24}}</span></div>' +\n                                        '<div class=\"col-xs-6 text-center\"><span class=\"label label-range-picker\">{{data.time.to | rgTime:data.time.hours24}}</span></div>' +\n                                    '</div>' +\n                                '</div>' +\n                            '</div>' +\n                        '</div>' +\n                    '</div>';\n\nbefore i messed with it...\n\n                    */\n\n            return '<div class=\"rg-range-picker\" ng-class=\"{\\'rg-range-picker-vertical\\':vertical}\">' +\n                        '<div class=\"rg-range-picker-box well\" ng-class=\"{ \\'only-calendars\\': !data.hasTimeSliders, \\'only-slider\\': !data.hasDatePickers }\">' +\n                            '<div class=\"rg-range-picker-calendars\" ng-show=\"data.hasDatePickers\">' +\n                                '<div class=\"rg-range-picker-calendar-box\">' +\n                                    '<h5 class=\"rg-range-picker-calendar-label\" ng-bind-template=\"{{datepickerTitles.from}}\"></h5>' +\n                                    '<div uib-datepicker ng-model=\"data.date.from\" max-date=\"data.date.to\" min-date=\"data.date.min\" show-weeks=\"false\" class=\"clean-calendar\" datepicker-options=\"{minDate: data.date.min, showWeeks: false, startingDay: 1}\"></div>' +\n                                '</div>' +\n                                '<div class=\"rg-range-picker-calendar-box right\">' +\n                                    '<h5 class=\"rg-range-picker-calendar-label\" ng-bind-template=\"{{datepickerTitles.to}}\"></h5>' +\n                                    '<div uib-datepicker ng-model=\"data.date.to\" min-date=\"data.date.from\" max-date=\"data.date.max\" show-weeks=\"false\" class=\"clean-calendar\" datepicker-options=\"{minDate: data.date.from, maxDate: data.date.max, showWeeks: false, startingDay: 1}\"></div>' +\n                                '</div>' +\n                            '</div>' +\n                            '<div class=\"rg-range-picker-slider\" id=\"rgRangePickerSliderContainer\" ng-show=\"data.hasTimeSliders\">' +\n                                '<div class=\"rg-range-picker-slider-labels\">' +\n                                    '<div class=\"row\">' +\n                                        '<div class=\"rg-range-picker-divider xs-hidden\"><span class=\"label\">to</span></div>' +\n                                        '<div class=\"col-xs-6 text-center\"><span class=\"label label-range-picker\">{{data.time.from | rgTime:data.time.hours24}}</span></div>' +\n                                        '<div class=\"col-xs-6 text-center\"><span class=\"label label-range-picker\">{{data.time.to | rgTime:data.time.hours24}}</span></div>' +\n                                    '</div>' +\n                                '</div>' +\n                            '</div>' +\n                        '</div>' +\n                    '</div>';\n        },\n\n        link: function(scope, element, attrs) {\n            // define labels\n            var\n                sliderMinWidth      = 400,// if directive is less width than 500, then display responsive version\n                sliderContainer     = angular.element('#rgRangePickerSliderContainer', element[0]),\n                slider              = angular.element( '<div slider class=\"clean-slider\" ng-model=\"data.time.from\" ng-model-range=\"data.time.to\" floor=\"{{data.time.dFrom}}\" ceiling=\"{{data.time.dTo}}\" buffer=\"{{data.time.minRange || 1}}\" step=\"{{data.time.step || 1}}\" step-width=\"{{data.time.step || 1}}\" precision=\"0\" stretch=\"3\"></div>' ),\n                sliderAlreadyRender = false,\n                defaultLabels = {\n                    date: {\n                        from: 'START_DATE',\n                        to: 'END_DATE'\n                    }\n                },\n                timeDefaults = {\n                    from: 480, // default low value\n                    to: 1020, // default high value\n                    dFrom: 0, // lowest integer\n                    dTo: 1440, // highest integer\n                    step: 15, // step width\n                    minRange: 15, // min range\n                    hours24: true // true for 00:00:00 format and false for 00:00 am or pm\n                },\n                dateDefaults = {\n                    from: new Date(),\n                    to: new Date(),\n                    min: null,\n                    max: null\n                },\n                timeChangePromise;\n\n            scope.data.hasDatePickers = angular.isObject(scope.data.date);\n            scope.data.hasTimeSliders = angular.isObject(scope.data.time);\n            scope.datepickerTitles = angular.extend(defaultLabels.date, scope.labels && scope.labels.date ); // set labels for date pickers\n\n            if (scope.data.hasDatePickers) {\n                scope.data.date = angular.extend(dateDefaults, scope.data.date);\n            }\n            if (scope.data.hasTimeSliders) {\n                scope.data.time = angular.extend(timeDefaults, scope.data.time);\n            }\n\n            function renderSlider () {\n                if(!sliderAlreadyRender && scope.data.hasTimeSliders) {\n                    sliderContainer.append( slider );\n                    $compile( slider )( scope );\n                    sliderAlreadyRender = true;\n\n                    /**\n                     * Responsive fix\n                     */\n                    if ( element.width() <= sliderMinWidth ) {\n                        angular.element( '.rg-range-picker', element[0]).addClass('rg-range-picker-responsive');\n                    }\n                }\n            }\n\n            if ( attrs.collapse ) {\n                scope.$watch( function() {\n                    return element[0].className;\n                }, function() {\n                    if(element.hasClass('in')) {\n                        // render slider\n                        renderSlider();\n                    }\n                });\n            } else {\n                renderSlider();\n            }\n\n            /**\n             * Trigger event when user change slide range\n             */\n            function timeChanges (newValue, oldValue) {\n                if ( !angular.isUndefined(timeChangePromise) ) {\n                                            console.log(\"update the datetime field I guess? : \"+scope.data.time.from);\n\n                    $timeout.cancel(timeChangePromise);\n\n                }\n                if ( newValue !== oldValue ) {\n                    timeChangePromise = $timeout( function(){\n\n                        console.log(\"update the datetime field I guess? : \"+scope.data.time.from);\n\n                        scope.onTimeChange()({\n                            from: $filter('rgTime')(scope.data.time.from, true),\n                            to: $filter('rgTime')(scope.data.time.to, true),\n                            range: $filter('rgTime')( scope.data.time.to - scope.data.time.from , true)\n                        });\n\n                    }, 500);\n                }\n            }\n            if ( !angular.isUndefined(scope.onTimeChange()) && scope.data.hasTimeSliders ) {\n                scope.$watch('data.time.from', timeChanges);\n                scope.$watch('data.time.to', timeChanges);\n            }\n            /**\n             * Max Range Date functionality\n             */\n            var\n                maxRange = ((scope.maxRangeDate && scope.maxRangeDate - 1) || 0) * 86400000, // 86400000 miliseconds a day\n                superMaxDate = scope.data.date && scope.data.date.max && scope.data.date.max.getTime(), // miliseconds\n                superMinDate = scope.data.date && scope.data.date.min && scope.data.date.min.getTime(); // miliseconds\n\n            function updateMinAndMaxDate() {\n                var\n                    currentRange = scope.data.date.to.getTime() - scope.data.date.from.getTime(),\n                    offset = maxRange - currentRange,\n                    _min = (scope.data.date.from.getTime() - offset) < superMinDate ? superMinDate : scope.data.date.from.getTime() - offset, // miliseconds\n                    _max = (scope.data.date.to.getTime() + offset) > superMaxDate ? superMaxDate : (scope.data.date.to.getTime() + offset); // miliseconds\n\n\n                // set min date\n                scope.data.date.min = new Date(_min);\n                // set max date\n                scope.data.date.max = new Date(_max);\n            }\n\n            function updateEndDate(){\n                // console.log(\"watch is good\");\n                if(scope.data.date.from > scope.data.date.to){\n                    // console.log(\"HELLO CHANGE ME PLEASE\");\n                    var y = scope.data.date.from.getFullYear();\n                    var m = scope.data.date.from.getMonth();\n                    var d = scope.data.date.from.getDate();\n                    var h = Math.floor( scope.data.time.to / 60);          \n                    var i = scope.data.time.to % 60;\n                    // console.log(scope.data.time.to);\n                    // console.log(scope.data.date.from);\n\n                    // console.log(y+\", \"+m+\", \"+d+\", \"+h+\", \"+i+\", 0\");\n                    // console.log(new Date(y, m, d, h, i, 0));\n\n                    scope.data.date.to = new Date(y, m, d, h, i, 0);\n                }\n            }\n\n            // if( scope.overridePicker ){\n                // console.log(\"yes\");\n                scope.$watch('data.date.from', updateEndDate);\n            // }\n\n            if ( scope.maxRangeDate && scope.data.hasDatePickers ) {\n                scope.$watch('data.date.from', updateMinAndMaxDate);\n                scope.$watch('data.date.to', updateMinAndMaxDate);\n            }\n        },\n\n        controller: function($scope, $element, $attrs) {\n        }\n    };\n}]);\n// /*\n// *  AngularJs Fullcalendar Wrapper for the JQuery FullCalendar\n// *  API @ http://arshaw.com/fullcalendar/\n// *\n// *  Angular Calendar Directive that takes in the [eventSources] nested array object as the ng-model and watches it deeply changes.\n// *       Can also take in multiple event urls as a source object(s) and feed the events per view.\n// *       The calendar will watch any eventSource array and update itself when a change is made.\n// *\n// */\n\n\n\n\n\nangular.module('ui.calendar', [])\n  .constant('uiCalendarConfig', {calendars: {}})\n  .controller('uiCalendarCtrl', ['$scope',\n                                 '$locale', function(\n                                  $scope,\n                                  $locale){\n                                   \n\n      var sources = $scope.eventSources,\n          extraEventSignature = $scope.calendarWatchEvent ? $scope.calendarWatchEvent : angular.noop,\n\n          wrapFunctionWithScopeApply = function(functionToWrap){\n              return function(){\n                  // This may happen outside of angular context, so create one if outside.\n\n                  if ($scope.$root.$$phase) {\n                      return functionToWrap.apply(this, arguments);\n                  } else {\n                      var args = arguments;\n                      var self = this;\n                      return $scope.$root.$apply(function(){\n                          return functionToWrap.apply(self, args);\n                      });\n                  }\n              };\n          };\n\n      var eventSerialId = 1;\n      // @return {String} fingerprint of the event object and its properties\n      this.eventFingerprint = function(e) {\n        if (!e._id) {\n          e._id = eventSerialId++;\n        }\n        // This extracts all the information we need from the event. http://jsperf.com/angular-calendar-events-fingerprint/3\n        return \"\" + e._id + (e.id || '') + (e.title || '') + (e.url || '') + (+e.start || '') + (+e.end || '') +\n          (e.allDay || '') + (e.className || '') + extraEventSignature({event: e}) || '';\n      };\n\n      var sourceSerialId = 1, sourceEventsSerialId = 1;\n      // @return {String} fingerprint of the source object and its events array\n      this.sourceFingerprint = function(source) {\n          var fp = '' + (source.__id || (source.__id = sourceSerialId++)),\n              events = angular.isObject(source) && source.events;\n          if (events) {\n              fp = fp + '-' + (events.__id || (events.__id = sourceEventsSerialId++));\n          }\n          return fp;\n      };\n\n      // @return {Array} all events from all sources\n      this.allEvents = function() {\n        // do sources.map(&:events).flatten(), but we don't have flatten\n        var arraySources = [];\n        for (var i = 0, srcLen = sources.length; i < srcLen; i++) {\n          var source = sources[i];\n          if (angular.isArray(source)) {\n            // event source as array\n            arraySources.push(source);\n          } else if(angular.isObject(source) && angular.isArray(source.events)){\n            // event source as object, ie extended form\n            var extEvent = {};\n            for(var key in source){\n              if(key !== '_id' && key !== 'events'){\n                 extEvent[key] = source[key];\n              }\n            }\n            for(var eI = 0;eI < source.events.length;eI++){\n              angular.extend(source.events[eI],extEvent);\n            }\n            arraySources.push(source.events);\n          }\n        }\n        return Array.prototype.concat.apply([], arraySources);\n      };\n\n      // Track changes in array of objects by assigning id tokens to each element and watching the scope for changes in the tokens\n      // @param {Array|Function} arraySource array of objects to watch\n      // @param tokenFn {Function} that returns the token for a given object\n      // @return {Object}\n      //  subscribe: function(scope, function(newTokens, oldTokens))\n      //    called when source has changed. return false to prevent individual callbacks from firing\n      //  onAdded/Removed/Changed:\n      //    when set to a callback, called each item where a respective change is detected\n      this.changeWatcher = function(arraySource, tokenFn) {\n        var self;\n        var getTokens = function() {\n          var array = angular.isFunction(arraySource) ? arraySource() : arraySource;\n          var result = [], token, el;\n          for (var i = 0, n = array.length; i < n; i++) {\n            el = array[i];\n            token = tokenFn(el);\n            map[token] = el;\n            result.push(token);\n          }\n          return result;\n        };\n\n        // @param {Array} a\n        // @param {Array} b\n        // @return {Array} elements in that are in a but not in b\n        // @example\n        //  subtractAsSets([6, 100, 4, 5], [4, 5, 7]) // [6, 100]\n        var subtractAsSets = function(a, b) {\n          var result = [], inB = {}, i, n;\n          for (i = 0, n = b.length; i < n; i++) {\n            inB[b[i]] = true;\n          }\n          for (i = 0, n = a.length; i < n; i++) {\n            if (!inB[a[i]]) {\n              result.push(a[i]);\n            }\n          }\n          return result;\n        };\n\n        // Map objects to tokens and vice-versa\n        var map = {};\n\n        // Compare newTokens to oldTokens and call onAdded, onRemoved, and onChanged handlers for each affected event respectively.\n        var applyChanges = function(newTokens, oldTokens) {\n          var i, n, el, token;\n          var replacedTokens = {};\n          var removedTokens = subtractAsSets(oldTokens, newTokens);\n          for (i = 0, n = removedTokens.length; i < n; i++) {\n            var removedToken = removedTokens[i];\n            el = map[removedToken];\n            delete map[removedToken];\n            var newToken = tokenFn(el);\n            // if the element wasn't removed but simply got a new token, its old token will be different from the current one\n            if (newToken === removedToken) {\n              self.onRemoved(el);\n            } else {\n              replacedTokens[newToken] = removedToken;\n              self.onChanged(el);\n            }\n          }\n\n          var addedTokens = subtractAsSets(newTokens, oldTokens);\n          for (i = 0, n = addedTokens.length; i < n; i++) {\n            token = addedTokens[i];\n            el = map[token];\n            if (!replacedTokens[token]) {\n              self.onAdded(el);\n            }\n          }\n        };\n        return self = {\n          subscribe: function(scope, onArrayChanged) {\n            scope.$watch(getTokens, function(newTokens, oldTokens) {\n              var notify = !(onArrayChanged && onArrayChanged(newTokens, oldTokens) === false);\n              if (notify) {\n                applyChanges(newTokens, oldTokens);\n              }\n            }, true);\n          },\n          onAdded: angular.noop,\n          onChanged: angular.noop,\n          onRemoved: angular.noop\n        };\n      };\n\n      this.getFullCalendarConfig = function(calendarSettings, uiCalendarConfig){\n          var config = {};\n\n          angular.extend(config, uiCalendarConfig);\n          angular.extend(config, calendarSettings);\n\n          angular.forEach(config, function(value,key){\n            if (typeof value === 'function'){\n              config[key] = wrapFunctionWithScopeApply(config[key]);\n            }\n          });\n\n          return config;\n      };\n\n    this.getLocaleConfig = function(fullCalendarConfig) {\n      if (!fullCalendarConfig.lang || fullCalendarConfig.useNgLocale) {\n        // Configure to use locale names by default\n        var tValues = function(data) {\n          // convert {0: \"Jan\", 1: \"Feb\", ...} to [\"Jan\", \"Feb\", ...]\n          var r, k;\n          r = [];\n          for (k in data) {\n            r[k] = data[k];\n          }\n          return r;\n        };\n        var dtf = $locale.DATETIME_FORMATS;\n        return {\n          monthNames: tValues(dtf.MONTH),\n          monthNamesShort: tValues(dtf.SHORTMONTH),\n          dayNames: tValues(dtf.DAY),\n          dayNamesShort: tValues(dtf.SHORTDAY)\n        };\n      }\n      return {};\n    };\n  }])\n  .directive('uiCalendar', ['uiCalendarConfig', function(uiCalendarConfig) {\n    return {\n      restrict: 'A',\n      scope: {eventSources:'=ngModel',calendarWatchEvent: '&'},\n      controller: 'uiCalendarCtrl',\n      link: function(scope, elm, attrs, controller) {\n\n        var sources = scope.eventSources,\n            sourcesChanged = false,\n            calendar,\n            eventSourcesWatcher = controller.changeWatcher(sources, controller.sourceFingerprint),\n            eventsWatcher = controller.changeWatcher(controller.allEvents, controller.eventFingerprint),\n            options = null;\n\n        function getOptions(){\n          var calendarSettings = attrs.uiCalendar ? scope.$parent.$eval(attrs.uiCalendar) : {},\n              fullCalendarConfig;\n\n          fullCalendarConfig = controller.getFullCalendarConfig(calendarSettings, uiCalendarConfig);\n\n          var localeFullCalendarConfig = controller.getLocaleConfig(fullCalendarConfig);\n          angular.extend(localeFullCalendarConfig, fullCalendarConfig);\n          options = { eventSources: sources };\n          angular.extend(options, localeFullCalendarConfig);\n          //remove calendars from options\n          options.calendars = null;\n\n          var options2 = {};\n          for(var o in options){\n            if(o !== 'eventSources'){\n              options2[o] = options[o];\n            }\n          }\n          return JSON.stringify(options2);\n        }\n\n        scope.destroy = function(){\n          if(calendar && calendar.fullCalendar){\n            calendar.fullCalendar('destroy');\n          }\n          if(attrs.calendar) {\n            calendar = uiCalendarConfig.calendars[attrs.calendar] = $(elm).html('');\n          } else {\n            calendar = $(elm).html('');\n          }\n        };\n\n        scope.init = function(){\n          calendar.fullCalendar(options);\n          if(attrs.calendar) {\n            uiCalendarConfig.calendars[attrs.calendar] = calendar;\n          }\n        };\n\n        eventSourcesWatcher.onAdded = function(source) {\n          calendar.fullCalendar('addEventSource', source);\n          sourcesChanged = true;\n        };\n\n        eventSourcesWatcher.onRemoved = function(source) {\n          calendar.fullCalendar('removeEventSource', source);\n          sourcesChanged = true;\n        };\n\n        eventSourcesWatcher.onChanged = function(source) {\n          calendar.fullCalendar('refetchEvents');\n          sourcesChanged = true;\n        };\n\n        eventsWatcher.onAdded = function(event) {\n          calendar.fullCalendar('renderEvent', event, (event.stick ? true : false));\n        };\n\n        eventsWatcher.onRemoved = function(event) {\n          calendar.fullCalendar('removeEvents', event._id);\n        };\n\n        eventsWatcher.onChanged = function(event) {\n          var clientEvents = calendar.fullCalendar('clientEvents', event._id);\n          for (var i = 0; i < clientEvents.length; i++) {\n            var clientEvent = clientEvents[i];\n            clientEvent = angular.extend(clientEvent, event);\n            calendar.fullCalendar('updateEvent', clientEvent);\n          }\n        };\n\n        eventSourcesWatcher.subscribe(scope);\n        eventsWatcher.subscribe(scope, function() {\n          if (sourcesChanged === true) {\n            sourcesChanged = false;\n            // return false to prevent onAdded/Removed/Changed handlers from firing in this case\n            return false;\n          }\n        });\n\n        scope.$watch(getOptions, function(newO,oldO){\n            scope.destroy();\n            scope.init();\n        });\n      }\n    };\n}]);\n\n\n\n  /*\n\n  GETTING READY FOR v6 --> events were not pushed to it - but no failures!!\n\n  angular.module('ui.calendar', [])\n  .constant('uiCalendarConfig', { calendars: {} })\n  .controller('uiCalendarCtrl', ['$scope', function($scope) {\n    var eventSerialId = 1;\n    var sourceSerialId = 1;\n    \n    this.eventFingerprint = function(e) {\n      if (!e._id) {\n        e._id = eventSerialId++;\n      }\n      return `${e._id}${e.id || ''}${e.title || ''}${+e.start || ''}${+e.end || ''}${e.allDay || ''}${e.className || ''}`;\n    };\n\n    this.sourceFingerprint = function(source) {\n      if (!source.__id) {\n        source.__id = sourceSerialId++;\n      }\n      return `${source.__id}`;\n    };\n\n    this.changeWatcher = function(arraySource, tokenFn) {\n      var self;\n      var map = {};\n      \n      var getTokens = function() {\n        var array = angular.isFunction(arraySource) ? arraySource() : arraySource;\n        var result = [], token, el;\n        for (var i = 0, n = array.length; i < n; i++) {\n          el = array[i];\n          token = tokenFn(el);\n          map[token] = el;\n          result.push(token);\n        }\n        return result;\n      };\n\n      var applyChanges = function(newTokens, oldTokens) {\n        var removedTokens = oldTokens.filter(t => !newTokens.includes(t));\n        removedTokens.forEach(token => self.onRemoved(map[token]));\n        \n        var addedTokens = newTokens.filter(t => !oldTokens.includes(t));\n        addedTokens.forEach(token => self.onAdded(map[token]));\n      };\n      \n      return self = {\n        subscribe: function(scope, onArrayChanged) {\n          scope.$watch(getTokens, function(newTokens, oldTokens) {\n            if (onArrayChanged && onArrayChanged(newTokens, oldTokens) === false) {\n              return;\n            }\n            applyChanges(newTokens, oldTokens);\n          }, true);\n        },\n        onAdded: angular.noop,\n        onRemoved: angular.noop,\n        onChanged: angular.noop\n      };\n    };\n  }])\n  .directive('uiCalendar', ['uiCalendarConfig', function(uiCalendarConfig) {\n    return {\n      restrict: 'A',\n      scope: {\n        eventSources: '=ngModel',\n        options: '='\n      },\n      controller: 'uiCalendarCtrl',\n      link: function(scope, element, attrs, controller) {\n        var calendar;\n        \n        function renderCalendar() {\n          if (calendar) {\n            calendar.destroy();\n          }\n          var config = angular.copy(scope.options) || {};\n          config.events = scope.eventSources || [];\n          config.schedulerLicenseKey = \"CC-Attribution-NonCommercial-NoDerivatives\";\n          calendar = new FullCalendar.Calendar(element[0], config);\n          calendar.render();\n        }\n\n        var eventWatcher = controller.changeWatcher(scope.eventSources, controller.eventFingerprint);\n        eventWatcher.onAdded = function(event) {\n          calendar.addEvent(event);\n        };\n        eventWatcher.onRemoved = function(event) {\n          calendar.getEventById(event.id)?.remove();\n        };\n        eventWatcher.onChanged = function(event) {\n          var existingEvent = calendar.getEventById(event.id);\n          if (existingEvent) {\n            existingEvent.setProp('title', event.title);\n            existingEvent.setStart(event.start);\n            existingEvent.setEnd(event.end);\n          }\n        };\n\n        var sourceWatcher = controller.changeWatcher(scope.eventSources, controller.sourceFingerprint);\n        sourceWatcher.onAdded = function(source) {\n          calendar.addEventSource(source);\n        };\n        sourceWatcher.onRemoved = function(source) {\n          calendar.getEventSources().forEach(eventSource => {\n            if (eventSource === source) {\n              eventSource.remove();\n            }\n          });\n        };\n        sourceWatcher.onChanged = function(source) {\n          calendar.refetchEvents();\n        };\n\n        eventWatcher.subscribe(scope);\n        sourceWatcher.subscribe(scope);\n\n        scope.$watchGroup(['options'], function() {\n          renderCalendar();\n        }, true);\n      }\n    };\n  }]);\n\n  */"],"file":"directives.ann.js"}