<div class="centre_align_boxes2">


      <div class="home_upper btn_top_space">
          <div class="welcome_title">
            <h2>MAKE A SALE</h2> 
            <h4 class="capitalise">
              Bill your customers
            </h4>
          </div>
      </div>

<div class="sub_section2">
<div class="club_docs_all">

      <h2>Create an Invoice</h2>
      <div class="center_if_large">

             

              <div class="card center_if_large bookingout_wrapper nopadding">


                  <uib-tabset active="active">
                    <uib-tab index="0" heading="SHOP ITEM" class="simple_border">
                        
                      <div class="tab_wrapper">
                        <table class="vertical_1 noborder">
                          <tr>
                            <td>  
                              <span>Select A Shop Item</span>
                            </td>
                            <td>
                               <ui-select class="adding_item_select" ng-model="selected_item" theme="bootstrap" ng-change="item_selected(selected_item)" title="Select an item" append-to-body="true">
                                <ui-select-match placeholder="Select an item" allow-clear="false" >
                                  {{ selected_item.title }} {{ club_settings.account_currency }}{{selected_item.price}}            
                                </ui-select-match>
                                <ui-select-choices repeat="item in vm.shop_items | propsFilterA: {title: $select.search, description: $select.search,  id: $select.search}">
                                  <div ng-bind-html="item.title | highlight: $select.search"></div>
                                  <small> {{ club_settings.account_currency }}{{item.price}}</small>
                                </ui-select-choices>
                              </ui-select>
                            </td>
                            <td>
                              Quantity: <input type="number" default="1" class="small_qty" ng-model="vm.new_item_qty" />
                            </td>
                            <td>
                              
                              <button class="btn btn-success club_add_button" ng-click="add_selected_item()">ADD ITEM</button>

                            </td>
                          </tr>
                        </table>
                      </div>

                    </uib-tab>
                    <uib-tab index="1" heading="CUSTOM ITEM">
                        <!-- to disable disable="tab.disabled" || select="alertMe()" to have a callback -->
                        <div class="tab_wrapper">

                          <div class="form-group">
                            <label for="item">Item Name</label>
                            <input type="text" id="item" ng-model="item.title" class="form-control inputtext" />
                          </div>

                          <div class="form-group">
                            <label for="defect">Quantity</label>
                            <input type="number" value="1" step="0.01" class="form-control inputtext" ng-model="item.quantity">
                           </div>

                          <div class="form-group">
                            <label for="defect" uib-tooltip="Inclusive of any VAT">Price (individual) {{ club_settings.account_currency }}</label>
                            <input type="number" step="0.01" class="form-control inputtext" ng-model="item.price">
                           </div>

                          <div class="form-group">
                            <label ng-if="club_settings.vat_registered" for="vat">VAT rate %</label>
                            <input type="number" ng-if="club_settings.vat_registered" name="vatfree" ng-model="item.vat" default="club_settings.vat_rate" length="2" class="form-control inputtext" />
                          </div>
                           

                           <button class="btn btn-success club_add_button" ng-click="add_item(item)">ADD ITEM</button>
                         </div>

                    </uib-tab>
                    <uib-tab index="3">
                      <uib-tab-heading>
                        PACKAGES
                      </uib-tab-heading>
                      <div class="tab_wrapper">

                        <div class="tab_wrapper">
                          <table class="vertical_1 noborder">
                            <tr>
                              <td>  
                                <span>Select A Package</span>
                              </td>
                              <td>
                                 <ui-select class="adding_item_select" ng-model="selected_package" theme="bootstrap" ng-change="package_selected(selected_package)" title="Select an item" append-to-body="true">
                                  <ui-select-match placeholder="Select an item" allow-clear="false" >
                                    {{ selected_package.title }} {{ club_settings.account_currency }}{{selected_package.price}}            
                                  </ui-select-match>
                                  <ui-select-choices repeat="item in vm.packages | propsFilterA: {title: $select.search, description: $select.search,  id: $select.search}">
                                    <div ng-bind-html="item.title | highlight: $select.search"></div>
                                    <small>{{ club_settings.account_currency }} {{item.price}}</small>
                                  </ui-select-choices>
                                </ui-select>
                              </td>
                              
                              <td>
                                
                                <button class="btn btn-success club_add_button" ng-click="add_selected_package()">ADD PACKAGE</button>

                              </td>
                            </tr>
                          </table>
                        </div>

                      </div>
                    </uib-tab>
                    <uib-tab index="4">
                      <uib-tab-heading>
                        VOUCHERS
                      </uib-tab-heading>
                      <div class="tab_wrapper">

                        <table class="vertical_1 noborder">
                            <tr>
                              <td>  
                                <span>Select A Voucher</span>
                              </td>
                              <td>
                                 <ui-select class="adding_item_select" ng-model="vm.selected_voucher" theme="bootstrap" ng-change="vm.voucher_selected(vm.selected_voucher)" title="Select a voucher" append-to-body="true">
                                  <ui-select-match placeholder="Select an voucher" allow-clear="false" >
                                    {{ vm.selected_voucher.title }} {{ club_settings.account_currency }}{{vm.selected_voucher.price}}            
                                  </ui-select-match>
                                  <ui-select-choices repeat="item in vm.vouchers | propsFilterA: {title: $select.search, description: $select.search,  id: $select.search}">
                                    <div ng-bind-html="item.title | highlight: $select.search"></div>
                                    <small>{{ club_settings.account_currency }} {{item.price}}</small>
                                  </ui-select-choices>
                                </ui-select>
                              </td>
                              
                              <td>
                                
                                <button class="btn btn-success club_add_button" ng-click="vm.add_selected_voucher()">ADD VOUCHER</button>

                              </td>
                            </tr>
                            <tr ng-if="vm.selected_voucher && vm.discounts.length > 0">
                              <td>  
                                <span>Apply Discount</span>
                              </td>
                              <td>
                                 <ui-select class="adding_item_select" ng-model="vm.selected_discount" theme="bootstrap" ng-change="vm.discount_selected(vm.selected_discount)" title="Select a discount" append-to-body="true">
                                  <ui-select-match placeholder="Select a discount code" allow-clear="false" >
                                    {{ vm.selected_discount.discount_code }} : {{ (vm.selected_discount.discount_type == 1)? club_settings.account_currency +""+vm.selected_discount.price : vm.selected_discount.percentage+"% OFF"}}<!--  <i ng-if="vm.selected_discount.discount_type == 1">{{ club_settings.account_currency }}{{vm.selected_discount.price}}  </i><i ng-if="vm.selected_discount.discount_type == 2">{{vm.selected_discount.percentage}}% OFF </i>  -->         
                                  </ui-select-match>
                                  <ui-select-choices repeat="item in vm.discounts | propsFilterA: {title: $select.search, description: $select.search,  id: $select.search}">
                                    <div ng-bind-html="item.discount_code | highlight: $select.search"></div>
                                    <small><span ng-if="item.discount_type == 1">{{ club_settings.account_currency }}{{item.price}}  </span><span ng-if="item.discount_type == 2">{{item.percentage}}% OFF </span>  </small>
                                  </ui-select-choices>
                                </ui-select>
                              </td>
                              
                              <td>
                                
                                <button class="btn btn-success club_add_button" ng-click="vm.add_selected_discount()">APPLY DISCOUNT</button>

                              </td>
                            </tr>
                        </table>




                      </div>
                    </uib-tab>
                  </uib-tabset>






              <!--   <div ng-if="!vm.custom_item">

                </div>

                <div class="receipt" ng-if="vm.custom_item">
                  
                </div>
                <button class="btn btn-primary club_add_button" ng-click="vm.custom_item = !vm.custom_item">{{ (!vm.custom_item) ? 'CREATE A CUSTOM ITEM' : 'ADD AN EXISTING SHOP ITEM' }}</button> -->

              </div>
            </div>
          </div>

          <div class="club_docs_all">

            <h2>Invoice</h2>
             <div class="no_defects btn_top_space" ng-if="items && items.length < 1">
               Please add the items you wish to charge your client.
              </div>


              <div class="card">

                <table ng-if="items && items.length > 0">
                  <tr>
                    <th>
                      Item
                    </th>
                    <th>
                      Unit Price
                    </th>
                    <th>
                      Quantity
                    </th>
                    <th ng-if="club_settings.vat_registered">
                      VAT RATE
                    </th>
                    <th>
                      Total
                    </th>
                    <th>
                      Edit
                    </th>
                  </tr>
                  <tr ng-repeat="item in items track by $index">
                    <td>
                      {{ item.title }}
                      <small ng-if="item.discount_id > 0"><br />{{ (item.discount_id > 0)? "("+item.discount_code+" applied)" : 'discount applied'}}</small>
                    </td>
                    <td>
                      {{ club_settings.account_currency }}{{ item.price }}
                    </td>
                    <td>
                      {{ item.quantity }}
                    </td>
                    <td ng-if="club_settings.vat_registered">
                      <!-- <input type="number" name="vat_rate" ng-model="item.vat" default="club_settings.vat_rate" length="2" /> -->{{ item.vat || '0' }}%
                    </td>
                     <td>
                      {{ club_settings.account_currency }} {{ item.total | number:2 }}
                    </td>
                    <td>
                      <button ng-click="delete_receipt($index)">Delete Item</button>
                    </td>
                  </tr>
                  <tr ng-if="items.length > 0 && club_settings.vat_registered" style="border-top: double solid #ccc" class="total_line bold_text">
                    <td>
                     <b>VAT </b>
                    </td>
                     <td colspan="3">
                      &nbsp;
                    </td>
                    <td ng-if="club_settings.vat_registered">
                    </td>
                     <td>
                      <b>{{ club_settings.account_currency }}{{ the_vat | number:2 }}</b>
                    </td>
                  
                  </tr>
                  <tr ng-if="items.length > 0" class="total_line bold_text">
                    <td>
                      INVOICE TOTAL 
                    </td>
                    <td colspan="3">
                      &nbsp;
                    </td>
                    <td ng-if="club_settings.vat_registered">
                    </td>
                     <td>
                      {{ club_settings.account_currency }}{{ the_total | number:2 }}
                    </td>
                  
                  </tr>
                </table>

              </div>

          </div>



          <div class="club_docs_all">

                <h2>Payment</h2>
              <div class="card center_if_large bookingout_wrapper nopadding">


                <div class="card receipt whom_to_charge">

                   <div class="form-group">
                    <label for="instructor">Select Member</label>
                    <ui-select ng-model="selected_client" theme="bootstrap" ng-change="member_selected(selected_client)" title="Select a Member" append-to-body="true">
                      <ui-select-match placeholder="Please select the member" allow-clear="true" >
                        {{ selected_client.first_name }}             
                        {{ selected_client.last_name }}
                      </ui-select-match>
                      <ui-select-choices repeat="client in members | propsFilterA: {first_name: $select.search, last_name: $select.search,  id: $select.search}">
                        <span ng-bind-html="client.first_name | highlight: $select.search"></span>
                        <span ng-bind-html="client.last_name | highlight: $select.search"></span>               
                      </ui-select-choices>
                    </ui-select>
                  </div>

                  <form id="payment-form">

                    <div ng-if="selected_client.id == -12">
                      <div class="form-group">
                        <label for="fname">First Name</label>
                        <input type="text" id="fname" class="form-control inputtext" ng-model="new_client.first_name" />
                      </div>
                      <div class="form-group">
                        <label for="lname">Last Name</label>
                        <input type="text" id="lname" class="form-control inputtext" ng-model="new_client.last_name" />
                      </div>
                      <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" class="form-control inputtext" ng-model="new_client.email" />
                      </div>
                    </div>

                  </form>
                  
                    <!-- <div ng-if="selected_client.id > 0">
                       <div class="form-group">
                          <ui-select ng-model="selected_card" theme="bootstrap" ng-change="card_selected(selected_card)" style="min-width: 500px;" title="Select a Card" append-to-body="true">
                            <ui-select-match placeholder="Please select a card" allow-clear="true" >
                              {{ selected_card.brand }} - ending:              
                              {{ selected_card.last4 }}
                            </ui-select-match>
                            <ui-select-choices repeat="card in cards | propsFilter: {brand: $select.search, last4: $select.search,  id: $select.search}">
                              <span ng-bind-html="card.brand | highlight: $select.search"></span>
                              <span ng-bind-html="card.last4 | highlight: $select.search"></span>               
                            </ui-select-choices>
                          </ui-select>
                        </div>
                    </div> -->
                    


                    <!-- THIS WAS WORKING UNTIL 14/11/2025 -->
                    <!-- <div ng-if="show_direct_debit_details">
                      <div class="cards2">
                          <span class="bold">Account Name:</span>{{ selected_client.account_name }}
                          <br />
                          <span class="bold">Bank:</span>{{ selected_client.account_bank }}
                          <br />
                          <span class="bold">Account:</span>****{{ selected_client.account_ending }}
                          <br />
                          <span class="bold">Reference:</span>{{ selected_client.mandate_reference }}
                          <br />

                          
                        </div>

                        <div class="form-group">
                          <label for="pay_now" uib-tooltip="I would like to charge this client immediately, and not combined this with other invoices which may have been raised during the current billing cycle.">Charge immediately</label>
                          <div class="check_box_in_form">
                            <input type="checkbox" class="form-control" ng-model="vm.direct_debit_pay_now" />
                          </div>
                        </div>
                    </div>

                    <div ng-if="selected_client.id == -12 || !show_direct_debit_details">

                      <div class="cards2">
                            <h5>Coming Soon...</h5>
                            <p>The ability to pay for any client through Stripe's interface to take payments</p>
                        </div>

                          <div id="payment-form2" style="opacity: 0">
                              <div class="form-row">
                                  <div class="group">
                                      <label for="card-element">
                                          Credit or debit card
                                          <div id="card-element" class="field">
                                          </div>
                                      </label>
                                  </div>
                              <div id="card-errors" role="alert"></div>
                            </div>
                          </div>

                    </div> -->



<!--                     NEW PAYMENT FORM HERE - NEED TO FIGURE OUT WHEN TO CREATE THE INVOICE / WHEN TO ADD IT
 -->




                 
                </div>
                  
            </div>


      </div>

          <div class="btns_bottom">

            <button class="btn btn-primary btn_bigger" type="button" ng-click="cancel()">CANCEL</button>
            <button class="btn btn-danger btn_bigger" type="button" ng-click="ok()">PAY NOW</button>
          </div>
</div>     




        </div>
            

<div ng-if="vm.show_loading" class="positioning-container2">
  <div class="airplane_center_loading">Loading...</div>
  <div class="spinning-container">
  <div class="airplane-container">
    <span class="fa fa-plane fa-2x"></span>
  </div>
  </div>
</div>


<div ng-if="vm.show_pay_now" class="positioning-container">
  <div class="centre_pay_now">
   
    <!--   <div class="club_docs_all">
            <h2>Pay Invoice Now</h2> -->

            <div class="payment-accordion">
                  <div class="pa-container">
                    <h1 class="pa-title">Choose a payment method</h1>
                    <!-- <p class="pa-hint">Select one option below.</p> -->
                  
                    <payment-accordion
                      methods="vm.methods"
                      send="vm.send"
                      open="vm.default_payment"
                      info="vm.info" 
                      user="vm.user" 
                      bookout="vm.bookout"
                      saved-cards="vm.savedCards"
                      on-confirm="vm.donConfirm(methodLabel, paymentIntent)">
                    </payment-accordion>

                    
                  </div>
            </div>


                
      <!-- </div> -->

      <div class="btns_bottom ">
        <a class="btn btn-danger confirm_btn" ng-click="vm.close_pay_now()">CLOSE</a>
        <!-- <a class="btn btn-info confirm_btn" ng-click="vm.pay_now()">MAKE PAYMENT</a> -->
      </div>
  </div>
                            

</div>