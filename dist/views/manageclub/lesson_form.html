<div class="centre_align_boxes2">

    <div class="home_upper">
        <div class="back-box" ui-sref="dashboard.manage_club.edit_course({course_id: vm.club.lesson.course_id})">
              <i class="fa fa-arrow-circle-left"></i> BACK
          </div>
          <div class="welcome_title">
            <h2>LESSONS</h2> 
            <h4 class="capitalise">
              Manage your lessons
            </h4>
          </div>
    </div>

    <div class="center_if_large club_docs bookingout_wrapper">

      <form>


      <div class="club_docs_all">
        <h2>Lesson Details</h2>

        <div class="form-group">
          <label for="title">Title</label>
          <input type="text" class="form-control inputtext" name="title" id="title" ng-model="vm.club.lesson.title" required ng-focus="vm.clearFieldError($event)" />
        </div>
        <div class="form-group">
          <label for="aim">Aim</label>
          <input type="text" class="form-control inputtext" name="aim" id="aim" ng-model="vm.club.lesson.aim" />
        </div>
         <div class="form-group">
          <label for="course_reference">Course Reference</label>
          <input type="text" class="form-control inputtext" name="course_reference" id="course_reference" ng-model="vm.club.lesson.course_reference" />
        </div>
         <div class="form-group">
          <label for="description">Description</label>
          <textarea class="form-control inputtext" name="description" id="description" ng-model="vm.club.lesson.description"></textarea>
        </div>


      </div>


       <div class="btns_bottom" ng-if="!vm.editing">
        <button class="btn btn-info" ng-click="back()">Back</button>
        <button class="btn btn-danger" ng-click="create()">Create Lesson</button>
      </div>


      <!-- ═══════════════════════════════════════════════ -->
      <!-- LESSON CONTENT TABS: Form Builder / File Upload -->
      <!-- ═══════════════════════════════════════════════ -->
      <div class="lesson-content-tabs-wrapper" ng-if="vm.editing">
        
        <div class="lesson-content-tabs">
          <button class="lesson-content-tab"
                  ng-class="{'lesson-content-tab--active': vm.lessonContentTab === 'upload'}"
                  ng-click="vm.switchContentTab('upload')">
            <i class="fa fa-cloud-upload-alt"></i> File Upload
          </button>
          <button class="lesson-content-tab" 
                  ng-class="{'lesson-content-tab--active': vm.lessonContentTab === 'form'}"
                  ng-click="vm.switchContentTab('form')">
            <i class="fa fa-list-alt"></i> Form Builder
          </button>
        </div>


        <!-- ─── TAB A: FORM BUILDER (existing) ─── -->
        <div class="lesson-content-panel" ng-show="vm.lessonContentTab === 'form'">

       <div class="club_docs_all" ng-if="vm.editing">
        <h2>TEM</h2>

            <div class="card" ng-if="vm.tem.length == 0">
              You don't have any TEM yet, please create one.
            </div>

            <div class="card" ng-if="vm.tem.length > 0">
                <table>
                    <tr>
                        <th>Threat / Error</th>
                        <th>Consequence</th>
                        <th>Mitigation</th>
                        <th>Functions</th>
                    </tr>
                    <tbody dnd-list="vm.tem">
                      <tr ng-repeat="tem in vm.tem" dnd-draggable="tem" dnd-moved="vm.tem.splice($index, 1);save_tem_order()">
                        <td>
                          <span ng-if="!tem.edit_me">{{ tem.threat }}</span> 
                          <input ng-if="tem.edit_me" type="text" class="form-control inputtext" name="title" id="title" ng-model="tem.threat" /></td>
                        <td>
                          <span ng-if="!tem.edit_me">{{ tem.consequence }}</span> 
                          <input ng-if="tem.edit_me" type="text" class="form-control inputtext" name="consequence" id="consequence" ng-model="tem.consequence" /></td>
                        <td>
                          <span ng-if="!tem.edit_me">{{ tem.mitigation }}</span> 
                          <input ng-if="tem.edit_me" type="text" class="form-control inputtext" name="mitigation" id="mitigation" ng-model="tem.mitigation" /></td>
                        <td>
                          <a ng-if="!tem.edit_me" ng-click="vm.edit_tem($index)" uib-tooltip="Edit"><i class="fa fa-edit list_icons"></i></a> 
                          &nbsp; 
                          <a ng-if="!tem.edit_me" ng-click="vm.delete_tem(tem, $index)" uib-tooltip="Delete"><i class="fa fa-trash-alt list_icons"></i></a>
                          <a ng-if="tem.edit_me" class="btn btn-danger" ng-click="vm.update_cancel($index)">CANCEL</a>                        
                          <a ng-if="tem.edit_me" class="btn btn-primary" ng-click="vm.update_tem(tem, $index)">SAVE</a>                        
                        </td>
                    </tr>
                     <tr class="dndPlaceholder background_content_dnd">
                        <td colspan="3">
                          Drop Here
                        </td>
                      </tr>
                    </tbody>
                </table>

            </div>

              <div class="card">
                <table>
                    <tr>
                        <th>Threat / Error</th>
                        <th>Consequence</th>
                        <th>Mitigation</th>
                        <th>Functions</th>
                    </tr>
                    <tr>
                        <td><input type="text" class="form-control inputtext" name="title" id="title" ng-model="vm.new_tem.threat" /></td>
                        <td><input type="text" class="form-control inputtext" name="title" id="title" ng-model="vm.new_tem.consequence" /></td>
                        <td><input type="text" class="form-control inputtext" name="title" id="title" ng-model="vm.new_tem.mitigation" /></td>
                        <td><a class="btn btn-primary" ng-click="vm.add_tem()" uib-tooltip="Add new TEM item">ADD TEM</a></td>
                    </tr>

                  </table>
                </div>


      </div>


      <div class="club_docs_all" ng-if="vm.editing">
        <h2>Pre-Flight</h2>

            <div class="card" ng-if="vm.bullets.preflight.length == 0">
              You don't have any Pre-Flight Items yet, please create one.
            </div>

            <div class="card" ng-if="vm.bullets.preflight.length > 0">
                <table dnd-list="vm.bullets.preflight">
                    <tr>
                        <th>Point</th>
                       
                        <th>Formatting</th>

                        <th>Functions</th>
                    </tr>
                    <tbody dnd-list="vm.bullets.preflight">
                      <tr ng-repeat="preflight in vm.bullets.preflight" dnd-draggable="preflight" dnd-moved="vm.bullets.preflight.splice($index, 1);save_bullet_order('preflight')">
                          <td>
                            <span ng-if="!preflight.edit_me" class='{{ (preflight.bullet_format == "0") ? "bullet" : "heading" }}'>{{ preflight.title }}</span> 
                            <input ng-if="preflight.edit_me" type="text" class="form-control inputtext" name="title" id="title" ng-model="preflight.title" />
                          </td>
                          <td><span ng-if="!preflight.edit_me">{{ (preflight.bullet_format == "0") ? "Bullet Point" : "Heading" }} </span>
                             <select ng-if="preflight.edit_me" class="form-control" ng-model="preflight.bullet_format">
                              <option value="0" selected="selected">Bullet Point</option>
                              <option value="1">Heading</option>
                            </select>
                          </td>
                          <td>
                            <a ng-if="!preflight.edit_me" ng-click="vm.edit_bullet('preflight', $index)" uib-tooltip="Edit"><i class="fa fa-edit list_icons"></i></a> 
                            &nbsp; 
                            <a ng-if="!preflight.edit_me" ng-click="vm.delete_bullet('preflight', preflight, $index)" uib-tooltip="Delete"><i class="fa fa-trash-alt list_icons"></i></a>
                            <a ng-if="preflight.edit_me" class="btn btn-danger" ng-click="vm.update_cancel_bullet('preflight',$index)">CANCEL</a>                        
                            <a ng-if="preflight.edit_me" class="btn btn-primary" ng-click="vm.update_bullet('preflight', preflight, $index)">SAVE</a>                        
                          </td>
                      </tr>
                      <tr class="dndPlaceholder background_content_dnd">
                        <td colspan="3">
                          Drop Here
                        </td>
                      </tr>
                    </tbody>
                    
                </table>

            </div>

              <div class="card">
                <table>
                    <tr>
                        <th>Point</th>
                        <th>Formatting</th>
                        <th>Functions</th>
                    </tr>
                    <tr>
                        <td><input type="text" class="form-control inputtext" name="title" id="title" ng-model="vm.new.preflight.title" /></td>
                        <td>
                          <select class="form-control" ng-model="vm.new.preflight.bullet_format">
                            <option value="0" selected="selected">Bullet Point</option>
                            <option value="1">Heading</option>
                          </select>
                        </td>
                        <td><a class="btn btn-primary" ng-click="vm.add_bullet('preflight')" uib-tooltip="Add new item">ADD POINT</a></td>
                    </tr>

                  </table>
                </div>


      </div>


      <div class="club_docs_all" ng-if="vm.editing">
        <h2>Air Exercises</h2>

            <div class="card" ng-if="vm.bullets.airex.length == 0">
              You don't have any Air Exercises yet, please create one.
            </div>

            <div class="card" ng-if="vm.bullets.airex.length > 0">
                <table>
                    <tr>
                        <th>Point</th>
                       
                        <th>Formatting</th>

                        <th>Functions</th>
                    </tr>
                    <tbody dnd-list="vm.bullets.airex">
                      <tr ng-repeat="airex in vm.bullets.airex" dnd-draggable="airex" dnd-moved="vm.bullets.airex.splice($index, 1);save_bullet_order('airex')">
                          <td>
                            <span ng-if="!airex.edit_me" ng-if="!airex.edit_me" class='{{ (airex.bullet_format == "0") ? "bullet" : "heading" }}'>{{ airex.title }}</span> 
                            <input ng-if="airex.edit_me" type="text" class="form-control inputtext" name="title" id="title" ng-model="airex.title" />
                          </td>
                           <td><span ng-if="!airex.edit_me">{{ (airex.bullet_format == "0") ? "Bullet Point" : "Heading" }} </span>
                             <select ng-if="airex.edit_me" class="form-control" ng-model="airex.bullet_format">
                              <option value="0" selected="selected">Bullet Point</option>
                              <option value="1">Heading</option>
                            </select>
                          </td>
                          <td>
                            <a ng-if="!airex.edit_me" ng-click="vm.edit_bullet('airex', $index)" uib-tooltip="Edit"><i class="fa fa-edit list_icons"></i></a> 
                            &nbsp; 
                            <a ng-if="!airex.edit_me" ng-click="vm.delete_bullet('airex', airex, $index)" uib-tooltip="Delete"><i class="fa fa-trash-alt list_icons"></i></a>
                            <a ng-if="airex.edit_me" class="btn btn-danger" ng-click="vm.update_cancel_bullet('airex',$index)">CANCEL</a>                        
                            <a ng-if="airex.edit_me" class="btn btn-primary" ng-click="vm.update_bullet('airex', airex, $index)">SAVE</a>                        
                          </td>
                      </tr>
                      <tr class="dndPlaceholder background_content_dnd">
                          <td colspan="3">
                            Drop Here
                          </td>
                      </tr>
                    </tbody>

                </table>

            </div>

              <div class="card">
                <table>
                    <tr>
                        <th>Point</th>
                        <th>Formatting</th>
                        <th>Functions</th>
                    </tr>
                    <tr>
                        <td><input type="text" class="form-control inputtext" name="title" id="title" ng-model="vm.new.airex.title" /></td>
                        <td>
                          <select class="form-control" ng-model="vm.new.airex.bullet_format">
                            <option value="0" selected="selected">Bullet Point</option>
                            <option value="1">Heading</option>
                          </select>
                        </td>
                        <td><a class="btn btn-primary" ng-click="vm.add_bullet('airex')" uib-tooltip="Add new item">ADD POINT</a></td>
                    </tr>

                  </table>
                </div>


      </div>


    
      <div class="club_docs_all" ng-if="vm.editing">
        <h2>Debrief</h2>

        <div class="card" ng-if="vm.bullets.debrief.length == 0">
              You don't have any Debrief Points yet, please create one.
            </div>

            <div class="card" ng-if="vm.bullets.debrief.length > 0">
                <table>
                    <tr>
                        <th>Point</th>
                       
                        <th>Formatting</th>

                        <th>Functions</th>
                    </tr>

                    <tbody dnd-list="vm.bullets.debrief">
                      <tr ng-repeat="debrief in vm.bullets.debrief" dnd-draggable="debrief" dnd-moved="vm.bullets.debrief.splice($index, 1);save_bullet_order('debrief')">
                        <td>
                          <span ng-if="!debrief.edit_me" ng-if="!debrief.edit_me" class='{{ (debrief.bullet_format == "0") ? "bullet" : "heading" }}'>{{ debrief.title }}</span> 
                          <input ng-if="debrief.edit_me" type="text" class="form-control inputtext" name="title" id="title" ng-model="debrief.title" />
                        </td>
                         <td><span ng-if="!debrief.edit_me">{{ (debrief.bullet_format == "0") ? "Bullet Point" : "Heading" }} </span>
                           <select ng-if="debrief.edit_me" class="form-control" ng-model="debrief.bullet_format">
                            <option value="0" selected="selected">Bullet Point</option>
                            <option value="1">Heading</option>
                          </select>
                        </td>
                        <td>
                          <a ng-if="!debrief.edit_me" ng-click="vm.edit_bullet('debrief', $index)" uib-tooltip="Edit"><i class="fa fa-edit list_icons"></i></a> 
                          &nbsp; 
                          <a ng-if="!debrief.edit_me" ng-click="vm.delete_bullet('debrief', debrief, $index)" uib-tooltip="Delete"><i class="fa fa-trash-alt list_icons"></i></a>
                          <a ng-if="debrief.edit_me" class="btn btn-danger" ng-click="vm.update_cancel_bullet('debrief',$index)">CANCEL</a>                        
                          <a ng-if="debrief.edit_me" class="btn btn-primary" ng-click="vm.update_bullet('debrief', debrief, $index)">SAVE</a>                        
                        </td>
                      </tr>
                      <tr class="dndPlaceholder background_content_dnd">
                          <td colspan="3">
                            Drop Here
                          </td>
                      </tr>
                    </tbody>

                </table>

            </div>

              <div class="card">
                <table>
                    <tr>
                        <th>Point</th>
                        <th>Formatting</th>
                        <th>Functions</th>
                    </tr>
                    <tr>
                        <td><input type="text" class="form-control inputtext" name="title" id="title" ng-model="vm.new.debrief.title" /></td>
                        <td>
                          <select class="form-control" ng-model="vm.new.debrief.bullet_format">
                            <option value="0" selected="selected">Bullet Point</option>
                            <option value="1">Heading</option>
                          </select>
                        </td>
                        <td><a class="btn btn-primary" ng-click="vm.add_bullet('debrief')" uib-tooltip="Add new item">ADD POINT</a></td>
                    </tr>

                  </table>
                </div>


      </div>

        </div><!-- /lesson-content-panel: Form Builder -->


        <!-- ─── TAB B: FILE UPLOAD ─── -->
        <div class="lesson-content-panel" ng-show="vm.lessonContentTab === 'upload'">

          <div class="club_docs_all">
            <h2>Upload Lesson Content</h2>

            <div class="lcf-upload-area">

              <!-- Existing uploaded files (drag to reorder) -->
              <div class="lcf-existing-files" ng-if="vm.contentFiles.length > 0">
                <h3 class="lcf-section-title">
                  Uploaded Files
                  <span class="lcf-reorder-hint" ng-if="vm.contentFiles.length > 1">
                    <i class="fa fa-arrows-alt"></i> Drag to reorder
                  </span>
                </h3>
                <div class="lcf-file-grid" dnd-list="vm.contentFiles">
                  <div class="lcf-file-card"
                       ng-repeat="file in vm.contentFiles"
                       dnd-draggable="file"
                       dnd-moved="vm.contentFiles.splice($index, 1); save_content_files_order()"
                       dnd-effect-allowed="move">
                    <div class="lcf-file-card__drag-handle" uib-tooltip="Drag to reorder">
                      <i class="fa fa-grip-vertical"></i>
                    </div>
                    <div class="lcf-file-card__order-badge">{{$index + 1}}</div>
                    <div class="lcf-file-card__preview">
                      <!-- Loading spinner while decrypting -->
                      <div ng-if="file._loading" class="lcf-file-card__loading">
                        <div class="lcf-spinner"></div>
                      </div>
                      <!-- Load error -->
                      <div ng-if="file._loadError && !file._loading" class="lcf-file-card__load-error">
                        <i class="fa fa-exclamation-triangle"></i>
                        <span>Failed to load</span>
                      </div>
                      <!-- Image preview (decrypted data_uri) -->
                      <img ng-if="!file._loading && !file._loadError && file.data_uri && file.file_type !== 'pdf' && file.mime_type !== 'application/pdf'" ng-src="{{file.data_uri}}" alt="{{file.original_name}}" />
                      <!-- PDF icon -->
                      <div ng-if="!file._loading && !file._loadError && (file.file_type === 'pdf' || file.mime_type === 'application/pdf')" class="lcf-file-card__pdf-icon">
                        <i class="fa fa-file-pdf"></i>
                        <span class="lcf-pdf-pages" ng-if="file.pdf_pages">Pages: {{file.pdf_pages}}</span>
                      </div>
                    </div>
                    <div class="lcf-file-card__info">
                      <span class="lcf-file-card__name" uib-tooltip="{{file.original_name}}">{{file.original_name}}</span>
                      <span class="lcf-file-card__meta">{{vm.formatFileSize(file.file_size)}}</span>
                    </div>
                    <div class="lcf-file-card__actions">
                      <button class="btn btn-sm lcf-btn-replace" ng-click="vm.replaceContentFile(file)" uib-tooltip="Replace file">
                        <i class="fa fa-sync-alt"></i>
                      </button>
                      <button class="btn btn-sm lcf-btn-delete" ng-click="vm.deleteContentFile(file, $index)" uib-tooltip="Delete file">
                        <i class="fa fa-trash-alt"></i>
                      </button>
                    </div>
                  </div>
                  <!-- dnd-list placeholder shown during drag -->
                  <div class="lcf-dnd-placeholder dndPlaceholder">
                    <i class="fa fa-arrows-alt"></i> Drop here
                  </div>
                </div>
              </div>

              <!-- Drop zone -->
              <div class="lcf-dropzone"
                   ng-class="{'lcf-dropzone--active': vm.dragOver, 'lcf-dropzone--uploading': vm.isUploading}"
                   lcf-dropzone
                   lcf-on-drop="vm.handleSelectedFiles(files)"
                   lcf-on-drag-state="vm.dragOver = isDragging"
                   ng-click="vm.triggerFileInput()"
                   ng-if="!vm.isUploading">
                <input type="file" 
                       id="lesson-content-file-input" 
                       style="display:none" 
                       accept=".png,.jpg,.jpeg,.pdf" 
                       multiple 
                       lcf-file-select="vm.onFileInputChange(files)" />
                <div class="lcf-dropzone__content">
                  <div class="lcf-dropzone__icon">
                    <i class="fa fa-cloud-upload-alt"></i>
                  </div>
                  <h3 class="lcf-dropzone__title">Drop files here</h3>
                  <p class="lcf-dropzone__subtitle">or click to browse</p>
                  <div class="lcf-dropzone__formats">
                    <span class="lcf-format-badge lcf-format-badge--img">PNG</span>
                    <span class="lcf-format-badge lcf-format-badge--img">JPG</span>
                    <span class="lcf-format-badge lcf-format-badge--pdf">PDF</span>
                  </div>
                  <p class="lcf-dropzone__hint">Maximum file size: 20MB &middot; PDF files allow page selection (max 2 pages)</p>
                </div>
              </div>

              <!-- Upload progress indicator -->
              <div class="lcf-uploading-indicator" ng-if="vm.isUploading">
                <div class="lcf-spinner"></div>
                <p>Uploading files&hellip;</p>
              </div>

              <!-- Upload queue -->
              <div class="lcf-queue" ng-if="vm.uploadQueue.length > 0 && !vm.isUploading">
                <h3 class="lcf-section-title">Ready to Upload</h3>
                <div class="lcf-file-grid">
                  <div class="lcf-queue-card" ng-repeat="item in vm.uploadQueue">
                    <div class="lcf-queue-card__preview">
                      <img ng-src="{{item.preview}}" alt="{{item.name}}" />
                      <span class="lcf-queue-card__badge" ng-if="item.isPdf">
                        PDF &middot; {{item.pdfPages.length}} page{{item.pdfPages.length > 1 ? 's' : ''}}
                      </span>
                    </div>
                    <div class="lcf-queue-card__info">
                      <span class="lcf-queue-card__name">{{item.name}}</span>
                      <span class="lcf-queue-card__meta">{{vm.formatFileSize(item.size)}}</span>
                    </div>
                    <button class="lcf-queue-card__remove" ng-click="vm.removeFromQueue($index)" uib-tooltip="Remove">
                      <i class="fa fa-times"></i>
                    </button>

                    <!-- Progress bar -->
                    <div class="lcf-queue-card__progress" ng-if="vm.uploadProgress[$index] >= 0">
                      <div class="lcf-progress-bar" style="width: {{vm.uploadProgress[$index]}}%"></div>
                    </div>
                  </div>
                </div>

                <div class="lcf-queue-actions">
                  <button class="btn btn-primary lcf-btn-upload" ng-click="vm.uploadAllFiles()" ng-disabled="vm.isUploading">
                    <i class="fa fa-cloud-upload-alt"></i> Upload {{vm.uploadQueue.length}} File{{vm.uploadQueue.length > 1 ? 's' : ''}}
                  </button>
                  <button class="btn lcf-btn-clear" ng-click="vm.uploadQueue = []" ng-disabled="vm.isUploading">
                    Clear All
                  </button>
                </div>
              </div>

            </div>
          </div>

        </div><!-- /lesson-content-panel: File Upload -->


        <!-- ─── PDF PAGE SELECTOR MODAL ─── -->
        <div class="lcf-pdf-overlay" ng-if="vm.pdfSelector.active" ng-click="vm.closePdfSelector()">
          <div class="lcf-pdf-modal" ng-click="$event.stopPropagation()">
            <div class="lcf-pdf-modal__header">
              <h3><i class="fa fa-file-pdf"></i> Select Pages &mdash; {{vm.pdfSelector.fileName}}</h3>
              <button class="lcf-pdf-modal__close" ng-click="vm.closePdfSelector()">
                <i class="fa fa-times"></i>
              </button>
            </div>

            <div class="lcf-pdf-modal__body">
              <!-- Loading state -->
              <div class="lcf-pdf-loading" ng-if="vm.pdfSelector.loading">
                <div class="lcf-spinner lcf-spinner--lg"></div>
                <p>Loading PDF pages&hellip;</p>
              </div>

              <!-- Error state -->
              <div class="lcf-pdf-error" ng-if="vm.pdfSelector.error">
                <i class="fa fa-exclamation-triangle"></i>
                <p>{{vm.pdfSelector.error}}</p>
                <button class="btn btn-primary" ng-click="vm.closePdfSelector()">Close</button>
              </div>

              <!-- Page grid -->
              <div class="lcf-pdf-pages" ng-if="!vm.pdfSelector.loading && !vm.pdfSelector.error">
                <p class="lcf-pdf-instructions">
                  Select up to <strong>2 pages</strong> to upload. 
                  <span class="lcf-pdf-count">{{vm.pdfSelector.selectedPages.length}} / 2 selected</span>
                </p>
                <div class="lcf-pdf-page-grid">
                  <div class="lcf-pdf-page" 
                       ng-repeat="page in vm.pdfSelector.pages"
                       ng-class="{'lcf-pdf-page--selected': page.selected}"
                       ng-click="vm.togglePdfPage(page)">
                    <div class="lcf-pdf-page__thumb">
                      <img ng-src="{{page.thumbnail}}" alt="Page {{page.pageNum}}" />
                      <div class="lcf-pdf-page__check" ng-if="page.selected">
                        <i class="fa fa-check-circle"></i>
                      </div>
                    </div>
                    <span class="lcf-pdf-page__label">Page {{page.pageNum}}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="lcf-pdf-modal__footer" ng-if="!vm.pdfSelector.loading && !vm.pdfSelector.error">
              <button class="btn lcf-btn-clear" ng-click="vm.closePdfSelector()">Cancel</button>
              <button class="btn btn-primary lcf-btn-upload" 
                      ng-click="vm.confirmPdfPages()"
                      ng-disabled="vm.pdfSelector.selectedPages.length === 0">
                <i class="fa fa-check"></i> Confirm {{vm.pdfSelector.selectedPages.length}} Page{{vm.pdfSelector.selectedPages.length !== 1 ? 's' : ''}}
              </button>
            </div>
          </div>
        </div>


      </div><!-- /lesson-content-tabs-wrapper -->


      <div class="club_docs_all" ng-if="vm.editing">
        <h2>Student Progress Items</h2>

          
            <div class="card" ng-if="vm.items.length == 0">
              You don't have any marking points for this lesson yet, please create one.
            </div>

            <div class="card" ng-if="vm.items.length > 0">
                <table>
                    <tr>
                        <th>Marking Item</th>
                        <th>Description</th>
                        <th>Functions</th>
                    </tr>
                    <tbody dnd-list="vm.items">
                      <tr ng-repeat="item in vm.items" dnd-draggable="item" dnd-moved="vm.items.splice($index, 1);save_items_order()">
                          <td>
                            <span ng-if="!item.edit_me">{{ item.title }}</span> 
                            <input ng-if="item.edit_me" type="text" class="form-control inputtext" name="title" id="title" ng-model="item.title" />
                          </td>
                          <td>
                            <span ng-if="!item.edit_me">{{ item.description }}</span> 
                            <input ng-if="item.edit_me" type="text" class="form-control inputtext" name="description" id="description" ng-model="item.description" />
                          </td>
                          <td>
                            <a ng-if="!item.edit_me" ng-click="vm.edit_item($index)" uib-tooltip="Edit"><i class="fa fa-edit list_icons"></i></a> 
                            &nbsp; 
                            <a ng-if="!item.edit_me" ng-click="vm.delete_item(item, $index)" uib-tooltip="Delete"><i class="fa fa-trash-alt list_icons"></i></a>
                            <a ng-if="item.edit_me" class="btn btn-danger" ng-click="vm.update_cancel_item($index)">CANCEL</a>                        
                            <a ng-if="item.edit_me" class="btn btn-primary" ng-click="vm.update_item(item, $index)">SAVE</a>                        
                          </td>
                      </tr>
                      <tr class="dndPlaceholder background_content_dnd">
                            <td colspan="3">
                              Drop Here
                            </td>
                      </tr>
                    </tbody>

                </table>

            </div>

              <div class="card">
                <table>
                    <tr>
                        <th><span uib-tooltip="The name of the competence that needs to be confirmed by the instructor">Marking Item</span></th>
                        <th><span uib-tooltip="Additional notes which may help the instructor ascertain competence">Description</span></th>
                        <th>Functions</th>
                    </tr>
                    <tr>
                        <td><input type="text" class="form-control inputtext" name="title" id="title" ng-model="vm.new_item.title" /></td>
                        <td><input type="text" class="form-control inputtext" name="description" id="description" ng-model="vm.new_item.description" /></td>
                        <td><a class="btn btn-primary" ng-click="vm.add_item()" uib-tooltip="Add new marking point item">ADD MARKING POINT</a></td>
                    </tr>

                  </table>
                </div>


      </div>


          <div class="btns_bottom" ng-if="vm.editing">
            <button class="btn btn-info" ng-click="back()">Back</button>
            <button class="btn btn-danger" ng-click="save()">Save</button>
          </div>

      </div>

   



       



      </form>
